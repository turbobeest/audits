# ============================================================
# EXAMPLE AUDIT: Organizational/Qualitative Domain
# ============================================================
# This example shows how to adapt the template for audits that:
# - Assess human/team factors rather than code
# - Use interviews and document review rather than grep
# - Have qualitative findings rather than pass/fail checks
# - Cannot be fully automated
# ============================================================

audit:
  id: "human-organizational.knowledge-distribution.bus-factor"
  name: "Bus Factor Audit"
  version: "1.0.0"
  last_updated: "2025-01-18"
  status: "active"
  
  category: "human-organizational"
  category_number: 20
  subcategory: "knowledge-distribution"
  
  tier: "expert"
  estimated_duration: "4-8 hours"
  
  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

# ============================================================
# EXECUTION: Note the "manual" automation level
# ============================================================

execution:
  automatable: "manual"   # Cannot be automated - requires interviews and analysis
  severity: "high"
  scope: "organizational" # Not code, not config - organizational assessment
  
  default_profiles:
    - "full"
    
  blocks_phase: false
  parallelizable: false   # Interviews shouldn't overlap

# ============================================================
# DESCRIPTION
# ============================================================

description:
  what: |
    Assesses the distribution of critical knowledge across team members.
    Identifies single points of failure where only one person understands
    a system, process, or domain. Evaluates documentation coverage and
    cross-training practices.
    
  why_it_matters: |
    Low bus factor creates organizational fragility. When key individuals
    leave, take vacation, or become unavailable, teams face:
    - Extended incident resolution times
    - Inability to maintain critical systems
    - Knowledge loss requiring expensive reconstruction
    - Blocked projects waiting for specific individuals
    
  when_to_run:
    - "Quarterly team health reviews"
    - "Before organizational changes (reorgs, layoffs)"
    - "When planning for key person transitions"
    - "After incidents revealing knowledge gaps"

# ============================================================
# PREREQUISITES: Need people and documents, not code
# ============================================================

prerequisites:
  required_artifacts:
    - type: "team_roster"
      description: "List of team members with roles and tenure"
      
    - type: "service_catalog"
      description: "List of systems/services the team owns"
      
    - type: "on_call_schedule"
      description: "Historical on-call rotation and escalation data"
      
  optional_artifacts:
    - type: "org_chart"
      description: "Organizational structure"
      
    - type: "incident_history"
      description: "Past incidents with resolver information"
      
  access_requirements:
    - "Ability to interview team members (30 min each)"
    - "Access to on-call and incident management systems"
    - "Access to documentation repositories"

# ============================================================
# DISCOVERY: Interviews and document review, not grep
# ============================================================

discovery:
  # WHO to talk to
  interviews:
    - role: "Engineering Manager"
      questions:
        - "Which systems do you worry about if specific people leave?"
        - "What knowledge is not documented that should be?"
        - "How do you handle knowledge transfer when people change roles?"
      purpose: "Identify management awareness of knowledge risks"
      duration: "30 min"
      
    - role: "Senior Engineers (2-3)"
      questions:
        - "What systems do only you understand deeply?"
        - "Who could cover for you during extended absence?"
        - "What would you want documented before you left?"
      purpose: "Self-assessment of knowledge concentration"
      duration: "30 min each"
      
    - role: "On-call Engineers"
      questions:
        - "What incidents required escalation to specific individuals?"
        - "What runbooks are missing or inadequate?"
        - "What systems are you uncomfortable being paged for?"
      purpose: "Identify operational knowledge gaps"
      duration: "30 min"
      
  # WHAT to review
  documents_to_review:
    - type: "Runbooks"
      purpose: "Assess documentation coverage for each service"
      look_for:
        - "Coverage: Does every service have a runbook?"
        - "Quality: Are runbooks actionable by any team member?"
        - "Currency: When were runbooks last updated?"
        
    - type: "Architecture docs"
      purpose: "Assess system documentation quality"
      look_for:
        - "Are all owned systems documented?"
        - "Is tribal knowledge captured or only in heads?"
        
    - type: "On-call handoff notes"
      purpose: "Identify recurring knowledge gaps"
      look_for:
        - "Patterns of escalation to specific individuals"
        - "Recurring questions about specific systems"
        
    - type: "Code ownership files (CODEOWNERS)"
      purpose: "Identify single-owner patterns"
      look_for:
        - "Files/directories with only one owner"
        - "Concentration of ownership"
        
  # METRICS to gather (from systems, not interviews)
  metrics_queries:
    - system: "Git/Version Control"
      query: "git shortlog -sn --all -- {path} | head -5"
      purpose: "Identify commit concentration per component"
      threshold: "Top contributor <50% of commits"
      
    - system: "Incident Management (PagerDuty/Opsgenie)"
      query: "Incidents resolved by individual over past 6 months"
      purpose: "Identify incident resolution concentration"
      threshold: "No individual >30% of resolutions"
      
    - system: "Code Review System"
      query: "Review approvals by individual over past 6 months"
      purpose: "Identify review bottlenecks"
      threshold: "No individual >40% of approvals for any component"

# ============================================================
# KNOWLEDGE SOURCES: Books on team dynamics, not RFCs
# ============================================================

knowledge_sources:
  guides:
    - id: "google-sre-book"
      name: "Google SRE Book - Chapter on Eliminating Toil"
      url: "https://sre.google/sre-book/eliminating-toil/"
      offline_cache: true
      priority: "recommended"
      
    - id: "team-topologies"
      name: "Team Topologies Knowledge Distribution Patterns"
      url: "https://teamtopologies.com/"
      offline_cache: false
      priority: "optional"
      
  learning_resources:
    - id: "accelerate-book"
      title: "Accelerate: The Science of Lean Software and DevOps"
      type: "book"
      reference: "ISBN 978-1942788331"
      relevance: "Research on high-performing teams and knowledge sharing"
      
    - id: "phoenix-project"
      title: "The Phoenix Project"
      type: "book"
      reference: "ISBN 978-0988262508"
      relevance: "Narrative example of bus factor problems"

# ============================================================
# TOOLING: Analysis tools, not static analysis
# ============================================================

tooling:
  # Version control analysis
  infrastructure_tools:
    - tool: "git-fame"
      purpose: "Analyze code contribution distribution"
      install: "pip install git-fame"
      command: "git-fame --sort=commits --exclude='*.lock,*.json'"
      offline_capable: true
      
    - tool: "git"
      purpose: "Identify single-contributor files"
      command: |
        for file in $(git ls-files); do
          contributors=$(git log --format='%ae' -- "$file" | sort -u | wc -l)
          if [ "$contributors" -eq 1 ]; then
            echo "SINGLE: $file"
          fi
        done
      offline_capable: true
      
  assessment_tools:
    - tool: "Bus Factor Calculator Spreadsheet"
      purpose: "Map people to systems and calculate coverage"
      description: |
        Create matrix: rows = systems/components, columns = team members
        Mark cells: 3=expert, 2=proficient, 1=aware, 0=no knowledge
        Flag rows where only one person has 2+

# ============================================================
# SIGNALS: Qualitative indicators, not grep patterns
# ============================================================

signals:
  critical:
    - id: "BUSFACTOR-CRIT-001"
      signal: "Single point of knowledge for production-critical system"
      evidence_indicators:
        - "Only one person has ever resolved incidents for this system"
        - "Only one person can deploy or make changes to this system"
        - "Team members say 'only X understands that'"
        - "Git history shows >90% commits from single contributor"
      explanation: |
        If this person becomes unavailable, the team cannot maintain
        the system. This creates unacceptable operational risk for
        production-critical systems.
      remediation: |
        - Immediate: Document current state with knowledge holder
        - Short-term: Pair the expert with a designated backup
        - Medium-term: Cross-train at least 2 additional people
        - Long-term: Create comprehensive runbooks and architecture docs
        
    - id: "BUSFACTOR-CRIT-002"
      signal: "No documentation exists for critical system"
      evidence_indicators:
        - "No runbook in runbook repository"
        - "No architecture documentation"
        - "Interview reveals 'it's all in X's head'"
      explanation: |
        Undocumented systems are at extreme risk during personnel
        changes or incidents when the expert is unavailable.
      remediation: |
        - Schedule documentation sprint with knowledge holder
        - Use interview-based documentation extraction
        - Record video walkthroughs as interim measure
        
  high:
    - id: "BUSFACTOR-HIGH-001"
      signal: "Knowledge concentrated in 1-2 people for multiple systems"
      evidence_indicators:
        - "Same person is the expert for 3+ systems"
        - "Same person is always escalated for different issues"
        - "Git analysis shows same contributor dominates multiple repos"
      explanation: |
        Over-reliance on specific individuals creates fragility and
        also burns out those individuals.
      remediation: |
        - Identify highest-risk systems for cross-training priority
        - Reduce scope of individual ownership
        - Block new work until knowledge is distributed
        
    - id: "BUSFACTOR-HIGH-002"
      signal: "Recent departure caused significant knowledge loss"
      evidence_indicators:
        - "Interview reveals 'X left and took knowledge with them'"
        - "Incidents increased after specific person left"
        - "Team is struggling to maintain systems X owned"
      explanation: |
        Evidence that bus factor risks have already materialized.
        Urgent need to prevent recurrence.
      remediation: |
        - Forensic documentation of remaining team knowledge
        - Explicit knowledge capture in offboarding process
        - Knowledge distribution as blocking priority
        
  medium:
    - id: "BUSFACTOR-MED-001"
      signal: "Documentation exists but is stale or incomplete"
      evidence_indicators:
        - "Runbooks last updated >6 months ago"
        - "Architecture docs don't match current implementation"
        - "Interview reveals 'docs are outdated'"
      remediation: |
        - Establish documentation review cadence
        - Add doc updates to definition of done
        - Schedule documentation refresh sprint
        
    - id: "BUSFACTOR-MED-002"
      signal: "Cross-training planned but not executed"
      evidence_indicators:
        - "Plans exist to train backups but haven't happened"
        - "Knowledge transfer perpetually deprioritized"
      remediation: |
        - Schedule explicit knowledge transfer sessions
        - Track as OKR or quarterly goal
        - Block feature work until addressed
        
  positive:
    - id: "BUSFACTOR-POS-001"
      signal: "Multiple qualified maintainers for all systems"
      evidence_indicators:
        - "2+ people can resolve incidents for each system"
        - "Git history shows distributed contributions"
        - "Team members express confidence covering for each other"
        
    - id: "BUSFACTOR-POS-002"
      signal: "Active knowledge sharing practices"
      evidence_indicators:
        - "Regular pairing or mob programming"
        - "Rotating on-call with knowledge transfer"
        - "Documentation kept current"

# ============================================================
# PROCEDURE: Interview-based, not command-based
# ============================================================

procedure:
  context:
    cognitive_mode: "evaluative"  # Weighing evidence, not binary checks
    ensemble_role: "auditor"
    
  preparation:
    - step: "Gather team roster and tenure information"
    - step: "Obtain service/system catalog"
    - step: "Pull incident history for past 6 months"
    - step: "Schedule interviews (30 min each)"
    
  steps:
    - id: "1"
      name: "Quantitative Analysis"
      description: |
        Run git analysis to identify contribution concentration.
        Pull incident data to identify escalation patterns.
        Review code ownership files.
      duration_estimate: "1-2 hours"
      commands:
        - purpose: "Identify single-contributor files"
          command: |
            git log --format='%ae' --name-only | sort | uniq -c | sort -rn | head -50
        - purpose: "Contribution distribution"
          command: "git shortlog -sn --all | head -20"
      expected_findings:
        - "List of concentrated ownership areas"
        - "Incident escalation patterns"
        
    - id: "2"
      name: "Manager Interview"
      description: |
        Interview engineering manager(s) to understand:
        - Perceived knowledge risks
        - Cross-training plans and status
        - Historical knowledge loss events
      duration_estimate: "30-45 min"
      questions:
        - "Which systems keep you up at night if key people leave?"
        - "What's your succession plan for each critical system?"
        - "Have you lost critical knowledge when people left?"
      expected_findings:
        - "Management awareness of risks"
        - "Existence/absence of mitigation plans"
        
    - id: "3"
      name: "Senior Engineer Interviews"
      description: |
        Interview 2-3 senior engineers to self-assess their
        knowledge concentration and identify gaps.
      duration_estimate: "1.5-2 hours total"
      questions:
        - "What do only you know?"
        - "Who's your backup?"
        - "What would you want documented?"
      expected_findings:
        - "Self-identified knowledge silos"
        - "Desired documentation gaps"
        
    - id: "4"
      name: "On-call Engineer Interviews"
      description: |
        Interview on-call engineers to identify operational
        knowledge gaps and escalation bottlenecks.
      duration_estimate: "1-1.5 hours total"
      questions:
        - "What incidents required specific person escalation?"
        - "What systems are you uncomfortable being paged for?"
        - "What runbooks are missing or inadequate?"
      expected_findings:
        - "Operational knowledge gaps"
        - "Runbook coverage assessment"
        
    - id: "5"
      name: "Documentation Review"
      description: |
        Assess documentation coverage and quality for each
        owned system.
      duration_estimate: "1-2 hours"
      questions:
        - "Does every system have a runbook?"
        - "Are runbooks actionable by any team member?"
        - "When were docs last updated?"
      expected_findings:
        - "Documentation coverage percentage"
        - "Staleness assessment"
        
    - id: "6"
      name: "Bus Factor Matrix Construction"
      description: |
        Build matrix mapping people to systems with proficiency
        levels. Calculate bus factor for each system.
      duration_estimate: "1 hour"
      expected_findings:
        - "Bus factor score per system"
        - "Priority list for cross-training"

# ============================================================
# OUTPUT
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      
    - type: "bus_factor_matrix"
      format: "spreadsheet"
      description: "Systems x People matrix with proficiency scores"
      
    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Critical Risks (Bus Factor = 1)"
        - "High Risks (Bus Factor = 2)"
        - "Cross-Training Recommendations"
        - "Documentation Gaps"
        
  confidence_guidance:
    high: "Multiple interview sources confirm, quantitative data supports"
    medium: "Interview data consistent but limited quantitative support"
    low: "Single source or conflicting information"

# ============================================================
# OFFLINE SUPPORT
# ============================================================

offline:
  capability: "partial"
  
  cache_manifest:
    knowledge:
      - source_id: "google-sre-book"
        priority: "recommended"
        
  degradation:
    - feature: "Incident data pull from PagerDuty/Opsgenie"
      impact: "Cannot analyze escalation patterns"
      mitigation: "Export incident data before going offline"

# ============================================================
# PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: false
      reason: "Requires interviews - cannot be done quickly"
    security:
      included: false
      reason: "Not security-focused"
    production:
      included: false
      reason: "Organizational audit, not production readiness"
    full:
      included: true
      priority: 85

# ============================================================
# CLOSEOUT: Human-verified, not bash commands
# ============================================================

closeout_checklist:
  - id: "busfactor-001"
    item: "All critical systems have documented bus factor"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Reviewer confirms bus factor matrix includes all services from service catalog"
    expected: "Confirmed by reviewer"
    
  - id: "busfactor-002"
    item: "Manager interview completed"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Interview notes exist for engineering manager"
    expected: "Confirmed by reviewer"
    
  - id: "busfactor-003"
    item: "Senior engineer interviews completed (2+ people)"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Interview notes exist for at least 2 senior engineers"
    expected: "Confirmed by reviewer"
    
  - id: "busfactor-004"
    item: "Critical risks have remediation plan"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Every system with bus factor = 1 has documented remediation plan"
    expected: "Confirmed by reviewer"
    
  - id: "busfactor-005"
    item: "Git contribution analysis completed"
    level: "WARNING"
    verification: "test -f .audit-results/git-contribution-analysis.txt && echo 'PASS' || echo 'FAIL'"
    expected: "PASS"

# ============================================================
# GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["all"]
    team_sizes: ["small", "medium", "large"]
    
  compliance_frameworks:
    - framework: "SOC2"
      controls: ["CC1.4"]  # Organizational structure
    - framework: "ISO27001"
      controls: ["A.7.2"]  # Human resource security

# ============================================================
# RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "human-organizational.ownership.service-ownership"
    - "documentation-knowledge.operational.runbook-coverage"
    - "human-organizational.cognitive-load.system-complexity"
