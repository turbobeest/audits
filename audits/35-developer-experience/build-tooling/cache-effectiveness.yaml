audit:
  id: developer-experience.build-tooling.cache-effectiveness
  name: Cache Effectiveness Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: developer-experience
  category_number: 35
  subcategory: build-tooling
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: development
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the effectiveness of build caching mechanisms including
    local caches, remote caches, and CI caches. Measures cache hit rates,
    cache invalidation accuracy, and storage utilization. Identifies
    opportunities to improve caching for faster builds.
  why_it_matters: |
    Build caching can dramatically reduce build times by reusing previous
    work. Effective caching transforms 10-minute builds into 1-minute builds.
    However, misconfigured caches can waste storage, serve stale results,
    or miss opportunities for reuse.
  when_to_run:
  - When build times are high despite caching
  - After changing build configurations
  - When cache storage grows unexpectedly
  - Quarterly optimization review
prerequisites:
  required_artifacts:
  - type: cache_configuration
    description: Build cache settings
  - type: build_logs
    description: Build logs with cache metrics
  - type: ci_configuration
    description: CI cache configuration
  access_requirements:
  - Build system access
  - CI platform access
  - Cache storage access
discovery:
  file_patterns:
  - glob: '**/turbo.json'
    purpose: Find Turborepo cache config
  - glob: '**/.nx/**'
    purpose: Find Nx cache
  - glob: '**/webpack.config.js'
    purpose: Check webpack cache
  - glob: '**/.github/workflows/*.yml'
    purpose: Find CI cache config
  - glob: '**/.gitlab-ci.yml'
    purpose: Find GitLab CI cache
  interview_questions:
  - role: Developer
    questions:
    - Do you notice caching improving build times?
    - Have you experienced stale cache issues?
    - Do CI builds benefit from caching?
  - role: DevOps Engineer
    questions:
    - What caching strategy is in place?
    - What is the cache hit rate?
    - How is cache storage managed?
knowledge_sources:
  guides:
  - id: turbo-caching
    name: Turborepo Caching
    url: https://turbo.build/repo/docs/core-concepts/caching
  - id: nx-caching
    name: Nx Computation Caching
    url: https://nx.dev/concepts/how-caching-works
  standards:
  - id: remote-cache
    name: Remote Build Caching
    relevance: Shared cache architecture
tooling:
  analysis_tools:
  - tool: turborepo
    purpose: Analyze Turbo cache
    command: turbo run build --dry-run --summarize
  - tool: nx
    purpose: Analyze Nx cache
    command: nx affected:build --verbose
  - tool: bazel
    purpose: Bazel cache analysis
    command: bazel build //... --remote_cache_statistics
  - tool: ccache
    purpose: C/C++ compiler cache
    command: ccache -s
signals:
  critical:
  - id: CACHE-CRIT-001
    signal: No build caching configured
    evidence_indicators:
    - Every build starts from scratch
    - No cache directories present
    - Cache disabled in configuration
    explanation: |
      Without caching, builds cannot reuse previous work,
      making every build a full rebuild.
    remediation: |
      Enable appropriate caching for your build tools.
      Configure both local and CI caches.
  - id: CACHE-CRIT-002
    signal: Cache serves stale or incorrect results
    evidence_indicators:
    - Build succeeds with outdated artifacts
    - Inconsistent behavior between builds
    - Manual cache clearing required
    explanation: |
      Stale caches cause hard-to-debug issues and erode
      trust in the build system.
    remediation: |
      Review cache key generation and invalidation logic.
      Ensure all relevant inputs affect cache keys.
  high:
  - id: CACHE-HIGH-001
    signal: Cache hit rate below 50%
    remediation: |
      Analyze cache misses to identify invalidation issues.
      Review what inputs affect cache keys.
  - id: CACHE-HIGH-002
    signal: CI cache not utilized
    remediation: |
      Configure CI cache with appropriate key patterns
      and restore strategies.
  - id: CACHE-HIGH-003
    signal: No remote cache for team sharing
    remediation: |
      Consider Turborepo Remote Cache, Nx Cloud, or
      similar for team-wide cache sharing.
  medium:
  - id: CACHE-MED-001
    signal: Cache storage growing unbounded
    remediation: |
      Implement cache eviction policies and size limits.
  - id: CACHE-MED-002
    signal: Different cache configurations per environment
    remediation: |
      Standardize cache configuration across local and CI.
  - id: CACHE-MED-003
    signal: Cache keys too broad or too narrow
    remediation: |
      Tune cache key granularity for optimal hit rate
      without serving stale content.
  low:
  - id: CACHE-LOW-001
    signal: Cache metrics not tracked
    remediation: |
      Implement cache hit rate and storage metrics.
  - id: CACHE-LOW-002
    signal: Cache configuration not documented
    remediation: |
      Document caching strategy and troubleshooting.
  positive:
  - id: CACHE-POS-001
    signal: Cache hit rate above 80%
  - id: CACHE-POS-002
    signal: Remote cache shared across team
  - id: CACHE-POS-003
    signal: CI builds benefit from previous runs
  - id: CACHE-POS-004
    signal: Cache metrics tracked and optimized
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Cache Configuration
    description: Examine cache settings in build tools
    duration_estimate: 30 min
  - id: '2'
    name: Measure Cache Hit Rate
    description: Analyze cache hit vs miss ratio
    duration_estimate: 30 min
  - id: '3'
    name: Test Cache Correctness
    description: Verify cache doesn't serve stale results
    duration_estimate: 30 min
  - id: '4'
    name: Analyze CI Caching
    description: Review CI cache configuration and effectiveness
    duration_estimate: 30 min
  - id: '5'
    name: Assess Storage Usage
    description: Review cache storage growth and management
    duration_estimate: 30 min
output:
  deliverables:
  - type: cache_assessment
    format: structured
    sections:
    - Cache configuration review
    - Hit rate analysis
    - Correctness verification
    - Storage analysis
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Cache Analysis
    - Optimization Opportunities
    - Recommendations
closeout_checklist:
- id: cache-001
  item: Cache configuration reviewed
  level: ERROR
  verification: manual
- id: cache-002
  item: Cache hit rate measured
  level: WARNING
  verification: manual
- id: cache-003
  item: Cache correctness verified
  level: ERROR
  verification: manual
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: ISO 27001
    control: A.12.1
    description: Operational procedures
relationships:
  commonly_combined:
  - developer-experience.build-tooling.build-time-analysis
  - developer-experience.build-tooling.incremental-build-support
  depends_on:
  - devops-ci-cd.build-configuration
  feeds_into:
  - devops-ci-cd.ci-pipeline-performance
