audit:
  id: developer-experience.build-tooling.monorepo-tooling
  name: Monorepo Tooling Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: developer-experience
  category_number: 35
  subcategory: build-tooling
  tier: expert
  estimated_duration: 3-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: development
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the tooling and workflows for managing monorepo development
    including build orchestration, dependency management between packages,
    affected change detection, and task running. Assesses whether monorepo
    tools enable efficient development across multiple packages.
  why_it_matters: |
    Monorepos offer benefits like atomic changes and code sharing, but
    require specialized tooling to remain efficient. Without proper tools,
    monorepos become slow, confusing, and frustrating. Good monorepo tooling
    enables selective builds, clear dependencies, and efficient CI.
  when_to_run:
  - When adopting or migrating to monorepo
  - When monorepo builds become slow
  - When adding new packages
  - Quarterly performance review
prerequisites:
  required_artifacts:
  - type: monorepo_configuration
    description: Monorepo tool configuration
  - type: package_structure
    description: Package layout and dependencies
  access_requirements:
  - Repository access
  - Build system access
  - CI configuration access
discovery:
  file_patterns:
  - glob: '**/turbo.json'
    purpose: Find Turborepo configuration
  - glob: '**/nx.json'
    purpose: Find Nx configuration
  - glob: '**/pnpm-workspace.yaml'
    purpose: Find pnpm workspace
  - glob: '**/lerna.json'
    purpose: Find Lerna configuration
  - glob: '**/rush.json'
    purpose: Find Rush configuration
  - glob: '**/packages/*/package.json'
    purpose: Find workspace packages
  interview_questions:
  - role: Developer
    questions:
    - How do you run commands for specific packages?
    - Can you build only what changed?
    - How do you manage cross-package dependencies?
    - What's your experience with monorepo tooling?
knowledge_sources:
  guides:
  - id: turborepo-docs
    name: Turborepo Documentation
    url: https://turbo.build/repo/docs
  - id: nx-docs
    name: Nx Documentation
    url: https://nx.dev/
  - id: monorepo-tools
    name: Monorepo Tools Comparison
    url: https://monorepo.tools/
  standards:
  - id: workspace-protocol
    name: Workspace Protocol
    relevance: Package linking conventions
tooling:
  analysis_tools:
  - tool: turborepo
    purpose: Monorepo build orchestration
    command: turbo run build --graph
  - tool: nx
    purpose: Monorepo task runner
    command: nx graph
  - tool: pnpm
    purpose: Workspace package management
    command: pnpm -r list
  - tool: lerna
    purpose: Legacy monorepo management
    command: lerna list --graph
signals:
  critical:
  - id: MONO-CRIT-001
    signal: No monorepo orchestration tool
    evidence_indicators:
    - Manual package coordination
    - All packages build on every change
    - No dependency graph awareness
    explanation: |
      Without orchestration, monorepos lose their benefits
      and become slower than separate repositories.
    remediation: |
      Adopt Turborepo, Nx, or similar for build orchestration
      with caching and affected detection.
  - id: MONO-CRIT-002
    signal: Cross-package changes break builds
    evidence_indicators:
    - Incorrect build order
    - Stale package versions
    - Missing dependency declarations
    explanation: |
      Broken cross-package builds create confusion and
      waste time debugging dependency issues.
    remediation: |
      Ensure all dependencies are properly declared and
      build tool respects dependency order.
  high:
  - id: MONO-HIGH-001
    signal: All packages rebuild on every change
    remediation: |
      Configure affected change detection to build only
      packages impacted by changes.
  - id: MONO-HIGH-002
    signal: No caching across packages
    remediation: |
      Enable build caching at the package level to reuse
      work across builds.
  - id: MONO-HIGH-003
    signal: Package dependencies unclear
    remediation: |
      Generate and maintain dependency graph visualization.
      Document package relationships.
  medium:
  - id: MONO-MED-001
    signal: No remote cache for monorepo builds
    remediation: |
      Configure Turborepo Remote Cache or Nx Cloud for
      team-wide cache sharing.
  - id: MONO-MED-002
    signal: Inconsistent package scripts
    remediation: |
      Standardize package scripts across the monorepo
      for predictable task running.
  - id: MONO-MED-003
    signal: CI doesn't utilize affected detection
    remediation: |
      Configure CI to run only affected package tests
      and builds.
  low:
  - id: MONO-LOW-001
    signal: Monorepo structure not documented
    remediation: |
      Document package layout, dependencies, and
      development workflows.
  - id: MONO-LOW-002
    signal: No package creation templates
    remediation: |
      Create generators or templates for new packages.
  positive:
  - id: MONO-POS-001
    signal: Efficient affected change detection
  - id: MONO-POS-002
    signal: Cross-package caching working
  - id: MONO-POS-003
    signal: Clear dependency visualization available
  - id: MONO-POS-004
    signal: Standardized package structure and scripts
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Monorepo Configuration
    description: Examine orchestration tool setup
    duration_estimate: 30 min
  - id: '2'
    name: Test Affected Detection
    description: Verify only changed packages rebuild
    duration_estimate: 45 min
  - id: '3'
    name: Analyze Dependency Graph
    description: Review package dependencies
    duration_estimate: 30 min
  - id: '4'
    name: Measure Build Performance
    description: Time full and incremental monorepo builds
    duration_estimate: 45 min
  - id: '5'
    name: Review CI Integration
    description: Check CI utilizes monorepo features
    duration_estimate: 30 min
output:
  deliverables:
  - type: monorepo_assessment
    format: structured
    sections:
    - Tool configuration review
    - Affected detection results
    - Dependency graph analysis
    - Performance measurements
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Current State
    - Optimization Opportunities
    - Recommendations
closeout_checklist:
- id: mono-001
  item: Monorepo tooling reviewed
  level: ERROR
  verification: manual
- id: mono-002
  item: Affected detection tested
  level: WARNING
  verification: manual
- id: mono-003
  item: Build performance measured
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - monorepo-projects
  compliance_mappings:
  - framework: ISO 27001
    control: A.12.1
    description: Operational procedures
relationships:
  commonly_combined:
  - developer-experience.build-tooling.cache-effectiveness
  - developer-experience.build-tooling.build-time-analysis
  depends_on:
  - devops-ci-cd.build-configuration
  feeds_into:
  - devops-ci-cd.ci-pipeline-performance
