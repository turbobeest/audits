audit:
  id: developer-experience.testing-experience.test-writing-ergonomics
  name: Test Writing Ergonomics Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: developer-experience
  category_number: 35
  subcategory: testing-experience
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: development
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates how easy it is to write new tests including assertion APIs,
    test utility availability, boilerplate requirements, and patterns for
    common test scenarios. Assesses whether the test authoring experience
    encourages or discourages comprehensive testing.
  why_it_matters: |
    If writing tests is difficult, developers write fewer of them. Good
    ergonomics lower the barrier to testing, leading to better coverage
    and more maintainable tests. Poor ergonomics create friction that
    compounds with every test written.
  when_to_run:
  - When test coverage is low
  - When developers avoid writing tests
  - After test framework changes
  - Quarterly DX review
prerequisites:
  required_artifacts:
  - type: test_suite
    description: Existing test suite
  - type: test_utilities
    description: Test helper functions
  access_requirements:
  - Test suite access
  - Test documentation
  - Developer interviews
discovery:
  file_patterns:
  - glob: '**/test-utils/**'
    purpose: Find test utilities
  - glob: '**/testing-library/**'
    purpose: Find testing library setup
  - glob: '**/jest.setup.{js,ts}'
    purpose: Find Jest setup files
  - glob: '**/vitest.setup.{js,ts}'
    purpose: Find Vitest setup files
  interview_questions:
  - role: Developer
    questions:
    - How easy is it to write a new test?
    - What boilerplate is required for tests?
    - Do you have good test utilities?
    - What would make writing tests easier?
knowledge_sources:
  guides:
  - id: testing-library
    name: Testing Library Documentation
    url: https://testing-library.com/
  - id: jest-expect
    name: Jest Expect API
    url: https://jestjs.io/docs/expect
  standards:
  - id: test-patterns
    name: Test Patterns and Practices
    relevance: Effective test writing
tooling:
  analysis_tools:
  - tool: testing-library
    purpose: DOM testing utilities
  - tool: jest-dom
    purpose: Custom DOM matchers
    command: npm install @testing-library/jest-dom
  - tool: user-event
    purpose: User interaction testing
    command: npm install @testing-library/user-event
signals:
  critical:
  - id: ERGONOMICS-CRIT-001
    signal: Excessive boilerplate required for tests
    evidence_indicators:
    - 50+ lines before first assertion
    - Complex setup in every test
    - Copy-paste heavy test writing
    explanation: |
      Excessive boilerplate discourages test writing and
      leads to poor test coverage.
    remediation: |
      Create test utilities and helpers for common setup.
      Use beforeEach for shared setup.
  - id: ERGONOMICS-CRIT-002
    signal: Assertion API confusing or limited
    evidence_indicators:
    - Custom assertion code everywhere
    - Hard to express test intent
    - Multiple assertions for simple checks
    explanation: |
      Poor assertion APIs make tests verbose and
      hard to understand.
    remediation: |
      Use modern assertion libraries with good APIs.
      Add custom matchers for domain-specific assertions.
  high:
  - id: ERGONOMICS-HIGH-001
    signal: No test utilities for common patterns
    remediation: |
      Create utilities for common test operations
      like rendering components, API mocking, etc.
  - id: ERGONOMICS-HIGH-002
    signal: Async testing difficult
    remediation: |
      Use testing library waitFor patterns and
      document async testing approaches.
  - id: ERGONOMICS-HIGH-003
    signal: Component testing requires deep mocking
    remediation: |
      Improve component design for testability.
      Provide mock providers for common dependencies.
  medium:
  - id: ERGONOMICS-MED-001
    signal: No test templates or snippets
    remediation: |
      Create IDE snippets for common test patterns.
  - id: ERGONOMICS-MED-002
    signal: Test helpers not documented
    remediation: |
      Document available test utilities and patterns.
  - id: ERGONOMICS-MED-003
    signal: No examples of good tests
    remediation: |
      Curate example tests that demonstrate best practices.
  low:
  - id: ERGONOMICS-LOW-001
    signal: TypeScript types missing for test utilities
    remediation: |
      Add types to test utilities for IDE support.
  - id: ERGONOMICS-LOW-002
    signal: Test style guide not documented
    remediation: |
      Document test writing conventions and patterns.
  positive:
  - id: ERGONOMICS-POS-001
    signal: Minimal boilerplate for new tests
  - id: ERGONOMICS-POS-002
    signal: Rich assertion library with good matchers
  - id: ERGONOMICS-POS-003
    signal: Comprehensive test utilities
  - id: ERGONOMICS-POS-004
    signal: Well-documented test patterns
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Test Utilities
    description: Find available test helpers and utilities
    duration_estimate: 30 min
  - id: '2'
    name: Write Sample Test
    description: Experience writing a new test
    duration_estimate: 30 min
  - id: '3'
    name: Evaluate Assertion API
    description: Review assertion library and custom matchers
    duration_estimate: 30 min
  - id: '4'
    name: Review Test Patterns
    description: Examine existing test patterns
    duration_estimate: 30 min
  - id: '5'
    name: Gather Developer Feedback
    description: Interview developers about test writing experience
    duration_estimate: 30 min
output:
  deliverables:
  - type: ergonomics_assessment
    format: structured
    sections:
    - Utility inventory
    - Boilerplate analysis
    - Assertion API review
    - Developer feedback
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Ergonomics Analysis
    - Recommendations
closeout_checklist:
- id: ergonomics-001
  item: Test utilities inventoried
  level: ERROR
  verification: manual
- id: ergonomics-002
  item: Sample test written
  level: WARNING
  verification: manual
- id: ergonomics-003
  item: Developer feedback collected
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: ISO 27001
    control: A.14.2
    description: Security in development
relationships:
  commonly_combined:
  - developer-experience.testing-experience.test-data-management
  - developer-experience.testing-experience.test-feedback-quality
  depends_on:
  - devops-ci-cd.test-automation
  feeds_into:
  - code-quality.test-coverage
