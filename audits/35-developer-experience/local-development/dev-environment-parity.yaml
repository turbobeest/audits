audit:
  id: developer-experience.local-development.dev-environment-parity
  name: Dev Environment Parity Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: developer-experience
  category_number: 35
  subcategory: local-development
  tier: expert
  estimated_duration: 3-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: development
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates how closely the local development environment matches
    production, including service versions, configurations, infrastructure
    components, and behaviors. Identifies gaps that cause "works on my
    machine" issues or missed bugs that only appear in production.
  why_it_matters: |
    Environment differences are a leading cause of production incidents.
    When local development diverges from production, bugs pass through
    testing only to fail after deployment. The Twelve-Factor App methodology
    emphasizes dev/prod parity as critical for reliable software delivery.
  when_to_run:
  - After production incidents traced to env differences
  - Before major deployments
  - When upgrading infrastructure components
  - Quarterly parity review
prerequisites:
  required_artifacts:
  - type: infrastructure_config
    description: Production and development configurations
  - type: service_versions
    description: Version information for all services
  - type: environment_docs
    description: Environment documentation
  access_requirements:
  - Development environment access
  - Production configuration read access
  - Infrastructure documentation
discovery:
  file_patterns:
  - glob: '**/docker-compose*.yml'
    purpose: Find Docker Compose configurations
  - glob: '**/Dockerfile*'
    purpose: Find Docker configurations
  - glob: '**/.env*'
    purpose: Find environment configurations
  - glob: '**/kubernetes/**'
    purpose: Find Kubernetes configurations
  - glob: '**/terraform/**'
    purpose: Find Terraform configurations
  - glob: '**/package.json'
    purpose: Check dependency versions
  interview_questions:
  - role: Developer
    questions:
    - Have you experienced 'works locally but fails in production'?
    - What differences exist between your local setup and production?
    - How do you test production-like conditions locally?
  - role: DevOps Engineer
    questions:
    - What infrastructure differences exist between environments?
    - How do you maintain environment consistency?
    - What production services are hard to replicate locally?
knowledge_sources:
  guides:
  - id: twelve-factor
    name: Twelve-Factor App - Dev/Prod Parity
    url: https://12factor.net/dev-prod-parity
  - id: testcontainers
    name: Testcontainers Documentation
    url: https://testcontainers.com/
  standards:
  - id: infrastructure-as-code
    name: Infrastructure as Code
    relevance: Consistent environment definition
tooling:
  analysis_tools:
  - tool: docker-compose
    purpose: Local service orchestration
    command: docker-compose config
  - tool: testcontainers
    purpose: Production-like test dependencies
  - tool: localstack
    purpose: Local AWS service emulation
    command: localstack start
  - tool: minikube
    purpose: Local Kubernetes
    command: minikube start
signals:
  critical:
  - id: PARITY-CRIT-001
    signal: Major version differences in core services
    evidence_indicators:
    - Different database versions
    - Different runtime versions
    - Different OS versions
    explanation: |
      Major version differences can cause behavior changes and
      bugs that only manifest in production.
    remediation: |
      Align local service versions with production. Use containers
      to ensure version consistency.
  - id: PARITY-CRIT-002
    signal: Missing critical production services locally
    evidence_indicators:
    - Message queues mocked or absent
    - Caching layers skipped
    - Search services unavailable
    explanation: |
      Missing services prevent testing of integrations and can
      mask issues until production deployment.
    remediation: |
      Use containerized versions or emulators for all production
      services. Consider LocalStack for AWS services.
  high:
  - id: PARITY-HIGH-001
    signal: Different authentication/authorization locally
    remediation: |
      Implement consistent auth mechanisms or realistic mocks
      that behave like production.
  - id: PARITY-HIGH-002
    signal: Network topology significantly different
    remediation: |
      Document and minimize network differences. Consider
      service mesh for local development.
  - id: PARITY-HIGH-003
    signal: Configuration management differs between environments
    remediation: |
      Use same configuration mechanism locally as production,
      with environment-specific values.
  medium:
  - id: PARITY-MED-001
    signal: Resource constraints not simulated locally
    remediation: |
      Configure resource limits in local containers to better
      simulate production constraints.
  - id: PARITY-MED-002
    signal: Different storage backends
    remediation: |
      Use same storage types locally or validated emulators.
  - id: PARITY-MED-003
    signal: Environment-specific feature flags
    remediation: |
      Ensure feature flag behavior is testable locally.
  low:
  - id: PARITY-LOW-001
    signal: Environment differences not documented
    remediation: |
      Document known environment differences and their impact.
  - id: PARITY-LOW-002
    signal: No automated parity checking
    remediation: |
      Implement automated checks for version and configuration drift.
  positive:
  - id: PARITY-POS-001
    signal: Containerized development matching production
  - id: PARITY-POS-002
    signal: All production services available locally
  - id: PARITY-POS-003
    signal: Automated parity verification in CI
  - id: PARITY-POS-004
    signal: Infrastructure as code shared between environments
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Production Services
    description: List all production services and their versions
    duration_estimate: 45 min
  - id: '2'
    name: Inventory Local Services
    description: List all local development services and versions
    duration_estimate: 45 min
  - id: '3'
    name: Compare Configurations
    description: Identify differences between environments
    duration_estimate: 45 min
  - id: '4'
    name: Assess Impact
    description: Evaluate risk of identified differences
    duration_estimate: 30 min
  - id: '5'
    name: Review Past Incidents
    description: Check for parity-related production issues
    duration_estimate: 30 min
output:
  deliverables:
  - type: parity_matrix
    format: structured
    sections:
    - Service version comparison
    - Configuration differences
    - Missing services
    - Risk assessment
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Environment Comparison
    - Risk Analysis
    - Recommendations
closeout_checklist:
- id: parity-001
  item: Production services inventoried
  level: ERROR
  verification: manual
- id: parity-002
  item: Local services inventoried
  level: ERROR
  verification: manual
- id: parity-003
  item: Differences documented and risk assessed
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: ISO 27001
    control: A.14.2.9
    description: System acceptance testing
relationships:
  commonly_combined:
  - developer-experience.onboarding.setup-automation
  - devops-ci-cd.environment-management
  depends_on:
  - devops-ci-cd.containerization
  feeds_into:
  - devops-ci-cd.deployment-reliability
