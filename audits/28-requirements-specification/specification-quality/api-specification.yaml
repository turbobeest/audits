audit:
  id: requirements-specification.specification-quality.api-specification
  name: API Specification Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: requirements-specification
  category_number: 28
  subcategory: specification-quality
  tier: expert
  estimated_duration: 2-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: documentation
  default_profiles:
  - full
  - requirements
  - api
description:
  what: |
    This audit examines the quality and completeness of API specifications.
    It evaluates:
    - OpenAPI/Swagger specification usage
    - Endpoint documentation completeness
    - Request/response schema definition
    - Error response documentation
    - Authentication/authorization specification
    - Versioning strategy documentation
  why_it_matters: |
    API specifications are contracts for integration:
    - Enable contract-first development
    - Support automatic client generation
    - Facilitate testing and mocking
    - Document integration requirements clearly
    - Reduce integration issues
    - Enable API governance
prerequisites:
  required_artifacts:
  - type: api_specs
    description: API specifications (OpenAPI, etc.)
  - type: api_documentation
    description: API documentation
  access_requirements:
  - Read access to API specifications
  - Access to API documentation
discovery:
  code_patterns:
  - pattern: (openapi|swagger|api-spec)
    type: regex
    scope: documentation
    purpose: Detect API specification format
  - pattern: (paths|endpoints|operations)
    type: regex
    scope: config
    purpose: Detect API definition elements
  file_patterns:
  - glob: '**/openapi*.{yaml,json}'
    purpose: OpenAPI specifications
  - glob: '**/swagger*.{yaml,json}'
    purpose: Swagger specifications
  - glob: '**/api*spec*.{yaml,json,md}'
    purpose: API specification files
  - glob: '**/api/**'
    purpose: API documentation
knowledge_sources:
  specifications:
  - id: openapi-spec
    name: OpenAPI Specification
    url: https://spec.openapis.org/oas/latest.html
    offline_cache: true
    priority: required
signals:
  critical:
  - id: APISPEC-CRIT-001
    signal: No API specifications exist
    evidence_indicators:
    - APIs without specification
    - No OpenAPI/Swagger files
    - API contracts undocumented
    remediation: |
      - Create OpenAPI specifications for all APIs
      - Document all endpoints
      - Specify request/response schemas
      - Include error responses
      - Version API specifications
  high:
  - id: APISPEC-HIGH-001
    signal: API specifications incomplete
    evidence_indicators:
    - Missing endpoints
    - Incomplete schemas
    - Error responses not documented
    remediation: |
      - Complete endpoint documentation
      - Define all schemas
      - Document error responses
      - Add examples
  - id: APISPEC-HIGH-002
    signal: API specifications not synchronized with implementation
    evidence_indicators:
    - Spec doesn't match actual API
    - Missing new endpoints
    - Schema differences
    remediation: |
      - Validate spec against implementation
      - Update spec when API changes
      - Automate spec validation
      - Use spec-first development
procedure:
  steps:
  - id: '1'
    name: API Specification Discovery
    commands:
    - purpose: Find API specifications
      command: |
        find . -type f \( -name "*openapi*" -o -name "*swagger*" \
          -o -name "*api*spec*" \) \( -name "*.yaml" -o -name "*.json" \) 2>/dev/null | head -20
  - id: '2'
    name: Specification Completeness Check
    commands:
    - purpose: Check for required elements
      command: |
        grep -rniE "(paths|components|schemas|responses|security)" \
          --include="*openapi*" --include="*swagger*" . 2>/dev/null | head -30
output:
  deliverables:
  - type: api_spec_assessment
    format: prose
closeout_checklist:
- id: apispec-001
  item: API specifications exist
  level: CRITICAL
  verification: |
    find . -type f \( -name "*openapi*" -o -name "*swagger*" \) 2>/dev/null | \
      wc -l | xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - api-service
    - microservices
    - backend
  compliance_frameworks:
  - framework: OpenAPI
    controls:
    - '3.0'
    - '3.1'
relationships:
  commonly_combined:
  - requirements-specification.specification-quality.interface-specification
  - requirements-specification.specification-quality.data-specification
