# ============================================================
# AUDIT: Air Quality Monitoring
# Category: 38 - Sensors & Physical Systems
# Subcategory: environmental-monitoring
# ============================================================

audit:
  id: "sensors-physical-systems.environmental-monitoring.air-quality-monitoring"
  name: "Air Quality Monitoring Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "environmental-monitoring"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates air quality monitoring systems including gas detection (CO, CO2, O2,
    combustibles, toxic gases), particulate monitoring, VOC detection, and air
    flow measurement. Reviews sensor placement, calibration, alarm configuration,
    and integration with ventilation systems.

  why_it_matters: |
    Air quality affects worker safety, product quality, and regulatory compliance.
    Poor air quality can cause health hazards, contaminate products, or create
    explosive atmospheres. Reliable monitoring enables early detection and
    appropriate response to air quality issues.

  when_to_run:
    - "During safety system design"
    - "After sensor replacement"
    - "During safety reviews"
    - "Before regulatory inspections"
    - "When air quality issues reported"

prerequisites:
  required_artifacts:
    - type: "sensor_specs"
      description: "Air quality sensor specifications"
    - type: "placement_docs"
      description: "Sensor placement documentation"
    - type: "calibration_records"
      description: "Gas calibration records"

  access_requirements:
    - "Physical access to sensors"
    - "Calibration gas availability"
    - "HVAC system access"
    - "Alarm system access"

discovery:
  file_patterns:
    - glob: "**/*gas*.c"
      purpose: "Find gas detection code"
    - glob: "**/*air_quality*.c"
      purpose: "Find air quality code"
    - glob: "**/*particulate*.c"
      purpose: "Find particulate code"
    - glob: "**/config/*detector*.yaml"
      purpose: "Find detector configuration"

knowledge_sources:
  guides:
    - id: "gas-detection"
      name: "Gas Detection Handbook"
      url: "https://www.msasafety.com/"
    - id: "iaq-guide"
      name: "Indoor Air Quality Guide"
      url: "https://www.ashrae.org/"

  standards:
    - id: "iec-60079"
      name: "IEC 60079 Explosive Atmospheres"
      relevance: "Hazardous area equipment"
    - id: "isa-92"
      name: "ISA 92 Gas Detectors"
      relevance: "Gas detector installation"
    - id: "osha-1910"
      name: "OSHA 29 CFR 1910"
      relevance: "Workplace safety standards"

tooling:
  analysis_tools:
    - tool: "calibration-gas"
      purpose: "Sensor calibration"
    - tool: "bump-test-kit"
      purpose: "Functional verification"
    - tool: "particle-counter"
      purpose: "Particulate reference"
    - tool: "air-flow-meter"
      purpose: "Ventilation verification"

signals:
  critical:
    - id: "SPS-AIR-CRIT-001"
      signal: "Gas detection system not responding to hazardous levels"
      evidence_indicators:
        - "Bump test failure"
        - "Sensor response degraded"
        - "Calibration drift exceeds limits"
      explanation: |
        Gas detectors must respond reliably to hazardous concentrations.
        A non-responsive detector leaves personnel unprotected from toxic
        or combustible atmospheres, potentially causing injury or death.
      remediation: "Replace or recalibrate detector immediately"

    - id: "SPS-AIR-CRIT-002"
      signal: "Oxygen monitoring failure in confined space"
      evidence_indicators:
        - "O2 sensor failed"
        - "Oxygen-deficient atmosphere undetected"
        - "No redundant monitoring"
      explanation: |
        Oxygen-deficient atmospheres can cause unconsciousness within seconds.
        Reliable oxygen monitoring is essential for confined space safety.
      remediation: "Replace sensor, implement redundancy"

  high:
    - id: "SPS-AIR-HIGH-001"
      signal: "Detector placement not optimal"
      evidence_indicators:
        - "Sensors not near potential sources"
        - "Height incorrect for gas density"
        - "Air flow patterns not considered"
      remediation: "Relocate sensors per standards and gas properties"

    - id: "SPS-AIR-HIGH-002"
      signal: "Alarm setpoints inappropriate"
      evidence_indicators:
        - "Setpoints above exposure limits"
        - "No pre-alarm warning"
        - "Insufficient response time"
      remediation: "Configure alarms per exposure limits and standards"

  medium:
    - id: "SPS-AIR-MED-001"
      signal: "Calibration frequency inadequate"
      evidence_indicators:
        - "Calibration interval too long"
        - "Drift between calibrations"
        - "No bump test program"
      remediation: "Implement appropriate calibration and bump test schedule"

    - id: "SPS-AIR-MED-002"
      signal: "Cross-sensitivity not addressed"
      evidence_indicators:
        - "Interfering gases present"
        - "False alarms from cross-sensitivity"
        - "Readings affected by other substances"
      remediation: "Select appropriate sensor technology or implement filtering"

  low:
    - id: "SPS-AIR-LOW-001"
      signal: "Air quality monitoring not documented"
      evidence_indicators:
        - "Detection points not mapped"
        - "Sensor types not recorded"
        - "Alarm logic not documented"
      remediation: "Document air quality monitoring system"

    - id: "SPS-AIR-LOW-002"
      signal: "No air quality trending"
      evidence_indicators:
        - "Historical data not retained"
        - "Patterns not analyzed"
        - "No baseline established"
      remediation: "Implement air quality trending"

  positive:
    - id: "SPS-AIR-POS-001"
      signal: "Comprehensive gas detection coverage"
      evidence_indicators:
        - "All hazards covered"
        - "Proper sensor selection"
        - "Adequate detection points"

    - id: "SPS-AIR-POS-002"
      signal: "Integrated safety response"
      evidence_indicators:
        - "Automatic ventilation response"
        - "Integrated alarm notification"
        - "Emergency procedures linked"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Air Quality Sensors"
      description: "Catalog all detectors and monitors"
      duration_estimate: "30 min"

    - id: "2"
      name: "Review Hazard Assessment"
      description: "Verify detection matches hazards"
      duration_estimate: "30 min"

    - id: "3"
      name: "Assess Sensor Placement"
      description: "Evaluate detector locations"
      duration_estimate: "45 min"

    - id: "4"
      name: "Verify Calibration"
      description: "Check calibration and bump test status"
      duration_estimate: "60 min"

    - id: "5"
      name: "Test Alarm Response"
      description: "Verify alarm operation and response"
      duration_estimate: "45 min"

    - id: "6"
      name: "Review Integration"
      description: "Check HVAC and safety system integration"
      duration_estimate: "30 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Detection Coverage"
        - "Calibration Assessment"
        - "Safety Integration"
        - "Recommendations"

closeout_checklist:
  - id: "sps-air-001"
    item: "All detectors functional and calibrated"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-air-002"
    item: "Alarm setpoints verified"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-air-003"
    item: "Placement verified"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["industrial-facilities", "laboratories", "oil-gas", "confined-spaces"]

  compliance_mappings:
    - framework: "OSHA"
      control: "29 CFR 1910"
      description: "Workplace safety"
    - framework: "IEC 60079"
      control: "Explosive Atmospheres"
      description: "Hazardous area equipment"
    - framework: "NFPA 72"
      control: "Fire Alarm Code"
      description: "Detection requirements"

relationships:
  commonly_combined:
    - "sensors-physical-systems.safety-systems.emergency-ventilation"
    - "sensors-physical-systems.environmental-monitoring.hvac-monitoring"
  depends_on:
    - "sensors-physical-systems.sensor-integration.sensor-calibration"
  feeds_into:
    - "safety.gas-hazard-response"
    - "compliance.environmental-compliance"
