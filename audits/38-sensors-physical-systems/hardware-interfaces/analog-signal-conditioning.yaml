# ============================================================
# AUDIT: Analog Signal Conditioning
# Category: 38 - Sensors & Physical Systems
# Subcategory: hardware-interfaces
# ============================================================

audit:
  id: "sensors-physical-systems.hardware-interfaces.analog-signal-conditioning"
  name: "Analog Signal Conditioning Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "hardware-interfaces"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Reviews analog signal conditioning circuits including amplification, filtering,
    isolation, linearization, and protection. Evaluates signal chain design for
    various sensor types (thermocouples, RTDs, strain gauges, 4-20mA loops) and
    verifies proper matching to ADC requirements.

  why_it_matters: |
    Signal conditioning directly affects measurement accuracy and reliability.
    Improper conditioning can introduce errors, limit dynamic range, fail to
    reject noise, or damage input circuits. Correct design is essential for
    accurate sensor measurements.

  when_to_run:
    - "During hardware design reviews"
    - "When accuracy issues occur"
    - "After sensor changes"
    - "Before production release"
    - "During calibration reviews"

prerequisites:
  required_artifacts:
    - type: "schematic"
      description: "Signal conditioning circuit schematic"
    - type: "sensor_specs"
      description: "Sensor specifications"
    - type: "accuracy_requirements"
      description: "Measurement accuracy requirements"

  access_requirements:
    - "Access to analog circuits"
    - "Precision test equipment"
    - "Calibration sources"
    - "Temperature testing capability"

discovery:
  file_patterns:
    - glob: "**/analog/**"
      purpose: "Find analog circuit documentation"
    - glob: "**/*signal*.c"
      purpose: "Find signal processing code"
    - glob: "**/hardware/*.pdf"
      purpose: "Find hardware documentation"
    - glob: "**/calibration/**"
      purpose: "Find calibration data"

knowledge_sources:
  guides:
    - id: "signal-conditioning"
      name: "Signal Conditioning Fundamentals"
      url: "https://www.analog.com/"
    - id: "sensor-interfacing"
      name: "Sensor Interfacing Guide"
      url: "https://www.ti.com/"

  standards:
    - id: "iec-60751"
      name: "IEC 60751 RTD Standards"
      relevance: "RTD specifications"
    - id: "iec-60584"
      name: "IEC 60584 Thermocouple Standards"
      relevance: "Thermocouple specifications"
    - id: "iec-61326"
      name: "IEC 61326 EMC for Measurement"
      relevance: "EMC requirements"

tooling:
  analysis_tools:
    - tool: "precision-multimeter"
      purpose: "Accuracy measurement"
    - tool: "oscilloscope"
      purpose: "Signal analysis"
    - tool: "calibrator"
      purpose: "Signal source generation"
    - tool: "spectrum-analyzer"
      purpose: "Noise analysis"

signals:
  critical:
    - id: "SPS-ASC-CRIT-001"
      signal: "Signal conditioning introduces measurement errors exceeding tolerance"
      evidence_indicators:
        - "Gain error exceeds specification"
        - "Offset drift uncompensated"
        - "Nonlinearity exceeds requirement"
      explanation: |
        Signal conditioning errors directly affect measurement accuracy. If
        conditioning errors exceed tolerance, all downstream measurements and
        decisions based on them will be incorrect.
      remediation: "Redesign or calibrate signal conditioning to meet accuracy requirements"

    - id: "SPS-ASC-CRIT-002"
      signal: "Input protection inadequate"
      evidence_indicators:
        - "Inputs unprotected from overvoltage"
        - "ESD protection missing"
        - "Damage from fault conditions"
      explanation: |
        Analog inputs can be damaged by overvoltage, static discharge, or fault
        conditions. Damaged inputs may fail completely or cause subtle measurement
        errors.
      remediation: "Implement appropriate input protection"

  high:
    - id: "SPS-ASC-HIGH-001"
      signal: "Signal chain bandwidth/filtering inadequate"
      evidence_indicators:
        - "Aliasing in measurements"
        - "Filter cutoff inappropriate"
        - "Signal distortion observed"
      remediation: "Design appropriate filtering for signal bandwidth"

    - id: "SPS-ASC-HIGH-002"
      signal: "Common-mode rejection insufficient"
      evidence_indicators:
        - "CMRR below requirements"
        - "Ground loop interference"
        - "Noise on differential inputs"
      remediation: "Improve common-mode rejection through design improvements"

  medium:
    - id: "SPS-ASC-MED-001"
      signal: "Temperature compensation inadequate"
      evidence_indicators:
        - "Drift with temperature"
        - "No cold junction compensation"
        - "Reference drift uncorrected"
      remediation: "Implement proper temperature compensation"

    - id: "SPS-ASC-MED-002"
      signal: "Signal range not optimized for ADC"
      evidence_indicators:
        - "ADC range underutilized"
        - "Clipping at extremes"
        - "Resolution wasted"
      remediation: "Scale signals to use full ADC range"

  low:
    - id: "SPS-ASC-LOW-001"
      signal: "Signal conditioning design not documented"
      evidence_indicators:
        - "Design calculations missing"
        - "Component selection not justified"
        - "Transfer function not documented"
      remediation: "Document signal conditioning design"

    - id: "SPS-ASC-LOW-002"
      signal: "No self-test capability"
      evidence_indicators:
        - "No reference input test"
        - "Cannot verify channel operation"
        - "Failures not detectable"
      remediation: "Implement self-test for signal channels"

  positive:
    - id: "SPS-ASC-POS-001"
      signal: "Signal conditioning verified through testing"
      evidence_indicators:
        - "Full-scale accuracy verified"
        - "Temperature performance documented"
        - "Noise performance characterized"

    - id: "SPS-ASC-POS-002"
      signal: "Comprehensive input protection implemented"
      evidence_indicators:
        - "Overvoltage protection"
        - "ESD protection"
        - "Isolation where required"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Design Documentation"
      description: "Understand signal conditioning design"
      duration_estimate: "45 min"

    - id: "2"
      name: "Verify Circuit Implementation"
      description: "Check circuit matches design"
      duration_estimate: "30 min"

    - id: "3"
      name: "Measure Transfer Function"
      description: "Characterize gain, offset, linearity"
      duration_estimate: "60 min"

    - id: "4"
      name: "Test Noise Performance"
      description: "Measure noise and CMRR"
      duration_estimate: "45 min"

    - id: "5"
      name: "Evaluate Protection"
      description: "Verify input protection adequacy"
      duration_estimate: "30 min"

    - id: "6"
      name: "Test Temperature Effects"
      description: "Characterize temperature performance"
      duration_estimate: "45 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Design Review"
        - "Performance Characterization"
        - "Protection Assessment"
        - "Recommendations"

closeout_checklist:
  - id: "sps-asc-001"
    item: "Accuracy meets requirements"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-asc-002"
    item: "Input protection verified"
    level: "WARNING"
    verification: "manual"

  - id: "sps-asc-003"
    item: "Temperature performance documented"
    level: "INFO"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["instrumentation", "industrial-automation", "medical-devices", "test-equipment"]

  compliance_mappings:
    - framework: "IEC 61326"
      control: "EMC Requirements"
      description: "Measurement equipment EMC"
    - framework: "IEC 61010"
      control: "Safety Requirements"
      description: "Measurement equipment safety"
    - framework: "FDA 21 CFR Part 820"
      control: "820.30"
      description: "Design controls"

relationships:
  commonly_combined:
    - "sensors-physical-systems.data-acquisition.adc-resolution-accuracy"
    - "sensors-physical-systems.data-acquisition.noise-interference-mitigation"
  depends_on:
    - "hardware.analog-design"
  feeds_into:
    - "sensors-physical-systems.sensor-integration.sensor-calibration"
    - "measurement.accuracy-verification"
