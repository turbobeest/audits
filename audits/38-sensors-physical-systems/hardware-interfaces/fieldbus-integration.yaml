# ============================================================
# AUDIT: Fieldbus Integration
# Category: 38 - Sensors & Physical Systems
# Subcategory: hardware-interfaces
# ============================================================

audit:
  id: "sensors-physical-systems.hardware-interfaces.fieldbus-integration"
  name: "Fieldbus Integration Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "hardware-interfaces"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates industrial fieldbus implementations including PROFIBUS, PROFINET,
    EtherNet/IP, Modbus TCP/RTU, EtherCAT, and HART. Reviews protocol configuration,
    network diagnostics, determinism, device integration, and interoperability
    with control systems.

  why_it_matters: |
    Fieldbus networks connect sensors, actuators, and controllers in industrial
    systems. Proper integration ensures reliable real-time communication,
    deterministic response times, and seamless interoperability required for
    safe and efficient plant operation.

  when_to_run:
    - "During automation system design"
    - "When integrating new devices"
    - "After network changes"
    - "During commissioning"
    - "When communication issues occur"

prerequisites:
  required_artifacts:
    - type: "network_design"
      description: "Fieldbus network design documentation"
    - type: "gsd_eds_files"
      description: "Device description files"
    - type: "plc_config"
      description: "PLC/controller configuration"

  access_requirements:
    - "Access to fieldbus network"
    - "Protocol analyzer access"
    - "PLC programming access"
    - "Device configuration access"

discovery:
  file_patterns:
    - glob: "**/*profibus*.c"
      purpose: "Find PROFIBUS code"
    - glob: "**/*profinet*.c"
      purpose: "Find PROFINET code"
    - glob: "**/*ethercat*.c"
      purpose: "Find EtherCAT code"
    - glob: "**/*.gsd"
      purpose: "Find PROFIBUS GSD files"
    - glob: "**/*.eds"
      purpose: "Find EDS files"

knowledge_sources:
  guides:
    - id: "profibus-guide"
      name: "PROFIBUS Design Guidelines"
      url: "https://www.profibus.com/"
    - id: "profinet-guide"
      name: "PROFINET Design Guidelines"
      url: "https://www.profinet.com/"

  standards:
    - id: "iec-61158"
      name: "IEC 61158 Fieldbus Standards"
      relevance: "Industrial fieldbus protocols"
    - id: "iec-61784"
      name: "IEC 61784 Communication Profiles"
      relevance: "Fieldbus profiles"
    - id: "iec-62443"
      name: "IEC 62443 Industrial Security"
      relevance: "Industrial network security"

tooling:
  analysis_tools:
    - tool: "fieldbus-analyzer"
      purpose: "Protocol analysis"
    - tool: "network-tester"
      purpose: "Network verification"
    - tool: "device-configurator"
      purpose: "Device configuration"
    - tool: "timing-analyzer"
      purpose: "Cycle time measurement"

signals:
  critical:
    - id: "SPS-FLD-CRIT-001"
      signal: "Fieldbus cycle time exceeds control requirements"
      evidence_indicators:
        - "Cycle time too long for control loop"
        - "Jitter affects control stability"
        - "Determinism not achieved"
      explanation: |
        Control systems require deterministic communication with bounded
        cycle times. Exceeding these requirements can cause control loop
        instability or safety system timing violations.
      remediation: "Optimize network configuration or upgrade to faster protocol"

    - id: "SPS-FLD-CRIT-002"
      signal: "Safety device communication failures"
      evidence_indicators:
        - "Safety devices dropping offline"
        - "Safety communication timeouts"
        - "PROFIsafe/CIP Safety errors"
      explanation: |
        Safety fieldbus communication (PROFIsafe, CIP Safety, FSoE) must
        maintain strict reliability and timing. Failures can cause safety
        system trips or, worse, undetected dangerous conditions.
      remediation: "Diagnose and resolve safety communication issues"

  high:
    - id: "SPS-FLD-HIGH-001"
      signal: "Device configuration mismatches"
      evidence_indicators:
        - "GSD/EDS version mismatch"
        - "Parameter settings incorrect"
        - "Device not operating as expected"
      remediation: "Update device configurations and verify settings"

    - id: "SPS-FLD-HIGH-002"
      signal: "Network diagnostics ignored"
      evidence_indicators:
        - "Diagnostic alarms not monitored"
        - "Error counters not tracked"
        - "Degradation not detected"
      remediation: "Implement comprehensive diagnostic monitoring"

  medium:
    - id: "SPS-FLD-MED-001"
      signal: "Network documentation incomplete"
      evidence_indicators:
        - "Device addresses not documented"
        - "Network topology not recorded"
        - "Configuration changes not tracked"
      remediation: "Complete network documentation"

    - id: "SPS-FLD-MED-002"
      signal: "Spare capacity insufficient"
      evidence_indicators:
        - "No room for additional devices"
        - "Cycle time near limit"
        - "Bandwidth exhausted"
      remediation: "Plan for network expansion capacity"

  low:
    - id: "SPS-FLD-LOW-001"
      signal: "Fieldbus firmware not current"
      evidence_indicators:
        - "Old firmware versions"
        - "Known issues not patched"
        - "New features unavailable"
      remediation: "Update fieldbus device firmware"

    - id: "SPS-FLD-LOW-002"
      signal: "No standardized naming conventions"
      evidence_indicators:
        - "Inconsistent device names"
        - "Tag naming not standardized"
        - "Configuration confusing"
      remediation: "Implement naming standards"

  positive:
    - id: "SPS-FLD-POS-001"
      signal: "Deterministic communication verified"
      evidence_indicators:
        - "Cycle times meet requirements"
        - "Jitter within specification"
        - "Timing margins documented"

    - id: "SPS-FLD-POS-002"
      signal: "Comprehensive network diagnostics"
      evidence_indicators:
        - "All errors monitored"
        - "Proactive alerting"
        - "Performance trending"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Network Architecture"
      description: "Understand fieldbus network design"
      duration_estimate: "45 min"

    - id: "2"
      name: "Verify Device Configuration"
      description: "Check all device configurations"
      duration_estimate: "60 min"

    - id: "3"
      name: "Measure Timing Performance"
      description: "Verify cycle time and determinism"
      duration_estimate: "45 min"

    - id: "4"
      name: "Test Communication Integrity"
      description: "Verify error-free communication"
      duration_estimate: "45 min"

    - id: "5"
      name: "Review Diagnostic Handling"
      description: "Assess diagnostic monitoring"
      duration_estimate: "30 min"

    - id: "6"
      name: "Verify Safety Communication"
      description: "Test safety protocol operation"
      duration_estimate: "45 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Network Architecture Review"
        - "Timing Analysis"
        - "Device Configuration Assessment"
        - "Recommendations"

closeout_checklist:
  - id: "sps-fld-001"
    item: "Cycle time meets requirements"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-fld-002"
    item: "Safety communication verified"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-fld-003"
    item: "Diagnostic monitoring in place"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["industrial-automation", "process-control", "manufacturing", "building-automation"]

  compliance_mappings:
    - framework: "IEC 61158"
      control: "Fieldbus Protocol"
      description: "Industrial fieldbus compliance"
    - framework: "IEC 61784"
      control: "Communication Profile"
      description: "Fieldbus profile compliance"
    - framework: "IEC 62443"
      control: "SR 5.1"
      description: "Network segmentation"

relationships:
  commonly_combined:
    - "sensors-physical-systems.sensor-integration.sensor-network-topology"
    - "sensors-physical-systems.safety-systems.safety-communication"
  depends_on:
    - "infrastructure.network-infrastructure"
  feeds_into:
    - "control-systems.plc-integration"
    - "reliability.communication-reliability"
