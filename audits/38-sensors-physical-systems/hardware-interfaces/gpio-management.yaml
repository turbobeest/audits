audit:
  id: sensors-physical-systems.hardware-interfaces.gpio-management
  name: GPIO Management Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: sensors-physical-systems
  category_number: 38
  subcategory: hardware-interfaces
  tier: expert
  estimated_duration: 3-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: physical-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews GPIO (General Purpose Input/Output) configuration and management
    including pin direction, pull-up/pull-down configuration, drive strength,
    interrupt handling, debouncing, state persistence, and conflict detection.
    Assesses safety of GPIO usage for control outputs and sensor inputs.
  why_it_matters: |
    Incorrect GPIO configuration can cause hardware damage, safety hazards,
    or unreliable sensor/actuator behavior. Proper GPIO management ensures
    predictable behavior during initialization, operation, and fault conditions.
  when_to_run:
  - During embedded system design
  - When GPIO-related issues occur
  - After hardware changes
  - Before production release
  - During safety reviews
prerequisites:
  required_artifacts:
  - type: schematic
    description: System schematic showing GPIO connections
  - type: gpio_config
    description: GPIO configuration code/documentation
  - type: pin_mapping
    description: Pin mapping documentation
  access_requirements:
  - Access to GPIO configuration code
  - Physical access for signal verification
  - Schematic documentation
  - Test equipment access
discovery:
  file_patterns:
  - glob: '**/*gpio*.c'
    purpose: Find GPIO driver code
  - glob: '**/pin*.c'
    purpose: Find pin configuration code
  - glob: '**/board/*.c'
    purpose: Find board initialization
  - glob: '**/config/*gpio*.yaml'
    purpose: Find GPIO configuration
knowledge_sources:
  guides:
  - id: gpio-design
    name: GPIO Design Guidelines
    url: https://www.arm.com/
  - id: embedded-gpio
    name: Embedded GPIO Best Practices
    url: https://www.embedded.com/
  standards:
  - id: iec-61508
    name: IEC 61508 Functional Safety
    relevance: Safety-related I/O requirements
  - id: iso-26262
    name: ISO 26262 Automotive
    relevance: Automotive I/O requirements
tooling:
  analysis_tools:
  - tool: logic-analyzer
    purpose: GPIO state monitoring
  - tool: oscilloscope
    purpose: Signal quality verification
  - tool: multimeter
    purpose: Voltage level verification
  - tool: gpio-test-framework
    purpose: Automated GPIO testing
signals:
  critical:
  - id: SPS-GPIO-CRIT-001
    signal: Safety output GPIO misconfigured
    evidence_indicators:
    - Safety output in wrong state at startup
    - Output direction set incorrectly
    - Fail-safe state not enforced
    explanation: |
      Safety outputs control critical functions like emergency stops or
      interlocks. Incorrect configuration can prevent safety systems from
      operating correctly, creating hazardous conditions.
    remediation: Correct GPIO configuration ensuring fail-safe states
  - id: SPS-GPIO-CRIT-002
    signal: GPIO conflict causes hardware damage risk
    evidence_indicators:
    - Multiple outputs driving same line
    - Incorrect voltage level connection
    - Current limits exceeded
    explanation: |
      GPIO conflicts can cause excessive current flow, damaging the
      microcontroller, connected devices, or both. This can also create
      fire hazards.
    remediation: Resolve GPIO conflicts and add protection
  high:
  - id: SPS-GPIO-HIGH-001
    signal: GPIO initial state undefined or incorrect
    evidence_indicators:
    - Outputs glitch during startup
    - Initial state not deterministic
    - Startup sequence not controlled
    remediation: Define and enforce deterministic startup states
  - id: SPS-GPIO-HIGH-002
    signal: Input debouncing not implemented
    evidence_indicators:
    - Switch inputs not debounced
    - Multiple interrupts from single press
    - Contact bounce affecting readings
    remediation: Implement appropriate debouncing
  medium:
  - id: SPS-GPIO-MED-001
    signal: Pull-up/pull-down configuration incorrect
    evidence_indicators:
    - Floating inputs possible
    - Unnecessary current consumption
    - Noise susceptibility
    remediation: Configure appropriate pull resistors
  - id: SPS-GPIO-MED-002
    signal: GPIO interrupt handling issues
    evidence_indicators:
    - Interrupt storms possible
    - Missed interrupts
    - Race conditions in handlers
    remediation: Improve interrupt handling robustness
  low:
  - id: SPS-GPIO-LOW-001
    signal: GPIO allocation not documented
    evidence_indicators:
    - Pin assignments not recorded
    - Function descriptions missing
    - Conflicts hard to identify
    remediation: Document complete GPIO allocation
  - id: SPS-GPIO-LOW-002
    signal: Unused GPIOs not configured
    evidence_indicators:
    - Unused pins left floating
    - Default configuration used
    - EMI susceptibility
    remediation: Configure all GPIOs including unused
  positive:
  - id: SPS-GPIO-POS-001
    signal: Comprehensive GPIO configuration management
    evidence_indicators:
    - All pins documented
    - Conflict detection implemented
    - Startup sequence controlled
  - id: SPS-GPIO-POS-002
    signal: GPIO state monitoring implemented
    evidence_indicators:
    - Output state verification
    - Input state logging
    - Anomaly detection
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review GPIO Allocation
    description: Verify all GPIO assignments
    duration_estimate: 30 min
  - id: '2'
    name: Verify Configuration
    description: Check direction, pull, and drive settings
    duration_estimate: 30 min
  - id: '3'
    name: Test Startup Behavior
    description: Verify initialization sequence
    duration_estimate: 30 min
  - id: '4'
    name: Check Input Handling
    description: Verify debouncing and interrupt handling
    duration_estimate: 30 min
  - id: '5'
    name: Verify Safety Outputs
    description: Test safety-related GPIO behavior
    duration_estimate: 30 min
  - id: '6'
    name: Check for Conflicts
    description: Identify potential GPIO conflicts
    duration_estimate: 20 min
  - id: '7'
    name: Document Findings
    description: Compile findings and recommendations
    duration_estimate: 15 min
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - GPIO Allocation Review
    - Configuration Assessment
    - Safety Analysis
    - Recommendations
closeout_checklist:
- id: sps-gpio-001
  item: Safety GPIOs correctly configured
  level: CRITICAL
  verification: manual
- id: sps-gpio-002
  item: No GPIO conflicts present
  level: WARNING
  verification: manual
- id: sps-gpio-003
  item: Startup states verified
  level: INFO
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - iot-systems
    - industrial-automation
    - consumer-electronics
  compliance_mappings:
  - framework: IEC 61508
    control: 7.4.5
    description: Input/output requirements
  - framework: ISO 26262
    control: Part 5
    description: Hardware design requirements
  - framework: UL 991
    control: Software Safety
    description: Safety-related software
relationships:
  commonly_combined:
  - sensors-physical-systems.safety-systems.interlock-verification
  - sensors-physical-systems.actuator-control.output-verification
  depends_on:
  - hardware.board-design
  feeds_into:
  - sensors-physical-systems.safety-systems.fail-safe-modes
  - reliability.hardware-reliability
