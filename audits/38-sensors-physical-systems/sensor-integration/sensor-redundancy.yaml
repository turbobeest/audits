# ============================================================
# AUDIT: Sensor Redundancy
# Category: 38 - Sensors & Physical Systems
# Subcategory: sensor-integration
# ============================================================

audit:
  id: "sensors-physical-systems.sensor-integration.sensor-redundancy"
  name: "Sensor Redundancy Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "sensor-integration"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  requires_physical_access: true
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates sensor redundancy architectures, voting schemes, fault tolerance
    mechanisms, and failover procedures. Reviews redundancy configurations
    including dual redundancy, triple modular redundancy (TMR), and diverse
    redundancy. Assesses common-cause failure mitigation and redundancy
    management logic.

  why_it_matters: |
    Redundancy is essential for safety-critical and high-availability systems.
    Proper redundancy design enables continued operation despite sensor failures
    and supports fault detection through cross-checking. Inadequate redundancy
    can result in single points of failure that compromise system safety.

  when_to_run:
    - "During safety architecture design"
    - "Before safety certification"
    - "After system modifications"
    - "During FMEA/FMECA reviews"
    - "When availability requirements change"

prerequisites:
  required_artifacts:
    - type: "safety_architecture"
      description: "System safety architecture documentation"
    - type: "redundancy_design"
      description: "Redundancy scheme documentation"
    - type: "fmea_fmeca"
      description: "Failure mode analysis documentation"

  access_requirements:
    - "Access to redundancy management code"
    - "Access to voting logic implementation"
    - "Ability to simulate sensor failures"
    - "Access to safety analysis documentation"

discovery:
  file_patterns:
    - glob: "**/redundancy/**"
      purpose: "Find redundancy management code"
    - glob: "**/*voting*.c"
      purpose: "Find voting logic code"
    - glob: "**/*failover*.c"
      purpose: "Find failover handling code"
    - glob: "**/safety/**"
      purpose: "Find safety-related code"

knowledge_sources:
  guides:
    - id: "iec-61508-6"
      name: "IEC 61508-6 Redundancy Guidelines"
      url: "https://www.iec.ch/"
    - id: "fault-tolerant-systems"
      name: "Fault-Tolerant Systems Design"
      url: "https://www.sciencedirect.com/"

  standards:
    - id: "iec-61508"
      name: "IEC 61508 Functional Safety"
      relevance: "Safety redundancy requirements"
    - id: "iso-26262"
      name: "ISO 26262 Automotive"
      relevance: "Automotive redundancy requirements"
    - id: "do-178c"
      name: "DO-178C Avionics Software"
      relevance: "Aviation redundancy requirements"

tooling:
  analysis_tools:
    - tool: "fault-injection"
      purpose: "Test redundancy response"
    - tool: "fmea-tool"
      purpose: "Failure mode analysis"
    - tool: "reliability-modeling"
      purpose: "Redundancy effectiveness calculation"
    - tool: "safety-analysis"
      purpose: "Safety assessment"

signals:
  critical:
    - id: "SPS-RED-CRIT-001"
      signal: "Safety-critical function lacks required redundancy"
      evidence_indicators:
        - "Single sensor for safety function"
        - "Redundancy level below SIL requirement"
        - "No fault tolerance for critical measurements"
      explanation: |
        IEC 61508 and similar standards specify redundancy requirements based
        on Safety Integrity Level. Insufficient redundancy means a single
        sensor failure can cause a dangerous situation.
      remediation: "Implement redundancy meeting SIL requirements"

    - id: "SPS-RED-CRIT-002"
      signal: "Common-cause failures not mitigated"
      evidence_indicators:
        - "Identical sensors used for redundancy"
        - "Same power supply for redundant sensors"
        - "Same environmental exposure"
      explanation: |
        Common-cause failures can defeat redundancy by causing all channels
        to fail simultaneously. Diversity in sensors, power, and installation
        is essential for effective redundancy.
      remediation: "Implement diverse redundancy with common-cause mitigation"

  high:
    - id: "SPS-RED-HIGH-001"
      signal: "Voting logic errors possible"
      evidence_indicators:
        - "Incorrect majority voting implementation"
        - "Threshold selection inappropriate"
        - "Race conditions in voting"
      remediation: "Review and correct voting logic implementation"

    - id: "SPS-RED-HIGH-002"
      signal: "Degraded operation not properly managed"
      evidence_indicators:
        - "System continues normally after channel failure"
        - "No notification of reduced redundancy"
        - "Recovery not attempted"
      remediation: "Implement proper degraded mode handling and notification"

  medium:
    - id: "SPS-RED-MED-001"
      signal: "Redundancy testing inadequate"
      evidence_indicators:
        - "Failover not periodically tested"
        - "All failure combinations not tested"
        - "Recovery not verified"
      remediation: "Implement comprehensive redundancy testing"

    - id: "SPS-RED-MED-002"
      signal: "Redundancy status not visible"
      evidence_indicators:
        - "Channel health not displayed"
        - "Operators unaware of failures"
        - "No redundancy dashboard"
      remediation: "Implement redundancy status monitoring and display"

  low:
    - id: "SPS-RED-LOW-001"
      signal: "Redundancy architecture not documented"
      evidence_indicators:
        - "Voting scheme not specified"
        - "Failure response not documented"
        - "Common-cause analysis missing"
      remediation: "Document redundancy architecture completely"

    - id: "SPS-RED-LOW-002"
      signal: "Redundancy maintenance procedures incomplete"
      evidence_indicators:
        - "Channel repair procedures missing"
        - "Testing after repair not specified"
        - "Spare parts not identified"
      remediation: "Develop complete maintenance procedures"

  positive:
    - id: "SPS-RED-POS-001"
      signal: "Diverse redundancy with common-cause mitigation"
      evidence_indicators:
        - "Different sensor types used"
        - "Independent power supplies"
        - "Physical separation maintained"

    - id: "SPS-RED-POS-002"
      signal: "Comprehensive redundancy monitoring and testing"
      evidence_indicators:
        - "Continuous cross-checking"
        - "Regular failover testing"
        - "Complete status visibility"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Redundancy Requirements"
      description: "Understand required redundancy levels from safety analysis"
      duration_estimate: "30 min"

    - id: "2"
      name: "Assess Redundancy Architecture"
      description: "Review redundancy design against requirements"
      duration_estimate: "60 min"

    - id: "3"
      name: "Analyze Common-Cause Failures"
      description: "Review common-cause failure mitigation"
      duration_estimate: "45 min"

    - id: "4"
      name: "Review Voting Logic"
      description: "Verify voting implementation correctness"
      duration_estimate: "45 min"

    - id: "5"
      name: "Test Failover Behavior"
      description: "Inject failures and verify response"
      duration_estimate: "60 min"

    - id: "6"
      name: "Verify Degraded Operation"
      description: "Assess behavior with reduced redundancy"
      duration_estimate: "30 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Redundancy Architecture Assessment"
        - "Common-Cause Analysis"
        - "Voting Logic Review"
        - "Recommendations"

closeout_checklist:
  - id: "sps-red-001"
    item: "Redundancy meets SIL requirements"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-red-002"
    item: "Common-cause failures mitigated"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-red-003"
    item: "Failover tested and verified"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["safety-critical-systems", "industrial-automation", "automotive-systems", "aviation-systems"]

  compliance_mappings:
    - framework: "IEC 61508"
      control: "7.4.3"
      description: "Architectural requirements"
    - framework: "ISO 26262"
      control: "Part 4"
      description: "Product development at system level"
    - framework: "DO-178C"
      control: "Section 2"
      description: "System aspects of software"

relationships:
  commonly_combined:
    - "sensors-physical-systems.safety-systems.fail-safe-modes"
    - "sensors-physical-systems.sensor-integration.sensor-health-monitoring"
  depends_on:
    - "safety.safety-requirements"
  feeds_into:
    - "reliability.system-availability"
    - "safety.safety-certification"
