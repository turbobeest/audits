# ============================================================
# AUDIT: Sensor Health Monitoring
# Category: 38 - Sensors & Physical Systems
# Subcategory: sensor-integration
# ============================================================

audit:
  id: "sensors-physical-systems.sensor-integration.sensor-health-monitoring"
  name: "Sensor Health Monitoring Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "sensor-integration"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  requires_physical_access: true
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates sensor health monitoring capabilities including built-in self-test
    (BIST) features, diagnostic data collection, fault detection mechanisms,
    degradation monitoring, and predictive maintenance indicators. Reviews how
    sensor failures are detected, reported, and handled.

  why_it_matters: |
    Undetected sensor failures can lead to incorrect system behavior, safety
    incidents, or quality issues. Proactive health monitoring enables predictive
    maintenance, reduces unplanned downtime, and ensures sensor data reliability
    throughout the operational lifecycle.

  when_to_run:
    - "During system design reviews"
    - "After sensor integration"
    - "When implementing monitoring dashboards"
    - "During reliability assessments"
    - "After sensor failures occur"

prerequisites:
  required_artifacts:
    - type: "sensor_datasheets"
      description: "Sensor specifications with diagnostic features"
    - type: "firmware_source"
      description: "Sensor interface firmware code"
    - type: "monitoring_config"
      description: "Health monitoring configuration"

  access_requirements:
    - "Access to sensor diagnostic interfaces"
    - "Access to monitoring systems"
    - "Access to historical sensor data"
    - "Firmware debugging capabilities"

discovery:
  file_patterns:
    - glob: "**/diagnostics/**"
      purpose: "Find diagnostic code"
    - glob: "**/*health*.c"
      purpose: "Find health monitoring code"
    - glob: "**/*bist*.c"
      purpose: "Find built-in self-test code"
    - glob: "**/monitoring/*.yaml"
      purpose: "Find monitoring configuration"

knowledge_sources:
  guides:
    - id: "iec-61508-7"
      name: "IEC 61508-7 Techniques and Measures"
      url: "https://www.iec.ch/"
    - id: "predictive-maintenance"
      name: "ISO 13381 Condition Monitoring"
      url: "https://www.iso.org/"

  standards:
    - id: "iec-61508"
      name: "IEC 61508 Functional Safety"
      relevance: "Diagnostic coverage requirements"
    - id: "iso-13374"
      name: "ISO 13374 Condition Monitoring"
      relevance: "Data processing architecture"

tooling:
  analysis_tools:
    - tool: "oscilloscope"
      purpose: "Signal quality analysis"
    - tool: "data-historian"
      purpose: "Historical trend analysis"
    - tool: "predictive-analytics"
      purpose: "Failure prediction modeling"
    - tool: "fault-injection"
      purpose: "Test fault detection capabilities"

signals:
  critical:
    - id: "SPS-HLT-CRIT-001"
      signal: "No health monitoring for safety-critical sensors"
      evidence_indicators:
        - "Safety sensors lack diagnostic capabilities"
        - "No fault detection mechanisms implemented"
        - "Sensor failures not detected or reported"
      explanation: |
        Safety-critical sensors must have health monitoring to detect failures
        before they cause hazardous conditions. IEC 61508 requires diagnostic
        coverage appropriate to the Safety Integrity Level (SIL).
      remediation: "Implement diagnostic coverage meeting SIL requirements"

    - id: "SPS-HLT-CRIT-002"
      signal: "Sensor failures not triggering appropriate system response"
      evidence_indicators:
        - "Failed sensors continue to influence control"
        - "No failsafe state on sensor failure"
        - "Alarms not generated for sensor faults"
      explanation: |
        Detected sensor failures must trigger appropriate responses including
        alarms, failsafe modes, or graceful degradation to prevent unsafe
        operation.
      remediation: "Implement proper fault response handling for all monitored sensors"

  high:
    - id: "SPS-HLT-HIGH-001"
      signal: "Diagnostic coverage insufficient for application SIL"
      evidence_indicators:
        - "BIST coverage below SIL requirements"
        - "Not all failure modes detectable"
        - "Diagnostic test interval too long"
      remediation: "Increase diagnostic coverage through additional tests or redundancy"

    - id: "SPS-HLT-HIGH-002"
      signal: "Sensor degradation not monitored"
      evidence_indicators:
        - "No trending of sensor performance"
        - "Drift not detected until calibration"
        - "No predictive maintenance indicators"
      remediation: "Implement continuous performance monitoring and trending"

  medium:
    - id: "SPS-HLT-MED-001"
      signal: "Health data not logged or retained"
      evidence_indicators:
        - "Diagnostic data discarded after check"
        - "No historical health records"
        - "Unable to analyze failure patterns"
      remediation: "Implement health data logging and retention"

    - id: "SPS-HLT-MED-002"
      signal: "Health monitoring alerts not actionable"
      evidence_indicators:
        - "Generic fault codes without detail"
        - "No guidance on fault resolution"
        - "Alerts not routed to appropriate personnel"
      remediation: "Improve alert quality with specific diagnostics and actions"

  low:
    - id: "SPS-HLT-LOW-001"
      signal: "Health monitoring documentation incomplete"
      evidence_indicators:
        - "Diagnostic features not documented"
        - "Fault codes not explained"
        - "Monitoring capabilities unknown"
      remediation: "Document all health monitoring capabilities and fault codes"

    - id: "SPS-HLT-LOW-002"
      signal: "Health dashboard not user-friendly"
      evidence_indicators:
        - "Health status difficult to interpret"
        - "No visual indication of sensor health"
        - "Historical trends not displayed"
      remediation: "Improve health visualization for operators"

  positive:
    - id: "SPS-HLT-POS-001"
      signal: "Comprehensive BIST implemented with high coverage"
      evidence_indicators:
        - "All critical failure modes detected"
        - "Diagnostic coverage documented and verified"
        - "Regular self-test execution"

    - id: "SPS-HLT-POS-002"
      signal: "Predictive maintenance enabled through health monitoring"
      evidence_indicators:
        - "Degradation trends analyzed"
        - "Failure predictions generated"
        - "Maintenance scheduled proactively"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Health Features"
      description: "Catalog health monitoring capabilities for each sensor"
      duration_estimate: "45 min"

    - id: "2"
      name: "Review BIST Implementation"
      description: "Analyze built-in self-test code and coverage"
      duration_estimate: "60 min"

    - id: "3"
      name: "Assess Diagnostic Coverage"
      description: "Calculate diagnostic coverage against SIL requirements"
      duration_estimate: "45 min"

    - id: "4"
      name: "Test Fault Detection"
      description: "Inject faults and verify detection"
      duration_estimate: "60 min"

    - id: "5"
      name: "Review Alert Handling"
      description: "Verify alerts are generated and routed correctly"
      duration_estimate: "30 min"

    - id: "6"
      name: "Analyze Health Trends"
      description: "Review historical health data for patterns"
      duration_estimate: "30 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Health Monitoring Inventory"
        - "Diagnostic Coverage Analysis"
        - "Fault Detection Assessment"
        - "Recommendations"

closeout_checklist:
  - id: "sps-hlt-001"
    item: "All safety-critical sensors have health monitoring"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-hlt-002"
    item: "Diagnostic coverage meets SIL requirements"
    level: "WARNING"
    verification: "manual"

  - id: "sps-hlt-003"
    item: "Fault response handling verified"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["iot-systems", "industrial-automation", "medical-devices", "automotive-systems"]

  compliance_mappings:
    - framework: "IEC 61508"
      control: "7.4.3"
      description: "Diagnostic coverage requirements"
    - framework: "ISO 26262"
      control: "Part 5"
      description: "Hardware diagnostic coverage"
    - framework: "IEC 62443"
      control: "SR 3.4"
      description: "System integrity verification"

relationships:
  commonly_combined:
    - "sensors-physical-systems.sensor-integration.sensor-calibration"
    - "sensors-physical-systems.safety-systems.fail-safe-modes"
  depends_on:
    - "sensors-physical-systems.sensor-integration.sensor-protocol-compliance"
  feeds_into:
    - "reliability.predictive-maintenance"
    - "operations.monitoring-dashboards"
