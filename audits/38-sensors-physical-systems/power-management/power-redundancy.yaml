# ============================================================
# AUDIT: Power Redundancy
# Category: 38 - Sensors & Physical Systems
# Subcategory: power-management
# ============================================================

audit:
  id: "sensors-physical-systems.power-management.power-redundancy"
  name: "Power Redundancy Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "power-management"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates power system redundancy including dual feed configurations, automatic
    transfer switches, redundant power supplies, and failover mechanisms. Reviews
    single points of failure, load distribution, and verification of redundancy
    operation.

  why_it_matters: |
    Power redundancy ensures continued operation despite power system failures.
    Without proper redundancy verification, systems believed to be protected
    may still have single points of failure that cause outages.

  when_to_run:
    - "During power system design"
    - "After infrastructure changes"
    - "During availability audits"
    - "When adding critical loads"
    - "After power-related outages"

prerequisites:
  required_artifacts:
    - type: "power_architecture"
      description: "Power distribution architecture"
    - type: "redundancy_design"
      description: "Redundancy design documentation"
    - type: "ats_config"
      description: "Automatic transfer switch configuration"

  access_requirements:
    - "Power system access"
    - "Transfer switch access"
    - "Monitoring system access"
    - "Testing capability"

discovery:
  file_patterns:
    - glob: "**/*redundant*.c"
      purpose: "Find redundancy code"
    - glob: "**/*failover*.c"
      purpose: "Find failover code"
    - glob: "**/*transfer*.c"
      purpose: "Find transfer switch code"
    - glob: "**/config/*power*.yaml"
      purpose: "Find power configuration"

knowledge_sources:
  guides:
    - id: "tier-standards"
      name: "Uptime Institute Tier Standards"
      url: "https://www.uptimeinstitute.com/"
    - id: "power-reliability"
      name: "Power System Reliability"
      url: "https://www.ieee.org/"

  standards:
    - id: "tia-942"
      name: "TIA-942 Data Center"
      relevance: "Data center redundancy"
    - id: "nfpa-110"
      name: "NFPA 110 Emergency Power"
      relevance: "Emergency power systems"
    - id: "ieee-446"
      name: "IEEE 446 Emergency Power"
      relevance: "Emergency/standby power"

tooling:
  analysis_tools:
    - tool: "load-analyzer"
      purpose: "Load distribution analysis"
    - tool: "transfer-tester"
      purpose: "Transfer switch testing"
    - tool: "power-monitor"
      purpose: "Redundancy monitoring"
    - tool: "spof-analyzer"
      purpose: "Single point failure analysis"

signals:
  critical:
    - id: "SPS-PRD-CRIT-001"
      signal: "Single point of failure exists"
      evidence_indicators:
        - "Common mode failure possible"
        - "Single transformer for dual feeds"
        - "ATS is only transfer path"
      explanation: |
        A single point of failure defeats the purpose of redundancy. One
        component failure can cause complete loss of power despite redundant
        design.
      remediation: "Eliminate single points of failure"

    - id: "SPS-PRD-CRIT-002"
      signal: "Redundancy failover not working"
      evidence_indicators:
        - "ATS did not transfer"
        - "Redundant supply did not pick up load"
        - "Manual intervention required"
      explanation: |
        Redundancy that doesn't automatically failover provides false
        confidence. Manual intervention takes too long for critical
        systems.
      remediation: "Repair automatic failover function"

  high:
    - id: "SPS-PRD-HIGH-001"
      signal: "Redundant paths not load-balanced"
      evidence_indicators:
        - "One path heavily loaded"
        - "Insufficient margin on primary"
        - "Secondary cannot handle full load"
      remediation: "Balance loads across redundant paths"

    - id: "SPS-PRD-HIGH-002"
      signal: "Redundancy not tested"
      evidence_indicators:
        - "Failover never tested"
        - "Unknown if it works"
        - "Last test failed"
      remediation: "Test redundancy operation"

  medium:
    - id: "SPS-PRD-MED-001"
      signal: "Redundancy monitoring incomplete"
      evidence_indicators:
        - "Cannot see both paths"
        - "Failure not alarmed"
        - "Status unknown"
      remediation: "Implement comprehensive monitoring"

    - id: "SPS-PRD-MED-002"
      signal: "Maintenance affects redundancy"
      evidence_indicators:
        - "Maintenance removes redundancy"
        - "No procedures for maintenance"
        - "Risk during maintenance"
      remediation: "Develop maintenance procedures maintaining redundancy"

  low:
    - id: "SPS-PRD-LOW-001"
      signal: "Redundancy not documented"
      evidence_indicators:
        - "Architecture not recorded"
        - "Single line diagram outdated"
        - "Failover paths unclear"
      remediation: "Document power redundancy"

    - id: "SPS-PRD-LOW-002"
      signal: "No redundancy metrics"
      evidence_indicators:
        - "Availability not tracked"
        - "Failover events not recorded"
        - "No improvement targets"
      remediation: "Implement availability metrics"

  positive:
    - id: "SPS-PRD-POS-001"
      signal: "True redundancy achieved"
      evidence_indicators:
        - "No single points of failure"
        - "Failover tested regularly"
        - "Paths balanced"

    - id: "SPS-PRD-POS-002"
      signal: "Redundancy actively managed"
      evidence_indicators:
        - "Monitoring comprehensive"
        - "Maintenance procedures defined"
        - "Regular testing"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Map Power Architecture"
      description: "Document power distribution paths"
      duration_estimate: "45 min"

    - id: "2"
      name: "Identify Single Points"
      description: "Find potential single points of failure"
      duration_estimate: "60 min"

    - id: "3"
      name: "Verify Load Distribution"
      description: "Check loads across redundant paths"
      duration_estimate: "45 min"

    - id: "4"
      name: "Test Failover"
      description: "Verify automatic transfer operation"
      duration_estimate: "60 min"

    - id: "5"
      name: "Review Monitoring"
      description: "Assess redundancy monitoring"
      duration_estimate: "30 min"

    - id: "6"
      name: "Check Maintenance Procedures"
      description: "Review maintenance impact on redundancy"
      duration_estimate: "20 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Architecture Review"
        - "SPOF Analysis"
        - "Failover Testing"
        - "Recommendations"

closeout_checklist:
  - id: "sps-prd-001"
    item: "No single points of failure"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-prd-002"
    item: "Failover tested and working"
    level: "WARNING"
    verification: "manual"

  - id: "sps-prd-003"
    item: "Paths properly balanced"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["data-centers", "critical-infrastructure", "hospitals", "financial-services"]

  compliance_mappings:
    - framework: "Uptime Institute"
      control: "Tier Standards"
      description: "Data center redundancy tiers"
    - framework: "TIA-942"
      control: "Redundancy"
      description: "Data center design"
    - framework: "Joint Commission"
      control: "EC.02.05.03"
      description: "Healthcare power redundancy"

relationships:
  commonly_combined:
    - "sensors-physical-systems.power-management.ups-systems"
    - "sensors-physical-systems.power-management.power-supply-monitoring"
  depends_on:
    - "electrical.power-distribution"
  feeds_into:
    - "availability.high-availability"
    - "business-continuity.power-continuity"
