# ============================================================
# AUDIT: Power Quality
# Category: 38 - Sensors & Physical Systems
# Subcategory: power-management
# ============================================================

audit:
  id: "sensors-physical-systems.power-management.power-quality"
  name: "Power Quality Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "power-management"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates power quality including voltage stability, harmonic distortion,
    transients, sags/swells, frequency variation, and power factor. Reviews
    power quality monitoring, filtering, and conditioning equipment effectiveness.

  why_it_matters: |
    Poor power quality damages sensitive electronic equipment, causes
    communication errors, reduces equipment life, and increases energy costs.
    Understanding and managing power quality protects equipment and ensures
    reliable operation.

  when_to_run:
    - "During facility power design"
    - "After equipment problems"
    - "When adding VFDs or large loads"
    - "During energy audits"
    - "After utility power changes"

prerequisites:
  required_artifacts:
    - type: "single_line_diagram"
      description: "Electrical distribution diagram"
    - type: "load_analysis"
      description: "Load characteristics documentation"
    - type: "equipment_specs"
      description: "Sensitive equipment specifications"

  access_requirements:
    - "Power system access"
    - "Power quality analyzer"
    - "Monitoring system access"
    - "Electrical panel access"

discovery:
  file_patterns:
    - glob: "**/*power_quality*.c"
      purpose: "Find power quality code"
    - glob: "**/*harmonic*.c"
      purpose: "Find harmonic analysis code"
    - glob: "**/*pfc*.c"
      purpose: "Find power factor correction"
    - glob: "**/config/*electrical*.yaml"
      purpose: "Find electrical configuration"

knowledge_sources:
  guides:
    - id: "ieee-1159"
      name: "IEEE 1159 Power Quality"
      url: "https://www.ieee.org/"
    - id: "power-quality-handbook"
      name: "Power Quality Handbook"
      url: "https://www.epri.com/"

  standards:
    - id: "ieee-1159"
      name: "IEEE 1159 Power Quality Monitoring"
      relevance: "Power quality definitions"
    - id: "ieee-519"
      name: "IEEE 519 Harmonics"
      relevance: "Harmonic limits"
    - id: "iec-61000"
      name: "IEC 61000 EMC"
      relevance: "Power quality EMC"

tooling:
  analysis_tools:
    - tool: "power-quality-analyzer"
      purpose: "Comprehensive PQ measurement"
    - tool: "harmonic-analyzer"
      purpose: "Harmonic analysis"
    - tool: "power-logger"
      purpose: "Long-term monitoring"
    - tool: "oscilloscope"
      purpose: "Transient capture"

signals:
  critical:
    - id: "SPS-PQA-CRIT-001"
      signal: "Power quality causing equipment damage"
      evidence_indicators:
        - "Equipment failures from PQ events"
        - "Capacitor failures"
        - "Motor insulation degradation"
      explanation: |
        Severe power quality problems can damage equipment directly through
        overvoltage, transients, or harmonic heating. This leads to
        equipment failure and safety hazards.
      remediation: "Identify and mitigate PQ issues immediately"

    - id: "SPS-PQA-CRIT-002"
      signal: "Harmonic distortion exceeding safe limits"
      evidence_indicators:
        - "THD above IEEE 519 limits"
        - "Transformer overheating"
        - "Resonance observed"
      explanation: |
        Excessive harmonics cause equipment overheating, transformer
        derating, and potential resonance that can damage equipment
        throughout the facility.
      remediation: "Install harmonic filtering"

  high:
    - id: "SPS-PQA-HIGH-001"
      signal: "Voltage sags affecting operations"
      evidence_indicators:
        - "Equipment resetting during sags"
        - "Process interruptions"
        - "Frequent sag events"
      remediation: "Install voltage conditioning or sag ride-through"

    - id: "SPS-PQA-HIGH-002"
      signal: "Power factor penalty charges"
      evidence_indicators:
        - "Power factor below utility requirement"
        - "Penalty charges on bill"
        - "No power factor correction"
      remediation: "Install power factor correction"

  medium:
    - id: "SPS-PQA-MED-001"
      signal: "Power quality not monitored"
      evidence_indicators:
        - "No PQ measurement"
        - "Events not recorded"
        - "Problems not detected"
      remediation: "Implement power quality monitoring"

    - id: "SPS-PQA-MED-002"
      signal: "Transient protection inadequate"
      evidence_indicators:
        - "No surge protection"
        - "SPD maintenance overdue"
        - "Inadequate protection level"
      remediation: "Install or upgrade surge protection"

  low:
    - id: "SPS-PQA-LOW-001"
      signal: "Power quality not documented"
      evidence_indicators:
        - "No baseline measurements"
        - "Equipment immunity unknown"
        - "History not recorded"
      remediation: "Document power quality baseline"

    - id: "SPS-PQA-LOW-002"
      signal: "No coordination with utility"
      evidence_indicators:
        - "Utility PQ data not obtained"
        - "Events not correlated"
        - "Improvement opportunities missed"
      remediation: "Establish utility coordination"

  positive:
    - id: "SPS-PQA-POS-001"
      signal: "Comprehensive power quality management"
      evidence_indicators:
        - "Continuous monitoring"
        - "Issues proactively addressed"
        - "Equipment protected"

    - id: "SPS-PQA-POS-002"
      signal: "Power quality within specifications"
      evidence_indicators:
        - "Meets IEEE standards"
        - "No equipment issues"
        - "Power factor optimized"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Electrical System"
      description: "Understand power distribution"
      duration_estimate: "30 min"

    - id: "2"
      name: "Measure Voltage Quality"
      description: "Record voltage levels and stability"
      duration_estimate: "45 min"

    - id: "3"
      name: "Analyze Harmonics"
      description: "Measure harmonic distortion"
      duration_estimate: "45 min"

    - id: "4"
      name: "Monitor Transients"
      description: "Capture and analyze transients"
      duration_estimate: "60 min"

    - id: "5"
      name: "Measure Power Factor"
      description: "Assess power factor across loads"
      duration_estimate: "30 min"

    - id: "6"
      name: "Review Mitigation"
      description: "Assess filtering and conditioning"
      duration_estimate: "30 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Voltage Analysis"
        - "Harmonic Assessment"
        - "Power Factor Review"
        - "Recommendations"

closeout_checklist:
  - id: "sps-pqa-001"
    item: "Power quality within limits"
    level: "WARNING"
    verification: "manual"

  - id: "sps-pqa-002"
    item: "Harmonics within IEEE 519"
    level: "WARNING"
    verification: "manual"

  - id: "sps-pqa-003"
    item: "Monitoring in place"
    level: "INFO"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["industrial-facilities", "data-centers", "healthcare", "manufacturing"]

  compliance_mappings:
    - framework: "IEEE 519"
      control: "Harmonic Limits"
      description: "Harmonic requirements"
    - framework: "IEEE 1159"
      control: "Power Quality"
      description: "PQ monitoring and definitions"
    - framework: "IEC 61000-4-30"
      control: "Power Quality Measurement"
      description: "PQ measurement methods"

relationships:
  commonly_combined:
    - "sensors-physical-systems.power-management.power-supply-monitoring"
    - "sensors-physical-systems.power-management.ups-systems"
  depends_on:
    - "electrical.power-distribution"
  feeds_into:
    - "reliability.electrical-reliability"
    - "energy.power-factor-correction"
