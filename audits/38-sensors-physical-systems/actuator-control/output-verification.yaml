# ============================================================
# AUDIT: Output Verification
# Category: 38 - Sensors & Physical Systems
# Subcategory: actuator-control
# ============================================================

audit:
  id: "sensors-physical-systems.actuator-control.output-verification"
  name: "Output Verification Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "actuator-control"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates output verification mechanisms that confirm actuators actually
    respond to commands. Reviews position feedback, limit switches, current
    monitoring, and diagnostic coverage for detecting stuck or failed outputs.
    Assesses discrepancy detection and response procedures.

  why_it_matters: |
    Control systems must verify that outputs actually change state. Undetected
    stuck valves, failed contactors, or broken actuators can create dangerous
    conditions where the system believes it has taken action but the physical
    state remains unchanged.

  when_to_run:
    - "During safety system design"
    - "After actuator failures"
    - "During SIL verification"
    - "When discrepancies occur"
    - "During system audits"

prerequisites:
  required_artifacts:
    - type: "output_design"
      description: "Output circuit design"
    - type: "feedback_config"
      description: "Feedback and monitoring configuration"
    - type: "alarm_config"
      description: "Discrepancy alarm settings"

  access_requirements:
    - "Control system access"
    - "Physical access to actuators"
    - "Ability to test feedback"
    - "Fault injection capability"

discovery:
  file_patterns:
    - glob: "**/*feedback*.c"
      purpose: "Find feedback code"
    - glob: "**/*verify*.c"
      purpose: "Find verification code"
    - glob: "**/*discrepancy*.c"
      purpose: "Find discrepancy detection"
    - glob: "**/config/*output*.yaml"
      purpose: "Find output configuration"

knowledge_sources:
  guides:
    - id: "iec-61511-guide"
      name: "IEC 61511 Implementation Guide"
      url: "https://www.isa.org/"
    - id: "output-diagnostics"
      name: "Output Diagnostic Techniques"
      url: "https://www.rockwellautomation.com/"

  standards:
    - id: "iec-61508"
      name: "IEC 61508 Functional Safety"
      relevance: "Diagnostic coverage requirements"
    - id: "iec-61511"
      name: "IEC 61511 Process Safety"
      relevance: "SIF output requirements"
    - id: "iso-13849"
      name: "ISO 13849 Machinery Safety"
      relevance: "Machine output monitoring"

tooling:
  analysis_tools:
    - tool: "fault-injection"
      purpose: "Test detection mechanisms"
    - tool: "logic-analyzer"
      purpose: "Signal verification"
    - tool: "plc-diagnostic"
      purpose: "Controller diagnostics"
    - tool: "timing-analyzer"
      purpose: "Response time measurement"

signals:
  critical:
    - id: "SPS-OVR-CRIT-001"
      signal: "Safety output has no verification"
      evidence_indicators:
        - "No feedback for safety output"
        - "Cannot detect stuck output"
        - "Failure undetectable"
      explanation: |
        Safety outputs without verification cannot confirm that safety actions
        have been executed. A stuck valve or failed contactor will go undetected,
        leaving the hazard unmitigated.
      remediation: "Implement output verification for all safety outputs"

    - id: "SPS-OVR-CRIT-002"
      signal: "Discrepancy detection not working"
      evidence_indicators:
        - "Feedback disagrees with command"
        - "No alarm generated"
        - "System continues despite discrepancy"
      explanation: |
        When commanded output and actual feedback disagree, this indicates a
        failure. If this discrepancy goes undetected or unalerted, operators
        remain unaware of the dangerous condition.
      remediation: "Correct discrepancy detection and alarming"

  high:
    - id: "SPS-OVR-HIGH-001"
      signal: "Verification timeout too long"
      evidence_indicators:
        - "Long time to detect stuck output"
        - "Hazardous condition persists"
        - "Timeout exceeds safe time"
      remediation: "Reduce verification timeout to appropriate value"

    - id: "SPS-OVR-HIGH-002"
      signal: "Feedback sensor reliability questionable"
      evidence_indicators:
        - "Limit switch failures common"
        - "Position sensor drift"
        - "False feedback readings"
      remediation: "Improve feedback sensor reliability or add redundancy"

  medium:
    - id: "SPS-OVR-MED-001"
      signal: "Not all outputs have verification"
      evidence_indicators:
        - "Some outputs unmonitored"
        - "Non-safety outputs not verified"
        - "Inconsistent approach"
      remediation: "Extend verification to additional outputs"

    - id: "SPS-OVR-MED-002"
      signal: "Discrepancy response not defined"
      evidence_indicators:
        - "Alarm only, no action"
        - "Response varies"
        - "Procedure unclear"
      remediation: "Define clear discrepancy response procedures"

  low:
    - id: "SPS-OVR-LOW-001"
      signal: "Output verification not documented"
      evidence_indicators:
        - "Feedback types not recorded"
        - "Timeout values not documented"
        - "Response procedures missing"
      remediation: "Document output verification system"

    - id: "SPS-OVR-LOW-002"
      signal: "No discrepancy statistics"
      evidence_indicators:
        - "Discrepancy rate unknown"
        - "Patterns not analyzed"
        - "No trending"
      remediation: "Track and analyze discrepancy statistics"

  positive:
    - id: "SPS-OVR-POS-001"
      signal: "Comprehensive output verification"
      evidence_indicators:
        - "All critical outputs verified"
        - "Appropriate timeouts"
        - "Redundant feedback where needed"

    - id: "SPS-OVR-POS-002"
      signal: "Effective discrepancy response"
      evidence_indicators:
        - "Automatic safe state"
        - "Clear alarm annunciation"
        - "Defined procedures"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Critical Outputs"
      description: "Catalog all outputs requiring verification"
      duration_estimate: "30 min"

    - id: "2"
      name: "Review Verification Design"
      description: "Assess verification mechanisms"
      duration_estimate: "45 min"

    - id: "3"
      name: "Test Discrepancy Detection"
      description: "Inject faults and verify detection"
      duration_estimate: "60 min"

    - id: "4"
      name: "Verify Timeout Settings"
      description: "Confirm timeouts appropriate"
      duration_estimate: "30 min"

    - id: "5"
      name: "Test Alarm Response"
      description: "Verify alarm generation and routing"
      duration_estimate: "30 min"

    - id: "6"
      name: "Review Response Procedures"
      description: "Assess discrepancy response"
      duration_estimate: "20 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Verification Coverage"
        - "Detection Testing Results"
        - "Response Assessment"
        - "Recommendations"

closeout_checklist:
  - id: "sps-ovr-001"
    item: "Safety outputs have verification"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-ovr-002"
    item: "Discrepancy detection working"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-ovr-003"
    item: "Response procedures defined"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["safety-critical-systems", "industrial-automation", "process-control", "machinery"]

  compliance_mappings:
    - framework: "IEC 61508"
      control: "7.4.3"
      description: "Diagnostic coverage"
    - framework: "IEC 61511"
      control: "11.5"
      description: "Final element requirements"
    - framework: "ISO 13849"
      control: "Output Monitoring"
      description: "Machinery safety outputs"

relationships:
  commonly_combined:
    - "sensors-physical-systems.safety-systems.interlock-verification"
    - "sensors-physical-systems.actuator-control.valve-control"
  depends_on:
    - "sensors-physical-systems.hardware-interfaces.gpio-management"
  feeds_into:
    - "safety.diagnostic-coverage"
    - "reliability.actuator-reliability"
