# ============================================================
# AUDIT: Valve Control
# Category: 38 - Sensors & Physical Systems
# Subcategory: actuator-control
# ============================================================

audit:
  id: "sensors-physical-systems.actuator-control.valve-control"
  name: "Valve Control Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "actuator-control"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates control valve systems including valve sizing, actuator selection,
    positioner configuration, characteristic matching, and diagnostics. Reviews
    valve signature analysis, friction/stiction detection, and safety shutdown
    valve performance testing.

  why_it_matters: |
    Control valves are the final control elements that implement process control
    decisions. Poorly performing valves cause control variability, energy waste,
    and process upsets. Safety valves must operate reliably to prevent hazardous
    conditions.

  when_to_run:
    - "During control system commissioning"
    - "When valve problems suspected"
    - "During turnaround maintenance"
    - "Before safety system proof testing"
    - "During energy audits"

prerequisites:
  required_artifacts:
    - type: "valve_specs"
      description: "Valve specifications and datasheets"
    - type: "positioner_config"
      description: "Positioner configuration"
    - type: "sov_test_records"
      description: "Safety valve test records"

  access_requirements:
    - "Physical access to valves"
    - "Positioner diagnostic access"
    - "Control system access"
    - "Stroke testing capability"

discovery:
  file_patterns:
    - glob: "**/*valve*.c"
      purpose: "Find valve code"
    - glob: "**/*positioner*.c"
      purpose: "Find positioner code"
    - glob: "**/*actuator*.c"
      purpose: "Find actuator code"
    - glob: "**/config/*valve*.yaml"
      purpose: "Find valve configuration"

knowledge_sources:
  guides:
    - id: "control-valve-handbook"
      name: "Control Valve Handbook"
      url: "https://www.emerson.com/"
    - id: "isa-valve"
      name: "ISA Valve Standards"
      url: "https://www.isa.org/"

  standards:
    - id: "isa-75"
      name: "ISA-75 Control Valve Standards"
      relevance: "Valve sizing and performance"
    - id: "iec-61508"
      name: "IEC 61508 Functional Safety"
      relevance: "Safety valve requirements"
    - id: "api-6d"
      name: "API 6D Pipeline Valves"
      relevance: "Pipeline valve standards"

tooling:
  analysis_tools:
    - tool: "valve-diagnostic"
      purpose: "Valve signature analysis"
    - tool: "partial-stroke-tester"
      purpose: "Safety valve testing"
    - tool: "positioner-diagnostic"
      purpose: "Positioner analysis"
    - tool: "flow-meter"
      purpose: "Cv verification"

signals:
  critical:
    - id: "SPS-VLV-CRIT-001"
      signal: "Safety shutdown valve fails to operate"
      evidence_indicators:
        - "Valve stuck during test"
        - "Actuator failed"
        - "Cannot achieve required stroke"
      explanation: |
        Safety shutdown valves are the last line of defense against hazardous
        conditions. A valve that cannot close or open on demand creates an
        immediate safety risk.
      remediation: "Repair or replace valve immediately"

    - id: "SPS-VLV-CRIT-002"
      signal: "Control valve causing dangerous process condition"
      evidence_indicators:
        - "Valve fails in wrong position"
        - "Unable to control process variable"
        - "Process excursion from valve failure"
      explanation: |
        Control valves that fail in an unsafe position or cannot maintain
        control can cause process upsets leading to safety, environmental,
        or quality incidents.
      remediation: "Correct valve failure mode or replace valve"

  high:
    - id: "SPS-VLV-HIGH-001"
      signal: "Significant valve stiction or friction"
      evidence_indicators:
        - "Stick-slip behavior in signature"
        - "Control loop oscillation"
        - "Positioner hunting"
      remediation: "Repair or replace valve trim/packing"

    - id: "SPS-VLV-HIGH-002"
      signal: "Valve sizing incorrect"
      evidence_indicators:
        - "Valve operates near limits"
        - "Cannot achieve required flow"
        - "Excessive noise/cavitation"
      remediation: "Resize valve for process conditions"

  medium:
    - id: "SPS-VLV-MED-001"
      signal: "Valve characteristic mismatch"
      evidence_indicators:
        - "Installed characteristic not linear"
        - "Gain varies significantly"
        - "Control difficult to tune"
      remediation: "Characterize positioner or replace trim"

    - id: "SPS-VLV-MED-002"
      signal: "Positioner not optimally tuned"
      evidence_indicators:
        - "Slow response"
        - "Overshoot on step changes"
        - "Auto-tune not performed"
      remediation: "Optimize positioner tuning"

  low:
    - id: "SPS-VLV-LOW-001"
      signal: "Valve diagnostics not utilized"
      evidence_indicators:
        - "Smart positioner data not collected"
        - "No trending of valve health"
        - "Diagnostic capabilities unused"
      remediation: "Enable and utilize valve diagnostics"

    - id: "SPS-VLV-LOW-002"
      signal: "Valve documentation incomplete"
      evidence_indicators:
        - "Sizing calculations missing"
        - "Calibration records incomplete"
        - "Maintenance history not recorded"
      remediation: "Complete valve documentation"

  positive:
    - id: "SPS-VLV-POS-001"
      signal: "Valve performance optimized"
      evidence_indicators:
        - "Minimal friction/stiction"
        - "Good positioner tuning"
        - "Proper characteristic"

    - id: "SPS-VLV-POS-002"
      signal: "Comprehensive valve health monitoring"
      evidence_indicators:
        - "Diagnostic data collected"
        - "Trending for degradation"
        - "Predictive maintenance enabled"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Valves"
      description: "Catalog all control and safety valves"
      duration_estimate: "30 min"

    - id: "2"
      name: "Review Valve Sizing"
      description: "Verify valve sizing for application"
      duration_estimate: "45 min"

    - id: "3"
      name: "Perform Diagnostic Tests"
      description: "Run valve signature tests"
      duration_estimate: "60 min"

    - id: "4"
      name: "Test Safety Valves"
      description: "Perform partial stroke or full stroke test"
      duration_estimate: "45 min"

    - id: "5"
      name: "Review Positioner Setup"
      description: "Verify positioner configuration"
      duration_estimate: "30 min"

    - id: "6"
      name: "Assess Failure Modes"
      description: "Verify failure position appropriate"
      duration_estimate: "20 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Valve Inventory"
        - "Diagnostic Assessment"
        - "Safety Valve Review"
        - "Recommendations"

closeout_checklist:
  - id: "sps-vlv-001"
    item: "Safety valves tested and functional"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-vlv-002"
    item: "Control valves performing adequately"
    level: "WARNING"
    verification: "manual"

  - id: "sps-vlv-003"
    item: "Failure modes verified"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["process-industries", "oil-gas", "chemical-processing", "power-generation"]

  compliance_mappings:
    - framework: "ISA-75"
      control: "Valve Standards"
      description: "Control valve requirements"
    - framework: "IEC 61511"
      control: "SIF Requirements"
      description: "Safety instrumented functions"
    - framework: "API 598"
      control: "Valve Testing"
      description: "Valve inspection and testing"

relationships:
  commonly_combined:
    - "sensors-physical-systems.actuator-control.feedback-loop-tuning"
    - "sensors-physical-systems.safety-systems.safety-instrumented-functions"
  depends_on:
    - "instrumentation.instrument-air"
  feeds_into:
    - "reliability.valve-reliability"
    - "maintenance.predictive-maintenance"
