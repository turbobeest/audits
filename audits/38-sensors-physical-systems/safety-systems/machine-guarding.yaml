# ============================================================
# AUDIT: Machine Guarding
# Category: 38 - Sensors & Physical Systems
# Subcategory: safety-systems
# ============================================================

audit:
  id: "sensors-physical-systems.safety-systems.machine-guarding"
  name: "Machine Guarding Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "safety-systems"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates physical and electro-sensitive machine guarding including fixed
    guards, interlocked guards, light curtains, safety mats, area scanners, and
    safety controllers. Reviews guard design, safety distances, muting functions,
    and compliance with ISO 14120 and ISO 13855.

  why_it_matters: |
    Machine guards are the primary protection against contact with hazardous
    machine motion. Inadequate guarding is a leading cause of serious industrial
    injuries including amputations. Proper guarding protects workers from
    foreseeable hazards.

  when_to_run:
    - "During machine design"
    - "Before commissioning"
    - "After modifications"
    - "During safety audits"
    - "After guarding-related incidents"

prerequisites:
  required_artifacts:
    - type: "risk_assessment"
      description: "Machine risk assessment"
    - type: "guard_drawings"
      description: "Guard design drawings"
    - type: "safety_calculations"
      description: "Safety distance calculations"

  access_requirements:
    - "Physical access to machine"
    - "Safety controller access"
    - "Guard measurement tools"
    - "Stop time measurement"

discovery:
  file_patterns:
    - glob: "**/*guard*.c"
      purpose: "Find guard interlock code"
    - glob: "**/*light_curtain*.c"
      purpose: "Find light curtain code"
    - glob: "**/*safety_scanner*.c"
      purpose: "Find scanner code"
    - glob: "**/config/*guard*.yaml"
      purpose: "Find guard configuration"

knowledge_sources:
  guides:
    - id: "iso-14120"
      name: "ISO 14120 Guards"
      url: "https://www.iso.org/"
    - id: "osha-guarding"
      name: "OSHA Machine Guarding"
      url: "https://www.osha.gov/"

  standards:
    - id: "iso-14120"
      name: "ISO 14120 Guards Design"
      relevance: "Guard design requirements"
    - id: "iso-13855"
      name: "ISO 13855 Safety Distances"
      relevance: "Safety distance calculation"
    - id: "iec-61496"
      name: "IEC 61496 ESPE Standards"
      relevance: "Electro-sensitive protective equipment"

tooling:
  analysis_tools:
    - tool: "stop-time-tester"
      purpose: "Measure stopping performance"
    - tool: "reach-gauge"
      purpose: "Verify opening sizes"
    - tool: "light-curtain-tester"
      purpose: "Test ESPE function"
    - tool: "safety-distance-calculator"
      purpose: "Calculate safety distances"

signals:
  critical:
    - id: "SPS-GRD-CRIT-001"
      signal: "Guard allows access to hazard"
      evidence_indicators:
        - "Openings too large"
        - "Reach-through possible"
        - "Guard defeated or removed"
      explanation: |
        Guards that allow access to hazardous motion provide no protection.
        Workers can reach hazards and be seriously injured, including
        amputations or fatalities.
      remediation: "Correct guarding to prevent hazard access"

    - id: "SPS-GRD-CRIT-002"
      signal: "Safety distance insufficient"
      evidence_indicators:
        - "Light curtain too close"
        - "Stopping time not considered"
        - "Personnel can reach hazard before stop"
      explanation: |
        Inadequate safety distance means the machine cannot stop before a
        person can reach the hazard, defeating the purpose of the safeguard.
      remediation: "Recalculate and correct safety distance"

  high:
    - id: "SPS-GRD-HIGH-001"
      signal: "ESPE resolution inadequate"
      evidence_indicators:
        - "Light curtain resolution too coarse"
        - "Cannot detect hands/fingers"
        - "Detection object size incorrect"
      remediation: "Use ESPE with appropriate resolution"

    - id: "SPS-GRD-HIGH-002"
      signal: "Muting function unsafe"
      evidence_indicators:
        - "Muting allows worker entry"
        - "Muting not time-limited"
        - "Muting can be abused"
      remediation: "Correct muting function design"

  medium:
    - id: "SPS-GRD-MED-001"
      signal: "Guard interlocking inadequate"
      evidence_indicators:
        - "Non-safety switches used"
        - "Single-channel interlocking"
        - "Defeat resistance low"
      remediation: "Upgrade guard interlocking"

    - id: "SPS-GRD-MED-002"
      signal: "Guards difficult to use"
      evidence_indicators:
        - "Workers remove guards"
        - "Guards obstruct work"
        - "Ergonomics poor"
      remediation: "Redesign guards for usability"

  low:
    - id: "SPS-GRD-LOW-001"
      signal: "Guarding not documented"
      evidence_indicators:
        - "Guard locations not mapped"
        - "Safety distances not recorded"
        - "Calculations not documented"
      remediation: "Document guarding system"

    - id: "SPS-GRD-LOW-002"
      signal: "Guard inspection program missing"
      evidence_indicators:
        - "Guards not regularly checked"
        - "Damage not detected"
        - "No inspection records"
      remediation: "Implement guard inspection program"

  positive:
    - id: "SPS-GRD-POS-001"
      signal: "Comprehensive guarding coverage"
      evidence_indicators:
        - "All hazards guarded"
        - "Safety distances verified"
        - "Appropriate guard types"

    - id: "SPS-GRD-POS-002"
      signal: "Guards properly maintained"
      evidence_indicators:
        - "Regular inspections"
        - "Damage repaired promptly"
        - "Interlocks tested"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Risk Assessment"
      description: "Understand hazards and guard requirements"
      duration_estimate: "30 min"

    - id: "2"
      name: "Inspect Physical Guards"
      description: "Check guard condition and installation"
      duration_estimate: "60 min"

    - id: "3"
      name: "Verify Safety Distances"
      description: "Measure and calculate safety distances"
      duration_estimate: "45 min"

    - id: "4"
      name: "Test ESPE Function"
      description: "Verify light curtains and scanners"
      duration_estimate: "45 min"

    - id: "5"
      name: "Test Interlocks"
      description: "Verify guard interlock operation"
      duration_estimate: "30 min"

    - id: "6"
      name: "Check Muting Functions"
      description: "Review muting configuration"
      duration_estimate: "20 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Guard Inventory"
        - "Safety Distance Verification"
        - "ESPE Testing"
        - "Recommendations"

closeout_checklist:
  - id: "sps-grd-001"
    item: "All hazards properly guarded"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-grd-002"
    item: "Safety distances verified"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-grd-003"
    item: "Interlocks functional"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["manufacturing", "industrial-machinery", "packaging", "material-handling"]

  compliance_mappings:
    - framework: "ISO 14120"
      control: "Guard Design"
      description: "Guard requirements"
    - framework: "ISO 13855"
      control: "Safety Distance"
      description: "Safety distance calculation"
    - framework: "OSHA 1910.212"
      control: "Machine Guarding"
      description: "General machine guarding"

relationships:
  commonly_combined:
    - "sensors-physical-systems.safety-systems.interlock-verification"
    - "sensors-physical-systems.safety-systems.emergency-stop-coverage"
  depends_on:
    - "safety.risk-assessment"
  feeds_into:
    - "compliance.machine-safety"
    - "safety.personnel-protection"
