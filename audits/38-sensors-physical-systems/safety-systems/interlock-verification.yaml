# ============================================================
# AUDIT: Interlock Verification
# Category: 38 - Sensors & Physical Systems
# Subcategory: safety-systems
# ============================================================

audit:
  id: "sensors-physical-systems.safety-systems.interlock-verification"
  name: "Interlock Verification Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "safety-systems"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates safety interlock systems including guard interlocking, process
    interlocks, permissive conditions, and safety input verification. Reviews
    interlock logic, sensor selection, monitoring, and proof testing procedures.
    Assesses compliance with ISO 14119 and functional safety requirements.

  why_it_matters: |
    Interlocks prevent hazardous conditions by ensuring prerequisites are met
    before operations proceed. Failed or bypassed interlocks allow dangerous
    conditions to develop, potentially resulting in equipment damage, injury,
    or fatality.

  when_to_run:
    - "During safety system design"
    - "Before commissioning"
    - "After interlock modifications"
    - "During proof testing"
    - "After incidents involving interlocks"

prerequisites:
  required_artifacts:
    - type: "interlock_logic"
      description: "Interlock logic diagrams"
    - type: "cause_effect_matrix"
      description: "Cause and effect documentation"
    - type: "sensor_specs"
      description: "Safety sensor specifications"

  access_requirements:
    - "Safety PLC access"
    - "Physical access to interlock devices"
    - "Ability to perform proof tests"
    - "Process knowledge for permissives"

discovery:
  file_patterns:
    - glob: "**/*interlock*.c"
      purpose: "Find interlock code"
    - glob: "**/*permissive*.c"
      purpose: "Find permissive code"
    - glob: "**/*guard*.c"
      purpose: "Find guard interlock code"
    - glob: "**/config/*interlock*.yaml"
      purpose: "Find interlock configuration"

knowledge_sources:
  guides:
    - id: "iso-14119"
      name: "ISO 14119 Interlocking Devices"
      url: "https://www.iso.org/"
    - id: "iec-62061"
      name: "IEC 62061 Functional Safety"
      url: "https://www.iec.ch/"

  standards:
    - id: "iso-14119"
      name: "ISO 14119 Interlocking Devices"
      relevance: "Guard interlock requirements"
    - id: "iso-13849"
      name: "ISO 13849 Safety of Machinery"
      relevance: "Safety control systems"
    - id: "iec-61511"
      name: "IEC 61511 Process Safety"
      relevance: "Process interlock requirements"

tooling:
  analysis_tools:
    - tool: "safety-plc-diagnostic"
      purpose: "Logic verification"
    - tool: "interlock-tester"
      purpose: "Device testing"
    - tool: "timing-analyzer"
      purpose: "Response time verification"
    - tool: "fault-injection"
      purpose: "Failure testing"

signals:
  critical:
    - id: "SPS-ILK-CRIT-001"
      signal: "Safety interlock bypassed"
      evidence_indicators:
        - "Jumper installed"
        - "Interlock mechanically defeated"
        - "Logic forced in program"
      explanation: |
        A bypassed safety interlock provides no protection against the hazard
        it was designed to prevent. This creates an immediate risk of serious
        injury or fatality.
      remediation: "Remove bypass immediately and investigate root cause"

    - id: "SPS-ILK-CRIT-002"
      signal: "Interlock fails to prevent hazardous condition"
      evidence_indicators:
        - "Interlock allows unsafe operation"
        - "Timing allows hazard exposure"
        - "Logic error in interlock"
      explanation: |
        An interlock that does not properly prevent the hazardous condition
        provides false confidence while leaving personnel exposed to danger.
      remediation: "Correct interlock logic and revalidate"

  high:
    - id: "SPS-ILK-HIGH-001"
      signal: "Interlock device selection inadequate"
      evidence_indicators:
        - "Non-safety-rated devices used"
        - "Defeat resistance insufficient"
        - "Wrong technology for application"
      remediation: "Replace with appropriate safety-rated devices"

    - id: "SPS-ILK-HIGH-002"
      signal: "No fault detection on interlock circuit"
      evidence_indicators:
        - "Single-channel interlock"
        - "Wiring faults undetectable"
        - "Sensor failure not detected"
      remediation: "Implement fault detection through redundancy or monitoring"

  medium:
    - id: "SPS-ILK-MED-001"
      signal: "Interlock proof testing inadequate"
      evidence_indicators:
        - "Testing interval too long"
        - "Test coverage incomplete"
        - "No records of testing"
      remediation: "Implement proper proof testing program"

    - id: "SPS-ILK-MED-002"
      signal: "Interlock restart conditions unsafe"
      evidence_indicators:
        - "Automatic restart possible"
        - "Restart from outside hazard zone"
        - "No verification before restart"
      remediation: "Implement safe restart procedures"

  low:
    - id: "SPS-ILK-LOW-001"
      signal: "Interlock system not documented"
      evidence_indicators:
        - "Logic not documented"
        - "Sensor locations not mapped"
        - "Testing procedures missing"
      remediation: "Document interlock system completely"

    - id: "SPS-ILK-LOW-002"
      signal: "Interlock status not visible"
      evidence_indicators:
        - "Operators cannot see interlock state"
        - "Fault diagnostics limited"
        - "No interlock status display"
      remediation: "Provide interlock status indication"

  positive:
    - id: "SPS-ILK-POS-001"
      signal: "Robust interlock architecture"
      evidence_indicators:
        - "Dual-channel monitoring"
        - "Fault detection implemented"
        - "Safety-rated components used"

    - id: "SPS-ILK-POS-002"
      signal: "Comprehensive proof testing program"
      evidence_indicators:
        - "Regular testing performed"
        - "Full diagnostic coverage"
        - "Records maintained"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Interlock Design"
      description: "Assess interlock architecture and logic"
      duration_estimate: "45 min"

    - id: "2"
      name: "Verify Device Selection"
      description: "Check safety rating and suitability"
      duration_estimate: "30 min"

    - id: "3"
      name: "Test Each Interlock"
      description: "Functionally test all interlocks"
      duration_estimate: "90 min"

    - id: "4"
      name: "Test Fault Detection"
      description: "Verify fault detection capabilities"
      duration_estimate: "45 min"

    - id: "5"
      name: "Check for Bypasses"
      description: "Inspect for unauthorized modifications"
      duration_estimate: "30 min"

    - id: "6"
      name: "Review Testing Records"
      description: "Assess proof testing program"
      duration_estimate: "20 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Interlock Inventory"
        - "Test Results"
        - "Bypass Investigation"
        - "Recommendations"

closeout_checklist:
  - id: "sps-ilk-001"
    item: "All interlocks functional"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-ilk-002"
    item: "No bypasses found"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-ilk-003"
    item: "Fault detection verified"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["manufacturing", "industrial-machinery", "process-industries", "robotics"]

  compliance_mappings:
    - framework: "ISO 14119"
      control: "Interlocking Devices"
      description: "Guard interlock requirements"
    - framework: "ISO 13849"
      control: "Safety Functions"
      description: "Safety control requirements"
    - framework: "IEC 61511"
      control: "SIF Requirements"
      description: "Process interlock requirements"

relationships:
  commonly_combined:
    - "sensors-physical-systems.safety-systems.emergency-stop-coverage"
    - "sensors-physical-systems.safety-systems.fail-safe-modes"
  depends_on:
    - "safety.risk-assessment"
  feeds_into:
    - "compliance.machine-safety"
    - "safety.safety-certification"
