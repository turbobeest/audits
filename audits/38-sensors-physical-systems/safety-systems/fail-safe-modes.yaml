# ============================================================
# AUDIT: Fail-Safe Modes
# Category: 38 - Sensors & Physical Systems
# Subcategory: safety-systems
# ============================================================

audit:
  id: "sensors-physical-systems.safety-systems.fail-safe-modes"
  name: "Fail-Safe Modes Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "safety-systems"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates system fail-safe design including safe states for component failures,
    power loss response, communication failure handling, and graceful degradation.
    Reviews failure mode analysis, safe state definitions, and transition logic
    to safe states.

  why_it_matters: |
    Systems must respond safely to failures. Without proper fail-safe design,
    component failures can create hazardous conditions. Correct safe state
    definition and reliable transition to safe states protects personnel and
    equipment when things go wrong.

  when_to_run:
    - "During safety system design"
    - "Before commissioning"
    - "During FMEA reviews"
    - "After incidents involving failures"
    - "When modifying safety logic"

prerequisites:
  required_artifacts:
    - type: "fmea_fmeca"
      description: "Failure mode analysis"
    - type: "safe_state_definitions"
      description: "Safe state documentation"
    - type: "control_logic"
      description: "Control system logic"

  access_requirements:
    - "Control system access"
    - "Physical access for testing"
    - "Ability to inject failures"
    - "Power control access"

discovery:
  file_patterns:
    - glob: "**/*failsafe*.c"
      purpose: "Find fail-safe code"
    - glob: "**/*safe_state*.c"
      purpose: "Find safe state code"
    - glob: "**/*fault*.c"
      purpose: "Find fault handling code"
    - glob: "**/config/*safety*.yaml"
      purpose: "Find safety configuration"

knowledge_sources:
  guides:
    - id: "iec-61508"
      name: "IEC 61508 Safe State"
      url: "https://www.iec.ch/"
    - id: "fail-safe-design"
      name: "Fail-Safe Design Principles"
      url: "https://www.isa.org/"

  standards:
    - id: "iec-61508"
      name: "IEC 61508 Functional Safety"
      relevance: "Safe state requirements"
    - id: "iso-13849"
      name: "ISO 13849 Safety of Machinery"
      relevance: "Machine safe state"
    - id: "iec-62443"
      name: "IEC 62443 Industrial Security"
      relevance: "Security fail-safe"

tooling:
  analysis_tools:
    - tool: "fault-injection"
      purpose: "Failure simulation"
    - tool: "power-controller"
      purpose: "Power failure testing"
    - tool: "network-simulator"
      purpose: "Communication failure testing"
    - tool: "timing-analyzer"
      purpose: "Transition time measurement"

signals:
  critical:
    - id: "SPS-FSM-CRIT-001"
      signal: "System does not reach safe state on failure"
      evidence_indicators:
        - "Hazardous condition persists after failure"
        - "No automatic safe state transition"
        - "Safe state not defined for failure mode"
      explanation: |
        A system that cannot reliably reach a safe state on failure can allow
        hazardous conditions to develop or persist, creating serious risk of
        injury or damage.
      remediation: "Implement safe state transition for all identified failure modes"

    - id: "SPS-FSM-CRIT-002"
      signal: "Safe state incorrectly defined"
      evidence_indicators:
        - "Defined safe state is actually hazardous"
        - "Safe state doesn't address hazard"
        - "Multiple conflicting safe states"
      explanation: |
        An incorrectly defined safe state provides no protection. The system
        may transition to this state believing it is safe while personnel
        remain exposed to hazards.
      remediation: "Redefine safe state based on hazard analysis"

  high:
    - id: "SPS-FSM-HIGH-001"
      signal: "Safe state transition too slow"
      evidence_indicators:
        - "Transition time exceeds safe fault time"
        - "Hazard exposure during transition"
        - "No defined transition time requirement"
      remediation: "Reduce transition time or implement interim protection"

    - id: "SPS-FSM-HIGH-002"
      signal: "Power loss response inadequate"
      evidence_indicators:
        - "Undefined state on power loss"
        - "Stored energy hazard remains"
        - "No energy isolation"
      remediation: "Implement proper power loss safe state"

  medium:
    - id: "SPS-FSM-MED-001"
      signal: "Not all failure modes analyzed"
      evidence_indicators:
        - "FMEA incomplete"
        - "Failure modes not systematically identified"
        - "New components not analyzed"
      remediation: "Complete comprehensive failure mode analysis"

    - id: "SPS-FSM-MED-002"
      signal: "Graceful degradation not implemented"
      evidence_indicators:
        - "Minor failures cause full shutdown"
        - "No partial operation capability"
        - "Unnecessary downtime"
      remediation: "Implement graceful degradation where appropriate"

  low:
    - id: "SPS-FSM-LOW-001"
      signal: "Safe states not documented"
      evidence_indicators:
        - "Safe state definitions missing"
        - "Transition logic not documented"
        - "Testing procedures not defined"
      remediation: "Document all safe states and transitions"

    - id: "SPS-FSM-LOW-002"
      signal: "Safe state transitions not tested"
      evidence_indicators:
        - "No failure injection testing"
        - "Transitions assumed not verified"
        - "Testing records missing"
      remediation: "Implement safe state transition testing"

  positive:
    - id: "SPS-FSM-POS-001"
      signal: "Comprehensive fail-safe design"
      evidence_indicators:
        - "All failure modes addressed"
        - "Safe states properly defined"
        - "Transitions verified"

    - id: "SPS-FSM-POS-002"
      signal: "Robust failure detection and response"
      evidence_indicators:
        - "Failures detected quickly"
        - "Automatic safe state transition"
        - "Clear operator notification"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Failure Mode Analysis"
      description: "Assess FMEA/FMECA completeness"
      duration_estimate: "45 min"

    - id: "2"
      name: "Verify Safe State Definitions"
      description: "Confirm safe states address hazards"
      duration_estimate: "45 min"

    - id: "3"
      name: "Test Failure Responses"
      description: "Inject failures and verify response"
      duration_estimate: "90 min"

    - id: "4"
      name: "Test Power Loss Response"
      description: "Verify power failure behavior"
      duration_estimate: "30 min"

    - id: "5"
      name: "Test Communication Failures"
      description: "Verify network failure response"
      duration_estimate: "30 min"

    - id: "6"
      name: "Verify Transition Times"
      description: "Measure time to safe state"
      duration_estimate: "30 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Failure Mode Coverage"
        - "Safe State Assessment"
        - "Transition Testing Results"
        - "Recommendations"

closeout_checklist:
  - id: "sps-fsm-001"
    item: "All failure modes reach safe state"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-fsm-002"
    item: "Safe states properly defined"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-fsm-003"
    item: "Transition times acceptable"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["safety-critical-systems", "industrial-automation", "process-control", "medical-devices"]

  compliance_mappings:
    - framework: "IEC 61508"
      control: "Safe State"
      description: "Functional safety safe state"
    - framework: "ISO 13849"
      control: "Fail-Safe"
      description: "Machinery fail-safe"
    - framework: "IEC 62443"
      control: "SR 7.1"
      description: "Fail-safe requirements"

relationships:
  commonly_combined:
    - "sensors-physical-systems.safety-systems.emergency-stop-coverage"
    - "sensors-physical-systems.safety-systems.interlock-verification"
  depends_on:
    - "safety.fmea-fmeca"
  feeds_into:
    - "compliance.functional-safety"
    - "reliability.failure-response"
