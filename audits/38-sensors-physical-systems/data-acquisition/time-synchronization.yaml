# ============================================================
# AUDIT: Time Synchronization
# Category: 38 - Sensors & Physical Systems
# Subcategory: data-acquisition
# ============================================================

audit:
  id: "sensors-physical-systems.data-acquisition.time-synchronization"
  name: "Time Synchronization Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "sensors-physical-systems"
  category_number: 38
  subcategory: "data-acquisition"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "physical-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates time synchronization mechanisms for sensor data including timestamping
    accuracy, clock synchronization protocols (NTP, PTP/IEEE 1588, GPS), time source
    integrity, holdover capabilities, and synchronization monitoring. Reviews how
    time is distributed, maintained, and validated across the system.

  why_it_matters: |
    Accurate time synchronization is essential for correlating data from multiple
    sensors, event sequencing, control system timing, and forensic analysis.
    Synchronization errors can cause incorrect data fusion, control instability,
    or inability to reconstruct events during incident investigation.

  when_to_run:
    - "During system architecture design"
    - "When timing issues observed"
    - "After clock source changes"
    - "Before system commissioning"
    - "During forensic capability reviews"

prerequisites:
  required_artifacts:
    - type: "timing_architecture"
      description: "Time synchronization architecture documentation"
    - type: "timing_requirements"
      description: "Application timing accuracy requirements"
    - type: "config_files"
      description: "Time synchronization configuration"

  access_requirements:
    - "Access to time synchronization systems"
    - "Access to timing measurement equipment"
    - "Network access for protocol analysis"
    - "GPS/time source access"

discovery:
  file_patterns:
    - glob: "**/time/**"
      purpose: "Find time synchronization code"
    - glob: "**/*ptp*.c"
      purpose: "Find PTP implementation"
    - glob: "**/*ntp*.conf"
      purpose: "Find NTP configuration"
    - glob: "**/timestamp/**"
      purpose: "Find timestamping code"

knowledge_sources:
  guides:
    - id: "ieee-1588"
      name: "IEEE 1588 Precision Time Protocol"
      url: "https://www.nist.gov/pml/time-and-frequency-division/time-services/precision-time-protocol"
    - id: "ntp-guide"
      name: "NTP Documentation"
      url: "https://www.ntp.org/"

  standards:
    - id: "ieee-1588"
      name: "IEEE 1588 PTP"
      relevance: "Precision time synchronization"
    - id: "iec-61850"
      name: "IEC 61850 Substation Automation"
      relevance: "Power system time sync requirements"
    - id: "iec-62439"
      name: "IEC 62439 High Availability Networks"
      relevance: "Network timing requirements"

tooling:
  analysis_tools:
    - tool: "ptp-analyzer"
      purpose: "PTP performance analysis"
    - tool: "oscilloscope"
      purpose: "Timing measurement"
    - tool: "gps-receiver"
      purpose: "Time reference"
    - tool: "network-analyzer"
      purpose: "Protocol timing analysis"

signals:
  critical:
    - id: "SPS-TIM-CRIT-001"
      signal: "Time synchronization insufficient for safety applications"
      evidence_indicators:
        - "Synchronization accuracy exceeds safety requirements"
        - "Time source unreliable"
        - "No holdover during source loss"
      explanation: |
        Safety applications requiring precise timing depend on accurate
        synchronization. Inadequate synchronization can cause incorrect
        sequence of events reconstruction or control timing violations.
      remediation: "Implement synchronization meeting safety timing requirements"

    - id: "SPS-TIM-CRIT-002"
      signal: "Time source integrity not verified"
      evidence_indicators:
        - "Time source not authenticated"
        - "GPS spoofing not mitigated"
        - "No redundant time sources"
      explanation: |
        Compromised or spoofed time sources can cause synchronized systems
        to operate with incorrect time, affecting safety systems, control
        sequences, and audit trails.
      remediation: "Implement authenticated time sources with redundancy"

  high:
    - id: "SPS-TIM-HIGH-001"
      signal: "Synchronization error not monitored"
      evidence_indicators:
        - "No synchronization accuracy monitoring"
        - "Clock drift not detected"
        - "Synchronization failures not alarmed"
      remediation: "Implement synchronization monitoring with alerting"

    - id: "SPS-TIM-HIGH-002"
      signal: "Timestamp resolution insufficient"
      evidence_indicators:
        - "Timestamps too coarse for application"
        - "Events indistinguishable in time"
        - "Sequence reconstruction impossible"
      remediation: "Improve timestamp resolution to meet application needs"

  medium:
    - id: "SPS-TIM-MED-001"
      signal: "Holdover performance inadequate"
      evidence_indicators:
        - "Rapid drift when source lost"
        - "No indication of holdover mode"
        - "Synchronization not restored properly"
      remediation: "Improve holdover capability with better oscillators"

    - id: "SPS-TIM-MED-002"
      signal: "Time distribution architecture suboptimal"
      evidence_indicators:
        - "Excessive synchronization hops"
        - "Asymmetric network paths"
        - "Jitter in time distribution"
      remediation: "Optimize time distribution topology"

  low:
    - id: "SPS-TIM-LOW-001"
      signal: "Time synchronization not documented"
      evidence_indicators:
        - "Synchronization architecture not recorded"
        - "Configuration not documented"
        - "Accuracy requirements not specified"
      remediation: "Document time synchronization architecture"

    - id: "SPS-TIM-LOW-002"
      signal: "No regular synchronization verification"
      evidence_indicators:
        - "Accuracy not periodically verified"
        - "No synchronization testing"
        - "Drift trends not analyzed"
      remediation: "Implement periodic synchronization verification"

  positive:
    - id: "SPS-TIM-POS-001"
      signal: "Redundant synchronized time sources"
      evidence_indicators:
        - "Multiple independent time sources"
        - "Automatic failover"
        - "Source integrity verification"

    - id: "SPS-TIM-POS-002"
      signal: "Synchronization accuracy continuously monitored"
      evidence_indicators:
        - "Real-time accuracy display"
        - "Historical trend analysis"
        - "Proactive alerts for degradation"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Timing Requirements"
      description: "Understand application timing accuracy needs"
      duration_estimate: "20 min"

    - id: "2"
      name: "Assess Synchronization Architecture"
      description: "Review time distribution design"
      duration_estimate: "45 min"

    - id: "3"
      name: "Verify Time Source Integrity"
      description: "Check time source reliability and security"
      duration_estimate: "30 min"

    - id: "4"
      name: "Measure Synchronization Accuracy"
      description: "Verify actual synchronization performance"
      duration_estimate: "60 min"

    - id: "5"
      name: "Test Holdover Performance"
      description: "Assess behavior during source loss"
      duration_estimate: "30 min"

    - id: "6"
      name: "Review Monitoring and Alerting"
      description: "Verify synchronization monitoring"
      duration_estimate: "20 min"

    - id: "7"
      name: "Document Findings"
      description: "Compile findings and recommendations"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Architecture Assessment"
        - "Accuracy Verification"
        - "Source Integrity Review"
        - "Recommendations"

closeout_checklist:
  - id: "sps-tim-001"
    item: "Synchronization meets accuracy requirements"
    level: "CRITICAL"
    verification: "manual"

  - id: "sps-tim-002"
    item: "Time source integrity verified"
    level: "WARNING"
    verification: "manual"

  - id: "sps-tim-003"
    item: "Monitoring and alerting in place"
    level: "INFO"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["industrial-automation", "power-systems", "telecommunications", "financial-systems"]

  compliance_mappings:
    - framework: "IEEE 1588"
      control: "PTP Profile"
      description: "Precision time protocol compliance"
    - framework: "IEC 61850"
      control: "Time Sync"
      description: "Substation time synchronization"
    - framework: "NERC CIP"
      control: "CIP-007"
      description: "System security and time sync"

relationships:
  commonly_combined:
    - "sensors-physical-systems.sensor-integration.data-fusion"
    - "sensors-physical-systems.data-acquisition.sampling-rate-optimization"
  depends_on:
    - "infrastructure.network-infrastructure"
  feeds_into:
    - "logging.event-sequencing"
    - "forensics.timeline-reconstruction"
