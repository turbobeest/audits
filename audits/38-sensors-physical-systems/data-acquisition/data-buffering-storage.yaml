audit:
  id: sensors-physical-systems.data-acquisition.data-buffering-storage
  name: Data Buffering and Storage Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: sensors-physical-systems
  category_number: 38
  subcategory: data-acquisition
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: physical-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews data buffering strategies, buffer sizing, overflow handling, data
    persistence mechanisms, and storage management for sensor data acquisition.
    Examines circular buffers, event-triggered capture, pre-trigger storage,
    and data compression approaches.
  why_it_matters: |
    Proper data buffering prevents data loss during peak loads, system interruptions,
    or communication delays. Inadequate buffering can cause missed samples, corrupted
    data, or inability to capture transient events critical for analysis and
    troubleshooting.
  when_to_run:
  - During data acquisition design
  - When data loss occurs
  - Before high-rate data capture
  - During system optimization
  - When storage capacity limited
prerequisites:
  required_artifacts:
  - type: buffer_config
    description: Buffer configuration documentation
  - type: data_rates
    description: Expected data rates and patterns
  - type: storage_specs
    description: Storage system specifications
  access_requirements:
  - Access to buffer configuration
  - Access to storage systems
  - Ability to monitor buffer status
  - Load testing capability
discovery:
  file_patterns:
  - glob: '**/*buffer*.c'
    purpose: Find buffer implementation code
  - glob: '**/storage/**'
    purpose: Find storage code
  - glob: '**/*queue*.c'
    purpose: Find queue implementations
  - glob: '**/daq/**'
    purpose: Find data acquisition code
knowledge_sources:
  guides:
  - id: real-time-systems
    name: Real-Time Systems Design
    url: https://www.embedded.com/
  - id: data-management
    name: Industrial Data Management
    url: https://www.isa.org/
  standards:
  - id: iec-61131-3
    name: IEC 61131-3 PLC Programming
    relevance: Data handling requirements
  - id: opc-ua
    name: OPC UA Data Access
    relevance: Industrial data access patterns
tooling:
  analysis_tools:
  - tool: memory-analyzer
    purpose: Buffer usage analysis
  - tool: load-generator
    purpose: Stress testing
  - tool: performance-monitor
    purpose: Buffer performance monitoring
  - tool: storage-analyzer
    purpose: Storage utilization analysis
signals:
  critical:
  - id: SPS-BUF-CRIT-001
    signal: Safety-critical data lost due to buffer overflow
    evidence_indicators:
    - Safety data dropped during overflow
    - No overflow detection for critical data
    - Critical events missed
    explanation: |
      Loss of safety-critical sensor data can prevent proper safety system
      response or forensic analysis of incidents. Critical data must have
      guaranteed delivery or overflow handling.
    remediation: Implement guaranteed buffering for safety-critical data
  - id: SPS-BUF-CRIT-002
    signal: Buffer overflow corrupts data integrity
    evidence_indicators:
    - Overflow overwrites valid data
    - Partial records created
    - Data corruption on overflow
    explanation: |
      Improper overflow handling can corrupt not just lost data but also
      adjacent valid data in the buffer, making remaining data unreliable.
    remediation: Implement proper overflow handling preserving data integrity
  high:
  - id: SPS-BUF-HIGH-001
    signal: Buffer sizing inadequate for peak loads
    evidence_indicators:
    - Overflow during normal operation
    - Insufficient burst capacity
    - No buffer size analysis
    remediation: Size buffers based on worst-case data rates
  - id: SPS-BUF-HIGH-002
    signal: No pre-trigger data capture for events
    evidence_indicators:
    - Cannot see data before trigger
    - Event context missing
    - Root cause analysis limited
    remediation: Implement circular buffer with pre-trigger capture
  medium:
  - id: SPS-BUF-MED-001
    signal: Buffer status not monitored
    evidence_indicators:
    - Fill level not tracked
    - Overflow not reported
    - No buffer health metrics
    remediation: Implement buffer status monitoring and alerting
  - id: SPS-BUF-MED-002
    signal: Storage management not automated
    evidence_indicators:
    - Manual storage cleanup required
    - Storage can fill unexpectedly
    - No retention policy
    remediation: Implement automated storage management
  low:
  - id: SPS-BUF-LOW-001
    signal: Buffer design not documented
    evidence_indicators:
    - Buffer sizes not justified
    - Overflow policy not documented
    - Design rationale missing
    remediation: Document buffer design and sizing rationale
  - id: SPS-BUF-LOW-002
    signal: Data compression not optimized
    evidence_indicators:
    - Excessive storage used
    - Compression not applied where beneficial
    - Compression ratio not monitored
    remediation: Evaluate and implement appropriate compression
  positive:
  - id: SPS-BUF-POS-001
    signal: Robust buffering with graceful overflow handling
    evidence_indicators:
    - Priority-based data retention
    - Graceful degradation on overflow
    - No data corruption
  - id: SPS-BUF-POS-002
    signal: Comprehensive storage lifecycle management
    evidence_indicators:
    - Automated archival
    - Configurable retention
    - Storage monitoring and alerting
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Analyze Data Rates
    description: Understand expected and peak data rates
    duration_estimate: 30 min
  - id: '2'
    name: Review Buffer Design
    description: Assess buffer architecture and sizing
    duration_estimate: 30 min
  - id: '3'
    name: Test Overflow Handling
    description: Verify behavior during buffer overflow
    duration_estimate: 45 min
  - id: '4'
    name: Assess Storage Management
    description: Review storage allocation and lifecycle
    duration_estimate: 30 min
  - id: '5'
    name: Test Under Load
    description: Verify performance under peak conditions
    duration_estimate: 45 min
  - id: '6'
    name: Review Monitoring
    description: Assess buffer and storage monitoring
    duration_estimate: 20 min
  - id: '7'
    name: Document Findings
    description: Compile findings and recommendations
    duration_estimate: 20 min
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Buffer Analysis
    - Overflow Testing Results
    - Storage Assessment
    - Recommendations
closeout_checklist:
- id: sps-buf-001
  item: Critical data buffering verified
  level: CRITICAL
  verification: manual
- id: sps-buf-002
  item: Overflow handling tested
  level: WARNING
  verification: manual
- id: sps-buf-003
  item: Storage management adequate
  level: INFO
  verification: manual
governance:
  applicable_to:
    archetypes:
    - iot-systems
    - industrial-automation
    - data-loggers
    - scada-systems
  compliance_mappings:
  - framework: IEC 61508
    control: 7.4.6
    description: Data storage requirements
  - framework: FDA 21 CFR Part 11
    control: '11.10'
    description: Electronic record integrity
  - framework: NERC CIP
    control: CIP-007
    description: Data retention requirements
relationships:
  commonly_combined:
  - sensors-physical-systems.data-acquisition.sampling-rate-optimization
  - storage.data-retention
  depends_on:
  - infrastructure.storage-infrastructure
  feeds_into:
  - archival.data-archival
  - analytics.historical-analysis
