# ============================================================
# AUDIT: Disaster Recovery Documentation
# Category: 27 - Documentation & Knowledge
# Subcategory: operational-docs
# ============================================================

audit:
  id: "documentation-knowledge.operational-docs.disaster-recovery-docs"
  name: "Disaster Recovery Documentation Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "documentation-knowledge"
  category_number: 27
  subcategory: "operational-docs"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "documentation"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates disaster recovery (DR) documentation including
    recovery procedures, RTO/RPO targets, failover processes, data restoration
    guides, and business continuity plans. The audit examines whether DR
    documentation enables effective recovery from major outages and data loss
    scenarios.

  why_it_matters: |
    When disasters strike, organizations must recover quickly with minimal
    data loss. Without comprehensive, tested DR documentation, recovery
    becomes chaotic and error-prone, extending downtime and potentially
    causing permanent data loss. DR documentation is also required for
    compliance with many regulatory frameworks.

  when_to_run:
    - "Annually as part of DR program review"
    - "After infrastructure or architecture changes"
    - "Following DR test exercises"
    - "During compliance audits"
    - "After actual disaster events"

prerequisites:
  required_artifacts:
    - type: "dr_documentation"
      description: "Access to disaster recovery plans and procedures"
    - type: "architecture_docs"
      description: "System architecture for recovery planning"
    - type: "backup_configuration"
      description: "Backup system documentation"

  access_requirements:
    - "Read access to DR documentation"
    - "Access to backup and recovery systems documentation"
    - "Interview access with DR team"

discovery:
  file_patterns:
    - glob: "**/disaster-recovery/**/*.md"
      purpose: "Find DR documentation"
    - glob: "**/dr/**/*.md"
      purpose: "Find DR plans"
    - glob: "**/business-continuity/**/*"
      purpose: "Find BCP documentation"
    - glob: "**/backup/**/*.md"
      purpose: "Find backup documentation"
    - glob: "**/recovery/**/*.md"
      purpose: "Find recovery procedures"

  interview_questions:
    - role: "DR Coordinator"
      questions:
        - "Where is DR documentation maintained?"
        - "When was DR documentation last updated?"
        - "When were DR procedures last tested?"
        - "What gaps exist in DR coverage?"

knowledge_sources:
  guides:
    - id: "nist-dr"
      name: "NIST SP 800-34 - Contingency Planning Guide"
      url: "https://csrc.nist.gov/publications/detail/sp/800-34/rev-1/final"
      offline_cache: true

    - id: "aws-dr"
      name: "AWS Disaster Recovery Whitepaper"
      url: "https://docs.aws.amazon.com/whitepapers/latest/disaster-recovery-workloads-on-aws/disaster-recovery-workloads-on-aws.html"
      offline_cache: true

  standards:
    - id: "iso-22301"
      name: "ISO 22301 Business Continuity"
      relevance: "International standard for BCM"

tooling:
  analysis_commands:
    - purpose: "Find DR documentation"
      command: "find . -type f -name '*.md' | xargs grep -l -i 'disaster\\|recovery\\|failover' | head -20"

    - purpose: "Check for RTO/RPO definitions"
      command: "grep -r -i 'RTO\\|RPO\\|recovery time\\|recovery point' --include='*.md'"

    - purpose: "Find backup documentation"
      command: "find . -name '*backup*' -type f \\( -name '*.md' -o -name '*.yaml' \\)"

signals:
  critical:
    - id: "DR-CRIT-001"
      signal: "No disaster recovery documentation exists"
      evidence_indicators:
        - "No DR plans documented"
        - "Recovery procedures only in people's heads"
        - "No backup restoration procedures"
      explanation: |
        Without DR documentation, recovery from disasters will be chaotic,
        extended, and potentially unsuccessful. This represents a critical
        business risk.
      remediation: "Create DR documentation as highest priority"

    - id: "DR-CRIT-002"
      signal: "DR procedures never tested"
      evidence_indicators:
        - "No DR drill records"
        - "Recovery procedures untested"
        - "Last DR test >24 months ago"
      explanation: |
        Untested DR procedures may not work when needed. Issues are
        only discovered during actual disasters when it's too late.
      remediation: "Conduct DR drill and update documentation based on results"

    - id: "DR-CRIT-003"
      signal: "RTO/RPO targets undefined"
      evidence_indicators:
        - "No recovery time objectives documented"
        - "No recovery point objectives documented"
        - "Business impact analysis not conducted"
      explanation: |
        Without RTO/RPO targets, teams cannot design appropriate DR
        solutions or verify recovery capabilities meet business needs.
      remediation: "Conduct BIA and define RTO/RPO for all critical systems"

  high:
    - id: "DR-HIGH-001"
      signal: "DR documentation outdated after architecture changes"
      evidence_indicators:
        - "Documentation references old infrastructure"
        - "Recovery procedures don't match current architecture"
        - "New systems not included in DR plans"
      explanation: |
        Outdated DR documentation may lead to incomplete recovery
        or recovery procedures that fail.
      remediation: "Update DR documentation with each architecture change"

    - id: "DR-HIGH-002"
      signal: "Backup restoration procedures not documented"
      evidence_indicators:
        - "Backup configuration documented but not restoration"
        - "No step-by-step restoration guide"
        - "Restoration never tested"
      explanation: |
        Backups are worthless if they cannot be restored. Restoration
        procedures must be documented and tested.
      remediation: "Document and test restoration procedures for all backups"

    - id: "DR-HIGH-003"
      signal: "DR documentation not accessible during disasters"
      evidence_indicators:
        - "Documentation only in potentially affected systems"
        - "No offline copies of DR procedures"
        - "Access depends on affected infrastructure"
      explanation: |
        DR documentation must be accessible when primary systems are down.
        If it's only stored in affected systems, it won't help.
      remediation: "Ensure DR docs accessible from independent location"

  medium:
    - id: "DR-MED-001"
      signal: "Communication procedures not documented"
      explanation: |
        DR events require communication with stakeholders, customers,
        and potentially regulators. Procedures must be documented.
      remediation: "Document communication plans and templates"

    - id: "DR-MED-002"
      signal: "DR roles and responsibilities unclear"
      remediation: "Document DR team roles and contact information"

    - id: "DR-MED-003"
      signal: "Third-party dependencies not addressed in DR"
      remediation: "Document DR considerations for all third-party services"

  low:
    - id: "DR-LOW-001"
      signal: "DR documentation formatting inconsistent"
      remediation: "Standardize DR documentation format"

    - id: "DR-LOW-002"
      signal: "DR test results not documented"
      remediation: "Document all DR test results and improvements"

  positive:
    - id: "DR-POS-001"
      signal: "Comprehensive DR documentation with tested procedures"
    - id: "DR-POS-002"
      signal: "RTO/RPO targets defined and validated"
    - id: "DR-POS-003"
      signal: "Regular DR drills with documentation updates"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Critical Systems"
      description: |
        Identify all systems requiring DR documentation based on
        criticality and regulatory requirements.
      duration_estimate: "45 min"
      expected_findings:
        - "Critical system inventory"
        - "Regulatory requirements"
        - "Business impact classification"

    - id: "2"
      name: "Review DR Documentation Coverage"
      description: |
        Map existing DR documentation to critical systems and identify gaps.
      duration_estimate: "60 min"
      commands:
        - purpose: "Find DR documentation"
          command: "find . -type f \\( -name '*disaster*' -o -name '*recovery*' -o -name '*dr-*' \\) -name '*.md'"
      expected_findings:
        - "Coverage matrix"
        - "Documentation gaps"

    - id: "3"
      name: "Evaluate DR Plan Quality"
      description: |
        Review DR plans for completeness and actionability.
      duration_estimate: "60 min"
      quality_checklist:
        - "Scope and objectives defined"
        - "RTO/RPO targets documented"
        - "Recovery procedures step-by-step"
        - "Roles and responsibilities"
        - "Communication procedures"
        - "Dependencies identified"
        - "Testing requirements"
        - "Maintenance schedule"
      expected_findings:
        - "Quality assessment"
        - "Missing elements"

    - id: "4"
      name: "Verify Backup Documentation"
      description: |
        Review backup and restoration documentation for completeness.
      duration_estimate: "45 min"
      quality_checklist:
        - "Backup schedules documented"
        - "Retention policies defined"
        - "Restoration procedures step-by-step"
        - "Restoration testing records"
        - "Backup verification procedures"
      expected_findings:
        - "Backup documentation status"
        - "Restoration procedure gaps"

    - id: "5"
      name: "Assess DR Testing Evidence"
      description: |
        Review DR testing history and documentation.
      duration_estimate: "30 min"
      questions:
        - "When was the last DR test conducted?"
        - "What was tested and what gaps were found?"
        - "Were documentation updates made after testing?"
        - "What is the DR testing schedule?"
      expected_findings:
        - "Testing maturity assessment"
        - "Testing gaps"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "DR Coverage Analysis"
        - "Plan Quality Assessment"
        - "Backup Documentation Review"
        - "Testing Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "DR procedures validated through testing"
    medium: "Documentation reviewed without practical testing"
    low: "Existence check only"

closeout_checklist:
  - id: "dr-001"
    item: "DR plans exist for all critical systems"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Compare critical systems with DR documentation"
    expected: "100% coverage for Tier 1 systems"

  - id: "dr-002"
    item: "RTO/RPO targets defined"
    level: "CRITICAL"
    verification: "grep -r 'RTO\\|RPO' dr-plans/"
    expected: "All critical systems have targets"

  - id: "dr-003"
    item: "DR procedures tested within last 12 months"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Review DR test records"
    expected: "Annual DR testing completed"

  - id: "dr-004"
    item: "Backup restoration procedures documented and tested"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Review restoration documentation and test records"
    expected: "Restoration tested for all critical data"

  - id: "dr-005"
    item: "DR documentation accessible independently"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Test access from outside primary infrastructure"
    expected: "Multiple access paths documented"

governance:
  applicable_to:
    archetypes: ["all-production-systems"]

  compliance_mappings:
    - framework: "SOC 2"
      control: "A1.2"
      description: "Recovery procedures documented and tested"

    - framework: "ISO 27001"
      control: "A.17.1"
      description: "Information security continuity"

    - framework: "PCI DSS"
      control: "12.10"
      description: "Incident response plan"

    - framework: "HIPAA"
      control: "164.308(a)(7)"
      description: "Contingency plan"

relationships:
  commonly_combined:
    - "business-continuity.bcp-documentation"
    - "backup.backup-verification"

  depends_on:
    - "architecture.system-documentation"

  feeds_into:
    - "compliance.audit-readiness"
    - "risk-management.business-continuity-risk"
