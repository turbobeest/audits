# ============================================================
# AUDIT: Scaling Architecture Documentation
# Category: 27 - Documentation & Knowledge
# Subcategory: architecture-docs
# ============================================================

audit:
  id: "documentation-knowledge.architecture-docs.scaling-architecture-docs"
  name: "Scaling Architecture Documentation Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "documentation-knowledge"
  category_number: 27
  subcategory: "architecture-docs"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "documentation"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates documentation of scaling strategies, capacity
    planning, and performance architecture. This includes horizontal and
    vertical scaling approaches, auto-scaling configuration, bottleneck
    identification, and capacity management procedures.

  why_it_matters: |
    As systems grow, understanding how they scale becomes critical.
    Without scaling documentation, teams may make changes that break
    scalability, fail to provision capacity appropriately, or be
    unprepared for traffic spikes.

  when_to_run:
    - "Before major growth events"
    - "During capacity planning"
    - "After scaling incidents"
    - "When reviewing architecture for scale"

prerequisites:
  required_artifacts:
    - type: "scaling_docs"
      description: "Access to scaling documentation"
    - type: "infrastructure_config"
      description: "Access to infrastructure configuration"

  access_requirements:
    - "Read access to architecture documentation"
    - "Access to infrastructure configuration"

discovery:
  file_patterns:
    - glob: "**/docs/scaling*.md"
      purpose: "Find scaling documentation"
    - glob: "**/docs/capacity*.md"
      purpose: "Find capacity documentation"
    - glob: "**/docs/performance*.md"
      purpose: "Find performance documentation"
    - glob: "**/autoscaling*.yaml"
      purpose: "Find autoscaling configuration"
    - glob: "**/hpa*.yaml"
      purpose: "Find Kubernetes HPA config"

knowledge_sources:
  guides:
    - id: "aws-scaling"
      name: "AWS Auto Scaling"
      url: "https://docs.aws.amazon.com/autoscaling/"
      offline_cache: true

    - id: "k8s-hpa"
      name: "Kubernetes Horizontal Pod Autoscaling"
      url: "https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/"
      offline_cache: true

tooling:
  analysis_commands:
    - purpose: "Find scaling documentation"
      command: "find . -name '*scal*' -o -name '*capacity*' | grep -E '\\.(md|txt)$'"

    - purpose: "Find autoscaling configuration"
      command: "find . -name '*autoscal*' -o -name 'hpa*' | grep -E '\\.(yaml|yml)$'"

    - purpose: "Find resource limits"
      command: "grep -r 'resources:\\|limits:\\|requests:' --include='*.yaml'"

signals:
  critical:
    - id: "SCALING-CRIT-001"
      signal: "No scaling documentation exists"
      evidence_indicators:
        - "Scaling approach undocumented"
        - "Capacity limits unknown"
        - "Teams don't know how to scale"
      explanation: |
        Without scaling documentation, the system cannot be safely
        scaled, and capacity incidents may be unrecoverable.
      remediation: "Document scaling architecture and procedures"

  high:
    - id: "SCALING-HIGH-001"
      signal: "Capacity limits not documented"
      evidence_indicators:
        - "Maximum capacity unknown"
        - "Breaking points not identified"
        - "No load testing documentation"
      explanation: |
        Without documented capacity limits, teams cannot plan for
        growth or identify when scaling is needed.
      remediation: "Document capacity limits and breaking points"

    - id: "SCALING-HIGH-002"
      signal: "Auto-scaling configuration not documented"
      evidence_indicators:
        - "Auto-scaling exists but not explained"
        - "Thresholds not documented"
        - "Scaling behavior unpredictable"
      explanation: |
        Undocumented auto-scaling leads to confusion about system
        behavior under load.
      remediation: "Document auto-scaling configuration and behavior"

    - id: "SCALING-HIGH-003"
      signal: "Known bottlenecks not documented"
      evidence_indicators:
        - "Scaling constraints unknown"
        - "Single points of failure undocumented"
        - "Database scaling limits unclear"
      explanation: |
        Undocumented bottlenecks may be hit unexpectedly, causing
        outages.
      remediation: "Document all known scaling bottlenecks"

  medium:
    - id: "SCALING-MED-001"
      signal: "Scaling procedures not documented"
      explanation: |
        Manual scaling procedures should be documented for emergencies
        when auto-scaling is insufficient.
      remediation: "Document manual scaling procedures"

    - id: "SCALING-MED-002"
      signal: "Cost implications of scaling not documented"
      remediation: "Document cost impact of scaling decisions"

    - id: "SCALING-MED-003"
      signal: "Database scaling strategy not documented"
      remediation: "Document database scaling approach"

  low:
    - id: "SCALING-LOW-001"
      signal: "Capacity planning process not documented"
      remediation: "Document capacity planning procedures"

    - id: "SCALING-LOW-002"
      signal: "Historical capacity data not referenced"
      remediation: "Link to capacity monitoring dashboards"

  positive:
    - id: "SCALING-POS-001"
      signal: "Comprehensive scaling documentation"
    - id: "SCALING-POS-002"
      signal: "Regular capacity planning reviews documented"
    - id: "SCALING-POS-003"
      signal: "Load testing results documented"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Locate Scaling Documentation"
      description: |
        Find all scaling and capacity documentation.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find scaling docs"
          command: "find . -name '*scal*' -o -name '*capacity*' | grep -E '\\.(md|txt)$'"
        - purpose: "Find infrastructure config"
          command: "find . -name '*autoscal*' -o -name 'hpa*'"
      expected_findings:
        - "Documentation inventory"
        - "Configuration inventory"

    - id: "2"
      name: "Evaluate Scaling Strategy Documentation"
      description: |
        Review documentation of scaling approach.
      duration_estimate: "45 min"
      documentation_checklist:
        - "Horizontal vs vertical scaling approach"
        - "Auto-scaling configuration"
        - "Scaling triggers and thresholds"
        - "Maximum scale limits"
        - "Minimum baseline capacity"
      expected_findings:
        - "Strategy documentation status"
        - "Missing strategy elements"

    - id: "3"
      name: "Review Capacity Documentation"
      description: |
        Evaluate capacity limits and planning documentation.
      duration_estimate: "45 min"
      capacity_checklist:
        - "Current capacity baseline"
        - "Maximum tested capacity"
        - "Known bottlenecks"
        - "Capacity forecasting"
        - "Growth planning"
      expected_findings:
        - "Capacity documentation status"
        - "Gaps identified"

    - id: "4"
      name: "Assess Procedure Documentation"
      description: |
        Review scaling procedures and runbooks.
      duration_estimate: "30 min"
      procedure_checklist:
        - "Manual scaling procedures"
        - "Emergency capacity procedures"
        - "Scaling verification steps"
        - "Rollback procedures"
      expected_findings:
        - "Procedure coverage"
        - "Missing procedures"

    - id: "5"
      name: "Verify Against Infrastructure"
      description: |
        Compare documentation with actual infrastructure configuration.
      duration_estimate: "40 min"
      expected_findings:
        - "Accuracy assessment"
        - "Configuration discrepancies"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Scaling Strategy Review"
        - "Capacity Documentation"
        - "Procedure Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Documentation validated against infrastructure"
    medium: "Documentation reviewed with infrastructure team"
    low: "Documentation existence review"

closeout_checklist:
  - id: "scaling-001"
    item: "Scaling strategy documented"
    level: "CRITICAL"
    verification: "find . -name '*scal*' | grep -E '\\.md$' | head -1"
    expected: "Documentation present"

  - id: "scaling-002"
    item: "Capacity limits documented"
    level: "BLOCKING"
    verification: "grep -ri 'capacity\\|limit\\|maximum' docs/scaling*.md 2>/dev/null | head -1"
    expected: "Limits documented"

  - id: "scaling-003"
    item: "Auto-scaling explained"
    level: "WARNING"
    verification: "grep -ri 'autoscal\\|hpa\\|auto.scal' docs/ 2>/dev/null | head -1"
    expected: "Auto-scaling documented"

  - id: "scaling-004"
    item: "Known bottlenecks documented"
    level: "WARNING"
    verification: "grep -ri 'bottleneck\\|constraint\\|limit' docs/architecture/ 2>/dev/null | head -1"
    expected: "Bottlenecks documented"

governance:
  applicable_to:
    archetypes: ["production-systems", "high-traffic"]

relationships:
  commonly_combined:
    - "documentation-knowledge.architecture-docs.system-architecture-docs"
    - "capacity-planning.capacity-review"

  feeds_into:
    - "capacity-management.planning"
    - "cost-optimization.scaling-costs"
