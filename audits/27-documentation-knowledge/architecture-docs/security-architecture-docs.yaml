# ============================================================
# AUDIT: Security Architecture Documentation
# Category: 27 - Documentation & Knowledge
# Subcategory: architecture-docs
# ============================================================

audit:
  id: "documentation-knowledge.architecture-docs.security-architecture-docs"
  name: "Security Architecture Documentation Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "documentation-knowledge"
  category_number: 27
  subcategory: "architecture-docs"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "documentation"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates security architecture documentation including
    authentication and authorization models, network security, data
    protection measures, threat models, and security controls. The audit
    assesses whether security design decisions are documented and
    accessible.

  why_it_matters: |
    Security architecture documentation enables consistent security
    implementation, supports security reviews, and aids incident response.
    Without it, security measures may be inconsistent, vulnerabilities
    may be harder to identify, and compliance audits become difficult.

  when_to_run:
    - "During security architecture reviews"
    - "Before compliance audits"
    - "When onboarding security team members"
    - "After security incidents"

prerequisites:
  required_artifacts:
    - type: "security_docs"
      description: "Access to security documentation"
    - type: "architecture_docs"
      description: "Access to system architecture"

  access_requirements:
    - "Read access to security documentation"
    - "Read access to security configurations"

discovery:
  file_patterns:
    - glob: "**/docs/security/**/*.md"
      purpose: "Find security documentation"
    - glob: "**/SECURITY.md"
      purpose: "Find security policy"
    - glob: "**/threat-model*.md"
      purpose: "Find threat models"
    - glob: "**/docs/auth*.md"
      purpose: "Find authentication docs"
    - glob: "**/security-policy*.yaml"
      purpose: "Find security policies"

knowledge_sources:
  guides:
    - id: "owasp-security"
      name: "OWASP Application Security"
      url: "https://owasp.org/www-project-application-security-verification-standard/"
      offline_cache: true

    - id: "threat-modeling"
      name: "Microsoft Threat Modeling"
      url: "https://docs.microsoft.com/en-us/azure/security/develop/threat-modeling-tool"
      offline_cache: true

tooling:
  analysis_commands:
    - purpose: "Find security documentation"
      command: "find . -name '*security*' | grep -E '\\.(md|txt)$'"

    - purpose: "Find auth documentation"
      command: "find . -name '*auth*' | grep -E '\\.(md|txt)$'"

    - purpose: "Find threat models"
      command: "find . -name '*threat*' -o -name '*risk*' | grep -E '\\.(md|txt)$'"

signals:
  critical:
    - id: "SECARCH-CRIT-001"
      signal: "No security architecture documentation exists"
      evidence_indicators:
        - "Security design undocumented"
        - "Security controls unknown"
        - "Security team cannot review architecture"
      explanation: |
        Without security documentation, it's impossible to understand
        or verify the security posture of the system.
      remediation: "Create security architecture documentation immediately"

    - id: "SECARCH-CRIT-002"
      signal: "Authentication model undocumented"
      evidence_indicators:
        - "Auth mechanism not described"
        - "Identity providers not documented"
        - "Session management unclear"
      explanation: |
        Authentication is a critical security control. Undocumented
        auth creates risk and complicates troubleshooting.
      remediation: "Document authentication architecture thoroughly"

  high:
    - id: "SECARCH-HIGH-001"
      signal: "Authorization model undocumented"
      evidence_indicators:
        - "Access control not described"
        - "Permission model unclear"
        - "Role definitions missing"
      explanation: |
        Without documented authorization, access control may be
        inconsistent and vulnerabilities may exist.
      remediation: "Document authorization model and permissions"

    - id: "SECARCH-HIGH-002"
      signal: "Network security architecture not documented"
      evidence_indicators:
        - "Network boundaries unclear"
        - "Firewall rules not documented"
        - "Network segmentation unknown"
      explanation: |
        Undocumented network security makes it difficult to assess
        exposure and plan security improvements.
      remediation: "Document network security architecture"

    - id: "SECARCH-HIGH-003"
      signal: "Data protection measures undocumented"
      evidence_indicators:
        - "Encryption approach not documented"
        - "Key management unclear"
        - "Data classification not documented"
      explanation: |
        Without documented data protection, compliance and security
        posture cannot be verified.
      remediation: "Document data protection measures"

  medium:
    - id: "SECARCH-MED-001"
      signal: "Threat model not documented"
      explanation: |
        Threat models help identify and prioritize security risks.
        Without them, security investment may be misaligned.
      remediation: "Create and document threat model"

    - id: "SECARCH-MED-002"
      signal: "Security logging and monitoring not documented"
      remediation: "Document security logging and monitoring"

    - id: "SECARCH-MED-003"
      signal: "Secrets management not documented"
      remediation: "Document secrets management approach"

  low:
    - id: "SECARCH-LOW-001"
      signal: "Security architecture diagrams missing"
      remediation: "Create security-focused architecture diagrams"

    - id: "SECARCH-LOW-002"
      signal: "Security decision rationale not documented"
      remediation: "Document reasoning behind security choices"

  positive:
    - id: "SECARCH-POS-001"
      signal: "Comprehensive security architecture documentation"
    - id: "SECARCH-POS-002"
      signal: "Threat model maintained and reviewed"
    - id: "SECARCH-POS-003"
      signal: "Security controls mapped to requirements"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Locate Security Documentation"
      description: |
        Find all security architecture documentation.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find security docs"
          command: "find . -name '*security*' | grep -E '\\.(md|txt)$'"
        - purpose: "Find SECURITY.md"
          command: "find . -name 'SECURITY.md'"
      expected_findings:
        - "Documentation inventory"
        - "Coverage areas"

    - id: "2"
      name: "Evaluate Authentication Documentation"
      description: |
        Review authentication architecture documentation.
      duration_estimate: "45 min"
      auth_checklist:
        - "Authentication mechanisms"
        - "Identity providers"
        - "Session management"
        - "Token handling"
        - "MFA support"
      expected_findings:
        - "Auth documentation status"
        - "Missing auth documentation"

    - id: "3"
      name: "Review Authorization Documentation"
      description: |
        Evaluate authorization model documentation.
      duration_estimate: "45 min"
      authz_checklist:
        - "Access control model (RBAC, ABAC, etc.)"
        - "Permission definitions"
        - "Role hierarchy"
        - "Resource-level access"
      expected_findings:
        - "Authz documentation status"
        - "Missing documentation"

    - id: "4"
      name: "Assess Data Security Documentation"
      description: |
        Review data protection documentation.
      duration_estimate: "45 min"
      data_security_checklist:
        - "Encryption at rest"
        - "Encryption in transit"
        - "Key management"
        - "Data classification"
        - "Data retention"
      expected_findings:
        - "Data security documentation"
        - "Gaps identified"

    - id: "5"
      name: "Review Network Security Documentation"
      description: |
        Evaluate network security architecture documentation.
      duration_estimate: "45 min"
      network_checklist:
        - "Network segmentation"
        - "Firewall rules"
        - "Load balancer security"
        - "API gateway security"
      expected_findings:
        - "Network security documentation"
        - "Missing areas"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Authentication Review"
        - "Authorization Review"
        - "Data Security Review"
        - "Network Security Review"
        - "Recommendations"

  confidence_guidance:
    high: "Documentation validated by security team"
    medium: "Documentation reviewed with spot-checks"
    low: "Documentation existence review"

closeout_checklist:
  - id: "secarch-001"
    item: "Security architecture documentation exists"
    level: "CRITICAL"
    verification: "find . -name '*security*' | grep -E '\\.md$' | head -1"
    expected: "Documentation present"

  - id: "secarch-002"
    item: "Authentication documented"
    level: "CRITICAL"
    verification: "grep -ri 'authentication\\|auth\\|login' docs/security/ 2>/dev/null | head -1"
    expected: "Auth documented"

  - id: "secarch-003"
    item: "Authorization documented"
    level: "BLOCKING"
    verification: "grep -ri 'authorization\\|permission\\|role\\|access.control' docs/security/ 2>/dev/null | head -1"
    expected: "Authz documented"

  - id: "secarch-004"
    item: "Data protection documented"
    level: "BLOCKING"
    verification: "grep -ri 'encryption\\|key.management\\|data.protection' docs/security/ 2>/dev/null | head -1"
    expected: "Data protection documented"

governance:
  applicable_to:
    archetypes: ["all-systems"]

  compliance_mappings:
    - framework: "SOC 2"
      control: "CC6.1"
      description: "Security architecture documented"

    - framework: "ISO 27001"
      control: "A.14.2.5"
      description: "Security engineering principles"

relationships:
  commonly_combined:
    - "documentation-knowledge.architecture-docs.system-architecture-docs"
    - "security.architecture-review"

  feeds_into:
    - "security.compliance-readiness"
    - "risk-management.security-risk"
