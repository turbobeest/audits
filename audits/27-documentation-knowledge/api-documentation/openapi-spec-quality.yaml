audit:
  id: documentation-knowledge.api-documentation.openapi-spec-quality
  name: OpenAPI Specification Quality Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: documentation-knowledge
  category_number: 27
  subcategory: api-documentation
  tier: expert
  estimated_duration: 2-4 hours  # median: 3h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: 'yes'
  severity: medium
  scope: documentation
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates the quality of OpenAPI (Swagger) specifications
    using industry best practices and linting rules. The audit examines
    specification structure, documentation completeness, schema design,
    naming conventions, and adherence to API design standards.
  why_it_matters: |
    OpenAPI specifications serve as both documentation and contracts for
    API development. Poor quality specifications lead to inconsistent
    client code generation, documentation gaps, and API design issues.
    High-quality specifications enable tooling automation, improve
    developer experience, and ensure API consistency.
  when_to_run:
  - During API design reviews
  - Before generating client SDKs
  - As part of CI/CD pipeline
  - When onboarding API consumers
prerequisites:
  required_artifacts:
  - type: openapi_specification
    description: OpenAPI 3.x or Swagger 2.x specification file
  access_requirements:
  - Read access to OpenAPI specification files
discovery:
  file_patterns:
  - glob: '**/openapi*.yaml'
    purpose: Find OpenAPI YAML specifications
  - glob: '**/openapi*.json'
    purpose: Find OpenAPI JSON specifications
  - glob: '**/swagger*.yaml'
    purpose: Find Swagger specifications
  - glob: '**/swagger*.json'
    purpose: Find Swagger JSON files
  - glob: '**/api-spec*.yaml'
    purpose: Find API specification files
knowledge_sources:
  guides:
  - id: openapi-3-spec
    name: OpenAPI 3.0 Specification
    url: https://spec.openapis.org/oas/v3.0.3
    offline_cache: true
  - id: spectral-rulesets
    name: Spectral OpenAPI Ruleset
    url: https://meta.stoplight.io/docs/spectral/docs/reference/openapi-rules.md
    offline_cache: true
  - id: google-api-design
    name: Google API Design Guide
    url: https://cloud.google.com/apis/design
    offline_cache: true
tooling:
  linting_tools:
  - tool: spectral
    purpose: Lint OpenAPI specification
    command: spectral lint openapi.yaml
  - tool: openapi-generator
    purpose: Validate specification syntax
    command: openapi-generator validate -i openapi.yaml
  - tool: swagger-cli
    purpose: Validate and bundle specification
    command: swagger-cli validate openapi.yaml
  - tool: redocly
    purpose: Lint with custom rules
    command: redocly lint openapi.yaml
  analysis_commands:
  - purpose: Check specification version
    command: yq '.openapi // .swagger' openapi.yaml
  - purpose: Count operations
    command: yq '[.paths.*.* | select(type == "object")] | length' openapi.yaml
  - purpose: Find operations without descriptions
    command: yq '.paths.*.* | select(type == "object" and .description == null)' openapi.yaml
signals:
  critical:
  - id: OPENAPI-CRIT-001
    signal: Specification fails validation
    evidence_indicators:
    - openapi-generator validate reports errors
    - Spectral reports error-level violations
    - Spec cannot be parsed by tools
    explanation: |
      Invalid specifications cannot be used for code generation or
      documentation rendering, defeating the purpose of having a spec.
    remediation: Fix all validation errors immediately
  high:
  - id: OPENAPI-HIGH-001
    signal: Operations missing descriptions
    evidence_threshold: '>20% of operations lack descriptions'
    explanation: |
      Operations without descriptions leave consumers guessing at
      what endpoints do and when to use them.
    remediation: Add meaningful descriptions to all operations
  - id: OPENAPI-HIGH-002
    signal: Schemas missing property descriptions
    evidence_indicators:
    - Schema properties have no description field
    - Field purposes unclear from names alone
    explanation: |
      Property descriptions are essential for consumers to understand
      data semantics beyond just type information.
    remediation: Add descriptions to all schema properties
  - id: OPENAPI-HIGH-003
    signal: No request/response examples
    evidence_indicators:
    - Example field missing from schemas
    - No example requests in documentation
    explanation: |
      Examples dramatically improve API understanding and enable
      consumers to test integrations quickly.
    remediation: Add realistic examples for all operations
  medium:
  - id: OPENAPI-MED-001
    signal: Inconsistent naming conventions
    evidence_indicators:
    - Mixed camelCase and snake_case
    - Inconsistent pluralization
    - Path parameter naming varies
    explanation: |
      Inconsistent naming makes APIs harder to learn and use correctly.
    remediation: Establish and enforce naming conventions
  - id: OPENAPI-MED-002
    signal: Security schemes undefined
    remediation: Define security schemes for authenticated endpoints
  - id: OPENAPI-MED-003
    signal: Reusable components not utilized
    remediation: Extract common schemas and parameters to components
  - id: OPENAPI-MED-004
    signal: Error responses not documented
    remediation: Document all error response codes and schemas
  low:
  - id: OPENAPI-LOW-001
    signal: Tags not used for operation grouping
    remediation: Add tags to organize operations logically
  - id: OPENAPI-LOW-002
    signal: Contact and license info missing
    remediation: Add info section with contact and license
  - id: OPENAPI-LOW-003
    signal: Server URLs not defined
    remediation: Add server definitions for environments
  positive:
  - id: OPENAPI-POS-001
    signal: Specification passes all linting rules
  - id: OPENAPI-POS-002
    signal: All operations have descriptions and examples
  - id: OPENAPI-POS-003
    signal: Consistent naming conventions throughout
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Locate Specifications
    description: |
      Find all OpenAPI specification files in the repository.
    duration_estimate: 10 min
    commands:
    - purpose: Find OpenAPI files
      command: find . -name 'openapi*.yaml' -o -name 'swagger*.yaml' -o -name 'openapi*.json' | head -20
    expected_findings:
    - List of specification files
    - OpenAPI versions used
  - id: '2'
    name: Validate Specification Syntax
    description: |
      Run validation tools to ensure specifications are syntactically correct.
    duration_estimate: 15 min
    commands:
    - purpose: Validate with openapi-generator
      command: openapi-generator validate -i openapi.yaml
    - purpose: Validate with swagger-cli
      command: swagger-cli validate openapi.yaml
    expected_findings:
    - Validation status
    - Syntax errors if any
  - id: '3'
    name: Run Linting Analysis
    description: |
      Use Spectral or similar tools to check against best practice rules.
    duration_estimate: 20 min
    commands:
    - purpose: Lint with Spectral
      command: spectral lint openapi.yaml --format json
    expected_findings:
    - Linting violations by severity
    - Rule categories violated
  - id: '4'
    name: Assess Documentation Quality
    description: |
      Evaluate the completeness and quality of documentation within the spec.
    duration_estimate: 45 min
    quality_checklist:
    - Info section complete
    - All operations have summaries
    - All operations have descriptions
    - Parameters documented
    - Schemas have descriptions
    - Examples provided
    - Error responses documented
    expected_findings:
    - Documentation coverage metrics
    - Quality improvement opportunities
  - id: '5'
    name: Review Design Consistency
    description: |
      Check for consistent API design patterns and naming conventions.
    duration_estimate: 30 min
    checks:
    - Naming convention consistency
    - Path structure patterns
    - Response schema patterns
    - Error format consistency
    expected_findings:
    - Design consistency assessment
    - Inconsistencies identified
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Validation Results
    - Linting Analysis
    - Documentation Quality
    - Design Consistency
    - Recommendations
  - type: metrics_report
    format: table
    description: Quality metrics for specification
  confidence_guidance:
    high: Automated validation and comprehensive linting
    medium: Basic validation with spot-check review
    low: Syntax validation only
closeout_checklist:
- id: openapi-001
  item: Specification passes validation
  level: CRITICAL
  verification: openapi-generator validate -i openapi.yaml
  expected: No validation errors
- id: openapi-002
  item: No error-level linting violations
  level: BLOCKING
  verification: spectral lint openapi.yaml --format json | jq '[.[] | select(.severity == 0)] | length'
  expected: 0 errors
- id: openapi-003
  item: All operations have descriptions
  level: WARNING
  verification: yq '[.paths.*.* | select(type == "object" and .description == null)] | length' openapi.yaml
  expected: '0'
- id: openapi-004
  item: Security schemes defined
  level: WARNING
  verification: yq '.components.securitySchemes | length' openapi.yaml
  expected: '>0 for authenticated APIs'
governance:
  applicable_to:
    archetypes:
    - api-service
    - public-api
    - microservice
relationships:
  commonly_combined:
  - documentation-knowledge.api-documentation.api-reference-completeness
  - api-design.consistency-review
  feeds_into:
  - sdk-generation.quality
  - api-portal.documentation-rendering
