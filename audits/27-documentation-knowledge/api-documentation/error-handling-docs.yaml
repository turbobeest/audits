audit:
  id: documentation-knowledge.api-documentation.error-handling-docs
  name: Error Handling Documentation Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: documentation-knowledge
  category_number: 27
  subcategory: api-documentation
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: documentation
  default_profiles:
  - full
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates documentation of API error handling, including
    error response formats, error codes, error messages, retry guidance,
    and troubleshooting information. The audit ensures consumers can
    properly handle API errors in their applications.
  why_it_matters: |
    Error handling is crucial for building robust API integrations. Poor
    error documentation leads to applications that crash on errors, incorrect
    retry behavior, and frustrated developers. Clear error documentation
    enables graceful error handling and reduces support burden.
  when_to_run:
  - When designing API error handling
  - After adding new error codes
  - When support tickets indicate error confusion
  - During API documentation reviews
prerequisites:
  required_artifacts:
  - type: api_documentation
    description: Access to API error documentation
  - type: api_specification
    description: OpenAPI specification with error responses
  access_requirements:
  - Read access to API documentation
  - Access to API error definitions
discovery:
  file_patterns:
  - glob: '**/docs/errors*.md'
    purpose: Find error documentation
  - glob: '**/docs/troubleshooting*.md'
    purpose: Find troubleshooting docs
  - glob: '**/api-errors/**/*.md'
    purpose: Find error docs directory
  - glob: '**/error-codes*.md'
    purpose: Find error code listings
  code_patterns:
  - pattern: error.*code\|status.*code
    purpose: Find error code definitions
  - pattern: HttpStatus\|StatusCode
    purpose: Find HTTP status usage
knowledge_sources:
  guides:
  - id: http-status-codes
    name: HTTP Status Codes - MDN
    url: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status
    offline_cache: true
  - id: problem-details-rfc
    name: RFC 7807 - Problem Details for HTTP APIs
    url: https://datatracker.ietf.org/doc/html/rfc7807
    offline_cache: true
  - id: google-error-model
    name: Google API Design - Errors
    url: https://cloud.google.com/apis/design/errors
    offline_cache: true
tooling:
  analysis_commands:
  - purpose: Find error responses in OpenAPI
    command: yq '.paths.*.*responses | keys' openapi.yaml | grep -E '4[0-9]{2}|5[0-9]{2}' | sort -u
  - purpose: Find error documentation
    command: grep -rn 'error\|exception\|failure' --include='*.md' docs/
  - purpose: Find error codes in code
    command: grep -rn 'errorCode\|error_code\|ERROR_' --include='*.py' --include='*.java' src/
signals:
  critical:
  - id: ERROR-CRIT-001
    signal: No error documentation exists
    evidence_indicators:
    - No error section in documentation
    - Error response format undocumented
    - Consumers cannot parse errors
    explanation: |
      Without error documentation, consumers cannot handle API errors
      gracefully, leading to poor user experiences and crashed applications.
    remediation: Create comprehensive error documentation
  high:
  - id: ERROR-HIGH-001
    signal: Error response format not documented
    evidence_indicators:
    - No schema for error responses
    - Error JSON structure unknown
    - Consumers parse errors inconsistently
    explanation: |
      Consistent error parsing requires knowing the error format.
      Without it, error handling becomes fragile.
    remediation: Document error response schema with examples
  - id: ERROR-HIGH-002
    signal: Error codes not explained
    evidence_indicators:
    - Numeric or string codes without meaning
    - No error code reference
    - Consumers cannot determine error cause
    explanation: |
      Error codes without explanations don't help consumers understand
      what went wrong or how to fix it.
    remediation: Create error code reference with explanations
  - id: ERROR-HIGH-003
    signal: HTTP status codes used incorrectly
    evidence_indicators:
    - 200 returned for errors
    - 400/500 usage inconsistent
    - Status codes not documented
    explanation: |
      Incorrect HTTP status codes break standard error handling and
      confuse API consumers.
    remediation: Document status code usage and ensure correctness
  medium:
  - id: ERROR-MED-001
    signal: No retry guidance for errors
    explanation: |
      Some errors are retryable, others are not. Without guidance,
      consumers may retry non-retryable errors or not retry retryable ones.
    remediation: Document which errors are retryable with retry strategies
  - id: ERROR-MED-002
    signal: Rate limit errors not documented
    remediation: Document rate limit errors, headers, and backoff strategies
  - id: ERROR-MED-003
    signal: Validation error details not explained
    remediation: Document how validation errors indicate which fields failed
  low:
  - id: ERROR-LOW-001
    signal: No error handling examples in code samples
    remediation: Add error handling to code examples
  - id: ERROR-LOW-002
    signal: Error documentation not in OpenAPI spec
    remediation: Add error responses to OpenAPI specification
  positive:
  - id: ERROR-POS-001
    signal: Comprehensive error code documentation
  - id: ERROR-POS-002
    signal: RFC 7807 problem details format used
  - id: ERROR-POS-003
    signal: Error handling examples in all languages
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Error Codes
    description: |
      Identify all error codes and responses from the API.
    duration_estimate: 30 min
    commands:
    - purpose: Find error responses in spec
      command: yq '.paths.*.*responses | to_entries | .[] | select(.key | test("4|5"))' openapi.yaml
    - purpose: Find error codes in code
      command: grep -rh 'ERROR_\|error_code' --include='*.py' --include='*.java' src/ | sort -u
    expected_findings:
    - Complete error code inventory
    - HTTP status codes used
  - id: '2'
    name: Locate Error Documentation
    description: |
      Find all error-related documentation.
    duration_estimate: 20 min
    commands:
    - purpose: Find error docs
      command: find . -name '*.md' -exec grep -l -i 'error\|exception' {} \;
    expected_findings:
    - Error documentation inventory
    - Documentation locations
  - id: '3'
    name: Evaluate Error Format Documentation
    description: |
      Review documentation of error response format.
    duration_estimate: 30 min
    quality_checklist:
    - Error response schema documented
    - Example error responses shown
    - All error fields explained
    - Format consistent across endpoints
    expected_findings:
    - Format documentation status
    - Consistency assessment
  - id: '4'
    name: Review Error Code Coverage
    description: |
      Verify all error codes are documented with explanations.
    duration_estimate: 45 min
    quality_checklist:
    - Error code listed
    - Human-readable message
    - Cause explanation
    - Resolution guidance
    - Retry recommendation
    expected_findings:
    - Coverage percentage
    - Undocumented errors
  - id: '5'
    name: Assess Retry and Recovery Guidance
    description: |
      Review documentation for error recovery guidance.
    duration_estimate: 25 min
    expected_findings:
    - Retry guidance status
    - Recovery procedures documented
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Error Format Review
    - Error Code Coverage
    - Retry Guidance
    - Recommendations
  - type: error_code_matrix
    format: table
    description: Error code documentation status
  confidence_guidance:
    high: All error codes verified and documentation tested
    medium: Representative error sample reviewed
    low: High-level documentation review
closeout_checklist:
- id: error-001
  item: Error response format documented
  level: CRITICAL
  verification: manual
  verification_notes: Check for error schema documentation
  expected: Clear format specification
- id: error-002
  item: All error codes documented
  level: BLOCKING
  verification: manual
  verification_notes: Compare error codes with documentation
  expected: 100% coverage
- id: error-003
  item: Retry guidance provided
  level: WARNING
  verification: grep -r 'retry\|retryable' docs/
  expected: Retry guidance present
- id: error-004
  item: Error responses in OpenAPI spec
  level: WARNING
  verification: yq '.paths.*.*responses | has("4*")' openapi.yaml
  expected: Error responses defined
governance:
  applicable_to:
    archetypes:
    - api-service
    - public-api
    - microservice
relationships:
  commonly_combined:
  - documentation-knowledge.api-documentation.api-reference-completeness
  - api-design.error-handling-consistency
  feeds_into:
  - developer-experience.api-usability
  - integration-quality.error-handling
