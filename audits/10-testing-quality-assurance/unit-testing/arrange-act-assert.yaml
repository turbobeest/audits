audit:
  id: testing-quality-assurance.unit-testing.arrange-act-assert
  name: Arrange-Act-Assert Pattern
  version: 1.0.0
  last_updated: '2026-01-19'
  status: active
  category: testing-quality-assurance
  category_number: 10
  subcategory: unit-testing
  tier: expert
  estimated_duration: 1.5 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: testing
  default_profiles:
  - full
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews unit tests for adherence to the Arrange-Act-Assert (AAA) pattern
    where tests are structured with clear setup (Arrange), action (Act),
    and verification (Assert) sections. Also evaluates Given-When-Then
    equivalents in BDD-style tests.
  why_it_matters: |
    The AAA pattern creates consistent, readable tests that are easy to
    understand and maintain. Without this structure, tests become hard
    to follow, with interleaved setup and assertions making it unclear
    what's being tested and what the expected outcome is.
  when_to_run:
  - Code review of new tests
  - Test refactoring efforts
  - Test suite quality assessment
  - Onboarding new developers
prerequisites:
  required_artifacts:
  - type: test_suite
    description: Unit test files to analyze
  access_requirements:
  - Source code repository access
discovery:
  file_patterns:
  - glob: '**/*.test.{js,ts,jsx,tsx}'
    purpose: JavaScript/TypeScript unit tests
  - glob: '**/*.spec.{js,ts,jsx,tsx}'
    purpose: Spec-style unit tests
  - glob: '**/test_*.py'
    purpose: Python unit tests
  code_patterns:
  - pattern: // Arrange|// Act|// Assert
    type: regex
    scope: source
    purpose: Identify explicit AAA comments
  - pattern: // Given|// When|// Then
    type: regex
    scope: source
    purpose: Identify explicit GWT comments
  - pattern: beforeEach.*expect\(
    type: regex
    scope: source
    purpose: Identify setup mixed with assertions
knowledge_sources:
  specifications:
  - id: xunit-patterns
    name: xUnit Test Patterns
    url: http://xunitpatterns.com/
    offline_cache: true
    priority: recommended
  guides:
  - id: aaa-pattern
    name: Arrange Act Assert Pattern
    url: https://docs.microsoft.com/en-us/visualstudio/test/unit-test-basics
    offline_cache: true
  - id: bdd-gwt
    name: Given-When-Then
    url: https://martinfowler.com/bliki/GivenWhenThen.html
    offline_cache: true
  - id: tdd-by-example
    name: Kent Beck - Test Driven Development
    url: https://www.oreilly.com/library/view/test-driven-development/0321146530/
    offline_cache: true
  learning_resources:
  - id: unit-testing-book
    title: The Art of Unit Testing
    type: book
    reference: ISBN 978-1617290893
tooling:
  static_analysis:
  - tool: eslint-plugin-jest
    purpose: Enforce test structure
    offline_capable: true
  scripts:
  - id: aaa-analyzer
    language: bash
    purpose: Analyze AAA pattern usage
    source: inline
    code: |
      #!/bin/bash
      echo "=== AAA Pattern Analysis ==="
      echo "Tests with AAA comments:"
      grep -r -l '// Arrange\|// Act\|// Assert' --include='*.test.*' . 2>/dev/null | wc -l
      echo ""
      echo "Tests with GWT comments:"
      grep -r -l '// Given\|// When\|// Then' --include='*.test.*' . 2>/dev/null | wc -l
      echo ""
      echo "Sample test structure (first 5 tests):"
      grep -r -A20 'it(\|test(' --include='*.test.*' . 2>/dev/null | head -50
signals:
  critical:
  - id: AAA-CRIT-001
    signal: Assertions in setup (beforeEach/beforeAll)
    evidence_pattern: expect() inside beforeEach blocks
    explanation: |
      Assertions in setup make tests confusing - it's unclear what's
      being tested vs what's being set up. Setup should only arrange.
    remediation: Move assertions to individual test blocks
  - id: AAA-CRIT-002
    signal: Multiple distinct actions being tested in one test
    evidence_pattern: Multiple unrelated function calls with assertions
    explanation: |
      Testing multiple things in one test makes failures ambiguous
      and violates the single responsibility principle for tests.
    remediation: Split into separate tests, each with one action
  high:
  - id: AAA-HIGH-001
    signal: Interleaved arrange and assert sections
    evidence_pattern: Assertions between setup statements
    explanation: |
      Interleaved sections make it hard to understand test flow.
      Clear separation aids readability and debugging.
    remediation: Restructure tests with clear Arrange-Act-Assert sections
  - id: AAA-HIGH-002
    signal: Act section not clearly identifiable
    evidence_pattern: Action buried in setup or assertion
    explanation: |
      When the action being tested isn't clear, understanding
      and maintaining the test becomes difficult.
    remediation: Make the action under test explicit and visible
  medium:
  - id: AAA-MED-001
    signal: Tests lack visual separation of sections
    evidence_pattern: No blank lines or comments between AAA sections
    remediation: Add blank lines or comments to separate sections
  - id: AAA-MED-002
    signal: Long arrange sections obscure test intent
    evidence_pattern: '>10 lines of setup before action'
    remediation: Extract setup to helper functions or beforeEach
  low:
  - id: AAA-LOW-001
    signal: Inconsistent section labeling style
    evidence_pattern: Mix of AAA and GWT comments
  positive:
  - id: AAA-POS-001
    signal: Consistent AAA/GWT structure throughout
    evidence_pattern: All tests follow clear structure
  - id: AAA-POS-002
    signal: Explicit section comments aid readability
    evidence_pattern: // Arrange, // Act, // Assert comments
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Check for explicit AAA markers
    description: |
      Search for explicit AAA or GWT comments that indicate
      conscious adherence to the pattern.
    duration_estimate: 10 min
    commands:
    - purpose: Find AAA comments
      command: grep -r -c '// Arrange\|// Act\|// Assert' --include='*.test.*' . 2>/dev/null | grep -v
        ':0' | head -20
    - purpose: Find GWT comments
      command: grep -r -c '// Given\|// When\|// Then' --include='*.test.*' . 2>/dev/null | grep -v ':0'
        | head -20
    expected_findings:
    - Explicit pattern usage
    - Consistency of markers
  - id: '2'
    name: Analyze test structure
    description: |
      Review test implementations to assess whether they follow
      the AAA pattern even without explicit comments.
    duration_estimate: 25 min
    commands:
    - purpose: Sample test implementations
      command: grep -r -A25 'it(\|test(' --include='*.test.*' . 2>/dev/null | head -100
    expected_findings:
    - Implicit AAA pattern usage
    - Structural patterns
  - id: '3'
    name: Check for anti-patterns
    description: |
      Identify violations of the AAA pattern such as assertions
      in setup or interleaved sections.
    duration_estimate: 20 min
    commands:
    - purpose: Find assertions in beforeEach
      command: grep -r -A10 'beforeEach' --include='*.test.*' . 2>/dev/null | grep 'expect(' | head -10
    - purpose: Find multiple act patterns
      command: grep -r -B5 -A5 'expect(' --include='*.test.*' . 2>/dev/null | head -50
    expected_findings:
    - Pattern violations
    - Anti-pattern examples
  - id: '4'
    name: Assess readability
    description: |
      Evaluate overall test readability considering the AAA
      structure and visual organization.
    duration_estimate: 15 min
    questions:
    - Can the test intent be understood at a glance?
    - Are sections visually separated?
    - Is the action under test obvious?
    expected_findings:
    - Readability assessment
    - Visual organization quality
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: pattern_analysis
    format: table
    sections:
    - AAA Pattern Usage
    - Anti-Pattern Instances
    - Readability Assessment
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Pattern Adherence Assessment
    - Recommendations
  confidence_guidance:
    high: All tests reviewed for structure
    medium: Representative sample reviewed
    low: Based on pattern matching only
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: aaa-pattern
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Structure review requires manual assessment
    full:
      included: true
      priority: 2
closeout_checklist:
- id: aaa-001
  item: AAA/GWT pattern usage documented
  level: BLOCKING
  verification: manual
  verification_notes: Document pattern usage across test suite
  expected: Confirmed by reviewer
- id: aaa-002
  item: Anti-patterns identified
  level: BLOCKING
  verification: manual
  verification_notes: List violations of AAA pattern
  expected: Confirmed by reviewer
- id: aaa-003
  item: Recommendations for improvement
  level: WARNING
  verification: manual
  verification_notes: Provide specific refactoring suggestions
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
relationships:
  commonly_combined:
  - testing-quality-assurance.unit-testing.test-maintainability
  - testing-quality-assurance.unit-testing.test-naming-convention
  - testing-quality-assurance.unit-testing.assertion-quality
