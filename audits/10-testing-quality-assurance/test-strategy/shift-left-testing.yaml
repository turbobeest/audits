# ============================================================
# AUDIT: Shift-Left Testing
# ============================================================
# Evaluates the implementation of early testing practices
# throughout the software development lifecycle.
# ============================================================

audit:
  id: "testing-quality-assurance.test-strategy.shift-left-testing"
  name: "Shift-Left Testing"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 10
  subcategory: "test-strategy"

  tier: "expert"
  estimated_duration: "2 hours"

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "testing"

  default_profiles:
    - "full"
    - "quality"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Assesses the implementation of shift-left testing practices where testing
    activities are moved earlier in the development lifecycle. Evaluates
    pre-commit hooks, IDE integration, local test execution, fast feedback
    loops, and how testing is integrated into the development workflow rather
    than being a separate phase after development.

  why_it_matters: |
    Defects found late in the development cycle are exponentially more expensive
    to fix. Shift-left testing catches issues when they're cheapest to resolve,
    improves developer productivity through fast feedback, and prevents defect
    accumulation that leads to lengthy QA phases and release delays.

  when_to_run:
    - "Development workflow optimization"
    - "CI/CD pipeline design"
    - "Developer experience improvements"
    - "After repeated late-stage defect discoveries"

prerequisites:
  required_artifacts:
    - type: "development_tooling"
      description: "Pre-commit hooks, IDE configurations, local test setup"
    - type: "ci_configuration"
      description: "CI/CD pipeline configuration"

  access_requirements:
    - "Source code repository access"
    - "CI/CD configuration access"
    - "Developer workstation standards documentation"

discovery:
  file_patterns:
    - glob: "**/.pre-commit-config.yaml"
      purpose: "Pre-commit hook configuration"
    - glob: "**/.husky/**"
      purpose: "Husky git hooks"
    - glob: "**/lefthook.yml"
      purpose: "Lefthook configuration"
    - glob: "**/.vscode/**"
      purpose: "VS Code workspace settings"
    - glob: "**/.idea/**"
      purpose: "IntelliJ IDEA settings"
    - glob: "**/lint-staged.config.*"
      purpose: "Lint-staged configuration"

  code_patterns:
    - pattern: "pre-commit|pre-push"
      type: "keyword"
      scope: "config"
      purpose: "Git hook configurations"
    - pattern: "lint-staged|husky"
      type: "keyword"
      scope: "config"
      purpose: "JavaScript pre-commit tooling"
    - pattern: "watch.*test|test.*watch"
      type: "regex"
      scope: "config"
      purpose: "Test watch mode configuration"

knowledge_sources:
  guides:
    - id: "shift-left-testing"
      name: "Shift Left Testing: What, Why & How To Shift Left"
      url: "https://www.bmc.com/blogs/what-is-shift-left-shift-left-testing-explained/"
      offline_cache: true
    - id: "tdd"
      name: "Test-Driven Development"
      url: "https://martinfowler.com/bliki/TestDrivenDevelopment.html"
      offline_cache: true

  learning_resources:
    - id: "accelerate"
      title: "Accelerate: Building and Scaling High-Performing Technology Organizations"
      type: "book"
      reference: "ISBN 978-1942788331"

tooling:
  static_analysis:
    - tool: "pre-commit"
      purpose: "Run checks before commits"
      offline_capable: true
    - tool: "husky"
      purpose: "JavaScript git hooks"
      offline_capable: true
    - tool: "lint-staged"
      purpose: "Run linters on staged files only"
      offline_capable: true

  scripts:
    - id: "shift-left-checker"
      language: "bash"
      purpose: "Check for shift-left tooling presence"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Shift-Left Testing Analysis ==="
        echo "Pre-commit hooks:"
        ls -la .git/hooks/ 2>/dev/null | grep -v sample | head -10
        echo ""
        echo "Pre-commit config:"
        cat .pre-commit-config.yaml 2>/dev/null || cat .husky/pre-commit 2>/dev/null || echo "No pre-commit config found"
        echo ""
        echo "Test watch scripts:"
        grep -E "watch|--watch" package.json 2>/dev/null | head -5

signals:
  critical:
    - id: "SHIFT-CRIT-001"
      signal: "No automated checks before commit or push"
      evidence_pattern: "No pre-commit hooks, lint-staged, or husky"
      explanation: |
        Without pre-commit checks, defects flow directly into the codebase
        and are only caught later in CI or review, increasing fix cost.
      remediation: "Implement pre-commit hooks for linting and basic tests"

    - id: "SHIFT-CRIT-002"
      signal: "Tests only run in CI, not locally"
      evidence_pattern: "No local test execution scripts or documentation"
      explanation: |
        If developers can't run tests locally, they commit code without
        verification, leading to broken builds and slow feedback loops.
      remediation: "Ensure all tests can be run locally with simple commands"

  high:
    - id: "SHIFT-HIGH-001"
      signal: "No test watch mode available for development"
      evidence_pattern: "No --watch scripts in package.json or equivalent"
      explanation: |
        Without watch mode, developers must manually trigger tests,
        reducing the likelihood of frequent test execution during development.
      remediation: "Configure test watch mode for continuous feedback"

    - id: "SHIFT-HIGH-002"
      signal: "Static analysis only runs in CI, not pre-commit"
      evidence_pattern: "Linting configured for CI but not git hooks"
      explanation: |
        Late static analysis feedback means developers discover issues
        only after pushing, requiring additional commits to fix.
      remediation: "Add linting to pre-commit hooks"

  medium:
    - id: "SHIFT-MED-001"
      signal: "Type checking not integrated into development workflow"
      evidence_pattern: "TypeScript/type hints present but not enforced pre-commit"
      remediation: "Add type checking to pre-commit or IDE configuration"

    - id: "SHIFT-MED-002"
      signal: "Security scanning only happens post-merge"
      evidence_pattern: "Security tools only in CI main branch pipeline"
      remediation: "Add pre-commit security scanning for secrets and vulnerabilities"

  low:
    - id: "SHIFT-LOW-001"
      signal: "Pre-commit hooks take too long (>30 seconds)"
      evidence_pattern: "Hook execution time exceeds acceptable threshold"

  positive:
    - id: "SHIFT-POS-001"
      signal: "TDD practices evident in commit history"
      evidence_pattern: "Test commits precede implementation commits"
    - id: "SHIFT-POS-002"
      signal: "Comprehensive pre-commit hook suite"
      evidence_pattern: "Linting, type checking, and basic tests in pre-commit"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Check pre-commit tooling"
      description: |
        Identify what automated checks run before code is committed
        to the repository.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find pre-commit configurations"
          command: "find . \\( -name '.pre-commit-config.yaml' -o -name 'lefthook.yml' -o -path '*/.husky/*' \\) 2>/dev/null | head -10"
        - purpose: "Check git hooks directory"
          command: "ls -la .git/hooks/ 2>/dev/null | grep -v '.sample'"
        - purpose: "Check for lint-staged"
          command: "grep -l 'lint-staged' package.json 2>/dev/null && grep -A10 'lint-staged' package.json"
      expected_findings:
        - "Pre-commit tooling inventory"
        - "Checks configured to run on commit"

    - id: "2"
      name: "Evaluate local test execution"
      description: |
        Assess how easy it is for developers to run tests locally
        and whether watch mode is available.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find test scripts"
          command: "grep -E '\"test\"|\"test:' package.json 2>/dev/null | head -10"
        - purpose: "Check for watch mode"
          command: "grep -E 'watch|--watch' package.json Makefile 2>/dev/null | head -10"
      expected_findings:
        - "Local test execution commands"
        - "Watch mode availability"

    - id: "3"
      name: "Review IDE integration"
      description: |
        Check for IDE configurations that enable real-time feedback
        during development.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find IDE configurations"
          command: "find . \\( -path '*/.vscode/*' -o -path '*/.idea/*' \\) -type f 2>/dev/null | head -20"
        - purpose: "Check VS Code settings"
          command: "cat .vscode/settings.json 2>/dev/null | head -30"
      expected_findings:
        - "IDE configurations present"
        - "Real-time linting/testing enabled"

    - id: "4"
      name: "Assess feedback loop speed"
      description: |
        Evaluate how quickly developers get feedback at each stage
        of the development workflow.
      duration_estimate: "20 min"
      questions:
        - "How long do pre-commit hooks take to run?"
        - "How long do local tests take?"
        - "What's the CI pipeline feedback time?"
      expected_findings:
        - "Feedback timing at each stage"
        - "Bottlenecks in feedback loop"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "tooling_inventory"
      format: "table"
      sections:
        - "Pre-commit Hooks"
        - "Local Testing"
        - "IDE Integration"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Shift-Left Maturity Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Tooling directly verified and tested"
    medium: "Configuration files present but not executed"
    low: "Based on file presence only"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "shift-left-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: true
      reason: "Quick tooling presence check"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "shift-001"
    item: "Pre-commit tooling assessed"
    level: "CRITICAL"
    verification: "ls .git/hooks/ 2>/dev/null | grep -v sample | wc -l"
    expected: "PASS (documents findings)"

  - id: "shift-002"
    item: "Local test execution verified"
    level: "BLOCKING"
    verification: "grep -c 'test' package.json 2>/dev/null || echo 0"
    expected: "PASS (count > 0)"

  - id: "shift-003"
    item: "Feedback loop timings documented"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Document time for pre-commit, local tests, and CI"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "DevOps Research (DORA)"
      controls: ["Lead Time for Changes"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.test-strategy.test-pyramid-balance"
    - "code-quality.static-analysis.linting-configuration"
    - "code-quality.static-analysis.type-safety"
