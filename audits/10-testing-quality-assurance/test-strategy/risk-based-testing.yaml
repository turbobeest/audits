# ============================================================
# AUDIT: Risk-Based Testing
# ============================================================
# Evaluates whether testing effort is prioritized based on
# risk assessment of features and components.
# ============================================================

audit:
  id: "testing-quality-assurance.test-strategy.risk-based-testing"
  name: "Risk-Based Testing"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 10
  subcategory: "test-strategy"

  tier: "expert"
  estimated_duration: "3 hours"

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "testing"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Assesses whether the organization employs risk-based testing strategies
    to allocate testing resources effectively. Examines how critical paths,
    high-risk components, and frequently changed areas receive proportionally
    more testing attention than low-risk, stable code.

  why_it_matters: |
    Testing everything equally wastes resources and provides false confidence.
    Risk-based testing ensures critical functionality (payment processing,
    authentication, data integrity) receives rigorous testing while accepting
    lighter coverage for low-impact features. This approach maximizes defect
    detection per testing dollar spent.

  when_to_run:
    - "Test strategy planning"
    - "Resource allocation reviews"
    - "After incidents revealing testing gaps"
    - "Major release planning"

prerequisites:
  required_artifacts:
    - type: "test_suite"
      description: "Existing test files and coverage reports"
    - type: "architecture_docs"
      description: "System architecture showing critical components"
    - type: "incident_history"
      description: "Past incidents and their root causes"

  access_requirements:
    - "Source code repository access"
    - "Coverage reports by component/module"
    - "Incident/bug tracking system access"
    - "Business stakeholder input on critical features"

discovery:
  file_patterns:
    - glob: "**/coverage/**"
      purpose: "Coverage reports to correlate with risk areas"
    - glob: "**/tests/**"
      purpose: "Test distribution across modules"

  code_patterns:
    - pattern: "payment|checkout|transaction"
      type: "keyword"
      scope: "source"
      purpose: "Identify financial/payment code paths"
    - pattern: "auth|login|session|token"
      type: "keyword"
      scope: "source"
      purpose: "Identify authentication code paths"
    - pattern: "encrypt|decrypt|hash|secret"
      type: "keyword"
      scope: "source"
      purpose: "Identify security-sensitive code"

  documents_to_review:
    - type: "Risk assessment documents"
      purpose: "Understand identified risks and their severity"
    - type: "Incident postmortems"
      purpose: "Identify areas with historical defects"

knowledge_sources:
  guides:
    - id: "risk-based-testing"
      name: "Risk-Based Testing Best Practices"
      url: "https://www.istqb.org/certifications/specialist/risk-based-testing"
      offline_cache: true

  specifications:
    - id: "iso-29119"
      name: "ISO/IEC 29119 Software Testing"
      url: "https://www.iso.org/standard/45142.html"
      offline_cache: false
      priority: "recommended"

  learning_resources:
    - id: "risk-based-testing-book"
      title: "Risk-Based Testing: Strategies and Techniques"
      type: "book"
      reference: "ISBN 978-0367266073"

tooling:
  static_analysis:
    - tool: "code-churn-analyzer"
      purpose: "Identify frequently changed files"
      offline_capable: true
    - tool: "complexity-analyzer"
      purpose: "Identify complex, high-risk code"
      offline_capable: true

  scripts:
    - id: "risk-correlation"
      language: "bash"
      purpose: "Correlate test coverage with code complexity"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Risk-Based Testing Analysis ==="
        echo "High-churn files (last 30 commits):"
        git log --pretty=format: --name-only -30 | sort | uniq -c | sort -rn | head -20
        echo ""
        echo "Authentication-related test coverage:"
        find . -path "*test*" -name "*.test.*" | xargs grep -l "auth\|login" 2>/dev/null | wc -l

signals:
  critical:
    - id: "RISK-CRIT-001"
      signal: "Critical security paths have no test coverage"
      evidence_pattern: "auth/payment modules with 0% coverage"
      explanation: |
        Security-critical code without tests creates significant risk exposure.
        Authentication, authorization, and payment processing must have
        comprehensive test coverage to prevent security vulnerabilities.
      remediation: "Prioritize test coverage for security-critical modules immediately"

    - id: "RISK-CRIT-002"
      signal: "High-churn code has lowest test coverage"
      evidence_pattern: "Frequently modified files have <50% coverage"
      explanation: |
        Code that changes frequently is most likely to introduce regressions.
        Low coverage in high-churn areas means bugs are likely to escape to production.
      remediation: "Add tests to frequently modified code before further changes"

  high:
    - id: "RISK-HIGH-001"
      signal: "No documented risk assessment for testing priorities"
      evidence_pattern: "No risk matrix or priority documentation"
      explanation: |
        Without documented risk assessment, testing priorities are arbitrary
        or based on developer preference rather than business impact.
      remediation: "Create risk matrix categorizing components by criticality"

    - id: "RISK-HIGH-002"
      signal: "Test coverage uniform across risk levels"
      evidence_pattern: "Similar coverage percentages regardless of criticality"
      explanation: |
        Uniform coverage suggests testing effort isn't risk-informed.
        Critical components should have higher coverage than low-risk utilities.
      remediation: "Increase test investment in high-risk areas"

  medium:
    - id: "RISK-MED-001"
      signal: "No correlation between bug history and test focus"
      evidence_pattern: "Areas with repeated bugs lack additional tests"
      remediation: "Add regression tests for each bug fixed in high-incident areas"

    - id: "RISK-MED-002"
      signal: "New features added without risk assessment"
      evidence_pattern: "Feature additions without corresponding test plan"
      remediation: "Implement risk assessment as part of feature planning"

  low:
    - id: "RISK-LOW-001"
      signal: "Risk assessments not regularly updated"
      evidence_pattern: "Last risk assessment >6 months old"

  positive:
    - id: "RISK-POS-001"
      signal: "Critical paths have >90% coverage"
      evidence_pattern: "Security/payment modules comprehensively tested"
    - id: "RISK-POS-002"
      signal: "Risk matrix actively maintained and used"
      evidence_pattern: "Regular risk review meetings documented"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify critical components"
      description: |
        Map out the system's critical components based on business impact,
        security sensitivity, and regulatory requirements.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find security-sensitive code"
          command: "grep -r -l 'auth\\|payment\\|encrypt\\|secret' --include='*.ts' --include='*.js' --include='*.py' . 2>/dev/null | grep -v node_modules | head -30"
      questions:
        - "What are the business-critical features?"
        - "Which components handle sensitive data?"
        - "What are the regulatory compliance requirements?"
      expected_findings:
        - "List of critical components"
        - "Security-sensitive code locations"

    - id: "2"
      name: "Analyze code churn patterns"
      description: |
        Identify frequently modified code areas that present higher
        regression risk and should have stronger test coverage.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find high-churn files"
          command: "git log --pretty=format: --name-only -100 2>/dev/null | sort | uniq -c | sort -rn | head -25"
      expected_findings:
        - "High-churn files ranked by change frequency"
        - "Correlation with defect-prone areas"

    - id: "3"
      name: "Compare coverage with risk levels"
      description: |
        Correlate test coverage data with identified risk levels to
        determine if testing effort aligns with risk.
      duration_estimate: "30 min"
      commands:
        - purpose: "Check test presence for critical modules"
          command: "find . -path '*test*' -type f \\( -name '*.test.*' -o -name '*.spec.*' \\) | head -50"
      expected_findings:
        - "Coverage levels for high-risk components"
        - "Coverage levels for low-risk components"
        - "Gap analysis between risk and coverage"

    - id: "4"
      name: "Review incident correlation"
      description: |
        Analyze past incidents to determine if they correlate with
        undertested components and inform future risk assessment.
      duration_estimate: "30 min"
      questions:
        - "Which components have had the most production incidents?"
        - "Were tests added after incidents?"
        - "Do incident patterns inform testing priorities?"
      expected_findings:
        - "Incident hotspots"
        - "Test coverage response to incidents"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "risk_matrix"
      format: "table"
      sections:
        - "Component Risk Levels"
        - "Coverage by Risk Level"
        - "Gap Analysis"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Risk-Coverage Correlation"
        - "Prioritized Recommendations"

  confidence_guidance:
    high: "Direct coverage and risk data correlation"
    medium: "Risk inferred from code patterns"
    low: "Based on architectural assumptions"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "risk-based-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Risk analysis requires comprehensive review"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "risk-001"
    item: "Critical components identified"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify critical components are documented"
    expected: "Confirmed by reviewer"

  - id: "risk-002"
    item: "Coverage correlated with risk levels"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify high-risk components have higher coverage"
    expected: "Confirmed by reviewer"

  - id: "risk-003"
    item: "Recommendations prioritized by risk"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Check recommendations align with risk assessment"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "ISO 29119"
      controls: ["Test Strategy", "Risk-Based Testing"]
    - framework: "SOC 2"
      controls: ["Testing Controls"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.test-strategy.test-coverage-strategy"
    - "testing-quality-assurance.test-strategy.test-pyramid-balance"
    - "security-trust.vulnerability-management.security-testing"
