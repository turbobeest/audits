# ============================================================
# AUDIT: Automated Test Maintenance
# ============================================================
# Evaluates practices for maintaining and evolving automated
# test suites over time.
# ============================================================

audit:
  id: "testing-quality-assurance.test-automation.automated-test-maintenance"
  name: "Automated Test Maintenance"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 10
  subcategory: "test-automation"

  tier: "expert"
  estimated_duration: "3 hours"

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "testing"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Examines automated test maintenance practices including test code
    quality, documentation, refactoring patterns, and technical debt
    management. Reviews how test suites evolve alongside application
    code and remain maintainable over time.

  why_it_matters: |
    Unmaintained test suites become liabilities. Tests that are hard to
    understand, modify, or debug slow development and get skipped or
    deleted. Well-maintained tests remain valuable throughout the
    application lifecycle and scale with the codebase.

  when_to_run:
    - "During technical debt reviews"
    - "After significant test suite growth"
    - "When test maintenance costs increase"
    - "Quality improvement initiatives"

prerequisites:
  required_artifacts:
    - type: "test-suite"
      description: "Automated test suite source code"
    - type: "test-documentation"
      description: "Test strategy and maintenance documentation"

  access_requirements:
    - "Test code repository access"
    - "Code review history"
    - "Test metrics and analytics"

discovery:
  file_patterns:
    - glob: "**/tests/**"
      purpose: "Test directories"
    - glob: "**/__tests__/**"
      purpose: "Jest test directories"
    - glob: "**/test/**"
      purpose: "Test source files"
    - glob: "**/spec/**"
      purpose: "RSpec test files"

  code_patterns:
    - pattern: "helper|fixture|factory|util"
      type: "keyword"
      scope: "source"
      purpose: "Test utilities and abstractions"
    - pattern: "describe|it|test|spec"
      type: "keyword"
      scope: "source"
      purpose: "Test structure"
    - pattern: "beforeEach|afterEach|setUp|tearDown"
      type: "keyword"
      scope: "source"
      purpose: "Test lifecycle hooks"

knowledge_sources:
  guides:
    - id: "test-patterns"
      name: "xUnit Test Patterns"
      url: "http://xunitpatterns.com/"
      offline_cache: true

  learning_resources:
    - id: "test-maintenance"
      title: "Growing Object-Oriented Software, Guided by Tests"
      type: "book"
      reference: "Steve Freeman, Nat Pryce"
    - id: "test-smells"
      title: "Test Smells"
      type: "article"
      reference: "https://testsmells.org/"

tooling:
  static_analysis:
    - tool: "eslint-plugin-jest"
      purpose: "Jest test linting"
      offline_capable: true
    - tool: "pylint"
      purpose: "Python test code analysis"
      offline_capable: true
    - tool: "SonarQube"
      purpose: "Test code quality analysis"
      offline_capable: false

signals:
  critical:
    - id: "MAINT-CRIT-001"
      signal: "Tests tightly coupled to implementation details"
      evidence_pattern: "Tests mocking internals or testing private methods"
      explanation: |
        Tests coupled to implementation break with every refactoring.
        This makes refactoring expensive and discourages code improvement.
        Tests should validate behavior, not implementation.
      remediation: "Refactor tests to test public interfaces and behaviors"

    - id: "MAINT-CRIT-002"
      signal: "Significant test code duplication"
      evidence_pattern: "Copy-pasted test setup and assertions across files"
      explanation: |
        Duplicated test code multiplies maintenance burden. Changes require
        updates in multiple places, and inconsistencies creep in. Tests
        become harder to understand and modify.
      remediation: "Extract common patterns into test utilities and fixtures"

  high:
    - id: "MAINT-HIGH-001"
      signal: "Tests lack descriptive names"
      evidence_pattern: "test1, testFunction, it('works') patterns"
      explanation: |
        Poorly named tests don't communicate intent. When tests fail,
        developers can't understand what behavior is broken without
        reading the test code. This slows debugging.
      remediation: "Use descriptive names that explain the expected behavior"

    - id: "MAINT-HIGH-002"
      signal: "No test code review standards"
      evidence_pattern: "Test code excluded from review or held to lower standards"
      explanation: |
        Tests without review accumulate quality issues. Test code deserves
        the same scrutiny as production code because it protects production
        code quality.
      remediation: "Apply same code review standards to test and production code"

  medium:
    - id: "MAINT-MED-001"
      signal: "Test utilities not documented"
      evidence_pattern: "Custom helpers and fixtures without documentation"
      remediation: "Document test utilities and patterns for team use"

    - id: "MAINT-MED-002"
      signal: "Inconsistent test structure"
      evidence_pattern: "Different patterns across test files"
      remediation: "Establish and document consistent test structure patterns"

  low:
    - id: "MAINT-LOW-001"
      signal: "No test contribution guidelines"
      remediation: "Create test writing guidelines for contributors"

  positive:
    - id: "MAINT-POS-001"
      signal: "Well-structured tests with clear abstractions"
    - id: "MAINT-POS-002"
      signal: "Documented test patterns and utilities"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Assess test code organization"
      description: |
        Review test directory structure, file organization, and
        naming conventions.
      duration_estimate: "30 min"
      commands:
        - purpose: "Examine test directory structure"
          command: "find . -type d -name 'test*' -o -name '__tests__' -o -name 'spec' 2>/dev/null | head -20"
        - purpose: "Check test file naming patterns"
          command: "find . -type f -name '*.test.*' -o -name '*.spec.*' -o -name 'test_*' 2>/dev/null | head -30"
      expected_findings:
        - "Test directory structure"
        - "Naming conventions"

    - id: "2"
      name: "Review test abstractions"
      description: |
        Examine test utilities, fixtures, and helpers for proper
        abstraction and reuse.
      duration_estimate: "35 min"
      commands:
        - purpose: "Find test utilities"
          command: "find . -type f \\( -name '*helper*' -o -name '*fixture*' -o -name '*factory*' \\) -path '*/test*' 2>/dev/null"
        - purpose: "Check for test setup patterns"
          command: "grep -r 'beforeEach\\|setUp\\|@Before\\|fixture' . --include='*.test.*' --include='*.spec.*' 2>/dev/null | head -20"
      expected_findings:
        - "Test utilities"
        - "Setup patterns"

    - id: "3"
      name: "Analyze test naming quality"
      description: |
        Review test names for descriptiveness and consistency.
      duration_estimate: "25 min"
      commands:
        - purpose: "Sample test names"
          command: "grep -r 'it(\\|test(\\|def test_\\|describe(' . --include='*.test.*' --include='*.spec.*' --include='test_*.py' 2>/dev/null | head -30"
      expected_findings:
        - "Test naming patterns"
        - "Naming quality assessment"

    - id: "4"
      name: "Check for test documentation"
      description: |
        Verify that test patterns and utilities are documented.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find test documentation"
          command: "find . -path '*/test*' -name '*.md' -o -path '*/test*' -name 'README*' 2>/dev/null"
        - purpose: "Check for inline documentation"
          command: "grep -r 'docstring\\|@doc\\|/\\*\\*' . -path '*/test*' 2>/dev/null | head -20"
      expected_findings:
        - "Test documentation"
        - "Utility documentation"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Code Quality Analysis"
        - "Maintainability Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Test code reviewed, patterns analyzed, documentation verified"
    medium: "Structure reviewed but code quality not deeply analyzed"
    low: "Limited visibility into test maintenance practices"

offline:
  capability: "full"
  cache_manifest:
    knowledge:
      - source_id: "test-patterns"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed code analysis"
    full:
      included: true
      priority: 3

closeout_checklist:
  - id: "test-maintenance-001"
    item: "Tests use proper abstractions"
    level: "CRITICAL"
    verification: "find . -path '*/test*' -name '*helper*' 2>/dev/null | head -1 | grep -q . && echo PASS || echo FAIL"
    expected: "PASS"

  - id: "test-maintenance-002"
    item: "Test naming is descriptive"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Reviewer confirms test names describe expected behavior"
    expected: "Confirmed by reviewer"

  - id: "test-maintenance-003"
    item: "Test patterns documented"
    level: "WARNING"
    verification: "find . -path '*/test*' -name '*.md' 2>/dev/null | head -1 | grep -q . && echo PASS || echo FAIL"
    expected: "PASS"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "Internal"
      controls: ["QA-003"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.test-automation.flaky-test-management"
    - "testing-quality-assurance.test-data-management.test-fixture-management"
