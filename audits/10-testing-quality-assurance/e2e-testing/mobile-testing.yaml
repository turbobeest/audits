# ============================================================
# AUDIT: Mobile Testing
# ============================================================
# Evaluates E2E testing coverage for mobile devices including
# responsive design, touch interactions, and mobile browsers.
# ============================================================

audit:
  id: "testing-quality-assurance.e2e-testing.mobile-testing"
  name: "Mobile Testing"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 10
  subcategory: "e2e-testing"

  tier: "expert"
  estimated_duration: "2 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "testing"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Assesses mobile testing practices including responsive design testing,
    mobile viewport testing, touch interaction simulation, mobile-specific
    feature testing (geolocation, camera, etc.), and native mobile app
    testing if applicable.

  why_it_matters: |
    Mobile traffic often exceeds desktop. Mobile users have different
    interaction patterns, viewport sizes, and capabilities. Features that
    work on desktop can completely fail on mobile, losing significant
    portions of users and revenue.

  when_to_run:
    - "Before mobile-affecting releases"
    - "After responsive design changes"
    - "Mobile UX reviews"
    - "New mobile feature launches"

prerequisites:
  required_artifacts:
    - type: "e2e_tests"
      description: "End-to-end test files"
    - type: "mobile_config"
      description: "Mobile device configuration"

  access_requirements:
    - "Source code repository access"
    - "Mobile testing tools or emulators"
    - "Mobile device farm (optional)"

discovery:
  file_patterns:
    - glob: "**/e2e/**/*mobile*"
      purpose: "Mobile-specific tests"
    - glob: "**/cypress/**/*mobile*"
      purpose: "Cypress mobile tests"
    - glob: "**/appium/**"
      purpose: "Appium tests"
    - glob: "**/detox/**"
      purpose: "React Native tests"

  code_patterns:
    - pattern: "viewport|setViewportSize|mobile"
      type: "keyword"
      scope: "source"
      purpose: "Identify viewport manipulation"
    - pattern: "touch|swipe|tap|gesture"
      type: "keyword"
      scope: "source"
      purpose: "Identify touch interactions"
    - pattern: "iphone|android|ios|pixel"
      type: "keyword"
      scope: "config"
      purpose: "Identify mobile device configs"

knowledge_sources:
  guides:
    - id: "mobile-testing"
      name: "Mobile Testing Best Practices"
      url: "https://playwright.dev/docs/emulation"
      offline_cache: true
    - id: "responsive-testing"
      name: "Responsive Design Testing"
      url: "https://docs.cypress.io/api/commands/viewport"
      offline_cache: true

  learning_resources:
    - id: "mobile-web"
      title: "Mobile Web Development"
      type: "book"
      reference: "ISBN 978-1491950357"

tooling:
  infrastructure_tools:
    - tool: "playwright"
      purpose: "Mobile device emulation"
      command: "npx playwright test --project='Mobile Safari'"
    - tool: "cypress"
      purpose: "Viewport testing"
      command: "cypress run --config viewportWidth=375,viewportHeight=667"
    - tool: "appium"
      purpose: "Native and hybrid app testing"
      command: "appium"
    - tool: "detox"
      purpose: "React Native testing"
      command: "detox test"

  scripts:
    - id: "mobile-test-analyzer"
      language: "bash"
      purpose: "Analyze mobile test coverage"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Mobile Testing Analysis ==="
        echo "Mobile-specific tests:"
        find . \( -name '*mobile*' -o -name '*responsive*' \) -name '*.spec.*' 2>/dev/null | head -15
        echo ""
        echo "Viewport manipulation:"
        grep -r 'viewport\|setViewportSize\|viewportWidth' --include='*.spec.*' --include='*.config.*' . 2>/dev/null | head -15
        echo ""
        echo "Touch interaction tests:"
        grep -r 'touch\|swipe\|tap' --include='*.spec.*' . 2>/dev/null | head -10

signals:
  critical:
    - id: "MOBILE-CRIT-001"
      signal: "No mobile testing exists"
      evidence_pattern: "No mobile viewports or device emulation configured"
      explanation: |
        Without mobile testing, mobile users may encounter completely broken
        experiences. Mobile traffic often exceeds 50% of users.
      remediation: "Add mobile viewport testing for critical user journeys"

    - id: "MOBILE-CRIT-002"
      signal: "Mobile-specific features not tested"
      evidence_pattern: "Touch, geolocation, camera untested"
      explanation: |
        Mobile-specific features like touch gestures and device APIs
        can fail silently without testing.
      remediation: "Add tests for mobile-specific functionality"

  high:
    - id: "MOBILE-HIGH-001"
      signal: "Only one mobile viewport tested"
      evidence_pattern: "Single viewport size, no device variety"
      explanation: |
        Mobile devices vary significantly in size. Testing one viewport
        misses issues on larger phones, tablets, and small phones.
      remediation: "Add multiple mobile viewports to test matrix"

    - id: "MOBILE-HIGH-002"
      signal: "Touch interactions not tested"
      evidence_pattern: "No swipe, tap, or gesture tests"
      explanation: |
        Touch interaction issues (swipe navigation, touch targets)
        go undetected without specific testing.
      remediation: "Add touch interaction tests"

  medium:
    - id: "MOBILE-MED-001"
      signal: "Mobile tests don't cover landscape orientation"
      evidence_pattern: "Only portrait orientation tested"
      remediation: "Add landscape orientation tests for key flows"

    - id: "MOBILE-MED-002"
      signal: "No mobile performance testing"
      evidence_pattern: "Mobile network conditions not simulated"
      remediation: "Add tests with mobile network throttling"

  low:
    - id: "MOBILE-LOW-001"
      signal: "Mobile test documentation missing"
      evidence_pattern: "Mobile device matrix not documented"

  positive:
    - id: "MOBILE-POS-001"
      signal: "Comprehensive mobile device matrix"
      evidence_pattern: "Multiple iOS and Android devices tested"
    - id: "MOBILE-POS-002"
      signal: "Touch interaction testing implemented"
      evidence_pattern: "Swipe, tap, and gesture tests exist"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review mobile configuration"
      description: |
        Examine E2E framework configuration for mobile device
        and viewport settings.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find mobile viewport config"
          command: "grep -r 'viewport\\|mobile\\|iphone\\|android' --include='*.config.*' . 2>/dev/null | head -20"
        - purpose: "Find mobile projects in Playwright"
          command: "grep -A5 'Mobile' playwright.config.* 2>/dev/null"
      expected_findings:
        - "Mobile device configuration"
        - "Viewport sizes"

    - id: "2"
      name: "Identify mobile tests"
      description: |
        Locate tests that specifically target mobile functionality
        or viewports.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find mobile test files"
          command: "find . \\( -name '*mobile*' -o -name '*responsive*' \\) -name '*.spec.*' 2>/dev/null | head -15"
        - purpose: "Find viewport tests"
          command: "grep -r -l 'viewport\\|setViewportSize' --include='*.spec.*' . 2>/dev/null | head -10"
      expected_findings:
        - "Mobile test inventory"
        - "Viewport test coverage"

    - id: "3"
      name: "Assess touch testing"
      description: |
        Check whether touch-specific interactions are tested.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find touch tests"
          command: "grep -r 'touch\\|swipe\\|tap\\|gesture\\|scroll' --include='*.spec.*' . 2>/dev/null | head -15"
      expected_findings:
        - "Touch interaction coverage"
        - "Gesture testing"

    - id: "4"
      name: "Check mobile CI integration"
      description: |
        Verify mobile tests are included in CI pipeline.
      duration_estimate: "15 min"
      commands:
        - purpose: "Check CI for mobile"
          command: "grep -r 'mobile\\|viewport\\|iphone' .github/workflows/*.yml 2>/dev/null | head -10"
      expected_findings:
        - "CI mobile integration"
        - "Automated mobile testing"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "mobile_coverage"
      format: "table"
      sections:
        - "Device Configuration"
        - "Test Inventory"
        - "Touch Testing"
        - "CI Integration"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Mobile Testing Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Mobile tests executed on devices/emulators"
    medium: "Configuration reviewed without execution"
    low: "Based on file patterns only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "mobile-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Mobile analysis requires configuration review"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "mobile-001"
    item: "Mobile configuration reviewed"
    level: "CRITICAL"
    verification: "grep -r 'viewport\\|mobile' --include='*.config.*' . | wc -l"
    expected: "PASS (configuration documented)"

  - id: "mobile-002"
    item: "Mobile tests identified"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Document mobile test inventory"
    expected: "Confirmed by reviewer"

  - id: "mobile-003"
    item: "Touch testing assessed"
    level: "WARNING"
    verification: "grep -r 'touch\\|swipe' --include='*.spec.*' . | wc -l"
    expected: "PASS (coverage documented)"

governance:
  applicable_to:
    archetypes: ["web-applications", "mobile-applications"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["Mobile Accessibility"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.e2e-testing.cross-browser-testing"
    - "testing-quality-assurance.e2e-testing.e2e-coverage"
    - "testing-quality-assurance.e2e-testing.e2e-test-stability"
