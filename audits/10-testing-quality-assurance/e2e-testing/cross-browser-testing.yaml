# ============================================================
# AUDIT: Cross-Browser Testing
# ============================================================
# Evaluates the coverage of E2E tests across different browsers
# and browser versions.
# ============================================================

audit:
  id: "testing-quality-assurance.e2e-testing.cross-browser-testing"
  name: "Cross-Browser Testing"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 10
  subcategory: "e2e-testing"

  tier: "expert"
  estimated_duration: "2 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "testing"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Assesses whether E2E tests are executed across multiple browsers
    (Chrome, Firefox, Safari, Edge) to ensure cross-browser compatibility.
    Evaluates browser matrix coverage, browser-specific issue detection,
    and mobile browser testing.

  why_it_matters: |
    Browser differences in JavaScript engines, CSS rendering, and API
    support cause features to break for portions of users. Cross-browser
    testing catches compatibility issues before they affect users who
    don't use the development team's preferred browser.

  when_to_run:
    - "Before major releases"
    - "After frontend framework updates"
    - "When adding new browser features"
    - "Browser support matrix reviews"

prerequisites:
  required_artifacts:
    - type: "e2e_tests"
      description: "End-to-end test files"
    - type: "browser_config"
      description: "Browser configuration for E2E framework"

  access_requirements:
    - "Source code repository access"
    - "CI/CD configuration access"
    - "Browser farm or local browsers"

discovery:
  file_patterns:
    - glob: "**/cypress.config.{js,ts}"
      purpose: "Cypress browser configuration"
    - glob: "**/playwright.config.{js,ts}"
      purpose: "Playwright browser configuration"
    - glob: "**/.browserslistrc"
      purpose: "Browserslist configuration"

  code_patterns:
    - pattern: "browsers?.*chrome|browsers?.*firefox|browsers?.*safari"
      type: "regex"
      scope: "config"
      purpose: "Identify browser configurations"
    - pattern: "webkit|chromium|firefox"
      type: "keyword"
      scope: "config"
      purpose: "Identify Playwright browsers"
    - pattern: "browserstack|saucelabs|lambdatest"
      type: "keyword"
      scope: "config"
      purpose: "Identify cloud browser services"

knowledge_sources:
  guides:
    - id: "cross-browser-testing"
      name: "Cross-Browser Testing Guide"
      url: "https://playwright.dev/docs/browsers"
      offline_cache: true
    - id: "browser-support"
      name: "Can I Use - Browser Support Tables"
      url: "https://caniuse.com/"
      offline_cache: false

  learning_resources:
    - id: "web-testing"
      title: "Modern Web Testing"
      type: "book"
      reference: "ISBN 978-1800564473"

tooling:
  infrastructure_tools:
    - tool: "playwright"
      purpose: "Multi-browser E2E testing"
      command: "npx playwright test --project=chromium --project=firefox --project=webkit"
    - tool: "browserstack"
      purpose: "Cloud browser testing"
      command: "browserstack-cypress run"
    - tool: "saucelabs"
      purpose: "Cross-browser cloud testing"
      command: "saucectl run"

  scripts:
    - id: "browser-coverage-analyzer"
      language: "bash"
      purpose: "Analyze browser test coverage"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Cross-Browser Testing Analysis ==="
        echo "Browser configurations:"
        grep -r 'browsers\|chromium\|firefox\|webkit\|safari\|edge' --include='*.config.*' . 2>/dev/null | head -15
        echo ""
        echo "Browser farm integrations:"
        grep -r 'browserstack\|saucelabs\|lambdatest' --include='*.json' --include='*.config.*' . 2>/dev/null | head -10
        echo ""
        echo "CI browser matrix:"
        grep -r 'browser\|BROWSER' .github/workflows/*.yml 2>/dev/null | head -10

signals:
  critical:
    - id: "BROWSER-CRIT-001"
      signal: "E2E tests only run on single browser"
      evidence_pattern: "No browser matrix in CI configuration"
      explanation: |
        Testing only one browser misses compatibility issues affecting
        significant portions of users on other browsers.
      remediation: "Add multi-browser testing to CI pipeline"

    - id: "BROWSER-CRIT-002"
      signal: "Safari/WebKit not tested"
      evidence_pattern: "No Safari or WebKit in test configuration"
      explanation: |
        Safari has significant differences from Chrome/Firefox. iOS users
        require Safari compatibility which goes untested.
      remediation: "Add Safari/WebKit to browser test matrix"

  high:
    - id: "BROWSER-HIGH-001"
      signal: "Mobile browsers not tested"
      evidence_pattern: "No mobile browser configuration"
      explanation: |
        Mobile browsers have different viewport, touch, and performance
        characteristics that can cause desktop-only tested features to fail.
      remediation: "Add mobile browser testing configuration"

    - id: "BROWSER-HIGH-002"
      signal: "Outdated browser versions in test matrix"
      evidence_pattern: "Test matrix includes only latest versions"
      explanation: |
        Users don't always update immediately. Testing only latest versions
        misses issues affecting users on older browser versions.
      remediation: "Include supported older versions in test matrix"

  medium:
    - id: "BROWSER-MED-001"
      signal: "Browser matrix not aligned with user analytics"
      evidence_pattern: "Tested browsers don't match actual user browsers"
      remediation: "Align test matrix with user browser analytics"

    - id: "BROWSER-MED-002"
      signal: "Cross-browser tests only run on merge"
      evidence_pattern: "Browser matrix only in main branch CI"
      remediation: "Run at least one non-Chrome browser on PRs"

  low:
    - id: "BROWSER-LOW-001"
      signal: "No browser-specific test documentation"
      evidence_pattern: "Browser matrix not documented"

  positive:
    - id: "BROWSER-POS-001"
      signal: "Comprehensive browser matrix in CI"
      evidence_pattern: "Chrome, Firefox, Safari, Edge all tested"
    - id: "BROWSER-POS-002"
      signal: "Cloud browser service integration"
      evidence_pattern: "BrowserStack or similar for extended matrix"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review browser configuration"
      description: |
        Examine E2E framework configuration to understand which
        browsers are configured for testing.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find browser config in Playwright"
          command: "cat playwright.config.* 2>/dev/null | head -50; grep -r 'projects' playwright.config.* 2>/dev/null"
        - purpose: "Find browser config in Cypress"
          command: "cat cypress.config.* 2>/dev/null | head -50"
      expected_findings:
        - "Configured browsers"
        - "Browser versions"

    - id: "2"
      name: "Check CI browser matrix"
      description: |
        Review CI configuration to verify which browsers are
        tested in the pipeline.
      duration_estimate: "20 min"
      commands:
        - purpose: "Check GitHub Actions"
          command: "grep -r 'browser\\|BROWSER' .github/workflows/*.yml 2>/dev/null"
        - purpose: "Check for matrix strategy"
          command: "grep -A10 'matrix' .github/workflows/*.yml 2>/dev/null | head -30"
      expected_findings:
        - "CI browser matrix"
        - "Parallel browser execution"

    - id: "3"
      name: "Assess browser coverage gaps"
      description: |
        Identify which major browsers and versions are missing
        from the test configuration.
      duration_estimate: "25 min"
      commands:
        - purpose: "Check for Safari/WebKit"
          command: "grep -r 'safari\\|webkit' --include='*.config.*' --include='*.yml' . 2>/dev/null | head -10"
        - purpose: "Check for mobile"
          command: "grep -r 'mobile\\|iphone\\|android' --include='*.config.*' --include='*.yml' . 2>/dev/null | head -10"
      expected_findings:
        - "Missing browsers"
        - "Mobile coverage"

    - id: "4"
      name: "Review cloud browser integration"
      description: |
        Check for integration with cloud browser testing services
        for extended browser matrix.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find cloud service config"
          command: "grep -r 'browserstack\\|saucelabs\\|lambdatest' --include='*.json' --include='*.config.*' . 2>/dev/null | head -10"
      expected_findings:
        - "Cloud service integration"
        - "Extended matrix coverage"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "browser_matrix"
      format: "table"
      sections:
        - "Configured Browsers"
        - "CI Matrix"
        - "Coverage Gaps"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Cross-Browser Coverage Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Browser tests executed across full matrix"
    medium: "Configuration reviewed without execution"
    low: "Based on config file patterns only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "cross-browser-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Browser analysis requires configuration review"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "browser-001"
    item: "Browser configuration reviewed"
    level: "CRITICAL"
    verification: "grep -r 'browser' --include='*.config.*' . | wc -l"
    expected: "PASS (configuration documented)"

  - id: "browser-002"
    item: "CI browser matrix assessed"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Document browsers tested in CI"
    expected: "Confirmed by reviewer"

  - id: "browser-003"
    item: "Browser gaps identified"
    level: "WARNING"
    verification: "manual"
    verification_notes: "List untested browsers"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["web-applications"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["Browser Compatibility"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.e2e-testing.e2e-coverage"
    - "testing-quality-assurance.e2e-testing.mobile-testing"
    - "testing-quality-assurance.e2e-testing.e2e-test-stability"
