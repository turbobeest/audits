# ============================================================
# AUDIT: E2E Test Coverage
# ============================================================
# Evaluates the scope and coverage of end-to-end tests across
# critical user journeys and system flows.
# ============================================================

audit:
  id: "testing-quality-assurance.e2e-testing.e2e-coverage"
  name: "E2E Test Coverage"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 10
  subcategory: "e2e-testing"

  tier: "expert"
  estimated_duration: "2 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "testing"

  default_profiles:
    - "full"
    - "quality"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Assesses the coverage of end-to-end tests across critical user journeys
    and system functionality. Evaluates whether E2E tests cover key paths
    without duplicating lower-level tests. Analyzes the balance between
    comprehensive coverage and test suite maintainability.

  why_it_matters: |
    E2E tests are the final verification that the system works as a whole.
    Missing E2E coverage on critical paths means bugs in integration points
    can reach production. However, over-coverage leads to slow, brittle
    suites. Strategic E2E coverage maximizes confidence while minimizing cost.

  when_to_run:
    - "Before major releases"
    - "Test strategy reviews"
    - "After major feature additions"
    - "CI pipeline optimization"

prerequisites:
  required_artifacts:
    - type: "e2e_tests"
      description: "End-to-end test files (Cypress, Playwright, etc.)"
    - type: "user_journeys"
      description: "Documentation of critical user journeys"

  access_requirements:
    - "Source code repository access"
    - "Test environment access"
    - "Product requirements documentation"

discovery:
  file_patterns:
    - glob: "**/e2e/**/*.{spec,test}.{js,ts}"
      purpose: "E2E test files"
    - glob: "**/cypress/**/*.{spec,cy}.{js,ts}"
      purpose: "Cypress tests"
    - glob: "**/playwright/**/*.spec.{js,ts}"
      purpose: "Playwright tests"
    - glob: "**/*.e2e.{spec,test}.{js,ts}"
      purpose: "E2E naming convention"

  code_patterns:
    - pattern: "cy\\.|page\\.|browser\\."
      type: "regex"
      scope: "source"
      purpose: "Identify E2E framework usage"
    - pattern: "describe|it|test"
      type: "keyword"
      scope: "source"
      purpose: "Identify test blocks"
    - pattern: "login|checkout|purchase|signup"
      type: "keyword"
      scope: "source"
      purpose: "Identify critical journey tests"

knowledge_sources:
  guides:
    - id: "e2e-testing"
      name: "End-to-End Testing Best Practices"
      url: "https://docs.cypress.io/guides/references/best-practices"
      offline_cache: true
    - id: "testing-pyramid"
      name: "The Practical Test Pyramid"
      url: "https://martinfowler.com/articles/practical-test-pyramid.html"
      offline_cache: true

  learning_resources:
    - id: "e2e-book"
      title: "Testing Web Applications"
      type: "book"
      reference: "ISBN 978-1617297496"

tooling:
  static_analysis:
    - tool: "cypress"
      purpose: "E2E testing framework"
      offline_capable: true
    - tool: "playwright"
      purpose: "Cross-browser E2E testing"
      offline_capable: true
    - tool: "selenium"
      purpose: "Browser automation"
      offline_capable: true

  scripts:
    - id: "e2e-coverage-analyzer"
      language: "bash"
      purpose: "Analyze E2E test coverage"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== E2E Test Coverage Analysis ==="
        echo "E2E test files:"
        find . \( -path '*e2e*' -o -path '*cypress*' -o -path '*playwright*' \) -name '*.spec.*' -o -name '*.cy.*' 2>/dev/null | grep -v node_modules | head -25
        echo ""
        echo "Total E2E tests:"
        grep -r 'it(\|test(' --include='*.spec.*' --include='*.cy.*' . 2>/dev/null | grep -v node_modules | wc -l
        echo ""
        echo "Critical journey coverage:"
        grep -r -l 'login\|checkout\|signup\|purchase' --include='*.spec.*' --include='*.cy.*' . 2>/dev/null | head -10

signals:
  critical:
    - id: "E2E-COV-CRIT-001"
      signal: "No E2E tests exist for the application"
      evidence_pattern: "Zero E2E test files found"
      explanation: |
        Without E2E tests, there's no verification that the complete
        system works for users. Integration issues go undetected.
      remediation: "Implement E2E tests for critical user journeys"

    - id: "E2E-COV-CRIT-002"
      signal: "Critical user journeys have no E2E coverage"
      evidence_pattern: "Login, checkout, or signup flows untested"
      explanation: |
        Core user journeys must work for the business to function.
        Missing E2E tests on these paths risks revenue-impacting bugs.
      remediation: "Add E2E tests for all revenue-critical user flows"

  high:
    - id: "E2E-COV-HIGH-001"
      signal: "E2E tests only cover happy paths"
      evidence_pattern: "No error scenario E2E tests"
      explanation: |
        Users encounter errors. E2E tests should verify error handling
        works correctly from the user's perspective.
      remediation: "Add E2E tests for key error scenarios"

    - id: "E2E-COV-HIGH-002"
      signal: "E2E coverage duplicates unit/integration tests excessively"
      evidence_pattern: "Same logic tested at all levels"
      explanation: |
        Excessive duplication slows the suite and increases maintenance.
        E2E should test integration, not repeat lower-level tests.
      remediation: "Remove duplicated coverage, focus E2E on integration"

  medium:
    - id: "E2E-COV-MED-001"
      signal: "E2E tests don't cover all user roles"
      evidence_pattern: "Only admin or only user role tested"
      remediation: "Add E2E tests for each user role's critical paths"

    - id: "E2E-COV-MED-002"
      signal: "No E2E tests for key integrations"
      evidence_pattern: "Third-party integrations untested E2E"
      remediation: "Add E2E smoke tests for critical integrations"

  low:
    - id: "E2E-COV-LOW-001"
      signal: "E2E coverage documentation outdated"
      evidence_pattern: "Test inventory doesn't match actual tests"

  positive:
    - id: "E2E-COV-POS-001"
      signal: "All critical journeys have E2E coverage"
      evidence_pattern: "Login, checkout, signup, key features tested"
    - id: "E2E-COV-POS-002"
      signal: "E2E coverage mapped to user stories"
      evidence_pattern: "Traceability between tests and requirements"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory E2E tests"
      description: |
        Locate all E2E test files and understand the testing
        framework and organization.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find E2E test files"
          command: "find . \\( -path '*e2e*' -o -path '*cypress*' -o -path '*playwright*' \\) \\( -name '*.spec.*' -o -name '*.cy.*' -o -name '*.test.*' \\) 2>/dev/null | grep -v node_modules | head -30"
        - purpose: "Identify E2E framework"
          command: "grep -r 'cypress\\|playwright\\|selenium\\|webdriver' package.json 2>/dev/null | head -5"
      expected_findings:
        - "E2E test inventory"
        - "Framework identification"

    - id: "2"
      name: "Map critical journeys"
      description: |
        Identify critical user journeys and verify E2E
        coverage for each.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find journey-related tests"
          command: "grep -r -l 'login\\|signup\\|checkout\\|purchase\\|register' --include='*.spec.*' --include='*.cy.*' . 2>/dev/null | head -15"
        - purpose: "Extract test descriptions"
          command: "grep -r -h 'describe(\\|it(' --include='*.spec.*' --include='*.cy.*' . 2>/dev/null | head -30"
      expected_findings:
        - "Critical journey coverage"
        - "Test descriptions"

    - id: "3"
      name: "Analyze coverage gaps"
      description: |
        Identify features and user flows that lack E2E
        test coverage.
      duration_estimate: "25 min"
      questions:
        - "What critical features lack E2E tests?"
        - "Are all user roles covered?"
        - "Are error scenarios tested?"
      expected_findings:
        - "Coverage gaps"
        - "Missing scenarios"

    - id: "4"
      name: "Assess coverage efficiency"
      description: |
        Evaluate whether E2E tests provide unique value
        or duplicate lower-level tests.
      duration_estimate: "20 min"
      questions:
        - "Do E2E tests overlap significantly with integration tests?"
        - "Is E2E focused on user-facing behavior?"
        - "Could some E2E tests be moved to lower levels?"
      expected_findings:
        - "Coverage efficiency"
        - "Optimization opportunities"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "coverage_map"
      format: "table"
      sections:
        - "E2E Test Inventory"
        - "Critical Journey Coverage"
        - "Gap Analysis"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "E2E Coverage Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "E2E tests executed and mapped to requirements"
    medium: "Test files reviewed without execution"
    low: "Based on file patterns only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "e2e-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "E2E coverage analysis requires thorough review"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "e2e-cov-001"
    item: "E2E tests inventoried"
    level: "CRITICAL"
    verification: "find . -path '*e2e*' -name '*.spec.*' | wc -l"
    expected: "PASS (count documented)"

  - id: "e2e-cov-002"
    item: "Critical journeys mapped"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Document coverage of critical user journeys"
    expected: "Confirmed by reviewer"

  - id: "e2e-cov-003"
    item: "Coverage gaps identified"
    level: "WARNING"
    verification: "manual"
    verification_notes: "List missing E2E coverage areas"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "ISO 25010"
      controls: ["Functional Suitability"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.test-strategy.test-pyramid-balance"
    - "testing-quality-assurance.e2e-testing.user-journey-testing"
    - "testing-quality-assurance.e2e-testing.e2e-test-stability"
