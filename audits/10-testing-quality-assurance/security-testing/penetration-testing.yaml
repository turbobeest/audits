# ============================================================
# AUDIT: Penetration Testing
# ============================================================
# Evaluates penetration testing practices to identify exploitable
# vulnerabilities through simulated attacks.
# ============================================================

audit:
  id: "testing-quality-assurance.security-testing.penetration-testing"
  name: "Penetration Testing"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 10
  subcategory: "security-testing"

  tier: "expert"
  estimated_duration: "6 hours"

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: true

execution:
  automatable: "partial"
  severity: "critical"
  scope: "security"

  default_profiles:
    - "full"
    - "security"
    - "production"

  blocks_phase: false
  parallelizable: false

description:
  what: |
    Assesses penetration testing practices including scope definition, testing
    methodology, finding documentation, and remediation tracking. Reviews
    whether penetration tests cover critical attack surfaces, use appropriate
    tools and techniques, and produce actionable results.

  why_it_matters: |
    Penetration testing reveals exploitable vulnerabilities that automated
    scanners miss. Without regular pen testing, organizations remain blind
    to complex attack chains, business logic flaws, and novel attack vectors.
    Pen tests validate the real-world security posture against motivated
    attackers.

  when_to_run:
    - "Annually or after major releases"
    - "Before handling sensitive data types"
    - "After significant architecture changes"
    - "For compliance requirements"

prerequisites:
  required_artifacts:
    - type: "pentest-scope"
      description: "Documented penetration testing scope and rules of engagement"
    - type: "system-documentation"
      description: "Architecture diagrams and API documentation"

  access_requirements:
    - "Staging or isolated test environment"
    - "Previous penetration test reports"
    - "Remediation tracking system access"

discovery:
  file_patterns:
    - glob: "**/pentest/**"
      purpose: "Penetration testing directories"
    - glob: "**/security-assessment/**"
      purpose: "Security assessment reports"
    - glob: "**/*pentest*.{md,pdf,doc}"
      purpose: "Penetration test reports"

  documents_to_review:
    - type: "Penetration test reports"
      purpose: "Review testing scope, methodology, and findings"
    - type: "Remediation tracking"
      purpose: "Verify finding closure and validation"
    - type: "Rules of engagement"
      purpose: "Confirm appropriate testing scope"

  interviews:
    - role: "Security team lead"
      questions:
        - "When was the last penetration test conducted?"
        - "What scope was included in testing?"
        - "How are findings prioritized and tracked?"
      purpose: "Understand penetration testing program maturity"

knowledge_sources:
  specifications:
    - id: "owasp-testing"
      name: "OWASP Testing Guide"
      url: "https://owasp.org/www-project-web-security-testing-guide/"
      offline_cache: true
      priority: "required"
    - id: "owasp-asvs"
      name: "OWASP ASVS"
      url: "https://owasp.org/www-project-application-security-verification-standard/"
      offline_cache: true
      priority: "required"
    - id: "ptes"
      name: "Penetration Testing Execution Standard"
      url: "http://www.pentest-standard.org/"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "nist-pentest"
      name: "NIST Technical Guide to Information Security Testing"
      url: "https://csrc.nist.gov/publications/detail/sp/800-115/final"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Burp Suite"
      purpose: "Web application penetration testing"
      offline_capable: true
    - tool: "OWASP ZAP"
      purpose: "Open-source web app security testing"
      offline_capable: true
    - tool: "Metasploit"
      purpose: "Exploitation framework"
      offline_capable: true
    - tool: "Nmap"
      purpose: "Network reconnaissance"
      offline_capable: true

  infrastructure_tools:
    - tool: "sqlmap"
      purpose: "SQL injection testing"
      command: "sqlmap -u 'http://target/page?id=1' --dbs"
    - tool: "nuclei"
      purpose: "Vulnerability scanning with templates"
      command: "nuclei -u http://target -t cves/"

signals:
  critical:
    - id: "PENTEST-CRIT-001"
      signal: "No penetration testing performed"
      evidence_indicators:
        - "No penetration test reports on file"
        - "Security team unaware of pen testing schedule"
        - "No budget allocated for security testing"
      explanation: |
        Without penetration testing, exploitable vulnerabilities remain
        undiscovered. Automated scanners miss complex attack chains and
        business logic flaws that attackers actively exploit.
      remediation: "Establish annual penetration testing program with qualified testers"

    - id: "PENTEST-CRIT-002"
      signal: "Critical findings from pen tests remain unresolved"
      evidence_indicators:
        - "Critical vulnerabilities open >90 days"
        - "No remediation tracking for pen test findings"
      explanation: |
        Identified but unresolved vulnerabilities represent known exposure.
        Attackers actively exploit common vulnerabilities, and delayed
        remediation increases breach probability.
      remediation: "Remediate critical findings within 30 days with validation"

  high:
    - id: "PENTEST-HIGH-001"
      signal: "Penetration test scope excludes critical systems"
      evidence_pattern: "Scope documents excluding production systems or APIs"
      explanation: |
        Limited scope leaves attack surfaces untested. Systems excluded from
        pen testing may harbor vulnerabilities that attackers discover and
        exploit.
      remediation: "Expand pen test scope to cover all production-facing systems"

    - id: "PENTEST-HIGH-002"
      signal: "Penetration tests not conducted by qualified testers"
      evidence_pattern: "Internal-only testing without security expertise"
      explanation: |
        Penetration testing requires specialized skills. Unqualified testers
        miss vulnerabilities that experienced attackers find. External
        perspective reveals blind spots internal teams overlook.
      remediation: "Engage qualified penetration testers with relevant certifications"

  medium:
    - id: "PENTEST-MED-001"
      signal: "Penetration tests not repeated after remediation"
      evidence_pattern: "Findings closed without retest validation"
      remediation: "Validate remediation through targeted retesting"

    - id: "PENTEST-MED-002"
      signal: "Penetration test findings not integrated with vulnerability management"
      evidence_pattern: "Pen test results stored separately from vulnerability tracking"
      remediation: "Integrate pen test findings into unified vulnerability management"

  low:
    - id: "PENTEST-LOW-001"
      signal: "Penetration test reports not retained"
      remediation: "Archive pen test reports for compliance and trend analysis"

  positive:
    - id: "PENTEST-POS-001"
      signal: "Regular penetration testing with comprehensive scope"
    - id: "PENTEST-POS-002"
      signal: "Timely remediation with validation testing"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review penetration testing program"
      description: |
        Examine penetration testing schedule, scope documentation, and
        program governance.
      duration_estimate: "45 min"
      questions:
        - "Is there a documented penetration testing program?"
        - "What is the testing frequency and last test date?"
        - "Who conducts the penetration tests?"
      expected_findings:
        - "Testing program documentation"
        - "Testing schedule and history"

    - id: "2"
      name: "Examine test scope and methodology"
      description: |
        Review penetration test scoping documents and rules of engagement
        to verify appropriate coverage.
      duration_estimate: "60 min"
      questions:
        - "What systems are in scope for testing?"
        - "What testing methodology is used?"
        - "Are there any exclusions or limitations?"
      expected_findings:
        - "Scope documentation"
        - "Rules of engagement"

    - id: "3"
      name: "Analyze findings and severity"
      description: |
        Review penetration test reports to understand finding patterns,
        severity distribution, and vulnerability types.
      duration_estimate: "90 min"
      questions:
        - "What critical/high findings were identified?"
        - "Are there recurring vulnerability patterns?"
        - "How do findings compare to previous tests?"
      expected_findings:
        - "Finding severity breakdown"
        - "Vulnerability patterns"

    - id: "4"
      name: "Verify remediation tracking"
      description: |
        Check that findings are tracked through remediation with
        appropriate timelines and validation.
      duration_estimate: "45 min"
      commands:
        - purpose: "Check for remediation tracking"
          command: "find . -type f -name '*remediation*' -o -name '*vulnerability*' 2>/dev/null"
      expected_findings:
        - "Remediation tracking process"
        - "Finding closure rates"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Penetration Testing Program Assessment"
        - "Scope Coverage Analysis"
        - "Remediation Status Review"
        - "Recommendations"

  confidence_guidance:
    high: "Pen test reports reviewed, remediation verified, program documented"
    medium: "Reports exist but limited visibility into process"
    low: "Limited evidence of penetration testing"

offline:
  capability: "partial"
  cache_manifest:
    knowledge:
      - source_id: "owasp-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed report and process review"
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1

closeout_checklist:
  - id: "penetration-testing-001"
    item: "Penetration testing program exists"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Reviewer confirms pen test reports exist from past 12 months"
    expected: "Confirmed by reviewer"

  - id: "penetration-testing-002"
    item: "Critical findings remediated"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Reviewer confirms no critical findings open >90 days"
    expected: "Confirmed by reviewer"

  - id: "penetration-testing-003"
    item: "Remediation validated through retest"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Reviewer confirms remediation validation process exists"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["web-application", "api-service", "financial-system"]

  compliance_frameworks:
    - framework: "PCI-DSS"
      controls: ["11.3"]
    - framework: "SOC2"
      controls: ["CC6.1", "CC7.1"]
    - framework: "HIPAA"
      controls: ["164.308(a)(8)"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.security-testing.vulnerability-scanning"
    - "testing-quality-assurance.security-testing.static-security-analysis"
    - "testing-quality-assurance.security-testing.dynamic-security-analysis"
