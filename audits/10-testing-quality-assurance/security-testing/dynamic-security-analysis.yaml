# ============================================================
# AUDIT: Dynamic Security Analysis
# ============================================================
# Evaluates dynamic application security testing (DAST) practices
# for identifying runtime vulnerabilities.
# ============================================================

audit:
  id: "testing-quality-assurance.security-testing.dynamic-security-analysis"
  name: "Dynamic Security Analysis"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 10
  subcategory: "security-testing"

  tier: "expert"
  estimated_duration: "4 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Examines dynamic application security testing (DAST) practices including
    scanner configuration, authentication handling, coverage scope, and
    integration with development workflows. Reviews runtime vulnerability
    detection for web applications, APIs, and services.

  why_it_matters: |
    DAST finds vulnerabilities that static analysis cannot detect, including
    runtime configuration issues, authentication bypasses, and injection
    flaws that only manifest during execution. DAST validates that security
    controls work correctly in the running application.

  when_to_run:
    - "Pre-deployment validation"
    - "After configuration changes"
    - "Regular security assessments"
    - "After authentication changes"

prerequisites:
  required_artifacts:
    - type: "dast-configuration"
      description: "DAST scanner configurations"
    - type: "running-application"
      description: "Deployed application instance for scanning"

  access_requirements:
    - "DAST scanner access"
    - "Test environment with running application"
    - "Authentication credentials for scanning"

discovery:
  file_patterns:
    - glob: "**/zap/**"
      purpose: "OWASP ZAP configuration"
    - glob: "**/*zap*.{yaml,yml}"
      purpose: "ZAP configuration files"
    - glob: "**/dast/**"
      purpose: "DAST configuration directories"
    - glob: "**/nikto*"
      purpose: "Nikto configuration"

  code_patterns:
    - pattern: "zap|dast|nikto|arachni|burp"
      type: "keyword"
      scope: "config"
      purpose: "DAST tool references"
    - pattern: "dynamic.*scan|runtime.*security|active.*scan"
      type: "regex"
      scope: "config"
      purpose: "Dynamic scanning configuration"
    - pattern: "spider|crawl|scan.*url"
      type: "keyword"
      scope: "config"
      purpose: "Application scanning configuration"

knowledge_sources:
  specifications:
    - id: "owasp-testing"
      name: "OWASP Testing Guide"
      url: "https://owasp.org/www-project-web-security-testing-guide/"
      offline_cache: true
      priority: "required"
    - id: "owasp-asvs"
      name: "OWASP ASVS"
      url: "https://owasp.org/www-project-application-security-verification-standard/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "zap-docs"
      name: "OWASP ZAP Documentation"
      url: "https://www.zaproxy.org/docs/"
      offline_cache: true
    - id: "dast-best"
      name: "DAST Best Practices"
      url: "https://owasp.org/www-community/DAST"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "OWASP ZAP"
      purpose: "Open-source DAST scanner"
      offline_capable: true
    - tool: "Nuclei"
      purpose: "Template-based vulnerability scanner"
      offline_capable: true
    - tool: "Nikto"
      purpose: "Web server scanner"
      offline_capable: true
    - tool: "sqlmap"
      purpose: "SQL injection scanner"
      offline_capable: true

  infrastructure_tools:
    - tool: "zap-cli"
      purpose: "Command-line ZAP scanning"
      command: "zap-cli quick-scan --spider -r http://target"
    - tool: "nuclei"
      purpose: "Template-based scanning"
      command: "nuclei -u http://target -t cves/ -t vulnerabilities/"

  scripts:
    - id: "run-dast"
      language: "bash"
      purpose: "Run DAST scan"
      source: "inline"
      code: |
        #!/bin/bash
        # Start ZAP in daemon mode and run scan
        zap.sh -daemon -port 8090 &
        sleep 10
        zap-cli -p 8090 open-url "$TARGET_URL"
        zap-cli -p 8090 spider "$TARGET_URL"
        zap-cli -p 8090 active-scan "$TARGET_URL"
        zap-cli -p 8090 report -o report.html -f html

signals:
  critical:
    - id: "DAST-CRIT-001"
      signal: "No dynamic security testing performed"
      evidence_pattern: "Absence of DAST tool configurations or scan results"
      explanation: |
        Without DAST, runtime vulnerabilities remain undetected. Issues like
        authentication bypasses, misconfigurations, and injection flaws
        that only appear at runtime go undiscovered until exploitation.
      remediation: "Implement DAST scanning for all web applications and APIs"

    - id: "DAST-CRIT-002"
      signal: "DAST scanning excludes authenticated areas"
      evidence_pattern: "No authentication configuration in DAST setup"
      explanation: |
        Unauthenticated-only scanning misses most of the application.
        Authentication-required features often contain the most sensitive
        functionality and critical vulnerabilities.
      remediation: "Configure DAST with authentication to scan protected areas"

  high:
    - id: "DAST-HIGH-001"
      signal: "DAST not integrated into CI/CD"
      evidence_pattern: "Manual-only DAST execution"
      explanation: |
        Manual DAST execution is infrequent and may miss regressions.
        CI/CD integration ensures every deployment is scanned before
        reaching production.
      remediation: "Integrate DAST into deployment pipeline"

    - id: "DAST-HIGH-002"
      signal: "DAST coverage incomplete"
      evidence_pattern: "Critical endpoints excluded from scanning"
      explanation: |
        Partial coverage leaves attack surfaces unprotected. APIs,
        admin interfaces, and sensitive endpoints need explicit
        inclusion in DAST scope.
      remediation: "Ensure DAST scope covers all application endpoints"

  medium:
    - id: "DAST-MED-001"
      signal: "DAST findings not triaged"
      evidence_pattern: "Scan results without follow-up tracking"
      remediation: "Implement DAST finding triage and tracking process"

    - id: "DAST-MED-002"
      signal: "DAST scan configurations outdated"
      evidence_pattern: "Old target URLs or deprecated scan configurations"
      remediation: "Keep DAST configurations current with application changes"

  low:
    - id: "DAST-LOW-001"
      signal: "DAST scan results not archived"
      remediation: "Archive DAST results for trend analysis"

  positive:
    - id: "DAST-POS-001"
      signal: "Comprehensive authenticated DAST with CI/CD integration"
    - id: "DAST-POS-002"
      signal: "Active finding triage and remediation tracking"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify DAST infrastructure"
      description: |
        Search for DAST tool configurations and CI/CD integration.
      duration_estimate: "25 min"
      commands:
        - purpose: "Find DAST configurations"
          command: "find . -type f \\( -name '*zap*' -o -name '*dast*' -o -name '*nikto*' \\) 2>/dev/null"
        - purpose: "Check CI/CD for DAST"
          command: "grep -r 'zap\\|dast\\|dynamic.*scan\\|nikto\\|nuclei' .github/workflows/ 2>/dev/null | head -20"
      expected_findings:
        - "DAST configuration files"
        - "CI/CD DAST stages"

    - id: "2"
      name: "Review scan configuration"
      description: |
        Examine DAST configurations for appropriate scope, authentication,
        and coverage.
      duration_estimate: "40 min"
      commands:
        - purpose: "Check ZAP configuration"
          command: "find . -name '*zap*' -type f -exec cat {} \\; 2>/dev/null | head -50"
        - purpose: "Check for authentication config"
          command: "grep -r 'auth\\|login\\|session\\|credential' --include='*zap*' --include='*dast*' 2>/dev/null"
      expected_findings:
        - "Scan scope configuration"
        - "Authentication setup"

    - id: "3"
      name: "Verify scan coverage"
      description: |
        Confirm DAST covers critical application endpoints and
        authenticated areas.
      duration_estimate: "30 min"
      commands:
        - purpose: "Check for target URL configuration"
          command: "grep -r 'target\\|url\\|endpoint\\|spider' --include='*.yaml' --include='*.yml' 2>/dev/null | head -20"
      expected_findings:
        - "Target URLs configured"
        - "Endpoint coverage"

    - id: "4"
      name: "Review finding management"
      description: |
        Verify that DAST findings are properly triaged and tracked
        for remediation.
      duration_estimate: "25 min"
      commands:
        - purpose: "Check for report generation"
          command: "grep -r 'report\\|output\\|sarif\\|json' --include='*zap*' --include='*dast*' 2>/dev/null"
      expected_findings:
        - "Report configuration"
        - "Finding export format"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "DAST Coverage Analysis"
        - "Authentication Scan Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "DAST configuration verified, authenticated scanning confirmed, coverage validated"
    medium: "Configuration reviewed but execution not observed"
    low: "Limited visibility into DAST practices"

offline:
  capability: "partial"
  cache_manifest:
    knowledge:
      - source_id: "owasp-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires running application and detailed analysis"
    full:
      included: true
      priority: 2
    security:
      included: true
      priority: 1

closeout_checklist:
  - id: "dynamic-security-001"
    item: "DAST tools configured"
    level: "CRITICAL"
    verification: "find . -type f \\( -name '*zap*' -o -name '*dast*' \\) 2>/dev/null | head -1 | grep -q . && echo PASS || echo FAIL"
    expected: "PASS"

  - id: "dynamic-security-002"
    item: "DAST integrated into CI/CD"
    level: "BLOCKING"
    verification: "grep -r 'zap\\|dast\\|dynamic.*scan' .github/workflows/ 2>/dev/null | grep -q . && echo PASS || echo FAIL"
    expected: "PASS"

  - id: "dynamic-security-003"
    item: "Authenticated scanning configured"
    level: "WARNING"
    verification: "grep -r 'auth\\|login\\|session' --include='*zap*' --include='*dast*' 2>/dev/null | grep -q . && echo PASS || echo FAIL"
    expected: "PASS"

governance:
  applicable_to:
    archetypes: ["web-application", "api-service"]

  compliance_frameworks:
    - framework: "PCI-DSS"
      controls: ["6.5", "11.3"]
    - framework: "SOC2"
      controls: ["CC6.1"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.security-testing.static-security-analysis"
    - "testing-quality-assurance.security-testing.penetration-testing"
    - "testing-quality-assurance.test-automation.ci-integration"
