audit:
  id: infrastructure-as-code.security-compliance.policy-as-code
  name: IaC Policy as Code
  version: 1.0.0
  last_updated: '2026-01-19'
  status: active
  category: infrastructure-as-code
  category_number: 13
  subcategory: security-compliance
  tier: phd
  estimated_duration: 2 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: security
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates the implementation of Policy as Code for
    Infrastructure as Code enforcement. It examines policy frameworks,
    rule coverage, enforcement mechanisms, and integration with
    development workflows.

    Key areas examined:
    - Policy framework selection and configuration (Sentinel, OPA, Checkov)
    - Policy rule coverage and completeness
    - Enforcement points and mechanisms
    - Custom policy development
    - Policy testing and validation
    - Exception handling and bypass controls
  why_it_matters: |
    Policy as Code provides:
    - Preventive controls: Stop violations before deployment
    - Consistency: Same policies apply across all infrastructure
    - Auditability: Policy decisions are logged and traceable
    - Scalability: Automated enforcement without manual review
    - Compliance: Demonstrate adherence to requirements

    Without Policy as Code, organizations rely on manual review which
    is inconsistent, slow, and doesn't scale with infrastructure growth.
  when_to_run:
  - When establishing IaC security controls
  - During compliance framework implementation
  - Before adding new infrastructure types
  - During security architecture reviews
prerequisites:
  required_artifacts:
  - type: iac_repository
    description: Access to infrastructure code and policies
  - type: ci_cd_config
    description: Access to CI/CD pipeline configurations
  - type: policy_library
    description: Access to policy definitions
  access_requirements:
  - Read access to IaC repositories
  - Access to policy configurations
  - CI/CD pipeline access
discovery:
  code_patterns:
  - pattern: sentinel\s*\{
    type: regex
    scope: config
    purpose: Find Sentinel policy configuration
  - pattern: package\s+[a-z]+
    type: regex
    scope: config
    purpose: Find OPA/Rego policies
  - pattern: checkov
    type: keyword
    scope: config
    purpose: Find Checkov references
  - pattern: tfsec
    type: keyword
    scope: config
    purpose: Find tfsec references
  file_patterns:
  - glob: '**/*.sentinel'
    purpose: Sentinel policy files
  - glob: '**/*.rego'
    purpose: OPA/Rego policy files
  - glob: '**/.checkov.yaml'
    purpose: Checkov configuration
  - glob: '**/.tfsec/**'
    purpose: tfsec configuration
  - glob: '**/policies/**'
    purpose: Policy directories
knowledge_sources:
  guides:
  - id: terraform-sentinel
    name: HashiCorp Sentinel
    url: https://developer.hashicorp.com/terraform/cloud-docs/policy-enforcement
    offline_cache: true
  - id: opa-terraform
    name: Open Policy Agent with Terraform
    url: https://www.openpolicyagent.org/docs/latest/terraform/
    offline_cache: true
  - id: checkov-policies
    name: Checkov Custom Policies
    url: https://www.checkov.io/3.Custom%20Policies/Custom%20Policies%20Overview.html
    offline_cache: true
  - id: tfsec-custom
    name: tfsec Custom Checks
    url: https://aquasecurity.github.io/tfsec/latest/guides/configuration/custom-checks/
    offline_cache: true
tooling:
  static_analysis:
  - tool: sentinel
    purpose: HashiCorp policy framework
    offline_capable: true
  - tool: conftest
    purpose: OPA/Rego policy testing
    offline_capable: true
  - tool: checkov
    purpose: Multi-framework IaC scanning
    offline_capable: true
  - tool: tfsec
    purpose: Terraform security scanning
    offline_capable: true
  - tool: terrascan
    purpose: IaC compliance scanning
    offline_capable: true
  infrastructure_tools:
  - tool: checkov
    purpose: Run policy checks
    command: checkov -d . --framework terraform
  - tool: conftest
    purpose: Test policies against Terraform plans
    command: conftest test terraform.tfplan.json
signals:
  critical:
  - id: IAC-PAC-CRIT-001
    signal: No Policy as Code framework implemented
    evidence_indicators:
    - No Sentinel, OPA, or Checkov configuration
    - No policy enforcement in CI/CD
    explanation: |
      Without Policy as Code, there's no automated enforcement of
      security and compliance requirements, relying entirely on
      manual review which doesn't scale.
    remediation: Implement Checkov, Sentinel, or OPA for policy enforcement
  - id: IAC-PAC-CRIT-002
    signal: Policy enforcement can be bypassed without approval
    evidence_indicators:
    - Skip flags available to all developers
    - No approval required for policy exceptions
    explanation: |
      Easily bypassed policies provide no real protection as
      developers can simply skip checks when convenient.
    remediation: Require approval for policy exceptions; audit bypass usage
  high:
  - id: IAC-PAC-HIGH-001
    signal: Critical security policies not enforced
    evidence_indicators:
    - No policies for public access prevention
    - No encryption enforcement
    - No IAM permission policies
    explanation: |
      Security-critical policies must be enforced to prevent common
      vulnerabilities like public S3 buckets or overly permissive IAM.
    remediation: Implement policies for CIS Benchmarks critical controls
  - id: IAC-PAC-HIGH-002
    signal: Policy checks not blocking in CI/CD
    evidence_indicators:
    - Policy failures don't fail pipeline
    - Advisory-only mode for all policies
    explanation: |
      Non-blocking policy checks are essentially suggestions that
      can be ignored, providing no actual enforcement.
    remediation: Configure critical policies to block deployment
  - id: IAC-PAC-HIGH-003
    signal: Policies not covering all resources
    evidence_indicators:
    - Policies for AWS but not Azure
    - Missing coverage for new resource types
    explanation: |
      Incomplete coverage allows violations in unmonitored areas.
    remediation: Extend policy coverage to all cloud providers and resource types
  medium:
  - id: IAC-PAC-MED-001
    signal: Policies not tested
    evidence_indicators:
    - No policy unit tests
    - No test cases for policies
    remediation: Implement policy testing with positive and negative cases
  - id: IAC-PAC-MED-002
    signal: No policy versioning or change control
    evidence_indicators:
    - Policies modified without review
    - No version history for policies
    remediation: Version policies in git with PR review requirements
  - id: IAC-PAC-MED-003
    signal: Policy exceptions not documented
    evidence_indicators:
    - No record of policy bypasses
    - Unknown reasons for skip annotations
    remediation: Require documentation for all policy exceptions
  low:
  - id: IAC-PAC-LOW-001
    signal: Policy error messages not actionable
    evidence_indicators:
    - Generic error messages
    - No remediation guidance in failures
    remediation: Add remediation guidance to policy failure messages
  positive:
  - id: IAC-PAC-POS-001
    signal: Comprehensive Policy as Code implementation
    evidence_indicators:
    - Multiple policy frameworks in use
    - Critical policies blocking deployment
    - Regular policy updates
  - id: IAC-PAC-POS-002
    signal: Policy testing and documentation
    evidence_indicators:
    - Policy unit tests present
    - Clear documentation for policies
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Policy Framework Inventory
    description: |
      Identify what Policy as Code frameworks are in use
      and their configurations.
    duration_estimate: 20 min
    commands:
    - purpose: Find Sentinel policies
      command: find . -name '*.sentinel' | head -20
    - purpose: Find Rego policies
      command: find . -name '*.rego' | head -20
    - purpose: Find Checkov configuration
      command: find . -name '.checkov*' -o -name 'checkov*'
    - purpose: Search for policy enforcement in CI/CD
      command: grep -rn 'checkov\|sentinel\|conftest\|tfsec\|terrascan' --include='*.yml' --include='*.yaml'
    expected_findings:
    - Policy frameworks in use
    - Policy file locations
    - CI/CD integration
  - id: '2'
    name: Policy Coverage Analysis
    description: |
      Assess what security and compliance areas are covered
      by existing policies.
    duration_estimate: 30 min
    commands:
    - purpose: Count policy rules
      command: find . -name '*.rego' -exec grep -c 'deny\|violation\|warn' {} \; 2>/dev/null | awk '{s+=$1}
        END {print s}'
    - purpose: Find security-related policies
      command: grep -rln 'encrypt\|public\|iam\|security' --include='*.rego' --include='*.sentinel'
    - purpose: Check Checkov coverage
      command: checkov -l 2>/dev/null | head -100 || echo 'checkov not available'
    expected_findings:
    - Policy count and distribution
    - Security coverage areas
    - Compliance framework alignment
  - id: '3'
    name: Enforcement Configuration Review
    description: |
      Evaluate how policies are enforced in the deployment
      pipeline.
    duration_estimate: 25 min
    commands:
    - purpose: Check for blocking configuration
      command: grep -rn 'fail\|block\|hard-mandatory\|exit' --include='*.yml' --include='*.yaml' | grep
        -i policy
    - purpose: Find skip/bypass configurations
      command: grep -rn 'skip\|exclude\|ignore' --include='*.yml' --include='*.yaml' | grep -iE 'checkov|tfsec|sentinel'
    - purpose: Check enforcement levels
      command: grep -rn 'enforcement_level\|severity' --include='*.sentinel' --include='*.rego' --include='*.yaml'
    expected_findings:
    - Blocking vs advisory policies
    - Bypass mechanisms
    - Enforcement levels
  - id: '4'
    name: Policy Testing Assessment
    description: |
      Review whether policies have associated tests and
      validation.
    duration_estimate: 20 min
    commands:
    - purpose: Find policy tests
      command: find . -name '*_test.rego' -o -name '*_test.sentinel'
    - purpose: Check for test fixtures
      command: find . -path '*/testdata/*' -o -path '*/test-fixtures/*'
    - purpose: Look for conftest test commands
      command: grep -rn 'conftest test\|sentinel test' --include='*.yml' --include='*.yaml'
    expected_findings:
    - Policy test coverage
    - Test fixture presence
    - Testing in CI/CD
  - id: '5'
    name: Exception Management Review
    description: |
      Assess how policy exceptions are handled and
      documented.
    duration_estimate: 15 min
    commands:
    - purpose: Find skip annotations
      command: grep -rn '#checkov:skip\|#tfsec:ignore\|#trivy:ignore' --include='*.tf'
    - purpose: Check for exception documentation
      command: grep -rn 'exception\|skip.*reason\|ignore.*because' --include='*.tf' --include='*.md'
    expected_findings:
    - Exception patterns
    - Documentation of bypasses
    - Approval requirements
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Policy Framework Assessment
    - Coverage Analysis
    - Enforcement Evaluation
    - Recommendations
  confidence_guidance:
    high: Direct policy configuration analysis
    medium: Inferred from CI/CD and naming patterns
    low: Based on documentation or assumptions
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: opa-terraform
      priority: required
    - source_id: checkov-policies
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Policy assessment requires thorough review
    full:
      included: true
      priority: 2
    security:
      included: true
      priority: 1
closeout_checklist:
- id: pac-001
  item: Policy as Code framework implemented
  level: CRITICAL
  verification: test $(find . -name '*.rego' -o -name '*.sentinel' -o -name '.checkov*' | wc -l) -gt 0
    || grep -rq 'checkov\|tfsec\|conftest' --include='*.yml' && echo PASS || echo FAIL
  expected: PASS
- id: pac-002
  item: Critical policies block deployment
  level: BLOCKING
  verification: manual
  verification_notes: Verify critical security policies fail CI/CD pipeline
  expected: Confirmed by reviewer
- id: pac-003
  item: Policy exceptions require documentation
  level: BLOCKING
  verification: manual
  verification_notes: Verify skip annotations include justification
  expected: Confirmed by reviewer
- id: pac-004
  item: Policies cover encryption and access controls
  level: WARNING
  verification: grep -rln 'encrypt\|public.*access\|iam' --include='*.rego' --include='*.sentinel' | wc
    -l | xargs -I{} test {} -gt 0 && echo PASS || echo FAIL
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC6.1
    - CC6.6
  - framework: CIS Controls
    controls:
    - Control 4
    - Control 5
  - framework: NIST CSF
    controls:
    - PR.IP-1
relationships:
  commonly_combined:
  - infrastructure-as-code.security-compliance.compliance-rule-coverage
  - infrastructure-as-code.security-compliance.security-scanning-integration
