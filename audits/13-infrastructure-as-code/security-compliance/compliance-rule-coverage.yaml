audit:
  id: infrastructure-as-code.security-compliance.compliance-rule-coverage
  name: IaC Compliance Rule Coverage
  version: 1.0.0
  last_updated: '2026-01-19'
  status: active
  category: infrastructure-as-code
  category_number: 13
  subcategory: security-compliance
  tier: phd
  estimated_duration: 2.5 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: security
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates the coverage of compliance framework requirements
    in Infrastructure as Code policies and configurations. It maps IaC
    controls to compliance requirements and identifies gaps.

    Key areas examined:
    - CIS Benchmark coverage for cloud providers
    - SOC 2 control implementation
    - PCI-DSS requirement mapping
    - HIPAA safeguard implementation
    - Custom compliance framework coverage
    - Gap analysis and prioritization
  why_it_matters: |
    Compliance rule coverage ensures:
    - Audit readiness: Evidence of control implementation
    - Risk reduction: Known compliance frameworks address key risks
    - Consistency: Same controls across all infrastructure
    - Efficiency: Automated compliance checking reduces manual effort

    Gaps in compliance coverage can lead to:
    - Audit failures and findings
    - Security vulnerabilities from missing controls
    - Regulatory penalties
    - Customer trust issues
  when_to_run:
  - During compliance audit preparation
  - When adopting new compliance frameworks
  - After major infrastructure changes
  - Quarterly compliance assessments
prerequisites:
  required_artifacts:
  - type: iac_repository
    description: Access to infrastructure code and policies
  - type: compliance_requirements
    description: List of applicable compliance requirements
  - type: policy_library
    description: Current policy definitions
  access_requirements:
  - Read access to IaC repositories
  - Access to compliance requirement documents
  - Policy configuration access
discovery:
  code_patterns:
  - pattern: CIS|SOC|PCI|HIPAA|GDPR|NIST
    type: regex
    scope: config
    purpose: Find compliance framework references
  - pattern: compliance|benchmark|control
    type: keyword
    scope: config
    purpose: Find compliance-related configurations
  file_patterns:
  - glob: '**/.checkov.yaml'
    purpose: Checkov compliance configuration
  - glob: '**/policies/**'
    purpose: Policy directories
  - glob: '**/*.rego'
    purpose: OPA policies with compliance rules
  - glob: '**/compliance/**'
    purpose: Compliance-specific configurations
  documents_to_review:
  - type: Compliance matrix
    purpose: Understand required controls
  - type: Risk assessment
    purpose: Identify priority areas
knowledge_sources:
  specifications:
  - id: cis-aws
    name: CIS AWS Foundations Benchmark
    url: https://www.cisecurity.org/benchmark/amazon_web_services
    offline_cache: true
    priority: required
  - id: cis-azure
    name: CIS Azure Foundations Benchmark
    url: https://www.cisecurity.org/benchmark/azure
    offline_cache: true
    priority: required
  - id: cis-gcp
    name: CIS GCP Foundations Benchmark
    url: https://www.cisecurity.org/benchmark/google_cloud_computing_platform
    offline_cache: true
    priority: required
  guides:
  - id: checkov-compliance
    name: Checkov Compliance Frameworks
    url: https://www.checkov.io/5.Policy%20Index/all.html
    offline_cache: true
  - id: aws-well-architected
    name: AWS Well-Architected Framework
    url: https://docs.aws.amazon.com/wellarchitected/latest/framework/welcome.html
    offline_cache: true
tooling:
  static_analysis:
  - tool: checkov
    purpose: Scan with compliance framework filters
    offline_capable: true
  - tool: prowler
    purpose: AWS security assessment against CIS
    offline_capable: false
  - tool: ScoutSuite
    purpose: Multi-cloud security auditing
    offline_capable: false
  infrastructure_tools:
  - tool: checkov
    purpose: Run compliance-specific checks
    command: checkov -d . --framework terraform --check CIS*
  - tool: checkov
    purpose: List available compliance checks
    command: checkov -l --framework terraform | grep -i 'CIS\|SOC\|PCI'
signals:
  critical:
  - id: IAC-CRC-CRIT-001
    signal: No compliance framework mapped to IaC policies
    evidence_indicators:
    - No CIS, SOC 2, or PCI checks configured
    - No compliance references in policies
    explanation: |
      Without compliance mapping, there's no systematic assurance that
      regulatory requirements are being met through IaC.
    remediation: Map applicable compliance requirements to IaC policies
  - id: IAC-CRC-CRIT-002
    signal: Critical CIS Benchmark controls not enforced
    evidence_indicators:
    - CIS Level 1 controls missing
    - Encryption controls not enforced
    - Access control policies absent
    explanation: |
      CIS Level 1 controls represent minimum security hygiene. Missing
      these indicates fundamental security gaps.
    remediation: Implement CIS Level 1 policies as baseline
  high:
  - id: IAC-CRC-HIGH-001
    signal: Compliance checks failing without remediation
    evidence_indicators:
    - Known failing compliance checks
    - No remediation plan for failures
    explanation: |
      Failing compliance checks indicate active non-compliance that
      could be cited in audits.
    remediation: Remediate failing checks or document compensating controls
  - id: IAC-CRC-HIGH-002
    signal: Significant coverage gaps in compliance frameworks
    evidence_indicators:
    - Less than 70% of applicable controls covered
    - Major control categories missing
    explanation: |
      Low coverage means many compliance requirements are not being
      automatically enforced.
    remediation: Develop policies for uncovered control categories
  - id: IAC-CRC-HIGH-003
    signal: Compliance evidence not generated
    evidence_indicators:
    - No compliance scan reports
    - No audit trail for compliance checks
    explanation: |
      Auditors require evidence of compliance checks. Missing evidence
      complicates audit processes.
    remediation: Generate and store compliance scan reports
  medium:
  - id: IAC-CRC-MED-001
    signal: CIS Level 2 controls not implemented
    evidence_indicators:
    - Only Level 1 controls enforced
    - Advanced controls not covered
    remediation: Implement CIS Level 2 for defense in depth
  - id: IAC-CRC-MED-002
    signal: Compliance coverage varies by cloud provider
    evidence_indicators:
    - Strong AWS coverage, weak Azure coverage
    - Inconsistent multi-cloud compliance
    remediation: Achieve consistent compliance coverage across providers
  - id: IAC-CRC-MED-003
    signal: No regular compliance trend reporting
    evidence_indicators:
    - No compliance dashboards
    - No trend analysis over time
    remediation: Implement compliance trending and reporting
  low:
  - id: IAC-CRC-LOW-001
    signal: Compliance documentation outdated
    evidence_indicators:
    - Compliance mapping documents stale
    - New controls not documented
    remediation: Update compliance documentation regularly
  positive:
  - id: IAC-CRC-POS-001
    signal: Comprehensive compliance coverage
    evidence_indicators:
    - '>90% of applicable controls covered'
    - Multiple frameworks enforced
  - id: IAC-CRC-POS-002
    signal: Compliance reporting automated
    evidence_indicators:
    - Regular compliance scan reports
    - Trend dashboards available
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Compliance Requirements Inventory
    description: |
      Identify applicable compliance frameworks and their
      specific requirements.
    duration_estimate: 30 min
    questions:
    - What compliance frameworks apply (SOC 2, PCI-DSS, HIPAA, etc.)?
    - What cloud providers are in use?
    - Are there industry-specific requirements?
    commands:
    - purpose: Search for compliance references
      command: grep -rni 'CIS\|SOC\|PCI\|HIPAA\|GDPR\|NIST\|compliance\|benchmark' --include='*.md' --include='*.yaml'
        --include='*.yml' | head -50
    expected_findings:
    - Applicable frameworks
    - Documented requirements
    - Scope of compliance
  - id: '2'
    name: Policy Coverage Assessment
    description: |
      Evaluate current policy coverage against compliance
      requirements.
    duration_estimate: 40 min
    commands:
    - purpose: List Checkov compliance checks
      command: checkov -l --framework terraform 2>/dev/null | grep -E 'CIS|SOC|PCI|HIPAA' | wc -l || echo
        'checkov not available'
    - purpose: Count policies by framework
      command: grep -rh 'CIS\|SOC\|PCI\|HIPAA' --include='*.rego' --include='*.sentinel' --include='*.yaml'
        | sort | uniq -c | sort -rn | head -20
    - purpose: Find custom compliance policies
      command: find . -path '*/policies/*' -name '*.rego' -o -path '*/policies/*' -name '*.sentinel' |
        head -30
    expected_findings:
    - Built-in compliance checks available
    - Custom policy coverage
    - Framework distribution
  - id: '3'
    name: Gap Analysis
    description: |
      Identify gaps between compliance requirements and
      current policy coverage.
    duration_estimate: 40 min
    commands:
    - purpose: Run Checkov with CIS framework
      command: checkov -d . --framework terraform --compact --check CIS* 2>/dev/null | head -100 || echo
        'checkov not available'
    - purpose: Identify failed checks
      command: checkov -d . --framework terraform --compact 2>/dev/null | grep -E 'FAILED|PASSED' | head
        -50
    expected_findings:
    - Passing vs failing checks
    - Coverage gaps
    - Priority areas
  - id: '4'
    name: Evidence and Reporting Review
    description: |
      Assess compliance evidence generation and reporting
      capabilities.
    duration_estimate: 20 min
    commands:
    - purpose: Find compliance reports
      command: find . -name '*compliance*' -o -name '*audit*' -o -name '*cis*' | grep -E '\.(json|xml|html|pdf)$'
        | head -20
    - purpose: Check for report generation in CI
      command: grep -rn 'report\|output.*json\|output.*sarif' --include='*.yml' --include='*.yaml' | grep
        -iE 'checkov|tfsec|trivy'
    expected_findings:
    - Report generation
    - Evidence storage
    - Audit trail
  - id: '5'
    name: Coverage Metrics Calculation
    description: |
      Calculate compliance coverage metrics for reporting.
    duration_estimate: 20 min
    commands:
    - purpose: Get compliance check summary
      command: checkov -d . --framework terraform --compact 2>/dev/null | tail -20 || echo 'checkov not
        available'
    - purpose: Calculate pass rate
      command: 'checkov -d . --framework terraform --output json 2>/dev/null | jq ''.summary | "Passed:
        \(.passed), Failed: \(.failed), Skipped: \(.skipped)"'' 2>/dev/null || echo ''Unable to calculate'''
    expected_findings:
    - Pass/fail metrics
    - Coverage percentage
    - Trend data
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Compliance Framework Mapping
    - Coverage Analysis
    - Gap Identification
    - Remediation Roadmap
  confidence_guidance:
    high: Direct policy and scan analysis
    medium: Inferred from partial evidence
    low: Based on documentation review
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: cis-aws
      priority: required
    - source_id: checkov-compliance
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Compliance analysis requires thorough review
    full:
      included: true
      priority: 2
    security:
      included: true
      priority: 1
closeout_checklist:
- id: crc-001
  item: Compliance frameworks identified and mapped
  level: CRITICAL
  verification: manual
  verification_notes: Verify documented mapping of applicable compliance requirements
  expected: Confirmed by reviewer
- id: crc-002
  item: CIS Level 1 controls enforced
  level: CRITICAL
  verification: checkov -d . --framework terraform --check CIS* --compact 2>/dev/null | grep -c PASSED
    | xargs -I{} test {} -gt 0 && echo PASS || echo FAIL
  expected: PASS
- id: crc-003
  item: Compliance coverage exceeds 70%
  level: BLOCKING
  verification: manual
  verification_notes: Calculate compliance check pass rate from scan results
  expected: Confirmed by reviewer
- id: crc-004
  item: Compliance reports generated and stored
  level: WARNING
  verification: manual
  verification_notes: Verify compliance scan reports exist and are archived
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC2.1
    - CC6.1
  - framework: PCI-DSS
    controls:
    - '1.1'
    - '2.2'
    - '6.1'
  - framework: HIPAA
    controls:
    - 164.308(a)(1)
relationships:
  commonly_combined:
  - infrastructure-as-code.security-compliance.policy-as-code
  - infrastructure-as-code.security-compliance.security-scanning-integration
