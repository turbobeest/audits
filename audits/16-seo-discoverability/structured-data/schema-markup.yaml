# ============================================================
# AUDIT: Schema Markup Implementation
# ============================================================
# Evaluates Schema.org structured data implementation for
# search engine understanding and rich result eligibility.
# ============================================================

audit:
  id: "seo-discoverability.structured-data.schema-markup"

  name: "Schema Markup Implementation Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "structured-data"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit examines Schema.org structured data markup implementation
    across the website. It evaluates schema type selection, property
    completeness, nesting accuracy, format consistency (JSON-LD vs
    Microdata), validation errors, and alignment with Google's structured
    data guidelines for rich result eligibility.

  why_it_matters: |
    Structured data helps search engines understand page content and
    can enable rich results (star ratings, FAQs, breadcrumbs, products)
    in search results. Proper implementation increases click-through
    rates by 20-30% through enhanced search listings. Invalid or
    incomplete markup is ignored, wasting implementation effort.

  when_to_run:
    - "After implementing new schema types"
    - "When adding new page templates"
    - "During technical SEO audits"
    - "When rich results aren't appearing"
    - "After CMS or theme updates"

prerequisites:
  required_artifacts:
    - type: "website"
      description: "Live website with structured data"
    - type: "source_code"
      description: "Access to page templates for schema implementation"

  access_requirements:
    - "Ability to crawl the website"
    - "Google Search Console for rich result status"
    - "Schema Markup Validator access"

discovery:
  code_patterns:
    - pattern: "application/ld\\+json"
      type: "keyword"
      scope: "source"
      purpose: "Find JSON-LD structured data"
    - pattern: "itemtype=.*schema\\.org"
      type: "regex"
      scope: "source"
      purpose: "Find Microdata structured data"
    - pattern: "vocab=.*schema\\.org"
      type: "regex"
      scope: "source"
      purpose: "Find RDFa structured data"
    - pattern: "@type"
      type: "keyword"
      scope: "source"
      purpose: "Find JSON-LD type declarations"

  file_patterns:
    - glob: "**/*.html"
      purpose: "Check HTML pages for schema"
    - glob: "**/schema.{json,js,ts}"
      purpose: "Find schema definition files"
    - glob: "**/structured-data*.{js,ts}"
      purpose: "Find schema generation code"

knowledge_sources:
  specifications:
    - id: "schema-org"
      name: "Schema.org Full Hierarchy"
      url: "https://schema.org/docs/full.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "google-structured-data"
      name: "Google: Understand How Structured Data Works"
      url: "https://developers.google.com/search/docs/appearance/structured-data/intro-structured-data"
      offline_cache: true
    - id: "google-structured-data-guidelines"
      name: "Google: Structured Data General Guidelines"
      url: "https://developers.google.com/search/docs/appearance/structured-data/sd-policies"
      offline_cache: true
    - id: "google-rich-results-types"
      name: "Google: Search Gallery - Structured Data Types"
      url: "https://developers.google.com/search/docs/appearance/structured-data/search-gallery"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Google Rich Results Test"
      purpose: "Validate schema and preview rich results"
      offline_capable: false
    - tool: "Schema Markup Validator"
      purpose: "Comprehensive schema validation"
      offline_capable: false
    - tool: "Screaming Frog SEO Spider"
      purpose: "Extract and analyze structured data at scale"
      offline_capable: true

  infrastructure_tools:
    - tool: "Google Search Console"
      purpose: "Monitor structured data errors and enhancements"
      command: "Enhancements reports"

  scripts:
    - id: "schema-extractor"
      language: "bash"
      purpose: "Extract JSON-LD from a page"
      source: "inline"
      code: |
        #!/bin/bash
        URL=$1
        echo "=== JSON-LD Schema for: $URL ==="

        curl -s "$URL" | \
          grep -oP '(?<=<script type="application/ld\+json">)[\s\S]*?(?=</script>)' | \
          python3 -m json.tool 2>/dev/null || echo "No valid JSON-LD found"

signals:
  critical:
    - id: "SCHEMA-CRIT-001"
      signal: "Schema markup contains critical validation errors"
      evidence_indicators:
        - "JSON-LD syntax errors"
        - "Missing required properties"
        - "Invalid property values"
      explanation: |
        Schema with validation errors is ignored by search engines,
        resulting in no rich result eligibility despite implementation.
      remediation: "Fix validation errors using Google Rich Results Test"

    - id: "SCHEMA-CRIT-002"
      signal: "Schema content doesn't match visible page content"
      evidence_indicators:
        - "Product prices differ from visible prices"
        - "Review data not visible on page"
      explanation: |
        Schema that misrepresents content is a violation of Google's
        guidelines and can result in manual actions or rich result removal.
      remediation: "Ensure schema accurately reflects visible page content"

  high:
    - id: "SCHEMA-HIGH-001"
      signal: "Missing schema on eligible page types"
      explanation: |
        Pages that could benefit from structured data (products, articles,
        FAQs) but lack implementation miss rich result opportunities.
      remediation: "Implement appropriate schema types for content"

    - id: "SCHEMA-HIGH-002"
      signal: "Incomplete required properties for schema type"
      explanation: |
        Missing recommended or required properties reduces rich result
        eligibility and display quality.
      remediation: "Add all required and recommended properties"

    - id: "SCHEMA-HIGH-003"
      signal: "Deprecated schema types or properties used"
      explanation: |
        Using deprecated schema may stop working as search engines
        update their parsers.
      remediation: "Update to current schema specifications"

  medium:
    - id: "SCHEMA-MED-001"
      signal: "Mixed schema formats (JSON-LD and Microdata)"
      remediation: "Standardize on JSON-LD format (Google preferred)"

    - id: "SCHEMA-MED-002"
      signal: "Schema not nested properly"
      remediation: "Nest related schemas correctly (e.g., Product > Offer)"

    - id: "SCHEMA-MED-003"
      signal: "Missing optional properties that enhance rich results"
      remediation: "Add recommended properties for richer displays"

  low:
    - id: "SCHEMA-LOW-001"
      signal: "Schema placed in body instead of head"

    - id: "SCHEMA-LOW-002"
      signal: "Multiple identical schemas on same page"

  positive:
    - id: "SCHEMA-POS-001"
      signal: "Complete, valid schema on all eligible pages"
    - id: "SCHEMA-POS-002"
      signal: "Rich results appearing in Google Search"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Schema Opportunities"
      description: |
        Analyze page types to determine which schema types should
        be implemented based on content.
      duration_estimate: "30 min"
      expected_findings:
        - "Page types eligible for schema"
        - "Recommended schema types"
        - "Implementation priorities"

    - id: "2"
      name: "Extract Current Schema"
      description: |
        Crawl the site and extract all structured data implementations
        to create an inventory.
      duration_estimate: "30 min"
      commands:
        - purpose: "Crawl and extract schema"
          command: "Configure Screaming Frog to extract structured data"
      expected_findings:
        - "Schema inventory by page"
        - "Schema types in use"
        - "Pages without schema"

    - id: "3"
      name: "Validate Schema Syntax"
      description: |
        Test schema implementations for syntax errors and validation
        issues using Google's tools.
      duration_estimate: "30 min"
      commands:
        - purpose: "Validate individual pages"
          command: "Use Google Rich Results Test for key pages"
      expected_findings:
        - "Syntax errors"
        - "Missing required fields"
        - "Validation warnings"

    - id: "4"
      name: "Check Property Completeness"
      description: |
        Verify that all required and recommended properties are
        populated for each schema type.
      duration_estimate: "30 min"
      expected_findings:
        - "Missing required properties"
        - "Missing recommended properties"
        - "Enhancement opportunities"

    - id: "5"
      name: "Review GSC Enhancement Reports"
      description: |
        Check Google Search Console for structured data errors,
        warnings, and valid items count.
      duration_estimate: "20 min"
      expected_findings:
        - "GSC-reported errors"
        - "Valid items count"
        - "Rich result status"

    - id: "6"
      name: "Verify Content Alignment"
      description: |
        Sample check that schema content matches visible page content
        to ensure guideline compliance.
      duration_estimate: "20 min"
      questions:
        - "Do schema values match visible content?"
        - "Are all schema claims verifiable on page?"
      expected_findings:
        - "Content alignment issues"
        - "Guideline compliance status"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Schema Implementation Overview"
        - "Validation Results"
        - "Coverage Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Issues verified via Google Rich Results Test"
    medium: "Issues identified via automated extraction"
    low: "Potential issues based on schema review"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "schema-org"
        priority: "required"
      - source_id: "google-structured-data"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive schema analysis"
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1

closeout_checklist:
  - id: "schema-001"
    item: "All schema passes Google Rich Results Test"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Test sample pages from each template"
    expected: "Confirmed by reviewer"

  - id: "schema-002"
    item: "Schema content matches visible page content"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify content alignment on key pages"
    expected: "Confirmed by reviewer"

  - id: "schema-003"
    item: "All eligible page types have appropriate schema"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Check coverage across page templates"
    expected: "Confirmed by reviewer"

  - id: "schema-004"
    item: "Required properties populated for each type"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Review property completeness"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["web-application", "marketing-site", "ecommerce", "content-site"]

  compliance_frameworks:
    - framework: "SEO Best Practices"
      controls: ["Structured Data", "Rich Results"]
    - framework: "Google Structured Data Guidelines"
      controls: ["Content Policies", "Technical Requirements"]

relationships:
  commonly_combined:
    - "seo-discoverability.structured-data.json-ld-implementation"
    - "seo-discoverability.structured-data.rich-snippet-eligibility"
    - "seo-discoverability.structured-data.breadcrumb-schema"
