# ============================================================
# AUDIT: Rich Snippet Eligibility Assessment
# ============================================================
# Evaluates structured data implementation for eligibility
# to display rich results in Google Search.
# ============================================================

audit:
  id: "seo-discoverability.structured-data.rich-snippet-eligibility"

  name: "Rich Snippet Eligibility Assessment"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "structured-data"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit assesses whether structured data implementation meets
    Google's requirements for rich result display. It evaluates required
    and recommended properties for each schema type, content policy
    compliance, technical requirements, and actual rich result appearance
    in search. Different rich result types have specific requirements.

  why_it_matters: |
    Rich results (star ratings, FAQ dropdowns, recipe cards, product
    details) dramatically increase visibility and click-through rates
    in search results. However, having structured data is not enough -
    it must meet specific requirements for each rich result type.
    Failing eligibility requirements means wasted implementation effort.

  when_to_run:
    - "After implementing structured data"
    - "When rich results aren't appearing despite valid schema"
    - "During conversion rate optimization"
    - "When competitors have rich results and you don't"
    - "After Google rich result requirements updates"

prerequisites:
  required_artifacts:
    - type: "website"
      description: "Live website with structured data"
    - type: "gsc_access"
      description: "Google Search Console access"

  access_requirements:
    - "Google Rich Results Test access"
    - "Google Search Console with enhancement reports"
    - "Ability to perform site: searches"

discovery:
  code_patterns:
    - pattern: "aggregateRating|Review"
      type: "keyword"
      scope: "source"
      purpose: "Find review/rating schema"
    - pattern: "FAQPage|Question"
      type: "keyword"
      scope: "source"
      purpose: "Find FAQ schema"
    - pattern: "Product|Offer"
      type: "keyword"
      scope: "source"
      purpose: "Find product schema"
    - pattern: "Recipe|HowTo"
      type: "keyword"
      scope: "source"
      purpose: "Find instructional content schema"

  file_patterns:
    - glob: "**/*.html"
      purpose: "Check pages for rich result eligible schema"

knowledge_sources:
  guides:
    - id: "google-rich-results"
      name: "Google: Rich Results Types"
      url: "https://developers.google.com/search/docs/appearance/structured-data/search-gallery"
      offline_cache: true
    - id: "google-faq-structured-data"
      name: "Google: FAQ Structured Data"
      url: "https://developers.google.com/search/docs/appearance/structured-data/faqpage"
      offline_cache: true
    - id: "google-product-structured-data"
      name: "Google: Product Structured Data"
      url: "https://developers.google.com/search/docs/appearance/structured-data/product"
      offline_cache: true
    - id: "google-review-snippet"
      name: "Google: Review Snippet"
      url: "https://developers.google.com/search/docs/appearance/structured-data/review-snippet"
      offline_cache: true
    - id: "google-recipe-structured-data"
      name: "Google: Recipe Structured Data"
      url: "https://developers.google.com/search/docs/appearance/structured-data/recipe"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Google Rich Results Test"
      purpose: "Test eligibility and preview rich results"
      offline_capable: false
    - tool: "Screaming Frog SEO Spider"
      purpose: "Extract structured data for analysis"
      offline_capable: true

  infrastructure_tools:
    - tool: "Google Search Console"
      purpose: "Monitor rich result enhancements"
      command: "Enhancements reports"
    - tool: "Google Search"
      purpose: "Verify actual rich result display"
      command: "site:example.com search"

  scripts:
    - id: "rich-result-checker"
      language: "bash"
      purpose: "Quick check for rich result schema types"
      source: "inline"
      code: |
        #!/bin/bash
        URL=$1
        echo "=== Rich Result Schema Check: $URL ==="

        CONTENT=$(curl -s "$URL")

        # Check for common rich result types
        echo "Product schema:" $(echo "$CONTENT" | grep -c '"Product"')
        echo "Review schema:" $(echo "$CONTENT" | grep -c '"Review"')
        echo "FAQ schema:" $(echo "$CONTENT" | grep -c '"FAQPage"')
        echo "Recipe schema:" $(echo "$CONTENT" | grep -c '"Recipe"')
        echo "HowTo schema:" $(echo "$CONTENT" | grep -c '"HowTo"')
        echo "Article schema:" $(echo "$CONTENT" | grep -c '"Article"')
        echo "Event schema:" $(echo "$CONTENT" | grep -c '"Event"')
        echo "LocalBusiness:" $(echo "$CONTENT" | grep -c '"LocalBusiness"')

signals:
  critical:
    - id: "RICH-CRIT-001"
      signal: "Required properties missing for rich result type"
      evidence_indicators:
        - "Google Rich Results Test shows errors"
        - "Required fields not populated"
      explanation: |
        Missing required properties disqualifies pages from rich
        result display entirely, regardless of other implementation.
      remediation: "Add all required properties per Google documentation"

    - id: "RICH-CRIT-002"
      signal: "Content policy violation detected"
      evidence_indicators:
        - "Fake reviews or ratings"
        - "Schema for content not on page"
        - "Manipulative structured data"
      explanation: |
        Policy violations can result in manual actions, rich result
        removal, and potentially broader ranking penalties.
      remediation: "Ensure schema reflects actual, visible content"

  high:
    - id: "RICH-HIGH-001"
      signal: "Recommended properties missing (reduces display quality)"
      explanation: |
        While not required, recommended properties enhance rich result
        display and may affect selection for display.
      remediation: "Add recommended properties to improve appearance"

    - id: "RICH-HIGH-002"
      signal: "Rich results eligible but not appearing in search"
      explanation: |
        Valid structured data doesn't guarantee display. Google selects
        based on query relevance and quality signals.
      remediation: "Improve page quality, authority, and search relevance"

    - id: "RICH-HIGH-003"
      signal: "Self-serving review markup (reviews of own business)"
      explanation: |
        Google may not display review rich results for self-review
        content. Third-party reviews are more valuable.
      remediation: "Use review schema only for verifiable third-party reviews"

  medium:
    - id: "RICH-MED-001"
      signal: "Property values not meeting format requirements"
      remediation: "Format values per schema.org specifications"

    - id: "RICH-MED-002"
      signal: "Aggregate ratings without minimum review count"
      remediation: "Only show aggregate ratings with sufficient reviews"

    - id: "RICH-MED-003"
      signal: "Opportunities for additional rich result types"
      remediation: "Implement additional schema types where applicable"

  low:
    - id: "RICH-LOW-001"
      signal: "Rich result appearance varies by query"

  positive:
    - id: "RICH-POS-001"
      signal: "Rich results appearing for target queries"
    - id: "RICH-POS-002"
      signal: "All eligible pages have complete rich result schema"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Rich Result Opportunities"
      description: |
        Analyze page types to determine which rich result types
        would be applicable and beneficial.
      duration_estimate: "30 min"
      expected_findings:
        - "Eligible page types"
        - "Applicable rich result types"
        - "Implementation priorities"

    - id: "2"
      name: "Test Current Implementations"
      description: |
        Use Google Rich Results Test to validate current structured
        data for rich result eligibility.
      duration_estimate: "30 min"
      commands:
        - purpose: "Test pages for rich results"
          command: "Google Rich Results Test for sample pages"
      expected_findings:
        - "Valid implementations"
        - "Errors and warnings"
        - "Eligible rich result types"

    - id: "3"
      name: "Check Required Properties"
      description: |
        Verify that all required properties for each schema type
        are populated per Google's documentation.
      duration_estimate: "30 min"
      expected_findings:
        - "Missing required properties"
        - "Invalid property values"
        - "Compliance status"

    - id: "4"
      name: "Evaluate Recommended Properties"
      description: |
        Assess which recommended properties are missing that could
        enhance rich result display quality.
      duration_estimate: "20 min"
      expected_findings:
        - "Missing recommended properties"
        - "Enhancement opportunities"
        - "Priority additions"

    - id: "5"
      name: "Review GSC Enhancement Reports"
      description: |
        Check Google Search Console for structured data status,
        errors, and valid items count.
      duration_estimate: "20 min"
      expected_findings:
        - "GSC-reported issues"
        - "Valid items count"
        - "Error trends"

    - id: "6"
      name: "Verify Actual Rich Result Display"
      description: |
        Search for target pages in Google to verify whether
        rich results are actually displaying.
      duration_estimate: "30 min"
      commands:
        - purpose: "Check actual search display"
          command: "site:example.com searches for key pages"
      expected_findings:
        - "Rich result presence"
        - "Display quality"
        - "Competitor comparison"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Rich Result Eligibility Summary"
        - "Implementation Status by Type"
        - "Issues and Errors"
        - "Recommendations"

  confidence_guidance:
    high: "Verified via Rich Results Test and actual search display"
    medium: "Identified via GSC reports"
    low: "Potential issues based on schema analysis"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "google-rich-results"
        priority: "required"
      - source_id: "google-product-structured-data"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive testing"
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1

closeout_checklist:
  - id: "rich-001"
    item: "All required properties present for each schema type"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Test with Google Rich Results Test"
    expected: "Confirmed by reviewer"

  - id: "rich-002"
    item: "No content policy violations"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Schema matches visible page content"
    expected: "Confirmed by reviewer"

  - id: "rich-003"
    item: "Rich results appearing in Google Search"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify via site: searches"
    expected: "Confirmed by reviewer"

  - id: "rich-004"
    item: "Recommended properties implemented"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Check for optional property additions"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["marketing-site", "ecommerce", "content-site"]

  compliance_frameworks:
    - framework: "Google Structured Data Policies"
      controls: ["Content Policies", "Technical Requirements"]

relationships:
  commonly_combined:
    - "seo-discoverability.structured-data.schema-markup"
    - "seo-discoverability.structured-data.json-ld-implementation"
    - "seo-discoverability.on-page-seo.content-quality"
