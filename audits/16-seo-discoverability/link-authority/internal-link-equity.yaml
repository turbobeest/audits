# ============================================================
# AUDIT: Internal Link Equity
# ============================================================
# Evaluates internal linking structure and PageRank flow
# for SEO optimization.

audit:
  id: "seo-discoverability.link-authority.internal-link-equity"

  name: "Internal Link Equity Distribution Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "link-authority"

  tier: "expert"
  estimated_duration: "2.5 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates internal linking structure to understand how
    link equity (PageRank) flows through the site. It examines link depth,
    internal link distribution, pillar-cluster strategies, navigation
    structure, and identifies pages receiving insufficient or excessive
    internal link equity relative to their importance.

  why_it_matters: |
    Internal links distribute ranking power throughout the site and help
    search engines understand page relationships and importance hierarchy.
    Poor internal linking wastes authority on unimportant pages while
    starving critical pages of link equity. Strategic internal linking
    can significantly boost rankings for target pages without requiring
    additional external backlinks.

  when_to_run:
    - "During site architecture planning"
    - "When important pages underperform in rankings"
    - "After adding significant new content"
    - "During technical SEO audits"

prerequisites:
  required_artifacts:
    - type: "deployed_website"
      description: "Live site for crawl and link analysis"
    - type: "sitemap"
      description: "URL inventory"

  access_requirements:
    - "Full site crawl access"
    - "SEO crawler tool (Screaming Frog, Sitebulb)"
    - "Analytics for page importance assessment"

discovery:
  code_patterns:
    - pattern: "<a[^>]*href=[\"'][^\"']+[\"'][^>]*>"
      type: "regex"
      scope: "source"
      purpose: "Identify internal links"
    - pattern: "rel=[\"']nofollow[\"']"
      type: "keyword"
      scope: "source"
      purpose: "Detect nofollowed internal links"

  file_patterns:
    - glob: "**/*.html"
      purpose: "HTML files for link analysis"
    - glob: "**/nav*"
      purpose: "Navigation templates"
    - glob: "**/footer*"
      purpose: "Footer templates"

knowledge_sources:
  specifications:
    - id: "pagerank-patent"
      name: "PageRank Algorithm"
      url: "https://en.wikipedia.org/wiki/PageRank"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "internal-linking"
      name: "Internal Linking Strategy Guide"
      url: "https://ahrefs.com/blog/internal-links-for-seo/"
      offline_cache: true
    - id: "pillar-cluster"
      name: "Topic Cluster Model"
      url: "https://blog.hubspot.com/marketing/topic-clusters-seo"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Screaming Frog"
      purpose: "Crawl for internal link analysis"
      offline_capable: false
    - tool: "Sitebulb"
      purpose: "Link equity flow visualization"
      offline_capable: false

  scripts:
    - id: "link-count"
      language: "bash"
      purpose: "Count internal links on a page"
      source: "inline"
      code: |
        #!/bin/bash
        # Count internal links on page
        DOMAIN=$(echo $URL | grep -oE 'https?://[^/]+')
        curl -s $URL | \
        grep -oE "href=\"$DOMAIN[^\"]*\"" | \
        wc -l

signals:
  critical:
    - id: "SEO-ILINK-CRIT-001"
      signal: "High-priority pages more than 4 clicks from homepage"
      evidence_pattern: "Important pages at depth > 4 in site architecture"
      explanation: |
        Pages buried deep in site hierarchy receive less link equity and
        are crawled less frequently. High-priority pages should be within
        3 clicks of the homepage.
      remediation: "Restructure navigation and add links to reduce click depth"
    - id: "SEO-ILINK-CRIT-002"
      signal: "Nofollow used on internal links"
      evidence_pattern: "rel=\"nofollow\" on internal links"
      explanation: |
        Using nofollow on internal links wastes PageRank that could flow
        to other pages. This is almost never appropriate for internal links.
      remediation: "Remove nofollow from internal links"

  high:
    - id: "SEO-ILINK-HIGH-001"
      signal: "Important pages with fewer than 5 internal links"
      explanation: |
        Pages targeting competitive keywords need significant internal
        link support. Fewer than 5 internal links suggests insufficient
        internal equity distribution.
      remediation: "Add contextual internal links from relevant pages"
    - id: "SEO-ILINK-HIGH-002"
      signal: "Low-value pages receiving disproportionate internal links"
      explanation: |
        Navigation links to low-priority pages (terms, privacy, etc.)
        from every page waste link equity that could boost important pages.
      remediation: "Move low-value links to footer, reduce prominence"

  medium:
    - id: "SEO-ILINK-MED-001"
      signal: "No pillar-cluster internal linking strategy"
      remediation: "Implement topic clusters with supporting content linking to pillar pages"
    - id: "SEO-ILINK-MED-002"
      signal: "Contextual internal links missing from content"
      remediation: "Add natural contextual links within content body"

  low:
    - id: "SEO-ILINK-LOW-001"
      signal: "Internal link anchor text not descriptive"

  positive:
    - id: "SEO-ILINK-POS-001"
      signal: "Strategic internal linking to priority pages"
    - id: "SEO-ILINK-POS-002"
      signal: "Well-implemented pillar-cluster architecture"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Site Crawl and Link Mapping"
      description: |
        Crawl the site to map all internal links and
        calculate inlink counts per page.
      duration_estimate: "35 min"

      commands:
        - purpose: "Sample page internal link count"
          command: "curl -s $URL | grep -oE 'href=\"/[^\"]*\"' | wc -l"

      expected_findings:
        - "Internal link inventory"
        - "Inlink count distribution"

    - id: "2"
      name: "Click Depth Analysis"
      description: |
        Analyze click depth from homepage to identify
        pages buried too deep in hierarchy.
      duration_estimate: "25 min"

      questions:
        - "What is the average click depth?"
        - "Which important pages are more than 3 clicks deep?"
        - "Are there pages at depth 5 or beyond?"

      expected_findings:
        - "Click depth distribution"
        - "Deep-buried pages identified"

    - id: "3"
      name: "Link Equity Distribution Analysis"
      description: |
        Compare internal link counts with page priority
        to identify equity misalignment.
      duration_estimate: "30 min"

      questions:
        - "Do high-priority pages have the most internal links?"
        - "Are low-value pages receiving excessive links?"
        - "Is link equity flowing to conversion pages?"

      expected_findings:
        - "Equity distribution assessment"
        - "Misalignment identification"

    - id: "4"
      name: "Navigation Structure Review"
      description: |
        Analyze header, sidebar, and footer navigation
        for efficient link equity distribution.
      duration_estimate: "20 min"

      commands:
        - purpose: "Extract navigation links"
          command: "curl -s $URL | grep -oE '<nav[^>]*>.*</nav>' | grep -oE 'href=\"[^\"]*\"' | head -30"

      expected_findings:
        - "Navigation structure assessment"
        - "Sitewide link opportunities"

    - id: "5"
      name: "Contextual Link Opportunities"
      description: |
        Identify opportunities for adding contextual links
        within content to boost target pages.
      duration_estimate: "20 min"

      questions:
        - "Are there natural linking opportunities in existing content?"
        - "Could related posts/products sections add links?"
        - "Are topic clusters properly interlinked?"

      expected_findings:
        - "Contextual linking opportunities"
        - "Implementation recommendations"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Internal Link Distribution"
        - "Click Depth Analysis"
        - "Priority Page Assessment"
        - "Linking Recommendations"

  confidence_guidance:
    high: "Complete crawl with link equity modeling"
    medium: "Crawl data without equity calculation"
    low: "Sample page analysis only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "internal-linking"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive site crawl"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "internal-link-equity-001"
    item: "Priority pages within 3 clicks of homepage"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify click depth for top 20 priority pages"
    expected: "All priority pages <= 3 clicks"

  - id: "internal-link-equity-002"
    item: "No nofollow on internal links"
    level: "CRITICAL"
    verification: "grep -r 'rel=\"nofollow\"' --include='*.html' . | grep -v external | wc -l"
    expected: "0"

  - id: "internal-link-equity-003"
    item: "Priority pages have >= 10 internal links"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Check inlink count for top priority pages"
    expected: "Confirmed by reviewer"

  - id: "internal-link-equity-004"
    item: "Contextual links present in content"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Sample content for contextual internal links"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["web-application", "marketing-site", "e-commerce", "blog"]

  compliance_frameworks:
    - framework: "SEO Best Practices"
      controls: ["Internal Linking"]

relationships:
  commonly_combined:
    - "seo-discoverability.content-discovery.orphan-page"
    - "seo-discoverability.link-authority.anchor-text-distribution"
    - "seo-discoverability.technical-seo.site-architecture"
