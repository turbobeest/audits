# ============================================================
# AUDIT: Nofollow Strategy
# ============================================================
# Evaluates the strategic use of nofollow and other link
# attributes for SEO optimization.

audit:
  id: "seo-discoverability.link-authority.nofollow-strategy"

  name: "Nofollow Strategy Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "link-authority"

  tier: "expert"
  estimated_duration: "1.5 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates the strategic use of rel="nofollow", rel="sponsored",
    rel="ugc", and related link attributes. It examines whether nofollow is
    being used appropriately for paid links, user-generated content, and
    untrusted sources, while ensuring valuable internal links are not
    inadvertently nofollowed.

  why_it_matters: |
    Proper use of nofollow and related attributes maintains compliance with
    Google's link guidelines and prevents potential penalties for unnatural
    links. Conversely, inappropriate nofollow usage (on internal links or
    valuable editorial links) wastes link equity. Google introduced sponsored
    and ugc attributes to provide more specific signals about link types.

  when_to_run:
    - "When implementing affiliate or sponsored content"
    - "When launching user-generated content features"
    - "During link scheme compliance audits"
    - "After CMS or template changes"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "HTML source for link attribute analysis"
    - type: "deployed_website"
      description: "Live site for comprehensive analysis"

  access_requirements:
    - "Source code repository access"
    - "Template and CMS access"

discovery:
  code_patterns:
    - pattern: "rel=[\"'][^\"']*nofollow[^\"']*[\"']"
      type: "regex"
      scope: "source"
      purpose: "Detect nofollow attributes"
    - pattern: "rel=[\"'][^\"']*sponsored[^\"']*[\"']"
      type: "regex"
      scope: "source"
      purpose: "Detect sponsored link attributes"
    - pattern: "rel=[\"'][^\"']*ugc[^\"']*[\"']"
      type: "regex"
      scope: "source"
      purpose: "Detect user-generated content attributes"
    - pattern: "rel=[\"'][^\"']*noopener[^\"']*[\"']"
      type: "regex"
      scope: "source"
      purpose: "Detect security-related link attributes"

  file_patterns:
    - glob: "**/*.html"
      purpose: "HTML files for link analysis"
    - glob: "**/templates/**"
      purpose: "Template files for pattern analysis"
    - glob: "**/components/**"
      purpose: "Component files for link patterns"

knowledge_sources:
  specifications:
    - id: "google-nofollow"
      name: "Google Nofollow Documentation"
      url: "https://developers.google.com/search/docs/crawling-indexing/qualify-outbound-links"
      offline_cache: true
      priority: "required"
    - id: "link-attributes"
      name: "HTML Link Types"
      url: "https://html.spec.whatwg.org/multipage/links.html#linkTypes"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "nofollow-guide"
      name: "Nofollow Usage Guide"
      url: "https://moz.com/learn/seo/nofollow"
      offline_cache: true
    - id: "sponsored-ugc"
      name: "Sponsored and UGC Attributes"
      url: "https://ahrefs.com/blog/nofollow-links/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Screaming Frog"
      purpose: "Identify all nofollow links site-wide"
      offline_capable: false

  scripts:
    - id: "nofollow-checker"
      language: "bash"
      purpose: "Extract nofollow links"
      source: "inline"
      code: |
        #!/bin/bash
        # Find all nofollow links
        curl -s $URL | \
        grep -oE '<a[^>]*rel="[^"]*nofollow[^"]*"[^>]*>' | \
        grep -oE 'href="[^"]*"'
    - id: "sponsored-ugc-checker"
      language: "bash"
      purpose: "Find sponsored and ugc attributes"
      source: "inline"
      code: |
        #!/bin/bash
        curl -s $URL | \
        grep -oE 'rel="[^"]*"' | \
        grep -E 'sponsored|ugc'

signals:
  critical:
    - id: "SEO-NOFOL-CRIT-001"
      signal: "Nofollow on internal links"
      evidence_pattern: "rel=\"nofollow\" on links to internal pages"
      explanation: |
        Nofollowing internal links wastes PageRank that could flow to
        other pages. This is almost never appropriate and indicates
        misunderstanding of nofollow purpose.
      remediation: "Remove nofollow from internal links"
    - id: "SEO-NOFOL-CRIT-002"
      signal: "Paid/sponsored links without nofollow"
      evidence_pattern: "Affiliate or sponsored links without proper attributes"
      explanation: |
        Paid links that pass PageRank violate Google's guidelines and can
        result in manual penalties for link schemes. All paid links must
        use nofollow or sponsored attributes.
      remediation: "Add rel=\"sponsored\" or rel=\"nofollow\" to all paid links"

  high:
    - id: "SEO-NOFOL-HIGH-001"
      signal: "User-generated content links without ugc"
      explanation: |
        Links in user comments, forum posts, or user profiles should use
        rel=\"ugc\" to indicate they are user-generated and not editorially
        vouched for.
      remediation: "Add rel=\"ugc\" to all user-generated content links"
    - id: "SEO-NOFOL-HIGH-002"
      signal: "Editorial links nofollowed inappropriately"
      explanation: |
        Legitimate editorial links to external resources should not be
        nofollowed - this wastes potential relationship-building and
        may indicate over-cautious link policies.
      remediation: "Remove nofollow from trustworthy editorial links"

  medium:
    - id: "SEO-NOFOL-MED-001"
      signal: "Inconsistent nofollow application across site"
      remediation: "Standardize nofollow policy in templates and CMS"
    - id: "SEO-NOFOL-MED-002"
      signal: "Login/registration links nofollowed unnecessarily"
      remediation: "Only nofollow if pages are actually blocked from crawlers"

  low:
    - id: "SEO-NOFOL-LOW-001"
      signal: "Using nofollow instead of specific attributes"

  positive:
    - id: "SEO-NOFOL-POS-001"
      signal: "Proper use of sponsored, ugc, and nofollow attributes"
    - id: "SEO-NOFOL-POS-002"
      signal: "Clear nofollow policy documented and implemented"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Nofollow Link Inventory"
      description: |
        Identify all links with nofollow, sponsored, and
        ugc attributes across the site.
      duration_estimate: "20 min"

      commands:
        - purpose: "Find nofollow links"
          command: "grep -rE 'rel=\"[^\"]*nofollow' --include='*.html' . | head -20"
        - purpose: "Find sponsored/ugc links"
          command: "grep -rE 'rel=\"[^\"]*sponsored|rel=\"[^\"]*ugc' --include='*.html' . | head -20"

      expected_findings:
        - "Nofollow link inventory"
        - "Sponsored/UGC usage"

    - id: "2"
      name: "Internal Nofollow Check"
      description: |
        Verify no internal links are nofollowed.
      duration_estimate: "15 min"

      commands:
        - purpose: "Check for internal nofollow"
          command: "grep -rE 'rel=\"nofollow\".*href=\"/' --include='*.html' ."

      expected_findings:
        - "Internal nofollow issues"
        - "Template patterns"

    - id: "3"
      name: "Paid Link Compliance Check"
      description: |
        Verify all paid, sponsored, or affiliate links
        have proper nofollow/sponsored attributes.
      duration_estimate: "25 min"

      questions:
        - "Are there affiliate links on the site?"
        - "Do all sponsored/paid links have proper attributes?"
        - "Are there any undisclosed paid partnerships?"

      expected_findings:
        - "Paid link compliance"
        - "Missing attribute identification"

    - id: "4"
      name: "UGC Link Analysis"
      description: |
        Review user-generated content sections for proper
        link attribute handling.
      duration_estimate: "20 min"

      questions:
        - "Are there user comments or forum sections?"
        - "Do user-submitted links use rel=\"ugc\"?"
        - "Are profile links properly attributed?"

      expected_findings:
        - "UGC compliance assessment"
        - "Template recommendations"

    - id: "5"
      name: "Policy Documentation Review"
      description: |
        Review or create documentation for nofollow
        strategy and implementation guidelines.
      duration_estimate: "10 min"

      questions:
        - "Is there a documented nofollow policy?"
        - "Are CMS/template settings correct?"
        - "Is the team trained on proper usage?"

      expected_findings:
        - "Policy documentation status"
        - "Process recommendations"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Nofollow Usage Analysis"
        - "Compliance Assessment"
        - "Internal Link Issues"
        - "Policy Recommendations"

  confidence_guidance:
    high: "Complete crawl with manual compliance verification"
    medium: "Code analysis with spot checks"
    low: "Sample page analysis only"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "google-nofollow"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires thorough link attribute analysis"
    full:
      included: true
      priority: 3

closeout_checklist:
  - id: "nofollow-strategy-001"
    item: "No internal links have nofollow"
    level: "CRITICAL"
    verification: "grep -rE 'rel=\"[^\"]*nofollow[^\"]*\".*href=\"/' --include='*.html' . | wc -l"
    expected: "0"

  - id: "nofollow-strategy-002"
    item: "All paid/sponsored links have proper attributes"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Review all affiliate and sponsored content"
    expected: "Confirmed by reviewer"

  - id: "nofollow-strategy-003"
    item: "UGC links have rel=\"ugc\""
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify user comment and forum link attributes"
    expected: "Confirmed by reviewer"

  - id: "nofollow-strategy-004"
    item: "Nofollow policy documented"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Check for internal nofollow policy documentation"
    expected: "Policy exists"

governance:
  applicable_to:
    archetypes: ["marketing-site", "e-commerce", "blog", "forum", "community"]

  compliance_frameworks:
    - framework: "Google Webmaster Guidelines"
      controls: ["Link Schemes", "Sponsored Content"]
    - framework: "FTC Guidelines"
      controls: ["Affiliate Disclosure"]

relationships:
  commonly_combined:
    - "seo-discoverability.link-authority.internal-link-equity"
    - "seo-discoverability.link-authority.backlink-quality"
    - "compliance.advertising.affiliate-disclosure"
