# ============================================================
# AUDIT: Language Targeting
# ============================================================
# Evaluates language targeting implementation for multilingual
# websites and international SEO optimization.

audit:
  id: "seo-discoverability.international-seo.language-targeting"

  name: "Language Targeting Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "international-seo"

  tier: "expert"
  estimated_duration: "2.5 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates language targeting implementation including HTML
    lang attributes, Content-Language headers, language-specific URLs,
    language detection and switching mechanisms, and content translation
    quality signals. It assesses how effectively the site communicates
    content language to search engines and users.

  why_it_matters: |
    Proper language targeting ensures search engines serve the correct
    language version to users and correctly index multilingual content.
    Incorrect language signals lead to wrong language versions appearing
    in search results, frustrated users bouncing immediately, and lost
    traffic from international markets. Language targeting is foundational
    to international SEO success.

  when_to_run:
    - "When launching multilingual content"
    - "When international search visibility declines"
    - "During localization quality reviews"
    - "When adding new language versions"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "HTML source files for language attribute analysis"
    - type: "deployed_website"
      description: "Live site for header inspection and testing"

  access_requirements:
    - "Source code repository access"
    - "Access to all language versions"
    - "Google Search Console for international targeting data"

discovery:
  code_patterns:
    - pattern: "lang\\s*=\\s*[\"'][^\"']+[\"']"
      type: "regex"
      scope: "source"
      purpose: "Detect HTML lang attribute"
    - pattern: "<html[^>]*lang="
      type: "regex"
      scope: "source"
      purpose: "Find document-level language declaration"
    - pattern: "Content-Language"
      type: "keyword"
      scope: "config"
      purpose: "Detect Content-Language header configuration"
    - pattern: "xml:lang"
      type: "keyword"
      scope: "source"
      purpose: "Find XHTML language declarations"

  file_patterns:
    - glob: "**/*.html"
      purpose: "HTML files for lang attribute analysis"
    - glob: "**/nginx.conf"
      purpose: "Server configuration for Content-Language headers"
    - glob: "**/.htaccess"
      purpose: "Apache configuration for headers"
    - glob: "**/i18n/**"
      purpose: "Internationalization configuration files"

knowledge_sources:
  specifications:
    - id: "html-lang"
      name: "HTML lang Attribute Specification"
      url: "https://html.spec.whatwg.org/multipage/dom.html#the-lang-and-xml:lang-attributes"
      offline_cache: true
      priority: "required"
    - id: "bcp47"
      name: "BCP 47 Language Tags"
      url: "https://www.rfc-editor.org/info/bcp47"
      offline_cache: true
      priority: "required"

  guides:
    - id: "google-lang"
      name: "Google Language Targeting Guide"
      url: "https://developers.google.com/search/docs/specialty/international/managing-multi-regional-sites"
      offline_cache: true
    - id: "w3c-lang"
      name: "W3C Language on the Web"
      url: "https://www.w3.org/International/questions/qa-html-language-declarations"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "HTMLHint"
      purpose: "Validate HTML lang attribute"
      offline_capable: true
    - tool: "axe-core"
      purpose: "Accessibility lang attribute audit"
      offline_capable: true

  infrastructure_tools:
    - tool: "curl"
      purpose: "Check Content-Language header"
      command: "curl -sI URL | grep -i content-language"

  scripts:
    - id: "lang-checker"
      language: "bash"
      purpose: "Extract all lang attributes"
      source: "inline"
      code: |
        #!/bin/bash
        # Find all lang attribute values
        grep -rohE 'lang="[^"]+"' --include='*.html' . | \
        sort | uniq -c | sort -rn

signals:
  critical:
    - id: "SEO-LANG-CRIT-001"
      signal: "Missing HTML lang attribute on document root"
      evidence_pattern: "<html> tag without lang attribute"
      explanation: |
        The lang attribute on the html element is essential for search
        engines and assistive technologies to understand the page language.
        Missing this attribute is a significant accessibility and SEO failure.
      remediation: "Add lang attribute to html element: <html lang=\"en\">"
    - id: "SEO-LANG-CRIT-002"
      signal: "Mismatched content and declared language"
      evidence_pattern: "Page declares lang=\"en\" but content is in another language"
      explanation: |
        Declaring an incorrect language confuses search engines and causes
        accessibility issues. The declared language must match actual content.
      remediation: "Ensure lang attribute accurately reflects page content language"

  high:
    - id: "SEO-LANG-HIGH-001"
      signal: "Invalid language code in lang attribute"
      explanation: |
        Using non-standard language codes (e.g., 'english' instead of 'en')
        prevents proper language identification by browsers and search engines.
      remediation: "Use valid BCP 47 language tags (ISO 639-1 codes)"
    - id: "SEO-LANG-HIGH-002"
      signal: "Mixed language content without proper markup"
      explanation: |
        Sections in different languages should use lang attribute to indicate
        the change. Unmarked language switches confuse screen readers and translation.
      remediation: "Add lang attribute to elements containing different languages"

  medium:
    - id: "SEO-LANG-MED-001"
      signal: "Content-Language header missing or incorrect"
      remediation: "Set Content-Language HTTP header matching page language"
    - id: "SEO-LANG-MED-002"
      signal: "Inconsistent language declarations across site sections"
      remediation: "Standardize language declaration through shared templates"

  low:
    - id: "SEO-LANG-LOW-001"
      signal: "xml:lang not included for XHTML compatibility"

  positive:
    - id: "SEO-LANG-POS-001"
      signal: "Proper lang attribute on all HTML documents"
    - id: "SEO-LANG-POS-002"
      signal: "Content-Language headers correctly configured"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "HTML Lang Attribute Analysis"
      description: |
        Examine all HTML files for lang attribute presence and
        validity on the document root element.
      duration_estimate: "25 min"

      commands:
        - purpose: "Find html tags with lang"
          command: "grep -r '<html' --include='*.html' . | grep -o 'lang=\"[^\"]*\"' | sort -u"
        - purpose: "Find html tags missing lang"
          command: "grep -r '<html' --include='*.html' . | grep -v 'lang=' | head -20"

      expected_findings:
        - "Lang attribute coverage"
        - "Files missing lang attribute"

    - id: "2"
      name: "Language Code Validation"
      description: |
        Validate all language codes against BCP 47 / ISO 639-1 standards
        to ensure proper formatting.
      duration_estimate: "15 min"

      commands:
        - purpose: "Extract unique lang values"
          command: "grep -rohE 'lang=\"[^\"]+\"' --include='*.html' . | sort -u"

      expected_findings:
        - "Valid vs invalid language codes"
        - "Regional variation usage"

    - id: "3"
      name: "Content-Language Header Check"
      description: |
        Verify Content-Language HTTP headers are properly configured
        for each language version.
      duration_estimate: "20 min"

      commands:
        - purpose: "Check Content-Language header"
          command: "curl -sI URL | grep -i 'content-language'"

      expected_findings:
        - "Header presence and values"
        - "Header-content alignment"

    - id: "4"
      name: "Language Switcher Analysis"
      description: |
        Evaluate the language switcher implementation for usability
        and SEO best practices.
      duration_estimate: "20 min"

      questions:
        - "Is there a visible language switcher?"
        - "Does the switcher link to translated equivalents (not just homepage)?"
        - "Are language links crawlable by search engines?"
        - "Is the current language clearly indicated?"

      expected_findings:
        - "Language switcher implementation quality"
        - "User experience assessment"

    - id: "5"
      name: "Content-Language Alignment Check"
      description: |
        Sample pages to verify declared language matches actual
        content language.
      duration_estimate: "30 min"

      questions:
        - "Does declared language match visible content?"
        - "Are there mixed-language pages without proper markup?"
        - "Is machine translation being used without review?"

      expected_findings:
        - "Language declaration accuracy"
        - "Content quality signals"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Language Declaration Audit"
        - "Content-Language Analysis"
        - "Language Switcher Review"
        - "Recommendations"

  confidence_guidance:
    high: "Complete HTML analysis with content verification"
    medium: "Code analysis with spot-check verification"
    low: "Partial file analysis"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "html-lang"
        priority: "required"
      - source_id: "bcp47"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires content verification for accuracy"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "language-targeting-001"
    item: "All HTML pages have valid lang attribute"
    level: "CRITICAL"
    verification: "grep -rL 'lang=' --include='*.html' . | wc -l"
    expected: "0"

  - id: "language-targeting-002"
    item: "Language codes are valid BCP 47 tags"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify extracted codes against BCP 47 standard"
    expected: "Confirmed by reviewer"

  - id: "language-targeting-003"
    item: "Content-Language header set correctly"
    level: "BLOCKING"
    verification: "curl -sI URL | grep -i 'content-language'"
    expected: "Content-Language header present"

  - id: "language-targeting-004"
    item: "Declared language matches actual content"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Sample check 10+ pages for language accuracy"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["marketing-site", "e-commerce", "saas"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["3.1.1", "3.1.2"]

relationships:
  commonly_combined:
    - "seo-discoverability.international-seo.hreflang-implementation"
    - "seo-discoverability.international-seo.regional-content"
    - "accessibility.language.lang-attribute"
