# ============================================================
# AUDIT: International URL Structure
# ============================================================
# Evaluates URL structure strategy for international and
# multilingual website architecture.

audit:
  id: "seo-discoverability.international-seo.international-url-structure"

  name: "International URL Structure Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "international-seo"

  tier: "expert"
  estimated_duration: "2 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates URL structure strategy for international websites,
    examining the choice between ccTLDs (example.de), subdomains (de.example.com),
    subdirectories (example.com/de/), and parameter-based approaches. It assesses
    URL consistency, language/region indicators in URLs, canonical URL handling,
    and internal linking structure across regional versions.

  why_it_matters: |
    URL structure is fundamental to international SEO architecture. The chosen
    approach affects crawl efficiency, link equity distribution, geo-targeting
    signals, and management complexity. Inconsistent URL structures confuse
    search engines and users, dilute link authority, and create indexing
    problems. A well-planned international URL structure enables better
    rankings in regional search results.

  when_to_run:
    - "Before launching international site architecture"
    - "When restructuring existing international setup"
    - "When international organic traffic declines"
    - "During technical SEO audits"

prerequisites:
  required_artifacts:
    - type: "deployed_website"
      description: "Live site for URL structure analysis"
    - type: "sitemap"
      description: "XML sitemaps showing URL structure"

  access_requirements:
    - "Access to all regional versions"
    - "DNS and domain management access"
    - "Google Search Console access"

discovery:
  code_patterns:
    - pattern: "href=[\"']/[a-z]{2}(-[A-Z]{2})?/"
      type: "regex"
      scope: "source"
      purpose: "Detect language subdirectory patterns"
    - pattern: "href=[\"']https?://[a-z]{2}\\."
      type: "regex"
      scope: "source"
      purpose: "Detect language subdomain patterns"
    - pattern: "\\?lang=|\\?locale=|\\?hl="
      type: "regex"
      scope: "source"
      purpose: "Detect parameter-based language switching"

  file_patterns:
    - glob: "**/sitemap*.xml"
      purpose: "XML sitemaps showing URL structure"
    - glob: "**/robots.txt"
      purpose: "Robots configuration for regional versions"
    - glob: "**/routes.*"
      purpose: "Routing configuration"

knowledge_sources:
  specifications:
    - id: "google-url-structure"
      name: "Google International URL Structure Guide"
      url: "https://developers.google.com/search/docs/specialty/international/managing-multi-regional-sites"
      offline_cache: true
      priority: "required"

  guides:
    - id: "moz-url-structure"
      name: "Moz International URL Structure"
      url: "https://moz.com/learn/seo/international-seo"
      offline_cache: true
    - id: "ahrefs-structure"
      name: "Ahrefs International Site Structure"
      url: "https://ahrefs.com/blog/international-seo/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Screaming Frog"
      purpose: "Crawl and analyze URL structure"
      offline_capable: false
    - tool: "Sitebulb"
      purpose: "URL structure visualization"
      offline_capable: false

  infrastructure_tools:
    - tool: "dig"
      purpose: "DNS lookup for ccTLD analysis"
      command: "dig +short example.de example.fr example.es"

  scripts:
    - id: "url-structure-analyzer"
      language: "bash"
      purpose: "Analyze URL patterns from sitemap"
      source: "inline"
      code: |
        #!/bin/bash
        # Extract and analyze URL patterns from sitemap
        curl -s $SITEMAP_URL | \
        grep -oE 'https?://[^<]+' | \
        sed 's|/[^/]*$||' | \
        sort | uniq -c | sort -rn | head -20

signals:
  critical:
    - id: "SEO-INTURL-CRIT-001"
      signal: "Parameter-based language switching"
      evidence_pattern: "URLs using ?lang=xx or ?hl=xx parameters"
      explanation: |
        Parameter-based language URLs (example.com?lang=fr) are the worst
        option for international SEO. They're difficult for search engines
        to crawl efficiently, don't provide clear geo-targeting signals,
        and can cause duplicate content issues.
      remediation: "Migrate to subdirectory or subdomain structure with proper redirects"
    - id: "SEO-INTURL-CRIT-002"
      signal: "Inconsistent URL structure across regional versions"
      evidence_pattern: "Mixed usage of ccTLD, subdomain, and subdirectory"
      explanation: |
        Inconsistent URL structures complicate site management, confuse
        link building, and make it harder for search engines to understand
        site architecture.
      remediation: "Standardize on one URL structure approach across all regions"

  high:
    - id: "SEO-INTURL-HIGH-001"
      signal: "No language indicator in URL path"
      explanation: |
        URLs without language indicators (example.com/product vs
        example.com/fr/product) make it unclear which version users
        are viewing and complicate international SEO management.
      remediation: "Include language/region code in URL path"
    - id: "SEO-INTURL-HIGH-002"
      signal: "Translated URL slugs inconsistent"
      explanation: |
        Inconsistent handling of URL slugs (some translated, some not)
        creates maintenance complexity and user confusion.
      remediation: "Establish and follow URL slug localization policy"

  medium:
    - id: "SEO-INTURL-MED-001"
      signal: "Subdirectory using incorrect language codes"
      remediation: "Use ISO 639-1 codes consistently (/en/, /fr/, /de/)"
    - id: "SEO-INTURL-MED-002"
      signal: "Regional version not in robots.txt sitemap"
      remediation: "Declare all regional sitemaps in robots.txt"

  low:
    - id: "SEO-INTURL-LOW-001"
      signal: "Language code after trailing slash inconsistent"

  positive:
    - id: "SEO-INTURL-POS-001"
      signal: "Clean subdirectory structure with consistent language codes"
    - id: "SEO-INTURL-POS-002"
      signal: "ccTLD strategy for major markets with gTLD for others"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "URL Structure Identification"
      description: |
        Identify the URL structure approach used for international
        versions (ccTLD, subdomain, subdirectory, or parameters).
      duration_estimate: "20 min"

      commands:
        - purpose: "Extract URL patterns from sitemap"
          command: "curl -s $SITEMAP_URL | grep -oE 'https?://[^<\"]+' | sed 's|/[^/]*$||' | sort -u | head -30"
        - purpose: "Check for ccTLDs"
          command: "dig +short $DOMAIN.de $DOMAIN.fr $DOMAIN.es $DOMAIN.co.uk 2>/dev/null"

      expected_findings:
        - "URL structure approach identification"
        - "Regional versions discovered"

    - id: "2"
      name: "URL Consistency Analysis"
      description: |
        Verify URL structure is consistent across all regional
        versions and content types.
      duration_estimate: "25 min"

      commands:
        - purpose: "Check URL patterns by region"
          command: "curl -s $SITEMAP_URL | grep -oE 'https?://[^<]+' | cut -d'/' -f1-4 | sort | uniq -c | sort -rn"

      expected_findings:
        - "Consistency assessment"
        - "Anomalies identified"

    - id: "3"
      name: "Language Code Validation"
      description: |
        Verify language codes in URLs follow ISO standards
        and are consistently applied.
      duration_estimate: "15 min"

      commands:
        - purpose: "Extract language codes from URLs"
          command: "curl -s $SITEMAP_URL | grep -oE '/[a-z]{2}(-[a-z]{2})?/' | sort | uniq -c | sort -rn"

      expected_findings:
        - "Language code standardization"
        - "Non-standard codes identified"

    - id: "4"
      name: "Cross-Regional Linking Analysis"
      description: |
        Analyze how regional versions link to each other and
        assess internal linking structure.
      duration_estimate: "25 min"

      commands:
        - purpose: "Find cross-regional links"
          command: "curl -s $URL | grep -oE 'href=\"[^\"]*\"' | grep -E '/[a-z]{2}/' | head -20"

      expected_findings:
        - "Cross-regional linking patterns"
        - "Internal linking health"

    - id: "5"
      name: "Canonical URL Handling"
      description: |
        Verify canonical URLs are properly set and align
        with hreflang implementations.
      duration_estimate: "15 min"

      commands:
        - purpose: "Check canonical URLs"
          command: "curl -s $URL | grep -oE 'rel=\"canonical\"[^>]*href=\"[^\"]*\"'"

      expected_findings:
        - "Canonical URL configuration"
        - "Canonical-hreflang alignment"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "URL Structure Assessment"
        - "Consistency Analysis"
        - "Migration Recommendations (if needed)"
        - "Best Practice Alignment"

  confidence_guidance:
    high: "Complete sitemap crawl with cross-verification"
    medium: "Sample URL analysis"
    low: "Surface-level structure identification"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "google-url-structure"
        priority: "required"

profiles:
  membership:
    quick:
      included: true
      reason: "URL structure is foundational to international SEO"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "international-url-structure-001"
    item: "Consistent URL structure across all regions"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify all regional versions use same structure approach"
    expected: "Confirmed by reviewer"

  - id: "international-url-structure-002"
    item: "No parameter-based language switching"
    level: "CRITICAL"
    verification: "grep -c '?lang=\\|?hl=\\|?locale=' sitemap.xml"
    expected: "0"

  - id: "international-url-structure-003"
    item: "Valid ISO language codes in URLs"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify language codes match ISO 639-1"
    expected: "Confirmed by reviewer"

  - id: "international-url-structure-004"
    item: "Canonical URLs properly configured"
    level: "WARNING"
    verification: "curl -s URL | grep -c 'rel=\"canonical\"'"
    expected: ">= 1"

governance:
  applicable_to:
    archetypes: ["marketing-site", "e-commerce", "saas"]

  compliance_frameworks:
    - framework: "Google Webmaster Guidelines"
      controls: ["URL Structure"]

relationships:
  commonly_combined:
    - "seo-discoverability.international-seo.hreflang-implementation"
    - "seo-discoverability.international-seo.geo-targeting"
    - "seo-discoverability.technical-seo.canonical-url"
