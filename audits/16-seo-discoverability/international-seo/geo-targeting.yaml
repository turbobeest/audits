# ============================================================
# AUDIT: Geo-Targeting
# ============================================================
# Evaluates geographic targeting implementation for regional
# SEO and international market optimization.

audit:
  id: "seo-discoverability.international-seo.geo-targeting"

  name: "Geo-Targeting Configuration Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "international-seo"

  tier: "expert"
  estimated_duration: "2 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "infrastructure"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates geographic targeting implementation including
    ccTLD usage, subdomain/subdirectory structure for regions, Search
    Console geo-targeting settings, CDN configuration, server location,
    and IP-based redirects. It assesses how effectively the site targets
    specific geographic regions for search visibility.

  why_it_matters: |
    Geographic targeting signals help search engines understand which
    countries or regions specific content is intended for. Incorrect
    geo-targeting can result in content appearing in wrong regional
    search results, being outranked by local competitors, or missing
    key international markets. Proper geo-targeting is essential for
    businesses operating in multiple countries or targeting specific regions.

  when_to_run:
    - "When launching in new geographic markets"
    - "When regional search visibility declines"
    - "When restructuring international site architecture"
    - "During annual international SEO strategy reviews"

prerequisites:
  required_artifacts:
    - type: "deployed_website"
      description: "Live website for geo-targeting analysis"
    - type: "dns_records"
      description: "DNS configuration for domain analysis"
    - type: "search_console_access"
      description: "Google Search Console for geo-targeting settings"

  access_requirements:
    - "Google Search Console access"
    - "DNS record access"
    - "CDN configuration access"
    - "Server/hosting configuration access"

discovery:
  code_patterns:
    - pattern: "geo|country|region|locale"
      type: "keyword"
      scope: "config"
      purpose: "Detect geo-targeting configuration"
    - pattern: "Cloudflare-IPCountry|CF-IPCountry|X-Country"
      type: "keyword"
      scope: "config"
      purpose: "Detect CDN geo headers"

  file_patterns:
    - glob: "**/nginx.conf"
      purpose: "Server geo-targeting configuration"
    - glob: "**/*.htaccess"
      purpose: "Apache geo configuration"
    - glob: "**/cloudflare*.json"
      purpose: "Cloudflare configuration"
    - glob: "**/cdn-config.*"
      purpose: "CDN configuration files"

  metrics_queries:
    - system: "Google Search Console"
      query: "International Targeting Report"
      purpose: "Check current geo-targeting settings"
      threshold: "Target countries configured"

knowledge_sources:
  specifications:
    - id: "google-geotargeting"
      name: "Google Geographic Targeting"
      url: "https://developers.google.com/search/docs/specialty/international/managing-multi-regional-sites"
      offline_cache: true
      priority: "required"
    - id: "cctld-list"
      name: "Country Code Top-Level Domains"
      url: "https://en.wikipedia.org/wiki/Country_code_top-level_domain"
      offline_cache: true
      priority: "required"

  guides:
    - id: "search-console-geo"
      name: "Search Console International Targeting"
      url: "https://support.google.com/webmasters/answer/6059209"
      offline_cache: true
    - id: "moz-international"
      name: "Moz International SEO Strategy"
      url: "https://moz.com/learn/seo/international-seo"
      offline_cache: true

tooling:
  infrastructure_tools:
    - tool: "dig"
      purpose: "DNS lookup for domain analysis"
      command: "dig +short example.com"
    - tool: "whois"
      purpose: "Domain registration information"
      command: "whois example.com"
    - tool: "curl"
      purpose: "Test geo-based responses"
      command: "curl -H 'X-Forwarded-For: IP' URL"

  assessment_tools:
    - tool: "Google Search Console"
      purpose: "Review and set geo-targeting"

  scripts:
    - id: "domain-structure-check"
      language: "bash"
      purpose: "Analyze URL structure for geo-targeting"
      source: "inline"
      code: |
        #!/bin/bash
        # Extract domain patterns suggesting geo-targeting
        echo "Checking for country subdomains..."
        dig +short us.example.com uk.example.com de.example.com

signals:
  critical:
    - id: "SEO-GEO-CRIT-001"
      signal: "No geo-targeting signals for multi-regional site"
      evidence_indicators:
        - "gTLD without Search Console geo-targeting"
        - "No hreflang with regional codes"
        - "No country-specific URL structure"
      explanation: |
        Without geo-targeting signals, search engines cannot determine
        which regional audience content is intended for, resulting in
        suboptimal international search visibility.
      remediation: "Implement geo-targeting via ccTLD, subdirectory, subdomain, or Search Console settings"
    - id: "SEO-GEO-CRIT-002"
      signal: "IP-based redirects blocking Googlebot"
      evidence_pattern: "Geo-redirects applying to search engine crawlers"
      explanation: |
        IP-based redirects that redirect Googlebot prevent proper indexing
        of regional content. Google recommends serving content based on
        hreflang rather than IP redirection.
      remediation: "Use hreflang for language/region serving; don't redirect crawlers"

  high:
    - id: "SEO-GEO-HIGH-001"
      signal: "Search Console geo-targeting not configured"
      explanation: |
        For gTLD sites, Search Console geo-targeting is a primary way
        to indicate target country. Without it, Google uses other signals
        which may not accurately reflect intent.
      remediation: "Set geo-targeting in Google Search Console for each property"
    - id: "SEO-GEO-HIGH-002"
      signal: "CDN serving from distant locations"
      explanation: |
        Server location is a minor geo-targeting signal. Serving from
        geographically distant locations may impact both SEO and performance.
      remediation: "Configure CDN to serve from edge locations in target regions"

  medium:
    - id: "SEO-GEO-MED-001"
      signal: "Mixed geo-targeting signals"
      remediation: "Align all geo-targeting signals (ccTLD, hreflang, Search Console)"
    - id: "SEO-GEO-MED-002"
      signal: "Subdirectory structure inconsistent across regions"
      remediation: "Standardize regional URL structure (e.g., /en-us/, /en-gb/)"

  low:
    - id: "SEO-GEO-LOW-001"
      signal: "Local business schema missing geographic scope"

  positive:
    - id: "SEO-GEO-POS-001"
      signal: "Consistent geo-targeting across all channels"
    - id: "SEO-GEO-POS-002"
      signal: "ccTLD strategy for major markets"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Domain Structure Analysis"
      description: |
        Analyze domain structure to understand geo-targeting approach
        (ccTLD, subdomain, subdirectory, or gTLD with targeting).
      duration_estimate: "20 min"

      commands:
        - purpose: "Check domain type"
          command: "echo 'Domain TLD analysis' && echo $URL | grep -oE '\\.[a-z]{2,}$'"
        - purpose: "Check for country subdomains"
          command: "dig +short us.$DOMAIN uk.$DOMAIN de.$DOMAIN fr.$DOMAIN 2>/dev/null"

      expected_findings:
        - "Domain structure type identification"
        - "Regional variants available"

    - id: "2"
      name: "Search Console Geo-Targeting Review"
      description: |
        Review Google Search Console International Targeting settings
        for all properties.
      duration_estimate: "20 min"

      questions:
        - "Is international targeting configured in Search Console?"
        - "What countries are targeted for each property?"
        - "Are there multiple properties for different regions?"

      expected_findings:
        - "Current Search Console geo-targeting configuration"
        - "Coverage gaps"

    - id: "3"
      name: "Server and CDN Location Check"
      description: |
        Verify server locations and CDN configuration for
        geographic proximity to target audiences.
      duration_estimate: "20 min"

      commands:
        - purpose: "Check server IP location"
          command: "curl -s ipinfo.io/$(dig +short $DOMAIN | head -1)"
        - purpose: "Check CDN headers"
          command: "curl -sI $URL | grep -iE 'cf-|x-served|x-cache|server'"

      expected_findings:
        - "Server/CDN geographic distribution"
        - "Edge location coverage"

    - id: "4"
      name: "IP Redirect Testing"
      description: |
        Test for IP-based redirects and verify they don't
        affect search engine crawlers inappropriately.
      duration_estimate: "25 min"

      commands:
        - purpose: "Test with different geo headers"
          command: "curl -sI -H 'X-Forwarded-For: 8.8.8.8' $URL | grep -i location"

      expected_findings:
        - "IP redirect behavior"
        - "Crawler handling verification"

    - id: "5"
      name: "Geo-Signal Alignment Check"
      description: |
        Verify all geo-targeting signals are aligned and not
        sending conflicting information to search engines.
      duration_estimate: "15 min"

      questions:
        - "Do hreflang region codes match Search Console targeting?"
        - "Is server location aligned with primary target market?"
        - "Are business address signals consistent?"

      expected_findings:
        - "Signal alignment assessment"
        - "Conflicting signals identified"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Geo-Targeting Structure Analysis"
        - "Search Console Configuration"
        - "Server Infrastructure Review"
        - "Recommendations by Region"

  confidence_guidance:
    high: "Search Console data combined with technical verification"
    medium: "Technical analysis without Search Console access"
    low: "External observation only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "google-geotargeting"
        priority: "required"
      - source_id: "cctld-list"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires Search Console access and infrastructure review"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "geo-targeting-001"
    item: "Geo-targeting structure clearly defined"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Document whether ccTLD, subdomain, subdirectory, or Search Console targeting is used"
    expected: "Confirmed by reviewer"

  - id: "geo-targeting-002"
    item: "Search Console geo-targeting configured for gTLD"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Check Search Console International Targeting for each property"
    expected: "Confirmed by reviewer"

  - id: "geo-targeting-003"
    item: "No inappropriate IP-based redirects for crawlers"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test crawler user agent with various geo headers"
    expected: "Confirmed by reviewer"

  - id: "geo-targeting-004"
    item: "CDN configured for target regions"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Verify edge locations cover target markets"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["marketing-site", "e-commerce", "saas"]

  compliance_frameworks:
    - framework: "Google Webmaster Guidelines"
      controls: ["International Sites"]

relationships:
  commonly_combined:
    - "seo-discoverability.international-seo.hreflang-implementation"
    - "seo-discoverability.international-seo.regional-content"
    - "seo-discoverability.international-seo.international-url-structure"
