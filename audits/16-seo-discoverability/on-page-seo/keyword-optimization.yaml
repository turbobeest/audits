# ============================================================
# AUDIT: Keyword Optimization Assessment
# ============================================================
# Evaluates keyword usage and placement across pages for
# effective search engine visibility without over-optimization.
# ============================================================

audit:
  id: "seo-discoverability.on-page-seo.keyword-optimization"

  name: "Keyword Optimization Assessment"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "on-page-seo"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit examines keyword usage and optimization across the website.
    It evaluates keyword placement in critical elements (title, H1, URL,
    first paragraph), keyword density (target 1-2%), semantic keyword
    variations (LSI keywords), keyword cannibalization between pages,
    and alignment between page content and target search queries.

  why_it_matters: |
    Proper keyword optimization helps search engines understand page
    relevance for specific queries. Under-optimization means missing
    ranking opportunities; over-optimization (keyword stuffing) can
    trigger spam penalties. Strategic keyword placement and natural
    integration maximize search visibility while maintaining content
    quality.

  when_to_run:
    - "When creating new content"
    - "During content optimization campaigns"
    - "When targeting new keywords"
    - "During competitive analysis"
    - "When rankings decline for target terms"

prerequisites:
  required_artifacts:
    - type: "website"
      description: "Live website with content pages"
    - type: "keyword_targets"
      description: "List of target keywords for key pages (optional)"
    - type: "crawl_data"
      description: "Site crawl with content extraction"

  access_requirements:
    - "Ability to crawl the website"
    - "Google Search Console for ranking data (optional)"
    - "Keyword research tool access (optional)"

discovery:
  code_patterns:
    - pattern: "<title>.*</title>"
      type: "regex"
      scope: "source"
      purpose: "Check keyword presence in titles"
    - pattern: "<h1[^>]*>.*</h1>"
      type: "regex"
      scope: "source"
      purpose: "Check keyword presence in H1"

  file_patterns:
    - glob: "**/*.html"
      purpose: "Analyze page content"
    - glob: "**/*.md"
      purpose: "Analyze markdown content"

knowledge_sources:
  guides:
    - id: "google-seo-starter"
      name: "Google: SEO Starter Guide - Keywords"
      url: "https://developers.google.com/search/docs/fundamentals/seo-starter-guide"
      offline_cache: true
    - id: "moz-keyword-research"
      name: "Moz: Keyword Research"
      url: "https://moz.com/learn/seo/what-is-keyword-research"
      offline_cache: true
    - id: "ahrefs-keyword-optimization"
      name: "Ahrefs: On-Page SEO - Keyword Optimization"
      url: "https://ahrefs.com/blog/on-page-seo/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Screaming Frog SEO Spider"
      purpose: "Extract content and analyze keyword presence"
      offline_capable: true
    - tool: "Surfer SEO"
      purpose: "Content optimization and keyword analysis"
      offline_capable: false
    - tool: "Clearscope"
      purpose: "Content optimization scoring"
      offline_capable: false

  infrastructure_tools:
    - tool: "Google Search Console"
      purpose: "Query performance and ranking data"
      command: "Performance report"
    - tool: "Ahrefs/Semrush"
      purpose: "Keyword ranking tracking"
      command: "Organic keywords report"

  scripts:
    - id: "keyword-density-checker"
      language: "bash"
      purpose: "Calculate keyword density on a page"
      source: "inline"
      code: |
        #!/bin/bash
        URL=$1
        KEYWORD=$2

        echo "=== Keyword Density for '$KEYWORD' on $URL ==="

        # Get page content (text only)
        CONTENT=$(curl -s "$URL" | sed 's/<[^>]*>//g' | tr -s ' \n' ' ')

        # Count words
        WORD_COUNT=$(echo "$CONTENT" | wc -w)

        # Count keyword occurrences (case insensitive)
        KEYWORD_COUNT=$(echo "$CONTENT" | grep -oi "$KEYWORD" | wc -l)

        # Calculate density
        if [ $WORD_COUNT -gt 0 ]; then
          DENSITY=$(echo "scale=2; ($KEYWORD_COUNT * 100) / $WORD_COUNT" | bc)
          echo "Total words: $WORD_COUNT"
          echo "Keyword occurrences: $KEYWORD_COUNT"
          echo "Keyword density: $DENSITY%"
        fi

signals:
  critical:
    - id: "KW-CRIT-001"
      signal: "Keyword cannibalization: multiple pages targeting same keyword"
      evidence_indicators:
        - "Multiple pages ranking for identical terms"
        - "Same primary keyword in multiple page titles"
      explanation: |
        When multiple pages target the same keyword, they compete
        against each other, diluting ranking signals and confusing
        search engines about which page to rank.
      remediation: "Consolidate content or differentiate keyword targets"

  high:
    - id: "KW-HIGH-001"
      signal: "Target keyword missing from critical elements"
      explanation: |
        If the primary keyword isn't in the title, H1, or URL, the page
        sends weak relevance signals for that term.
      remediation: "Include target keyword in title, H1, URL, and first paragraph"

    - id: "KW-HIGH-002"
      signal: "Keyword stuffing detected (density >3%)"
      explanation: |
        Excessive keyword repetition is a spam signal that can trigger
        penalties and hurts user experience.
      remediation: "Reduce keyword density to 1-2%, use natural variations"

    - id: "KW-HIGH-003"
      signal: "Page has no clear keyword focus"
      explanation: |
        Pages without a clear primary keyword target miss optimization
        opportunities and rank for fewer queries.
      remediation: "Define target keyword and optimize page elements"

  medium:
    - id: "KW-MED-001"
      signal: "Low keyword density (<0.5%)"
      remediation: "Naturally increase keyword usage in content"

    - id: "KW-MED-002"
      signal: "No semantic variations (LSI keywords) used"
      remediation: "Include related terms and synonyms throughout content"

    - id: "KW-MED-003"
      signal: "Keyword not in first 100 words"
      remediation: "Include target keyword in opening paragraph"

  low:
    - id: "KW-LOW-001"
      signal: "Keyword used in image alt text inconsistently"

    - id: "KW-LOW-002"
      signal: "Internal anchor text doesn't include keywords"

  positive:
    - id: "KW-POS-001"
      signal: "Optimal keyword placement in all critical elements"
    - id: "KW-POS-002"
      signal: "Good balance of exact and semantic keyword usage"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Target Keywords"
      description: |
        Determine the target keyword(s) for each key page, either
        from provided documentation or via content analysis.
      duration_estimate: "30 min"
      questions:
        - "What is the primary topic of each page?"
        - "What queries should this page rank for?"
        - "What keywords do competitors rank for?"
      expected_findings:
        - "Primary keyword per page"
        - "Secondary keywords"
        - "Keyword mapping"

    - id: "2"
      name: "Analyze Critical Element Placement"
      description: |
        Check whether target keywords appear in title, H1, URL,
        meta description, and first paragraph.
      duration_estimate: "30 min"
      commands:
        - purpose: "Extract page elements for keyword analysis"
          command: "Use Screaming Frog custom extraction"
      expected_findings:
        - "Keyword presence by element"
        - "Missing placements"
        - "Optimization opportunities"

    - id: "3"
      name: "Calculate Keyword Density"
      description: |
        Measure keyword density across content to ensure it falls
        within optimal range (1-2%) without over-optimization.
      duration_estimate: "30 min"
      expected_findings:
        - "Density by page"
        - "Over-optimized pages (>3%)"
        - "Under-optimized pages (<0.5%)"

    - id: "4"
      name: "Identify Keyword Cannibalization"
      description: |
        Find pages that compete for the same keywords, diluting
        ranking potential.
      duration_estimate: "30 min"
      expected_findings:
        - "Cannibalization instances"
        - "Competing pages"
        - "Consolidation opportunities"

    - id: "5"
      name: "Evaluate Semantic Coverage"
      description: |
        Assess use of related terms, synonyms, and LSI keywords
        that provide topical depth.
      duration_estimate: "30 min"
      expected_findings:
        - "Semantic keyword coverage"
        - "Topic modeling results"
        - "Content gap opportunities"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Keyword Optimization Overview"
        - "Placement Analysis"
        - "Cannibalization Report"
        - "Recommendations by Page"

  confidence_guidance:
    high: "Issues verified via ranking data and content analysis"
    medium: "Issues identified via automated content analysis"
    low: "Potential issues based on keyword research estimates"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "google-seo-starter"
        priority: "required"
      - source_id: "moz-keyword-research"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed keyword analysis"
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1

closeout_checklist:
  - id: "keyword-001"
    item: "Target keywords identified for key pages"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Document target keyword for each important page"
    expected: "Confirmed by reviewer"

  - id: "keyword-002"
    item: "Keywords present in title, H1, and URL"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify critical element placement for top pages"
    expected: "Confirmed by reviewer"

  - id: "keyword-003"
    item: "No keyword cannibalization issues"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Review keyword mapping for duplicate targets"
    expected: "Confirmed by reviewer"

  - id: "keyword-004"
    item: "Keyword density within 1-2% range"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Check density on sample pages"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["web-application", "marketing-site", "ecommerce", "content-site"]

  compliance_frameworks:
    - framework: "SEO Best Practices"
      controls: ["On-Page Optimization", "Content Strategy"]

relationships:
  commonly_combined:
    - "seo-discoverability.on-page-seo.title-tag"
    - "seo-discoverability.on-page-seo.content-quality"
    - "seo-discoverability.on-page-seo.heading-hierarchy"
