# ============================================================
# AUDIT: Local Schema
# ============================================================
# Evaluates structured data implementation for local business
# SEO optimization.

audit:
  id: "seo-discoverability.local-seo.local-schema"

  name: "Local Business Schema Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "local-seo"

  tier: "expert"
  estimated_duration: "1.5 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates structured data markup for local businesses,
    examining LocalBusiness schema (and its subtypes), PostalAddress,
    GeoCoordinates, OpeningHoursSpecification, and related schemas that
    help search engines understand business information for local search
    results and rich snippets.

  why_it_matters: |
    Structured data helps search engines understand and verify business
    information, potentially leading to enhanced search result displays
    (rich snippets) with hours, reviews, and location information. While
    not a direct ranking factor, proper schema markup supports local SEO
    by providing clear signals about business type, location, and services.

  when_to_run:
    - "When implementing or updating local SEO"
    - "After website redesigns"
    - "When troubleshooting local search visibility"
    - "During technical SEO audits"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "HTML source for schema analysis"
    - type: "canonical_nap"
      description: "Authoritative business information"

  access_requirements:
    - "Website source access"
    - "Google Rich Results Test access"

discovery:
  code_patterns:
    - pattern: "LocalBusiness|Restaurant|Store|Organization"
      type: "keyword"
      scope: "source"
      purpose: "Detect local business schema types"
    - pattern: "PostalAddress|address"
      type: "keyword"
      scope: "source"
      purpose: "Detect address schema"
    - pattern: "openingHours|OpeningHoursSpecification"
      type: "keyword"
      scope: "source"
      purpose: "Detect hours schema"
    - pattern: "geo|GeoCoordinates"
      type: "keyword"
      scope: "source"
      purpose: "Detect location schema"

  file_patterns:
    - glob: "**/*.html"
      purpose: "HTML files for schema analysis"
    - glob: "**/contact*"
      purpose: "Contact pages for local schema"
    - glob: "**/locations*"
      purpose: "Location pages for multi-location schema"

knowledge_sources:
  specifications:
    - id: "schema-localbusiness"
      name: "Schema.org LocalBusiness"
      url: "https://schema.org/LocalBusiness"
      offline_cache: true
      priority: "required"
    - id: "google-local-structured"
      name: "Google Local Business Structured Data"
      url: "https://developers.google.com/search/docs/appearance/structured-data/local-business"
      offline_cache: true
      priority: "required"

  guides:
    - id: "local-schema-guide"
      name: "Local Business Schema Guide"
      url: "https://moz.com/blog/local-business-schema"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Google Rich Results Test"
      purpose: "Validate structured data"
      offline_capable: false
    - tool: "Schema Markup Validator"
      purpose: "Validate schema.org markup"
      offline_capable: false

  infrastructure_tools:
    - tool: "Schema.org Validator"
      purpose: "Validate schema syntax"
      command: "Open validator at validator.schema.org"

  scripts:
    - id: "schema-extractor"
      language: "bash"
      purpose: "Extract JSON-LD schema from page"
      source: "inline"
      code: |
        #!/bin/bash
        curl -s $URL | \
        grep -oE '<script type="application/ld\+json">[^<]*</script>' | \
        sed 's/<[^>]*>//g' | \
        jq '.' 2>/dev/null || echo "No valid JSON-LD found"

signals:
  critical:
    - id: "SEO-LSCH-CRIT-001"
      signal: "No LocalBusiness schema implemented"
      evidence_pattern: "No LocalBusiness or subtype schema on location/contact pages"
      explanation: |
        Without LocalBusiness schema, the site misses opportunities for
        enhanced search displays and clear local business signals to
        search engines.
      remediation: "Implement LocalBusiness schema with full NAP and business details"
    - id: "SEO-LSCH-CRIT-002"
      signal: "Schema NAP doesn't match visible NAP"
      evidence_pattern: "Schema data differs from page content"
      explanation: |
        Schema that contradicts visible page content can be seen as
        deceptive and may be ignored by search engines or flag quality issues.
      remediation: "Ensure schema exactly matches visible NAP and business info"

  high:
    - id: "SEO-LSCH-HIGH-001"
      signal: "Missing required schema properties"
      explanation: |
        LocalBusiness schema should include name, address, phone, url,
        and ideally geo coordinates and opening hours for full functionality.
      remediation: "Add all recommended LocalBusiness properties"
    - id: "SEO-LSCH-HIGH-002"
      signal: "Wrong LocalBusiness subtype"
      explanation: |
        Using generic LocalBusiness instead of specific subtypes
        (Restaurant, Store, etc.) reduces schema precision.
      remediation: "Use most specific applicable LocalBusiness subtype"

  medium:
    - id: "SEO-LSCH-MED-001"
      signal: "Opening hours not in schema"
      remediation: "Add OpeningHoursSpecification for business hours"
    - id: "SEO-LSCH-MED-002"
      signal: "Geo coordinates not included"
      remediation: "Add GeoCoordinates with accurate latitude/longitude"

  low:
    - id: "SEO-LSCH-LOW-001"
      signal: "priceRange not specified"

  positive:
    - id: "SEO-LSCH-POS-001"
      signal: "Complete LocalBusiness schema with all recommended properties"
    - id: "SEO-LSCH-POS-002"
      signal: "Schema validates without errors in Google Rich Results Test"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Schema Detection"
      description: |
        Identify what structured data schemas are currently
        implemented on location/contact pages.
      duration_estimate: "15 min"

      commands:
        - purpose: "Extract JSON-LD from page"
          command: "curl -s $URL | grep -oE '<script type=\"application/ld\\+json\">[^<]*</script>' | head -5"

      expected_findings:
        - "Schema types present"
        - "Implementation method (JSON-LD, Microdata)"

    - id: "2"
      name: "LocalBusiness Schema Validation"
      description: |
        Validate LocalBusiness schema against schema.org spec
        and Google requirements.
      duration_estimate: "20 min"

      commands:
        - purpose: "Test with Google Rich Results"
          command: "Open https://search.google.com/test/rich-results"

      expected_findings:
        - "Validation results"
        - "Errors and warnings"

    - id: "3"
      name: "Property Completeness Check"
      description: |
        Verify all recommended properties are included in
        the LocalBusiness schema.
      duration_estimate: "20 min"

      questions:
        - "Is @type specified (LocalBusiness or subtype)?"
        - "Is name included?"
        - "Is address (PostalAddress) complete?"
        - "Is telephone included?"
        - "Is url included?"
        - "Is geo (GeoCoordinates) included?"
        - "Is openingHoursSpecification included?"
        - "Is priceRange included (if applicable)?"

      expected_findings:
        - "Property coverage"
        - "Missing properties"

    - id: "4"
      name: "NAP Consistency Verification"
      description: |
        Compare schema NAP with visible page NAP and
        canonical business information.
      duration_estimate: "15 min"

      questions:
        - "Does schema name match visible business name?"
        - "Does schema address match visible address?"
        - "Does schema phone match visible phone?"

      expected_findings:
        - "NAP alignment status"
        - "Discrepancies identified"

    - id: "5"
      name: "Multi-Location Schema Check"
      description: |
        For multi-location businesses, verify each location
        has unique, accurate schema.
      duration_estimate: "20 min"

      questions:
        - "Does each location have its own schema?"
        - "Are location pages linked properly?"
        - "Is there an Organization schema for the parent company?"

      expected_findings:
        - "Multi-location implementation status"
        - "Per-location accuracy"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Schema Implementation Status"
        - "Validation Results"
        - "Property Coverage"
        - "Implementation Recommendations"

  confidence_guidance:
    high: "Google Rich Results Test validation with manual verification"
    medium: "Manual schema extraction and review"
    low: "Presence check only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "schema-localbusiness"
        priority: "required"
      - source_id: "google-local-structured"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed schema validation"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "local-schema-001"
    item: "LocalBusiness schema implemented"
    level: "CRITICAL"
    verification: "curl -s URL | grep -c 'LocalBusiness'"
    expected: ">= 1"

  - id: "local-schema-002"
    item: "Schema validates in Google Rich Results Test"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Run Google Rich Results Test"
    expected: "No errors"

  - id: "local-schema-003"
    item: "Schema NAP matches visible NAP"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Compare schema values to page content"
    expected: "100% match"

  - id: "local-schema-004"
    item: "Opening hours included in schema"
    level: "WARNING"
    verification: "curl -s URL | grep -c 'openingHours'"
    expected: ">= 1"

governance:
  applicable_to:
    archetypes: ["local-business", "retail", "restaurant", "service-business"]

  compliance_frameworks:
    - framework: "Schema.org"
      controls: ["LocalBusiness"]

relationships:
  commonly_combined:
    - "seo-discoverability.local-seo.nap-consistency"
    - "seo-discoverability.local-seo.google-business-profile"
    - "seo-discoverability.schema.organization"
