# ============================================================
# AUDIT: Mobile Friendliness
# ============================================================
# Evaluates website mobile-friendliness for search engine optimization
# and user experience on mobile devices.

audit:
  id: "seo-discoverability.mobile-seo.mobile-friendliness"

  name: "Mobile Friendliness Assessment"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "mobile-seo"

  tier: "expert"
  estimated_duration: "2 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates website mobile-friendliness by examining responsive
    design implementation, touch target sizing, font legibility, viewport
    configuration, and mobile-specific rendering. It assesses compliance
    with Google's mobile-first indexing requirements and Core Web Vitals
    metrics on mobile devices.

  why_it_matters: |
    Google uses mobile-first indexing, meaning the mobile version of content
    is used for indexing and ranking. Sites that are not mobile-friendly face
    significant ranking penalties. With over 60% of searches occurring on
    mobile devices, poor mobile experience directly impacts traffic, engagement,
    and conversion rates. Mobile-unfriendly sites see higher bounce rates
    and lower time-on-site metrics.

  when_to_run:
    - "Before launching any new website or major redesign"
    - "When mobile traffic or rankings decline"
    - "After implementing responsive design changes"
    - "Quarterly mobile SEO audits"

prerequisites:
  required_artifacts:
    - type: "deployed_website"
      description: "Live website accessible via URL for mobile testing"
    - type: "source_code"
      description: "HTML/CSS source code for structural analysis"

  access_requirements:
    - "Access to website URLs for mobile testing"
    - "Google Search Console access for mobile usability reports"
    - "Source code repository access"

discovery:
  code_patterns:
    - pattern: "<meta\\s+name=[\"']viewport[\"']"
      type: "regex"
      scope: "source"
      purpose: "Detect viewport meta tag configuration"
    - pattern: "@media\\s*\\([^)]*max-width|min-width"
      type: "regex"
      scope: "source"
      purpose: "Identify responsive media queries"
    - pattern: "user-scalable\\s*=\\s*[\"']?no"
      type: "regex"
      scope: "source"
      purpose: "Detect disabled zoom (accessibility issue)"
    - pattern: "position:\\s*fixed"
      type: "regex"
      scope: "source"
      purpose: "Find fixed positioning that may cause mobile issues"

  file_patterns:
    - glob: "**/*.html"
      purpose: "HTML files for viewport and structure analysis"
    - glob: "**/*.css"
      purpose: "CSS files for responsive design patterns"
    - glob: "**/manifest.json"
      purpose: "Web app manifest for mobile configuration"

knowledge_sources:
  specifications:
    - id: "google-mobile-first"
      name: "Google Mobile-First Indexing Best Practices"
      url: "https://developers.google.com/search/docs/crawling-indexing/mobile/mobile-sites-mobile-first-indexing"
      offline_cache: true
      priority: "required"
    - id: "google-mobile-usability"
      name: "Google Mobile Usability Report"
      url: "https://support.google.com/webmasters/answer/9063469"
      offline_cache: true
      priority: "required"

  guides:
    - id: "wcag-mobile"
      name: "WCAG Mobile Accessibility Guidelines"
      url: "https://www.w3.org/WAI/standards-guidelines/mobile/"
      offline_cache: true
    - id: "web-dev-responsive"
      name: "web.dev Responsive Design Guide"
      url: "https://web.dev/responsive-web-design-basics/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Lighthouse"
      purpose: "Audit mobile performance and best practices"
      offline_capable: false
    - tool: "Google Mobile-Friendly Test"
      purpose: "Official Google mobile-friendliness assessment"
      offline_capable: false

  infrastructure_tools:
    - tool: "Chrome DevTools"
      purpose: "Mobile device simulation and debugging"
      command: "chrome --remote-debugging-port=9222"

  scripts:
    - id: "mobile-meta-check"
      language: "bash"
      purpose: "Check for proper viewport meta tag"
      source: "inline"
      code: |
        #!/bin/bash
        # Check HTML files for viewport meta tag
        find . -name "*.html" -exec grep -l "viewport" {} \;

signals:
  critical:
    - id: "SEO-MOBILE-CRIT-001"
      signal: "Missing or malformed viewport meta tag"
      evidence_pattern: "No <meta name=\"viewport\"> found in HTML head"
      explanation: |
        Without a proper viewport meta tag, mobile browsers render pages
        at desktop width and scale down, making content unreadable without
        zooming. This is a primary mobile-friendliness failure signal.
      remediation: "Add <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">"
    - id: "SEO-MOBILE-CRIT-002"
      signal: "Content wider than screen causes horizontal scrolling"
      evidence_pattern: "Elements with fixed widths exceeding 100vw"
      explanation: |
        Horizontal scrolling is a critical mobile usability issue that
        Google penalizes. It indicates the page is not properly responsive.
      remediation: "Use relative widths (%, vw) and max-width instead of fixed pixel widths"

  high:
    - id: "SEO-MOBILE-HIGH-001"
      signal: "Text too small to read on mobile without zooming"
      explanation: |
        Font sizes below 12px are difficult to read on mobile devices.
        Google recommends a base font size of 16px for body text.
      remediation: "Set base font size to 16px minimum for body text"
    - id: "SEO-MOBILE-HIGH-002"
      signal: "Touch targets too small or too close together"
      explanation: |
        Touch targets should be at least 48x48 CSS pixels with adequate
        spacing. Small targets cause frustration and mis-taps.
      remediation: "Ensure all interactive elements are at least 48x48px with 8px spacing"

  medium:
    - id: "SEO-MOBILE-MED-001"
      signal: "Zoom disabled via user-scalable=no"
      remediation: "Remove user-scalable=no to allow accessibility zoom"
    - id: "SEO-MOBILE-MED-002"
      signal: "Intrusive interstitials blocking mobile content"
      remediation: "Remove or delay pop-ups that cover main content on mobile"

  low:
    - id: "SEO-MOBILE-LOW-001"
      signal: "Mobile tap highlight not customized"

  positive:
    - id: "SEO-MOBILE-POS-001"
      signal: "Proper responsive breakpoints implemented across all device sizes"
    - id: "SEO-MOBILE-POS-002"
      signal: "Mobile-specific optimizations detected (lazy loading, adaptive images)"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Viewport Configuration Check"
      description: |
        Examine all HTML files for proper viewport meta tag configuration.
        Verify the viewport allows initial scaling and doesn't disable zoom.
      duration_estimate: "15 min"

      commands:
        - purpose: "Find viewport meta tags"
          command: "grep -r 'viewport' --include='*.html' ."
        - purpose: "Check for zoom-blocking"
          command: "grep -r 'user-scalable' --include='*.html' ."

      expected_findings:
        - "Presence and correctness of viewport meta tags"
        - "Any accessibility-blocking zoom restrictions"

    - id: "2"
      name: "Responsive Design Analysis"
      description: |
        Analyze CSS for media queries and responsive patterns.
        Identify fixed-width elements that may cause layout issues.
      duration_estimate: "30 min"

      commands:
        - purpose: "Find media queries"
          command: "grep -r '@media' --include='*.css' . | head -50"
        - purpose: "Find fixed widths"
          command: "grep -rE 'width:\\s*[0-9]+px' --include='*.css' ."

      expected_findings:
        - "Responsive breakpoint coverage"
        - "Fixed-width elements requiring remediation"

    - id: "3"
      name: "Mobile Rendering Test"
      description: |
        Use Google Mobile-Friendly Test and Lighthouse to verify
        mobile rendering and identify specific issues.
      duration_estimate: "30 min"

      commands:
        - purpose: "Run Lighthouse mobile audit"
          command: "lighthouse --preset=mobile --output=json URL"

      expected_findings:
        - "Mobile-friendliness pass/fail status"
        - "Specific rendering issues identified"

    - id: "4"
      name: "Touch Target Analysis"
      description: |
        Identify all interactive elements and verify they meet
        minimum touch target size requirements (48x48px).
      duration_estimate: "25 min"

      commands:
        - purpose: "Find button and link elements"
          command: "grep -rE '<(button|a|input)' --include='*.html' ."

      expected_findings:
        - "Interactive elements meeting size requirements"
        - "Elements requiring size adjustments"

    - id: "5"
      name: "Search Console Review"
      description: |
        Review Google Search Console Mobile Usability report for
        any flagged issues on indexed pages.
      duration_estimate: "20 min"

      questions:
        - "Are there any mobile usability issues flagged in Search Console?"
        - "Which pages have the most mobile issues?"
        - "What is the trend of mobile usability over time?"

      expected_findings:
        - "Google-identified mobile usability issues"
        - "Pages requiring priority remediation"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Mobile-Friendliness Score"
        - "Critical Issues"
        - "Recommendations"
        - "Implementation Priority"

  confidence_guidance:
    high: "Google Mobile-Friendly Test pass/fail, Lighthouse scores"
    medium: "Manual responsive testing across multiple devices"
    low: "Inference from code patterns without rendering verification"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "google-mobile-first"
        priority: "required"
      - source_id: "wcag-mobile"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: true
      reason: "Mobile-friendliness is critical for modern SEO"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "mobile-friendliness-001"
    item: "Viewport meta tag present and correct"
    level: "CRITICAL"
    verification: "grep -q 'viewport' index.html && echo PASS || echo FAIL"
    expected: "PASS"

  - id: "mobile-friendliness-002"
    item: "Google Mobile-Friendly Test passes"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Run Google Mobile-Friendly Test on primary URLs"
    expected: "Confirmed by reviewer"

  - id: "mobile-friendliness-003"
    item: "No horizontal scrolling on mobile viewport"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test on 320px, 375px, and 414px viewport widths"
    expected: "Confirmed by reviewer"

  - id: "mobile-friendliness-004"
    item: "Touch targets meet minimum size requirements"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Verify interactive elements are at least 48x48px"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["web-application", "marketing-site", "e-commerce"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["1.4.4", "2.5.5"]

relationships:
  commonly_combined:
    - "seo-discoverability.mobile-seo.responsive-design"
    - "seo-discoverability.mobile-seo.mobile-page-speed"
    - "seo-discoverability.mobile-seo.viewport-configuration"
