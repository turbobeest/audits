# ============================================================
# AUDIT: Touch Element Sizing
# ============================================================
# Evaluates touch target sizes and spacing for mobile usability
# and accessibility compliance.

audit:
  id: "seo-discoverability.mobile-seo.touch-element-sizing"

  name: "Touch Element Sizing Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "mobile-seo"

  tier: "expert"
  estimated_duration: "1.5 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates touch target sizing and spacing for interactive
    elements on mobile devices. It examines buttons, links, form inputs,
    and other tappable elements to ensure they meet minimum size requirements
    (48x48 CSS pixels) and have adequate spacing to prevent mis-taps.
    The audit covers both visual design and CSS implementation.

  why_it_matters: |
    Google flags tap targets that are too small as mobile usability errors
    in Search Console, which can impact mobile search rankings. Small touch
    targets cause user frustration, accidental taps, and accessibility issues
    for users with motor impairments. Proper touch target sizing is essential
    for mobile usability, accessibility compliance (WCAG), and SEO health.

  when_to_run:
    - "During mobile UI design and development"
    - "When Google Search Console reports tap target issues"
    - "During accessibility audits"
    - "When mobile conversion rates are low"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "HTML/CSS source for element size analysis"
    - type: "deployed_website"
      description: "Live site for visual touch target testing"

  access_requirements:
    - "Source code repository access"
    - "Mobile device or emulator for testing"
    - "Google Search Console for mobile usability reports"

discovery:
  code_patterns:
    - pattern: "<button[^>]*>"
      type: "regex"
      scope: "source"
      purpose: "Identify button elements"
    - pattern: "<a[^>]*href[^>]*>"
      type: "regex"
      scope: "source"
      purpose: "Identify link elements"
    - pattern: "<input[^>]*type=[\"'](button|submit|checkbox|radio)[\"'][^>]*>"
      type: "regex"
      scope: "source"
      purpose: "Identify form input elements"
    - pattern: "min-(width|height):\\s*[0-9]+px"
      type: "regex"
      scope: "source"
      purpose: "Detect minimum size constraints"
    - pattern: "padding:\\s*[0-9]+"
      type: "regex"
      scope: "source"
      purpose: "Identify padding that affects touch target size"

  file_patterns:
    - glob: "**/*.html"
      purpose: "HTML files for interactive element analysis"
    - glob: "**/*.css"
      purpose: "CSS files for sizing rule analysis"
    - glob: "**/components/**/*.{jsx,tsx,vue}"
      purpose: "Component files for button/link analysis"

knowledge_sources:
  specifications:
    - id: "wcag-target-size"
      name: "WCAG 2.2 Target Size Guidelines"
      url: "https://www.w3.org/WAI/WCAG22/Understanding/target-size-minimum.html"
      offline_cache: true
      priority: "required"
    - id: "material-touch"
      name: "Material Design Touch Targets"
      url: "https://material.io/design/usability/accessibility.html#layout-and-typography"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "google-tap-targets"
      name: "Google Tap Target Size Documentation"
      url: "https://developers.google.com/search/docs/appearance/google-discover#mobile-friendly"
      offline_cache: true
    - id: "apple-hig"
      name: "Apple Human Interface Guidelines - Touch"
      url: "https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/adaptivity-and-layout/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Lighthouse"
      purpose: "Detect tap targets too small/close together"
      offline_capable: false
    - tool: "axe-core"
      purpose: "Accessibility audit including target size"
      offline_capable: true

  infrastructure_tools:
    - tool: "Chrome DevTools"
      purpose: "Inspect element dimensions"
      command: "getComputedStyle(element).width/height"

  scripts:
    - id: "touch-target-check"
      language: "javascript"
      purpose: "Analyze touch target sizes on page"
      source: "inline"
      code: |
        // Run in browser console
        document.querySelectorAll('a, button, input, [role="button"]').forEach(el => {
          const rect = el.getBoundingClientRect();
          if (rect.width < 48 || rect.height < 48) {
            console.warn('Small touch target:', el, rect.width, rect.height);
          }
        });

signals:
  critical:
    - id: "SEO-TOUCH-CRIT-001"
      signal: "Touch targets smaller than 24x24 CSS pixels"
      evidence_pattern: "Interactive elements with computed size < 24px"
      explanation: |
        Touch targets under 24px are extremely difficult to tap accurately
        and represent a severe usability and accessibility failure. WCAG 2.2
        sets 24x24px as the absolute minimum (Level AA).
      remediation: "Increase element size to minimum 44x44px (recommended 48x48px)"
    - id: "SEO-TOUCH-CRIT-002"
      signal: "Multiple small touch targets without spacing"
      evidence_pattern: "Clustered small targets with < 8px spacing"
      explanation: |
        Small targets grouped closely together multiply mis-tap risk.
        Users frequently tap the wrong element, causing frustration.
      remediation: "Increase target sizes and add minimum 8px spacing between targets"

  high:
    - id: "SEO-TOUCH-HIGH-001"
      signal: "Touch targets between 24-44 CSS pixels"
      explanation: |
        While meeting minimum WCAG requirements, targets under 44px
        remain difficult for many users. Google recommends 48x48px.
      remediation: "Increase to 48x48px for optimal usability"
    - id: "SEO-TOUCH-HIGH-002"
      signal: "Inline text links as only tap targets"
      explanation: |
        Inline text links in paragraphs are difficult to tap on mobile.
        They should have sufficient padding or be converted to buttons.
      remediation: "Add padding to inline links or use button styling"

  medium:
    - id: "SEO-TOUCH-MED-001"
      signal: "Form checkboxes/radios with small hit areas"
      remediation: "Extend clickable area to include label text"
    - id: "SEO-TOUCH-MED-002"
      signal: "Icon buttons without sufficient padding"
      remediation: "Add padding around icons to increase touch area"

  low:
    - id: "SEO-TOUCH-LOW-001"
      signal: "Touch targets not visually indicating tap area"

  positive:
    - id: "SEO-TOUCH-POS-001"
      signal: "All touch targets meet 48x48px minimum"
    - id: "SEO-TOUCH-POS-002"
      signal: "Consistent touch target sizing throughout UI"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Interactive Element Inventory"
      description: |
        Catalog all interactive elements (buttons, links, form controls)
        across the site templates and components.
      duration_estimate: "20 min"

      commands:
        - purpose: "Find button elements"
          command: "grep -rc '<button' --include='*.html' --include='*.jsx' --include='*.tsx' . | grep -v ':0$'"
        - purpose: "Find link elements"
          command: "grep -rc '<a[^>]*href' --include='*.html' --include='*.jsx' --include='*.tsx' . | grep -v ':0$'"

      expected_findings:
        - "Inventory of interactive elements"
        - "Files with highest concentration of touch targets"

    - id: "2"
      name: "CSS Size Analysis"
      description: |
        Analyze CSS rules for minimum width/height constraints
        and padding on interactive elements.
      duration_estimate: "25 min"

      commands:
        - purpose: "Find button size rules"
          command: "grep -A5 'button' --include='*.css' . | grep -E 'width|height|padding|min-'"
        - purpose: "Find link styling"
          command: "grep -A5 '^a[^a-z]\\|^a$' --include='*.css' . | head -30"

      expected_findings:
        - "Minimum size constraints defined"
        - "Padding values on interactive elements"

    - id: "3"
      name: "Lighthouse Touch Target Audit"
      description: |
        Run Lighthouse audit to identify tap targets flagged
        as too small or too close together.
      duration_estimate: "15 min"

      commands:
        - purpose: "Run Lighthouse SEO audit"
          command: "lighthouse --only-audits=tap-targets --output=json URL"

      expected_findings:
        - "Specific elements flagged by Lighthouse"
        - "Percentage of touch targets passing"

    - id: "4"
      name: "Manual Touch Target Testing"
      description: |
        Test on actual mobile device or emulator to verify
        touch targets are usable in practice.
      duration_estimate: "20 min"

      questions:
        - "Can all buttons be tapped easily without zooming?"
        - "Are navigation links easily tappable?"
        - "Can form checkboxes/radios be selected accurately?"
        - "Is there adequate spacing between adjacent targets?"

      expected_findings:
        - "Real-world usability assessment"
        - "Specific elements requiring remediation"

    - id: "5"
      name: "Search Console Review"
      description: |
        Review Google Search Console mobile usability report
        for tap target issues flagged on indexed pages.
      duration_estimate: "10 min"

      questions:
        - "Are any pages flagged for tap target issues?"
        - "What is the trend of tap target issues over time?"

      expected_findings:
        - "Pages with Google-flagged tap target issues"
        - "Issue resolution tracking"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Touch Target Analysis"
        - "Elements Requiring Remediation"
        - "CSS Recommendations"
        - "Accessibility Impact"

  confidence_guidance:
    high: "Lighthouse audit results and manual device testing"
    medium: "CSS analysis with limited runtime verification"
    low: "Code pattern analysis only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag-target-size"
        priority: "required"
      - source_id: "material-touch"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires runtime testing for accuracy"
    full:
      included: true
      priority: 3

closeout_checklist:
  - id: "touch-element-sizing-001"
    item: "All touch targets >= 44x44 CSS pixels"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify using Chrome DevTools element inspection"
    expected: "Confirmed by reviewer"

  - id: "touch-element-sizing-002"
    item: "Lighthouse tap targets audit passes"
    level: "CRITICAL"
    verification: "lighthouse --only-audits=tap-targets --output=json URL | jq '.audits[\"tap-targets\"].score'"
    expected: "1"

  - id: "touch-element-sizing-003"
    item: "Adequate spacing (>= 8px) between touch targets"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Visually inspect spacing on mobile viewport"
    expected: "Confirmed by reviewer"

  - id: "touch-element-sizing-004"
    item: "No Search Console tap target issues"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Check Google Search Console Mobile Usability report"
    expected: "0 tap target issues"

governance:
  applicable_to:
    archetypes: ["web-application", "marketing-site", "e-commerce"]

  compliance_frameworks:
    - framework: "WCAG 2.2"
      controls: ["2.5.5", "2.5.8"]

relationships:
  commonly_combined:
    - "seo-discoverability.mobile-seo.mobile-friendliness"
    - "accessibility.interaction.touch-targets"
    - "ux.mobile.tap-accuracy"
