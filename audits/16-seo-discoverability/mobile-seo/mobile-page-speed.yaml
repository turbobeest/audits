# ============================================================
# AUDIT: Mobile Page Speed
# ============================================================
# Evaluates page load performance specifically on mobile devices
# and networks for SEO and user experience optimization.

audit:
  id: "seo-discoverability.mobile-seo.mobile-page-speed"

  name: "Mobile Page Speed Optimization Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "seo-discoverability"
  category_number: 16
  subcategory: "mobile-seo"

  tier: "expert"
  estimated_duration: "2.5 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "runtime"

  default_profiles:
    - "full"
    - "production"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates mobile page speed performance including Core Web
    Vitals (LCP, FID/INP, CLS), Time to First Byte (TTFB), First Contentful
    Paint (FCP), and mobile-specific optimizations. It analyzes render-blocking
    resources, JavaScript execution, image optimization, and caching strategies
    from a mobile perspective with constrained CPU and network conditions.

  why_it_matters: |
    Page speed is a direct Google ranking factor, with mobile speed being
    particularly critical since the mobile-first indexing update. Google's
    Core Web Vitals are now part of the Page Experience signal that affects
    rankings. Slow mobile pages have significantly higher bounce rates -
    53% of mobile users abandon sites that take over 3 seconds to load.
    Mobile page speed directly impacts conversions, engagement, and revenue.

  when_to_run:
    - "Before and after major deployments"
    - "When Core Web Vitals scores decline"
    - "When mobile bounce rates increase"
    - "Monthly performance monitoring"

prerequisites:
  required_artifacts:
    - type: "deployed_website"
      description: "Production or staging site for performance testing"
    - type: "source_code"
      description: "Frontend source for optimization analysis"

  access_requirements:
    - "URL access to pages for Lighthouse testing"
    - "Google Search Console for field data"
    - "Chrome User Experience Report (CrUX) data access"

discovery:
  code_patterns:
    - pattern: "<script(?![^>]*defer|async)[^>]*>"
      type: "regex"
      scope: "source"
      purpose: "Detect render-blocking scripts"
    - pattern: "<link[^>]*rel=[\"']stylesheet[\"'][^>]*>"
      type: "regex"
      scope: "source"
      purpose: "Detect render-blocking stylesheets"
    - pattern: "loading=[\"']lazy[\"']"
      type: "regex"
      scope: "source"
      purpose: "Identify lazy-loaded resources"
    - pattern: "preload|prefetch|preconnect"
      type: "regex"
      scope: "source"
      purpose: "Detect resource hints"

  file_patterns:
    - glob: "**/*.html"
      purpose: "HTML files for resource loading analysis"
    - glob: "**/*.js"
      purpose: "JavaScript files for bundle analysis"
    - glob: "**/webpack.config.*"
      purpose: "Build configuration for optimization settings"
    - glob: "**/next.config.*"
      purpose: "Next.js configuration for performance settings"

knowledge_sources:
  specifications:
    - id: "core-web-vitals"
      name: "Google Core Web Vitals"
      url: "https://web.dev/vitals/"
      offline_cache: true
      priority: "required"
    - id: "lighthouse-scoring"
      name: "Lighthouse Performance Scoring"
      url: "https://developer.chrome.com/docs/lighthouse/performance/performance-scoring/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "web-dev-speed"
      name: "web.dev Performance Guide"
      url: "https://web.dev/fast/"
      offline_cache: true
    - id: "mobile-speed-checklist"
      name: "Mobile Page Speed Optimization Checklist"
      url: "https://developers.google.com/speed/docs/insights/mobile"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Lighthouse CI"
      purpose: "Automated performance auditing"
      offline_capable: false
    - tool: "WebPageTest"
      purpose: "Detailed waterfall analysis"
      offline_capable: false

  infrastructure_tools:
    - tool: "Lighthouse"
      purpose: "Run mobile performance audit"
      command: "lighthouse --preset=mobile --only-categories=performance URL"
    - tool: "PageSpeed Insights API"
      purpose: "Get field and lab data"
      command: "curl 'https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=URL&strategy=mobile'"

  scripts:
    - id: "render-blocking-check"
      language: "bash"
      purpose: "Find render-blocking resources"
      source: "inline"
      code: |
        #!/bin/bash
        # Find scripts without defer/async
        grep -rE '<script[^>]*src=' --include='*.html' . | \
        grep -v -E 'defer|async'

signals:
  critical:
    - id: "SEO-MSPD-CRIT-001"
      signal: "Largest Contentful Paint (LCP) over 4 seconds"
      evidence_threshold: "LCP > 4000ms"
      explanation: |
        LCP over 4 seconds is rated "poor" by Google and directly impacts
        rankings. This indicates the main content takes too long to appear,
        severely degrading user experience on mobile.
      remediation: "Optimize LCP element loading through preload, image optimization, and server response time"
    - id: "SEO-MSPD-CRIT-002"
      signal: "Mobile performance score below 50"
      evidence_threshold: "Lighthouse mobile performance < 50"
      explanation: |
        A Lighthouse performance score below 50 indicates severe performance
        issues that will impact both rankings and user experience.
      remediation: "Address all critical Lighthouse recommendations for performance"

  high:
    - id: "SEO-MSPD-HIGH-001"
      signal: "Cumulative Layout Shift (CLS) over 0.25"
      explanation: |
        CLS over 0.25 is rated "poor" and indicates significant visual
        instability during page load, frustrating users and harming SEO.
      remediation: "Set explicit dimensions on images and embeds, avoid inserting content above existing content"
    - id: "SEO-MSPD-HIGH-002"
      signal: "Multiple render-blocking resources"
      explanation: |
        Render-blocking CSS and JavaScript delay First Contentful Paint
        and overall page load, particularly impactful on slow mobile networks.
      remediation: "Defer non-critical JS, inline critical CSS, use async loading"

  medium:
    - id: "SEO-MSPD-MED-001"
      signal: "Unoptimized images on mobile"
      remediation: "Use WebP/AVIF formats, responsive images, and lazy loading"
    - id: "SEO-MSPD-MED-002"
      signal: "No resource hints for critical third-party origins"
      remediation: "Add preconnect/dns-prefetch for critical third-party domains"

  low:
    - id: "SEO-MSPD-LOW-001"
      signal: "Third-party scripts impact performance"

  positive:
    - id: "SEO-MSPD-POS-001"
      signal: "Core Web Vitals all in 'Good' range"
    - id: "SEO-MSPD-POS-002"
      signal: "Effective caching and compression implemented"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Core Web Vitals Assessment"
      description: |
        Run Lighthouse mobile audit and analyze Core Web Vitals
        scores (LCP, INP/FID, CLS) against Google's thresholds.
      duration_estimate: "30 min"

      commands:
        - purpose: "Run Lighthouse mobile performance audit"
          command: "lighthouse --preset=mobile --only-categories=performance --output=json URL"
        - purpose: "Get field data from PageSpeed Insights"
          command: "curl -s 'https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=URL&strategy=mobile'"

      expected_findings:
        - "Core Web Vitals scores and ratings"
        - "Lab vs field data comparison"

    - id: "2"
      name: "Render-Blocking Resource Analysis"
      description: |
        Identify all render-blocking CSS and JavaScript that delays
        initial page render on mobile devices.
      duration_estimate: "25 min"

      commands:
        - purpose: "Find non-async/defer scripts"
          command: "grep -rE '<script[^>]*src=' --include='*.html' . | grep -v -E 'defer|async'"
        - purpose: "Find blocking stylesheets"
          command: "grep -r '<link[^>]*stylesheet' --include='*.html' . | grep -v media="

      expected_findings:
        - "List of render-blocking resources"
        - "Optimization opportunities"

    - id: "3"
      name: "Image Optimization Audit"
      description: |
        Analyze image formats, sizes, and loading strategies
        for mobile optimization.
      duration_estimate: "30 min"

      commands:
        - purpose: "Find large images"
          command: "find . -type f \\( -name '*.jpg' -o -name '*.png' \\) -size +100k"
        - purpose: "Check for modern formats"
          command: "find . -type f \\( -name '*.webp' -o -name '*.avif' \\)"
        - purpose: "Check lazy loading"
          command: "grep -r 'loading=\"lazy\"' --include='*.html' . | wc -l"

      expected_findings:
        - "Image format and size issues"
        - "Lazy loading implementation status"

    - id: "4"
      name: "JavaScript Bundle Analysis"
      description: |
        Analyze JavaScript bundle sizes and identify code splitting
        and tree-shaking opportunities.
      duration_estimate: "25 min"

      commands:
        - purpose: "Find JS bundle sizes"
          command: "find . -name '*.js' -type f -exec ls -lh {} \\; | sort -k5 -h | tail -20"
        - purpose: "Check for source maps"
          command: "find . -name '*.js.map' | head -10"

      expected_findings:
        - "Bundle size assessment"
        - "Code splitting opportunities"

    - id: "5"
      name: "Caching and Compression Review"
      description: |
        Verify proper caching headers and compression are
        configured for optimal mobile performance.
      duration_estimate: "20 min"

      commands:
        - purpose: "Check response headers"
          command: "curl -sI URL | grep -iE 'cache-control|content-encoding|vary'"

      expected_findings:
        - "Caching policy assessment"
        - "Compression status"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Core Web Vitals Report"
        - "Performance Bottlenecks"
        - "Optimization Recommendations"
        - "Expected Impact"

  confidence_guidance:
    high: "Lighthouse scores and field data from CrUX"
    medium: "Lab data only without field validation"
    low: "Code analysis without performance testing"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "core-web-vitals"
        priority: "required"
      - source_id: "lighthouse-scoring"
        priority: "required"

profiles:
  membership:
    quick:
      included: true
      reason: "Page speed is critical for SEO and user experience"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "mobile-page-speed-001"
    item: "Lighthouse mobile performance score >= 75"
    level: "CRITICAL"
    verification: "lighthouse --preset=mobile --only-categories=performance --output=json URL | jq '.categories.performance.score * 100'"
    expected: ">= 75"

  - id: "mobile-page-speed-002"
    item: "LCP under 2.5 seconds"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Check Lighthouse LCP metric"
    expected: "< 2500ms"

  - id: "mobile-page-speed-003"
    item: "CLS under 0.1"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Check Lighthouse CLS metric"
    expected: "< 0.1"

  - id: "mobile-page-speed-004"
    item: "No render-blocking resources"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Check Lighthouse diagnostics for render-blocking resources"
    expected: "0 render-blocking resources"

governance:
  applicable_to:
    archetypes: ["web-application", "marketing-site", "e-commerce", "saas"]

  compliance_frameworks:
    - framework: "Google Page Experience"
      controls: ["Core Web Vitals"]

relationships:
  commonly_combined:
    - "seo-discoverability.mobile-seo.mobile-friendliness"
    - "performance.core-web-vitals.lcp"
    - "performance.core-web-vitals.cls"
