audit:
  id: internationalization-localization.locale-detection.url-locale-handling
  name: URL-Based Locale Handling Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: locale-detection
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates URL-based locale handling strategies including subdomains
    (de.example.com), path prefixes (/de/page), query parameters (?lang=de),
    and content negotiation. Examines SEO implications, canonical URLs,
    hreflang implementation, and locale switching behavior.
  why_it_matters: |
    URL structure affects SEO, shareability, and user expectations. Localized
    URLs help search engines index content correctly, allow users to share
    locale-specific links, and make locale selection explicit and bookmarkable.
  when_to_run:
  - During URL architecture planning
  - Before international SEO launch
  - When implementing locale routing
  - During SEO audits
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: routing_config
    description: Router configuration
  - type: seo_config
    description: SEO and canonical URL setup
  access_requirements:
  - Read access to source code
  - Access to running application
  - Access to search console if available
discovery:
  file_patterns:
  - glob: '**/routes/**'
    purpose: Find routing configuration
  - glob: '**/router*.{js,ts}'
    purpose: Find router setup
  - glob: '**/middleware/**'
    purpose: Find locale middleware
knowledge_sources:
  guides:
  - id: google-hreflang
    name: Google hreflang Guidelines
    url: https://developers.google.com/search/docs/specialty/international/localized-versions
  - id: nextjs-i18n
    name: Next.js Internationalized Routing
    url: https://nextjs.org/docs/advanced-features/i18n-routing
  standards:
  - id: hreflang
    name: hreflang Specification
    relevance: Search engine locale signals
  - id: bcp-47
    name: BCP 47
    relevance: Language tags in URLs
tooling:
  analysis_tools:
  - tool: screaming-frog
    purpose: SEO crawling and hreflang audit
  - tool: google-search-console
    purpose: International targeting verification
  - tool: hreflang-tags-validator
    purpose: Validate hreflang implementation
signals:
  critical:
  - id: I18N-URL-CRIT-001
    signal: Same URL serves different locale content
    evidence_indicators:
    - Cookie-based locale without URL differentiation
    - Search engines can't distinguish locales
    explanation: |
      Without locale in URL, search engines can't properly index
      different language versions, hurting international SEO.
    remediation: Include locale in URL structure
  - id: I18N-URL-CRIT-002
    signal: Missing hreflang tags
    evidence_indicators:
    - No hreflang on locale pages
    - Self-referencing hreflang missing
    explanation: |
      Missing hreflang prevents search engines from serving the
      right language version to users.
    remediation: Implement complete hreflang tags
  high:
  - id: I18N-URL-HIGH-001
    signal: Locale URLs redirect incorrectly
    evidence_indicators:
    - /de/page redirects to /en/page
    - Shared links change locale
    remediation: Preserve locale in URL throughout navigation
  - id: I18N-URL-HIGH-002
    signal: Canonical URLs incorrect for locales
    evidence_indicators:
    - All locales canonical to English version
    - Missing canonical tags
    remediation: Set correct canonical per locale
  medium:
  - id: I18N-URL-MED-001
    signal: Mixed locale URL strategies
    evidence_indicators:
    - Some pages use path, others use subdomain
    - Inconsistent URL patterns
    remediation: Standardize on one URL locale strategy
  - id: I18N-URL-MED-002
    signal: Locale switcher doesn't preserve path
    evidence_indicators:
    - Switching locale goes to homepage
    - Current page context lost
    remediation: Maintain path when switching locale
  low:
  - id: I18N-URL-LOW-001
    signal: URL slugs not localized
    remediation: Consider localizing URL slugs for SEO
  - id: I18N-URL-LOW-002
    signal: Default locale not in URL
    remediation: Consider including default locale for consistency
  positive:
  - id: I18N-URL-POS-001
    signal: Clean, consistent locale URL structure
  - id: I18N-URL-POS-002
    signal: Complete hreflang implementation
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Analyze URL Structure
    description: Document locale URL patterns
    duration_estimate: 20 min
  - id: '2'
    name: Test Locale Navigation
    description: Verify locale URLs work correctly
    duration_estimate: 30 min
  - id: '3'
    name: Audit hreflang Tags
    description: Verify hreflang implementation
    duration_estimate: 30 min
  - id: '4'
    name: Check Canonical Tags
    description: Verify canonical URL setup
    duration_estimate: 20 min
  - id: '5'
    name: Test Locale Switcher
    description: Verify locale switching preserves context
    duration_estimate: 20 min
  - id: '6'
    name: Document Findings
    description: Compile URL handling audit report
    duration_estimate: 20 min
output:
  deliverables:
  - type: url_structure_analysis
    format: structured
    description: Locale URL pattern documentation
  - type: hreflang_audit
    format: tabular
    description: hreflang implementation status
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - URL Structure Analysis
    - hreflang Assessment
    - SEO Implications
    - Recommendations
closeout_checklist:
- id: i18n-url-001
  item: Locale reflected in URL structure
  level: WARNING
  verification: manual
- id: i18n-url-002
  item: hreflang tags implemented correctly
  level: WARNING
  verification: automated
- id: i18n-url-003
  item: Canonical URLs correct per locale
  level: WARNING
  verification: automated
governance:
  applicable_to:
    archetypes:
    - global-applications
    - content-sites
    - e-commerce
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: SEO-Best-Practices
    control: International SEO
    description: Search engine locale signals
relationships:
  commonly_combined:
  - seo-optimization.international-seo
  - internationalization-localization.locale-detection.user-locale-detection
  depends_on:
  - architecture.routing-strategy
  feeds_into:
  - seo-optimization.technical-seo
