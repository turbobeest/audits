audit:
  id: internationalization-localization.locale-detection.user-preferences
  name: User Locale Preferences Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: locale-detection
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates how users can set and manage their locale preferences including
    language selection, region settings, timezone, date format preferences,
    and unit system choices. Examines UI for changing settings, persistence,
    and sync across devices.
  why_it_matters: |
    Users should be able to override auto-detected locale settings. A Spanish
    user living in Germany may want Spanish UI but German date formats.
    Flexible preferences respect user diversity and improve satisfaction.
  when_to_run:
  - When implementing user settings
  - Before international launches
  - During account system development
  - When adding locale options
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: settings_ui
    description: User settings interface
  - type: user_model
    description: User profile data model
  access_requirements:
  - Read access to source code
  - Access to running application
  - Test user accounts
discovery:
  file_patterns:
  - glob: '**/settings/**'
    purpose: Find settings components
  - glob: '**/preferences*'
    purpose: Find preferences code
  - glob: '**/user*.{js,ts,tsx}'
    purpose: Find user-related code
knowledge_sources:
  guides:
  - id: locale-settings
    name: User Locale Settings Patterns
    url: https://www.nngroup.com/articles/language-selector/
  - id: a11y-language
    name: Accessible Language Selection
    url: https://www.w3.org/WAI/tutorials/menus/flyout/
  standards:
  - id: wcag
    name: WCAG 2.1
    relevance: Accessible settings
tooling:
  analysis_tools:
  - tool: browser-devtools
    purpose: Inspect localStorage/cookies
  - tool: user-testing
    purpose: Usability evaluation
signals:
  critical:
  - id: I18N-PREF-CRIT-001
    signal: No way to change locale/language
    evidence_indicators:
    - No language switcher in UI
    - No settings for locale preferences
    explanation: |
      Users must be able to override auto-detected locale,
      especially when detection is wrong.
    remediation: Add accessible locale preference controls
  high:
  - id: I18N-PREF-HIGH-001
    signal: Preference change doesn't take effect
    evidence_indicators:
    - Saving preference doesn't change UI
    - Preference reverts on navigation
    remediation: Ensure preference changes apply immediately
  - id: I18N-PREF-HIGH-002
    signal: Language switcher not visible/accessible
    evidence_indicators:
    - Switcher buried in settings
    - Only available when logged in
    remediation: Make language switcher easily accessible
  medium:
  - id: I18N-PREF-MED-001
    signal: Preferences don't sync across devices
    evidence_indicators:
    - Desktop and mobile have different settings
    - Preference stored only locally
    remediation: Sync preferences with user account
  - id: I18N-PREF-MED-002
    signal: Cannot set region/locale separately from language
    evidence_indicators:
    - Changing language changes date format
    - No separate region preference
    remediation: Allow independent locale component settings
  low:
  - id: I18N-PREF-LOW-001
    signal: Language names not in native script
    remediation: Show language names in their own script
  - id: I18N-PREF-LOW-002
    signal: No preview of locale changes
    remediation: Consider preview before applying changes
  positive:
  - id: I18N-PREF-POS-001
    signal: Comprehensive locale preference controls
  - id: I18N-PREF-POS-002
    signal: Preferences sync across devices
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Locate Preference Controls
    description: Find all locale preference UIs
    duration_estimate: 20 min
  - id: '2'
    name: Test Preference Changes
    description: Verify preference changes take effect
    duration_estimate: 30 min
  - id: '3'
    name: Test Persistence
    description: Verify preferences persist across sessions
    duration_estimate: 20 min
  - id: '4'
    name: Test Accessibility
    description: Evaluate preference UI accessibility
    duration_estimate: 20 min
  - id: '5'
    name: Test Guest vs Logged In
    description: Compare preference handling by auth state
    duration_estimate: 20 min
  - id: '6'
    name: Document Findings
    description: Compile preferences audit report
    duration_estimate: 20 min
output:
  deliverables:
  - type: preference_inventory
    format: tabular
    description: All locale preference controls
  - type: ux_assessment
    format: structured
    description: Preference UX evaluation
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Preference Controls
    - Persistence Analysis
    - Accessibility Review
    - Recommendations
closeout_checklist:
- id: i18n-pref-001
  item: Language/locale switcher available
  level: ERROR
  verification: manual
- id: i18n-pref-002
  item: Preference changes take effect immediately
  level: WARNING
  verification: manual
- id: i18n-pref-003
  item: Preferences persist properly
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - global-applications
    - user-account-systems
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: WCAG
    control: '3.1'
    description: Readable content
  - framework: UX-Standards
    control: User Control
    description: User preference respect
relationships:
  commonly_combined:
  - internationalization-localization.locale-detection.user-locale-detection
  - accessibility-inclusion.settings-accessibility
  depends_on:
  - user-management.profile-settings
  feeds_into:
  - internationalization-localization.locale-detection.user-locale-detection
