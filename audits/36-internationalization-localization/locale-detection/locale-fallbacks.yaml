audit:
  id: internationalization-localization.locale-detection.locale-fallbacks
  name: Locale Fallback Strategy Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: locale-detection
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the locale fallback strategy when requested locales are not
    fully supported. Examines regional to language fallbacks (en-AU to en),
    language family fallbacks, and ultimate default locale handling to
    ensure users always receive appropriate content.
  why_it_matters: |
    Not all locale variants have complete translations. A user requesting
    en-AU should fall back to en if en-AU isn't available, rather than
    showing blank content or errors. Good fallback strategy ensures graceful
    degradation.
  when_to_run:
  - When configuring locale system
  - Before adding new locales
  - When translation coverage is partial
  - During localization infrastructure setup
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: i18n_config
    description: Locale and fallback configuration
  - type: translation_files
    description: Available translation files
  access_requirements:
  - Read access to source code
  - Access to i18n configuration
  - Access to running application
discovery:
  file_patterns:
  - glob: '**/i18n*.{js,ts,json}'
    purpose: Find i18n configuration
  - glob: '**/locale*.config*'
    purpose: Find locale configuration
  - glob: '**/fallback*'
    purpose: Find fallback configuration
knowledge_sources:
  guides:
  - id: i18next-fallback
    name: i18next Fallback Language
    url: https://www.i18next.com/principles/fallback
  - id: cldr-inheritance
    name: CLDR Locale Inheritance
    url: https://cldr.unicode.org/index/cldr-spec/language-locale-inheritence
  standards:
  - id: bcp-47
    name: BCP 47 Language Tags
    relevance: Language tag hierarchy
  - id: cldr
    name: CLDR Inheritance
    relevance: Locale inheritance rules
tooling:
  analysis_tools:
  - tool: i18next
    purpose: i18next fallback configuration
  - tool: react-intl
    purpose: react-intl fallback handling
signals:
  critical:
  - id: I18N-FALL-CRIT-001
    signal: No fallback configured for unsupported locales
    evidence_indicators:
    - Errors for unsupported locales
    - Blank content or broken UI
    explanation: |
      Without fallbacks, users with unsupported locale preferences
      receive broken experiences.
    remediation: Configure proper fallback chain
  - id: I18N-FALL-CRIT-002
    signal: Missing translations show raw keys
    evidence_indicators:
    - Translation keys visible to users
    - home.welcome.title displayed
    explanation: |
      Showing translation keys creates an unprofessional appearance
      and confuses users.
    remediation: Configure fallback to show parent locale or default
  high:
  - id: I18N-FALL-HIGH-001
    signal: Regional variants don't fall back to base language
    evidence_indicators:
    - en-AU not falling back to en
    - pt-BR not falling back to pt
    remediation: Configure regional to language fallback
  - id: I18N-FALL-HIGH-002
    signal: Script variants not handled
    evidence_indicators:
    - zh-Hant not falling back to zh
    - Serbian script variants broken
    remediation: Add script variant fallback handling
  medium:
  - id: I18N-FALL-MED-001
    signal: Fallback chain too short
    evidence_indicators:
    - Only one fallback level
    - No ultimate default
    remediation: Extend fallback chain appropriately
  - id: I18N-FALL-MED-002
    signal: Fallback causes mixed language content
    evidence_indicators:
    - Some strings in French, some in English
    - Visible language mixing
    remediation: Prefer complete fallback over partial
  low:
  - id: I18N-FALL-LOW-001
    signal: Related language fallback not configured
    remediation: Consider related language fallbacks (no -> nb)
  - id: I18N-FALL-LOW-002
    signal: Fallback logging not enabled
    remediation: Log fallback events for monitoring
  positive:
  - id: I18N-FALL-POS-001
    signal: Comprehensive fallback chain configured
  - id: I18N-FALL-POS-002
    signal: Graceful degradation to default locale
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Fallback Configuration
    description: Analyze fallback chain setup
    duration_estimate: 20 min
  - id: '2'
    name: Test Regional Fallbacks
    description: Test regional to language fallback
    duration_estimate: 30 min
  - id: '3'
    name: Test Missing Translations
    description: Verify behavior for missing keys
    duration_estimate: 30 min
  - id: '4'
    name: Test Unsupported Locales
    description: Request completely unsupported locales
    duration_estimate: 20 min
  - id: '5'
    name: Verify No Key Exposure
    description: Ensure translation keys never shown
    duration_estimate: 20 min
  - id: '6'
    name: Document Findings
    description: Compile fallback audit report
    duration_estimate: 20 min
output:
  deliverables:
  - type: fallback_map
    format: structured
    description: Locale fallback chain mapping
  - type: test_results
    format: tabular
    description: Fallback scenario test results
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Fallback Configuration
    - Test Results
    - Gap Analysis
    - Recommendations
closeout_checklist:
- id: i18n-fall-001
  item: Fallback chain configured for all locales
  level: ERROR
  verification: automated
- id: i18n-fall-002
  item: Translation keys never exposed to users
  level: ERROR
  verification: manual
- id: i18n-fall-003
  item: Graceful degradation to default
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - global-applications
    - multi-language-sites
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: UX-Standards
    control: Content Availability
    description: Always show meaningful content
relationships:
  commonly_combined:
  - internationalization-localization.locale-detection.user-locale-detection
  - internationalization-localization.translation-management.translation-completeness
  depends_on:
  - internationalization-localization.locale-detection.user-locale-detection
  feeds_into:
  - internationalization-localization.testing-validation.locale-coverage
