audit:
  id: internationalization-localization.number-currency-formatting.number-formats
  name: Number Formatting Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: number-currency-formatting
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates localization of number formatting including decimal separators,
    grouping separators, grouping sizes, and digit systems. Examines whether
    the application uses locale-appropriate formats (1,234.56 vs 1.234,56)
    and handles different numeral systems (Arabic-Indic, Devanagari, etc.).
  why_it_matters: |
    Number format conventions vary significantly by locale. In Germany,
    1.234,56 means one thousand two hundred thirty-four point fifty-six.
    Using wrong separators causes confusion, data entry errors, and can
    affect financial calculations.
  when_to_run:
  - Before international launches
  - When implementing numeric displays
  - During e-commerce or financial feature development
  - After adding new locales
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: i18n_config
    description: Number formatting configuration
  - type: running_application
    description: Access to test number displays
  access_requirements:
  - Read access to source code
  - Access to running application
  - Ability to switch locales
discovery:
  file_patterns:
  - glob: '**/*format*.{js,ts,tsx}'
    purpose: Find formatting utilities
  - glob: '**/*number*.{js,ts,tsx}'
    purpose: Find number-related code
  - glob: '**/*locale*.{js,ts}'
    purpose: Find locale configuration
knowledge_sources:
  guides:
  - id: mdn-numberformat
    name: MDN Intl.NumberFormat
    url: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat
  - id: cldr-numbers
    name: CLDR Number Formatting
    url: https://cldr.unicode.org/translation/numbers-currency
  standards:
  - id: cldr
    name: Unicode CLDR
    relevance: Number format patterns
  - id: icu
    name: ICU Number Formatting
    relevance: Format specification
tooling:
  analysis_tools:
  - tool: intl-numberformat
    purpose: Built-in JavaScript number formatting
  - tool: numeral.js
    purpose: Number formatting library
    install: npm install numeral
  - tool: d3-format
    purpose: Number formatting for data viz
    install: npm install d3-format
signals:
  critical:
  - id: I18N-NUM-CRIT-001
    signal: Hardcoded decimal/grouping separators
    evidence_indicators:
    - toFixed().replace('.', ',') patterns
    - Hardcoded commas or periods in formatting
    explanation: |
      Hardcoded separators display incorrectly for locales using
      different conventions, causing confusion and errors.
    remediation: Use Intl.NumberFormat for all number formatting
  - id: I18N-NUM-CRIT-002
    signal: Number parsing ignores locale
    evidence_indicators:
    - parseFloat('1,234.56') fails for European formats
    - User input parsed with wrong conventions
    explanation: |
      Locale-unaware parsing corrupts numeric data entered by
      international users.
    remediation: Use locale-aware number parsing
  high:
  - id: I18N-NUM-HIGH-001
    signal: Inconsistent number formatting across application
    evidence_indicators:
    - Different formatting in different components
    - Mix of localized and unlocalized numbers
    remediation: Standardize on consistent number formatting approach
  - id: I18N-NUM-HIGH-002
    signal: Numeric input fields don't accept locale format
    evidence_indicators:
    - European users can't enter '1.234,56'
    - Validation rejects locale-valid formats
    remediation: Accept locale-appropriate number input
  medium:
  - id: I18N-NUM-MED-001
    signal: Large numbers not grouped appropriately
    evidence_indicators:
    - 1000000 displayed without grouping
    - Wrong grouping size (Indian numbering)
    remediation: Apply locale-appropriate grouping
  - id: I18N-NUM-MED-002
    signal: Negative number format not localized
    evidence_indicators:
    - Always using -123 format
    - Parentheses convention not supported
    remediation: Use locale-appropriate negative format
  low:
  - id: I18N-NUM-LOW-001
    signal: Percent formatting not fully localized
    remediation: 'Use Intl.NumberFormat with style: ''percent'''
  - id: I18N-NUM-LOW-002
    signal: Scientific notation not localized
    remediation: Consider locale scientific notation
  positive:
  - id: I18N-NUM-POS-001
    signal: Intl.NumberFormat used consistently
  - id: I18N-NUM-POS-002
    signal: Number input and display fully localized
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Number Displays
    description: Find all number displays in application
    duration_estimate: 20 min
  - id: '2'
    name: Analyze Formatting Code
    description: Review number formatting implementation
    duration_estimate: 30 min
    tools:
    - name: grep
      command: grep -rn 'toFixed\|NumberFormat\|toLocaleString' --include='*.{js,ts,tsx}'
  - id: '3'
    name: Test Multiple Locales
    description: Verify formatting in different locales
    duration_estimate: 45 min
  - id: '4'
    name: Test Number Input
    description: Verify locale-aware number input
    duration_estimate: 30 min
  - id: '5'
    name: Check Consistency
    description: Compare formats across application
    duration_estimate: 15 min
  - id: '6'
    name: Document Findings
    description: Compile number format audit report
    duration_estimate: 20 min
output:
  deliverables:
  - type: number_format_inventory
    format: tabular
    description: All number displays with format details
  - type: locale_testing
    format: structured
    description: Number formatting by locale
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Formatting Analysis
    - Input Handling
    - Locale Testing Results
    - Recommendations
closeout_checklist:
- id: i18n-num-001
  item: All numbers use locale-aware formatting
  level: ERROR
  verification: automated
- id: i18n-num-002
  item: Number input accepts locale formats
  level: WARNING
  verification: manual
- id: i18n-num-003
  item: Consistent formatting across application
  level: INFO
  verification: manual
governance:
  applicable_to:
    archetypes:
    - global-applications
    - financial-applications
    - e-commerce
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: Data-Accuracy
    control: Number Handling
    description: Accurate numeric data handling
  - framework: UX-Standards
    control: Number Display
    description: Locale-appropriate numbers
relationships:
  commonly_combined:
  - internationalization-localization.number-currency-formatting.currency-display
  - internationalization-localization.number-currency-formatting.unit-formatting
  depends_on:
  - internationalization-localization.locale-detection.user-locale-detection
  feeds_into:
  - internationalization-localization.testing-validation.locale-coverage
