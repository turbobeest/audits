audit:
  id: internationalization-localization.number-currency-formatting.unit-formatting
  name: Unit Formatting Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: number-currency-formatting
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates formatting of measurement units including length, weight,
    volume, area, speed, and temperature. Examines metric vs imperial
    preferences, unit abbreviations, localized unit names, and compound
    units (km/h, ft/s, etc.).
  why_it_matters: |
    Unit formatting preferences vary by region. Most of the world uses metric
    while the US uses imperial. Displaying kilometers to US users or miles to
    European users creates confusion and can cause errors in shipping,
    measurements, and data entry.
  when_to_run:
  - Before international launches
  - When implementing measurement features
  - During e-commerce shipping setup
  - When adding product specifications
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: i18n_config
    description: Unit formatting configuration
  - type: running_application
    description: Access to test unit displays
  access_requirements:
  - Read access to source code
  - Access to running application
  - Knowledge of target market preferences
discovery:
  file_patterns:
  - glob: '**/*unit*'
    purpose: Find unit-related files
  - glob: '**/*measurement*'
    purpose: Find measurement code
  - glob: '**/*convert*'
    purpose: Find conversion utilities
knowledge_sources:
  guides:
  - id: cldr-units
    name: CLDR Unit Formatting
    url: https://cldr.unicode.org/translation/units
  - id: mdn-unit
    name: MDN Unit Formatting
    url: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/NumberFormat#unit
  standards:
  - id: cldr
    name: Unicode CLDR Units
    relevance: Unit formatting patterns
  - id: si
    name: SI Units
    relevance: International unit system
tooling:
  analysis_tools:
  - tool: intl-numberformat
    purpose: Built-in unit formatting
  - tool: convert-units
    purpose: Unit conversion library
    install: npm install convert-units
  - tool: unit.js
    purpose: Unit handling and conversion
    install: npm install unit.js
signals:
  critical:
  - id: I18N-UNIT-CRIT-001
    signal: Units hardcoded without conversion option
    evidence_indicators:
    - Always displaying miles or kilometers
    - No user preference for unit system
    explanation: |
      Hardcoded units confuse users accustomed to different systems
      and can cause significant measurement errors.
    remediation: Detect locale preference and allow user override
  high:
  - id: I18N-UNIT-HIGH-001
    signal: Unit abbreviations not localized
    evidence_indicators:
    - English abbreviations in all locales
    - '''km'' shown where ''km'' should be ''км'' (Russian)'
    remediation: Use locale-appropriate unit abbreviations from CLDR
  - id: I18N-UNIT-HIGH-002
    signal: Unit conversions inaccurate
    evidence_indicators:
    - Rounding errors in conversions
    - Incorrect conversion factors
    remediation: Use validated conversion library
  medium:
  - id: I18N-UNIT-MED-001
    signal: Compound units not properly formatted
    evidence_indicators:
    - km/h shown as 'km per h'
    - Inconsistent compound unit formatting
    remediation: Use CLDR compound unit patterns
  - id: I18N-UNIT-MED-002
    signal: Unit plural forms not handled
    evidence_indicators:
    - '''1 kilometers'' displayed'
    - No plural rule consideration
    remediation: Use Intl.NumberFormat with unit style
  low:
  - id: I18N-UNIT-LOW-001
    signal: Temperature scale not matching locale
    remediation: Use Fahrenheit for US, Celsius elsewhere
  - id: I18N-UNIT-LOW-002
    signal: Narrow vs wide unit formats inconsistent
    remediation: Standardize on appropriate width
  positive:
  - id: I18N-UNIT-POS-001
    signal: Full locale-aware unit formatting
  - id: I18N-UNIT-POS-002
    signal: User preference for unit system
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Unit Displays
    description: Find all measurement displays
    duration_estimate: 20 min
  - id: '2'
    name: Analyze Unit Configuration
    description: Review unit system configuration
    duration_estimate: 20 min
  - id: '3'
    name: Test Locale Formatting
    description: Verify unit display in different locales
    duration_estimate: 45 min
  - id: '4'
    name: Verify Conversions
    description: Test unit conversion accuracy
    duration_estimate: 30 min
  - id: '5'
    name: Check User Preferences
    description: Test unit system preference handling
    duration_estimate: 15 min
  - id: '6'
    name: Document Findings
    description: Compile unit formatting audit report
    duration_estimate: 20 min
output:
  deliverables:
  - type: unit_inventory
    format: tabular
    description: All unit displays with format details
  - type: locale_unit_matrix
    format: structured
    description: Unit display by locale
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Unit Formatting Analysis
    - Conversion Accuracy
    - Locale Preferences
    - Recommendations
closeout_checklist:
- id: i18n-unit-001
  item: Units use locale-appropriate system
  level: WARNING
  verification: manual
- id: i18n-unit-002
  item: Unit abbreviations localized
  level: WARNING
  verification: automated
- id: i18n-unit-003
  item: Unit conversions accurate
  level: ERROR
  verification: automated
governance:
  applicable_to:
    archetypes:
    - global-applications
    - e-commerce
    - measurement-applications
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: E-Commerce-Regulations
    control: Measurement Display
    description: Accurate measurement requirements
  - framework: Consumer-Protection
    control: Product Information
    description: Clear measurement information
relationships:
  commonly_combined:
  - internationalization-localization.number-currency-formatting.number-formats
  - internationalization-localization.locale-detection.user-preferences
  depends_on:
  - internationalization-localization.locale-detection.user-locale-detection
  feeds_into:
  - e-commerce.product-information
