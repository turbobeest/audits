audit:
  id: internationalization-localization.number-currency-formatting.currency-display
  name: Currency Display Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: number-currency-formatting
  tier: expert
  estimated_duration: 3-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates currency formatting including symbol placement, number formatting
    with currency, multi-currency support, and locale-appropriate display.
    Examines whether $100, 100$, USD 100, or 100 USD is shown appropriately
    per locale conventions.
  why_it_matters: |
    Currency formatting errors cause confusion and can impact purchasing
    decisions. Different locales expect different formats: $1,234.56 (US),
    1.234,56 EUR (Germany), or 1 234,56 EUR (France). Wrong formatting
    appears unprofessional and damages trust.
  when_to_run:
  - Before e-commerce launches
  - When implementing payment features
  - After adding new currencies
  - During pricing page development
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: currency_config
    description: Currency configuration and supported currencies
  - type: running_application
    description: Access to test price displays
  access_requirements:
  - Read access to source code
  - Access to running application
  - Ability to switch currencies/locales
discovery:
  file_patterns:
  - glob: '**/*currency*'
    purpose: Find currency-related files
  - glob: '**/*price*'
    purpose: Find price formatting
  - glob: '**/*money*'
    purpose: Find money handling
knowledge_sources:
  guides:
  - id: mdn-currency
    name: MDN Currency Formatting
    url: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat#currency_formatting
  - id: cldr-currency
    name: CLDR Currency Data
    url: https://cldr.unicode.org/translation/numbers-currency/currency-names
  standards:
  - id: iso-4217
    name: ISO 4217
    relevance: Currency codes standard
  - id: cldr
    name: CLDR Currency Formatting
    relevance: Locale currency patterns
tooling:
  analysis_tools:
  - tool: intl-numberformat
    purpose: Built-in currency formatting
  - tool: dinero.js
    purpose: Money handling library
    install: npm install dinero.js
  - tool: currency.js
    purpose: Currency formatting library
    install: npm install currency.js
signals:
  critical:
  - id: I18N-CUR-CRIT-001
    signal: Currency symbol hardcoded or in wrong position
    evidence_indicators:
    - '''$'' + amount patterns'
    - Symbol always before amount
    explanation: |
      Hardcoded currency symbols display wrong currency for different
      locales and wrong position damages user trust.
    remediation: 'Use Intl.NumberFormat with style: ''currency'''
  - id: I18N-CUR-CRIT-002
    signal: Currency confusion possible
    evidence_indicators:
    - $ used without specifying USD/CAD/AUD
    - Ambiguous currency display
    explanation: |
      Ambiguous currency symbols can cause users to misunderstand
      prices, leading to customer disputes.
    remediation: Always clarify currency with ISO code when ambiguous
  high:
  - id: I18N-CUR-HIGH-001
    signal: Currency number formatting doesn't match locale
    evidence_indicators:
    - US formatting for EUR prices
    - Wrong decimal places for currency
    remediation: Use locale and currency-aware formatting
  - id: I18N-CUR-HIGH-002
    signal: Prices not converted, only symbol changed
    evidence_indicators:
    - Same numeric value with different currency symbols
    - No actual currency conversion
    remediation: Display prices in local currency with proper conversion
  medium:
  - id: I18N-CUR-MED-001
    signal: Minor currencies don't have correct decimal places
    evidence_indicators:
    - JPY showing decimal places
    - KWD showing only 2 decimals instead of 3
    remediation: Respect currency decimal place requirements
  - id: I18N-CUR-MED-002
    signal: Currency name display not localized
    evidence_indicators:
    - '''US Dollar'' shown in non-English locales'
    - Currency names always in English
    remediation: Localize currency names
  low:
  - id: I18N-CUR-LOW-001
    signal: Accounting format not available for negative amounts
    remediation: Consider accounting format option for finance contexts
  - id: I18N-CUR-LOW-002
    signal: Currency display style not configurable
    remediation: Allow symbol, code, or name display options
  positive:
  - id: I18N-CUR-POS-001
    signal: Full locale-aware currency formatting
  - id: I18N-CUR-POS-002
    signal: Multi-currency support with proper conversions
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Currency Displays
    description: Find all price/currency displays
    duration_estimate: 20 min
  - id: '2'
    name: Analyze Formatting Code
    description: Review currency formatting implementation
    duration_estimate: 30 min
    tools:
    - name: grep
      command: grep -rn 'currency\|price\|NumberFormat' --include='*.{js,ts,tsx}'
  - id: '3'
    name: Test Currency Combinations
    description: Test different locale/currency combinations
    duration_estimate: 60 min
  - id: '4'
    name: Verify Decimal Places
    description: Check currency-specific decimal places
    duration_estimate: 30 min
  - id: '5'
    name: Check Symbol Placement
    description: Verify correct symbol positions
    duration_estimate: 20 min
  - id: '6'
    name: Document Findings
    description: Compile currency display audit report
    duration_estimate: 30 min
output:
  deliverables:
  - type: currency_inventory
    format: tabular
    description: All currency displays with format details
  - type: locale_currency_matrix
    format: structured
    description: Currency display by locale combinations
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Currency Formatting Analysis
    - Symbol and Position Review
    - Decimal Place Compliance
    - Recommendations
closeout_checklist:
- id: i18n-cur-001
  item: Currencies use locale-aware formatting
  level: ERROR
  verification: automated
- id: i18n-cur-002
  item: Currency decimal places correct
  level: ERROR
  verification: automated
- id: i18n-cur-003
  item: No ambiguous currency displays
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - e-commerce
    - financial-applications
    - global-marketplaces
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: E-Commerce-Regulations
    control: Price Display
    description: Clear price display requirements
  - framework: Consumer-Protection
    control: Pricing Transparency
    description: Clear pricing information
relationships:
  commonly_combined:
  - internationalization-localization.number-currency-formatting.number-formats
  - internationalization-localization.number-currency-formatting.currency-conversion
  depends_on:
  - internationalization-localization.locale-detection.user-locale-detection
  feeds_into:
  - e-commerce.pricing-compliance
