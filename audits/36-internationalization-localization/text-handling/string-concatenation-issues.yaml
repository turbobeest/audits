audit:
  id: internationalization-localization.text-handling.string-concatenation-issues
  name: String Concatenation Issues Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: text-handling
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: high
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Identifies problematic string concatenation patterns that break
    localization. Examines sentence fragments, partial translations,
    word order assumptions, and messages assembled from pieces that
    cannot be properly translated due to grammar differences.
  why_it_matters: |
    String concatenation assumes English word order and grammar structure.
    "Hello " + name + ", welcome!" cannot be translated properly because
    languages have different word orders, and this pattern produces
    grammatically incorrect translations.
  when_to_run:
  - Before starting localization
  - During code review
  - When finding translation quality issues
  - After adding new UI features
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: translation_files
    description: Current translations for comparison
  access_requirements:
  - Read access to source code
  - Access to i18n configuration
discovery:
  file_patterns:
  - glob: '**/*.{js,jsx,ts,tsx}'
    purpose: Find JavaScript/TypeScript files
  - glob: '**/*.vue'
    purpose: Find Vue components
  - glob: '**/*.{py,rb,java,go,php}'
    purpose: Find backend source files
knowledge_sources:
  guides:
  - id: w3c-concatenation
    name: W3C String Composition
    url: https://www.w3.org/International/articles/strings-and-bidi/
  - id: icu-message
    name: ICU Message Format
    url: https://unicode-org.github.io/icu/userguide/format_parse/messages/
  standards:
  - id: icu-message-format
    name: ICU MessageFormat
    relevance: Standard for parameterized messages
tooling:
  analysis_tools:
  - tool: eslint-plugin-formatjs
    purpose: Detect concatenation patterns
    install: npm install -D eslint-plugin-formatjs
  - tool: i18n-lint
    purpose: Lint for i18n issues
  - tool: custom-regex
    purpose: Pattern matching for concatenation
signals:
  critical:
  - id: I18N-CAT-CRIT-001
    signal: Sentences built from multiple translation keys
    evidence_indicators:
    - t('greeting') + t('user.name') patterns
    - Multiple translation calls joined
    explanation: |
      Assembling sentences from fragments makes grammatically correct
      translation impossible in languages with different word order.
    remediation: Use complete sentences with placeholders
  - id: I18N-CAT-CRIT-002
    signal: Dynamic content concatenated into strings
    evidence_indicators:
    - '''Welcome '' + userName + ''!'' patterns'
    - Template literals building sentences
    explanation: |
      Concatenated dynamic content cannot be reordered for languages
      where the variable should appear in a different position.
    remediation: Use message format with named placeholders
  high:
  - id: I18N-CAT-HIGH-001
    signal: Partial phrases as translation keys
    evidence_indicators:
    - Keys like 'button.save.prefix' and 'button.save.suffix'
    - Fragment translation keys
    remediation: Create complete message keys
  - id: I18N-CAT-HIGH-002
    signal: UI labels assembled conditionally
    evidence_indicators:
    - Conditional logic building display strings
    - if/else building different message parts
    remediation: Use ICU select format for conditional text
  medium:
  - id: I18N-CAT-MED-001
    signal: Number formatting embedded in concatenation
    evidence_indicators:
    - count + ' items' patterns
    - Numbers appended to strings
    remediation: Use ICU plural format with formatting
  - id: I18N-CAT-MED-002
    signal: Date/time concatenated with text
    evidence_indicators:
    - '''Last updated: '' + formattedDate'
    - Date strings joined with labels
    remediation: Include date format in translation with placeholder
  low:
  - id: I18N-CAT-LOW-001
    signal: URL concatenation with text
    remediation: Separate URLs from display text
  - id: I18N-CAT-LOW-002
    signal: Error codes concatenated with messages
    remediation: Use structured error formatting
  positive:
  - id: I18N-CAT-POS-001
    signal: All messages use complete sentences with placeholders
  - id: I18N-CAT-POS-002
    signal: Linting rules enforce proper message format
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Scan for Concatenation Patterns
    description: Find string concatenation in code
    duration_estimate: 30 min
    tools:
    - name: grep
      command: grep -rn "t('.*')\s*+" --include='*.{js,ts,tsx}'
    - name: grep
      command: grep -rn "\+\s*t('.*')" --include='*.{js,ts,tsx}'
  - id: '2'
    name: Analyze Template Literals
    description: Find problematic template literal usage
    duration_estimate: 20 min
    tools:
    - name: grep
      command: grep -rn '`.*\${.*}.*`' --include='*.{js,ts,tsx}'
  - id: '3'
    name: Review Translation Keys
    description: Find fragmented translation keys
    duration_estimate: 30 min
  - id: '4'
    name: Check Conditional Building
    description: Find conditionally assembled strings
    duration_estimate: 20 min
  - id: '5'
    name: Prioritize Issues
    description: Rank findings by severity and frequency
    duration_estimate: 20 min
  - id: '6'
    name: Document Findings
    description: Compile concatenation issues report
    duration_estimate: 20 min
output:
  deliverables:
  - type: concatenation_inventory
    format: tabular
    description: All concatenation issues with locations
  - type: pattern_analysis
    format: structured
    description: Common problematic patterns found
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Concatenation Patterns Found
    - Impact Analysis
    - Remediation Guide
    - Recommendations
closeout_checklist:
- id: i18n-cat-001
  item: No sentence fragments as translation keys
  level: ERROR
  verification: automated
- id: i18n-cat-002
  item: No string concatenation building messages
  level: ERROR
  verification: automated
- id: i18n-cat-003
  item: Linting prevents new concatenation issues
  level: INFO
  verification: automated
governance:
  applicable_to:
    archetypes:
    - global-applications
    - all-web-applications
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: i18n-Best-Practices
    control: Message Format
    description: Proper message construction
relationships:
  commonly_combined:
  - internationalization-localization.text-handling.string-externalization
  - internationalization-localization.text-handling.pluralization-gender
  depends_on:
  - internationalization-localization.text-handling.string-externalization
  feeds_into:
  - internationalization-localization.translation-management.translation-quality
