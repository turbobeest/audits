audit:
  id: internationalization-localization.text-handling.unicode-support
  name: Unicode Support Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: text-handling
  tier: expert
  estimated_duration: 3-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the application's support for Unicode text throughout the
    entire stack including storage, processing, display, and data exchange.
    Examines character encoding configuration, emoji support, special
    character handling, and text normalization practices.
  why_it_matters: |
    Unicode issues cause data corruption, display problems, and broken
    functionality for users of non-Latin scripts. Proper Unicode support
    is essential for true internationalization and supports 150+ scripts
    and billions of users worldwide.
  when_to_run:
  - Before international launches
  - When adding new language support
  - After database or storage changes
  - When troubleshooting character encoding issues
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: database_config
    description: Database configuration and schema
  - type: api_documentation
    description: API input/output specifications
  access_requirements:
  - Read access to source code
  - Access to database configuration
  - Test environment for runtime testing
discovery:
  file_patterns:
  - glob: '**/*.{js,ts,py,java,go,rb}'
    purpose: Find source code files
  - glob: '**/charset*'
    purpose: Find charset configuration
  - glob: '**/encoding*'
    purpose: Find encoding configuration
  - glob: '**/database.{yml,yaml,json}'
    purpose: Find database configuration
knowledge_sources:
  guides:
  - id: unicode-howto
    name: Unicode HOWTO
    url: https://docs.python.org/3/howto/unicode.html
  - id: utf8-everywhere
    name: UTF-8 Everywhere
    url: https://utf8everywhere.org/
  standards:
  - id: unicode
    name: Unicode Standard
    relevance: Character encoding standard
  - id: w3c-charmod
    name: W3C Character Model
    relevance: Web character encoding guidelines
tooling:
  analysis_tools:
  - tool: file
    purpose: Detect file encodings
    install: Built-in Unix command
  - tool: chardet
    purpose: Character encoding detection
    install: pip install chardet
  - tool: iconv
    purpose: Convert between encodings
    install: Built-in Unix command
signals:
  critical:
  - id: I18N-UNI-CRIT-001
    signal: Database not configured for UTF-8
    evidence_indicators:
    - Database charset set to latin1 or similar
    - Collation not Unicode-aware
    explanation: |
      Non-UTF-8 databases cannot store most of the world's languages,
      causing data corruption or rejection of valid input.
    remediation: Migrate database to UTF-8 (utf8mb4 for MySQL)
  - id: I18N-UNI-CRIT-002
    signal: Character encoding mismatches cause data corruption
    evidence_indicators:
    - Mojibake (garbled text) in stored data
    - Question marks or replacement characters in output
    explanation: |
      Encoding mismatches corrupt user data and break application
      functionality for international users.
    remediation: Ensure consistent UTF-8 encoding throughout stack
  high:
  - id: I18N-UNI-HIGH-001
    signal: Source files not in UTF-8 encoding
    evidence_indicators:
    - Mixed encodings in source files
    - BOM (byte order mark) inconsistencies
    remediation: Convert all source files to UTF-8 without BOM
  - id: I18N-UNI-HIGH-002
    signal: HTTP charset not specified
    evidence_indicators:
    - Missing Content-Type charset header
    - No meta charset in HTML
    remediation: Add UTF-8 charset declaration to all responses
  medium:
  - id: I18N-UNI-MED-001
    signal: Emoji not properly supported
    evidence_indicators:
    - Emoji stored incorrectly (MySQL utf8 vs utf8mb4)
    - Emoji stripped or corrupted
    remediation: Use utf8mb4 or equivalent full Unicode support
  - id: I18N-UNI-MED-002
    signal: Unicode normalization not applied
    evidence_indicators:
    - Same character represented differently
    - Search/comparison issues with accented characters
    remediation: Apply NFC normalization to user input
  low:
  - id: I18N-UNI-LOW-001
    signal: Legacy encoding support missing
    remediation: Add encoding conversion for legacy data imports
  - id: I18N-UNI-LOW-002
    signal: Unicode escapes used instead of actual characters
    remediation: Use actual Unicode characters in source when readable
  positive:
  - id: I18N-UNI-POS-001
    signal: Full Unicode support throughout stack
  - id: I18N-UNI-POS-002
    signal: Proper Unicode normalization implemented
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Check Source File Encodings
    description: Verify all source files are UTF-8
    duration_estimate: 20 min
    tools:
    - name: file
      command: find . -name '*.js' -exec file {} \;
  - id: '2'
    name: Audit Database Configuration
    description: Verify database charset and collation
    duration_estimate: 30 min
    tools:
    - name: mysql
      command: SHOW VARIABLES LIKE '%character%';
  - id: '3'
    name: Test Unicode Input/Output
    description: Test with various scripts and emoji
    duration_estimate: 45 min
  - id: '4'
    name: Review HTTP Headers
    description: Verify charset declarations in responses
    duration_estimate: 20 min
  - id: '5'
    name: Check String Processing
    description: Review code for Unicode-aware string handling
    duration_estimate: 45 min
  - id: '6'
    name: Document Findings
    description: Compile Unicode support audit report
    duration_estimate: 30 min
output:
  deliverables:
  - type: unicode_assessment
    format: structured
    description: Unicode support status across stack
  - type: issue_list
    format: tabular
    description: Unicode issues found with severity
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Encoding Analysis
    - Database Assessment
    - Application Layer Review
    - Recommendations
closeout_checklist:
- id: i18n-uni-001
  item: Database configured for full Unicode (utf8mb4)
  level: ERROR
  verification: automated
- id: i18n-uni-002
  item: All source files UTF-8 encoded
  level: WARNING
  verification: automated
- id: i18n-uni-003
  item: HTTP charset headers configured
  level: WARNING
  verification: automated
governance:
  applicable_to:
    archetypes:
    - global-applications
    - user-generated-content
    - multi-language-support
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: WCAG
    control: '3.1'
    description: Readable content in user's language
  - framework: Data-Integrity
    control: Character Encoding
    description: Data preservation requirements
relationships:
  commonly_combined:
  - internationalization-localization.text-handling.rtl-support
  - data-management.data-integrity
  depends_on:
  - database-management.configuration
  feeds_into:
  - internationalization-localization.text-handling.text-rendering
