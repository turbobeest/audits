audit:
  id: internationalization-localization.text-handling.pluralization-gender
  name: Pluralization and Grammatical Gender Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: text-handling
  tier: expert
  estimated_duration: 3-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the handling of pluralization rules and grammatical gender
    across languages. Different languages have complex plural rules (Arabic
    has 6 plural forms) and gender agreement requirements that affect
    adjectives, verbs, and pronouns.
  why_it_matters: |
    Incorrect pluralization or gender creates grammatically incorrect,
    unprofessional text. "1 items" in English or wrong gender in French
    damages credibility and user experience in international markets.
  when_to_run:
  - Before launching new languages
  - When implementing count-based messages
  - During translation quality review
  - After i18n library upgrades
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: translation_files
    description: Translation files with plural forms
  - type: i18n_config
    description: i18n library configuration
  access_requirements:
  - Read access to source code
  - Access to translation files
discovery:
  file_patterns:
  - glob: '**/locales/**/*.json'
    purpose: Find locale files
  - glob: '**/*.po'
    purpose: Find gettext files with plural forms
  - glob: '**/i18n*.{js,ts}'
    purpose: Find i18n implementation
knowledge_sources:
  guides:
  - id: icu-plural
    name: ICU Plural Rules
    url: https://unicode-org.github.io/cldr/ldml/tr35-numbers.html#Language_Plural_Rules
  - id: formatjs-plural
    name: FormatJS Pluralization
    url: https://formatjs.io/docs/core-concepts/plurals
  standards:
  - id: cldr-plurals
    name: CLDR Plural Rules
    relevance: Language plural categories
  - id: icu-message
    name: ICU Message Format
    relevance: Standard message format
tooling:
  analysis_tools:
  - tool: intl-messageformat
    purpose: ICU message format parsing
    install: npm install intl-messageformat
  - tool: formatjs-cli
    purpose: Validate message syntax
    install: npm install -D @formatjs/cli
  - tool: cldr-data
    purpose: CLDR plural rules data
    install: npm install cldr-data
signals:
  critical:
  - id: I18N-PLR-CRIT-001
    signal: Conditional pluralization in code instead of i18n
    evidence_indicators:
    - 'count === 1 ? ''item'' : ''items'' patterns'
    - Ternary operators for singular/plural
    explanation: |
      Code-based pluralization cannot support languages with multiple
      plural forms (Russian, Arabic, Polish) and breaks localization.
    remediation: Use ICU plural message format
  high:
  - id: I18N-PLR-HIGH-001
    signal: Missing plural forms for language rules
    evidence_indicators:
    - Russian with only singular/plural forms
    - Arabic without all 6 plural categories
    remediation: Complete all required plural forms per CLDR
  - id: I18N-PLR-HIGH-002
    signal: Gender-dependent text not properly handled
    evidence_indicators:
    - Hardcoded masculine forms in gendered languages
    - No select for user gender in messages
    remediation: Use ICU select format for gendered content
  medium:
  - id: I18N-PLR-MED-001
    signal: Inconsistent plural message patterns
    evidence_indicators:
    - Different plural syntax across messages
    - Some messages missing plural handling
    remediation: Standardize on ICU plural format
  - id: I18N-PLR-MED-002
    signal: Ordinal numbers not properly localized
    evidence_indicators:
    - Hardcoded st, nd, rd, th suffixes
    - No selectordinal usage
    remediation: Use ICU selectordinal for ordinals
  low:
  - id: I18N-PLR-LOW-001
    signal: Excessive plural form complexity
    remediation: Simplify messages to reduce plural variants
  - id: I18N-PLR-LOW-002
    signal: Plural forms not tested for all categories
    remediation: Add comprehensive plural testing
  positive:
  - id: I18N-PLR-POS-001
    signal: ICU message format used consistently
  - id: I18N-PLR-POS-002
    signal: All CLDR plural categories implemented
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify Plural Messages
    description: Find all count-dependent messages
    duration_estimate: 30 min
    tools:
    - name: grep
      command: grep -r '{count}\|{n}\|plural' --include='*.json'
  - id: '2'
    name: Check Code Patterns
    description: Find conditional pluralization in code
    duration_estimate: 30 min
    tools:
    - name: grep
      command: grep -r 'count.*===.*1.*\?' --include='*.{js,ts,tsx}'
  - id: '3'
    name: Validate ICU Syntax
    description: Verify correct ICU message format
    duration_estimate: 30 min
    tools:
    - name: formatjs
      command: formatjs compile --ast src/lang/*.json
  - id: '4'
    name: Review Plural Coverage
    description: Check all forms exist for target languages
    duration_estimate: 45 min
  - id: '5'
    name: Gender Analysis
    description: Identify gender-dependent content
    duration_estimate: 30 min
  - id: '6'
    name: Document Findings
    description: Compile pluralization audit report
    duration_estimate: 30 min
output:
  deliverables:
  - type: plural_analysis
    format: structured
    description: Plural handling assessment
  - type: issue_list
    format: tabular
    description: Pluralization issues by message
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Plural Implementation Status
    - Gender Handling
    - Language Coverage
    - Recommendations
closeout_checklist:
- id: i18n-plr-001
  item: No conditional pluralization in code
  level: ERROR
  verification: automated
- id: i18n-plr-002
  item: ICU plural format used consistently
  level: WARNING
  verification: automated
- id: i18n-plr-003
  item: All CLDR plural forms provided
  level: WARNING
  verification: automated
governance:
  applicable_to:
    archetypes:
    - global-applications
    - content-driven-apps
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: CLDR
    control: Plural Rules
    description: Language plural requirements
relationships:
  commonly_combined:
  - internationalization-localization.text-handling.string-externalization
  - internationalization-localization.translation-management.translation-quality
  depends_on:
  - internationalization-localization.text-handling.string-externalization
  feeds_into:
  - internationalization-localization.testing-validation.linguistic-testing
