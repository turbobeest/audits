audit:
  id: internationalization-localization.date-time-localization.relative-time-formatting
  name: Relative Time Formatting Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: date-time-localization
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates localization of relative time expressions such as "2 hours ago",
    "in 3 days", "yesterday", and "last week". Examines whether these
    expressions use proper locale formatting, handle plural rules correctly,
    and update appropriately over time.
  why_it_matters: |
    Relative time is heavily used in modern UIs (social feeds, notifications,
    file timestamps). Hardcoded English phrases cannot be translated, and
    different languages have complex rules for expressing relative time
    including different plural forms.
  when_to_run:
  - Before international launches
  - When implementing activity feeds
  - After adding relative time displays
  - During localization QA
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: ui_components
    description: Components displaying relative time
  - type: translations
    description: Translations in target locales
  access_requirements:
  - Read access to source code
  - Access to running application
  - Test content with various ages
discovery:
  file_patterns:
  - glob: '**/*time*.{js,ts,tsx}'
    purpose: Find time-related utilities
  - glob: '**/*ago*.{js,ts}'
    purpose: Find relative time code
  - glob: '**/*relative*.{js,ts}'
    purpose: Find relative formatting
knowledge_sources:
  guides:
  - id: mdn-relativetime
    name: MDN Intl.RelativeTimeFormat
    url: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/RelativeTimeFormat
  - id: cldr-relative
    name: CLDR Relative Time Data
    url: https://cldr.unicode.org/index/cldr-spec/relative-time
  standards:
  - id: cldr
    name: Unicode CLDR
    relevance: Relative time data
  - id: icu
    name: ICU Relative DateTime
    relevance: Formatting specification
tooling:
  analysis_tools:
  - tool: intl-relativetimeformat
    purpose: Built-in JavaScript relative time
  - tool: date-fns
    purpose: formatDistance and formatDistanceToNow
    install: npm install date-fns
  - tool: timeago.js
    purpose: Lightweight relative time library
    install: npm install timeago.js
signals:
  critical:
  - id: I18N-REL-CRIT-001
    signal: Hardcoded relative time strings
    evidence_indicators:
    - Strings like 'minutes ago' in code
    - Template literals building relative time
    explanation: |
      Hardcoded relative time cannot be translated and displays English
      to all users regardless of their locale.
    remediation: Use Intl.RelativeTimeFormat or localized library
  high:
  - id: I18N-REL-HIGH-001
    signal: Relative time not using locale plural rules
    evidence_indicators:
    - count + ' days ago' patterns
    - Simple singular/plural logic
    remediation: Use proper ICU plural-aware formatting
  - id: I18N-REL-HIGH-002
    signal: Custom relative time not localized
    evidence_indicators:
    - Hardcoded 'just now', 'a moment ago'
    - English labels for time periods
    remediation: Use translation keys for all relative expressions
  medium:
  - id: I18N-REL-MED-001
    signal: Inconsistent relative time styles
    evidence_indicators:
    - Mix of 'narrow', 'short', 'long' styles
    - Different granularity across UI
    remediation: Standardize relative time style usage
  - id: I18N-REL-MED-002
    signal: Relative time doesn't auto-update
    evidence_indicators:
    - '''5 minutes ago'' stays forever'
    - Stale relative timestamps
    remediation: Implement automatic relative time updates
  low:
  - id: I18N-REL-LOW-001
    signal: Relative time thresholds not configurable
    remediation: Allow customization of when to show absolute dates
  - id: I18N-REL-LOW-002
    signal: No absolute date fallback/tooltip
    remediation: Show absolute date on hover or after threshold
  positive:
  - id: I18N-REL-POS-001
    signal: Intl.RelativeTimeFormat used consistently
  - id: I18N-REL-POS-002
    signal: Relative times properly localized across all locales
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Relative Time Usage
    description: Find all relative time displays
    duration_estimate: 20 min
  - id: '2'
    name: Analyze Implementation
    description: Review how relative time is generated
    duration_estimate: 30 min
    tools:
    - name: grep
      command: grep -rn 'ago\|RelativeTime\|formatDistance' --include='*.{js,ts,tsx}'
  - id: '3'
    name: Test Locale Formatting
    description: Verify localization in different locales
    duration_estimate: 45 min
  - id: '4'
    name: Test Plural Rules
    description: Verify correct pluralization
    duration_estimate: 30 min
  - id: '5'
    name: Check Update Behavior
    description: Test automatic update functionality
    duration_estimate: 15 min
  - id: '6'
    name: Document Findings
    description: Compile relative time audit report
    duration_estimate: 20 min
output:
  deliverables:
  - type: relative_time_inventory
    format: tabular
    description: All relative time usages with implementation details
  - type: localization_status
    format: structured
    description: Relative time localization by locale
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Implementation Analysis
    - Localization Status
    - Plural Rule Compliance
    - Recommendations
closeout_checklist:
- id: i18n-rel-001
  item: All relative times use locale-aware formatting
  level: ERROR
  verification: automated
- id: i18n-rel-002
  item: Plural rules respected for all locales
  level: WARNING
  verification: automated
- id: i18n-rel-003
  item: Consistent relative time styling
  level: INFO
  verification: manual
governance:
  applicable_to:
    archetypes:
    - global-applications
    - social-platforms
    - content-applications
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: UX-Standards
    control: Time Display
    description: User-friendly time presentation
relationships:
  commonly_combined:
  - internationalization-localization.date-time-localization.date-format-consistency
  - internationalization-localization.text-handling.pluralization-gender
  depends_on:
  - internationalization-localization.locale-detection.user-locale-detection
  feeds_into:
  - internationalization-localization.testing-validation.locale-coverage
