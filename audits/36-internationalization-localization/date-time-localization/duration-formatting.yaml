audit:
  id: internationalization-localization.date-time-localization.duration-formatting
  name: Duration Formatting Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: date-time-localization
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates localization of duration displays such as "3 hours 45 minutes",
    "2h 30m", video lengths, time remaining, and elapsed time. Examines
    format consistency, unit abbreviations, plural rules, and locale-specific
    duration conventions.
  why_it_matters: |
    Duration formats vary by locale and context. Some locales use "h" for
    hours, others spell out "hours", and plural rules differ. Video "1:30:45"
    may need different separators or formats in different regions.
  when_to_run:
  - Before international launches
  - When implementing timer/duration features
  - During localization QA
  - When adding media playback features
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: ui_components
    description: Components displaying durations
  - type: translations
    description: Translations in target locales
  access_requirements:
  - Read access to source code
  - Access to running application
  - Test content with various durations
discovery:
  file_patterns:
  - glob: '**/*duration*'
    purpose: Find duration-related files
  - glob: '**/*timer*'
    purpose: Find timer components
  - glob: '**/*elapsed*'
    purpose: Find elapsed time code
knowledge_sources:
  guides:
  - id: icu-duration
    name: ICU Duration Formatting
    url: https://unicode-org.github.io/icu/userguide/format_parse/datetime/
  - id: cldr-units
    name: CLDR Unit Formatting
    url: https://cldr.unicode.org/translation/units/unit-expressions
  standards:
  - id: iso-8601-duration
    name: ISO 8601 Duration
    relevance: Duration format standard
  - id: cldr
    name: CLDR Unit Data
    relevance: Locale unit formatting
tooling:
  analysis_tools:
  - tool: intl-durationformat
    purpose: Upcoming Intl.DurationFormat
  - tool: luxon
    purpose: Duration formatting
    install: npm install luxon
  - tool: date-fns
    purpose: formatDuration function
    install: npm install date-fns
signals:
  critical:
  - id: I18N-DUR-CRIT-001
    signal: Hardcoded duration unit strings
    evidence_indicators:
    - hours + ' hours' patterns
    - English unit names in code
    explanation: |
      Hardcoded duration strings display English units to all users
      regardless of locale.
    remediation: Use locale-aware duration formatting
  high:
  - id: I18N-DUR-HIGH-001
    signal: Duration plurals not handled correctly
    evidence_indicators:
    - '''1 hours'' displaying'
    - No plural rule consideration
    remediation: Use ICU plural format for duration units
  - id: I18N-DUR-HIGH-002
    signal: Unit abbreviations hardcoded
    evidence_indicators:
    - Hardcoded 'h', 'm', 's'
    - No locale unit abbreviations
    remediation: Use locale-specific unit abbreviations from CLDR
  medium:
  - id: I18N-DUR-MED-001
    signal: Inconsistent duration formats
    evidence_indicators:
    - Mix of '2h 30m' and '2 hours, 30 minutes'
    - Different styles across features
    remediation: Standardize duration format styles
  - id: I18N-DUR-MED-002
    signal: Time separators not localized
    evidence_indicators:
    - '''1:30:45'' separator not locale-aware'
    - Colon used in all locales
    remediation: Use locale-appropriate time separators
  low:
  - id: I18N-DUR-LOW-001
    signal: Very short durations not gracefully handled
    remediation: Add support for 'less than a minute' formatting
  - id: I18N-DUR-LOW-002
    signal: Duration precision not appropriate for context
    remediation: Adjust precision based on use case
  positive:
  - id: I18N-DUR-POS-001
    signal: Fully localized duration formatting
  - id: I18N-DUR-POS-002
    signal: Consistent duration styles throughout
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Duration Displays
    description: Find all duration displays in application
    duration_estimate: 20 min
  - id: '2'
    name: Analyze Implementation
    description: Review duration formatting code
    duration_estimate: 30 min
    tools:
    - name: grep
      command: grep -rn 'hour\|minute\|second\|duration' --include='*.{js,ts,tsx}'
  - id: '3'
    name: Test Locale Formatting
    description: Verify duration display in different locales
    duration_estimate: 45 min
  - id: '4'
    name: Test Plural Rules
    description: Verify correct pluralization
    duration_estimate: 20 min
  - id: '5'
    name: Check Consistency
    description: Compare formats across features
    duration_estimate: 15 min
  - id: '6'
    name: Document Findings
    description: Compile duration formatting audit report
    duration_estimate: 20 min
output:
  deliverables:
  - type: duration_inventory
    format: tabular
    description: All duration displays with format details
  - type: localization_status
    format: structured
    description: Duration localization by locale
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Duration Format Analysis
    - Plural Rule Compliance
    - Consistency Review
    - Recommendations
closeout_checklist:
- id: i18n-dur-001
  item: Duration units properly localized
  level: ERROR
  verification: automated
- id: i18n-dur-002
  item: Plural rules applied correctly
  level: WARNING
  verification: automated
- id: i18n-dur-003
  item: Consistent duration styling
  level: INFO
  verification: manual
governance:
  applicable_to:
    archetypes:
    - global-applications
    - media-platforms
    - productivity-apps
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: UX-Standards
    control: Time Display
    description: User-friendly duration display
relationships:
  commonly_combined:
  - internationalization-localization.date-time-localization.relative-time-formatting
  - internationalization-localization.number-currency-formatting.number-formats
  depends_on:
  - internationalization-localization.locale-detection.user-locale-detection
  feeds_into:
  - internationalization-localization.testing-validation.locale-coverage
