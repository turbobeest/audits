audit:
  id: internationalization-localization.date-time-localization.timezone-handling
  name: Timezone Handling Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: date-time-localization
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates how the application handles timezones across storage,
    processing, display, and user preferences. Examines UTC storage
    practices, timezone conversion accuracy, daylight saving transitions,
    and user timezone detection and configuration.
  why_it_matters: |
    Incorrect timezone handling causes missed appointments, incorrect
    deadlines, data inconsistencies, and user confusion. With users across
    time zones, proper handling is essential for scheduling, auditing,
    and communication features.
  when_to_run:
  - Before launching in new regions
  - When implementing scheduling features
  - After timezone library updates
  - During daylight saving transitions
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: database_schema
    description: Database schema for datetime fields
  - type: api_documentation
    description: API datetime specifications
  access_requirements:
  - Read access to source code
  - Access to database schema
  - Test environment in multiple timezones
discovery:
  file_patterns:
  - glob: '**/*.{js,ts,py,java,go,rb}'
    purpose: Find source code with date handling
  - glob: '**/schema*.{sql,prisma,graphql}'
    purpose: Find database schema definitions
  - glob: '**/date*.{js,ts}'
    purpose: Find date utility modules
knowledge_sources:
  guides:
  - id: tz-best-practices
    name: Timezone Best Practices
    url: https://www.creativedeletion.com/2015/01/28/falsehoods-programmers-believe-about-time.html
  - id: iana-tz
    name: IANA Time Zone Database
    url: https://www.iana.org/time-zones
  standards:
  - id: iso-8601
    name: ISO 8601
    relevance: Date and time format standard
  - id: iana-tzdb
    name: IANA Time Zone Database
    relevance: Authoritative timezone data
tooling:
  analysis_tools:
  - tool: moment-timezone
    purpose: JavaScript timezone library
    install: npm install moment-timezone
  - tool: luxon
    purpose: Modern datetime library
    install: npm install luxon
  - tool: date-fns-tz
    purpose: Timezone utilities for date-fns
    install: npm install date-fns-tz
  - tool: pytz
    purpose: Python timezone library
    install: pip install pytz
signals:
  critical:
  - id: I18N-TZ-CRIT-001
    signal: Dates stored without timezone information
    evidence_indicators:
    - DATETIME columns without timezone
    - Local time stored as UTC
    explanation: |
      Dates without timezone info are ambiguous and will display
      incorrectly when accessed from different timezones.
    remediation: Store all dates in UTC with timezone metadata
  - id: I18N-TZ-CRIT-002
    signal: Server timezone assumed for all users
    evidence_indicators:
    - No user timezone preference
    - All dates rendered in server local time
    explanation: |
      Using server timezone displays incorrect times for users in
      other timezones, causing missed events and confusion.
    remediation: Implement user timezone detection and preference
  high:
  - id: I18N-TZ-HIGH-001
    signal: DST transitions not handled correctly
    evidence_indicators:
    - Times shift by hour during DST changes
    - Recurring events skip or duplicate during DST
    remediation: Use timezone-aware libraries that handle DST
  - id: I18N-TZ-HIGH-002
    signal: Timezone offset hardcoded
    evidence_indicators:
    - GMT+5 or similar hardcoded values
    - Fixed offset instead of IANA timezone
    remediation: Use IANA timezone identifiers (America/New_York)
  medium:
  - id: I18N-TZ-MED-001
    signal: Outdated timezone database
    evidence_indicators:
    - Old tzdata version
    - Recent timezone changes not reflected
    remediation: Update timezone database regularly
  - id: I18N-TZ-MED-002
    signal: No timezone displayed with times
    evidence_indicators:
    - Times shown without timezone indicator
    - Ambiguous time display
    remediation: Include timezone abbreviation or offset in display
  low:
  - id: I18N-TZ-LOW-001
    signal: Timezone change not immediately reflected
    remediation: Update cached times on timezone change
  - id: I18N-TZ-LOW-002
    signal: Inconsistent timezone handling across features
    remediation: Standardize timezone handling patterns
  positive:
  - id: I18N-TZ-POS-001
    signal: All dates stored in UTC with proper conversion
  - id: I18N-TZ-POS-002
    signal: User timezone preference respected throughout
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Database Schema
    description: Check datetime field definitions
    duration_estimate: 30 min
  - id: '2'
    name: Analyze Storage Patterns
    description: Verify UTC storage practices
    duration_estimate: 30 min
  - id: '3'
    name: Test Timezone Conversion
    description: Verify correct display in different timezones
    duration_estimate: 45 min
  - id: '4'
    name: DST Transition Testing
    description: Test behavior around DST changes
    duration_estimate: 30 min
  - id: '5'
    name: User Preference Flow
    description: Verify timezone preference handling
    duration_estimate: 30 min
  - id: '6'
    name: Document Findings
    description: Compile timezone audit report
    duration_estimate: 30 min
output:
  deliverables:
  - type: timezone_assessment
    format: structured
    description: Timezone handling status across system
  - type: issue_list
    format: tabular
    description: Timezone issues found with severity
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Storage Analysis
    - Display Handling
    - DST Assessment
    - Recommendations
closeout_checklist:
- id: i18n-tz-001
  item: All dates stored in UTC
  level: ERROR
  verification: automated
- id: i18n-tz-002
  item: User timezone preference available
  level: WARNING
  verification: manual
- id: i18n-tz-003
  item: DST transitions handled correctly
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - global-applications
    - scheduling-systems
    - multi-region
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: Data-Integrity
    control: Temporal Data
    description: Accurate time data requirements
  - framework: Audit-Requirements
    control: Timestamp Accuracy
    description: Audit trail requirements
relationships:
  commonly_combined:
  - internationalization-localization.date-time-localization.date-format-consistency
  - data-management.data-integrity
  depends_on:
  - database-management.schema-design
  feeds_into:
  - internationalization-localization.testing-validation.locale-coverage
