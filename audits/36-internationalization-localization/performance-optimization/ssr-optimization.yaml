audit:
  id: internationalization-localization.performance-optimization.ssr-optimization
  name: i18n SSR Optimization Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: performance-optimization
  tier: expert
  estimated_duration: 2-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates server-side rendering optimization for internationalization
    including locale detection during SSR, translation hydration, locale
    caching on server, and avoiding hydration mismatches. Ensures SSR
    delivers properly localized content efficiently.
  why_it_matters: |
    SSR is crucial for SEO and initial load performance. Improper i18n
    handling in SSR can cause hydration mismatches, slow server response,
    or serve wrong locale content. Optimized SSR serves correctly localized
    content quickly.
  when_to_run:
  - When implementing SSR with i18n
  - After SSR performance issues
  - When adding new locales
  - During SEO optimization
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: server_code
    description: SSR server implementation
  - type: running_application
    description: SSR application access
  access_requirements:
  - Read access to source code
  - Access to server logs
  - Server performance monitoring
discovery:
  file_patterns:
  - glob: '**/server*.{js,ts}'
    purpose: Find server code
  - glob: '**/ssr*.{js,ts}'
    purpose: Find SSR implementation
  - glob: '**/pages/_document*'
    purpose: Find Next.js document
  - glob: '**/getServerSideProps*'
    purpose: Find SSR data fetching
knowledge_sources:
  guides:
  - id: nextjs-i18n
    name: Next.js i18n
    url: https://nextjs.org/docs/advanced-features/i18n-routing
  - id: i18next-ssr
    name: i18next SSR
    url: https://www.i18next.com/overview/plugins-and-utils#ssr
  standards:
  - id: ssr-best-practices
    name: SSR Best Practices
    relevance: SSR patterns
tooling:
  analysis_tools:
  - tool: chrome-devtools
    purpose: Hydration analysis
  - tool: server-timing
    purpose: Server performance metrics
  - tool: lighthouse
    purpose: SSR performance audit
signals:
  critical:
  - id: I18N-SSR-CRIT-001
    signal: Hydration mismatch due to locale
    evidence_indicators:
    - Console hydration warnings
    - Content flickers on load
    explanation: |
      Hydration mismatches cause content to change after load,
      creating poor UX and potential layout shifts.
    remediation: Ensure SSR and client use same locale
  - id: I18N-SSR-CRIT-002
    signal: Wrong locale served by SSR
    evidence_indicators:
    - SEO crawlers see wrong language
    - Initial HTML in wrong locale
    explanation: |
      Wrong locale in SSR hurts SEO and causes flash of
      wrong content.
    remediation: Properly detect locale during SSR
  high:
  - id: I18N-SSR-HIGH-001
    signal: Translations loaded synchronously in SSR
    evidence_indicators:
    - Slow TTFB for localized pages
    - Translation loading blocking response
    remediation: Cache translations on server
  - id: I18N-SSR-HIGH-002
    signal: No translation caching on server
    evidence_indicators:
    - Translations loaded per request
    - No server-side translation cache
    remediation: Implement server-side translation caching
  medium:
  - id: I18N-SSR-MED-001
    signal: Locale detection slow in SSR
    evidence_indicators:
    - Header parsing taking time
    - Geo-IP lookup blocking
    remediation: Optimize locale detection for SSR
  - id: I18N-SSR-MED-002
    signal: All locales loaded on server
    evidence_indicators:
    - Server memory high from translations
    - All locales in server memory
    remediation: Load only needed locale on server
  low:
  - id: I18N-SSR-LOW-001
    signal: No streaming SSR for i18n
    remediation: Consider streaming for large pages
  - id: I18N-SSR-LOW-002
    signal: Translation state transfer not optimized
    remediation: Optimize state transfer to client
  positive:
  - id: I18N-SSR-POS-001
    signal: Optimized SSR with proper locale handling
  - id: I18N-SSR-POS-002
    signal: No hydration mismatches
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Analyze SSR Output
    description: Review server-rendered HTML for locale
    duration_estimate: 30 min
  - id: '2'
    name: Check Hydration
    description: Test for hydration mismatches
    duration_estimate: 30 min
  - id: '3'
    name: Profile Server Performance
    description: Measure SSR i18n overhead
    duration_estimate: 45 min
  - id: '4'
    name: Review Locale Detection
    description: Analyze SSR locale detection
    duration_estimate: 20 min
  - id: '5'
    name: Check Caching
    description: Review server translation caching
    duration_estimate: 20 min
  - id: '6'
    name: Document Findings
    description: Compile SSR optimization report
    duration_estimate: 25 min
output:
  deliverables:
  - type: ssr_analysis
    format: structured
    description: SSR i18n implementation review
  - type: performance_metrics
    format: tabular
    description: SSR performance by locale
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - SSR Implementation
    - Hydration Analysis
    - Performance Impact
    - Recommendations
closeout_checklist:
- id: i18n-ssr-001
  item: No hydration mismatches
  level: ERROR
  verification: automated
- id: i18n-ssr-002
  item: Correct locale in SSR output
  level: ERROR
  verification: manual
- id: i18n-ssr-003
  item: Server translation caching
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - ssr-applications
    - seo-focused
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: SEO
    control: Internationalization
    description: SEO locale requirements
  - framework: Web-Vitals
    control: LCP
    description: Largest Contentful Paint
relationships:
  commonly_combined:
  - internationalization-localization.locale-detection.url-locale-handling
  - frontend-performance.ssr-performance
  depends_on:
  - frontend-architecture.ssr-implementation
  feeds_into:
  - seo-optimization.international-seo
