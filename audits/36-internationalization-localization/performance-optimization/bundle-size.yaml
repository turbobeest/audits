audit:
  id: internationalization-localization.performance-optimization.bundle-size
  name: i18n Bundle Size Optimization Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: performance-optimization
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: full
  severity: medium
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the impact of internationalization on application bundle size
    including translation files, i18n libraries, date/time libraries, and
    locale data. Examines strategies for keeping bundles lean while
    supporting multiple locales.
  why_it_matters: |
    Translation files and locale data can significantly bloat bundle size.
    Loading all locales when only one is needed wastes bandwidth and slows
    initial load time. Users in slower network regions are disproportionately
    affected.
  when_to_run:
  - When optimizing performance
  - After adding new locales
  - During bundle analysis
  - When i18n libraries change
prerequisites:
  required_artifacts:
  - type: build_output
    description: Production build artifacts
  - type: bundle_analysis
    description: Bundle analyzer output
  - type: source_code
    description: Application source code
  access_requirements:
  - Access to build system
  - Bundle analyzer tools
  - Production build capability
discovery:
  file_patterns:
  - glob: '**/dist/**'
    purpose: Find build output
  - glob: '**/build/**'
    purpose: Find build artifacts
  - glob: '**/webpack*.config.*'
    purpose: Find webpack configuration
  - glob: '**/locales/**'
    purpose: Find locale files
knowledge_sources:
  guides:
  - id: webpack-i18n
    name: Webpack i18n Optimization
    url: https://webpack.js.org/guides/public-path/
  - id: moment-locale
    name: Moment.js Locale Optimization
    url: https://momentjs.com/docs/#/use-it/webpack/
  standards:
  - id: web-vitals
    name: Core Web Vitals
    relevance: Performance metrics
tooling:
  analysis_tools:
  - tool: webpack-bundle-analyzer
    purpose: Visualize bundle content
    install: npm install -D webpack-bundle-analyzer
  - tool: source-map-explorer
    purpose: Analyze bundle sources
    install: npm install -D source-map-explorer
  - tool: bundlephobia
    purpose: Check package sizes
    url: https://bundlephobia.com/
signals:
  critical:
  - id: I18N-BUNDLE-CRIT-001
    signal: All locale data bundled together
    evidence_indicators:
    - Single bundle with all translations
    - No code splitting for locales
    explanation: |
      Bundling all locales forces users to download translations
      they'll never use, significantly impacting load time.
    remediation: Implement per-locale code splitting
  high:
  - id: I18N-BUNDLE-HIGH-001
    signal: Heavy i18n libraries included entirely
    evidence_indicators:
    - Full moment.js with all locales
    - Large ICU data in bundle
    remediation: Use tree-shakeable alternatives or subset data
  - id: I18N-BUNDLE-HIGH-002
    signal: Duplicate locale data
    evidence_indicators:
    - Same translations in multiple chunks
    - Locale data duplicated across splits
    remediation: Deduplicate locale data in bundling
  medium:
  - id: I18N-BUNDLE-MED-001
    signal: CLDR data not optimized
    evidence_indicators:
    - Full CLDR data bundled
    - Unused CLDR modules included
    remediation: Include only needed CLDR modules
  - id: I18N-BUNDLE-MED-002
    signal: Translation files not minified
    evidence_indicators:
    - JSON files with whitespace
    - No JSON minification
    remediation: Minify translation JSON files
  low:
  - id: I18N-BUNDLE-LOW-001
    signal: Locale keys not optimized
    remediation: Consider key minification for production
  - id: I18N-BUNDLE-LOW-002
    signal: Unused translations in bundles
    remediation: Remove unused translation keys
  positive:
  - id: I18N-BUNDLE-POS-001
    signal: Per-locale code splitting implemented
  - id: I18N-BUNDLE-POS-002
    signal: Minimal i18n footprint in main bundle
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Generate Bundle Analysis
    description: Create bundle visualization
    duration_estimate: 15 min
    tools:
    - name: webpack-bundle-analyzer
      command: npx webpack-bundle-analyzer stats.json
  - id: '2'
    name: Identify i18n Contributions
    description: Find locale-related bundle content
    duration_estimate: 30 min
  - id: '3'
    name: Analyze Locale Loading
    description: Review how locales are loaded
    duration_estimate: 30 min
  - id: '4'
    name: Check Library Sizes
    description: Assess i18n library footprint
    duration_estimate: 20 min
  - id: '5'
    name: Compare Optimizations
    description: Evaluate potential optimizations
    duration_estimate: 25 min
  - id: '6'
    name: Document Findings
    description: Compile bundle size audit report
    duration_estimate: 20 min
output:
  deliverables:
  - type: bundle_analysis
    format: visual
    description: Bundle composition visualization
  - type: size_breakdown
    format: tabular
    description: i18n component sizes
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Bundle Composition
    - Locale Loading Strategy
    - Optimization Opportunities
    - Recommendations
closeout_checklist:
- id: i18n-bundle-001
  item: Locales code-split appropriately
  level: WARNING
  verification: automated
- id: i18n-bundle-002
  item: i18n libraries optimized
  level: WARNING
  verification: automated
- id: i18n-bundle-003
  item: No unnecessary locale data
  level: INFO
  verification: automated
governance:
  applicable_to:
    archetypes:
    - global-applications
    - performance-sensitive
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: Web-Vitals
    control: LCP/FID
    description: Core Web Vitals impact
  - framework: Performance
    control: Bundle Size
    description: Performance requirements
relationships:
  commonly_combined:
  - internationalization-localization.performance-optimization.lazy-loading
  - frontend-performance.bundle-optimization
  depends_on:
  - frontend-architecture.build-configuration
  feeds_into:
  - frontend-performance.load-time
