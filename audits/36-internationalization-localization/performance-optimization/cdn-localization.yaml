audit:
  id: internationalization-localization.performance-optimization.cdn-localization
  name: CDN Localization Optimization Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: internationalization-localization
  category_number: 36
  subcategory: performance-optimization
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: localization
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates CDN configuration for serving localized content including
    edge caching by locale, cache key strategies, geo-routing for locale
    assets, and purging strategies for translation updates. Ensures CDN
    optimally delivers localized content globally.
  why_it_matters: |
    CDN configuration significantly impacts performance for global users.
    Incorrect cache keys can serve wrong locale, poor geo-routing increases
    latency, and slow purging delays translation updates. Proper CDN setup
    is essential for global performance.
  when_to_run:
  - When configuring CDN for i18n
  - After CDN configuration changes
  - When experiencing wrong locale issues
  - During global performance optimization
prerequisites:
  required_artifacts:
  - type: cdn_config
    description: CDN configuration
  - type: cache_rules
    description: Caching rules and keys
  - type: network_analysis
    description: CDN request analysis
  access_requirements:
  - Access to CDN configuration
  - CDN analytics access
  - Ability to test from different regions
discovery:
  file_patterns:
  - glob: '**/cdn*.config*'
    purpose: Find CDN configuration
  - glob: '**/cloudflare*'
    purpose: Find Cloudflare config
  - glob: '**/vercel.json'
    purpose: Find Vercel config
  - glob: '**/netlify.toml'
    purpose: Find Netlify config
knowledge_sources:
  guides:
  - id: cloudflare-i18n
    name: Cloudflare i18n
    url: https://developers.cloudflare.com/workers/examples/localize-a-website/
  - id: cdn-caching
    name: CDN Caching Best Practices
    url: https://developer.fastly.com/
  standards:
  - id: http-caching
    name: HTTP Caching
    relevance: Cache-Control, Vary headers
tooling:
  analysis_tools:
  - tool: cloudflare-dashboard
    purpose: CDN analytics
  - tool: webpagetest
    purpose: Multi-region testing
  - tool: pingdom
    purpose: Global performance monitoring
signals:
  critical:
  - id: I18N-CDN-CRIT-001
    signal: CDN serving wrong locale
    evidence_indicators:
    - Cached English served to German users
    - Locale not in cache key
    explanation: |
      Wrong locale from CDN serves inappropriate content
      to users and can be difficult to debug.
    remediation: Include locale in CDN cache key
  high:
  - id: I18N-CDN-HIGH-001
    signal: No Vary header for Accept-Language
    evidence_indicators:
    - 'Missing Vary: Accept-Language'
    - Same cached response for all locales
    remediation: Add appropriate Vary headers
  - id: I18N-CDN-HIGH-002
    signal: Translation updates stuck in cache
    evidence_indicators:
    - Old translations served
    - No purge on deployment
    remediation: Implement cache purging for translation updates
  medium:
  - id: I18N-CDN-MED-001
    signal: Locale assets not geo-distributed
    evidence_indicators:
    - All locales served from single region
    - High latency for distant regions
    remediation: Configure edge caching for all regions
  - id: I18N-CDN-MED-002
    signal: Cache hit rate low for translations
    evidence_indicators:
    - Frequent origin requests
    - Poor cache efficiency
    remediation: Optimize cache key and TTL
  low:
  - id: I18N-CDN-LOW-001
    signal: No cache warming for new locales
    remediation: Consider cache warming strategies
  - id: I18N-CDN-LOW-002
    signal: Brotli compression not enabled
    remediation: Enable Brotli for text content
  positive:
  - id: I18N-CDN-POS-001
    signal: Optimized CDN configuration for i18n
  - id: I18N-CDN-POS-002
    signal: High cache hit rate for translations
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review CDN Configuration
    description: Analyze CDN setup for i18n
    duration_estimate: 30 min
  - id: '2'
    name: Check Cache Keys
    description: Verify locale included in cache keys
    duration_estimate: 20 min
  - id: '3'
    name: Test from Multiple Regions
    description: Verify correct locale served globally
    duration_estimate: 30 min
  - id: '4'
    name: Analyze Cache Performance
    description: Review cache hit rates by locale
    duration_estimate: 20 min
  - id: '5'
    name: Test Cache Purging
    description: Verify purging works correctly
    duration_estimate: 20 min
  - id: '6'
    name: Document Findings
    description: Compile CDN localization report
    duration_estimate: 20 min
output:
  deliverables:
  - type: cdn_analysis
    format: structured
    description: CDN i18n configuration assessment
  - type: performance_metrics
    format: tabular
    description: Cache performance by region/locale
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - CDN Configuration
    - Cache Key Analysis
    - Global Performance
    - Recommendations
closeout_checklist:
- id: i18n-cdn-001
  item: Locale in cache key
  level: ERROR
  verification: manual
- id: i18n-cdn-002
  item: Vary headers configured
  level: WARNING
  verification: automated
- id: i18n-cdn-003
  item: Cache purging working
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - global-applications
    - high-traffic
    company_sizes:
    - startup
    - scaleup
    - enterprise
  compliance_mappings:
  - framework: Performance
    control: CDN
    description: CDN optimization
  - framework: Web-Vitals
    control: TTFB
    description: Time to First Byte
relationships:
  commonly_combined:
  - internationalization-localization.performance-optimization.caching
  - infrastructure.cdn-configuration
  depends_on:
  - infrastructure.cdn-setup
  feeds_into:
  - frontend-performance.global-performance
