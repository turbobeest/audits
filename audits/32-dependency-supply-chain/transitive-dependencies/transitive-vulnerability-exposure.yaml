audit:
  id: dependency-supply-chain.transitive-dependencies.transitive-vulnerability-exposure
  name: Transitive Vulnerability Exposure Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: dependency-supply-chain
  category_number: 32
  subcategory: transitive-dependencies
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: high
  scope: dependencies
  default_profiles:
  - full
  - security
  blocks_phase: true
  parallelizable: true
description:
  what: |
    This audit specifically examines vulnerabilities in transitive
    dependencies, tracing the path from direct deps to vulnerable
    transitives. It helps understand which direct dependencies are
    responsible for introducing vulnerable packages.
  why_it_matters: |
    Most vulnerabilities affecting projects come from transitive
    dependencies. Understanding the dependency path is crucial for
    remediation - you can't fix a transitive directly, only through
    the direct dep that brings it in.
  when_to_run:
  - After vulnerability scans
  - When planning remediation
  - During security assessments
  - Before releases
prerequisites:
  required_artifacts:
  - type: vulnerability_report
    description: Output from vulnerability scanning
  - type: lock_file
    description: Lock file for dependency resolution
  access_requirements:
  - Access to vulnerability scan results
  - Package manager CLI
discovery:
  file_patterns:
  - glob: '**/package-lock.json'
    purpose: Dependency resolution data
knowledge_sources:
  guides:
  - id: npm-explain
    name: npm Explain Command
    url: https://docs.npmjs.com/cli/v9/commands/npm-explain
  standards:
  - id: vulnerability-remediation
    name: Transitive Vulnerability Remediation
    relevance: Fixing vulnerabilities in transitives
tooling:
  analysis_tools:
  - tool: npm explain
    purpose: Trace why package is installed
  - tool: npm audit
    purpose: Find vulnerabilities with paths
  - tool: snyk
    purpose: Dependency path analysis
signals:
  critical:
  - id: DEP-TVULN-CRIT-001
    signal: Critical vulnerability in transitive with no fix available
    evidence_indicators:
    - Direct dep hasn't updated transitive
    - No newer version of direct dep
    explanation: |
      When a transitive vulnerability has no path to resolution through
      normal updates, you may need to use overrides, fork, or find
      alternative dependencies.
    remediation: Use overrides; consider forking or replacing direct dep
  high:
  - id: DEP-TVULN-HIGH-001
    signal: Vulnerable transitive brought by multiple direct deps
    evidence_indicators:
    - Same vulnerable package from different paths
    - Multiple direct deps need updating
    remediation: Update all direct deps bringing vulnerable transitive
  - id: DEP-TVULN-HIGH-002
    signal: Direct dep slow to update vulnerable transitive
    evidence_indicators:
    - Fix available but direct dep not updated
    - Upstream PR pending for months
    remediation: Use override; consider alternative; contribute upstream
  medium:
  - id: DEP-TVULN-MED-001
    signal: Minor vulnerable transitive deep in tree
    evidence_indicators:
    - Vulnerability in deeply nested transitive
    - Low severity
    remediation: Document; update when direct dep releases
  - id: DEP-TVULN-MED-002
    signal: Multiple paths to same vulnerable transitive
    evidence_indicators:
    - Override needed for multiple paths
    - Complex resolution required
    remediation: Use broad override; document carefully
  low:
  - id: DEP-TVULN-LOW-001
    signal: Vulnerable transitive in dev-only path
    evidence_indicators:
    - Vulnerability in dev tool's transitive
    - Not in production bundle
    remediation: Lower priority; update when convenient
  positive:
  - id: DEP-TVULN-POS-001
    signal: No transitive vulnerabilities
  - id: DEP-TVULN-POS-002
    signal: Clear remediation path for all vulnerabilities
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Run npm Audit
    description: Get vulnerability report with paths
    commands:
    - purpose: Run npm audit with paths
      command: 'npm audit --json 2>/dev/null | jq ''.vulnerabilities | to_entries[] | {name: .key, severity:
        .value.severity, via: .value.via}'' | head -50 || echo ''npm audit not available'''
  - id: '2'
    name: Trace Vulnerable Package
    description: Find why vulnerable package is installed
    commands:
    - purpose: Explain vulnerability path
      command: 'npm explain minimist 2>/dev/null | head -30 || echo ''Use: npm explain [vulnerable-package]
        to trace path'''
  - id: '3'
    name: Identify Direct Dep Responsible
    description: Find which direct dep brings vulnerability
    commands:
    - purpose: Get direct dep for transitive
      command: 'npm ls minimist 2>/dev/null | head -20 || echo ''Use: npm ls [package] to see tree'''
  - id: '4'
    name: Check If Fix Available
    description: See if direct dep has updated
    commands:
    - purpose: Check for updates
      command: npm outdated $(npm ls --depth=0 --json 2>/dev/null | jq -r '.dependencies | keys[]' | head
        -10) 2>/dev/null | head -20 || echo 'Check direct deps for updates'
  - id: '5'
    name: Plan Remediation Path
    description: Determine how to fix each vulnerability
    commands:
    - purpose: Generate remediation template
      command: |-
        echo 'Remediation Path Template:

        Vulnerability: [CVE]
        Vulnerable Package: [name@version]
        Path: direct-dep -> trans1 -> trans2 -> vulnerable

        Remediation Options:
        1. Update direct-dep to [version] (if fixes transitive)
        2. Use override: "override": {"vulnerable-pkg": "fixed-version"}
        3. Replace direct-dep with alternative
        4. Accept risk (document justification)'
  - id: '6'
    name: Verify Fixes
    description: Confirm remediation resolves vulnerability
    commands:
    - purpose: Check after remediation
      command: npm audit --audit-level=high 2>/dev/null || echo 'Verify with npm audit after applying
        fixes'
output:
  deliverables:
  - type: transitive_vulnerability_map
    format: structured
    description: Map of vulnerabilities to dependency paths
  - type: remediation_plan
    format: structured
    description: Plan for fixing each vulnerability
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Transitive Vulnerability Analysis
    - Dependency Path Mapping
    - Remediation Plan
    - Recommendations
closeout_checklist:
- id: dep-tvuln-001
  item: All vulnerable transitives traced to source
  level: CRITICAL
  verification: Paths documented
- id: dep-tvuln-002
  item: Remediation path identified for each
  level: CRITICAL
  verification: Remediation plan complete
- id: dep-tvuln-003
  item: Critical vulnerabilities have immediate plan
  level: CRITICAL
  verification: Critical issues prioritized
- id: dep-tvuln-004
  item: Overrides documented if needed
  level: REQUIRED
  verification: Override comments present
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: SOC 2
    control: CC6.1
    description: Vulnerability remediation
  - framework: PCI DSS
    control: '6.2'
    description: Address known vulnerabilities
relationships:
  commonly_combined:
  - dependency-supply-chain.vulnerability-scanning.cve-detection
  depends_on:
  - dependency-supply-chain.vulnerability-scanning.cve-detection
  feeds_into:
  - dependency-supply-chain.transitive-dependencies.transitive-override
