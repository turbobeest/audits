audit:
  id: dependency-supply-chain.license-compliance.license-change-monitoring
  name: License Change Monitoring Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: dependency-supply-chain
  category_number: 32
  subcategory: license-compliance
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: dependencies
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates whether systems are in place to detect when
    dependencies change their licenses. License changes in new versions
    can create compliance issues if not caught before updating.
  why_it_matters: |
    Some packages have changed licenses between versions (e.g., more
    restrictive licenses, or source-available licenses like SSPL).
    Updating without noticing a license change can unexpectedly create
    compliance obligations or conflicts.
  when_to_run:
  - Before major dependency updates
  - When configuring automated updates
  - After license compliance incidents
  - During dependency audit setup
prerequisites:
  required_artifacts:
  - type: dependency_manifest
    description: Current dependency versions
  - type: license_inventory
    description: Baseline license information
  access_requirements:
  - Access to dependency history
  - Access to package metadata
discovery:
  file_patterns:
  - glob: '**/package.json'
    purpose: Find npm dependencies
  - glob: '**/package-lock.json'
    purpose: Find locked versions
knowledge_sources:
  guides:
  - id: license-changes
    name: Notable License Changes
    url: https://github.com/readme/guides/open-source-licensing
  standards:
  - id: spdx-diff
    name: License Comparison
    relevance: Detecting license changes
tooling:
  analysis_tools:
  - tool: license-checker
    purpose: Compare licenses across versions
  - tool: fossa
    purpose: License change detection
  - tool: snyk
    purpose: License monitoring
signals:
  critical:
  - id: DEP-CHNG-CRIT-001
    signal: Dependency changed to incompatible license
    evidence_indicators:
    - Package moved from MIT to GPL
    - Previously permissive now copyleft
    explanation: |
      License changes can create immediate compliance issues.
      Continuing to update could automatically introduce
      incompatible licenses.
    remediation: Pin to last compatible version; find alternative
  - id: DEP-CHNG-CRIT-002
    signal: No license change detection in place
    evidence_indicators:
    - No monitoring for license changes
    - Updates applied without license review
    remediation: Implement license change detection
  high:
  - id: DEP-CHNG-HIGH-001
    signal: Package moved to source-available license
    evidence_indicators:
    - BSL, SSPL, Elastic License detected
    - Previously open source, now restricted
    remediation: Assess new terms; may need to stay on old version
  - id: DEP-CHNG-HIGH-002
    signal: License addition restricts usage
    evidence_indicators:
    - Commons Clause added
    - Additional restrictions in new version
    remediation: Review new restrictions; assess impact
  medium:
  - id: DEP-CHNG-MED-001
    signal: License version upgrade
    evidence_indicators:
    - GPL-2.0 to GPL-3.0
    - Apache-1.1 to Apache-2.0
    remediation: Review compatibility with project license
  - id: DEP-CHNG-MED-002
    signal: Dual licensing added or removed
    evidence_indicators:
    - Package previously dual-licensed
    - One license option removed
    remediation: Verify chosen license still available
  low:
  - id: DEP-CHNG-LOW-001
    signal: Minor license text changes
    evidence_indicators:
    - Same license, different wording
    - Typo corrections
    remediation: Note for completeness
  positive:
  - id: DEP-CHNG-POS-001
    signal: License change monitoring active
  - id: DEP-CHNG-POS-002
    signal: No problematic license changes detected
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Baseline Current Licenses
    description: Document current license state
    commands:
    - purpose: Generate current license snapshot
      command: npx license-checker --json 2>/dev/null > /tmp/licenses-current.json && echo 'Baseline captured'
        || echo 'Could not capture baseline'
  - id: '2'
    name: Check for Known License Changes
    description: Review notable license change history
    commands:
    - purpose: Note known license changers
      command: |-
        echo 'Notable License Changes to Watch:

        - Elasticsearch (Apache -> SSPL/Elastic)
        - MongoDB (AGPL -> SSPL)
        - Faker.js (MIT -> released to public domain)
        - Terraformer (MPL -> BSL)
        - Redis modules (BSD -> RSAL/SSPL)

        Search for these in your dependencies.'
  - id: '3'
    name: Compare Across Versions
    description: Check if pending updates change licenses
    commands:
    - purpose: Check npm view for license
      command: 'npm view lodash license 2>/dev/null || echo ''Example: npm view [package] license to check'''
  - id: '4'
    name: Configure Monitoring
    description: Set up license change alerts
    commands:
    - purpose: Document monitoring options
      command: |-
        echo 'License Change Monitoring Options:

        1. FOSSA - Automatic license change alerts
        2. Snyk - License compliance monitoring
        3. GitHub Dependabot - Check release notes for license changes
        4. Manual - Compare license-checker output before/after updates
        5. Socket.dev - Supply chain monitoring includes licenses'
  - id: '5'
    name: Review Update PRs for License Changes
    description: Process for catching changes in reviews
    commands:
    - purpose: Generate review checklist
      command: |-
        echo 'Dependency Update PR Checklist:

        [ ] Check package.json license field changed?
        [ ] Check CHANGELOG for license mentions
        [ ] Run license-checker --diff (if available)
        [ ] Review major version bumps especially closely
        [ ] Check package README for license announcements'
output:
  deliverables:
  - type: monitoring_assessment
    format: structured
    description: Evaluation of license monitoring
  - type: change_risk_report
    format: structured
    description: Dependencies at risk of license changes
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Current Monitoring State
    - Known License Change Risks
    - Recommendations
closeout_checklist:
- id: dep-chng-001
  item: License change detection configured
  level: CRITICAL
  verification: Monitoring tool configured
- id: dep-chng-002
  item: Current licenses baselined
  level: REQUIRED
  verification: Baseline snapshot captured
- id: dep-chng-003
  item: Review process includes license check
  level: REQUIRED
  verification: PR checklist includes license
- id: dep-chng-004
  item: Known risk packages identified
  level: RECOMMENDED
  verification: Risk list documented
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: SOC 2
    control: CC6.1
    description: Change monitoring
  - framework: ISO 27001
    control: A.18.1.2
    description: Intellectual property monitoring
relationships:
  commonly_combined:
  - dependency-supply-chain.license-compliance.license-detection
  depends_on:
  - dependency-supply-chain.license-compliance.license-detection
  feeds_into:
  - dependency-supply-chain.update-management.automated-updates
