audit:
  id: dependency-supply-chain.license-compliance.license-policy-enforcement
  name: License Policy Enforcement Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: dependency-supply-chain
  category_number: 32
  subcategory: license-compliance
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: high
  scope: dependencies
  default_profiles:
  - full
  - quick
  blocks_phase: true
  parallelizable: true
description:
  what: |
    This audit evaluates whether automated license policy enforcement
    is in place to prevent introduction of non-compliant licenses.
    It assesses CI/CD integration, policy configuration, and the
    effectiveness of gatekeeping mechanisms.
  why_it_matters: |
    Without automated enforcement, license violations can slip into
    codebases unnoticed. Catching violations late is expensive and
    disruptive. Automated policy enforcement prevents violations at
    the pull request stage before they become problems.
  when_to_run:
  - When setting up new projects
  - After license incidents
  - During compliance program reviews
  - When updating license policies
prerequisites:
  required_artifacts:
  - type: ci_config
    description: CI/CD pipeline configuration
  - type: license_policy
    description: Documented allowed/denied licenses
  access_requirements:
  - Access to CI/CD configuration
  - Access to license policy documentation
discovery:
  file_patterns:
  - glob: '**/.github/workflows/*.yml'
    purpose: Find GitHub Actions
  - glob: '**/.licensrc*'
    purpose: Find license-checker config
  - glob: '**/.fossa.yml'
    purpose: Find FOSSA config
  - glob: '**/license-policy*'
    purpose: Find license policy files
knowledge_sources:
  guides:
  - id: fossa-policy
    name: FOSSA Policy Management
    url: https://docs.fossa.com/docs/policy
  - id: license-checker-ci
    name: License Checker in CI
    url: https://github.com/davglass/license-checker#ci-integration
  standards:
  - id: spdx-policy
    name: SPDX Policy Standards
    relevance: License policy expression
tooling:
  analysis_tools:
  - tool: license-checker
    purpose: npm license scanning with policy
  - tool: fossa
    purpose: Enterprise license management
  - tool: snyk
    purpose: License policy in security scanning
  - tool: github-dependency-graph
    purpose: GitHub license detection
signals:
  critical:
  - id: DEP-POLICY-CRIT-001
    signal: No automated license enforcement
    evidence_indicators:
    - No license scanning in CI
    - Policy violations not detected
    explanation: |
      Without enforcement, license policies are aspirational.
      Developers may unknowingly add prohibited licenses that
      won't be caught until legal review or audit.
    remediation: Implement license scanning in CI/CD pipeline
  - id: DEP-POLICY-CRIT-002
    signal: Policy violations in production code
    evidence_indicators:
    - Prohibited licenses currently in use
    - Known violations not addressed
    remediation: Remove or replace non-compliant dependencies
  high:
  - id: DEP-POLICY-HIGH-001
    signal: License policy not documented
    evidence_indicators:
    - No written allowed/denied list
    - Decisions made ad-hoc
    remediation: Document license policy
  - id: DEP-POLICY-HIGH-002
    signal: CI checks don't block on violations
    evidence_indicators:
    - License checks run but don't fail builds
    - Warnings ignored
    remediation: Configure license checks to fail builds
  medium:
  - id: DEP-POLICY-MED-001
    signal: Policy not enforced for all dependency types
    evidence_indicators:
    - Only production deps checked
    - Transitive deps not covered
    remediation: Extend policy to all dependencies
  - id: DEP-POLICY-MED-002
    signal: Exception process not defined
    evidence_indicators:
    - No way to approve exceptions
    - Blocked dependencies with no recourse
    remediation: Define exception request process
  low:
  - id: DEP-POLICY-LOW-001
    signal: Policy not regularly reviewed
    evidence_indicators:
    - Policy unchanged for years
    - May not reflect current business needs
    remediation: Schedule annual policy review
  positive:
  - id: DEP-POLICY-POS-001
    signal: Automated license policy enforcement active
  - id: DEP-POLICY-POS-002
    signal: Clear policy with exception process
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Find License Policy Documentation
    description: Locate license policy documents
    commands:
    - purpose: Find policy files
      command: find . -iname '*license*policy*' -o -iname '.licensrc*' 2>/dev/null | grep -v node_modules
        | head -10
  - id: '2'
    name: Check CI for License Scanning
    description: Verify license checks in CI pipeline
    commands:
    - purpose: Check GitHub Actions for license scanning
      command: grep -rE '(license-checker|fossa|snyk.*license)' .github/workflows/ 2>/dev/null || echo
        'No license scanning found in GitHub Actions'
  - id: '3'
    name: Review Policy Configuration
    description: Examine license checker configuration
    commands:
    - purpose: Check for license-checker config
      command: cat .licensrc .licensrc.json .license-checker.json 2>/dev/null || echo 'No license-checker
        config found'
  - id: '4'
    name: Test Policy Enforcement
    description: Verify policy actually blocks violations
    commands:
    - purpose: Run license checker with failure mode
      command: npx license-checker --failOn 'GPL' 2>/dev/null && echo 'No GPL licenses - check passed'
        || echo 'GPL licenses found or tool unavailable'
  - id: '5'
    name: Check for Exception Handling
    description: Verify exception process exists
    commands:
    - purpose: Look for exception documentation
      command: grep -ri 'exception\|override\|allow' .licensrc* license-policy* 2>/dev/null || echo 'No
        exception configuration found'
  - id: '6'
    name: Verify Policy Coverage
    description: Ensure all dependency sources are covered
    commands:
    - purpose: Document coverage gaps
      command: |-
        echo 'Policy Coverage Checklist:

        [ ] npm/Node.js dependencies
        [ ] Python dependencies
        [ ] Go dependencies
        [ ] Container base images
        [ ] Transitive dependencies
        [ ] Development dependencies'
output:
  deliverables:
  - type: enforcement_assessment
    format: structured
    description: Evaluation of policy enforcement
  - type: policy_gaps
    format: list
    description: Gaps in policy coverage
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Current Enforcement State
    - Policy Documentation
    - CI/CD Integration
    - Recommendations
closeout_checklist:
- id: dep-policy-001
  item: License policy documented
  level: CRITICAL
  verification: Policy document exists
- id: dep-policy-002
  item: Automated scanning in CI
  level: CRITICAL
  verification: CI config shows scanning
- id: dep-policy-003
  item: Build fails on violations
  level: REQUIRED
  verification: Test with known violation
- id: dep-policy-004
  item: Exception process defined
  level: RECOMMENDED
  verification: Exception process documented
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: SOC 2
    control: CC6.1
    description: Automated compliance controls
  - framework: ISO 27001
    control: A.18.1.2
    description: Intellectual property compliance
relationships:
  commonly_combined:
  - dependency-supply-chain.license-compliance.license-detection
  depends_on:
  - dependency-supply-chain.license-compliance.license-compatibility
  feeds_into:
  - compliance-legal.automated-compliance
