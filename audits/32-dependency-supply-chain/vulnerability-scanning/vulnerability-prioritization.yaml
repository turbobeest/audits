audit:
  id: dependency-supply-chain.vulnerability-scanning.vulnerability-prioritization
  name: Vulnerability Prioritization Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: dependency-supply-chain
  category_number: 32
  subcategory: vulnerability-scanning
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: dependencies
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit develops a prioritized remediation plan for identified
    vulnerabilities based on exploitability, exposure, business impact,
    and available fixes. It goes beyond CVSS scores to assess real-world
    risk in the context of the specific application and environment.
  why_it_matters: |
    CVSS scores alone don't reflect actual risk. A critical vulnerability
    in unused code poses less risk than a medium vulnerability in an
    internet-facing authentication path. Proper prioritization ensures
    limited security resources address the highest actual risks first.
  when_to_run:
  - After vulnerability scanning
  - When planning remediation sprints
  - During security reviews
  - When resources are limited
prerequisites:
  required_artifacts:
  - type: vulnerability_report
    description: Output from CVE detection scanning
  - type: source_code
    description: To assess vulnerability reachability
  - type: architecture_diagram
    description: To understand exposure paths
  access_requirements:
  - Read access to vulnerability scan results
  - Understanding of application architecture
discovery:
  file_patterns:
  - glob: '**/vulnerability-report*'
    purpose: Find existing vulnerability reports
  - glob: '**/npm-audit*.json'
    purpose: Find npm audit outputs
  - glob: '**/.snyk'
    purpose: Find Snyk configuration
knowledge_sources:
  guides:
  - id: epss
    name: Exploit Prediction Scoring System
    url: https://www.first.org/epss/
  - id: cisa-kev
    name: CISA Known Exploited Vulnerabilities
    url: https://www.cisa.gov/known-exploited-vulnerabilities-catalog
  standards:
  - id: cvss
    name: Common Vulnerability Scoring System
    relevance: Baseline severity scoring
  - id: ssvc
    name: Stakeholder-Specific Vulnerability Categorization
    relevance: Advanced prioritization framework
tooling:
  analysis_tools:
  - tool: snyk
    purpose: Provides reachability analysis
  - tool: trivy
    purpose: Prioritization with EPSS scores
  - tool: grype
    purpose: Severity-based filtering
signals:
  critical:
  - id: DEP-PRIO-CRIT-001
    signal: Exploitable critical vulnerability in exposed code path
    evidence_indicators:
    - Vulnerability reachable from external input
    - Exploit publicly available and simple
    - CISA KEV listed
    explanation: |
      Vulnerabilities that are both severe and easily exploitable in
      exposed code paths represent immediate risk. These require
      emergency response regardless of other factors.
    remediation: Drop everything; remediate within 24 hours
  high:
  - id: DEP-PRIO-HIGH-001
    signal: Critical vulnerability with uncertain reachability
    evidence_indicators:
    - CVSS >= 9.0 but complex attack path
    - Vulnerability in commonly used function
    remediation: Prioritize analysis; remediate within 7 days if reachable
  - id: DEP-PRIO-HIGH-002
    signal: High vulnerability in authentication/authorization code
    evidence_indicators:
    - CVE in auth library that is actively used
    - Authentication bypass potential
    remediation: Prioritize highly; remediate within 7 days
  medium:
  - id: DEP-PRIO-MED-001
    signal: Vulnerability in dev dependency only
    evidence_indicators:
    - CVE in testing framework
    - Package not in production build
    remediation: Update in next maintenance window; lower priority
  - id: DEP-PRIO-MED-002
    signal: Vulnerability with no known exploit
    evidence_indicators:
    - CVE exists but no public exploit
    - Complex attack requirements
    remediation: Schedule remediation within 30 days
  low:
  - id: DEP-PRIO-LOW-001
    signal: Vulnerability in unused code path
    evidence_indicators:
    - Reachability analysis shows no path to vulnerable code
    - Feature containing vulnerability disabled
    remediation: Include in next update cycle; document exception
  positive:
  - id: DEP-PRIO-POS-001
    signal: Clear prioritization framework established
  - id: DEP-PRIO-POS-002
    signal: All vulnerabilities assessed for actual risk
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Gather Vulnerability Data
    description: Collect all vulnerability scan results
    commands:
    - purpose: Get npm audit with details
      command: npm audit --json 2>/dev/null > /tmp/npm-audit.json && cat /tmp/npm-audit.json | jq '.vulnerabilities
        | length' || echo 'npm audit not applicable'
  - id: '2'
    name: Check CISA KEV
    description: Cross-reference with known exploited vulnerabilities
    commands:
    - purpose: Download and check KEV catalog
      command: curl -s https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json
        2>/dev/null | jq '.vulnerabilities | length' || echo 'KEV fetch failed; check manually at cisa.gov'
  - id: '3'
    name: Assess Reachability
    description: Determine if vulnerable code is actually used
    commands:
    - purpose: Run snyk reachability analysis
      command: snyk test --reachable 2>/dev/null | head -100 || echo 'Snyk reachability not available;
        manual analysis required'
  - id: '4'
    name: Check EPSS Scores
    description: Get exploit prediction scores
    commands:
    - purpose: Query EPSS for a CVE
      command: 'echo ''Query EPSS API: https://api.first.org/data/v1/epss?cve=CVE-XXXX-YYYY for exploit
        probability'''
  - id: '5'
    name: Assess Environment Exposure
    description: Evaluate exposure based on deployment context
    commands:
    - purpose: Document exposure factors
      command: |-
        echo 'Manual assessment needed:
        - Is service internet-facing?
        - Is vulnerable component in request path?
        - Are there mitigating controls (WAF, network segmentation)?
        - What data could be exposed?'
  - id: '6'
    name: Create Prioritization Matrix
    description: Build prioritized list based on all factors
    commands:
    - purpose: Generate prioritization template
      command: |-
        echo 'Priority Matrix:

        P1 (24-48h): CISA KEV + Reachable + Internet-facing
        P2 (7 days): Critical CVSS + Reachable OR High + Exploitable
        P3 (30 days): High CVSS + Limited exposure OR Medium + Reachable
        P4 (90 days): Medium/Low + Not reachable in prod
        P5 (next cycle): Dev-only OR Verified unreachable'
output:
  deliverables:
  - type: prioritized_vulnerability_list
    format: structured
    description: Vulnerabilities ranked by actual risk
  - type: remediation_plan
    format: structured
    description: Actionable plan with timelines
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Prioritization Methodology
    - P1 Immediate Actions
    - P2-P3 Scheduled Items
    - Risk Acceptances
closeout_checklist:
- id: dep-prio-001
  item: All critical vulnerabilities assessed for reachability
  level: CRITICAL
  verification: Reachability documented for each critical CVE
- id: dep-prio-002
  item: CISA KEV cross-reference completed
  level: REQUIRED
  verification: KEV catalog checked
- id: dep-prio-003
  item: Prioritization rationale documented
  level: REQUIRED
  verification: Each prioritization decision explained
- id: dep-prio-004
  item: Remediation timeline established
  level: REQUIRED
  verification: Each vulnerability has target date
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: SOC 2
    control: CC6.1
    description: Prioritized vulnerability remediation
  - framework: PCI DSS
    control: '6.2'
    description: Risk-ranked vulnerability remediation
relationships:
  commonly_combined:
  - dependency-supply-chain.vulnerability-scanning.cve-detection
  depends_on:
  - dependency-supply-chain.vulnerability-scanning.cve-detection
  feeds_into:
  - security-trust.vulnerability-remediation-tracking
