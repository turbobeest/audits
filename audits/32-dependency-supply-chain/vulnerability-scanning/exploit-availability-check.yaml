# ============================================================
# AUDIT: Exploit Availability Check
# Category: 32 - Dependency & Supply Chain
# Subcategory: vulnerability-scanning
# ============================================================

audit:
  id: "dependency-supply-chain.vulnerability-scanning.exploit-availability-check"
  name: "Exploit Availability Check Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "dependency-supply-chain"
  category_number: 32
  subcategory: "vulnerability-scanning"

  tier: "expert"
  estimated_duration: "2-4 hours"  # median: 3h

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "dependencies"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit investigates whether public exploits exist for identified
    vulnerabilities in project dependencies. It searches exploit databases,
    security research publications, and hacker forums to assess real-world
    exploitability and inform prioritization decisions.

  why_it_matters: |
    A vulnerability with a public exploit is far more dangerous than one
    requiring original exploit development. Script kiddies can leverage
    public exploits, dramatically expanding the threat actor pool. Knowing
    exploit availability is critical for accurate risk assessment.

  when_to_run:
    - "When critical vulnerabilities are identified"
    - "During security incident response"
    - "For high-priority vulnerability triage"
    - "When assessing remediation urgency"

prerequisites:
  required_artifacts:
    - type: "vulnerability_report"
      description: "List of CVEs to investigate"

  access_requirements:
    - "Access to exploit databases"
    - "Security research resources"

discovery:
  file_patterns:
    - glob: "**/vulnerability-report*"
      purpose: "Find CVE lists to investigate"

knowledge_sources:
  guides:
    - id: "exploit-db"
      name: "Exploit Database"
      url: "https://www.exploit-db.com/"

    - id: "nuclei-templates"
      name: "Nuclei Templates"
      url: "https://github.com/projectdiscovery/nuclei-templates"

  standards:
    - id: "cwe"
      name: "Common Weakness Enumeration"
      relevance: "Understanding vulnerability classes"

tooling:
  analysis_tools:
    - tool: "searchsploit"
      purpose: "Search Exploit-DB locally"
    - tool: "nuclei"
      purpose: "Check for nuclei templates"
    - tool: "metasploit"
      purpose: "Check for MSF modules"

signals:
  critical:
    - id: "DEP-EXP-CRIT-001"
      signal: "Public exploit code readily available"
      evidence_indicators:
        - "Exploit on Exploit-DB"
        - "Metasploit module exists"
        - "GitHub PoC with weaponized code"
      explanation: |
        When exploit code is public, the barrier to attack drops dramatically.
        Any attacker can copy-paste and run the exploit with minimal skill.
        This represents immediate, high-probability risk.
      remediation: "Treat as emergency; patch or mitigate within 24 hours"

    - id: "DEP-EXP-CRIT-002"
      signal: "Exploit actively being used in the wild"
      evidence_indicators:
        - "Threat intelligence reports active exploitation"
        - "CISA KEV listing"
        - "Security vendor alerts"
      remediation: "Emergency response; immediate patching required"

  high:
    - id: "DEP-EXP-HIGH-001"
      signal: "Proof of concept code available"
      evidence_indicators:
        - "PoC on security researcher blog"
        - "Conference presentation with PoC"
      remediation: "High priority; weaponization likely imminent"

    - id: "DEP-EXP-HIGH-002"
      signal: "Detailed technical writeup enables exploit development"
      evidence_indicators:
        - "Root cause analysis published"
        - "Attack vector clearly described"
      remediation: "Prioritize remediation; skilled attackers can develop exploits"

  medium:
    - id: "DEP-EXP-MED-001"
      signal: "Vulnerability class commonly exploited"
      evidence_indicators:
        - "Similar vulnerabilities have public exploits"
        - "Well-understood attack pattern"
      remediation: "Plan remediation; exploit development is feasible"

  low:
    - id: "DEP-EXP-LOW-001"
      signal: "No public exploit or PoC found"
      evidence_indicators:
        - "Extensive search returned no results"
        - "Complex exploitation requirements"
      remediation: "Standard remediation timeline; monitor for developments"

  positive:
    - id: "DEP-EXP-POS-001"
      signal: "No exploits available for identified vulnerabilities"

procedure:
  context:
    cognitive_mode: "investigative"
    ensemble_role: "security-researcher"

  steps:
    - id: "1"
      name: "Search Exploit-DB"
      description: "Check Exploit Database for matching exploits"
      commands:
        - purpose: "Search Exploit-DB locally"
          command: "searchsploit --cve CVE-XXXX-YYYY 2>/dev/null || echo 'Install searchsploit or search exploit-db.com manually'"

    - id: "2"
      name: "Check Metasploit"
      description: "Search for Metasploit modules"
      commands:
        - purpose: "Search MSF modules"
          command: "msfconsole -q -x 'search cve:XXXX-YYYY; exit' 2>/dev/null || echo 'MSF not available; check rapid7.com/db'"

    - id: "3"
      name: "Search GitHub"
      description: "Look for PoC repositories"
      commands:
        - purpose: "Search GitHub for CVE PoCs"
          command: "curl -s 'https://api.github.com/search/repositories?q=CVE-XXXX-YYYY' 2>/dev/null | jq '.items[].html_url' | head -10 || echo 'GitHub API search; also check github.com manually'"

    - id: "4"
      name: "Check Nuclei Templates"
      description: "Search for detection templates"
      commands:
        - purpose: "Search nuclei templates"
          command: "find ~/.local/nuclei-templates -name '*.yaml' -exec grep -l 'CVE-XXXX-YYYY' {} \\; 2>/dev/null || echo 'Check nuclei-templates repository on GitHub'"

    - id: "5"
      name: "Check CISA KEV"
      description: "Verify if actively exploited"
      commands:
        - purpose: "Search KEV catalog"
          command: "curl -s https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json 2>/dev/null | jq '.vulnerabilities[] | select(.cveID == \"CVE-XXXX-YYYY\")' || echo 'Check cisa.gov/known-exploited-vulnerabilities-catalog manually'"

    - id: "6"
      name: "Check Vulncheck KEV"
      description: "Check extended exploitation data"
      commands:
        - purpose: "Note alternative KEV source"
          command: "echo 'Also check vulncheck.com/kev for extended known exploitation data'"

    - id: "7"
      name: "Review Security Blogs"
      description: "Search for technical writeups"
      commands:
        - purpose: "Note manual search required"
          command: "echo 'Manual search required:\n- Google: CVE-XXXX-YYYY exploit OR PoC OR writeup\n- Twitter/X: CVE-XXXX-YYYY\n- Security blogs: Project Zero, Rapid7, Qualys, etc.'"

output:
  deliverables:
    - type: "exploit_availability_report"
      format: "structured"
      description: "Exploit status for each vulnerability"

    - type: "risk_adjustment"
      format: "structured"
      description: "Prioritization adjustments based on exploitability"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Exploits Found"
        - "Active Exploitation Evidence"
        - "Risk Adjustments"
        - "Monitoring Recommendations"

closeout_checklist:
  - id: "dep-exp-001"
    item: "All critical CVEs checked for exploits"
    level: "CRITICAL"
    verification: "Each critical CVE has exploit availability documented"

  - id: "dep-exp-002"
    item: "CISA KEV checked"
    level: "REQUIRED"
    verification: "KEV cross-reference complete"

  - id: "dep-exp-003"
    item: "Exploit-DB searched"
    level: "REQUIRED"
    verification: "searchsploit or web search complete"

  - id: "dep-exp-004"
    item: "Prioritization adjusted based on findings"
    level: "REQUIRED"
    verification: "Risk scores updated"

governance:
  applicable_to:
    archetypes: ["security-sensitive-projects"]

  compliance_mappings:
    - framework: "NIST CSF"
      control: "ID.RA-2"
      description: "Threat and vulnerability information"
    - framework: "SOC 2"
      control: "CC6.1"
      description: "Vulnerability risk assessment"

relationships:
  commonly_combined:
    - "dependency-supply-chain.vulnerability-scanning.vulnerability-prioritization"
  depends_on:
    - "dependency-supply-chain.vulnerability-scanning.cve-detection"
  feeds_into:
    - "security-trust.threat-intelligence"
