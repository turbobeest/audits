# ============================================================
# AUDIT: Migration Difficulty Assessment
# Category: 32 - Dependency & Supply Chain
# Subcategory: vendor-lock-in
# ============================================================

audit:
  id: "dependency-supply-chain.vendor-lock-in.migration-difficulty"
  name: "Migration Difficulty Assessment Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "dependency-supply-chain"
  category_number: 32
  subcategory: "vendor-lock-in"

  tier: "comprehensive"
  estimated_duration: "4-8 hours"

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "dependencies"

  default_profiles:
    - "full"
    - "strategic"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit assesses how difficult it would be to migrate away from
    current vendor dependencies to alternatives. It evaluates code
    coupling, data migration requirements, API compatibility, and
    overall effort required for migration.

  why_it_matters: |
    Understanding migration difficulty informs strategic decisions
    about vendor relationships. High migration difficulty means less
    negotiating power and higher risk. Knowing migration costs helps
    with build-vs-buy and vendor selection decisions.

  when_to_run:
    - "Before vendor contract renewals"
    - "When evaluating alternatives"
    - "During cost optimization"
    - "For M&A due diligence"

prerequisites:
  required_artifacts:
    - type: "vendor_inventory"
      description: "List of vendor dependencies"
    - type: "source_code"
      description: "Application source code"
    - type: "data_schemas"
      description: "Data structure documentation"

  access_requirements:
    - "Read access to all code"
    - "Understanding of data flows"

discovery:
  file_patterns:
    - glob: "**/*.ts"
      purpose: "Find TypeScript code"
    - glob: "**/*.js"
      purpose: "Find JavaScript code"
    - glob: "**/schema*"
      purpose: "Find data schemas"

knowledge_sources:
  guides:
    - id: "migration-planning"
      name: "Technology Migration Planning"
      url: "https://cloud.google.com/architecture/migration-planning"

  standards:
    - id: "portability"
      name: "Software Portability"
      relevance: "Migration considerations"

tooling:
  analysis_tools:
    - tool: "code-analysis"
      purpose: "Analyze coupling to vendor APIs"

signals:
  critical:
    - id: "DEP-MIG-CRIT-001"
      signal: "Migration would require complete rewrite"
      evidence_indicators:
        - "Vendor APIs throughout codebase"
        - "No abstraction layer"
        - "6+ month migration estimate"
      explanation: |
        When migration effectively requires rewriting the application,
        you're severely locked in. This limits options and creates
        significant business risk.
      remediation: "Prioritize abstraction layer development"

  high:
    - id: "DEP-MIG-HIGH-001"
      signal: "Significant data migration required"
      evidence_indicators:
        - "Large data volumes in proprietary format"
        - "Complex data transformation needed"
        - "Potential data loss risk"
      remediation: "Develop data migration strategy; test exports"

    - id: "DEP-MIG-HIGH-002"
      signal: "Critical features tied to vendor-specific APIs"
      evidence_indicators:
        - "Key functionality uses unique vendor features"
        - "No equivalent in alternatives"
      remediation: "Identify feature alternatives; plan workarounds"

  medium:
    - id: "DEP-MIG-MED-001"
      signal: "Moderate refactoring needed for migration"
      evidence_indicators:
        - "Some vendor coupling"
        - "2-4 week migration estimate"
      remediation: "Plan migration; consider incremental approach"

    - id: "DEP-MIG-MED-002"
      signal: "Team lacks experience with alternatives"
      evidence_indicators:
        - "Training needed for new platform"
        - "Learning curve adds to migration"
      remediation: "Factor training into migration plans"

  low:
    - id: "DEP-MIG-LOW-001"
      signal: "Migration mostly configuration changes"
      evidence_indicators:
        - "Good abstraction already exists"
        - "Standard protocols used"
      remediation: "Low risk; maintain abstraction"

  positive:
    - id: "DEP-MIG-POS-001"
      signal: "Migration path clear and low effort"

    - id: "DEP-MIG-POS-002"
      signal: "Regular migration tests performed"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Analyze Code Coupling"
      description: "Assess how deeply vendor APIs are integrated"
      commands:
        - purpose: "Count vendor API usages"
          command: "grep -rE '(aws|azure|gcp)' src/ --include='*.ts' --include='*.js' 2>/dev/null | wc -l || echo 'Count vendor references manually'"

    - id: "2"
      name: "Identify Touch Points"
      description: "Find all places using vendor APIs"
      commands:
        - purpose: "List files with vendor imports"
          command: "grep -rlE '@aws-sdk|@azure|google-cloud' src/ 2>/dev/null | head -30 || echo 'List vendor-coupled files manually'"

    - id: "3"
      name: "Assess Data Volume"
      description: "Estimate data migration scope"
      commands:
        - purpose: "Note data assessment"
          command: "echo 'Data Migration Assessment:\n\n[ ] Total data volume: ___GB/TB\n[ ] Number of tables/collections: ___\n[ ] Data format: [proprietary/standard]\n[ ] Relationships complexity: [low/medium/high]\n[ ] Migration downtime acceptable: [yes/no]'"

    - id: "4"
      name: "Identify Alternative Services"
      description: "Find potential replacement options"
      commands:
        - purpose: "Generate alternatives checklist"
          command: "echo 'Alternative Services Checklist:\n\nCurrent Service: [name]\n\nAlternatives:\n1. [alternative 1] - Compatibility: ___\n2. [alternative 2] - Compatibility: ___\n3. Open source - Compatibility: ___\n\nFeature Gaps: [list]'"

    - id: "5"
      name: "Estimate Migration Effort"
      description: "Calculate migration timeline and cost"
      commands:
        - purpose: "Generate effort template"
          command: "echo 'Migration Effort Estimate:\n\nComponent: [name]\nCurrent Vendor: [name]\nTarget: [name]\n\nEffort Breakdown:\n- Code changes: ___ person-weeks\n- Data migration: ___ person-weeks\n- Testing: ___ person-weeks\n- Deployment: ___ person-weeks\n- Buffer (20%): ___ person-weeks\n\nTotal: ___ person-weeks\nRisk Level: [low/medium/high]'"

    - id: "6"
      name: "Document Migration Approach"
      description: "Outline potential migration strategy"
      commands:
        - purpose: "Generate migration approach"
          command: "echo 'Migration Approach Options:\n\n1. Big Bang:\n   - Replace all at once\n   - Higher risk, shorter duration\n\n2. Strangler Pattern:\n   - Gradual replacement\n   - Lower risk, longer duration\n\n3. Parallel Run:\n   - Run both during transition\n   - Highest cost, lowest risk'"

output:
  deliverables:
    - type: "migration_difficulty_assessment"
      format: "structured"
      description: "Assessment of migration complexity"

    - type: "effort_estimate"
      format: "structured"
      description: "Migration effort and timeline"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Coupling Analysis"
        - "Data Migration Assessment"
        - "Effort Estimates"
        - "Migration Strategy Options"

closeout_checklist:
  - id: "dep-mig-001"
    item: "Migration difficulty assessed"
    level: "REQUIRED"
    verification: "Difficulty rating documented"

  - id: "dep-mig-002"
    item: "Effort estimate completed"
    level: "REQUIRED"
    verification: "Person-weeks estimated"

  - id: "dep-mig-003"
    item: "Alternatives identified"
    level: "REQUIRED"
    verification: "Alternatives documented"

  - id: "dep-mig-004"
    item: "Migration strategy outlined"
    level: "RECOMMENDED"
    verification: "Approach options documented"

governance:
  applicable_to:
    archetypes: ["all-software-projects"]

  compliance_mappings:
    - framework: "SOC 2"
      control: "CC9.2"
      description: "Vendor contingency planning"
    - framework: "ISO 27001"
      control: "A.15.2"
      description: "Supplier relationship management"

relationships:
  commonly_combined:
    - "dependency-supply-chain.vendor-lock-in.proprietary-dependency-analysis"
  depends_on:
    - "dependency-supply-chain.vendor-lock-in.proprietary-dependency-analysis"
  feeds_into:
    - "project-management.migration-planning"
