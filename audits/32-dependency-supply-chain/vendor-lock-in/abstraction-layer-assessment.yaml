audit:
  id: dependency-supply-chain.vendor-lock-in.abstraction-layer-assessment
  name: Abstraction Layer Assessment Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: dependency-supply-chain
  category_number: 32
  subcategory: vendor-lock-in
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: dependencies
  default_profiles:
  - full
  - architecture
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates the presence and effectiveness of abstraction
    layers that separate business logic from vendor implementations.
    Good abstractions enable easier migration, testing, and flexibility
    in vendor choices.
  why_it_matters: |
    Abstraction layers are the primary defense against vendor lock-in.
    Well-designed abstractions let you swap implementations without
    changing business logic. They also improve testability and code
    organization.
  when_to_run:
  - During architecture reviews
  - When planning vendor integrations
  - As part of code quality assessments
  - Before adding new vendor dependencies
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: architecture_documentation
    description: System design documentation
  access_requirements:
  - Read access to codebase
  - Understanding of architecture patterns
discovery:
  file_patterns:
  - glob: '**/*adapter*'
    purpose: Find adapter patterns
  - glob: '**/*repository*'
    purpose: Find repository patterns
  - glob: '**/*provider*'
    purpose: Find provider patterns
  - glob: '**/*interface*'
    purpose: Find interfaces
  - glob: '**/*service*'
    purpose: Find service layers
knowledge_sources:
  guides:
  - id: adapter-pattern
    name: Adapter Pattern
    url: https://refactoring.guru/design-patterns/adapter
  - id: hexagonal-architecture
    name: Hexagonal Architecture
    url: https://alistair.cockburn.us/hexagonal-architecture/
  standards:
  - id: clean-architecture
    name: Clean Architecture
    relevance: Dependency inversion
tooling:
  analysis_tools:
  - tool: code-analysis
    purpose: Find abstraction patterns
  - tool: dependency-cruiser
    purpose: Analyze import dependencies
signals:
  critical:
  - id: DEP-ABS-CRIT-001
    signal: No abstraction layer for critical vendor
    evidence_indicators:
    - Vendor APIs called directly from business logic
    - No interfaces or adapters
    - Cannot substitute implementations
    explanation: |
      Without abstraction, vendor APIs are tightly coupled to business
      logic throughout the codebase. Changing vendors requires touching
      most of the application.
    remediation: Introduce adapter/repository pattern
  high:
  - id: DEP-ABS-HIGH-001
    signal: Abstraction leaks vendor details
    evidence_indicators:
    - Vendor types in interface definitions
    - Vendor concepts in abstractions
    remediation: Clean up abstraction to hide vendor details
  - id: DEP-ABS-HIGH-002
    signal: Abstraction exists but bypassed
    evidence_indicators:
    - Direct vendor calls alongside abstraction
    - Inconsistent usage
    remediation: Enforce abstraction usage; remove bypasses
  medium:
  - id: DEP-ABS-MED-001
    signal: Partial abstraction coverage
    evidence_indicators:
    - Some vendors abstracted, others not
    - Inconsistent patterns
    remediation: Extend abstraction to all vendors
  - id: DEP-ABS-MED-002
    signal: Abstraction not tested independently
    evidence_indicators:
    - No mock implementations
    - Tests use real vendor
    remediation: Add mock implementations for testing
  low:
  - id: DEP-ABS-LOW-001
    signal: Abstraction could be simplified
    evidence_indicators:
    - Over-abstracted
    - Unnecessary complexity
    remediation: Simplify while maintaining separation
  positive:
  - id: DEP-ABS-POS-001
    signal: Clean abstraction layers in place
  - id: DEP-ABS-POS-002
    signal: Multiple implementations available
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: architect-auditor
  steps:
  - id: '1'
    name: Find Abstraction Patterns
    description: Locate existing abstraction layers
    commands:
    - purpose: Find adapter files
      command: find src -name '*adapter*' -o -name '*repository*' -o -name '*provider*' 2>/dev/null |
        head -20
  - id: '2'
    name: Check Interface Definitions
    description: Find interfaces separating concerns
    commands:
    - purpose: Find interface files
      command: find src -name '*interface*' -o -name '*.interface.ts' 2>/dev/null | head -20
    - purpose: Find TypeScript interfaces
      command: grep -rl 'export interface' src/ --include='*.ts' 2>/dev/null | head -20 || echo 'Check
        for interfaces'
  - id: '3'
    name: Check for Vendor Leakage
    description: See if vendor types leak through abstractions
    commands:
    - purpose: Check interface files for vendor imports
      command: grep -E 'aws|azure|gcp' src/**/interface* src/**/*interface*.ts 2>/dev/null | head -10
        || echo 'Check interfaces for vendor imports'
  - id: '4'
    name: Find Multiple Implementations
    description: Check if alternative implementations exist
    commands:
    - purpose: Find implementation variants
      command: find src -name '*aws*' -o -name '*azure*' -o -name '*local*' -o -name '*mock*' 2>/dev/null
        | head -20 || echo 'Look for alternative implementations'
  - id: '5'
    name: Analyze Import Structure
    description: Check dependency direction
    commands:
    - purpose: Run dependency cruiser
      command: npx depcruise src --include-only '^src' --output-type text 2>/dev/null | head -50 || echo
        'dependency-cruiser not available'
  - id: '6'
    name: Document Abstraction Coverage
    description: Map abstractions to vendors
    commands:
    - purpose: Generate coverage template
      command: |-
        echo 'Abstraction Coverage Map:

        Vendor/Service: [name]

        Abstraction Status:
        [ ] Interface defined
        [ ] Production implementation
        [ ] Mock/test implementation
        [ ] No vendor leakage
        [ ] Used consistently

        Coverage: [Full/Partial/None]'
output:
  deliverables:
  - type: abstraction_assessment
    format: structured
    description: Assessment of abstraction layers
  - type: coverage_map
    format: table
    description: Map of abstractions to vendors
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Abstraction Inventory
    - Coverage Analysis
    - Quality Assessment
    - Recommendations
closeout_checklist:
- id: dep-abs-001
  item: Abstraction patterns identified
  level: REQUIRED
  verification: Abstractions documented
- id: dep-abs-002
  item: Coverage assessed
  level: REQUIRED
  verification: Coverage map complete
- id: dep-abs-003
  item: Leakage issues identified
  level: REQUIRED
  verification: Leakage documented
- id: dep-abs-004
  item: Mock implementations exist
  level: RECOMMENDED
  verification: Mocks available for testing
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: SOC 2
    control: CC8.1
    description: Architecture governance
  - framework: ISO 27001
    control: A.14.2.5
    description: System architecture principles
relationships:
  commonly_combined:
  - dependency-supply-chain.vendor-lock-in.proprietary-dependency-analysis
  depends_on:
  - architecture.design-patterns
  feeds_into:
  - code-quality.architecture-compliance
