audit:
  id: dependency-supply-chain.update-management.patch-strategy
  name: Patch Strategy Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: dependency-supply-chain
  category_number: 32
  subcategory: update-management
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: dependencies
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates the organization's strategy for applying security
    patches to dependencies. It assesses response time targets, emergency
    patching procedures, and the balance between stability and security
    in patch decisions.
  why_it_matters: |
    Patch strategy directly impacts security posture. Too slow and vulnerabilities
    remain exploitable; too fast without testing and stability suffers. A
    well-defined strategy ensures appropriate response times based on risk
    while maintaining system reliability.
  when_to_run:
  - When establishing security policies
  - After security incidents
  - During compliance audits
  - When reviewing vulnerability response times
prerequisites:
  required_artifacts:
  - type: security_policy
    description: Documented patching policies
  - type: incident_records
    description: Historical patch application data
  access_requirements:
  - Access to security policies
  - Access to patch history
discovery:
  file_patterns:
  - glob: '**/SECURITY*'
    purpose: Find security policies
  - glob: '**/docs/*security*'
    purpose: Find security documentation
  - glob: '**/docs/*patch*'
    purpose: Find patching documentation
knowledge_sources:
  guides:
  - id: cisa-patching
    name: CISA Patch Management Guide
    url: https://www.cisa.gov/news-events/news/understanding-patches-and-software-updates
  - id: nist-patch-management
    name: NIST Patch Management
    url: https://csrc.nist.gov/publications/detail/sp/800-40/rev-4/final
  standards:
  - id: cisa-kev-timelines
    name: CISA KEV Remediation Timelines
    relevance: Federal patching requirements
tooling:
  analysis_tools:
  - tool: dependabot
    purpose: Automated security updates
  - tool: snyk
    purpose: Security patch recommendations
  - tool: renovate
    purpose: Automated dependency updates
signals:
  critical:
  - id: DEP-PATCH-CRIT-001
    signal: No defined patch strategy or SLAs
    evidence_indicators:
    - No documented patching policy
    - Ad-hoc patching decisions
    explanation: |
      Without a defined strategy, critical patches may be delayed
      indefinitely while trivial updates are prioritized. Consistent
      policy ensures appropriate response to security issues.
    remediation: Define and document patching SLAs immediately
  - id: DEP-PATCH-CRIT-002
    signal: Critical patches taking weeks to apply
    evidence_indicators:
    - Critical CVEs open for 14+ days
    - No emergency patching process
    remediation: Implement emergency patching procedures
  high:
  - id: DEP-PATCH-HIGH-001
    signal: No differentiation between security and feature updates
    evidence_indicators:
    - Security patches in same queue as features
    - No priority for security fixes
    remediation: Create separate fast-track for security patches
  - id: DEP-PATCH-HIGH-002
    signal: Patch testing causing excessive delays
    evidence_indicators:
    - Weeks of testing for minor patches
    - Risk-benefit analysis not performed
    remediation: Implement risk-based testing approach
  medium:
  - id: DEP-PATCH-MED-001
    signal: Patch strategy not aligned with compliance requirements
    evidence_indicators:
    - PCI/SOC2/HIPAA timeline requirements not met
    - Compliance gaps due to patching delays
    remediation: Align strategy with compliance requirements
  - id: DEP-PATCH-MED-002
    signal: No rollback plan for patches
    evidence_indicators:
    - Patches applied without ability to revert
    - No testing environment for patches
    remediation: Implement rollback procedures
  low:
  - id: DEP-PATCH-LOW-001
    signal: Patch metrics not tracked
    evidence_indicators:
    - No time-to-patch measurements
    - No patch success rate tracking
    remediation: Implement patch metrics collection
  positive:
  - id: DEP-PATCH-POS-001
    signal: Clear patch strategy with defined SLAs
  - id: DEP-PATCH-POS-002
    signal: Emergency patching process tested and ready
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Patch Policy Documentation
    description: Find and review patching policies
    commands:
    - purpose: Find security and patch documentation
      command: find . -iname '*security*' -o -iname '*patch*' 2>/dev/null | grep -vE 'node_modules|vendor'
        | head -20
  - id: '2'
    name: Analyze Patch History
    description: Review historical patching response times
    commands:
    - purpose: Find security-related commits
      command: git log --oneline --since='6 months ago' --grep='security\|CVE\|vulnerability\|patch' 2>/dev/null
        | head -30 || echo 'Git history not available'
  - id: '3'
    name: Check Current Patch Backlog
    description: Identify pending security patches
    commands:
    - purpose: Check for open security PRs
      command: gh pr list --label security 2>/dev/null || echo 'Could not check security PRs'
    - purpose: Run current vulnerability scan
      command: npm audit --json 2>/dev/null | jq '.metadata.vulnerabilities' || echo 'npm audit not applicable'
  - id: '4'
    name: Assess Response Time SLAs
    description: Document expected patching timelines
    commands:
    - purpose: Generate SLA template
      command: |-
        echo 'Recommended Patch SLAs:

        Critical (CVSS >= 9.0, CISA KEV): 24-48 hours
        High (CVSS 7.0-8.9): 7 days
        Medium (CVSS 4.0-6.9): 30 days
        Low (CVSS < 4.0): 90 days or next release

        Emergency patching should bypass normal change control.'
  - id: '5'
    name: Review Testing Requirements
    description: Assess patch testing processes
    commands:
    - purpose: Document testing approach
      command: |-
        echo 'Patch Testing Matrix:

        Critical: Smoke test only, immediate deploy
        High: Automated tests + quick manual verification
        Medium: Full test suite
        Low: Normal release testing'
  - id: '6'
    name: Check Emergency Procedures
    description: Verify emergency patching capability
    commands:
    - purpose: Look for runbooks
      command: find . -iname '*runbook*' -o -iname '*emergency*' -o -iname '*incident*' 2>/dev/null |
        grep -v node_modules | head -10 || echo 'No runbooks found'
output:
  deliverables:
  - type: patch_policy_assessment
    format: structured
    description: Evaluation of patching policies
  - type: sla_recommendation
    format: structured
    description: Recommended patching SLAs
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Current Patch Strategy
    - SLA Analysis
    - Emergency Procedures
    - Recommendations
closeout_checklist:
- id: dep-patch-001
  item: Patch strategy documented
  level: CRITICAL
  verification: Written policy exists
- id: dep-patch-002
  item: SLAs defined by severity
  level: CRITICAL
  verification: Timeline targets documented
- id: dep-patch-003
  item: Emergency patching process exists
  level: REQUIRED
  verification: Emergency runbook available
- id: dep-patch-004
  item: Patch metrics tracked
  level: RECOMMENDED
  verification: Time-to-patch measured
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: SOC 2
    control: CC6.1
    description: Timely vulnerability remediation
  - framework: PCI DSS
    control: '6.2'
    description: Install security patches within one month
  - framework: HIPAA
    control: 164.308(a)(5)(ii)(B)
    description: Procedures for guarding against malicious software
  - framework: NIST CSF
    control: PR.IP-12
    description: Vulnerability management plan
relationships:
  commonly_combined:
  - dependency-supply-chain.vulnerability-scanning.cve-detection
  depends_on:
  - dependency-supply-chain.vulnerability-scanning.vulnerability-prioritization
  feeds_into:
  - security-trust.incident-response
