audit:
  id: dependency-supply-chain.update-management.update-testing
  name: Update Testing Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: dependency-supply-chain
  category_number: 32
  subcategory: update-management
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: dependencies
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates the testing processes used to validate dependency
    updates before they're merged and deployed. It assesses test coverage,
    CI pipeline configuration, and the effectiveness of automated testing
    in catching update-related issues.
  why_it_matters: |
    Untested updates cause production incidents. However, overly conservative
    testing slows critical security updates. Effective update testing balances
    confidence against speed, using risk-appropriate testing strategies for
    different types of updates.
  when_to_run:
  - When setting up update workflows
  - After update-related production issues
  - When reviewing CI/CD pipeline
  - During process improvement initiatives
prerequisites:
  required_artifacts:
  - type: test_suite
    description: Existing test suites
  - type: ci_config
    description: CI/CD pipeline configuration
  access_requirements:
  - Access to test suites
  - Access to CI/CD configuration
discovery:
  file_patterns:
  - glob: '**/*.test.js'
    purpose: Find JavaScript tests
  - glob: '**/*.spec.ts'
    purpose: Find TypeScript tests
  - glob: '**/test_*.py'
    purpose: Find Python tests
  - glob: '**/*_test.go'
    purpose: Find Go tests
  - glob: '**/.github/workflows/*.yml'
    purpose: Find GitHub Actions
  - glob: '**/Jenkinsfile'
    purpose: Find Jenkins pipelines
knowledge_sources:
  guides:
  - id: testing-pyramid
    name: Testing Pyramid
    url: https://martinfowler.com/bliki/TestPyramid.html
  - id: ci-best-practices
    name: CI Best Practices
    url: https://docs.github.com/en/actions/guides/about-continuous-integration
  standards:
  - id: test-coverage
    name: Test Coverage Standards
    relevance: Adequate coverage for updates
tooling:
  analysis_tools:
  - tool: jest
    purpose: JavaScript testing
  - tool: pytest
    purpose: Python testing
  - tool: go test
    purpose: Go testing
  - tool: nyc/istanbul
    purpose: Coverage reporting
signals:
  critical:
  - id: DEP-TEST-CRIT-001
    signal: Updates merged without any automated testing
    evidence_indicators:
    - No CI pipeline for PRs
    - Tests not run on update PRs
    explanation: |
      Without automated testing, updates may introduce regressions,
      compatibility issues, or break functionality without detection
      until production.
    remediation: Configure CI to run tests on all PRs including updates
  high:
  - id: DEP-TEST-HIGH-001
    signal: Very low test coverage on dependency-heavy code
    evidence_indicators:
    - Coverage < 30% on integration points
    - No tests for external API usage
    remediation: Add tests for code that integrates with dependencies
  - id: DEP-TEST-HIGH-002
    signal: Tests pass but updates cause production issues
    evidence_indicators:
    - History of update-related incidents
    - Tests don't catch real issues
    remediation: Improve test quality; add integration tests
  medium:
  - id: DEP-TEST-MED-001
    signal: Only unit tests run on updates
    evidence_indicators:
    - No integration tests in CI
    - E2E tests not included
    remediation: Add integration tests for dependency updates
  - id: DEP-TEST-MED-002
    signal: Slow test suite delays update merging
    evidence_indicators:
    - Tests take > 30 minutes
    - Updates wait hours for CI
    remediation: Optimize test suite; consider parallel execution
  low:
  - id: DEP-TEST-LOW-001
    signal: No dedicated tests for dependency behavior
    evidence_indicators:
    - Tests assume dependency behavior
    - No contract tests
    remediation: Add contract tests for critical dependencies
  positive:
  - id: DEP-TEST-POS-001
    signal: Comprehensive automated testing on updates
  - id: DEP-TEST-POS-002
    signal: High coverage on dependency integration points
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Assess Test Coverage
    description: Measure overall test coverage
    commands:
    - purpose: Run coverage report (npm)
      command: npm run test:coverage 2>/dev/null || npm test -- --coverage 2>/dev/null || echo 'Coverage
        command not available'
  - id: '2'
    name: Check CI Configuration
    description: Review CI pipeline for test execution
    commands:
    - purpose: View GitHub Actions workflows
      command: cat .github/workflows/*.yml 2>/dev/null | head -100 || echo 'No GitHub Actions found'
  - id: '3'
    name: Verify Tests Run on PRs
    description: Confirm CI runs on pull requests
    commands:
    - purpose: Check for PR triggers
      command: grep -E 'pull_request|on:.*pr' .github/workflows/*.yml 2>/dev/null || echo 'Check CI config
        for PR triggers'
  - id: '4'
    name: Identify Integration Tests
    description: Find tests that exercise dependencies
    commands:
    - purpose: Find integration test files
      command: find . -name '*integration*' -name '*.test.*' -o -name '*integration*' -name '*.spec.*'
        2>/dev/null | grep -v node_modules | head -20
  - id: '5'
    name: Check Test Types
    description: Categorize available test types
    commands:
    - purpose: List test directories
      command: ls -la test/ tests/ __tests__/ e2e/ integration/ 2>/dev/null || echo 'Standard test directories
        not found'
  - id: '6'
    name: Review Test Duration
    description: Assess how long tests take to run
    commands:
    - purpose: Check recent CI run times
      command: gh run list --limit 5 2>/dev/null || echo 'Could not fetch CI run history'
output:
  deliverables:
  - type: test_coverage_report
    format: structured
    description: Coverage analysis for dependency code
  - type: ci_assessment
    format: structured
    description: CI pipeline effectiveness evaluation
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Test Coverage Analysis
    - CI Pipeline Review
    - Test Type Assessment
    - Recommendations
closeout_checklist:
- id: dep-test-001
  item: Tests run automatically on update PRs
  level: CRITICAL
  verification: CI config shows PR testing
- id: dep-test-002
  item: Adequate coverage on dependency integration
  level: REQUIRED
  verification: Coverage report reviewed
- id: dep-test-003
  item: Integration tests included
  level: REQUIRED
  verification: Integration test files exist
- id: dep-test-004
  item: Test suite runs in reasonable time
  level: RECOMMENDED
  verification: CI duration < 30 minutes
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: SOC 2
    control: CC8.1
    description: Testing of changes
  - framework: ISO 27001
    control: A.14.2.9
    description: System acceptance testing
relationships:
  commonly_combined:
  - code-quality.test-coverage
  depends_on:
  - code-quality.testing-infrastructure
  feeds_into:
  - dependency-supply-chain.update-management.automated-updates
