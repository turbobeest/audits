audit:
  id: dependency-supply-chain.dependency-inventory.dependency-enumeration
  name: Dependency Enumeration Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: dependency-supply-chain
  category_number: 32
  subcategory: dependency-inventory
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: high
  scope: dependencies
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit systematically enumerates all dependencies in the software project,
    including direct dependencies declared in manifest files and transitive
    dependencies pulled in automatically by package managers. It creates a
    complete inventory of all third-party code the project relies upon.
  why_it_matters: |
    Without a complete dependency inventory, organizations cannot assess their
    true exposure to supply chain risks, license obligations, or vulnerability
    impacts. Many security incidents stem from unknown or forgotten dependencies.
    A comprehensive enumeration is the foundation for all other dependency audits.
  when_to_run:
  - At project inception
  - Before security assessments
  - During compliance audits
  - After major dependency changes
  - Quarterly as baseline maintenance
prerequisites:
  required_artifacts:
  - type: dependency_manifest
    description: package.json, requirements.txt, go.mod, Cargo.toml, pom.xml, etc.
  - type: lock_file
    description: package-lock.json, poetry.lock, Cargo.lock, go.sum, etc.
  access_requirements:
  - Read access to all source code directories
  - Access to package manager CLIs
discovery:
  file_patterns:
  - glob: '**/package.json'
    purpose: Find npm/Node.js dependencies
  - glob: '**/package-lock.json'
    purpose: Find locked npm dependency versions
  - glob: '**/requirements.txt'
    purpose: Find Python pip dependencies
  - glob: '**/Pipfile'
    purpose: Find Pipenv dependencies
  - glob: '**/poetry.lock'
    purpose: Find Poetry dependencies
  - glob: '**/go.mod'
    purpose: Find Go module dependencies
  - glob: '**/Cargo.toml'
    purpose: Find Rust dependencies
  - glob: '**/pom.xml'
    purpose: Find Maven dependencies
  - glob: '**/build.gradle'
    purpose: Find Gradle dependencies
  - glob: '**/Gemfile'
    purpose: Find Ruby dependencies
  - glob: '**/composer.json'
    purpose: Find PHP Composer dependencies
knowledge_sources:
  guides:
  - id: owasp-dependency-check
    name: OWASP Dependency-Check
    url: https://owasp.org/www-project-dependency-check/
  standards:
  - id: cisa-sbom
    name: CISA SBOM Guidance
    relevance: Federal requirements for software inventory
tooling:
  analysis_tools:
  - tool: syft
    purpose: Generate comprehensive SBOM from multiple sources
  - tool: npm ls
    purpose: List npm dependency tree
  - tool: pip freeze
    purpose: List installed Python packages
  - tool: go list -m all
    purpose: List Go module dependencies
  - tool: cargo tree
    purpose: Display Rust dependency tree
  - tool: mvn dependency:tree
    purpose: Show Maven dependency tree
signals:
  critical:
  - id: DEP-INV-CRIT-001
    signal: Unknown or untracked dependencies detected in production
    evidence_indicators:
    - Dependencies found in runtime but not in manifests
    - Binaries with unidentified origins
    explanation: |
      Untracked dependencies represent a significant security blind spot.
      These could contain vulnerabilities or malicious code that cannot
      be monitored or managed through normal processes.
    remediation: Identify and document all dependencies; add to manifest files
  high:
  - id: DEP-INV-HIGH-001
    signal: Significant discrepancy between manifest and actual dependencies
    evidence_indicators:
    - More than 10% of dependencies not in manifest
    - Lock file out of sync with manifest
    remediation: Reconcile manifest files with actual installed dependencies
  - id: DEP-INV-HIGH-002
    signal: No lock file present for dependency management
    evidence_indicators:
    - Missing package-lock.json, poetry.lock, etc.
    remediation: Generate and commit lock files for reproducible builds
  medium:
  - id: DEP-INV-MED-001
    signal: Multiple package managers in use without clear boundaries
    evidence_indicators:
    - Both npm and yarn in same project
    - Mixed dependency management approaches
    remediation: Standardize on single package manager per ecosystem
  - id: DEP-INV-MED-002
    signal: Dependencies pulled from multiple registries
    evidence_indicators:
    - Mix of public and private registries
    - Inconsistent registry configuration
    remediation: Document and validate all registry sources
  low:
  - id: DEP-INV-LOW-001
    signal: Dependency manifest lacks organization metadata
    evidence_indicators:
    - No description or categorization of dependencies
    - Missing optional vs required distinction
    remediation: Add metadata to improve dependency understanding
  positive:
  - id: DEP-INV-POS-001
    signal: Complete dependency inventory with accurate lock files
  - id: DEP-INV-POS-002
    signal: All dependencies traceable to approved sources
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Discover Manifest Files
    description: Locate all dependency manifest files across the project
    commands:
    - purpose: Find all package manifests
      command: find . -name 'package.json' -o -name 'requirements.txt' -o -name 'go.mod' -o -name 'Cargo.toml'
        -o -name 'pom.xml' | head -100
  - id: '2'
    name: Generate Dependency Lists
    description: Extract dependency information from each package manager
    commands:
    - purpose: List npm dependencies with versions
      command: npm ls --all --json 2>/dev/null || echo 'npm not applicable'
    - purpose: List Python dependencies
      command: pip freeze 2>/dev/null || pipdeptree 2>/dev/null || echo 'pip not applicable'
    - purpose: List Go dependencies
      command: go list -m all 2>/dev/null || echo 'go mod not applicable'
  - id: '3'
    name: Generate SBOM
    description: Create comprehensive Software Bill of Materials
    commands:
    - purpose: Generate SBOM with syft
      command: syft . -o cyclonedx-json > sbom.json 2>/dev/null || echo 'syft not installed'
  - id: '4'
    name: Verify Lock File Consistency
    description: Ensure lock files match manifest declarations
    commands:
    - purpose: Check npm lock file integrity
      command: npm ci --dry-run 2>&1 || echo 'npm integrity check not applicable'
  - id: '5'
    name: Identify Untracked Dependencies
    description: Find dependencies not declared in manifests
    commands:
    - purpose: Compare installed vs declared (npm)
      command: npm ls --all 2>&1 | grep -E '(extraneous|missing)' || echo 'No discrepancies found'
output:
  deliverables:
  - type: inventory_report
    format: json
    description: Complete list of all dependencies with versions
  - type: sbom
    format: cyclonedx
    description: Standards-compliant Software Bill of Materials
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Dependency Count by Ecosystem
    - Registry Sources
    - Discrepancy Analysis
    - Recommendations
closeout_checklist:
- id: dep-inv-001
  item: All manifest files identified and cataloged
  level: REQUIRED
  verification: Manual review of discovery results
  agent_alternative: Use static analysis tools to generate metrics; check for existing code review comments
- id: dep-inv-002
  item: Complete dependency tree generated
  level: REQUIRED
  verification: npm ls --all exits cleanly
- id: dep-inv-003
  item: SBOM generated in standard format
  level: RECOMMENDED
  verification: SBOM file validates against CycloneDX schema
- id: dep-inv-004
  item: No untracked dependencies identified
  level: CRITICAL
  verification: Comparison of runtime vs declared dependencies
governance:
  applicable_to:
    archetypes:
    - all-software-projects
  compliance_mappings:
  - framework: SOC 2
    control: CC6.1
    description: Asset inventory management
  - framework: ISO 27001
    control: A.8.1
    description: Inventory of assets
  - framework: NIST CSF
    control: ID.AM-1
    description: Physical devices and systems inventoried
relationships:
  commonly_combined:
  - dependency-supply-chain.vulnerability-scanning.cve-detection
  - dependency-supply-chain.license-compliance.license-detection
  depends_on: []
  feeds_into:
  - dependency-supply-chain.supply-chain-security.sbom-generation
  - compliance-legal.license-compliance
