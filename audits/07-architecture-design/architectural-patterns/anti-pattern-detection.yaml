audit:
  id: architecture-design.architectural-patterns.anti-pattern-detection
  name: Anti-Pattern Detection
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: architecture-design
  category_number: 7
  subcategory: architectural-patterns
  tier: phd
  estimated_duration: 3-4 hours  # median: 3h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - architecture
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit detects common anti-patterns - recurring solutions that
    appear beneficial but actually harm software quality. It covers
    architectural anti-patterns (Big Ball of Mud, Golden Hammer), design
    anti-patterns (God Object, Spaghetti Code), and coding anti-patterns
    (Magic Numbers, Copy-Paste Programming).
  why_it_matters: |
    Anti-patterns cause:
    - Accumulated technical debt that compounds over time
    - Decreased productivity and increased maintenance cost
    - Higher bug rates and security vulnerabilities
    - Difficult onboarding and team scaling
    - System fragility and change resistance
    Early detection enables remediation before debt compounds.
  when_to_run:
  - During technical debt assessments
  - Before major refactoring efforts
  - When experiencing chronic maintenance issues
  - During code quality audits
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete source code
  access_requirements:
  - Read access to source code
discovery:
  code_patterns:
  - pattern: class\s+\w+Manager|class\s+\w+Processor|class\s+\w+Handler
    type: regex
    scope: source
    purpose: Potential God Object indicators
  - pattern: catch\s*\(.*Exception.*\)\s*\{\s*\}
    type: regex
    scope: source
    purpose: Exception swallowing (error hiding)
  - pattern: =\s*[0-9]{3,}|\.[0-9]{3,}
    type: regex
    scope: source
    purpose: Magic numbers
  - pattern: TODO|FIXME|HACK|XXX
    type: keyword
    scope: source
    purpose: Acknowledged technical debt markers
  file_patterns:
  - glob: '**/*.java'
    purpose: Java source files
  - glob: '**/*.ts'
    purpose: TypeScript source files
knowledge_sources:
  specifications:
  - id: antipatterns-book
    name: 'AntiPatterns: Refactoring Software, Architectures, and Projects in Crisis'
    url: https://en.wikipedia.org/wiki/AntiPatterns
    offline_cache: true
    priority: required
  guides:
  - id: refactoring-catalog
    name: Refactoring Catalog - Code Smells
    url: https://refactoring.guru/refactoring/smells
    offline_cache: true
  - id: fowler-smells
    name: CodeSmell - Martin Fowler
    url: https://martinfowler.com/bliki/CodeSmell.html
    offline_cache: true
  - id: design-patterns-gof
    name: Design Patterns - GoF
    url: https://refactoring.guru/design-patterns
    offline_cache: true
  - id: building-microservices
    name: Building Microservices
    url: https://samnewman.io/books/building_microservices_2nd_edition/
    offline_cache: true
  learning_resources:
  - id: refactoring
    title: 'Refactoring: Improving the Design of Existing Code'
    type: book
    reference: Martin Fowler
  - id: legacy-code
    title: Working Effectively with Legacy Code
    type: book
    reference: Michael Feathers
tooling:
  static_analysis:
  - tool: SonarQube
    purpose: Detect code smells and anti-patterns
    offline_capable: false
  - tool: PMD
    purpose: Identify anti-pattern indicators
    offline_capable: true
  - tool: Checkstyle
    purpose: Find coding standard violations
    offline_capable: true
  - tool: ESLint
    purpose: JavaScript/TypeScript anti-patterns
    offline_capable: true
  scripts:
  - id: antipattern-scanner
    language: bash
    purpose: Find common anti-pattern indicators
    source: inline
    code: |
      #!/bin/bash
      echo "=== God Object Candidates ==="
      find . -name "*.java" -exec wc -l {} \; | awk '$1>500{print}' | sort -rn | head -15

      echo "=== Empty Catch Blocks ==="
      grep -rn "catch.*{.*}" --include="*.java" | head -20

      echo "=== Magic Numbers ==="
      grep -rn "= [0-9]\{4,\}" --include="*.java" | grep -v "serialVersionUID" | head -20

      echo "=== Technical Debt Markers ==="
      grep -rn "TODO\|FIXME\|HACK\|XXX" --include="*.java" --include="*.ts" | wc -l
signals:
  critical:
  - id: ANTI-CRIT-001
    signal: God Object - class with >30 methods or >500 lines
    evidence_pattern: Single class handling multiple unrelated responsibilities
    explanation: |
      God Objects violate SRP, create change magnets, and are impossible
      to test properly. They indicate complete architectural breakdown.
    remediation: Apply Extract Class; identify responsibilities; decompose
  - id: ANTI-CRIT-002
    signal: Big Ball of Mud - no discernible architecture
    evidence_pattern: Circular dependencies, no layer separation, everything coupled
    explanation: |
      Big Ball of Mud architectures have no structure, making changes
      unpredictable and risky. This is the final state of neglected design.
    remediation: Introduce layers; establish boundaries; refactor incrementally
  - id: ANTI-CRIT-003
    signal: Golden Hammer - same solution for every problem
    evidence_pattern: Every data structure is HashMap; every problem uses reflection
    explanation: |
      Overusing one solution regardless of fit creates inappropriate
      complexity and missed opportunities for better approaches.
    remediation: Evaluate problem requirements; choose appropriate solutions
  high:
  - id: ANTI-HIGH-001
    signal: Spaghetti Code - high cyclomatic complexity
    evidence_pattern: Methods with >20 cyclomatic complexity
    explanation: |
      High cyclomatic complexity indicates tangled control flow that's
      hard to understand, test, and maintain.
    remediation: Extract methods; use guard clauses; simplify conditions
  - id: ANTI-HIGH-002
    signal: Copy-Paste Programming - duplicated code blocks
    evidence_pattern: Same 10+ lines appear in multiple locations
    explanation: |
      Copy-paste creates maintenance nightmares - bugs must be fixed
      in multiple places, and variations drift over time.
    remediation: Extract common code to shared method or class
  - id: ANTI-HIGH-003
    signal: Lava Flow - dead code retained out of fear
    evidence_pattern: Commented-out code, unused classes, unreachable branches
    explanation: |
      Dead code increases cognitive load and may be mistakenly activated.
      It represents negative value.
    remediation: Delete dead code; version control preserves history
  medium:
  - id: ANTI-MED-001
    signal: Magic Numbers and Strings
    evidence_pattern: Hard-coded values without explanation
    remediation: Extract to named constants; document meaning
  - id: ANTI-MED-002
    signal: Feature Envy - method uses other class's data excessively
    evidence_pattern: Method calls many getters on same foreign object
    remediation: Move method to class whose data it uses
  - id: ANTI-MED-003
    signal: Empty Catch Blocks - exception swallowing
    evidence_pattern: catch (Exception e) { }
    remediation: Log exception; rethrow or handle appropriately
  low:
  - id: ANTI-LOW-001
    signal: Excessive TODO/FIXME comments
    remediation: Convert to tracked issues; address or remove
  positive:
  - id: ANTI-POS-001
    signal: Clean layered architecture
  - id: ANTI-POS-002
    signal: Low code duplication (DRY principle followed)
  - id: ANTI-POS-003
    signal: No dead code detected
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Detect God Objects
    description: |
      Find classes that are too large, have too many methods,
      or handle multiple responsibilities.
    duration_estimate: 30 min
    commands:
    - purpose: Find large files
      command: find . -name '*.java' -exec wc -l {} \; | awk '$1>300{print}' | sort -rn | head -20
    - purpose: Count methods per class
      command: 'for f in $(find . -name ''*.java'' | head -50); do m=$(grep -c ''public.*('' $f 2>/dev/null);
        [ $m -gt 20 ] && echo "$f: $m methods"; done | head -15'
    expected_findings:
    - Large classes
    - God Object candidates
  - id: '2'
    name: Find code duplication
    description: |
      Identify copy-paste programming by finding similar
      code blocks.
    duration_estimate: 25 min
    commands:
    - purpose: Use PMD CPD if available
      command: which cpd && cpd --minimum-tokens 50 --language java --files . 2>/dev/null | head -50 ||
        echo 'CPD not available'
    - purpose: Find repeated patterns
      command: grep -rhn 'if.*&&.*&&' --include='*.java' | head -20
    expected_findings:
    - Duplicated code blocks
    - Copy-paste patterns
  - id: '3'
    name: Identify dead code
    description: |
      Find unused code, commented-out blocks, and unreachable
      branches.
    duration_estimate: 25 min
    commands:
    - purpose: Find commented code
      command: grep -rn '//.*if\|//.*for\|//.*while\|//.*return' --include='*.java' | head -30
    - purpose: Find potential unused classes
      command: 'for f in $(find . -name ''*.java'' | head -50); do name=$(basename $f .java); grep -r
        "$name" --include=''*.java'' | grep -v "$f" | wc -l | grep -q ''^0$'' && echo "Potentially unused:
        $f"; done | head -15'
    expected_findings:
    - Commented-out code
    - Potentially unused classes
  - id: '4'
    name: Check for magic values
    description: |
      Find hard-coded numbers and strings that should be
      named constants.
    duration_estimate: 20 min
    commands:
    - purpose: Find magic numbers
      command: grep -rn '= [0-9]\{3,\}' --include='*.java' | grep -v 'serialVersionUID\|test\|Test' |
        head -30
    - purpose: Find magic strings
      command: grep -rn '"http://\|"https://\|"jdbc:' --include='*.java' | head -20
    expected_findings:
    - Hard-coded values
    - Configuration in code
  - id: '5'
    name: Assess architectural health
    description: |
      Look for signs of Big Ball of Mud - circular dependencies,
      lack of layering, pervasive coupling.
    duration_estimate: 35 min
    commands:
    - purpose: Find circular dependencies
      command: npx dependency-cruiser --output-type text src 2>/dev/null | grep 'circular' | head -20
        || echo 'dependency-cruiser not available'
    - purpose: Check layer violations
      command: grep -rn 'import.*controller' $(find . -path '*/repository/*.java') 2>/dev/null | head
        -10
    expected_findings:
    - Circular dependencies
    - Layer violations
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: antipattern_report
    format: tabular
    sections:
    - Anti-Pattern
    - Occurrences
    - Severity
    - Remediation Priority
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Anti-Pattern Inventory
    - Technical Debt Assessment
    - Remediation Roadmap
  confidence_guidance:
    high: Clear anti-pattern indicator (metrics)
    medium: Pattern suggests anti-pattern
    low: Potential concern requiring review
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: antipatterns-book
      priority: required
    - source_id: refactoring-catalog
      priority: required
profiles:
  membership:
    quick:
      included: true
      reason: Critical for detecting debt
    full:
      included: true
      priority: 1
    architecture:
      included: true
      priority: 1
closeout_checklist:
- id: anti-001
  item: No God Objects (>500 lines or >30 public methods)
  level: CRITICAL
  verification: find . -name '*.java' -exec wc -l {} \; | awk '$1>500' | wc -l
  expected: 0 or documented with refactoring plan
- id: anti-002
  item: Code duplication below threshold
  level: CRITICAL
  verification: manual
  verification_notes: No significant copy-paste blocks
  expected: Confirmed by reviewer
- id: anti-003
  item: No empty catch blocks
  level: BLOCKING
  verification: grep -rn 'catch.*{}' --include='*.java' | wc -l
  expected: '0'
- id: anti-004
  item: Magic numbers extracted to constants
  level: WARNING
  verification: manual
  verification_notes: Hard-coded values have named constants
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
    - Reliability
relationships:
  commonly_combined:
  - architecture-design.design-principles.single-responsibility
  - architecture-design.cohesion.class-cohesion
  - architecture-design.coupling.tight-coupling-detection
