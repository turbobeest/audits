# ============================================================
# AUDIT: Component Responsibility Analysis
# ============================================================
# Evaluates whether system components have clear, well-defined
# responsibilities that align with business capabilities.
# ============================================================

audit:
  id: "architecture-design.system-decomposition.component-responsibility"
  name: "Component Responsibility Analysis"
  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "architecture-design"
  category_number: 7
  subcategory: "system-decomposition"

  tier: "expert"
  estimated_duration: "2-4 hours"  # median: 3h

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "architecture"

  default_profiles:
    - "full"
    - "architecture"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates whether system components (modules, services,
    libraries) have clear, well-defined responsibilities. It assesses
    alignment between component names, documented purposes, and actual
    implementations to ensure each component has a single, coherent
    mission.

  why_it_matters: |
    Unclear component responsibilities cause:
    - Difficulty understanding where to implement new features
    - Overlapping functionality between components
    - Ambiguous ownership and accountability
    - Feature scattering and coordination overhead
    - Difficulty onboarding new team members
    Clear responsibilities enable autonomous development and scaling.

  when_to_run:
    - "During architecture reviews"
    - "When planning new feature development"
    - "When component boundaries seem unclear"
    - "Before splitting or merging components"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Complete source code"
    - type: "architecture_documentation"
      description: "Component documentation or ADRs"

  access_requirements:
    - "Read access to source code"
    - "Access to architecture documentation"

discovery:
  code_patterns:
    - pattern: "package\\s+\\w+\\.\\w+|namespace\\s+\\w+\\.\\w+"
      type: "regex"
      scope: "source"
      purpose: "Identify package/namespace structure"

    - pattern: "README|ARCHITECTURE|DESIGN"
      type: "keyword"
      scope: "docs"
      purpose: "Find component documentation"

  file_patterns:
    - glob: "**/README.md"
      purpose: "Component documentation"
    - glob: "**/package.json"
      purpose: "Node module definitions"
    - glob: "**/pom.xml"
      purpose: "Maven module definitions"

knowledge_sources:
  specifications:
    - id: "ddd-bounded-context"
      name: "Domain-Driven Design - Bounded Context"
      url: "https://martinfowler.com/bliki/BoundedContext.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "c4-model"
      name: "C4 Model for Software Architecture"
      url: "https://c4model.com/"
      offline_cache: true

  learning_resources:
    - id: "building-microservices"
      title: "Building Microservices"
      type: "book"
      reference: "Sam Newman - Chapter on Decomposition"

    - id: "fundamentals-architecture"
      title: "Fundamentals of Software Architecture"
      type: "book"
      reference: "Richards & Ford"

    - id: "ddd-evans"
      title: "Domain-Driven Design"
      type: "book"
      reference: "Eric Evans"

tooling:
  static_analysis:
    - tool: "Structure101"
      purpose: "Visualize component dependencies and responsibilities"
      offline_capable: true

  scripts:
    - id: "component-analyzer"
      language: "bash"
      purpose: "Analyze component structure"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Top-Level Packages/Modules ==="
        find . -name 'pom.xml' -o -name 'package.json' -o -name 'build.gradle' | head -20

        echo "=== Package Structure ==="
        find . -type d -path '*/src/main/java/*' | cut -d/ -f6-7 | sort | uniq | head -30

        echo "=== README Files ==="
        find . -name 'README.md' | head -20

signals:
  critical:
    - id: "COMP-CRIT-001"
      signal: "Component with no documented responsibility"
      evidence_pattern: "Module has no README or documented purpose"
      explanation: |
        Components without documented responsibilities are impossible to
        understand or maintain. Developers must guess the purpose from
        code, leading to misuse and scope creep.
      remediation: "Document component responsibility in README; add to ADR"

    - id: "COMP-CRIT-002"
      signal: "Component name doesn't match implementation"
      evidence_pattern: "PaymentService handles user authentication"
      explanation: |
        Misleading component names cause developers to look in the wrong
        place and add functionality where it doesn't belong.
      remediation: "Rename or refactor to align name with responsibility"

  high:
    - id: "COMP-HIGH-001"
      signal: "Overlapping responsibilities between components"
      evidence_pattern: "UserService and AccountService both handle profile updates"
      explanation: |
        Overlapping responsibilities create confusion about where changes
        belong and lead to duplicate or conflicting implementations.
      remediation: "Clarify boundaries; merge or clearly delineate responsibilities"

    - id: "COMP-HIGH-002"
      signal: "Component with multiple unrelated responsibilities"
      evidence_pattern: "CommonModule handles logging, caching, and authentication"
      explanation: |
        Catch-all components accumulate unrelated functionality and become
        impossible to maintain or reason about.
      remediation: "Split into focused components by responsibility"

  medium:
    - id: "COMP-MED-001"
      signal: "Generic component name without clear scope"
      evidence_pattern: "Utils, Common, Shared, Core, Base, Helper"
      remediation: "Rename to indicate specific responsibility or split"

    - id: "COMP-MED-002"
      signal: "Component boundary doesn't align with team ownership"
      evidence_pattern: "Multiple teams modify same component frequently"
      remediation: "Consider splitting along team lines; establish ownership"

  low:
    - id: "COMP-LOW-001"
      signal: "Component documentation outdated"
      remediation: "Update documentation to match current implementation"

  positive:
    - id: "COMP-POS-001"
      signal: "Clear component responsibilities documented"
    - id: "COMP-POS-002"
      signal: "Component names accurately reflect purpose"
    - id: "COMP-POS-003"
      signal: "Single team ownership per component"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory components"
      description: |
        Create a catalog of all system components with their
        stated purposes.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find module definitions"
          command: "find . -name 'pom.xml' -o -name 'package.json' -o -name 'build.gradle' | head -30"
        - purpose: "Find README files"
          command: "find . -name 'README.md' -exec dirname {} \\; | head -30"
      expected_findings:
        - "Component inventory"
        - "Documentation coverage"

    - id: "2"
      name: "Analyze component names vs content"
      description: |
        Compare component names with their actual contents to
        identify misalignments.
      duration_estimate: "35 min"
      commands:
        - purpose: "List packages per module"
          command: "for d in $(find . -type d -name 'java' -path '*/src/main/*'); do echo \"=== $d ===\"; find $d -type d | head -10; done | head -50"
        - purpose: "Sample class names per module"
          command: "for d in $(find . -name 'pom.xml' -exec dirname {} \\; | head -10); do echo \"=== $d ===\"; find $d -name '*.java' | head -5; done"
      expected_findings:
        - "Name-content alignment"
        - "Misnamed components"

    - id: "3"
      name: "Check for overlapping responsibilities"
      description: |
        Identify components that appear to serve similar
        purposes.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find similar component names"
          command: "find . -type d -name '*service*' -o -type d -name '*api*' | head -30"
        - purpose: "Find shared domain concepts"
          command: "grep -rh 'class.*User\\|class.*Order\\|class.*Payment' --include='*.java' | cut -d: -f1 | sort | uniq -c | sort -rn | head -20"
      expected_findings:
        - "Potential overlaps"
        - "Shared domain concepts"

    - id: "4"
      name: "Evaluate component boundaries"
      description: |
        Assess whether component boundaries make sense for
        the domain and team structure.
      duration_estimate: "25 min"
      questions:
        - "Does each component have a clear, single purpose?"
        - "Can a team own this component independently?"
        - "Would a domain expert recognize this boundary?"
      expected_findings:
        - "Boundary assessment"
        - "Alignment with domain"

    - id: "5"
      name: "Document recommendations"
      description: |
        For components with unclear responsibilities, develop
        clarification or restructuring recommendations.
      duration_estimate: "20 min"
      expected_findings:
        - "Documentation needs"
        - "Restructuring recommendations"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "component_catalog"
      format: "tabular"
      sections:
        - "Component Name"
        - "Documented Purpose"
        - "Actual Content"
        - "Alignment Assessment"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Component Analysis"
        - "Boundary Recommendations"

  confidence_guidance:
    high: "Clear mismatch between name and implementation"
    medium: "Potential overlap or unclear boundary"
    low: "Minor naming concern"

offline:
  capability: "full"
  cache_manifest:
    knowledge:
      - source_id: "ddd-bounded-context"
        priority: "required"
      - source_id: "c4-model"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive analysis"
    full:
      included: true
      priority: 1
    architecture:
      included: true
      priority: 1

closeout_checklist:
  - id: "comp-resp-001"
    item: "All components have documented responsibilities"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "README or ADR exists for each component"
    expected: "Confirmed by reviewer"

  - id: "comp-resp-002"
    item: "Component names match implementations"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Name-content alignment verified"
    expected: "Confirmed by reviewer"

  - id: "comp-resp-003"
    item: "No significant overlapping responsibilities"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Overlaps documented with justification"
    expected: "Confirmed by reviewer"

  - id: "comp-resp-004"
    item: "Generic component names have clear scope"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Utils/Common components documented"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "ISO 25010"
      controls: ["Maintainability", "Modularity"]

relationships:
  commonly_combined:
    - "architecture-design.cohesion.service-cohesion"
    - "architecture-design.system-decomposition.service-granularity"
    - "architecture-design.design-principles.single-responsibility"
