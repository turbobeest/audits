# ============================================================
# AUDIT: Single Responsibility Principle (SRP) Compliance
# ============================================================
# Evaluates whether classes and modules have one and only one
# reason to change, following the S in SOLID.
# ============================================================

audit:
  id: "architecture-design.design-principles.single-responsibility"
  name: "Single Responsibility Principle Compliance"
  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "architecture-design"
  category_number: 7
  subcategory: "design-principles"

  tier: "expert"
  estimated_duration: "2-4 hours"  # median: 3h

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "architecture"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit evaluates compliance with the Single Responsibility Principle,
    which states that a class should have only one reason to change. It
    identifies classes with multiple responsibilities, analyzes method
    groupings, and assesses whether components have clear, focused purposes.

  why_it_matters: |
    SRP violations cause:
    - Classes that change for multiple unrelated reasons
    - Difficulty understanding class purpose
    - Increased coupling as unrelated concerns share a class
    - Testing complexity due to mixed responsibilities
    - Higher bug rates when changes affect unrelated functionality
    SRP is foundational to maintainable object-oriented design.

  when_to_run:
    - "During code reviews of new classes"
    - "When refactoring legacy code"
    - "When classes grow beyond initial scope"
    - "During architecture quality assessments"

# NOTE: Domain Definition for SRP
# A "domain" in this context refers to a cohesive area of business functionality:
# - Business capability: e.g., payments, inventory, user management
# - Bounded context (DDD): A self-contained model with clear boundaries
# - Functional area: e.g., validation, persistence, notification, formatting
# A class violates SRP when it handles multiple domains (e.g., both validation AND persistence).

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Complete source code"

  access_requirements:
    - "Read access to source code"

discovery:
  code_patterns:
    - pattern: "class\\s+\\w+(Manager|Handler|Processor|Helper|Util|Service)"
      type: "regex"
      scope: "source"
      purpose: "Find potentially overloaded classes"

    - pattern: "and|also|additionally"
      type: "keyword"
      scope: "docs"
      purpose: "Find class descriptions with multiple purposes"

  file_patterns:
    - glob: "**/*Manager*.{java,ts,py}"
      purpose: "Manager classes often violate SRP"
    - glob: "**/*Handler*.{java,ts,py}"
      purpose: "Handlers may have mixed responsibilities"
    - glob: "**/*Util*.{java,ts,py}"
      purpose: "Utility classes may be catch-alls"

knowledge_sources:
  specifications:
    - id: "srp-uncle-bob"
      name: "The Single Responsibility Principle"
      url: "https://blog.cleancoder.com/uncle-bob/2014/05/08/SingleReponsibilityPrinciple.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "solid-principles"
      name: "SOLID Principles of Object-Oriented Design"
      url: "https://en.wikipedia.org/wiki/SOLID"
      offline_cache: true

    - id: "clean-architecture"
      name: "Clean Architecture"
      url: "https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html"
      offline_cache: true

    - id: "clean-code"
      name: "Clean Code Summary"
      url: "https://gist.github.com/wojteklu/73c6914cc446146b8b533c0988cf8d29"
      offline_cache: true

  learning_resources:
    - id: "agile-ppp"
      title: "Agile Software Development: Principles, Patterns, and Practices"
      type: "book"
      reference: "Robert C. Martin - Chapter 8"

    - id: "clean-architecture"
      title: "Clean Architecture"
      type: "book"
      reference: "Robert C. Martin"

tooling:
  static_analysis:
    - tool: "SonarQube"
      purpose: "Detect god classes and complexity metrics"
      offline_capable: false

    - tool: "NDepend"
      purpose: "Analyze class responsibilities in .NET"
      offline_capable: true

    - tool: "Checkstyle"
      purpose: "Java class size and complexity checks"
      offline_capable: true

  scripts:
    - id: "srp-analyzer"
      language: "bash"
      purpose: "Find potential SRP violations"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Large Classes (potential SRP violations) ==="
        find . -name "*.java" -exec wc -l {} \; | sort -rn | head -20

        echo "=== Classes with Many Public Methods ==="
        for f in $(find . -name "*.java" | head -50); do
          count=$(grep -c "public.*(" "$f" 2>/dev/null)
          if [ "$count" -gt 15 ]; then
            echo "$f: $count public methods"
          fi
        done

signals:
  critical:
    - id: "SRP-CRIT-001"
      signal: "God class with >30 public methods spanning multiple domains"
      evidence_pattern: "Class has methods for user management, logging, and data access"
      explanation: |
        A class with dozens of public methods touching multiple domains
        clearly has multiple responsibilities. It becomes a change magnet
        and is impossible to test or understand comprehensively.
      remediation: "Apply Extract Class refactoring to separate responsibilities"

    - id: "SRP-CRIT-002"
      signal: "Class named with 'And' or multiple nouns"
      evidence_pattern: "UserAndOrderManager, PaymentProcessorAndValidator"
      explanation: |
        Class names containing 'And' or multiple nouns explicitly reveal
        multiple responsibilities. The name itself admits SRP violation.
      remediation: "Split into separate classes, one per responsibility"

  high:
    - id: "SRP-HIGH-001"
      signal: "Class mixes business logic with infrastructure concerns"
      evidence_pattern: "Same class has domain methods and database/HTTP code"
      explanation: |
        Mixing business logic with infrastructure creates coupling to
        technical details and makes domain logic hard to test.
      remediation: "Apply Hexagonal Architecture; separate domain from infrastructure"

    - id: "SRP-HIGH-002"
      signal: "Service class with unrelated method groups"
      evidence_pattern: "UserService has methods for auth, profile, and notifications"
      explanation: |
        Service classes often accumulate responsibilities over time,
        violating SRP and creating testing difficulty.
      remediation: "Split into AuthService, ProfileService, NotificationService"

  medium:
    - id: "SRP-MED-001"
      signal: "Controller handling multiple resource types"
      evidence_pattern: "Single controller manages Users, Orders, and Products"
      remediation: "Create separate controllers per resource"

    - id: "SRP-MED-002"
      signal: "Utility class as catch-all"
      evidence_pattern: "StringUtils has methods for parsing, validation, and formatting"
      remediation: "Split into focused utility classes or move to appropriate domains"

  low:
    - id: "SRP-LOW-001"
      signal: "Class documentation lists multiple purposes"
      remediation: "Review if documented purposes warrant separate classes"

  positive:
    - id: "SRP-POS-001"
      signal: "Classes have clear, single-purpose names"
    - id: "SRP-POS-002"
      signal: "Class description fits in one sentence without 'and'"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify large and complex classes"
      description: |
        Find classes that are large by line count or have many
        methods - indicators of potential SRP violations.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find large classes"
          command: "find . -name '*.java' -exec wc -l {} \\; | sort -rn | head -30"
        - purpose: "Count methods per class"
          command: "for f in $(find . -name '*.java' | head -50); do echo \"$f: $(grep -c 'public.*(' $f 2>/dev/null)\"; done | sort -t: -k2 -rn | head -20"
      expected_findings:
        - "Largest classes"
        - "Classes with most methods"

    - id: "2"
      name: "Analyze class naming patterns"
      description: |
        Review class names for indicators of multiple responsibilities
        like 'And', 'Manager', or multiple domain terms.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find suspicious class names"
          command: "find . -name '*.java' | xargs grep -l 'class.*Manager\\|class.*Handler\\|class.*And' | head -30"
        - purpose: "List service/manager classes"
          command: "find . -name '*Service.java' -o -name '*Manager.java' | head -30"
      expected_findings:
        - "Classes with problematic names"
        - "Manager/Handler proliferation"

    - id: "3"
      name: "Review method cohesion within classes"
      description: |
        For suspicious classes, analyze whether methods relate
        to a single responsibility or multiple.
      duration_estimate: "40 min"
      commands:
        - purpose: "Sample method names from large classes"
          command: "for f in $(find . -name '*.java' -size +200c | head -10); do echo \"=== $f ===\"; grep 'public.*(' $f | head -15; done"
      expected_findings:
        - "Method groupings within classes"
        - "Unrelated method clusters"

    - id: "4"
      name: "Check domain-infrastructure separation"
      description: |
        Verify that business logic classes don't contain
        infrastructure concerns like database access.
      duration_estimate: "25 min"
      commands:
        - purpose: "Find mixed concerns"
          command: "grep -rln 'Repository\\|HttpClient\\|Connection' --include='*Service.java' | head -20"
        - purpose: "Find business logic with SQL"
          command: "grep -rln 'SELECT\\|INSERT\\|UPDATE' --include='*.java' | grep -v 'Repository\\|Dao' | head -20"
      expected_findings:
        - "Services with repository dependencies"
        - "Business logic with data access"

    - id: "5"
      name: "Document refactoring recommendations"
      description: |
        For identified SRP violations, develop specific
        refactoring recommendations.
      duration_estimate: "25 min"
      questions:
        - "What are the distinct responsibilities?"
        - "How should the class be split?"
        - "What would be good names for extracted classes?"
      expected_findings:
        - "Prioritized refactoring list"
        - "Specific extraction recommendations"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "SRP Violations Identified"
        - "Refactoring Recommendations"

  confidence_guidance:
    high: "Multiple clear indicators of SRP violation"
    medium: "Class size suggests issue; needs review"
    low: "Potential concern based on naming"

offline:
  capability: "full"
  cache_manifest:
    knowledge:
      - source_id: "srp-uncle-bob"
        priority: "required"
      - source_id: "solid-principles"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed class analysis"
    full:
      included: true
      priority: 1
    architecture:
      included: true
      priority: 1

closeout_checklist:
  - id: "srp-001"
    item: "No god classes (>500 lines or >30 methods)"
    level: "CRITICAL"
    verification: "find . -name '*.java' -exec wc -l {} \\; | awk '$1>500{print}' | wc -l"
    expected: "0 or documented exceptions"

  - id: "srp-002"
    item: "Class names describe single responsibility"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "No class names with 'And' or multiple unrelated nouns"
    expected: "Confirmed by reviewer"

  - id: "srp-003"
    item: "Business logic separated from infrastructure"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Domain classes don't import infrastructure packages"
    expected: "Confirmed by reviewer"

  - id: "srp-004"
    item: "SRP violations have documented refactoring plan"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Identified violations tracked with remediation tasks"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "ISO 25010"
      controls: ["Maintainability", "Modularity"]

relationships:
  commonly_combined:
    - "architecture-design.cohesion.class-cohesion"
    - "architecture-design.coupling.tight-coupling-detection"
    - "architecture-design.design-principles.interface-segregation"
