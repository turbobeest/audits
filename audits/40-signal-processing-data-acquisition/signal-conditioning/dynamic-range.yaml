audit:
  id: signal-processing-data-acquisition.signal-conditioning.dynamic-range
  name: Dynamic Range Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: signal-processing-data-acquisition
  category_number: 40
  subcategory: signal-conditioning
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: hardware-software
  default_profiles:
  - full
  - signal-processing
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates dynamic range throughout the signal
    acquisition path. It examines:
    - End-to-end dynamic range capability
    - Bottlenecks limiting dynamic range
    - Headroom for peak signals
    - Noise floor relative to minimum signals
    - Gain ranging for extended dynamic range
    - Compression techniques if applicable
  why_it_matters: |
    Dynamic range determines signal capture capability:
    - Must exceed expected signal dynamic range
    - Limited by weakest link in signal chain
    - ADC, amplifier, and analog stages each contribute
    - Noise floor sets lower limit
    - Clipping sets upper limit

    Insufficient dynamic range causes loss of weak signals
    or distortion of strong signals.
  when_to_run:
  - Signal acquisition system design
  - Dynamic range optimization
  - Wide dynamic range applications
  - System troubleshooting
prerequisites:
  required_artifacts:
  - type: schematic
    description: Signal path design
  - type: specifications
    description: Component specifications
  - type: requirements
    description: Signal dynamic range requirements
  access_requirements:
  - Access to component specifications
  - Signal path documentation
  - Measurement capability
discovery:
  code_patterns:
  - pattern: (dynamic_range|dr|DR|headroom)
    type: regex
    scope: source
    purpose: Detect dynamic range handling
  - pattern: (gain|range)_(select|auto|switch)
    type: regex
    scope: source
    purpose: Detect gain ranging
  - pattern: (clip|saturat|overflow)
    type: regex
    scope: source
    purpose: Detect clipping handling
  file_patterns:
  - glob: '**/gain*.{c,h,cpp,py}'
    purpose: Gain control files
  - glob: '**/range*.{c,h,cpp}'
    purpose: Range control files
signals:
  critical:
  - id: DR-CRIT-001
    signal: System dynamic range insufficient for signal
    evidence_indicators:
    - Signal dynamic range > system capability
    - Weak signals lost in noise
    - Strong signals clipped
    explanation: |
      When signal dynamic range exceeds system capability,
      either weak signals are lost or strong signals clip.
      Both cause irreversible information loss.
    remediation: |
      - Implement gain ranging
      - Use higher resolution ADC
      - Reduce noise floor
      - Consider compression for extreme ranges
    cwe: CWE-682
  - id: DR-CRIT-002
    signal: Bottleneck stage limiting dynamic range
    evidence_indicators:
    - One stage has much lower DR than others
    - DR limited by early stage in chain
    - Subsequent improvements don't help
    explanation: |
      System dynamic range is limited by the weakest stage.
      A poor stage early in the chain cannot be compensated
      by better stages afterward.
    remediation: |
      - Identify and upgrade limiting stage
      - Reorder stages if possible
      - Balance DR across signal chain
      - Document DR budget by stage
  high:
  - id: DR-HIGH-001
    signal: No headroom for signal peaks
    evidence_indicators:
    - Gain set for average signal level
    - Peaks approach clipping
    - Peak-to-average ratio not considered
    explanation: |
      Signals with high peak-to-average ratio need headroom.
      Setting gain for average level causes peak clipping.
      Music and speech can have 15-20dB crest factor.
    remediation: |
      - Account for peak-to-average ratio
      - Add headroom margin (6-12dB typical)
      - Implement peak detection and limiting
      - Document headroom requirements
  medium:
  - id: DR-MED-001
    signal: Dynamic range budget not analyzed
    evidence_indicators:
    - No stage-by-stage DR analysis
    - Overall DR assumed but not calculated
    - Limiting factors unknown
    explanation: |
      Without DR budget analysis, system capability cannot
      be verified. Each stage contribution to noise and
      clipping should be documented.
    remediation: |
      - Calculate DR for each stage
      - Identify limiting stage
      - Document DR budget
      - Verify system meets requirements
  low:
  - id: DR-LOW-001
    signal: Dynamic range not documented
    evidence_indicators:
    - No DR specification
    - Signal levels not specified
    - Headroom not noted
    explanation: |
      Undocumented dynamic range makes it difficult to
      verify system capability or troubleshoot issues.
    remediation: |
      - Document overall dynamic range
      - Specify maximum and minimum signals
      - Note headroom requirements
      - Include in system specifications
  positive:
  - id: DR-POS-001
    signal: Well-designed dynamic range with margin
    evidence_indicators:
    - DR exceeds requirements
    - Headroom adequate
    - DR budget documented
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: systems-engineer
  steps:
  - id: '1'
    name: Dynamic Range Analysis
    description: |
      Analyze dynamic range through signal path.
    duration_estimate: 45 min
    commands:
    - purpose: Find DR-related code
      command: |
        grep -rniE "(dynamic_range|headroom|clip)" \
          --include="*.c" --include="*.h" --include="*.py" . 2>/dev/null | head -20
    expected_findings:
    - DR configuration
    - Clipping handling
    - Gain ranging
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Dynamic Range Analysis
    - Bottleneck Identification
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 2
    signal-processing:
      included: true
      priority: 1
closeout_checklist:
- id: dr-001
  item: Dynamic range exceeds signal requirements
  level: CRITICAL
  verification: manual
  verification_notes: Verify system DR > signal dynamic range
  expected: Confirmed by reviewer
- id: dr-002
  item: Adequate headroom for peaks
  level: BLOCKING
  verification: manual
  verification_notes: Verify headroom for peak-to-average ratio
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - signal-processing
    - audio-systems
    - scientific-instruments
relationships:
  commonly_combined:
  - signal-processing.signal-conditioning.amplification
  - signal-processing.signal-conditioning.noise-reduction
  - signal-processing.adc-dac.adc-resolution-adequacy

# Glossary of domain-specific terms:
glossary:
  "mu (step size)": "Learning rate parameter in adaptive filters, controls convergence speed vs stability"
  "LMS": "Least Mean Squares - adaptive filter algorithm that minimizes mean squared error"
  "FFT": "Fast Fourier Transform - efficient algorithm to compute discrete Fourier transform"
