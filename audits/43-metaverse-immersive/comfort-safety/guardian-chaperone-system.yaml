# ============================================================
# AUDIT: Guardian/Chaperone System
# Category: 43 - Metaverse & Immersive
# Subcategory: comfort-safety
# ============================================================

audit:
  id: "metaverse-immersive.comfort-safety.guardian-chaperone-system"
  name: "Guardian/Chaperone System Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "metaverse-immersive"
  category_number: 43
  subcategory: "comfort-safety"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "xr-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Evaluates proper integration with platform guardian/chaperone systems
    that warn users of physical boundaries. Verifies the application
    respects and enhances system-level safety features rather than
    interfering with them.

  why_it_matters: |
    Guardian/chaperone systems are the last line of defense against
    physical injury. Applications that interfere with these systems
    put users at serious risk. Proper integration is a non-negotiable
    safety requirement.

  when_to_run:
    - "During safety certification"
    - "Before store submission"
    - "After platform updates"
    - "During safety review"

prerequisites:
  required_artifacts:
    - type: "guardian_code"
      description: "Guardian integration code"
    - type: "platform_integration"
      description: "Platform API usage"

  access_requirements:
    - "Access to application code"
    - "Guardian system testing"

discovery:
  file_patterns:
    - glob: "**/guardian/**/*.cs"
      purpose: "Find guardian code"
    - glob: "**/platform/**/*.cs"
      purpose: "Find platform integration"

  code_patterns:
    - pattern: "OVRManager|XRInputSubsystem"
      type: "keyword"
      scope: "source"
      purpose: "Find platform code"
    - pattern: "suppressGuardian|disableChaperone"
      type: "keyword"
      scope: "source"
      purpose: "Find dangerous patterns"

knowledge_sources:
  specifications:
    - id: "oculus-guardian-api"
      name: "Oculus Guardian API"
      url: "https://developer.oculus.com/documentation/native/android/mobile-guardian/"
      offline_cache: true
      priority: "required"

tooling:
  analysis_tools:
    - tool: "api-analyzer"
      purpose: "Platform API usage analysis"

signals:
  critical:
    - id: "GCS-CRIT-001"
      signal: "Guardian system suppressed or disabled"
      evidence_indicators:
        - "API calls to disable guardian"
        - "Guardian not visible in app"
        - "suppressGuardian = true"
      explanation: |
        Suppressing guardian is a critical safety violation.
        Users may be injured when walking into obstacles.
      remediation: "Never suppress guardian system"

    - id: "GCS-CRIT-002"
      signal: "Guardian data misused"
      evidence_indicators:
        - "Boundary data used to place content outside"
        - "Guardian data shared inappropriately"
      explanation: |
        Guardian data should enhance safety, not encourage
        users to exceed boundaries.
      remediation: "Use guardian data only to improve safety"

  high:
    - id: "GCS-HIGH-001"
      signal: "Guardian not tested across platforms"
      evidence_indicators:
        - "Only tested on one platform"
        - "Chaperone integration missing"
      remediation: "Test on all target platforms"

    - id: "GCS-HIGH-002"
      signal: "No response to guardian events"
      evidence_indicators:
        - "Game continues when boundary approached"
        - "No pause on boundary warning"
      remediation: "Respond appropriately to guardian events"

  medium:
    - id: "GCS-MED-001"
      signal: "Guardian style conflicts with app"
      remediation: "Ensure guardian is visible with app visuals"

    - id: "GCS-MED-002"
      signal: "No boundary state feedback"
      remediation: "Query and respond to boundary state"

  low:
    - id: "GCS-LOW-001"
      signal: "Guardian integration not documented"
      remediation: "Document guardian integration"

  positive:
    - id: "GCS-POS-001"
      signal: "Guardian system fully respected"
    - id: "GCS-POS-002"
      signal: "Enhanced in-app boundary awareness"
    - id: "GCS-POS-003"
      signal: "Cross-platform compatibility"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Audit API Usage"
      description: "Check for guardian suppression"
      duration_estimate: "30 min"

    - id: "2"
      name: "Test Guardian Visibility"
      description: "Verify guardian appears correctly"
      duration_estimate: "45 min"

    - id: "3"
      name: "Test Event Response"
      description: "Check response to boundary events"
      duration_estimate: "45 min"

    - id: "4"
      name: "Cross-Platform Test"
      description: "Verify on all target platforms"
      duration_estimate: "45 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "guardian_report"
      format: "json"
      description: "Guardian integration assessment"

closeout_checklist:
  - id: "gcs-001"
    item: "Guardian never suppressed"
    level: "CRITICAL"
    verification: "automated"

  - id: "gcs-002"
    item: "Guardian visible and functional"
    level: "CRITICAL"
    verification: "manual"

  - id: "gcs-003"
    item: "Events handled appropriately"
    level: "BLOCKING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["vr-applications"]

  compliance_frameworks:
    - framework: "Meta VRC"
      controls: ["Safety Requirements"]
    - framework: "SteamVR"
      controls: ["Chaperone Requirements"]

relationships:
  commonly_combined:
    - "metaverse-immersive.comfort-safety.play-area-boundary"
    - "metaverse-immersive.comfort-safety.motion-sickness-prevention"
