# ============================================================
# AUDIT: World Mesh Quality
# Category: 43 - Metaverse & Immersive
# Subcategory: spatial-computing
# ============================================================

audit:
  id: "metaverse-immersive.spatial-computing.world-mesh-quality"
  name: "World Mesh Quality Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "metaverse-immersive"
  category_number: 43
  subcategory: "spatial-computing"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "xr-systems"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the quality of environment mesh generation for mixed reality
    applications. Assesses mesh accuracy, completeness, update rate,
    performance impact, and suitability for physics, occlusion, and
    spatial understanding tasks.

  why_it_matters: |
    World mesh quality determines how well virtual content can interact
    with the real world. Poor meshes cause objects to float, pass through
    surfaces, or be incorrectly occluded. High-quality spatial understanding
    is essential for convincing mixed reality.

  when_to_run:
    - "When implementing spatial interaction"
    - "When occlusion appears wrong"
    - "When physics interaction fails"
    - "During MR optimization"

prerequisites:
  required_artifacts:
    - type: "mesh_system"
      description: "Spatial mesh implementation"
    - type: "test_environment"
      description: "Physical test space"

  access_requirements:
    - "Access to MR device"
    - "Mesh API access"
    - "Test environment"

discovery:
  file_patterns:
    - glob: "**/meshing/**/*.cs"
      purpose: "Find meshing code"
    - glob: "**/spatial/**/*.cs"
      purpose: "Find spatial code"

  code_patterns:
    - pattern: "SpatialMesh|WorldMesh|MeshFilter"
      type: "keyword"
      scope: "source"
      purpose: "Find mesh usage"
    - pattern: "MeshCollider|NavMesh"
      type: "keyword"
      scope: "source"
      purpose: "Find mesh applications"

knowledge_sources:
  guides:
    - id: "hololens-spatial"
      name: "HoloLens Spatial Mapping"
      url: "https://docs.microsoft.com/windows/mixed-reality/design/spatial-mapping"
      offline_cache: true

    - id: "meta-scene"
      name: "Meta Scene Understanding"
      url: "https://developer.oculus.com/documentation/native/native-scene/"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "mesh-analyzer"
      purpose: "Mesh quality analysis"

    - tool: "mesh-visualizer"
      purpose: "Mesh visualization"

signals:
  critical:
    - id: "WMQ-CRIT-001"
      signal: "Mesh significantly deviates from reality"
      evidence_threshold: "surface_error > 5cm average"
      explanation: |
        Large deviations cause virtual objects to float or sink into
        real surfaces, breaking the mixed reality illusion.
      remediation: "Improve mesh generation or use higher-quality sensors"

    - id: "WMQ-CRIT-002"
      signal: "Mesh missing major surfaces"
      evidence_indicators:
        - "Walls or floors not detected"
        - "Large holes in mesh"
        - "Unable to place content on surfaces"
      explanation: |
        Missing surfaces prevent interaction with parts of the
        environment, limiting application usefulness.
      remediation: "Improve scanning coverage and hole filling"

  high:
    - id: "WMQ-HIGH-001"
      signal: "Mesh update latency too high"
      evidence_threshold: "mesh_update_latency > 500ms"
      remediation: "Optimize mesh generation pipeline"

    - id: "WMQ-HIGH-002"
      signal: "Mesh polygon count affects performance"
      evidence_indicators:
        - "Frame rate drops with complex meshes"
        - "Memory limits exceeded"
      remediation: "Implement mesh decimation and LOD"

  medium:
    - id: "WMQ-MED-001"
      signal: "Mesh doesn't distinguish surfaces"
      remediation: "Add surface classification"

    - id: "WMQ-MED-002"
      signal: "Mesh quality varies by material"
      remediation: "Document surface-dependent behavior"

  low:
    - id: "WMQ-LOW-001"
      signal: "Mesh debugging tools missing"
      remediation: "Add mesh visualization modes"

  positive:
    - id: "WMQ-POS-001"
      signal: "Accurate surface reconstruction"
    - id: "WMQ-POS-002"
      signal: "Complete environment coverage"
    - id: "WMQ-POS-003"
      signal: "Real-time mesh updates"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Measure Mesh Accuracy"
      description: "Compare mesh to real surfaces"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Check Coverage"
      description: "Verify all surfaces detected"
      duration_estimate: "45 min"

    - id: "3"
      name: "Test Update Rate"
      description: "Measure mesh update performance"
      duration_estimate: "45 min"

    - id: "4"
      name: "Assess Performance Impact"
      description: "Check mesh processing overhead"
      duration_estimate: "45 min"

    - id: "5"
      name: "Test Physics/Occlusion"
      description: "Verify mesh usability"
      duration_estimate: "45 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "mesh_report"
      format: "json"
      description: "Mesh quality metrics"

closeout_checklist:
  - id: "wmq-001"
    item: "Mesh accuracy acceptable"
    level: "CRITICAL"
    verification: "automated"

  - id: "wmq-002"
    item: "Coverage complete"
    level: "BLOCKING"
    verification: "manual"

  - id: "wmq-003"
    item: "Performance impact acceptable"
    level: "WARNING"
    verification: "automated"

governance:
  applicable_to:
    archetypes: ["ar-applications", "mixed-reality"]

relationships:
  commonly_combined:
    - "metaverse-immersive.spatial-computing.occlusion-handling"
    - "metaverse-immersive.spatial-computing.spatial-anchor"
