audit:
  id: metaverse-immersive.rendering-performance.frame-rate-stability
  name: Frame Rate Stability Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: metaverse-immersive
  category_number: 43
  subcategory: rendering-performance
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: 'yes'
  severity: critical
  scope: xr-systems
  default_profiles:
  - full
  - quick
  - production
  blocks_phase: true
  parallelizable: true
description:
  what: |
    Evaluates the stability and consistency of frame rate in XR applications.
    Measures average frame rate, frame time variance, dropped frames, and
    stutter events. Verifies the application meets platform requirements
    for comfortable viewing (typically 72-120 Hz).
  why_it_matters: |
    Frame rate stability is critical for VR comfort. Dropped frames cause
    judder that can trigger motion sickness within minutes. Users may
    tolerate occasional minor issues but consistent problems make experiences
    unusable. Frame rate is the most important performance metric in XR.
  when_to_run:
  - During performance optimization
  - Before release
  - After content changes
  - When users report discomfort
prerequisites:
  required_artifacts:
  - type: xr_application
    description: Running XR application
  - type: profiling_tools
    description: Performance profiling setup
  access_requirements:
  - Access to XR device
  - Profiling tool access
discovery:
  metrics_queries:
  - system: unity_profiler
    query: frame_time_ms
    purpose: Measure frame times
    threshold: < 11.1ms for 90Hz
  - system: oculus_metrics
    query: dropped_frames
    purpose: Count dropped frames
    threshold: < 1% of frames
  file_patterns:
  - glob: '**/*.unity'
    purpose: Unity scene files
  - glob: '**/*.uasset'
    purpose: Unreal asset files
  - glob: '**/*.shader'
    purpose: Shader files
  - glob: '**/*.hlsl'
    purpose: HLSL shader code
  - glob: '**/*.glsl'
    purpose: GLSL shader code
  - glob: '**/ProjectSettings/**'
    purpose: Unity project settings
  code_patterns:
  - pattern: XR|VR|AR|MixedReality|OpenXR
    type: regex
    scope: source
    purpose: XR/VR/AR references
  - pattern: AudioSource|SpatialAudio|FMOD|Wwise
    type: regex
    scope: source
    purpose: Audio system references
knowledge_sources:
  specifications:
  - id: meta-perf
    name: Meta Quest Performance Requirements
    url: https://developer.oculus.com/documentation/native/android/mobile-performance-intro/
    offline_cache: true
    priority: required
  guides:
  - id: unity-xr-perf
    name: Unity XR Performance
    url: https://docs.unity3d.com/Manual/VRPerformance.html
    offline_cache: true
tooling:
  analysis_tools:
  - tool: ovr-metrics-tool
    purpose: Oculus performance metrics
  - tool: unity-profiler
    purpose: Frame time analysis
  - tool: renderdoc
    purpose: GPU profiling
signals:
  critical:
  - id: FRS-CRIT-001
    signal: Frame rate below display refresh
    evidence_threshold: avg_fps < display_refresh_rate
    explanation: |
      Running below refresh rate causes visible judder and motion
      sickness. This is the most important VR performance requirement.
    remediation: |
      Profile and optimize rendering.
      Reduce draw calls and polygon count.
      Implement LOD and culling.
      Consider resolution reduction.
  - id: FRS-CRIT-002
    signal: Frequent dropped frames
    evidence_threshold: dropped_frame_rate > 1%
    explanation: |
      Dropped frames cause sudden visual stutters that are very
      noticeable and uncomfortable in VR.
    remediation: Identify and fix frame spikes causing drops
  high:
  - id: FRS-HIGH-001
    signal: High frame time variance
    evidence_threshold: frame_time_std > 2ms
    remediation: Smooth out inconsistent frame times
  - id: FRS-HIGH-002
    signal: Garbage collection spikes
    evidence_indicators:
    - Periodic frame spikes
    - GC allocations during gameplay
    remediation: Eliminate runtime allocations
  medium:
  - id: FRS-MED-001
    signal: No headroom for dynamic content
    evidence_indicators:
    - Frame time near budget
    - No margin for additional load
    remediation: Optimize to create performance headroom
  - id: FRS-MED-002
    signal: Performance varies by scene
    remediation: Audit and optimize all scenes
  low:
  - id: FRS-LOW-001
    signal: Performance metrics not logged
    remediation: Implement performance telemetry
  positive:
  - id: FRS-POS-001
    signal: Stable frame rate with headroom
  - id: FRS-POS-002
    signal: Zero dropped frames in testing
  - id: FRS-POS-003
    signal: Low frame time variance
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Profile Baseline Performance
    description: Measure frame rate in typical scenes
    duration_estimate: 1 hour
  - id: '2'
    name: Test Stress Scenarios
    description: Measure under high load
    duration_estimate: 1 hour
  - id: '3'
    name: Analyze Frame Time Distribution
    description: Check for spikes and variance
    duration_estimate: 45 min
  - id: '4'
    name: Identify Bottlenecks
    description: Find CPU/GPU bound areas
    duration_estimate: 1 hour
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: performance_report
    format: json
    description: Detailed frame rate metrics
closeout_checklist:
- id: frs-001
  item: Frame rate meets display refresh
  level: CRITICAL
  verification: automated
- id: frs-002
  item: Dropped frames < 1%
  level: CRITICAL
  verification: automated
- id: frs-003
  item: Frame time variance acceptable
  level: BLOCKING
  verification: automated
governance:
  applicable_to:
    archetypes:
    - vr-applications
    - xr-applications
  compliance_frameworks:
  - framework: Meta VRC
    controls:
    - Performance Requirements
relationships:
  commonly_combined:
  - metaverse-immersive.rendering-performance.latency-motion-to-photon
  - metaverse-immersive.comfort-safety.motion-sickness-prevention
