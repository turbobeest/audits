# ============================================================
# AUDIT: LOD Implementation
# Category: 43 - Metaverse & Immersive
# Subcategory: rendering-performance
# ============================================================

audit:
  id: "metaverse-immersive.rendering-performance.lod-implementation"
  name: "LOD Implementation Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "metaverse-immersive"
  category_number: 43
  subcategory: "rendering-performance"

  tier: "expert"
  estimated_duration: "2-4 hours"  # median: 3h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "xr-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the implementation of Level of Detail (LOD) systems for
    3D models in XR applications. Assesses LOD transitions, polygon
    reduction ratios, transition distances, and visual quality impact
    of LOD switching.

  why_it_matters: |
    LOD is essential for XR performance. Detailed models far from the
    viewer waste GPU resources. Well-implemented LOD maintains visual
    quality where it matters while dramatically reducing rendering cost.
    Poor LOD causes visible popping or wastes performance.

  when_to_run:
    - "During content optimization"
    - "When frame rate is low"
    - "After importing new assets"
    - "When LOD popping is visible"

prerequisites:
  required_artifacts:
    - type: "3d_assets"
      description: "3D models with LOD"
    - type: "lod_settings"
      description: "LOD configuration"

  access_requirements:
    - "Access to asset files"
    - "LOD configuration access"

discovery:
  file_patterns:
    - glob: "**/*.fbx"
      purpose: "Find 3D models"
    - glob: "**/LOD/**"
      purpose: "Find LOD groups"

  code_patterns:
    - pattern: "LODGroup|LOD[0-9]"
      type: "keyword"
      scope: "source"
      purpose: "Find LOD usage"

knowledge_sources:
  guides:
    - id: "unity-lod"
      name: "Unity LOD System"
      url: "https://docs.unity3d.com/Manual/LevelOfDetail.html"
      offline_cache: true

    - id: "vr-lod"
      name: "VR LOD Best Practices"
      url: "https://developer.oculus.com/documentation/unity/unity-optimization/"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "lod-analyzer"
      purpose: "LOD configuration analysis"

    - tool: "poly-counter"
      purpose: "Polygon count per LOD"

signals:
  critical:
    - id: "LOD-CRIT-001"
      signal: "No LOD implemented for complex models"
      evidence_indicators:
        - "High-poly models always at full detail"
        - "No LOD groups defined"
        - "Distant objects at full resolution"
      explanation: |
        Without LOD, high-poly models waste GPU resources when far
        away, directly impacting frame rate.
      remediation: "Create LOD levels for all complex models"

    - id: "LOD-CRIT-002"
      signal: "LOD transitions cause severe popping"
      evidence_indicators:
        - "Jarring visual changes on LOD switch"
        - "Objects appear to transform"
      explanation: |
        Obvious LOD transitions are distracting and break immersion.
        Transitions should be imperceptible.
      remediation: "Improve LOD transitions with cross-fade or better distances"

  high:
    - id: "LOD-HIGH-001"
      signal: "LOD distances too aggressive"
      evidence_indicators:
        - "Low-detail models too close"
        - "Visual quality noticeably reduced"
      remediation: "Increase LOD distances"

    - id: "LOD-HIGH-002"
      signal: "Insufficient LOD levels"
      evidence_indicators:
        - "Only 2 LOD levels"
        - "Large poly count jump between levels"
      remediation: "Add intermediate LOD levels"

  medium:
    - id: "LOD-MED-001"
      signal: "LOD not tuned for VR"
      evidence_indicators:
        - "Desktop LOD distances used"
        - "VR scale not considered"
      remediation: "Adjust LOD for VR viewing"

    - id: "LOD-MED-002"
      signal: "No LOD for materials"
      remediation: "Implement texture/shader LOD"

  low:
    - id: "LOD-LOW-001"
      signal: "LOD settings undocumented"
      remediation: "Document LOD configuration"

  positive:
    - id: "LOD-POS-001"
      signal: "Smooth imperceptible LOD transitions"
    - id: "LOD-POS-002"
      signal: "Appropriate LOD distances"
    - id: "LOD-POS-003"
      signal: "Significant polygon reduction"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory LOD Assets"
      description: "List all assets with/without LOD"
      duration_estimate: "45 min"

    - id: "2"
      name: "Analyze LOD Ratios"
      description: "Check polygon reduction per level"
      duration_estimate: "45 min"

    - id: "3"
      name: "Test Transitions"
      description: "Verify transition smoothness"
      duration_estimate: "45 min"

    - id: "4"
      name: "Validate Distances"
      description: "Check LOD switch distances"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "lod_report"
      format: "json"
      description: "LOD implementation analysis"

closeout_checklist:
  - id: "lod-001"
    item: "Complex models have LOD"
    level: "CRITICAL"
    verification: "automated"

  - id: "lod-002"
    item: "Transitions imperceptible"
    level: "BLOCKING"
    verification: "manual"

  - id: "lod-003"
    item: "Distances appropriate"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["xr-applications", "3d-applications"]

relationships:
  commonly_combined:
    - "metaverse-immersive.3d-asset-quality.model-polygon-count"
    - "metaverse-immersive.rendering-performance.draw-call-optimization"
