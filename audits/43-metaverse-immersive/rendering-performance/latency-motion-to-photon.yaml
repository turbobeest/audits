audit:
  id: metaverse-immersive.rendering-performance.latency-motion-to-photon
  name: Motion-to-Photon Latency Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: metaverse-immersive
  category_number: 43
  subcategory: rendering-performance
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  requires_physical_access: true
  severity: critical
  scope: xr-systems
  default_profiles:
  - full
  - quick
  blocks_phase: true
  parallelizable: true
description:
  what: |
    Measures the total latency from physical user motion to corresponding
    visual update on the display. Evaluates tracking latency, rendering
    pipeline latency, display latency, and effectiveness of latency
    compensation techniques like timewarp/spacewarp.
  why_it_matters: |
    High motion-to-photon latency causes the visual world to lag behind
    head movement, creating a nauseating disconnect between vestibular
    and visual systems. Latency under 20ms is required for comfort;
    under 10ms is ideal. This is the primary cause of VR sickness.
  when_to_run:
  - During XR development
  - When users report nausea
  - After tracking/rendering changes
  - When changing hardware
prerequisites:
  required_artifacts:
  - type: xr_system
    description: Complete XR pipeline
  - type: latency_measurement
    description: Latency measurement tools
  access_requirements:
  - Access to XR hardware
  - Specialized latency measurement
  - Full pipeline access
discovery:
  metrics_queries:
  - system: xr_runtime
    query: motion_to_photon_latency
    purpose: Total latency measurement
    threshold: < 20ms
  - system: tracking
    query: tracking_latency
    purpose: Tracking system latency
    threshold: < 5ms
  file_patterns:
  - glob: '**/*.unity'
    purpose: Unity scene files
  - glob: '**/*.uasset'
    purpose: Unreal asset files
  - glob: '**/*.shader'
    purpose: Shader files
  - glob: '**/*.hlsl'
    purpose: HLSL shader code
  - glob: '**/*.glsl'
    purpose: GLSL shader code
  - glob: '**/ProjectSettings/**'
    purpose: Unity project settings
  code_patterns:
  - pattern: XR|VR|AR|MixedReality|OpenXR
    type: regex
    scope: source
    purpose: XR/VR/AR references
  - pattern: AudioSource|SpatialAudio|FMOD|Wwise
    type: regex
    scope: source
    purpose: Audio system references
knowledge_sources:
  specifications:
  - id: latency-research
    name: VR Latency Research
    url: https://developer.oculus.com/blog/latency-mitigation-strategies/
    offline_cache: true
    priority: required
  guides:
  - id: timewarp
    name: Asynchronous Timewarp
    url: https://developer.oculus.com/documentation/native/android/mobile-timewarp-overview/
    offline_cache: true
tooling:
  analysis_tools:
  - tool: latency-tester
    purpose: End-to-end latency measurement
  - tool: high-speed-camera
    purpose: Visual latency verification
signals:
  critical:
  - id: MTP-CRIT-001
    signal: Motion-to-photon latency > 20ms
    evidence_threshold: total_latency > 20ms
    explanation: |
      Latency above 20ms causes noticeable disconnect between motion
      and visual response, leading to disorientation and nausea.
    remediation: |
      Enable/verify timewarp/spacewarp.
      Reduce rendering latency.
      Upgrade to lower-latency display.
      Optimize tracking pipeline.
  - id: MTP-CRIT-002
    signal: Timewarp/spacewarp not functioning
    evidence_indicators:
    - Late frames show old pose
    - Latency compensation disabled
    explanation: |
      Without timewarp, any dropped frame causes old pose to be
      displayed, dramatically increasing effective latency.
    remediation: Enable and verify asynchronous reprojection
  high:
  - id: MTP-HIGH-001
    signal: Tracking latency contributes significantly
    evidence_threshold: tracking_latency > 5ms
    remediation: Optimize tracking pipeline
  - id: MTP-HIGH-002
    signal: Render pipeline adds excessive latency
    evidence_indicators:
    - Multiple frames queued
    - GPU bubbles
    remediation: Optimize render pipeline and reduce queuing
  medium:
  - id: MTP-MED-001
    signal: Latency not measured
    remediation: Implement latency measurement
  - id: MTP-MED-002
    signal: Prediction accuracy poor
    remediation: Improve pose prediction
  low:
  - id: MTP-LOW-001
    signal: Latency telemetry missing
    remediation: Add latency monitoring
  positive:
  - id: MTP-POS-001
    signal: Latency consistently < 15ms
  - id: MTP-POS-002
    signal: Effective timewarp functioning
  - id: MTP-POS-003
    signal: Low tracking latency
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Measure End-to-End Latency
    description: Total motion-to-photon measurement
    duration_estimate: 1 hour
  - id: '2'
    name: Break Down Components
    description: Measure each pipeline stage
    duration_estimate: 1 hour
  - id: '3'
    name: Verify Timewarp
    description: Confirm reprojection working
    duration_estimate: 45 min
  - id: '4'
    name: Test Under Load
    description: Measure latency during stress
    duration_estimate: 45 min
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: latency_report
    format: json
    description: Latency breakdown
closeout_checklist:
- id: mtp-001
  item: Motion-to-photon < 20ms
  level: CRITICAL
  verification: automated
- id: mtp-002
  item: Timewarp functioning
  level: CRITICAL
  verification: manual
- id: mtp-003
  item: Component latencies documented
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - vr-applications
    - xr-applications
relationships:
  commonly_combined:
  - metaverse-immersive.rendering-performance.frame-rate-stability
  - metaverse-immersive.spatial-computing.spatial-tracking-accuracy
