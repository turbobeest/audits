audit:
  id: metaverse-immersive.rendering-performance.draw-call-optimization
  name: Draw Call Optimization Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: metaverse-immersive
  category_number: 43
  subcategory: rendering-performance
  tier: expert
  estimated_duration: 2-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: 'yes'
  severity: high
  scope: xr-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates draw call count and batching efficiency in XR rendering.
    Assesses static batching, dynamic batching, GPU instancing, and
    material/mesh optimization to minimize CPU overhead from draw calls.
  why_it_matters: |
    Draw calls are a major CPU bottleneck, especially on mobile VR.
    Each draw call has CPU overhead regardless of triangle count.
    Reducing draw calls is often the most effective optimization for
    CPU-bound XR applications.
  when_to_run:
  - During performance optimization
  - When CPU bound
  - After adding new content
  - During batching configuration
prerequisites:
  required_artifacts:
  - type: rendering_stats
    description: Draw call metrics
  - type: batching_config
    description: Batching settings
  access_requirements:
  - Access to profiler
  - Frame debugger access
discovery:
  metrics_queries:
  - system: unity_profiler
    query: draw_calls
    purpose: Count draw calls
    threshold: < 100 for mobile VR
  - system: unity_profiler
    query: batches
    purpose: Count batches
  file_patterns:
  - glob: '**/*.unity'
    purpose: Unity scene files
  - glob: '**/*.uasset'
    purpose: Unreal asset files
  - glob: '**/*.shader'
    purpose: Shader files
  - glob: '**/*.hlsl'
    purpose: HLSL shader code
  - glob: '**/*.glsl'
    purpose: GLSL shader code
  - glob: '**/ProjectSettings/**'
    purpose: Unity project settings
  code_patterns:
  - pattern: XR|VR|AR|MixedReality|OpenXR
    type: regex
    scope: source
    purpose: XR/VR/AR references
  - pattern: AudioSource|SpatialAudio|FMOD|Wwise
    type: regex
    scope: source
    purpose: Audio system references
knowledge_sources:
  guides:
  - id: unity-batching
    name: Unity Draw Call Batching
    url: https://docs.unity3d.com/Manual/DrawCallBatching.html
    offline_cache: true
  - id: mobile-vr-optimization
    name: Mobile VR Optimization
    url: https://developer.oculus.com/documentation/unity/unity-optimization/
    offline_cache: true
tooling:
  analysis_tools:
  - tool: frame-debugger
    purpose: Draw call analysis
  - tool: rendering-profiler
    purpose: Batch analysis
signals:
  critical:
  - id: DCO-CRIT-001
    signal: Draw call count exceeds budget
    evidence_threshold: draw_calls > 100 on mobile VR
    explanation: |
      Excessive draw calls cause CPU bottleneck, reducing frame rate
      even when GPU has capacity.
    remediation: |
      Enable batching.
      Use GPU instancing.
      Reduce material count.
      Combine meshes.
  - id: DCO-CRIT-002
    signal: Batching completely ineffective
    evidence_indicators:
    - No batching occurring
    - Batch count equals draw calls
    explanation: |
      If batching isn't working, optimization opportunities are lost.
    remediation: Diagnose and fix batching issues
  high:
  - id: DCO-HIGH-001
    signal: Too many unique materials
    evidence_indicators:
    - Material count close to draw calls
    - Similar materials not shared
    remediation: Consolidate materials and use texture atlases
  - id: DCO-HIGH-002
    signal: Static batching not enabled
    evidence_indicators:
    - Static objects not batched
    - Static batching disabled
    remediation: Enable static batching for non-moving objects
  medium:
  - id: DCO-MED-001
    signal: GPU instancing not used
    remediation: Enable GPU instancing for repeated objects
  - id: DCO-MED-002
    signal: Skinned meshes not optimized
    remediation: Optimize skinned mesh rendering
  low:
  - id: DCO-LOW-001
    signal: Draw call budget not defined
    remediation: Define draw call budget
  positive:
  - id: DCO-POS-001
    signal: Draw calls within budget
  - id: DCO-POS-002
    signal: Effective batching
  - id: DCO-POS-003
    signal: GPU instancing utilized
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Count Draw Calls
    description: Measure current draw call count
    duration_estimate: 30 min
  - id: '2'
    name: Analyze Batching
    description: Check batching efficiency
    duration_estimate: 45 min
  - id: '3'
    name: Identify Breaking Points
    description: Find what breaks batches
    duration_estimate: 45 min
  - id: '4'
    name: Test Optimizations
    description: Try batching improvements
    duration_estimate: 1 hour
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: drawcall_report
    format: json
    description: Draw call analysis
closeout_checklist:
- id: dco-001
  item: Draw calls within budget
  level: CRITICAL
  verification: automated
- id: dco-002
  item: Batching effective
  level: BLOCKING
  verification: automated
- id: dco-003
  item: Instancing used where appropriate
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - xr-applications
    - mobile-vr
relationships:
  commonly_combined:
  - metaverse-immersive.rendering-performance.frame-rate-stability
  - metaverse-immersive.3d-asset-quality.model-polygon-count
