audit:
  id: api-integration.error-handling.http-status-code-usage
  name: HTTP Status Code Usage Assessment
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: api-integration
  category_number: 9
  subcategory: error-handling
  tier: expert
  estimated_duration: 1 hour
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: 'yes'
  severity: high
  scope: codebase
  default_profiles:
  - full
  - quick
  parallelizable: true
description:
  what: |
    Evaluates HTTP status code usage for semantic correctness and consistency.
    Examines whether status codes match the actual response meaning (2xx for
    success, 4xx for client errors, 5xx for server errors) and whether
    specific codes are used appropriately (201 for creation, 404 for not found).
  why_it_matters: |
    Correct status codes enable proper client behavior - caching, retries,
    error handling. Incorrect codes (e.g., 200 for errors) break client logic,
    confuse developers, and prevent proper monitoring. Status codes are a
    fundamental HTTP contract.
  when_to_run:
  - During API design reviews
  - Before API releases
  - When debugging client integration issues
prerequisites:
  required_artifacts:
  - type: api-source
    description: API controller and handler code
  access_requirements:
  - Read access to API source code
discovery:
  code_patterns:
  - pattern: HttpStatus\.|status\(\d{3}\)|statusCode.*=
    type: regex
    scope: source
    purpose: Status code usage
  - pattern: return.*200|return.*400|return.*500
    type: regex
    scope: source
    purpose: Status code returns
  - pattern: '@ResponseStatus|ResponseEntity'
    type: regex
    scope: source
    purpose: Spring status annotations
  file_patterns:
  - glob: '**/controllers/**/*.{java,ts,py}'
    purpose: Controller implementations
  - glob: '**/handlers/**/*.{java,ts,py}'
    purpose: Handler implementations
knowledge_sources:
  specifications:
  - id: rfc-9110
    name: RFC 9110 - HTTP Semantics (Status Codes)
    url: https://datatracker.ietf.org/doc/html/rfc9110#section-15
    offline_cache: true
    priority: required
  - id: owasp-api-security
    name: OWASP API Security Top 10
    url: https://owasp.org/API-Security/
    offline_cache: true
    priority: recommended
  guides:
  - id: http-status-codes
    name: HTTP Status Code Reference
    url: https://httpstatuses.com/
    offline_cache: true
tooling:
  static_analysis:
  - tool: spectral
    purpose: Lint OpenAPI for status code consistency
    offline_capable: true
signals:
  critical:
  - id: STATUS-CRIT-001
    signal: 200 OK returned for error conditions
    evidence_pattern: return.*200.*error|status.*200.*fail
    explanation: |
      Returning 200 for errors breaks client error handling. Clients check
      status codes first; 200 indicates success and may be cached.
    remediation: Use appropriate 4xx/5xx codes for errors
  - id: STATUS-CRIT-002
    signal: 500 returned for client errors
    evidence_pattern: 500.*validation|500.*not.*found|500.*invalid
    explanation: |
      500 indicates server failure, triggering alerts and retry logic.
      Client errors (validation, not found) should use 4xx codes.
    remediation: Use 400 for validation, 404 for not found, 401/403 for auth
  high:
  - id: STATUS-HIGH-001
    signal: 201 not used for resource creation
    evidence_pattern: save|create.*return.*200
    explanation: |
      POST that creates resources should return 201 Created with Location
      header, not 200 OK. This helps clients distinguish creation from update.
    remediation: Return 201 Created with Location header for new resources
  - id: STATUS-HIGH-002
    signal: 404 used for business logic (soft) not found
    evidence_pattern: 404.*deleted|404.*inactive|404.*disabled
    explanation: |
      404 means resource doesn't exist. For resources that exist but are
      unavailable (deleted, inactive), use 410 Gone or 403 Forbidden.
    remediation: Use 410 for deleted resources, 403 for inaccessible
  medium:
  - id: STATUS-MED-001
    signal: Generic 400 for all validation errors
    evidence_pattern: 400.*BadRequest(?!.*specific)
    remediation: Consider 422 Unprocessable Entity for semantic validation errors
  - id: STATUS-MED-002
    signal: 204 returned with response body
    evidence_pattern: 204.*return.*body|NO_CONTENT.*response
    remediation: 204 must have no body; use 200 if body needed
  low:
  - id: STATUS-LOW-001
    signal: Uncommon status codes without documentation
    remediation: Document any non-standard status code usage
  positive:
  - id: STATUS-POS-001
    signal: Correct 2xx codes for success variants
  - id: STATUS-POS-002
    signal: Proper 4xx/5xx distinction for errors
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Status Code Usage
    description: |
      Find all status code usages in the codebase.
    duration_estimate: 15 min
    commands:
    - purpose: Find HttpStatus usage
      command: grep -rn 'HttpStatus\.' --include='*.java' --include='*.ts' . | grep -oE 'HttpStatus\.[A-Z_]+'
        | sort | uniq -c | sort -rn
    - purpose: Find numeric status codes
      command: grep -rEo 'status\([0-9]{3}\)|statusCode.*[0-9]{3}' --include='*.java' --include='*.ts'
        . | sort | uniq -c | sort -rn
    - purpose: Find response annotations
      command: grep -rn '@ResponseStatus' --include='*.java' .
    expected_findings:
    - Status code distribution
    - Usage patterns
  - id: '2'
    name: Check Success Code Usage
    description: |
      Verify 2xx codes are used correctly.
    duration_estimate: 15 min
    commands:
    - purpose: Find 200 with create operations
      command: grep -rn -B5 -A5 'save\|create\|insert' --include='*.java' --include='*.ts' . | grep -i
        '200\|OK' | head -20
    - purpose: Find 201 usage
      command: grep -rn '201\|CREATED' --include='*.java' --include='*.ts' .
    - purpose: Find 204 usage
      command: grep -rn '204\|NO_CONTENT' --include='*.java' --include='*.ts' .
    expected_findings:
    - Creation response codes
    - 204 usage patterns
  - id: '3'
    name: Analyze Error Code Usage
    description: |
      Verify 4xx and 5xx codes are used correctly.
    duration_estimate: 15 min
    commands:
    - purpose: Find 200 with error
      command: grep -rn 'return.*200\|OK' --include='*.java' --include='*.ts' . | grep -i 'error\|fail\|invalid'
        | head -20
    - purpose: Find 500 usage
      command: grep -rn '500\|INTERNAL_SERVER_ERROR' --include='*.java' --include='*.ts' . | head -20
    - purpose: Find 400 vs 422 usage
      command: grep -rn '400\|BAD_REQUEST\|422\|UNPROCESSABLE' --include='*.java' --include='*.ts' .
    expected_findings:
    - Error code patterns
    - Misused codes
  - id: '4'
    name: Check OpenAPI Consistency
    description: |
      Verify OpenAPI spec matches code status codes.
    duration_estimate: 10 min
    commands:
    - purpose: Find OpenAPI response codes
      command: grep -E '^\s+['"]?[0-9]{3}['"]?:' $(find . -name '*openapi*.yaml' | head -1) 2>/dev/null
        | sort | uniq -c | sort -rn
    - purpose: Check for documented errors
      command: grep -E '['"]?4[0-9]{2}['"]?:|['"]?5[0-9]{2}['"]?:' $(find . -name '*openapi*.yaml' | head
        -1) 2>/dev/null | head -20
    expected_findings:
    - OpenAPI status codes
    - Documentation coverage
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Status Code Analysis
    - Recommendations
  confidence_guidance:
    high: Status code usage thoroughly analyzed
    medium: Partial code coverage
    low: Limited status code evidence
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: rfc-9110
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 2
    full:
      included: true
      priority: 1
closeout_checklist:
- id: status-001
  item: No 200 returned for error conditions
  level: CRITICAL
  verification: |
    if grep -rn 'return.*200\|OK' --include='*.java' --include='*.ts' . 2>/dev/null | grep -qi 'error\|fail\|exception'; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: status-002
  item: 201 used for resource creation
  level: BLOCKING
  verification: |
    if grep -rq '201\|CREATED' --include='*.java' --include='*.ts' . 2>/dev/null; then echo "PASS"; else echo "FAIL"; fi
  expected: PASS
- id: status-003
  item: 4xx used for client errors, 5xx for server errors
  level: BLOCKING
  verification: manual
  verification_notes: Reviewer confirms proper 4xx/5xx distinction
  expected: Confirmed by reviewer
- id: status-004
  item: Error status codes documented in OpenAPI
  level: WARNING
  verification: |
    if grep -qE "'4[0-9]{2}':|'5[0-9]{2}':" $(find . -name '*openapi*.yaml' | head -1) 2>/dev/null; then echo "PASS"; else echo "FAIL"; fi
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - api-service
    - microservice
    - backend
relationships:
  commonly_combined:
  - api-integration.error-handling.error-response-format
  - api-integration.api-design.http-method-usage
