# ============================================================
# AUDIT: Interactive Documentation
# ============================================================

audit:
  id: "api-integration.api-documentation.interactive-documentation"
  name: "Interactive Documentation Audit"
  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "api-integration"
  category_number: 9
  subcategory: "api-documentation"

  tier: "expert"
  estimated_duration: "60 minutes"

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "documentation"

  default_profiles:
    - "full"
    - "api"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates interactive API documentation capabilities including
    try-it-out functionality, request/response visualization,
    authentication integration, environment switching, and code
    generation. Analyzes whether developers can effectively
    explore and test the API from documentation.

  why_it_matters: |
    Interactive documentation accelerates API adoption by allowing
    developers to experiment without writing code. Studies show
    interactive docs reduce time-to-first-successful-call by 70%.
    They also serve as live examples that are always accurate.

  when_to_run:
    - "Developer experience audits"
    - "API onboarding reviews"
    - "Documentation platform evaluation"
    - "After documentation infrastructure changes"

prerequisites:
  required_artifacts:
    - type: "documentation"
      description: "API documentation portal or tooling"
    - type: "configuration"
      description: "Documentation platform configuration"

  access_requirements:
    - "Access to documentation portal"
    - "Access to documentation platform config"

discovery:
  code_patterns:
    - pattern: "swagger-ui|redoc|stoplight|rapidoc"
      type: "regex"
      scope: "config"
      purpose: "Detect documentation UI tools"

    - pattern: "try.*out|playground|explorer"
      type: "regex"
      scope: "config"
      purpose: "Detect interactive features"

  file_patterns:
    - glob: "**/swagger-ui/**"
      purpose: "Swagger UI files"
    - glob: "**/redoc/**"
      purpose: "ReDoc files"
    - glob: "**/docs/**"
      purpose: "Documentation configuration"

knowledge_sources:
  specifications:
    - id: "openapi-spec"
      name: "OpenAPI Specification"
      url: "https://spec.openapis.org/oas/latest.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "swagger-ui"
      name: "Swagger UI Documentation"
      url: "https://swagger.io/tools/swagger-ui/"
      offline_cache: true

    - id: "developer-portals"
      name: "API Developer Portal Best Practices"
      url: "https://swagger.io/blog/api-strategy/the-importance-of-an-api-developer-portal/"
      offline_cache: true

  learning_resources:
    - id: "api-playground"
      title: "Building API Playgrounds"
      type: "article"
      reference: "Stoplight Blog"

tooling:
  infrastructure_tools:
    - tool: "swagger-ui"
      purpose: "Interactive API documentation"
      command: "npx swagger-ui-express"

    - tool: "redoc"
      purpose: "API reference documentation"
      command: "npx redoc-cli"

  scripts:
    - id: "interactive-docs-scan"
      language: "bash"
      purpose: "Detect interactive documentation"
      source: "inline"
      code: |
        echo "=== Interactive Documentation Analysis ==="
        echo "--- Documentation UI packages ---"
        grep -rn "swagger-ui\|redoc\|stoplight\|rapidoc\|graphql-playground" \
          --include="package.json" --include="pom.xml" --include="*.gradle" . 2>/dev/null | \
          grep -v node_modules | head -10

        echo "--- Documentation routes ---"
        grep -rn "swagger\|docs\|api-docs\|graphql" \
          --include="*.ts" --include="*.java" --include="*.py" . 2>/dev/null | \
          grep -i "route\|path\|endpoint" | grep -v node_modules | head -20

signals:
  critical:
    - id: "ID-CRIT-001"
      signal: "Interactive docs expose production credentials"
      evidence_pattern: "Try-it-out pre-filled with real API keys"
      explanation: |
        If interactive documentation is pre-configured with production
        credentials, anyone accessing the docs can make authenticated
        requests to production systems.
      remediation: "Use sandbox environment or require user to provide credentials"

    - id: "ID-CRIT-002"
      signal: "Interactive docs hit production by default"
      evidence_pattern: "No environment selector, defaults to production"
      explanation: |
        Developers experimenting with try-it-out functionality should
        not inadvertently create, modify, or delete production data.
        This creates security and data integrity risks.
      remediation: "Default to sandbox/staging environment with clear warnings"

  high:
    - id: "ID-HIGH-001"
      signal: "No interactive documentation available"
      evidence_pattern: "Static documentation only without try-it-out"
      explanation: |
        Without interactive documentation, developers must set up their
        own testing environment before making any API calls. This
        significantly increases time to first successful integration.
      remediation: "Implement Swagger UI, ReDoc, or similar interactive tooling"

    - id: "ID-HIGH-002"
      signal: "Interactive docs not available for all endpoints"
      evidence_pattern: "Some endpoints excluded from try-it-out"
      explanation: |
        Inconsistent interactive documentation creates confusion about
        whether excluded endpoints exist or work correctly.
      remediation: "Enable interactive testing for all documented endpoints"

  medium:
    - id: "ID-MED-001"
      signal: "No authentication integration in docs"
      evidence_pattern: "Cannot test authenticated endpoints from docs"
      remediation: "Add authentication input in interactive docs"

    - id: "ID-MED-002"
      signal: "No environment switching"
      evidence_pattern: "Single environment only in interactive docs"
      remediation: "Allow switching between sandbox/staging/production"

    - id: "ID-MED-003"
      signal: "No code generation from docs"
      evidence_pattern: "No curl/SDK code snippets generated"
      remediation: "Add code generation for common languages"

  low:
    - id: "ID-LOW-001"
      signal: "Slow interactive documentation load time"
      evidence_pattern: "Docs take > 5 seconds to load"
      remediation: "Optimize documentation bundle size"

  positive:
    - id: "ID-POS-001"
      signal: "Full try-it-out capability"
      evidence_pattern: "All endpoints testable from documentation"

    - id: "ID-POS-002"
      signal: "Multiple environment support"
      evidence_pattern: "Easy switching between sandbox and production"

    - id: "ID-POS-003"
      signal: "Code snippets in multiple languages"
      evidence_pattern: "Auto-generated curl, Python, JS, etc."

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Documentation Platform"
      description: |
        Find what interactive documentation tooling is used.
      duration_estimate: "10 min"
      commands:
        - purpose: "Find doc UI dependencies"
          command: |
            grep -rn "swagger-ui\|redoc\|stoplight\|rapidoc" \
              --include="package.json" --include="pom.xml" . 2>/dev/null | \
              grep -v node_modules | head -10
        - purpose: "Find documentation routes"
          command: |
            grep -rn "swagger\|docs\|api-docs" \
              --include="*.ts" --include="*.java" . 2>/dev/null | \
              grep -v node_modules | head -20

      expected_findings:
        - "Documentation tooling"
        - "Documentation URL"

    - id: "2"
      name: "Evaluate Interactive Features"
      description: |
        Check available interactive capabilities.
      duration_estimate: "15 min"
      questions:
        - "Can requests be made from the documentation?"
        - "Is authentication supported in try-it-out?"
        - "Can environment be switched?"

      expected_findings:
        - "Try-it-out availability"
        - "Feature completeness"

    - id: "3"
      name: "Check Environment Configuration"
      description: |
        Verify environment safety in interactive docs.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find server configuration"
          command: |
            grep -rn "servers:\|baseUrl\|basePath" \
              --include="*.yaml" --include="*.json" . 2>/dev/null | \
              grep -i "openapi\|swagger" | grep -v node_modules | head -20

      expected_findings:
        - "Default environment"
        - "Environment options"

    - id: "4"
      name: "Review Code Generation"
      description: |
        Check if code snippets are available.
      duration_estimate: "10 min"
      commands:
        - purpose: "Find code generation config"
          command: |
            grep -rn "codegen\|snippet\|code-samples" \
              --include="*.yaml" --include="*.json" --include="*.js" . 2>/dev/null | \
              grep -v node_modules | head -20

      expected_findings:
        - "Code generation availability"
        - "Supported languages"

    - id: "5"
      name: "Verify Security Configuration"
      description: |
        Check for credential exposure in interactive docs.
      duration_estimate: "10 min"
      commands:
        - purpose: "Find API key configuration"
          command: |
            grep -rn "apiKey\|api_key\|authorization" \
              --include="*.yaml" --include="*.json" . 2>/dev/null | \
              grep -i "openapi\|swagger" | grep -v node_modules | head -20

      expected_findings:
        - "Credential handling"
        - "Security configuration"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      content:
        - "interactive_features"
        - "environment_configuration"
        - "security_status"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Interactive Capabilities"
        - "Security Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Clear capability present or missing"
    medium: "Feature exists but quality uncertain"
    low: "Requires manual testing to confirm"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "swagger-ui"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Developer experience assessment"
    full:
      included: true
      priority: 2
    api:
      included: true
      priority: 1

closeout_checklist:
  - id: "id-001"
    item: "Interactive documentation available"
    level: "BLOCKING"
    verification: |
      grep -rn "swagger-ui\|redoc\|stoplight\|rapidoc" \
        --include="package.json" --include="pom.xml" . 2>/dev/null | \
        grep -v node_modules | wc -l | xargs -I {} test {} -gt 0 && echo "PASS" || echo "FAIL"
    expected: "PASS"

  - id: "id-002"
    item: "Sandbox environment as default"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify interactive docs default to non-production environment"
    expected: "Confirmed by reviewer"

  - id: "id-003"
    item: "No production credentials exposed"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify no pre-filled production API keys in docs"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "ISO 25010"
      controls: ["Usability"]

relationships:
  commonly_combined:
    - "api-integration.api-documentation.documentation-completeness"
    - "api-integration.api-documentation.getting-started-guide"
    - "api-integration.api-documentation.sdk-client-library"
