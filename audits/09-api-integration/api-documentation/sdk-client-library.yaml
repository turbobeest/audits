# ============================================================
# AUDIT: SDK/Client Library
# ============================================================

audit:
  id: "api-integration.api-documentation.sdk-client-library"
  name: "SDK/Client Library Audit"
  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "api-integration"
  category_number: 9
  subcategory: "api-documentation"

  tier: "expert"
  estimated_duration: "90 minutes"

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "codebase"

  default_profiles:
    - "full"
    - "api"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates API client libraries and SDKs including language coverage,
    type safety, error handling, authentication helpers, retry logic,
    version management, and documentation. Analyzes whether SDKs
    provide a high-quality developer experience.

  why_it_matters: |
    SDKs reduce integration time from days to hours by abstracting
    authentication, serialization, error handling, and retry logic.
    Well-designed SDKs increase adoption and reduce support burden.
    Poor SDKs can actually harm adoption if they're buggy or incomplete.

  when_to_run:
    - "API release preparation"
    - "SDK version planning"
    - "Developer experience audits"
    - "After OpenAPI changes"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "SDK source code or generation configuration"
    - type: "documentation"
      description: "OpenAPI specification"

  access_requirements:
    - "Read access to SDK repositories"
    - "Access to API specification"

discovery:
  code_patterns:
    - pattern: "openapi-generator|swagger-codegen|autorest"
      type: "regex"
      scope: "config"
      purpose: "Detect SDK generation tools"

    - pattern: "ApiClient|HttpClient|RestClient"
      type: "regex"
      scope: "source"
      purpose: "Detect client library classes"

  file_patterns:
    - glob: "**/sdk/**"
      purpose: "SDK source code"
    - glob: "**/client/**"
      purpose: "Client libraries"
    - glob: "**/openapitools.json"
      purpose: "OpenAPI generator config"

knowledge_sources:
  specifications:
    - id: "openapi-spec"
      name: "OpenAPI Specification"
      url: "https://spec.openapis.org/oas/latest.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "sdk-design"
      name: "SDK Design Best Practices"
      url: "https://swagger.io/blog/api-development/what-is-an-api-sdk/"
      offline_cache: true

    - id: "openapi-generator"
      name: "OpenAPI Generator Guide"
      url: "https://openapi-generator.tech/docs/generators/"
      offline_cache: true

  learning_resources:
    - id: "sdk-patterns"
      title: "Building SDKs"
      type: "article"
      reference: "Stripe Developer Blog"

tooling:
  static_analysis:
    - tool: "openapi-generator-cli"
      purpose: "Generate client libraries"
      offline_capable: true

  scripts:
    - id: "sdk-scan"
      language: "bash"
      purpose: "Analyze SDK implementation"
      source: "inline"
      code: |
        echo "=== SDK/Client Library Analysis ==="
        echo "--- SDK generation config ---"
        find . -name "openapitools.json" -o -name ".openapi-generator*" 2>/dev/null | \
          grep -v node_modules | head -10

        echo "--- Client class implementations ---"
        grep -rn "class.*Client\|class.*Api\|ApiClient" \
          --include="*.ts" --include="*.java" --include="*.py" . 2>/dev/null | \
          grep -v node_modules | head -30

        echo "--- Error handling in SDK ---"
        grep -rn "ApiError\|ApiException\|throw\|raise" \
          --include="*.ts" --include="*.java" --include="*.py" . 2>/dev/null | \
          grep -i "client\|sdk" | grep -v node_modules | head -20

signals:
  critical:
    - id: "SDK-CRIT-001"
      signal: "SDK contains hardcoded credentials"
      evidence_pattern: "API keys or secrets in SDK source code"
      explanation: |
        Hardcoded credentials in SDKs expose sensitive data to anyone
        who can access the SDK code. This is a severe security
        vulnerability that could lead to unauthorized access.
      remediation: "Remove all hardcoded credentials; use configuration"

    - id: "SDK-CRIT-002"
      signal: "SDK does not validate SSL certificates"
      evidence_pattern: "SSL verification disabled in HTTP client"
      explanation: |
        Disabling SSL verification exposes users to man-in-the-middle
        attacks. Attackers can intercept API traffic including
        credentials and sensitive data.
      remediation: "Enable SSL certificate verification by default"

  high:
    - id: "SDK-HIGH-001"
      signal: "No SDK available for major languages"
      evidence_pattern: "SDKs missing for JavaScript, Python, or Java"
      explanation: |
        Without SDKs in major languages, developers must make raw HTTP
        calls and handle all complexity themselves. This significantly
        increases integration time and error potential.
      remediation: "Provide SDKs for top 3-5 languages of your users"

    - id: "SDK-HIGH-002"
      signal: "SDK not type-safe"
      evidence_pattern: "Any type or dynamic typing throughout SDK"
      explanation: |
        Without type safety, developers get no compile-time feedback
        about API usage. Errors are only discovered at runtime,
        slowing development and increasing bugs.
      remediation: "Generate type-safe SDKs with proper type definitions"

    - id: "SDK-HIGH-003"
      signal: "SDK lacks error handling"
      evidence_pattern: "Errors thrown as generic exceptions"
      explanation: |
        Without structured error handling, developers cannot properly
        handle different error scenarios. They must parse error
        messages as strings to determine the issue.
      remediation: "Define typed error classes for different error categories"

  medium:
    - id: "SDK-MED-001"
      signal: "SDK version not aligned with API version"
      evidence_pattern: "SDK and API versions out of sync"
      remediation: "Align SDK releases with API releases"

    - id: "SDK-MED-002"
      signal: "No retry logic in SDK"
      evidence_pattern: "Failed requests not automatically retried"
      remediation: "Implement configurable retry with exponential backoff"

    - id: "SDK-MED-003"
      signal: "SDK not published to package managers"
      evidence_pattern: "Manual installation required"
      remediation: "Publish to npm, PyPI, Maven Central, etc."

  low:
    - id: "SDK-LOW-001"
      signal: "SDK documentation incomplete"
      evidence_pattern: "Missing usage examples or API reference"
      remediation: "Add comprehensive SDK documentation"

  positive:
    - id: "SDK-POS-001"
      signal: "Auto-generated type-safe SDKs"
      evidence_pattern: "OpenAPI generator producing strongly-typed clients"

    - id: "SDK-POS-002"
      signal: "SDKs include retry and timeout handling"
      evidence_pattern: "Built-in resilience patterns"

    - id: "SDK-POS-003"
      signal: "SDKs published to package managers"
      evidence_pattern: "Available via npm, PyPI, Maven, etc."

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Available SDKs"
      description: |
        List all SDK/client library implementations.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find SDK packages"
          command: |
            find . -type d -name "sdk" -o -name "client" 2>/dev/null | \
              grep -v node_modules | head -20
        - purpose: "Find generation config"
          command: |
            find . -name "openapitools.json" -o -name ".openapi-generator*" \
              -o -name "swagger-codegen*" 2>/dev/null | \
              grep -v node_modules | head -10

      expected_findings:
        - "Available SDKs"
        - "Generation method"

    - id: "2"
      name: "Evaluate Type Safety"
      description: |
        Check if SDKs provide proper typing.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find type definitions"
          command: |
            grep -rn "interface \|type \|class " \
              --include="*.ts" --include="*.java" . 2>/dev/null | \
              grep -i "sdk\|client\|api" | grep -v node_modules | head -30

      expected_findings:
        - "Type safety level"
        - "Model definitions"

    - id: "3"
      name: "Review Error Handling"
      description: |
        Check how SDK handles errors.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find error classes"
          command: |
            grep -rn "Error\|Exception" \
              --include="*.ts" --include="*.java" --include="*.py" . 2>/dev/null | \
              grep -i "sdk\|client\|api" | grep -v node_modules | head -30

      expected_findings:
        - "Error class structure"
        - "Error handling patterns"

    - id: "4"
      name: "Check Resilience Features"
      description: |
        Verify retry and timeout handling.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find retry logic"
          command: |
            grep -rn "retry\|backoff\|timeout" \
              --include="*.ts" --include="*.java" --include="*.py" . 2>/dev/null | \
              grep -i "sdk\|client" | grep -v node_modules | head -20

      expected_findings:
        - "Retry implementation"
        - "Timeout configuration"

    - id: "5"
      name: "Verify Distribution"
      description: |
        Check SDK publication and versioning.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find package configuration"
          command: |
            find . -name "package.json" -o -name "setup.py" \
              -o -name "pom.xml" -o -name "*.gemspec" 2>/dev/null | \
              xargs grep -l "version" 2>/dev/null | head -20

      expected_findings:
        - "Distribution method"
        - "Version management"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      content:
        - "sdk_inventory"
        - "quality_assessment"
        - "distribution_status"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "SDK Coverage"
        - "Quality Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Clear SDK presence or absence"
    medium: "SDK exists but quality uncertain"
    low: "Requires usage testing to confirm quality"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "openapi-generator"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Developer experience assessment"
    full:
      included: true
      priority: 2
    api:
      included: true
      priority: 1

closeout_checklist:
  - id: "sdk-001"
    item: "SDKs available for major languages"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify SDKs exist for JavaScript, Python, or Java"
    expected: "Confirmed by reviewer"

  - id: "sdk-002"
    item: "No hardcoded credentials in SDK"
    level: "CRITICAL"
    verification: |
      grep -rn "apiKey\|api_key\|secret\|password" \
        --include="*.ts" --include="*.java" --include="*.py" . 2>/dev/null | \
        grep -i "sdk\|client" | grep "=" | grep -v node_modules | \
        grep -v "config\|param\|option" | wc -l | \
        xargs -I {} test {} -lt 3 && echo "PASS" || echo "FAIL"
    expected: "PASS"

  - id: "sdk-003"
    item: "SDKs include type definitions"
    level: "WARNING"
    verification: |
      grep -rn "interface \|type \|class " \
        --include="*.ts" --include="*.java" . 2>/dev/null | \
        grep -i "sdk\|client" | grep -v node_modules | \
        wc -l | xargs -I {} test {} -gt 0 && echo "PASS" || echo "FAIL"
    expected: "PASS"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "ISO 25010"
      controls: ["Usability", "Maintainability"]

relationships:
  commonly_combined:
    - "api-integration.api-documentation.documentation-completeness"
    - "api-integration.api-documentation.getting-started-guide"
    - "api-integration.api-documentation.changelog-maintenance"
