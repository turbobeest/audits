# ============================================================
# AUDIT: Error Budget
# Category: 42 - Quantum Computing
# Subcategory: error-handling
# ============================================================

audit:
  id: "quantum-computing.error-handling.error-budget"
  name: "Quantum Error Budget Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "error-handling"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "quantum-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Analyzes the error budget for quantum algorithms including contributions
    from gate errors, decoherence, measurement errors, and SPAM errors.
    Determines whether total error is within acceptable limits for the
    application and identifies dominant error sources.

  why_it_matters: |
    Understanding error composition is essential for optimization. Without
    an error budget, improvement efforts may target wrong error sources.
    An error budget predicts whether results will be meaningful and guides
    resource allocation for error reduction.

  when_to_run:
    - "During algorithm development"
    - "Before hardware deployment"
    - "When optimizing for fidelity"
    - "When results have unexpected errors"

prerequisites:
  required_artifacts:
    - type: "quantum_circuits"
      description: "Circuits to analyze"
    - type: "error_data"
      description: "Error rates for all operations"
    - type: "fidelity_requirements"
      description: "Target fidelity for application"

  access_requirements:
    - "Access to circuit code"
    - "Hardware error characterization"
    - "Application requirements"

discovery:
  file_patterns:
    - glob: "**/circuits/**/*.py"
      purpose: "Find circuit definitions"
    - glob: "**/calibration/**/*.json"
      purpose: "Find error rates"

  metrics_queries:
    - system: "hardware"
      query: "gate_errors, readout_errors, T1, T2"
      purpose: "Gather error components"

knowledge_sources:
  specifications:
    - id: "error-budgeting"
      name: "Quantum Error Budgeting"
      url: "https://arxiv.org/abs/2003.04879"
      offline_cache: true
      priority: "required"

  guides:
    - id: "qiskit-benchmarking"
      name: "Qiskit Benchmarking"
      url: "https://qiskit.org/documentation/tutorials/noise/5_randomized_benchmarking.html"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "error-budget-calculator"
      purpose: "Compute error contributions"

    - tool: "randomized-benchmarking"
      purpose: "Characterize error rates"

signals:
  critical:
    - id: "EB-CRIT-001"
      signal: "Total error exceeds application tolerance"
      evidence_threshold: "cumulative_error > tolerance"
      explanation: |
        When total error exceeds what the application can tolerate,
        results are unreliable. The algorithm cannot achieve its purpose.
      remediation: |
        Identify dominant error sources.
        Apply targeted mitigation.
        Consider error correction.
        Accept degraded accuracy.

    - id: "EB-CRIT-002"
      signal: "Error budget not defined"
      evidence_indicators:
        - "No target fidelity specified"
        - "Error tolerance unknown"
        - "No error tracking"
      explanation: |
        Without an error budget, there is no way to know if results
        are trustworthy. Error management cannot proceed systematically.
      remediation: "Define error budget based on application requirements"

  high:
    - id: "EB-HIGH-001"
      signal: "Single error source dominates"
      evidence_indicators:
        - "One error type > 80% of total"
        - "Other optimizations ineffective"
      remediation: "Focus mitigation on dominant source"

    - id: "EB-HIGH-002"
      signal: "SPAM errors not accounted"
      evidence_indicators:
        - "State prep/measurement errors not in budget"
        - "SPAM errors significant but ignored"
      remediation: "Include SPAM in error budget"

  medium:
    - id: "EB-MED-001"
      signal: "Error budget not updated with calibration"
      remediation: "Recalculate budget after calibration"

    - id: "EB-MED-002"
      signal: "Crosstalk not in budget"
      remediation: "Include crosstalk error estimates"

  low:
    - id: "EB-LOW-001"
      signal: "Error budget not documented"
      remediation: "Document error budget breakdown"

  positive:
    - id: "EB-POS-001"
      signal: "Error budget within tolerance"
    - id: "EB-POS-002"
      signal: "Comprehensive error accounting"
    - id: "EB-POS-003"
      signal: "Error tracking over time"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Define Tolerance"
      description: "Determine acceptable error for application"
      duration_estimate: "30 min"

    - id: "2"
      name: "Enumerate Error Sources"
      description: "List all error contributions"
      duration_estimate: "45 min"

    - id: "3"
      name: "Quantify Each Source"
      description: "Calculate error contribution from each source"
      duration_estimate: "1.5 hours"

    - id: "4"
      name: "Sum Error Budget"
      description: "Compute total expected error"
      duration_estimate: "30 min"

    - id: "5"
      name: "Compare to Tolerance"
      description: "Check if budget meets requirements"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "error_budget"
      format: "json"
      description: "Detailed error breakdown"

closeout_checklist:
  - id: "eb-001"
    item: "Total error within tolerance"
    level: "CRITICAL"
    verification: "automated"

  - id: "eb-002"
    item: "All major error sources included"
    level: "BLOCKING"
    verification: "manual"

  - id: "eb-003"
    item: "Dominant error sources identified"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["quantum-systems"]

relationships:
  commonly_combined:
    - "quantum-computing.error-handling.noise-model-accuracy"
    - "quantum-computing.error-handling.error-mitigation-strategy"
  depends_on:
    - "quantum-computing.quantum-algorithm.algorithm-correctness"
  feeds_into:
    - "quantum-computing.resource-estimation.execution-time-estimate"
