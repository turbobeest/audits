# ============================================================
# AUDIT: Test Coverage
# Category: 42 - Quantum Computing
# Subcategory: simulation-testing
# ============================================================

audit:
  id: "quantum-computing.simulation-testing.test-coverage"
  name: "Quantum Test Coverage Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "simulation-testing"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "quantum-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the test coverage for quantum algorithms and circuits including
    unit tests, integration tests, edge cases, and statistical validation.
    Assesses whether testing adequately verifies correctness and identifies
    gaps in coverage.

  why_it_matters: |
    Quantum software is complex and bugs are subtle. Without comprehensive
    testing, errors go undetected until hardware execution where debugging
    is difficult. Good test coverage enables confident development and
    deployment.

  when_to_run:
    - "During code review"
    - "Before deployment"
    - "When assessing code quality"
    - "After adding new features"

prerequisites:
  required_artifacts:
    - type: "test_suite"
      description: "Existing test code"
    - type: "quantum_code"
      description: "Code under test"
    - type: "coverage_reports"
      description: "Coverage metrics"

  access_requirements:
    - "Access to test code"
    - "Ability to run tests"
    - "Coverage tools"

discovery:
  file_patterns:
    - glob: "**/tests/**/*.py"
      purpose: "Find test files"
    - glob: "**/test_*.py"
      purpose: "Find test modules"

  code_patterns:
    - pattern: "pytest|unittest|test_"
      type: "keyword"
      scope: "source"
      purpose: "Find test code"
    - pattern: "assert|assertEqual"
      type: "keyword"
      scope: "source"
      purpose: "Find assertions"

knowledge_sources:
  guides:
    - id: "quantum-testing"
      name: "Testing Quantum Software"
      url: "https://arxiv.org/abs/2003.10401"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "pytest"
      purpose: "Test execution"

    - tool: "coverage"
      purpose: "Coverage measurement"

signals:
  critical:
    - id: "TC-CRIT-001"
      signal: "No tests exist"
      evidence_indicators:
        - "No test files found"
        - "No test framework"
        - "Zero coverage"
      explanation: |
        Untested quantum code cannot be trusted. Without tests,
        bugs are discovered in production at high cost.
      remediation: "Create comprehensive test suite"

    - id: "TC-CRIT-002"
      signal: "Critical paths untested"
      evidence_indicators:
        - "Core algorithms not tested"
        - "Error handling not tested"
        - "Major branches uncovered"
      explanation: |
        Untested critical paths are high-risk areas where bugs
        will cause failures.
      remediation: "Add tests for critical paths"

  high:
    - id: "TC-HIGH-001"
      signal: "Low test coverage"
      evidence_threshold: "coverage < 50%"
      remediation: "Increase test coverage"

    - id: "TC-HIGH-002"
      signal: "No statistical validation tests"
      evidence_indicators:
        - "Probabilistic outputs not statistically tested"
        - "Single-shot assertions on quantum results"
      remediation: "Add statistical validation tests"

  medium:
    - id: "TC-MED-001"
      signal: "Edge cases not tested"
      remediation: "Add edge case tests"

    - id: "TC-MED-002"
      signal: "No integration tests"
      remediation: "Add integration tests"

  low:
    - id: "TC-LOW-001"
      signal: "Test documentation missing"
      remediation: "Document test strategy"

  positive:
    - id: "TC-POS-001"
      signal: "High test coverage"
    - id: "TC-POS-002"
      signal: "Statistical tests for quantum outputs"
    - id: "TC-POS-003"
      signal: "Comprehensive edge case coverage"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Existing Tests"
      description: "Document existing test coverage"
      duration_estimate: "45 min"

    - id: "2"
      name: "Measure Coverage"
      description: "Run coverage analysis"
      duration_estimate: "30 min"

    - id: "3"
      name: "Identify Gaps"
      description: "Find untested critical paths"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Assess Test Quality"
      description: "Evaluate test effectiveness"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Check Statistical Testing"
      description: "Verify quantum-appropriate testing"
      duration_estimate: "45 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "coverage_report"
      format: "json"
      description: "Test coverage analysis"

closeout_checklist:
  - id: "tc-001"
    item: "Tests exist"
    level: "CRITICAL"
    verification: "automated"

  - id: "tc-002"
    item: "Coverage > 70%"
    level: "BLOCKING"
    verification: "automated"

  - id: "tc-003"
    item: "Statistical tests present"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["quantum-systems"]

relationships:
  commonly_combined:
    - "quantum-computing.simulation-testing.simulator-accuracy"
    - "quantum-computing.quantum-algorithm.algorithm-correctness"
