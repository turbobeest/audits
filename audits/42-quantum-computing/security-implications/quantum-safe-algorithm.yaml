# ============================================================
# AUDIT: Quantum-Safe Algorithm
# Category: 42 - Quantum Computing
# Subcategory: security-implications
# ============================================================

audit:
  id: "quantum-computing.security-implications.quantum-safe-algorithm"
  name: "Quantum-Safe Algorithm Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "security-implications"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the implementation of quantum-safe (post-quantum) cryptographic
    algorithms. Assesses correct implementation of NIST-approved algorithms
    (ML-KEM, ML-DSA, SLH-DSA), parameter selection, performance characteristics,
    and integration correctness.

  why_it_matters: |
    Incorrectly implemented PQC provides false security. These new algorithms
    have different characteristics than classical crypto and require careful
    implementation. Side-channel vulnerabilities, parameter mistakes, and
    integration errors can defeat the quantum resistance.

  when_to_run:
    - "When implementing PQC"
    - "After PQC library updates"
    - "During security reviews"
    - "Before production deployment"

prerequisites:
  required_artifacts:
    - type: "pqc_implementation"
      description: "PQC algorithm implementations"
    - type: "integration_code"
      description: "Code using PQC algorithms"
    - type: "parameter_config"
      description: "Algorithm parameter selection"

  access_requirements:
    - "Access to cryptographic code"
    - "Algorithm configuration"
    - "Integration points"

discovery:
  file_patterns:
    - glob: "**/crypto/**/*.py"
      purpose: "Find crypto implementations"
    - glob: "**/pqc/**/*.py"
      purpose: "Find PQC code"

  code_patterns:
    - pattern: "Kyber|MLKEM|mlkem"
      type: "keyword"
      scope: "source"
      purpose: "Find ML-KEM usage"
    - pattern: "Dilithium|MLDSA|mldsa"
      type: "keyword"
      scope: "source"
      purpose: "Find ML-DSA usage"
    - pattern: "SPHINCS|SLHDSA|slhdsa"
      type: "keyword"
      scope: "source"
      purpose: "Find SLH-DSA usage"

knowledge_sources:
  specifications:
    - id: "fips-203"
      name: "FIPS 203 (ML-KEM)"
      url: "https://csrc.nist.gov/pubs/fips/203/final"
      offline_cache: true
      priority: "required"

    - id: "fips-204"
      name: "FIPS 204 (ML-DSA)"
      url: "https://csrc.nist.gov/pubs/fips/204/final"
      offline_cache: true
      priority: "required"

    - id: "fips-205"
      name: "FIPS 205 (SLH-DSA)"
      url: "https://csrc.nist.gov/pubs/fips/205/final"
      offline_cache: true
      priority: "required"

  guides:
    - id: "pqc-implementation"
      name: "PQC Implementation Guidance"
      url: "https://csrc.nist.gov/projects/post-quantum-cryptography"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "liboqs"
      purpose: "Open Quantum Safe library"

    - tool: "pqcrypto"
      purpose: "PQC implementations"

signals:
  critical:
    - id: "QSA-CRIT-001"
      signal: "Using non-NIST-approved PQC algorithm"
      evidence_indicators:
        - "SIKE or other broken algorithms"
        - "Non-standardized algorithms in production"
      explanation: |
        Only NIST-approved algorithms have undergone sufficient review.
        Other algorithms may have undiscovered vulnerabilities.
      remediation: "Migrate to NIST-approved ML-KEM, ML-DSA, or SLH-DSA"

    - id: "QSA-CRIT-002"
      signal: "Incorrect PQC implementation"
      evidence_indicators:
        - "Failed test vectors"
        - "Non-conformant to specification"
        - "Side-channel vulnerabilities"
      explanation: |
        Incorrect implementation defeats the purpose of PQC.
        Must verify against official test vectors and specifications.
      remediation: "Fix implementation to match specification"

  high:
    - id: "QSA-HIGH-001"
      signal: "Weak parameter selection"
      evidence_indicators:
        - "Using lowest security level without justification"
        - "Parameters not matching security requirements"
      remediation: "Select parameters matching security requirements"

    - id: "QSA-HIGH-002"
      signal: "Using unvetted PQC library"
      evidence_indicators:
        - "Library not audited"
        - "Unfamiliar or unmaintained library"
      remediation: "Use well-vetted implementations like liboqs"

  medium:
    - id: "QSA-MED-001"
      signal: "Performance not optimized"
      remediation: "Use optimized implementations for production"

    - id: "QSA-MED-002"
      signal: "Hybrid mode not considered"
      remediation: "Consider hybrid classical-PQC for defense in depth"

  low:
    - id: "QSA-LOW-001"
      signal: "PQC selection rationale not documented"
      remediation: "Document algorithm selection reasoning"

  positive:
    - id: "QSA-POS-001"
      signal: "NIST-approved algorithms used"
    - id: "QSA-POS-002"
      signal: "Implementation verified against test vectors"
    - id: "QSA-POS-003"
      signal: "Appropriate parameter selection"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify PQC Usage"
      description: "Find all PQC algorithm usage"
      duration_estimate: "45 min"

    - id: "2"
      name: "Verify Algorithm Selection"
      description: "Check algorithms are NIST-approved"
      duration_estimate: "30 min"

    - id: "3"
      name: "Check Implementation"
      description: "Verify implementation correctness"
      duration_estimate: "1.5 hours"

    - id: "4"
      name: "Review Parameters"
      description: "Assess parameter selection"
      duration_estimate: "30 min"

    - id: "5"
      name: "Test Integration"
      description: "Verify correct integration"
      duration_estimate: "45 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "pqc_assessment"
      format: "json"
      description: "PQC implementation assessment"

closeout_checklist:
  - id: "qsa-001"
    item: "NIST-approved algorithms used"
    level: "CRITICAL"
    verification: "manual"

  - id: "qsa-002"
    item: "Implementation verified"
    level: "CRITICAL"
    verification: "automated"

  - id: "qsa-003"
    item: "Parameters appropriate"
    level: "BLOCKING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "NIST SP 800-208"
      controls: ["PQC Implementation"]
    - framework: "FIPS 140-3"
      controls: ["Cryptographic Module"]

relationships:
  commonly_combined:
    - "quantum-computing.security-implications.post-quantum-cryptography-readiness"
    - "quantum-computing.security-implications.cryptographic-agility"
  depends_on:
    - "security-trust.cryptography.implementation-correctness"
