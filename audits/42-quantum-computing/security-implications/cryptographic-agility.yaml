# ============================================================
# AUDIT: Cryptographic Agility
# Category: 42 - Quantum Computing
# Subcategory: security-implications
# ============================================================

audit:
  id: "quantum-computing.security-implications.cryptographic-agility"
  name: "Cryptographic Agility Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "security-implications"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the ability to swap cryptographic algorithms without significant
    code changes. Assesses abstraction layers, configuration flexibility,
    algorithm negotiation, and the ability to respond quickly to cryptographic
    vulnerabilities or new requirements.

  why_it_matters: |
    Cryptographic algorithms become obsolete due to attacks or quantum computing.
    Systems without cryptographic agility require costly rewrites. Agile systems
    can respond quickly to threats and adopt new standards with minimal effort.
    This is essential for the PQC transition.

  when_to_run:
    - "During architecture review"
    - "When planning PQC migration"
    - "During security assessments"
    - "When designing new systems"

prerequisites:
  required_artifacts:
    - type: "cryptographic_code"
      description: "Cryptographic implementations"
    - type: "architecture_docs"
      description: "System architecture documentation"
    - type: "configuration_system"
      description: "Algorithm configuration mechanism"

  access_requirements:
    - "Access to cryptographic code"
    - "Architecture documentation"
    - "Configuration systems"

discovery:
  file_patterns:
    - glob: "**/crypto/**/*.py"
      purpose: "Find crypto code"
    - glob: "**/security/**/*.py"
      purpose: "Find security code"
    - glob: "**/config/**/*.yaml"
      purpose: "Find configuration"

  code_patterns:
    - pattern: "cipher_suite|algorithm_config"
      type: "keyword"
      scope: "source"
      purpose: "Find algorithm configuration"
    - pattern: "CryptoProvider|CipherFactory"
      type: "keyword"
      scope: "source"
      purpose: "Find abstraction layers"

knowledge_sources:
  guides:
    - id: "crypto-agility"
      name: "Cryptographic Agility Best Practices"
      url: "https://csrc.nist.gov/projects/crypto-agility"
      offline_cache: true
      priority: "required"

    - id: "tls-agility"
      name: "TLS Cryptographic Agility"
      url: "https://datatracker.ietf.org/doc/html/rfc8446"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "code-analysis"
      purpose: "Analyze cryptographic abstraction"

signals:
  critical:
    - id: "CA-CRIT-001"
      signal: "Cryptographic algorithms hard-coded"
      evidence_indicators:
        - "Algorithm names in source code"
        - "No configuration mechanism"
        - "Requires code changes to swap algorithms"
      explanation: |
        Hard-coded algorithms require code changes and redeployment to
        respond to vulnerabilities. This is too slow for security response.
      remediation: |
        Implement cryptographic abstraction layer.
        Make algorithms configurable.
        Use algorithm negotiation protocols.

    - id: "CA-CRIT-002"
      signal: "No abstraction layer exists"
      evidence_indicators:
        - "Direct library calls throughout codebase"
        - "Algorithm-specific code spread everywhere"
      explanation: |
        Without abstraction, algorithm changes require touching every
        usage site, making migration extremely costly.
      remediation: "Implement centralized cryptographic abstraction"

  high:
    - id: "CA-HIGH-001"
      signal: "Configuration changes require restart"
      evidence_indicators:
        - "No runtime algorithm switching"
        - "Downtime required for changes"
      remediation: "Implement runtime algorithm configuration"

    - id: "CA-HIGH-002"
      signal: "No algorithm negotiation in protocols"
      evidence_indicators:
        - "Fixed algorithms in protocol implementation"
        - "No version negotiation"
      remediation: "Implement algorithm negotiation"

  medium:
    - id: "CA-MED-001"
      signal: "Limited algorithm support"
      remediation: "Extend abstraction to support more algorithms"

    - id: "CA-MED-002"
      signal: "Key formats not agile"
      remediation: "Support multiple key formats"

  low:
    - id: "CA-LOW-001"
      signal: "Agility not tested"
      remediation: "Test algorithm swapping procedure"

  positive:
    - id: "CA-POS-001"
      signal: "Clean cryptographic abstraction"
    - id: "CA-POS-002"
      signal: "Runtime algorithm configuration"
    - id: "CA-POS-003"
      signal: "Algorithm negotiation implemented"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Map Cryptographic Usage"
      description: "Find all crypto usage points"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Assess Abstraction"
      description: "Evaluate cryptographic abstraction"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Check Configuration"
      description: "Review algorithm configuration mechanism"
      duration_estimate: "45 min"

    - id: "4"
      name: "Test Agility"
      description: "Attempt algorithm swap"
      duration_estimate: "1.5 hours"

    - id: "5"
      name: "Review Protocol Negotiation"
      description: "Check protocol-level agility"
      duration_estimate: "45 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "agility_assessment"
      format: "json"
      description: "Cryptographic agility assessment"

closeout_checklist:
  - id: "ca-001"
    item: "Abstraction layer exists"
    level: "CRITICAL"
    verification: "manual"

  - id: "ca-002"
    item: "Algorithm change tested"
    level: "BLOCKING"
    verification: "manual"

  - id: "ca-003"
    item: "Configuration mechanism documented"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "NIST SP 800-208"
      controls: ["Crypto Agility"]
    - framework: "SOC 2"
      controls: ["CC6.1"]

relationships:
  commonly_combined:
    - "quantum-computing.security-implications.post-quantum-cryptography-readiness"
    - "quantum-computing.security-implications.quantum-safe-algorithm"
  feeds_into:
    - "security-trust.cryptography.algorithm-selection"
