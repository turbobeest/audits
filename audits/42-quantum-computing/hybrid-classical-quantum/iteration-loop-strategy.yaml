# ============================================================
# AUDIT: Iteration/Loop Strategy
# Category: 42 - Quantum Computing
# Subcategory: hybrid-classical-quantum
# ============================================================

audit:
  id: "quantum-computing.hybrid-classical-quantum.iteration-loop-strategy"
  name: "Quantum-Classical Iteration Strategy Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "hybrid-classical-quantum"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "quantum-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the iteration strategy in variational quantum algorithms and
    other hybrid loops. Assesses how classical and quantum components interact
    over multiple iterations, including parameter updates, convergence criteria,
    and resource management across iterations.

  why_it_matters: |
    Variational algorithms like VQE and QAOA depend on effective classical-quantum
    iteration. Poor iteration strategy leads to slow convergence, wasted quantum
    resources, or convergence to suboptimal solutions. The iteration loop is
    critical for practical quantum advantage.

  when_to_run:
    - "When developing variational algorithms"
    - "When debugging convergence issues"
    - "When optimizing resource usage"
    - "During algorithm benchmarking"

prerequisites:
  required_artifacts:
    - type: "variational_code"
      description: "Variational algorithm implementation"
    - type: "optimizer_config"
      description: "Classical optimizer configuration"
    - type: "convergence_criteria"
      description: "Stopping criteria definition"

  access_requirements:
    - "Access to algorithm code"
    - "Iteration history access"

discovery:
  file_patterns:
    - glob: "**/variational/**/*.py"
      purpose: "Find variational algorithm code"
    - glob: "**/optimizer/**/*.py"
      purpose: "Find optimizer implementations"

  code_patterns:
    - pattern: "VQE|QAOA|variational"
      type: "keyword"
      scope: "source"
      purpose: "Find variational algorithms"
    - pattern: "optimize|minimize|COBYLA|SPSA"
      type: "keyword"
      scope: "source"
      purpose: "Find optimizers"

knowledge_sources:
  specifications:
    - id: "vqe-paper"
      name: "VQE Original Paper"
      url: "https://arxiv.org/abs/1304.3061"
      offline_cache: true
      priority: "required"

  guides:
    - id: "qiskit-vqe"
      name: "Qiskit VQE Tutorial"
      url: "https://qiskit.org/documentation/tutorials/algorithms/index.html"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "qiskit-algorithms"
      purpose: "Variational algorithm framework"

    - tool: "scipy-optimize"
      purpose: "Classical optimizers"

signals:
  critical:
    - id: "ILS-CRIT-001"
      signal: "No convergence criteria defined"
      evidence_indicators:
        - "Fixed iteration count only"
        - "No early stopping"
        - "No convergence monitoring"
      explanation: |
        Without convergence criteria, algorithms may run forever,
        stop too early, or waste resources after converging.
      remediation: "Define proper convergence criteria with multiple checks"

    - id: "ILS-CRIT-002"
      signal: "Iteration not saving state"
      evidence_indicators:
        - "No checkpointing"
        - "Progress lost on failure"
        - "Cannot resume iteration"
      explanation: |
        Variational algorithms can require many iterations. Without
        state saving, failures waste all previous computation.
      remediation: "Implement iteration checkpointing"

  high:
    - id: "ILS-HIGH-001"
      signal: "Optimizer poorly suited for noisy landscape"
      evidence_indicators:
        - "Gradient-based optimizer with shot noise"
        - "Optimizer assumes smooth landscape"
      remediation: "Use noise-robust optimizer like SPSA or COBYLA"

    - id: "ILS-HIGH-002"
      signal: "Shot count not adapted across iterations"
      evidence_indicators:
        - "Fixed shots regardless of precision needs"
        - "No adaptive sampling"
      remediation: "Implement adaptive shot allocation"

  medium:
    - id: "ILS-MED-001"
      signal: "No iteration history recorded"
      remediation: "Log iteration metrics for analysis"

    - id: "ILS-MED-002"
      signal: "Inefficient parameter updates"
      remediation: "Optimize parameter update strategy"

  low:
    - id: "ILS-LOW-001"
      signal: "Iteration strategy not documented"
      remediation: "Document iteration approach"

  positive:
    - id: "ILS-POS-001"
      signal: "Robust convergence criteria"
    - id: "ILS-POS-002"
      signal: "Noise-aware optimizer used"
    - id: "ILS-POS-003"
      signal: "Efficient resource management"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Loop Structure"
      description: "Examine iteration loop implementation"
      duration_estimate: "45 min"

    - id: "2"
      name: "Assess Convergence Criteria"
      description: "Evaluate stopping conditions"
      duration_estimate: "45 min"

    - id: "3"
      name: "Analyze Optimizer Choice"
      description: "Check optimizer suitability"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Check State Management"
      description: "Verify checkpointing and recovery"
      duration_estimate: "45 min"

    - id: "5"
      name: "Review Resource Management"
      description: "Assess shot allocation strategy"
      duration_estimate: "45 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "iteration_analysis"
      format: "json"
      description: "Iteration strategy assessment"

closeout_checklist:
  - id: "ils-001"
    item: "Convergence criteria defined"
    level: "CRITICAL"
    verification: "manual"

  - id: "ils-002"
    item: "Checkpointing implemented"
    level: "BLOCKING"
    verification: "automated"

  - id: "ils-003"
    item: "Optimizer appropriate"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["quantum-systems", "variational-algorithms"]

relationships:
  commonly_combined:
    - "quantum-computing.hybrid-classical-quantum.optimization-convergence"
    - "quantum-computing.hybrid-classical-quantum.classical-quantum-interface"
  feeds_into:
    - "quantum-computing.resource-estimation.execution-time-estimate"
