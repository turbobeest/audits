# ============================================================
# AUDIT: Algorithm Correctness
# Category: 42 - Quantum Computing
# Subcategory: quantum-algorithm
# ============================================================

audit:
  id: "quantum-computing.quantum-algorithm.algorithm-correctness"
  name: "Quantum Algorithm Correctness Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "quantum-algorithm"

  tier: "phd"
  estimated_duration: "6-10 hours"  # median: 8h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "quantum-systems"

  default_profiles:
    - "full"

  blocks_phase: true
  parallelizable: false

description:
  what: |
    Verifies the mathematical correctness and logical validity of quantum algorithms
    including unitary operations, measurement bases, quantum state preparation,
    and expected probability distributions. Examines whether algorithms correctly
    implement intended quantum operations and produce theoretically expected results.

  why_it_matters: |
    Incorrect quantum algorithms produce meaningless results that may appear valid.
    Unlike classical bugs that often cause crashes, quantum algorithm errors result
    in subtly wrong probability distributions that waste expensive quantum resources
    and lead to incorrect conclusions. Verification is essential before deploying
    on actual quantum hardware.

  when_to_run:
    - "Before executing on real quantum hardware"
    - "After algorithm modifications"
    - "When results deviate from theoretical expectations"
    - "During quantum software development reviews"

prerequisites:
  required_artifacts:
    - type: "quantum_circuits"
      description: "Circuit definitions in Qiskit, Cirq, or equivalent"
    - type: "algorithm_specification"
      description: "Mathematical specification of intended algorithm"
    - type: "expected_outputs"
      description: "Theoretical expected probability distributions"

  access_requirements:
    - "Access to quantum circuit code"
    - "Access to quantum simulator"
    - "Mathematical specification documents"

discovery:
  file_patterns:
    - glob: "**/*.qasm"
      purpose: "Find OpenQASM circuit files"
    - glob: "**/circuits/**/*.py"
      purpose: "Find Qiskit/Cirq circuit definitions"
    - glob: "**/quantum/**/*.py"
      purpose: "Find quantum algorithm implementations"

  code_patterns:
    - pattern: "QuantumCircuit|Circuit|Program"
      type: "keyword"
      scope: "source"
      purpose: "Identify quantum circuit definitions"
    - pattern: "unitary|gate|measure"
      type: "keyword"
      scope: "source"
      purpose: "Find quantum operations"

knowledge_sources:
  specifications:
    - id: "qiskit-textbook"
      name: "Qiskit Textbook"
      url: "https://qiskit.org/textbook/"
      offline_cache: true
      priority: "required"

    - id: "nielsen-chuang"
      name: "Quantum Computation and Quantum Information"
      url: "https://www.cambridge.org/highereducation/books/quantum-computation-and-quantum-information/01E10196D0A682A6AEFFEA52D53BE9AE"
      offline_cache: false
      priority: "required"

  guides:
    - id: "ibm-quantum-docs"
      name: "IBM Quantum Documentation"
      url: "https://quantum-computing.ibm.com/docs/"
      offline_cache: true

    - id: "cirq-docs"
      name: "Google Cirq Documentation"
      url: "https://quantumai.google/cirq"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "qiskit"
      purpose: "Circuit simulation and verification"
      install: "pip install qiskit"

    - tool: "cirq"
      purpose: "Google quantum circuit framework"
      install: "pip install cirq"

    - tool: "pennylane"
      purpose: "Quantum ML and simulation"
      install: "pip install pennylane"

  verification_tools:
    - tool: "qiskit-aer"
      purpose: "Statevector simulation for exact verification"
      install: "pip install qiskit-aer"

    - tool: "mitiq"
      purpose: "Quantum error mitigation verification"
      install: "pip install mitiq"

signals:
  critical:
    - id: "QAC-CRIT-001"
      signal: "Algorithm produces incorrect probability distribution"
      evidence_indicators:
        - "Output probabilities deviate significantly from theoretical values"
        - "Measurement results fail chi-squared test against expected distribution"
        - "Statevector simulation shows incorrect final state"
      explanation: |
        Incorrect probability distributions indicate fundamental algorithm errors.
        These may stem from wrong gate sequences, incorrect angles, or flawed
        circuit construction. Results cannot be trusted for any downstream use.
      remediation: |
        Compare statevector simulation against theoretical derivation.
        Verify each gate operation mathematically.
        Use circuit decomposition to check unitary matrices.

    - id: "QAC-CRIT-002"
      signal: "Non-unitary operations in quantum circuit"
      evidence_indicators:
        - "Gate matrices are not unitary (U*U != I)"
        - "Trace of density matrix changes unexpectedly"
        - "Probability normalization violated"
      explanation: |
        Quantum operations must be unitary (except measurements). Non-unitary
        operations indicate implementation bugs or incorrect gate definitions.
      remediation: |
        Verify all custom gates have unitary matrices.
        Check gate decompositions maintain unitarity.
        Use built-in verified gates where possible.

  high:
    - id: "QAC-HIGH-001"
      signal: "Incorrect measurement basis"
      evidence_indicators:
        - "Measuring in computational basis when algorithm requires different basis"
        - "Missing basis rotation before measurement"
      remediation: "Add appropriate basis transformation gates before measurement"

    - id: "QAC-HIGH-002"
      signal: "State preparation errors"
      evidence_indicators:
        - "Initial state not properly initialized"
        - "Ancilla qubits in wrong initial state"
      remediation: "Verify state preparation circuit produces correct initial state"

    - id: "QAC-HIGH-003"
      signal: "Phase errors in algorithm"
      evidence_indicators:
        - "Global or relative phases incorrect"
        - "Phase kickback not properly implemented"
      remediation: "Trace phase evolution through circuit and verify against theory"

  medium:
    - id: "QAC-MED-001"
      signal: "Inefficient gate decomposition"
      remediation: "Optimize gate sequences using circuit optimization passes"

    - id: "QAC-MED-002"
      signal: "Unnecessary auxiliary qubits"
      remediation: "Review algorithm for qubit optimization opportunities"

    - id: "QAC-MED-003"
      signal: "Missing algorithm documentation"
      remediation: "Document mathematical basis and expected behavior"

  low:
    - id: "QAC-LOW-001"
      signal: "Inconsistent naming conventions"
      remediation: "Standardize qubit and gate naming"

    - id: "QAC-LOW-002"
      signal: "Missing circuit visualization"
      remediation: "Add circuit diagrams for documentation"

  positive:
    - id: "QAC-POS-001"
      signal: "Algorithm matches theoretical specification exactly"
    - id: "QAC-POS-002"
      signal: "Comprehensive test suite with statistical validation"
    - id: "QAC-POS-003"
      signal: "Clear mathematical documentation"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Algorithm Specification"
      description: "Study mathematical specification and expected behavior"
      duration_estimate: "1 hour"
      questions:
        - "What is the theoretical basis for this algorithm?"
        - "What probability distribution should it produce?"
        - "What are the edge cases?"

    - id: "2"
      name: "Verify Gate Operations"
      description: "Check each gate operation for mathematical correctness"
      duration_estimate: "2 hours"
      commands:
        - purpose: "Extract and verify gate unitaries"
          command: "python -c 'from qiskit import QuantumCircuit; qc = QuantumCircuit.from_qasm_file(\"circuit.qasm\"); print(qc.to_gate().to_matrix())'"

    - id: "3"
      name: "Statevector Simulation"
      description: "Run exact simulation and compare to theory"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Statistical Validation"
      description: "Run many shots and perform statistical tests"
      duration_estimate: "1.5 hours"

    - id: "5"
      name: "Edge Case Testing"
      description: "Test algorithm with boundary inputs"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Algorithm Correctness Analysis"
        - "Statistical Validation Results"
        - "Recommendations"

  confidence_guidance:
    high: "Statevector matches theory exactly, statistical tests pass"
    medium: "Minor deviations within noise tolerance"
    low: "Limited testing or unclear specifications"

offline:
  capability: "partial"
  cache_manifest:
    knowledge:
      - source_id: "qiskit-textbook"
        priority: "required"

closeout_checklist:
  - id: "qac-001"
    item: "Statevector simulation matches theoretical expectation"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Compare final statevector against derived expected state"

  - id: "qac-002"
    item: "Statistical tests pass (chi-squared, KL divergence)"
    level: "CRITICAL"
    verification: "automated"

  - id: "qac-003"
    item: "All gates verified as unitary"
    level: "BLOCKING"
    verification: "automated"

  - id: "qac-004"
    item: "Edge cases tested"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["quantum-systems", "research-systems", "optimization-systems"]

  compliance_mappings:
    - framework: "IEEE P7130"
      control: "Quantum Algorithm Verification"
      description: "Standards for quantum computing"

relationships:
  commonly_combined:
    - "quantum-computing.quantum-algorithm.circuit-depth"
    - "quantum-computing.simulation-testing.simulator-accuracy"
  depends_on:
    - "quantum-computing.quantum-algorithm.qubit-count-efficiency"
  feeds_into:
    - "quantum-computing.error-handling.error-correction-code"

# Glossary of domain-specific terms:
glossary:
  "stabilizer": "A group of Pauli operators that defines the code space for quantum error correction"
  "syndrome": "Measurement outcomes indicating which errors have occurred"
  "logical qubit": "An encoded qubit protected by error correction codes"
  "WCET": "Worst-Case Execution Time - maximum time a task could take to complete"
