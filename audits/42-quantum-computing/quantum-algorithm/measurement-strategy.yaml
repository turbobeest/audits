# ============================================================
# AUDIT: Measurement Strategy
# Category: 42 - Quantum Computing
# Subcategory: quantum-algorithm
# ============================================================

audit:
  id: "quantum-computing.quantum-algorithm.measurement-strategy"
  name: "Quantum Measurement Strategy Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "quantum-algorithm"

  tier: "expert"
  estimated_duration: "2-4 hours"  # median: 3h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "quantum-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the measurement strategy in quantum algorithms including
    measurement bases, shot count determination, mid-circuit measurements,
    and post-measurement classical processing. Verifies that measurements
    extract maximum information while minimizing overhead.

  why_it_matters: |
    Measurement is the interface between quantum and classical computation.
    Poor measurement strategies waste quantum resources, require excessive
    shots, or fail to extract available information. Optimal measurement
    is critical for algorithm efficiency and accuracy.

  when_to_run:
    - "During algorithm development"
    - "When optimizing shot counts"
    - "When implementing variational algorithms"
    - "Before production deployment"

prerequisites:
  required_artifacts:
    - type: "quantum_circuits"
      description: "Circuits with measurement operations"
    - type: "algorithm_goals"
      description: "What information needs to be extracted"

  access_requirements:
    - "Access to circuit code"
    - "Algorithm specification"

discovery:
  file_patterns:
    - glob: "**/circuits/**/*.py"
      purpose: "Find circuit definitions"
    - glob: "**/*.qasm"
      purpose: "Find QASM files"

  code_patterns:
    - pattern: "measure|Measurement"
      type: "keyword"
      scope: "source"
      purpose: "Find measurement operations"
    - pattern: "shots|samples"
      type: "keyword"
      scope: "source"
      purpose: "Find shot count configuration"

knowledge_sources:
  specifications:
    - id: "quantum-measurement-theory"
      name: "Quantum Measurement Theory"
      url: "https://en.wikipedia.org/wiki/Measurement_in_quantum_mechanics"
      offline_cache: true
      priority: "required"

  guides:
    - id: "qiskit-measurement"
      name: "Qiskit Measurement Operations"
      url: "https://qiskit.org/documentation/tutorials/circuits/01_circuit_basics.html"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "qiskit"
      purpose: "Measurement analysis"

    - tool: "statistical-tools"
      purpose: "Shot count estimation"

signals:
  critical:
    - id: "MS-CRIT-001"
      signal: "Measuring in wrong basis"
      evidence_indicators:
        - "Computational basis measurement when algorithm requires different basis"
        - "Missing basis rotation gates"
        - "Output probabilities don't match expected pattern"
      explanation: |
        Measuring in the wrong basis destroys the quantum information
        that the algorithm computed, producing meaningless results.
      remediation: |
        Add appropriate basis transformation before measurement.
        Verify measurement basis matches algorithm requirements.

    - id: "MS-CRIT-002"
      signal: "Insufficient shot count for required precision"
      evidence_threshold: "shots < 1/epsilon^2 for desired precision epsilon"
      explanation: |
        Statistical estimation requires sufficient samples.
        Too few shots produce unreliable results with high variance.
      remediation: "Increase shot count based on required precision"

  high:
    - id: "MS-HIGH-001"
      signal: "Inefficient measurement-based state tomography"
      evidence_indicators:
        - "Full tomography when partial measurement sufficient"
        - "Redundant measurement bases"
      remediation: "Optimize measurement protocol for required information"

    - id: "MS-HIGH-002"
      signal: "Mid-circuit measurement causing decoherence"
      evidence_indicators:
        - "Measurement feedback delays exceed coherence time"
        - "Unnecessary mid-circuit measurements"
      remediation: "Review mid-circuit measurement necessity and timing"

  medium:
    - id: "MS-MED-001"
      signal: "No shot count optimization"
      remediation: "Implement adaptive shot count based on precision needs"

    - id: "MS-MED-002"
      signal: "Measurement results not properly aggregated"
      remediation: "Implement proper statistical aggregation"

  low:
    - id: "MS-LOW-001"
      signal: "Measurement strategy not documented"
      remediation: "Document measurement choices and rationale"

  positive:
    - id: "MS-POS-001"
      signal: "Optimal measurement basis used"
    - id: "MS-POS-002"
      signal: "Shot count properly optimized"
    - id: "MS-POS-003"
      signal: "Efficient information extraction"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Measurement Points"
      description: "Locate all measurements in circuit"
      duration_estimate: "30 min"

    - id: "2"
      name: "Verify Measurement Basis"
      description: "Check measurement basis matches algorithm needs"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Analyze Shot Requirements"
      description: "Calculate required shots for desired precision"
      duration_estimate: "45 min"

    - id: "4"
      name: "Review Post-Processing"
      description: "Evaluate classical processing of measurement results"
      duration_estimate: "45 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "measurement_analysis"
      format: "json"
      description: "Detailed measurement strategy breakdown"

closeout_checklist:
  - id: "ms-001"
    item: "Measurement basis verified correct"
    level: "CRITICAL"
    verification: "manual"

  - id: "ms-002"
    item: "Shot count sufficient for precision"
    level: "BLOCKING"
    verification: "automated"

  - id: "ms-003"
    item: "Post-processing correctly implemented"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["quantum-systems"]

relationships:
  commonly_combined:
    - "quantum-computing.quantum-algorithm.algorithm-correctness"
    - "quantum-computing.hybrid-classical-quantum.result-decoding"
  feeds_into:
    - "quantum-computing.simulation-testing.simulator-accuracy"
