# ============================================================
# AUDIT: Circuit Depth
# Category: 42 - Quantum Computing
# Subcategory: quantum-algorithm
# ============================================================

audit:
  id: "quantum-computing.quantum-algorithm.circuit-depth"
  name: "Quantum Circuit Depth Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "quantum-algorithm"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "yes"
  severity: "high"
  scope: "quantum-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Analyzes the depth of quantum circuits to ensure they can execute within
    hardware coherence times. Evaluates gate sequences, parallelization opportunities,
    and circuit optimization potential. Measures critical path length and identifies
    depth-reduction strategies.

  why_it_matters: |
    Circuit depth directly determines whether an algorithm can run successfully
    on real quantum hardware. Deep circuits accumulate errors faster than
    decoherence allows, resulting in noise-dominated results. Optimizing depth
    is essential for near-term quantum advantage.

  when_to_run:
    - "Before hardware execution"
    - "During circuit optimization"
    - "When targeting specific quantum processors"
    - "After algorithm changes"

prerequisites:
  required_artifacts:
    - type: "quantum_circuits"
      description: "Circuit definitions to analyze"
    - type: "hardware_specs"
      description: "Target hardware coherence times and gate times"

  access_requirements:
    - "Access to circuit code"
    - "Target hardware specifications"

discovery:
  file_patterns:
    - glob: "**/*.qasm"
      purpose: "Find OpenQASM files"
    - glob: "**/circuits/**/*.py"
      purpose: "Find circuit definitions"

  metrics_queries:
    - system: "qiskit"
      query: "circuit.depth()"
      purpose: "Measure circuit depth"
      threshold: "< T1/gate_time for target hardware"

knowledge_sources:
  specifications:
    - id: "ibm-hardware-specs"
      name: "IBM Quantum Hardware Specifications"
      url: "https://quantum-computing.ibm.com/services/resources"
      offline_cache: true
      priority: "required"

  guides:
    - id: "circuit-optimization"
      name: "Qiskit Circuit Optimization Guide"
      url: "https://qiskit.org/documentation/apidoc/transpiler.html"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "qiskit-transpiler"
      purpose: "Circuit depth analysis and optimization"

    - tool: "pytket"
      purpose: "Advanced circuit optimization"
      install: "pip install pytket"

signals:
  critical:
    - id: "CD-CRIT-001"
      signal: "Circuit depth exceeds coherence limit"
      evidence_threshold: "depth * avg_gate_time > T1 * 0.1"
      explanation: |
        Circuits deeper than ~10% of T1 coherence time will produce
        noise-dominated results. The algorithm cannot succeed on target hardware.
      remediation: |
        Apply aggressive circuit optimization.
        Consider algorithmic changes to reduce depth.
        Target hardware with longer coherence times.

    - id: "CD-CRIT-002"
      signal: "Unbounded circuit depth growth"
      evidence_indicators:
        - "Depth scales exponentially with problem size"
        - "No depth optimization applied"
      explanation: |
        Algorithms with exponential depth growth cannot achieve quantum advantage
        as they will always exceed coherence limits for useful problem sizes.
      remediation: "Review algorithm complexity and consider alternatives"

  high:
    - id: "CD-HIGH-001"
      signal: "Suboptimal gate parallelization"
      evidence_indicators:
        - "Independent gates executed sequentially"
        - "Parallelization opportunities missed"
      remediation: "Apply circuit scheduling optimization"

    - id: "CD-HIGH-002"
      signal: "Redundant gate sequences"
      evidence_indicators:
        - "Adjacent inverse gates not cancelled"
        - "Identity sequences present"
      remediation: "Apply peephole optimization passes"

  medium:
    - id: "CD-MED-001"
      signal: "Non-native gate decomposition inefficient"
      remediation: "Use hardware-native gates where possible"

    - id: "CD-MED-002"
      signal: "SWAP operations adding depth"
      remediation: "Optimize qubit routing for hardware topology"

  low:
    - id: "CD-LOW-001"
      signal: "Circuit depth not documented"
      remediation: "Document expected depth and scaling"

  positive:
    - id: "CD-POS-001"
      signal: "Circuit depth well within coherence limits"
    - id: "CD-POS-002"
      signal: "Optimal parallelization achieved"
    - id: "CD-POS-003"
      signal: "Polynomial depth scaling documented"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Measure Raw Circuit Depth"
      description: "Calculate depth of unoptimized circuit"
      duration_estimate: "30 min"
      commands:
        - purpose: "Measure circuit depth"
          command: "python -c 'from qiskit import QuantumCircuit; qc = QuantumCircuit.from_qasm_file(\"circuit.qasm\"); print(f\"Depth: {qc.depth()}\")'"

    - id: "2"
      name: "Apply Optimization Passes"
      description: "Run circuit optimization and measure improvement"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Compare to Hardware Limits"
      description: "Check depth against target hardware coherence"
      duration_estimate: "45 min"

    - id: "4"
      name: "Analyze Scaling"
      description: "Test depth growth with problem size"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "depth_analysis"
      format: "json"
      description: "Detailed depth metrics"

closeout_checklist:
  - id: "cd-001"
    item: "Circuit depth within hardware coherence limits"
    level: "CRITICAL"
    verification: "automated"
    expected: "PASS"

  - id: "cd-002"
    item: "Optimization passes applied"
    level: "BLOCKING"
    verification: "automated"

  - id: "cd-003"
    item: "Depth scaling documented"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["quantum-systems"]

relationships:
  commonly_combined:
    - "quantum-computing.quantum-algorithm.gate-decomposition"
    - "quantum-computing.resource-estimation.execution-time-estimate"
  feeds_into:
    - "quantum-computing.error-handling.error-budget"
