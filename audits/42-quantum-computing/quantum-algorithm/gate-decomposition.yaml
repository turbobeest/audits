# ============================================================
# AUDIT: Gate Decomposition
# Category: 42 - Quantum Computing
# Subcategory: quantum-algorithm
# ============================================================

audit:
  id: "quantum-computing.quantum-algorithm.gate-decomposition"
  name: "Quantum Gate Decomposition Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "quantum-computing"
  category_number: 42
  subcategory: "quantum-algorithm"

  tier: "expert"
  estimated_duration: "3-4 hours"  # median: 3h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "yes"
  severity: "high"
  scope: "quantum-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates how quantum gates are decomposed into hardware-native gate sets.
    Analyzes efficiency of decomposition, accuracy of approximations, and
    compatibility with target quantum processors. Verifies that decomposed
    circuits maintain algorithmic correctness.

  why_it_matters: |
    Quantum hardware supports limited native gate sets. Arbitrary gates must
    be decomposed into native gates, potentially introducing approximation
    errors and increasing circuit depth. Efficient decomposition is crucial
    for successful algorithm execution.

  when_to_run:
    - "When targeting specific hardware"
    - "After adding custom gates"
    - "During circuit optimization"
    - "When changing target backend"

prerequisites:
  required_artifacts:
    - type: "quantum_circuits"
      description: "Circuits with gates to decompose"
    - type: "target_gate_set"
      description: "Native gate set of target hardware"

  access_requirements:
    - "Access to circuit code"
    - "Hardware backend specifications"

discovery:
  file_patterns:
    - glob: "**/gates/**/*.py"
      purpose: "Find custom gate definitions"
    - glob: "**/*.qasm"
      purpose: "Find circuit files"

  code_patterns:
    - pattern: "UnitaryGate|Gate|to_matrix"
      type: "keyword"
      scope: "source"
      purpose: "Find custom gate implementations"

knowledge_sources:
  specifications:
    - id: "solovay-kitaev"
      name: "Solovay-Kitaev Theorem"
      url: "https://en.wikipedia.org/wiki/Solovay%E2%80%93Kitaev_theorem"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "qiskit-decomposition"
      name: "Qiskit Gate Decomposition"
      url: "https://qiskit.org/documentation/stubs/qiskit.quantum_info.decompose.html"
      offline_cache: true

tooling:
  analysis_tools:
    - tool: "qiskit-transpiler"
      purpose: "Gate decomposition and optimization"

    - tool: "pytket"
      purpose: "Advanced decomposition strategies"

signals:
  critical:
    - id: "GD-CRIT-001"
      signal: "Decomposition introduces significant error"
      evidence_threshold: "Fidelity < 0.99 after decomposition"
      explanation: |
        Approximation-based decomposition can introduce errors that compound
        with circuit depth, leading to incorrect results.
      remediation: |
        Increase decomposition precision.
        Use exact decomposition where possible.
        Verify fidelity before and after decomposition.

    - id: "GD-CRIT-002"
      signal: "Gates incompatible with target hardware"
      evidence_indicators:
        - "Gates not in hardware native set"
        - "No decomposition path available"
      remediation: "Define decomposition rules for custom gates"

  high:
    - id: "GD-HIGH-001"
      signal: "Excessive gate count from decomposition"
      evidence_indicators:
        - "Single gates expanding to 10+ native gates"
        - "Exponential gate count growth"
      remediation: "Use more efficient decomposition strategies"

    - id: "GD-HIGH-002"
      signal: "Decomposition not hardware-topology aware"
      remediation: "Use topology-aware transpilation"

  medium:
    - id: "GD-MED-001"
      signal: "Suboptimal native gate selection"
      remediation: "Review and optimize native gate choices"

    - id: "GD-MED-002"
      signal: "Missing decomposition tests"
      remediation: "Add fidelity tests for decomposition"

  low:
    - id: "GD-LOW-001"
      signal: "Decomposition not documented"
      remediation: "Document decomposition strategies used"

  positive:
    - id: "GD-POS-001"
      signal: "High-fidelity decomposition achieved"
    - id: "GD-POS-002"
      signal: "Efficient gate count post-decomposition"
    - id: "GD-POS-003"
      signal: "Hardware-native gates used throughout"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Non-Native Gates"
      description: "Find all gates requiring decomposition"
      duration_estimate: "30 min"

    - id: "2"
      name: "Analyze Decomposition Strategy"
      description: "Review how gates are decomposed"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Verify Fidelity"
      description: "Compare unitary before and after decomposition"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Measure Gate Count Impact"
      description: "Assess circuit size increase from decomposition"
      duration_estimate: "30 min"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "decomposition_report"
      format: "json"
      description: "Gate-by-gate decomposition analysis"

closeout_checklist:
  - id: "gd-001"
    item: "Decomposition fidelity > 0.99"
    level: "CRITICAL"
    verification: "automated"

  - id: "gd-002"
    item: "All gates decompose to native set"
    level: "BLOCKING"
    verification: "automated"

  - id: "gd-003"
    item: "Gate count increase documented"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["quantum-systems"]

relationships:
  commonly_combined:
    - "quantum-computing.quantum-algorithm.circuit-depth"
    - "quantum-computing.resource-estimation.gate-count"
  feeds_into:
    - "quantum-computing.resource-estimation.hardware-compatibility"
