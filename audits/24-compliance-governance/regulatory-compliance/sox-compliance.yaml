audit:
  id: compliance-governance.regulatory-compliance.sox-compliance
  name: SOX Compliance Audit
  version: 1.0.0
  last_updated: '2025-01-19'
  status: active
  category: compliance-governance
  category_number: 24
  subcategory: regulatory-compliance
  tier: phd
  estimated_duration: 8-16 hours  # median: 12h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: process
  default_profiles:
  - full
  - security
  - production
  blocks_phase: true
  parallelizable: true
description:
  what: |
    Comprehensive audit of Sarbanes-Oxley Act (SOX) IT compliance for publicly
    traded companies and their subsidiaries. Evaluates internal controls over
    financial reporting (ICFR) as required by Sections 302 and 404. Examines
    IT general controls (ITGCs) including access controls, change management,
    computer operations, and IT security. Assesses controls over systems that
    impact financial data integrity, audit logging, segregation of duties,
    and third-party vendor risk management.
  why_it_matters: |
    SOX non-compliance carries severe consequences:
    - Criminal liability for executives (up to $5M fines, 20 years imprisonment)
    - Civil penalties and SEC enforcement actions
    - Required restatement of financial statements
    - Damage to stock price and investor confidence
    - External auditor adverse opinions
    - Personal certification liability for CEO/CFO under Section 302
    - Increased regulatory scrutiny from SEC in 2025
    - Third-party risk now explicitly in scope
  when_to_run:
  - Quarterly during SOX testing cycles
  - Annual compliance assessment
  - After changes to financial systems
  - Before executive certifications
  - After IT infrastructure changes
  - When onboarding vendors with financial system access
prerequisites:
  required_artifacts:
  - type: financial_system_inventory
    description: Inventory of systems impacting financial reporting
    location_hints:
    - compliance/sox/system-inventory.xlsx
    - docs/architecture/financial-systems.md
  - type: control_documentation
    description: IT general controls documentation
    location_hints:
    - compliance/sox/controls/
    - policies/it-controls/
  - type: risk_assessment
    description: IT risk assessment for financial systems
    location_hints:
    - compliance/sox/risk-assessment.xlsx
    - security/risk-assessment/
  optional_artifacts:
  - type: audit_reports
    description: Previous SOX audit reports
    location_hints:
    - compliance/sox/audits/
    - audit-reports/
  - type: change_records
    description: Change management records
    location_hints:
    - operations/changes/
    - compliance/change-log/
  - type: access_reviews
    description: User access review documentation
    location_hints:
    - compliance/sox/access-reviews/
    - security/access-reviews/
  access_requirements:
  - Access to financial system documentation
  - Access to ITGC control documentation
  - Access to change management records
  - Access to user access provisioning system
  - Access to audit logs
discovery:
  file_patterns:
  - glob: '**/sox/**/*'
    purpose: SOX-specific compliance documentation
  - glob: '**/financial*.{yaml,json,py,ts}'
    purpose: Financial system code
  - glob: '**/audit*.{yaml,json,log}'
    purpose: Audit logging configuration
  - glob: '**/access*.{yaml,json}'
    purpose: Access control configuration
  code_patterns:
  - pattern: financial|accounting|ledger|journal
    type: regex
    scope: source
    purpose: Identify financial system code
  - pattern: audit.?log|activity.?log|change.?log
    type: regex
    scope: source
    purpose: Identify audit logging implementation
  - pattern: approval|authorize|segregat
    type: regex
    scope: source
    purpose: Identify authorization and segregation controls
  documents_to_review:
  - type: IT General Controls Documentation
    purpose: Verify ITGC design and implementation
    analysis_checklist:
    - Access control policies and procedures
    - Change management procedures
    - Computer operations procedures
    - IT security policies
    - Segregation of duties matrix
  - type: Financial System Inventory
    purpose: Verify all systems in scope are identified
    analysis_checklist:
    - All applications supporting financial reporting
    - Interfaces between systems
    - Data flows for financial data
    - Supporting infrastructure
  - type: Risk Assessment
    purpose: Verify risk-based control approach
    analysis_checklist:
    - Risks to financial reporting identified
    - Controls mapped to risks
    - Risk ratings documented
    - Annual review conducted
knowledge_sources:
  specifications:
  - id: sox-act
    name: Sarbanes-Oxley Act of 2002
    url: https://www.congress.gov/bill/107th-congress/house-bill/3763
    offline_cache: true
    priority: required
  - id: pcaob-as2201
    name: PCAOB AS 2201 - Audit of ICFR
    url: https://pcaobus.org/Standards/Auditing/Pages/AS2201.aspx
    offline_cache: true
    priority: required
  guides:
  - id: coso-framework
    name: COSO Internal Control Framework
    url: https://www.coso.org/guidance-on-ic
    offline_cache: true
    priority: required
  - id: cobit-sox
    name: COBIT for SOX Compliance
    url: https://www.isaca.org/resources/cobit
    offline_cache: true
    priority: recommended
  learning_resources:
  - id: sox-certification
    title: SOX Compliance Certification Programs
    type: course
    reference: ISACA and IIA
tooling:
  assessment_tools:
  - tool: SOX ITGC Control Matrix
    purpose: Evaluate IT general controls
    description: |
      Assess ITGCs across key domains:
      - Access to Programs and Data
      - Program Changes
      - Program Development
      - Computer Operations
      - IT Security
  scripts:
  - id: access-control-check
    language: bash
    purpose: Check access control configuration
    source: inline
    code: |
      #!/bin/bash
      echo "=== SOX Access Control Check ==="

      # Check for RBAC configuration
      echo "Searching for role-based access controls..."
      grep -r -l "rbac\|role.*based\|permission" \
        --include="*.yaml" --include="*.tf" --include="*.json" . 2>/dev/null | head -20

      # Check for segregation of duties
      echo ""
      echo "Searching for segregation of duties..."
      grep -r -i "segregat\|sod\|conflict" \
        --include="*.yaml" --include="*.md" --include="*.py" . 2>/dev/null | head -20

      # Check for approval workflows
      echo ""
      echo "Searching for approval workflows..."
      grep -r -l "approval\|authorize\|workflow" \
        --include="*.yaml" --include="*.json" . 2>/dev/null | head -20
    offline_capable: true
  - id: change-management-check
    language: bash
    purpose: Verify change management controls
    source: inline
    code: |
      #!/bin/bash
      echo "=== SOX Change Management Check ==="

      # Check for change approval requirements
      echo "Searching for change approval configuration..."
      grep -r -i "require.*approval\|pull.?request\|code.?review" \
        --include="*.yaml" --include="*.md" . 2>/dev/null | head -20

      # Check for deployment pipelines
      echo ""
      echo "Searching for deployment controls..."
      find . -name "*deploy*" -o -name "*pipeline*" -o -name "*ci*" 2>/dev/null | head -20

      # Check for audit trails on changes
      echo ""
      echo "Searching for change audit trails..."
      grep -r -l "change.*log\|audit.*trail\|version.*control" \
        --include="*.yaml" --include="*.md" . 2>/dev/null | head -20
    offline_capable: true
  - id: audit-logging-check
    language: bash
    purpose: Verify audit logging configuration
    source: inline
    code: |
      #!/bin/bash
      echo "=== SOX Audit Logging Check ==="

      # Check for audit logging
      echo "Searching for audit logging configuration..."
      grep -r -l "audit.?log\|cloudtrail\|activity.?log" \
        --include="*.yaml" --include="*.tf" . 2>/dev/null | head -20

      # Check for log retention
      echo ""
      echo "Searching for log retention..."
      grep -r -i "retention\|archive\|preserve" \
        --include="*.yaml" --include="*.tf" . 2>/dev/null | head -20

      # Check for tamper protection
      echo ""
      echo "Searching for log integrity controls..."
      grep -r -i "immutable\|worm\|tamper" \
        --include="*.yaml" --include="*.tf" . 2>/dev/null | head -20
    offline_capable: true
signals:
  critical:
  - id: SOX-CRIT-001
    signal: Financial systems lack segregation of duties
    evidence_indicators:
    - Single user can create and approve transactions
    - Developers have production access to financial data
    - No SoD conflict detection
    - Same person handles invoices and payments
    explanation: |
      Segregation of duties is fundamental to preventing fraud
      and errors in financial reporting. Inadequate SoD is a
      common material weakness finding that can lead to
      restatements and adverse audit opinions.
    remediation: |
      1. Document SoD matrix for all financial processes
      2. Implement role-based access enforcing SoD
      3. Configure automated SoD conflict detection
      4. Separate incompatible functions (maker/checker)
      5. Regular SoD reviews and remediation
  - id: SOX-CRIT-002
    signal: Change management controls inadequate
    evidence_indicators:
    - No approval required for production changes
    - No separation between development and production
    - Changes not documented or tracked
    - No testing before production deployment
    explanation: |
      Change management (SDLC) controls ensure only authorized,
      tested changes reach production financial systems. Weak
      controls can result in unauthorized changes affecting
      financial data integrity.
    remediation: |
      1. Implement formal change approval workflow
      2. Require testing and sign-off before deployment
      3. Separate development, test, and production environments
      4. Document all changes with business justification
      5. Restrict production access to authorized personnel
  - id: SOX-CRIT-003
    signal: Access controls not properly managed
    evidence_indicators:
    - No user access reviews conducted
    - Terminated users retain access
    - No provisioning approval workflow
    - Generic/shared accounts used
    - No privileged access management
    explanation: |
      Access to programs and data must be appropriately restricted.
      Weak access controls can allow unauthorized access to or
      modification of financial data.
    remediation: |
      1. Implement user access provisioning workflow with approvals
      2. Conduct quarterly access reviews
      3. Ensure timely termination of access for leavers
      4. Eliminate generic/shared accounts
      5. Implement privileged access management
  - id: SOX-CRIT-004
    signal: Audit trail inadequate for financial systems
    evidence_indicators:
    - Financial transactions not logged
    - Logs can be modified or deleted
    - Insufficient log retention
    - No monitoring of log data
    explanation: |
      Audit trails are essential for reconstructing financial
      transactions and supporting audit procedures. Inadequate
      logging impairs audit ability and fraud detection.
    remediation: |
      1. Enable comprehensive audit logging for financial systems
      2. Log all create, read, update, delete operations
      3. Implement log integrity controls (immutable storage)
      4. Configure appropriate retention (7+ years)
      5. Implement log monitoring and alerting
  high:
  - id: SOX-HIGH-001
    signal: Third-party vendor controls not assessed
    evidence_indicators:
    - Vendors with financial system access not evaluated
    - No SOC reports obtained or reviewed
    - Vendor contracts lack security requirements
    - Subservice organizations not addressed
    explanation: |
      Companies are responsible for controls even when functions
      are outsourced. Third-party risk management is now
      explicitly emphasized by regulators.
    remediation: |
      1. Inventory all vendors with financial system access
      2. Obtain and review SOC 1/2 reports annually
      3. Assess complementary user entity controls (CUECs)
      4. Include security requirements in contracts
      5. Monitor vendor compliance ongoing
  - id: SOX-HIGH-002
    signal: IT risk assessment not current
    evidence_indicators:
    - Risk assessment older than 12 months
    - New systems not assessed
    - Risk ratings not reviewed
    - Controls not mapped to risks
    explanation: |
      Risk assessment forms the basis for control design and
      testing. Outdated assessments may miss emerging risks
      or changes in the control environment.
    remediation: |
      1. Conduct annual IT risk assessment
      2. Include all systems supporting financial reporting
      3. Assess new risks from technology changes
      4. Map controls to identified risks
      5. Update testing plan based on risk
  - id: SOX-HIGH-003
    signal: Backup and recovery inadequate
    evidence_indicators:
    - No backup procedures documented
    - Backups not tested
    - RTO/RPO not defined
    - Offsite storage not implemented
    explanation: |
      Computer operations controls include ensuring financial
      data can be recovered. Inadequate backup could result in
      loss of financial records or reporting delays.
    remediation: |
      1. Document backup procedures for all financial systems
      2. Define and test RTO/RPO requirements
      3. Implement offsite/cloud backup storage
      4. Conduct regular recovery testing
      5. Document and review test results
  - id: SOX-HIGH-004
    signal: Security incidents not properly managed
    evidence_indicators:
    - No incident response procedure
    - Security events not monitored
    - Incidents not documented
    - No root cause analysis
    explanation: |
      IT security controls include detecting and responding to
      security incidents that could impact financial systems.
    remediation: |
      1. Document incident response procedures
      2. Implement security monitoring for financial systems
      3. Log and investigate all security incidents
      4. Conduct root cause analysis
      5. Remediate vulnerabilities identified
  medium:
  - id: SOX-MED-001
    signal: Password policies inadequate
    evidence_indicators:
    - Weak password requirements
    - No password expiration
    - No account lockout
    - Passwords not encrypted
    explanation: |
      Strong authentication controls are fundamental to access
      management. Weak passwords increase unauthorized access risk.
    remediation: |
      1. Implement strong password requirements
      2. Configure password expiration (90 days)
      3. Enable account lockout after failed attempts
      4. Store passwords using strong hashing
      5. Consider implementing MFA
  - id: SOX-MED-002
    signal: Documentation not maintained
    evidence_indicators:
    - Policies not current
    - Procedures not documented
    - Control descriptions outdated
    - No version control
    explanation: |
      Documentation is the backbone of SOX compliance. Auditors
      require current, accurate documentation to test controls.
    remediation: |
      1. Document all control procedures
      2. Maintain version history
      3. Review and update annually
      4. Ensure documentation matches practice
  - id: SOX-MED-003
    signal: Batch job monitoring inadequate
    evidence_indicators:
    - Batch jobs not monitored
    - Job failures not alerted
    - No reconciliation of batch outputs
    explanation: |
      Computer operations controls include monitoring automated
      processes that impact financial data processing.
    remediation: |
      1. Implement batch job monitoring
      2. Configure alerts for job failures
      3. Document job schedules and dependencies
      4. Reconcile batch processing outputs
  low:
  - id: SOX-LOW-001
    signal: IT policies not formally approved
    evidence_indicators:
    - Policies lack management sign-off
    - No policy governance process
    remediation: |
      Establish formal policy approval and review process.
  - id: SOX-LOW-002
    signal: Training records incomplete
    evidence_indicators:
    - IT staff training not documented
    - Security awareness training lacking
    remediation: |
      Implement documented training program for IT personnel.
  positive:
  - id: SOX-POS-001
    signal: Automated controls well-implemented
    evidence_indicators:
    - System-enforced segregation of duties
    - Automated approval workflows
    - Automated access reviews
  - id: SOX-POS-002
    signal: Continuous monitoring implemented
    evidence_indicators:
    - Real-time control monitoring
    - Automated exception reporting
    - Dashboard-based compliance tracking
  - id: SOX-POS-003
    signal: Comprehensive audit trail
    evidence_indicators:
    - All transactions logged
    - Immutable log storage
    - Regular log review conducted
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  preparation:
  - step: Obtain financial system inventory
  - step: Review previous audit findings
  - step: Understand material accounts and processes
  - step: Identify key controls
  steps:
  - id: '1'
    name: Scope Assessment
    description: |
      Identify all IT systems and processes within scope of
      SOX compliance based on impact on financial reporting.
    duration_estimate: 1-2 hours
    questions:
    - What systems support financial reporting?
    - What are the material accounts?
    - What interfaces exist between systems?
    - What third parties have system access?
    expected_findings:
    - Complete system inventory
    - Scope determination
  - id: '2'
    name: Access Control Assessment
    description: |
      Evaluate controls over access to programs and data
      including provisioning, reviews, and terminations.
    duration_estimate: 2-3 hours
    commands:
    - purpose: Check access control configuration
      command: grep -r 'rbac\|permission\|role' --include='*.yaml' --include='*.tf' . | head -30
    expected_findings:
    - Access control design adequacy
    - Operating effectiveness evidence
  - id: '3'
    name: Change Management Assessment
    description: |
      Evaluate controls over program changes including
      approval, testing, and deployment procedures.
    duration_estimate: 2-3 hours
    questions:
    - Are changes formally approved?
    - Is testing required before deployment?
    - Are development and production separated?
    - Are changes documented?
    expected_findings:
    - Change management maturity
    - Control gaps
  - id: '4'
    name: Computer Operations Assessment
    description: |
      Evaluate controls over IT operations including batch
      processing, backup, and incident management.
    duration_estimate: 1-2 hours
    questions:
    - Are batch jobs monitored?
    - Are backups tested regularly?
    - Is incident response documented?
    expected_findings:
    - Operations control status
    - Recovery capability
  - id: '5'
    name: IT Security Assessment
    description: |
      Evaluate security controls including authentication,
      encryption, monitoring, and vulnerability management.
    duration_estimate: 1-2 hours
    commands:
    - purpose: Check security configuration
      command: grep -r 'encrypt\|auth\|security' --include='*.yaml' --include='*.tf' . | head -30
    expected_findings:
    - Security control adequacy
    - Vulnerability status
  - id: '6'
    name: Third-Party Assessment
    description: |
      Evaluate vendor risk management and SOC report
      review procedures.
    duration_estimate: 1-2 hours
    questions:
    - Are vendors with system access inventoried?
    - Are SOC reports obtained and reviewed?
    - Are CUECs implemented?
    expected_findings:
    - Vendor compliance status
    - CUEC implementation gaps
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: control_matrix
    format: table
    description: ITGC control assessment
    columns:
    - Control Domain
    - Control
    - Design Effectiveness
    - Operating Effectiveness
    - Test Results
    - Gap/Issue
    - Remediation
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Scope and Materiality
    - ITGC Assessment by Domain
    - Deficiencies and Gaps
    - Remediation Plan
    - Management Response
  confidence_guidance:
    high: Control tested with sufficient sample
    medium: Control design reviewed, limited testing
    low: Based on inquiry only
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: sox-act
      priority: required
    - source_id: pcaob-as2201
      priority: required
    - source_id: coso-framework
      priority: required
  degradation:
  - feature: Live system access testing
    impact: Cannot verify control operating effectiveness
    mitigation: Review screenshots and evidence documentation
profiles:
  membership:
    quick:
      included: false
      reason: Comprehensive assessment required
    security:
      included: true
      priority: 5
    production:
      included: true
      priority: 3
    full:
      included: true
      priority: 2
closeout_checklist:
- id: sox-001
  item: Segregation of duties enforced in financial systems
  level: CRITICAL
  verification: manual
  verification_notes: SoD matrix documented and enforced through system controls
  expected: Confirmed by reviewer
- id: sox-002
  item: Change management controls operating effectively
  level: CRITICAL
  verification: manual
  verification_notes: All production changes approved, tested, and documented
  expected: Confirmed by reviewer
- id: sox-003
  item: Access controls operating effectively
  level: CRITICAL
  verification: manual
  verification_notes: Access reviews conducted, terminations timely, provisioning approved
  expected: Confirmed by reviewer
- id: sox-004
  item: Audit logging comprehensive and retained
  level: BLOCKING
  verification: manual
  verification_notes: All financial system activity logged with appropriate retention
  expected: Confirmed by reviewer
- id: sox-005
  item: Third-party SOC reports reviewed
  level: BLOCKING
  verification: manual
  verification_notes: SOC reports obtained and CUECs implemented for all vendors
  expected: Confirmed by reviewer
- id: sox-006
  item: Backup and recovery tested
  level: WARNING
  verification: manual
  verification_notes: Recovery testing conducted with documented results
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - public-company
    - subsidiary
    - financial-services
    maturity:
    - mature
    regulatory_scope:
    - US-SEC
    - PCAOB
  compliance_frameworks:
  - framework: SOX
    controls:
    - Section 302
    - Section 404
  - framework: COSO
    controls:
    - All Components
  - framework: COBIT
    controls:
    - Relevant IT Controls
  - framework: SOC1
    controls:
    - Type II
relationships:
  commonly_combined:
  - compliance-governance.audit-trails.audit-log-completeness
  - compliance-governance.policy-enforcement.access-policy-enforcement
  - compliance-governance.certifications-attestations.soc2-readiness
  - security-trust.access-control.authorization-verification
