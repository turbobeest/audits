audit:
  id: cloud-infrastructure.networking.dns-configuration
  name: DNS Configuration
  version: 1.0.0
  last_updated: '2026-01-19'
  status: active
  category: cloud-infrastructure
  category_number: 12
  subcategory: networking
  tier: phd
  estimated_duration: 2-3 hours  # median: 2h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: infrastructure
  default_profiles:
  - full
  - production
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates DNS configurations including Route53 hosted zones, record
    management, health checks, failover routing, DNSSEC, and domain
    registration settings. Examines whether DNS is configured for
    reliability, security, and optimal performance.
  why_it_matters: |
    DNS is critical infrastructure - if DNS fails, nothing works. Poor
    DNS configuration causes outages, slow resolution, and security
    vulnerabilities. Missing health checks prevent failover. Lack of
    DNSSEC enables DNS spoofing attacks. Proper DNS configuration
    ensures availability, security, and performance.
  when_to_run:
  - Infrastructure audits
  - Security assessments
  - Before major launches
  - After DNS incidents
prerequisites:
  required_artifacts:
  - type: cloud_access
    description: Read access to Route53 configurations
  - type: domain_inventory
    description: List of managed domains
  access_requirements:
  - Route53 hosted zone access
  - Health check configuration access
  - Domain registration access
discovery:
  file_patterns:
  - glob: '**/terraform/**/*route53*.tf'
    purpose: Find Terraform DNS configurations
  - glob: '**/terraform/**/*dns*.tf'
    purpose: Find DNS configurations
knowledge_sources:
  specifications:
  - id: aws-route53-docs
    name: AWS Route53 Documentation
    url: https://docs.aws.amazon.com/route53/
    offline_cache: true
    priority: required
  - id: rfc-dnssec
    name: RFC 4033-4035 - DNSSEC
    url: https://tools.ietf.org/html/rfc4033
    offline_cache: true
    priority: recommended
  - id: nist-800-207
    name: 'NIST SP 800-207: Zero Trust Architecture'
    url: https://csrc.nist.gov/publications/detail/sp/800-207/final
    offline_cache: true
    priority: required
  guides:
  - id: route53-best-practices
    name: Route53 Best Practices
    url: https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/best-practices.html
    offline_cache: true
  - id: dns-security
    name: DNS Security Best Practices
    url: https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/dns-failover.html
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: AWS CLI
    purpose: List hosted zones
    command: aws route53 list-hosted-zones
  - tool: AWS CLI
    purpose: List health checks
    command: aws route53 list-health-checks
  - tool: AWS CLI
    purpose: Check DNSSEC status
    command: aws route53 get-dnssec --hosted-zone-id {zone_id}
  scripts:
  - id: dns-analyzer
    language: bash
    purpose: Analyze DNS configurations
    source: inline
    code: |
      #!/bin/bash
      echo "=== DNS Configuration Analysis ==="

      # List hosted zones
      echo "Hosted Zones:"
      aws route53 list-hosted-zones \
        --query 'HostedZones[].{ID:Id,Name:Name,Private:Config.PrivateZone,Records:ResourceRecordSetCount}' \
        --output table

      # Check for DNSSEC
      echo ""
      echo "DNSSEC Status:"
      for zone in $(aws route53 list-hosted-zones --query 'HostedZones[?Config.PrivateZone==`false`].Id' --output text); do
        zone_id=${zone#/hostedzone/}
        name=$(aws route53 get-hosted-zone --id $zone_id --query 'HostedZone.Name' --output text)
        dnssec=$(aws route53 get-dnssec --hosted-zone-id $zone_id --query 'Status.ServeSignature' --output text 2>/dev/null || echo "N/A")
        echo "$name: DNSSEC=$dnssec"
      done

      # List health checks
      echo ""
      echo "Health Checks:"
      aws route53 list-health-checks \
        --query 'HealthChecks[].{ID:Id,Type:HealthCheckConfig.Type,FQDN:HealthCheckConfig.FullyQualifiedDomainName,Path:HealthCheckConfig.ResourcePath}' \
        --output table

      # Check for alias records (best practice)
      echo ""
      echo "Record Types Distribution (sample):"
      for zone in $(aws route53 list-hosted-zones --query 'HostedZones[].Id' --output text | head -3); do
        zone_id=${zone#/hostedzone/}
        echo "--- Zone: $zone_id ---"
        aws route53 list-resource-record-sets --hosted-zone-id $zone_id --max-items 100 \
          --query 'ResourceRecordSets[].Type' --output text | tr '\t' '\n' | sort | uniq -c
      done
signals:
  critical:
  - id: DNS-CRIT-001
    signal: Production domains without health checks for failover
    evidence_indicators:
    - No health checks associated with primary records
    - Failover routing without health check
    explanation: |
      Without health checks, DNS cannot detect failures and failover
      to healthy endpoints. This causes prolonged outages when
      primary endpoints fail.
    remediation: Configure health checks for all production endpoints with failover
  - id: DNS-CRIT-002
    signal: DNS zone without backup name servers
    evidence_pattern: Single provider without secondary DNS
    explanation: |
      If the primary DNS provider has an outage, all domains become
      unresolvable. Secondary DNS provides resilience.
    remediation: Configure secondary DNS or use multiple providers
  - id: DNS-CRIT-003
    signal: Domain expiring soon without auto-renewal
    evidence_threshold: Domain expires within 30 days without auto-renew
    explanation: |
      Domain expiration causes complete service outage. Auto-renewal
      prevents accidental expiration.
    remediation: Enable auto-renewal for all production domains
  high:
  - id: DNS-HIGH-001
    signal: DNSSEC not enabled for public zones
    evidence_pattern: 'ServeSignature: NOT_SIGNING'
    explanation: |
      Without DNSSEC, DNS responses can be spoofed, enabling
      man-in-the-middle attacks and traffic redirection.
    remediation: Enable DNSSEC signing for public hosted zones
  - id: DNS-HIGH-002
    signal: Low TTL causing excessive DNS queries
    evidence_threshold: TTL < 60 seconds for stable records
    explanation: |
      Very low TTLs increase DNS query volume, adding latency and
      cost. Stable records should have appropriate TTLs.
    remediation: Increase TTLs for stable records (300-3600 seconds typical)
  - id: DNS-HIGH-003
    signal: No query logging enabled
    evidence_pattern: No query logging configuration
    explanation: |
      Without query logging, DNS issues cannot be diagnosed and
      security investigations lack DNS visibility.
    remediation: Enable Route53 query logging
  medium:
  - id: DNS-MED-001
    signal: Not using alias records for AWS resources
    remediation: Use alias records for ELB, CloudFront, S3 endpoints
  - id: DNS-MED-002
    signal: CAA records not configured
    remediation: Add CAA records to restrict certificate authorities
  - id: DNS-MED-003
    signal: SPF/DKIM/DMARC not configured for email domains
    remediation: Configure email authentication records
  low:
  - id: DNS-LOW-001
    signal: DNS configuration not documented
    remediation: Document DNS architecture and record purposes
  positive:
  - id: DNS-POS-001
    signal: DNSSEC enabled for all public zones
  - id: DNS-POS-002
    signal: Health checks configured with appropriate failover
  - id: DNS-POS-003
    signal: Query logging enabled for visibility
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Zone Inventory
    description: |
      Collect inventory of all hosted zones and domains
      under management.
    duration_estimate: 20 min
    commands:
    - purpose: List hosted zones
      command: aws route53 list-hosted-zones --query 'HostedZones[].{ID:Id,Name:Name,Private:Config.PrivateZone,Records:ResourceRecordSetCount}'
        --output table
    - purpose: List registered domains
      command: aws route53domains list-domains --query 'Domains[].{Name:DomainName,AutoRenew:AutoRenew,Expiry:Expiry}'
        --output table 2>/dev/null || echo 'No domain registration access'
    expected_findings:
    - Complete zone inventory
    - Domain registration status
  - id: '2'
    name: Security Configuration Review
    description: |
      Review DNSSEC, CAA records, and other security
      configurations.
    duration_estimate: 30 min
    commands:
    - purpose: Check DNSSEC status
      command: for zone in $(aws route53 list-hosted-zones --query 'HostedZones[?Config.PrivateZone==`false`].Id'
        --output text); do zone_id=${zone#/hostedzone/}; echo "=== $zone_id ==="; aws route53 get-dnssec
        --hosted-zone-id $zone_id 2>/dev/null || echo 'DNSSEC not available'; done
    - purpose: Check for CAA records
      command: for zone in $(aws route53 list-hosted-zones --query 'HostedZones[].Id' --output text |
        head -5); do zone_id=${zone#/hostedzone/}; echo "=== $zone_id ==="; aws route53 list-resource-record-sets
        --hosted-zone-id $zone_id --query 'ResourceRecordSets[?Type==`CAA`]' --output yaml; done
    expected_findings:
    - DNSSEC enablement status
    - CAA record coverage
  - id: '3'
    name: Health Check Review
    description: |
      Review health check configurations and associations
      with DNS records.
    duration_estimate: 30 min
    commands:
    - purpose: List health checks
      command: aws route53 list-health-checks --query 'HealthChecks[].{ID:Id,Type:HealthCheckConfig.Type,Target:HealthCheckConfig.FullyQualifiedDomainName,Interval:HealthCheckConfig.RequestInterval,Threshold:HealthCheckConfig.FailureThreshold}'
        --output table
    - purpose: Get health check status
      command: 'for hc in $(aws route53 list-health-checks --query ''HealthChecks[].Id'' --output text
        | head -10); do status=$(aws route53 get-health-check-status --health-check-id $hc --query ''HealthCheckObservations[0].StatusReport.Status''
        --output text 2>/dev/null); echo "$hc: $status"; done'
    expected_findings:
    - Health check configurations
    - Current health status
  - id: '4'
    name: Record Configuration Review
    description: |
      Review record configurations for best practices
      including TTLs and alias usage.
    duration_estimate: 30 min
    commands:
    - purpose: Sample record configurations
      command: for zone in $(aws route53 list-hosted-zones --query 'HostedZones[].Id' --output text |
        head -3); do zone_id=${zone#/hostedzone/}; echo "=== $zone_id ==="; aws route53 list-resource-record-sets
        --hosted-zone-id $zone_id --max-items 20 --query 'ResourceRecordSets[].{Name:Name,Type:Type,TTL:TTL,Alias:AliasTarget.DNSName}'
        --output table; done
    expected_findings:
    - TTL patterns
    - Alias record usage
  - id: '5'
    name: Logging and Monitoring
    description: |
      Verify query logging is configured for visibility
      and troubleshooting.
    duration_estimate: 20 min
    commands:
    - purpose: Check query logging
      command: aws route53 list-query-logging-configs --query 'QueryLoggingConfigs[].{Zone:HostedZoneId,LogGroup:CloudWatchLogsLogGroupArn}'
        --output table 2>/dev/null || echo 'No query logging configs'
    expected_findings:
    - Query logging coverage
    - Log destinations
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Zone Inventory
    - Security Assessment
    - Health Check Review
    - Recommendations
  confidence_guidance:
    high: Full access to Route53 and domain registrations
    medium: Route53 access without domain registration
    low: Limited configuration access
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: aws-route53-docs
      priority: required
    - source_id: route53-best-practices
      priority: required
  limitations:
  - Cannot access live configurations offline
  - Health check status requires runtime access
profiles:
  membership:
    quick:
      included: true
      reason: Critical infrastructure check
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1
closeout_checklist:
- id: dns-001
  item: All hosted zones inventoried
  level: CRITICAL
  verification: aws route53 list-hosted-zones --query 'length(HostedZones)' | grep -qE '[0-9]+' && echo
    PASS || echo FAIL
  expected: PASS
- id: dns-002
  item: DNSSEC enabled for public zones
  level: BLOCKING
  verification: manual
  verification_notes: Verify DNSSEC signing for public hosted zones
  expected: Confirmed by reviewer
- id: dns-003
  item: Health checks configured for critical records
  level: BLOCKING
  verification: manual
  verification_notes: Verify health checks for production failover
  expected: Confirmed by reviewer
- id: dns-004
  item: Domain auto-renewal enabled
  level: WARNING
  verification: manual
  verification_notes: Verify auto-renewal for all production domains
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC6.1
    - CC7.2
  - framework: ISO 27001
    controls:
    - A.13.1.1
relationships:
  commonly_combined:
  - cloud-infrastructure.networking.load-balancer-config
  - cloud-infrastructure.networking.cdn-configuration
  - cloud-infrastructure.compute.compute-redundancy
