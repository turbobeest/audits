audit:
  id: legacy-migration.migration-planning.rollback-planning
  name: Rollback Planning Assessment Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: legacy-migration
  category_number: 33
  subcategory: migration-planning
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: system
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Validates that comprehensive rollback procedures exist for migration phases,
    including data rollback, service restoration, and communication protocols.
    This audit ensures that if migration fails or causes unacceptable issues,
    the organization can safely return to the previous state within acceptable
    time windows.
  why_it_matters: |
    Migrations without rollback capability are irreversible bets. When problems
    occur, the only path forward is fixing issues under pressure. Robust rollback
    procedures provide a safety net that enables bolder migration decisions while
    protecting business continuity.
  when_to_run:
  - Before each migration phase
  - As part of migration planning
  - During migration readiness review
  - After rollback procedure changes
prerequisites:
  required_artifacts:
  - type: migration_plan
    description: Detailed migration approach documentation
  - type: data_backup_procedures
    description: Data backup and restore documentation
  - type: deployment_procedures
    description: Deployment and rollback runbooks
  access_requirements:
  - Backup system access
  - Deployment pipeline access
  - Infrastructure provisioning access
  - Data restoration capabilities
discovery:
  file_patterns:
  - glob: '**/rollback*'
    purpose: Find rollback documentation
  - glob: '**/restore*'
    purpose: Find restoration procedures
  - glob: '**/backup*'
    purpose: Find backup configurations
  - glob: '**/runbook*'
    purpose: Find operational runbooks
  interview_questions:
  - role: Operations Engineer
    questions:
    - How would you roll back the migration if it fails?
    - How long would rollback take?
    - Has the rollback procedure been tested?
  - role: Database Administrator
    questions:
    - How do you restore data to pre-migration state?
    - What is the data loss window in a rollback?
    - Are there any data changes that cannot be rolled back?
knowledge_sources:
  guides:
  - id: blue-green
    name: Blue-Green Deployment
    url: https://martinfowler.com/bliki/BlueGreenDeployment.html
  - id: canary-release
    name: Canary Release
    url: https://martinfowler.com/bliki/CanaryRelease.html
  standards:
  - id: iso-22301
    name: ISO 22301 Business Continuity
    relevance: Recovery planning standards
tooling:
  analysis_tools:
  - tool: Velero
    purpose: Kubernetes backup and restore
    command: velero backup create pre-migration-backup
  - tool: pg_dump/pg_restore
    purpose: PostgreSQL backup and restore
    command: pg_dump -Fc dbname > backup.dump
  - tool: AWS Backup
    purpose: Cloud infrastructure backup
  - tool: Terraform
    purpose: Infrastructure state management
    command: terraform plan
signals:
  critical:
  - id: RBP-CRIT-001
    signal: No rollback procedure exists for migration
    evidence_indicators:
    - Migration is one-way with no return path
    - Data changes are irreversible
    - No backup of pre-migration state
    explanation: |
      Without rollback capability, migration failures require forward-fixes
      under pressure, significantly increasing business risk.
    remediation: Design and implement rollback procedure before proceeding
  - id: RBP-CRIT-002
    signal: Rollback procedure not tested
    evidence_indicators:
    - Procedure exists only on paper
    - Never executed in any environment
    - Assumes capabilities without verification
    explanation: |
      Untested rollback procedures frequently fail when needed most.
      Production is not the place to discover rollback issues.
    remediation: Execute rollback procedure in non-production environment
  high:
  - id: RBP-HIGH-001
    signal: Rollback time exceeds acceptable downtime
    remediation: Optimize rollback procedure or increase acceptable window
  - id: RBP-HIGH-002
    signal: Data loss during rollback exceeds RPO
    remediation: Implement more frequent backup points or change strategy
  - id: RBP-HIGH-003
    signal: Rollback requires unavailable skills
    remediation: Train team or ensure experts available during migration
  medium:
  - id: RBP-MED-001
    signal: Rollback procedure documentation incomplete
    remediation: Complete documentation with step-by-step instructions
  - id: RBP-MED-002
    signal: Dependencies between rollback components unclear
    remediation: Map rollback sequence dependencies
  low:
  - id: RBP-LOW-001
    signal: Minor automation gaps in rollback
    remediation: Automate manual steps where feasible
  - id: RBP-LOW-002
    signal: Communication plan for rollback not detailed
    remediation: Develop stakeholder communication procedures
  positive:
  - id: RBP-POS-001
    signal: Rollback procedure tested and validated
  - id: RBP-POS-002
    signal: Automated rollback with defined triggers
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Rollback Procedures
    description: Examine existing rollback documentation
    duration_estimate: 1 hour
  - id: '2'
    name: Validate Backup Strategy
    description: Confirm pre-migration backups are comprehensive
    duration_estimate: 1 hour
  - id: '3'
    name: Assess Restoration Time
    description: Calculate rollback time and compare to requirements
    duration_estimate: 1 hour
  - id: '4'
    name: Identify Data Dependencies
    description: Map data that must be rolled back together
    duration_estimate: 1 hour
  - id: '5'
    name: Verify Testing Status
    description: Confirm rollback has been tested
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Gaps
    description: Identify and document rollback gaps
    duration_estimate: 1 hour
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Rollback Procedure Review
    - Time and Data Analysis
    - Testing Status
    - Gap Analysis
    - Recommendations
closeout_checklist:
- id: rbp-001
  item: Rollback procedures reviewed
  level: WARNING
  verification: manual
- id: rbp-002
  item: Rollback time validated against requirements
  level: WARNING
  verification: manual
- id: rbp-003
  item: Testing status confirmed
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - any-migration
    - production-systems
    - business-critical-systems
  compliance_mappings:
  - framework: ISO 22301
    control: Business Continuity
    description: Recovery procedures
  - framework: SOC 2
    control: CC7.5
    description: Recovery from identified incidents
relationships:
  commonly_combined:
  - operations.disaster-recovery
  - legacy-migration.migration-planning.incremental-migration-strategy
  depends_on:
  - operations.backup-strategy
  feeds_into:
  - legacy-migration.migration-planning.migration-readiness
  - risk-management.migration-risk-assessment
