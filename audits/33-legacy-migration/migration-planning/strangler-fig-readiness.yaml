# ============================================================
# AUDIT: Strangler Fig Readiness Assessment
# Category: 33 - Legacy & Migration
# Subcategory: migration-planning
# ============================================================

audit:
  id: "legacy-migration.migration-planning.strangler-fig-readiness"
  name: "Strangler Fig Readiness Assessment Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "legacy-migration"
  category_number: 33
  subcategory: "migration-planning"

  tier: "expert"
  estimated_duration: "6-10 hours"  # median: 8h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "system"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates whether a legacy system is suitable for the Strangler Fig migration
    pattern, which involves incrementally replacing functionality while both old
    and new systems run in parallel. This audit assesses the feasibility of
    routing traffic between systems, identifying boundaries for extraction, and
    determining whether the system architecture supports gradual migration.

  why_it_matters: |
    The Strangler Fig pattern reduces migration risk by allowing incremental
    replacement rather than big-bang cutover. However, not all systems are
    suitable - they need clear seams for extraction and the ability to route
    requests between old and new implementations. Understanding readiness
    prevents failed migration attempts.

  when_to_run:
    - "When planning migration strategy"
    - "Before committing to migration approach"
    - "When evaluating modernization options"
    - "During technical due diligence"

prerequisites:
  required_artifacts:
    - type: "architecture_documentation"
      description: "System architecture and component diagrams"
    - type: "source_code"
      description: "Complete legacy system codebase"
    - type: "api_documentation"
      description: "API endpoints and contracts"

  access_requirements:
    - "Read access to source code"
    - "Architecture documentation"
    - "Network topology information"
    - "Request routing capabilities"

discovery:
  file_patterns:
    - glob: "**/routes*.{js,ts,py,java,rb}"
      purpose: "Find routing configurations"
    - glob: "**/controller*"
      purpose: "Find controller/handler patterns"
    - glob: "**/gateway*"
      purpose: "Find API gateway configurations"
    - glob: "**/nginx*.conf"
      purpose: "Find reverse proxy configurations"

  interview_questions:
    - role: "Software Architect"
      questions:
        - "Can you identify clear functional boundaries in the system?"
        - "Is there an API gateway or facade in front of the system?"
        - "Can traffic be routed based on request attributes?"
    - role: "Tech Lead"
      questions:
        - "Which components have the least coupling to others?"
        - "Are there natural seams in the codebase?"
        - "Can features be disabled or redirected independently?"

knowledge_sources:
  guides:
    - id: "strangler-fig"
      name: "Strangler Fig Application"
      url: "https://martinfowler.com/bliki/StranglerFigApplication.html"
    - id: "branch-by-abstraction"
      name: "Branch by Abstraction"
      url: "https://martinfowler.com/bliki/BranchByAbstraction.html"

  standards:
    - id: "evolutionary-architecture"
      name: "Building Evolutionary Architectures"
      relevance: "Patterns for system evolution"

tooling:
  analysis_tools:
    - tool: "Structure101"
      purpose: "Dependency and coupling analysis"
    - tool: "Sonargraph"
      purpose: "Architecture dependency mapping"
    - tool: "code-maat"
      purpose: "Change coupling analysis"
      command: "maat -l git.log -c git -a coupling"
    - tool: "ndepend"
      purpose: ".NET dependency analysis"

signals:
  critical:
    - id: "SFR-CRIT-001"
      signal: "No clear boundaries exist for incremental extraction"
      evidence_indicators:
        - "Monolithic architecture with global state"
        - "High coupling between all components"
        - "No API or service boundaries"
      explanation: |
        Without clear boundaries, extracting functionality incrementally
        is extremely difficult. The system may require different migration
        approaches such as parallel development or complete rewrite.
      remediation: "Consider alternative migration strategies or boundary creation first"

    - id: "SFR-CRIT-002"
      signal: "Shared database prevents service separation"
      evidence_indicators:
        - "All components share single database schema"
        - "Cross-component joins in queries"
        - "No data ownership boundaries"
      explanation: |
        Shared database coupling makes it extremely difficult to extract
        services independently. Data migration becomes intertwined with
        code migration.
      remediation: "Plan database decomposition as prerequisite"

  high:
    - id: "SFR-HIGH-001"
      signal: "No routing layer exists to direct traffic"
      remediation: "Implement API gateway or reverse proxy as first step"

    - id: "SFR-HIGH-002"
      signal: "Synchronous coupling requires both systems available"
      remediation: "Consider async patterns to enable independent operation"

    - id: "SFR-HIGH-003"
      signal: "Session state shared between components"
      remediation: "Externalize session state before extraction"

  medium:
    - id: "SFR-MED-001"
      signal: "Some boundaries clear but others tightly coupled"
      remediation: "Prioritize well-bounded components for initial extraction"

    - id: "SFR-MED-002"
      signal: "Testing strategy doesn't support parallel operation"
      remediation: "Develop testing strategy for dual-system operation"

  low:
    - id: "SFR-LOW-001"
      signal: "Minor refactoring needed to enable routing"
      remediation: "Address as part of migration preparation"

    - id: "SFR-LOW-002"
      signal: "Documentation of boundaries incomplete"
      remediation: "Document boundaries before migration begins"

  positive:
    - id: "SFR-POS-001"
      signal: "Clear service boundaries with defined interfaces"

    - id: "SFR-POS-002"
      signal: "Existing API gateway enables traffic routing"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Analyze Architecture"
      description: "Review architecture for component boundaries and interfaces"
      duration_estimate: "2 hours"

    - id: "2"
      name: "Map Dependencies"
      description: "Identify coupling and dependencies between components"
      duration_estimate: "2 hours"

    - id: "3"
      name: "Assess Routing Capability"
      description: "Evaluate ability to route traffic between implementations"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Identify Extraction Candidates"
      description: "Find components suitable for early extraction"
      duration_estimate: "2 hours"

    - id: "5"
      name: "Evaluate Data Boundaries"
      description: "Assess data ownership and database coupling"
      duration_estimate: "2 hours"

    - id: "6"
      name: "Determine Feasibility"
      description: "Make readiness determination with recommendations"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Architecture Analysis"
        - "Boundary Assessment"
        - "Routing Feasibility"
        - "Extraction Priority"
        - "Readiness Determination"

closeout_checklist:
  - id: "sfr-001"
    item: "Component boundaries analyzed"
    level: "WARNING"
    verification: "manual"
  - id: "sfr-002"
    item: "Routing feasibility assessed"
    level: "WARNING"
    verification: "manual"
  - id: "sfr-003"
    item: "Readiness recommendation provided"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["monolithic-systems", "legacy-modernization", "incremental-migration"]

  compliance_mappings:
    - framework: "ISO 27001"
      control: "A.14.2.2"
      description: "System change control procedures"

relationships:
  commonly_combined:
    - "architecture-design.dependency-analysis"
    - "legacy-migration.legacy-system-analysis.integration-mapping"
  depends_on:
    - "legacy-migration.legacy-system-analysis.documentation-gaps"
  feeds_into:
    - "legacy-migration.migration-planning.incremental-migration-strategy"
    - "legacy-migration.migration-planning.roadmap-development"
