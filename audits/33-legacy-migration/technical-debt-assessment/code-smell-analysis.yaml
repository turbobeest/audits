audit:
  id: legacy-migration.technical-debt-assessment.code-smell-analysis
  name: Code Smell Analysis Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: legacy-migration
  category_number: 33
  subcategory: technical-debt-assessment
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: medium
  scope: codebase
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Identifies and categorizes code smells throughout the codebase using automated
    static analysis tools. This audit detects common patterns that indicate poor
    code quality such as long methods, large classes, duplicated code, feature envy,
    data clumps, and inappropriate intimacy between modules. Results are catalogued
    by type, severity, and location.
  why_it_matters: |
    Code smells are early indicators of deeper structural problems. While not bugs
    themselves, they make the codebase harder to understand, modify, and test.
    Identifying code smells early prevents them from compounding into larger
    architectural issues and helps maintain developer productivity.
  when_to_run:
  - During code review audits
  - Before major refactoring efforts
  - As part of technical debt assessments
  - When onboarding reveals comprehension issues
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete source code access
  - type: build_configuration
    description: Build files to understand project structure
  access_requirements:
  - Read access to source repositories
  - Ability to run static analysis tools
discovery:
  file_patterns:
  - glob: '**/*.{java,cs,py,js,ts,rb,go,cpp,c}'
    purpose: Find all source code files
  - glob: '**/.eslintrc*'
    purpose: Identify existing linting configurations
  - glob: '**/pylintrc'
    purpose: Find Python linting configuration
  interview_questions:
  - role: Senior Developer
    questions:
    - Which parts of the codebase are hardest to work with?
    - Are there any 'god classes' or overly complex methods?
    - Where do you see the most duplication?
knowledge_sources:
  guides:
  - id: refactoring-catalog
    name: Refactoring.Guru Smell Catalog
    url: https://refactoring.guru/refactoring/smells
  - id: fowler-refactoring
    name: Refactoring by Martin Fowler
    url: https://martinfowler.com/books/refactoring.html
  standards:
  - id: clean-code
    name: Clean Code Principles
    relevance: Foundational code quality standards
tooling:
  analysis_tools:
  - tool: SonarQube
    purpose: Comprehensive code smell detection
    command: sonar-scanner
  - tool: PMD
    purpose: Java code smell analysis
    command: pmd -d src -R rulesets/java/quickstart.xml -f text
  - tool: ESLint
    purpose: JavaScript/TypeScript smell detection
    command: eslint . --format json
  - tool: Pylint
    purpose: Python code quality analysis
    command: pylint --output-format=json src/
  - tool: RuboCop
    purpose: Ruby code smell detection
    command: rubocop --format json
signals:
  critical:
  - id: CSA-CRIT-001
    signal: God class detected with over 50 methods or 2000 lines
    evidence_indicators:
    - Single class handling multiple unrelated responsibilities
    - Excessive coupling to other classes
    - Frequent modification in unrelated features
    explanation: |
      God classes violate the Single Responsibility Principle and become
      maintenance nightmares. They are difficult to test, understand, and
      modify without unintended side effects.
    remediation: Break down into smaller, focused classes using Extract Class refactoring
  - id: CSA-CRIT-002
    signal: Duplicate code blocks exceeding 100 lines
    evidence_indicators:
    - Copy-pasted code segments across multiple files
    - Similar logic with minor variations
    explanation: |
      Large-scale duplication multiplies bug potential and maintenance effort.
      Changes must be made in multiple places, increasing risk of inconsistency.
    remediation: Extract common logic into shared methods or modules
  high:
  - id: CSA-HIGH-001
    signal: Methods exceeding 100 lines of code
    remediation: Extract smaller methods with clear single responsibilities
  - id: CSA-HIGH-002
    signal: Feature envy pattern detected across multiple classes
    remediation: Move methods to classes whose data they use most
  - id: CSA-HIGH-003
    signal: Deep inheritance hierarchies (>5 levels)
    remediation: Favor composition over inheritance
  medium:
  - id: CSA-MED-001
    signal: Long parameter lists (>5 parameters)
    remediation: Introduce parameter objects or builder patterns
  - id: CSA-MED-002
    signal: Switch statements duplicated across codebase
    remediation: Replace with polymorphism or strategy pattern
  - id: CSA-MED-003
    signal: Data clumps appearing in multiple locations
    remediation: Extract data clumps into dedicated classes
  low:
  - id: CSA-LOW-001
    signal: Minor naming convention violations
    remediation: Apply consistent naming during next modification
  - id: CSA-LOW-002
    signal: Comments explaining complex code instead of refactoring
    remediation: Refactor to make code self-documenting
  positive:
  - id: CSA-POS-001
    signal: Code smell density below industry average
  - id: CSA-POS-002
    signal: Active refactoring reducing smell count over time
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Configure Static Analysis
    description: Set up smell detection tools with appropriate rulesets
    duration_estimate: 30 minutes
  - id: '2'
    name: Run Automated Detection
    description: Execute static analysis tools across the codebase
    duration_estimate: 1 hour
  - id: '3'
    name: Categorize Findings
    description: Group smells by type and severity
    duration_estimate: 1 hour
  - id: '4'
    name: Identify Hotspots
    description: Map smell concentrations to specific files and modules
    duration_estimate: 1 hour
  - id: '5'
    name: Prioritize Remediation
    description: Rank smells by business impact and fix difficulty
    duration_estimate: 1 hour
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Smell Inventory by Type
    - Hotspot Analysis
    - Prioritized Remediation Plan
closeout_checklist:
- id: csa-001
  item: All major source files analyzed
  level: WARNING
  verification: tool_output
- id: csa-002
  item: Smell categories documented with counts
  level: WARNING
  verification: manual
- id: csa-003
  item: Top refactoring priorities identified
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - any-codebase
    - legacy-systems
    - growing-projects
  compliance_mappings:
  - framework: ISO 25010
    control: Maintainability
    description: Code quality characteristics
relationships:
  commonly_combined:
  - code-quality.complexity-metrics
  - legacy-migration.technical-debt-assessment.debt-quantification
  depends_on:
  - code-quality.static-analysis
  feeds_into:
  - legacy-migration.code-modernization.refactoring-strategy
