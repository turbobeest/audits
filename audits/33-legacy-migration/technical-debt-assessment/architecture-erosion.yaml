# ============================================================
# AUDIT: Architecture Erosion Assessment
# Category: 33 - Legacy & Migration
# Subcategory: technical-debt-assessment
# ============================================================

audit:
  id: "legacy-migration.technical-debt-assessment.architecture-erosion"
  name: "Architecture Erosion Assessment Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "legacy-migration"
  category_number: 33
  subcategory: "technical-debt-assessment"

  tier: "expert"
  estimated_duration: "8-12 hours"  # median: 10h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "system"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the gap between intended architecture and actual implementation,
    identifying where architectural principles have been violated over time.
    This audit analyzes dependency violations, layering breaches, component
    coupling drift, and patterns that have diverged from original design intent.
    It quantifies how much the system has drifted from its architectural blueprint.

  why_it_matters: |
    Architecture erosion makes systems increasingly difficult to modify, test,
    and reason about. As shortcuts accumulate, the original architectural benefits
    are lost. Understanding erosion levels helps prioritize architectural refactoring
    and prevent further degradation before the system becomes unmaintainable.

  when_to_run:
    - "During architecture review cycles"
    - "Before major system changes"
    - "When onboarding reveals architectural confusion"
    - "As part of technical due diligence"

prerequisites:
  required_artifacts:
    - type: "architecture_documentation"
      description: "Original architectural designs and diagrams"
    - type: "source_code"
      description: "Complete codebase access"
    - type: "dependency_rules"
      description: "Intended module dependency constraints"

  access_requirements:
    - "Read access to source repositories"
    - "Access to architecture documentation"
    - "Original design decision records"

discovery:
  file_patterns:
    - glob: "**/ARCHITECTURE.md"
      purpose: "Find architecture documentation"
    - glob: "**/.arch-rules*"
      purpose: "Find architecture rule configurations"
    - glob: "**/archunit*.java"
      purpose: "Find ArchUnit test configurations"

  interview_questions:
    - role: "Software Architect"
      questions:
        - "What were the original architectural principles?"
        - "Where do you see the biggest deviations from intended design?"
        - "What constraints are commonly violated?"
    - role: "Senior Developer"
      questions:
        - "Are there 'forbidden' dependencies that exist anyway?"
        - "Which modules have unclear responsibilities?"
        - "Where has workaround code accumulated?"

knowledge_sources:
  guides:
    - id: "fitness-functions"
      name: "Building Evolutionary Architectures - Fitness Functions"
      url: "https://www.thoughtworks.com/insights/articles/fitness-function-driven-development"
    - id: "archunit"
      name: "ArchUnit Documentation"
      url: "https://www.archunit.org/userguide/html/000_Index.html"

  standards:
    - id: "iso-42010"
      name: "ISO/IEC 42010 Architecture Description"
      relevance: "Architecture documentation standards"

tooling:
  analysis_tools:
    - tool: "Structure101"
      purpose: "Architecture visualization and analysis"
    - tool: "ArchUnit"
      purpose: "Architecture rule enforcement for Java"
      command: "mvn test -Dtest=*ArchitectureTest"
    - tool: "ndepend"
      purpose: ".NET architecture analysis"
    - tool: "Sonargraph"
      purpose: "Architecture and dependency analysis"
    - tool: "JDepend"
      purpose: "Java package dependency analysis"
      command: "jdepend build/classes"
    - tool: "deptrac"
      purpose: "PHP architecture layer enforcement"
      command: "deptrac analyze"

signals:
  critical:
    - id: "AEA-CRIT-001"
      signal: "Core architectural layers violated in >20% of modules"
      evidence_indicators:
        - "Widespread bypassing of abstraction layers"
        - "Domain logic in presentation layer"
        - "Infrastructure code in domain layer"
      explanation: |
        Extensive layer violations indicate architectural integrity has collapsed.
        The benefits of the original architecture are no longer being realized
        and the codebase has become a tangled dependency graph.
      remediation: "Plan systematic architectural recovery project"

    - id: "AEA-CRIT-002"
      signal: "Circular dependencies between major components"
      evidence_indicators:
        - "Module A depends on B depends on C depends on A"
        - "Cannot deploy or test components independently"
      explanation: |
        Circular dependencies create tight coupling that prevents independent
        development, testing, and deployment of components.
      remediation: "Break cycles through dependency inversion or interface extraction"

  high:
    - id: "AEA-HIGH-001"
      signal: "Dependency rules violated in multiple modules"
      remediation: "Enforce architecture rules through automated tests"

    - id: "AEA-HIGH-002"
      signal: "Component boundaries unclear or inconsistent"
      remediation: "Clarify and document component responsibilities"

    - id: "AEA-HIGH-003"
      signal: "Shared mutable state between architectural boundaries"
      remediation: "Encapsulate state and define clear interfaces"

  medium:
    - id: "AEA-MED-001"
      signal: "Isolated layer violations in non-critical areas"
      remediation: "Refactor during maintenance of affected areas"

    - id: "AEA-MED-002"
      signal: "Architecture documentation outdated"
      remediation: "Update documentation to reflect current state"

  low:
    - id: "AEA-LOW-001"
      signal: "Minor style inconsistencies across modules"
      remediation: "Address through code review standards"

    - id: "AEA-LOW-002"
      signal: "Some components slightly over their intended scope"
      remediation: "Plan scope refinement in future iterations"

  positive:
    - id: "AEA-POS-001"
      signal: "Architecture rules enforced through automated tests"

    - id: "AEA-POS-002"
      signal: "Actual implementation matches documented architecture"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Document Intended Architecture"
      description: "Review and understand original architectural design"
      duration_estimate: "2 hours"

    - id: "2"
      name: "Extract Actual Structure"
      description: "Use tools to map current dependency and layering"
      duration_estimate: "2 hours"

    - id: "3"
      name: "Compare Against Rules"
      description: "Identify violations of architectural constraints"
      duration_estimate: "2 hours"

    - id: "4"
      name: "Analyze Erosion Patterns"
      description: "Understand how and why erosion occurred"
      duration_estimate: "2 hours"

    - id: "5"
      name: "Quantify Gap"
      description: "Measure the extent of architectural drift"
      duration_estimate: "1 hour"

    - id: "6"
      name: "Plan Recovery"
      description: "Develop roadmap to restore architectural integrity"
      duration_estimate: "2 hours"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Intended vs Actual Architecture"
        - "Violation Analysis"
        - "Erosion Timeline"
        - "Impact Assessment"
        - "Recovery Roadmap"

closeout_checklist:
  - id: "aea-001"
    item: "Intended architecture documented"
    level: "WARNING"
    verification: "manual"
  - id: "aea-002"
    item: "All violations catalogued"
    level: "WARNING"
    verification: "tool_output"
  - id: "aea-003"
    item: "Recovery plan with priorities created"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["enterprise-systems", "long-lived-projects", "multi-team-development"]

  compliance_mappings:
    - framework: "TOGAF"
      control: "Architecture Governance"
      description: "Architecture compliance management"
    - framework: "ISO 42010"
      control: "Architecture Description"
      description: "Architecture documentation standards"

relationships:
  commonly_combined:
    - "architecture-design.dependency-analysis"
    - "code-quality.coupling-cohesion"
  depends_on:
    - "architecture-design.current-state-documentation"
  feeds_into:
    - "legacy-migration.code-modernization.architectural-refactoring"
    - "legacy-migration.migration-planning.modernization-strategy"
