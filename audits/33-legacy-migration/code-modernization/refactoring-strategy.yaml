# ============================================================
# AUDIT: Refactoring Strategy Assessment
# Category: 33 - Legacy & Migration
# Subcategory: code-modernization
# ============================================================

audit:
  id: "legacy-migration.code-modernization.refactoring-strategy"
  name: "Refactoring Strategy Assessment Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "legacy-migration"
  category_number: 33
  subcategory: "code-modernization"

  tier: "expert"
  estimated_duration: "6-10 hours"  # median: 8h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Develops and validates a refactoring strategy for modernizing legacy code
    including prioritization criteria, refactoring patterns to apply, risk
    mitigation approaches, and incremental delivery plans. This audit ensures
    refactoring efforts are focused, safe, and deliver measurable value.

  why_it_matters: |
    Undirected refactoring wastes effort and can introduce bugs. A well-planned
    refactoring strategy ensures the highest-impact areas are addressed first,
    changes are made safely with adequate testing, and progress can be measured.
    Strategic refactoring pays down technical debt systematically.

  when_to_run:
    - "Before major refactoring initiatives"
    - "During technical debt reduction planning"
    - "When modernization begins"
    - "During annual technical planning"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Legacy codebase to be refactored"
    - type: "technical_debt_assessment"
      description: "Technical debt analysis results"
    - type: "test_coverage"
      description: "Current test coverage data"

  access_requirements:
    - "Read access to source code"
    - "Technical debt documentation"
    - "Test coverage reports"
    - "Team capacity information"

discovery:
  file_patterns:
    - glob: "**/*.{java,cs,py,js,ts,rb,go}"
      purpose: "Find source code"
    - glob: "**/refactor*"
      purpose: "Find existing refactoring plans"
    - glob: "**/TODO*"
      purpose: "Find technical debt markers"

  interview_questions:
    - role: "Tech Lead"
      questions:
        - "What areas are highest priority for refactoring?"
        - "What constraints exist on refactoring?"
        - "How will refactoring be validated?"
    - role: "Software Architect"
      questions:
        - "What patterns should be applied?"
        - "What is the target architecture?"
        - "How do you balance refactoring with features?"

knowledge_sources:
  guides:
    - id: "refactoring-book"
      name: "Refactoring by Martin Fowler"
      url: "https://refactoring.com/"
    - id: "working-with-legacy"
      name: "Working Effectively with Legacy Code"
      url: "https://www.oreilly.com/library/view/working-effectively-with/0131177052/"

  standards:
    - id: "clean-code"
      name: "Clean Code Principles"
      relevance: "Code quality standards"

tooling:
  analysis_tools:
    - tool: "SonarQube"
      purpose: "Code quality and refactoring opportunities"
    - tool: "IntelliJ IDEA"
      purpose: "Automated refactoring"
    - tool: "JetBrains Resharper"
      purpose: ".NET refactoring"
    - tool: "CodeScene"
      purpose: "Prioritize refactoring by hotspots"

signals:
  critical:
    - id: "RSA-CRIT-001"
      signal: "Refactoring planned without test coverage"
      evidence_indicators:
        - "Target code has <50% test coverage"
        - "No characterization tests planned"
        - "No regression testing strategy"
      explanation: |
        Refactoring without test coverage is extremely risky and likely
        to introduce bugs that go undetected until production.
      remediation: "Add tests before refactoring or reduce scope"

    - id: "RSA-CRIT-002"
      signal: "No clear refactoring priorities"
      evidence_indicators:
        - "Refactoring planned without analysis"
        - "No criteria for what to refactor"
        - "Ad-hoc refactoring approach"
      explanation: |
        Undirected refactoring wastes effort on low-impact areas while
        high-impact technical debt remains.
      remediation: "Establish prioritization criteria based on impact"

  high:
    - id: "RSA-HIGH-001"
      signal: "Refactoring scope too large for delivery"
      remediation: "Break into incremental, deliverable chunks"

    - id: "RSA-HIGH-002"
      signal: "No rollback strategy for refactoring"
      remediation: "Establish refactoring reversal approach"

    - id: "RSA-HIGH-003"
      signal: "Business functionality not understood"
      remediation: "Document behavior before refactoring"

  medium:
    - id: "RSA-MED-001"
      signal: "Refactoring patterns not standardized"
      remediation: "Establish refactoring playbook"

    - id: "RSA-MED-002"
      signal: "Progress metrics not defined"
      remediation: "Define measurable success criteria"

  low:
    - id: "RSA-LOW-001"
      signal: "Documentation plan incomplete"
      remediation: "Plan documentation updates"

    - id: "RSA-LOW-002"
      signal: "Team training on patterns needed"
      remediation: "Provide refactoring training"

  positive:
    - id: "RSA-POS-001"
      signal: "Clear prioritized refactoring plan"

    - id: "RSA-POS-002"
      signal: "Strong test coverage enables safe refactoring"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Assess Current State"
      description: "Review technical debt and code quality data"
      duration_estimate: "2 hours"

    - id: "2"
      name: "Define Priorities"
      description: "Establish refactoring prioritization criteria"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Identify Patterns"
      description: "Determine applicable refactoring patterns"
      duration_estimate: "2 hours"

    - id: "4"
      name: "Assess Test Coverage"
      description: "Evaluate safety net for refactoring"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Create Incremental Plan"
      description: "Break refactoring into deliverable phases"
      duration_estimate: "2 hours"

    - id: "6"
      name: "Define Success Metrics"
      description: "Establish measurable outcomes"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Current State Assessment"
        - "Prioritization Framework"
        - "Refactoring Patterns"
        - "Incremental Plan"
        - "Success Metrics"

closeout_checklist:
  - id: "rsa-001"
    item: "Refactoring priorities established"
    level: "WARNING"
    verification: "manual"
  - id: "rsa-002"
    item: "Test coverage assessed"
    level: "WARNING"
    verification: "tool_output"
  - id: "rsa-003"
    item: "Incremental plan created"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["legacy-codebases", "technical-debt-reduction"]

  compliance_mappings:
    - framework: "ISO 25010"
      control: "Maintainability"
      description: "Code modifiability"

relationships:
  commonly_combined:
    - "legacy-migration.technical-debt-assessment.debt-quantification"
    - "code-quality.test-coverage"
  depends_on:
    - "legacy-migration.technical-debt-assessment.code-smell-analysis"
  feeds_into:
    - "legacy-migration.code-modernization.incremental-refactoring"
    - "project-management.sprint-planning"
