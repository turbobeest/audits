audit:
  id: legacy-migration.code-modernization.testability-improvement
  name: Testability Improvement Assessment Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: legacy-migration
  category_number: 33
  subcategory: code-modernization
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: codebase
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the testability of legacy code and identifies improvements needed
    to enable effective automated testing. This audit examines dependency
    management, coupling, interface design, and state management to determine
    what refactoring is needed to make code testable.
  why_it_matters: |
    Untestable code cannot be safely refactored or modified. Improving testability
    is often a prerequisite for other modernization efforts. Without tests, changes
    carry high risk of introducing regressions. Testability improvements enable
    confident evolution of the codebase.
  when_to_run:
  - Before refactoring initiatives
  - When test coverage is low
  - During modernization planning
  - When bugs indicate testing gaps
prerequisites:
  required_artifacts:
  - type: source_code
    description: Legacy codebase
  - type: test_coverage
    description: Current test coverage data
  - type: existing_tests
    description: Current test suite
  access_requirements:
  - Read access to source code
  - Test execution environment
  - Coverage reporting tools
discovery:
  file_patterns:
  - glob: '**/*test*.{py,js,ts,java,cs,rb}'
    purpose: Find existing tests
  - glob: '**/coverage/**'
    purpose: Find coverage reports
  - glob: '**/__mocks__/**'
    purpose: Find mocking infrastructure
  interview_questions:
  - role: Developer
    questions:
    - What makes this code hard to test?
    - What would make testing easier?
    - What dependencies are problematic?
  - role: QA Engineer
    questions:
    - What areas have the least coverage?
    - What tests are most brittle?
    - What manual testing would you like automated?
knowledge_sources:
  guides:
  - id: working-with-legacy
    name: Working Effectively with Legacy Code
    url: https://www.oreilly.com/library/view/working-effectively-with/0131177052/
  - id: tdd
    name: Test-Driven Development
    url: https://martinfowler.com/bliki/TestDrivenDevelopment.html
  standards:
  - id: istqb
    name: ISTQB Testing Standards
    relevance: Software testing best practices
tooling:
  analysis_tools:
  - tool: JaCoCo
    purpose: Java code coverage
  - tool: Istanbul/nyc
    purpose: JavaScript coverage
    command: nyc npm test
  - tool: SonarQube
    purpose: Testability metrics
  - tool: pytest-cov
    purpose: Python coverage
    command: pytest --cov=src
  - tool: Coverlet
    purpose: .NET coverage
signals:
  critical:
  - id: TIA-CRIT-001
    signal: Critical code cannot be unit tested
    evidence_indicators:
    - Direct database access in business logic
    - Global state dependencies
    - Tightly coupled to external services
    explanation: |
      Critical code that cannot be unit tested poses significant risk
      during any modification and requires expensive manual testing.
    remediation: Prioritize seam introduction for testability
  - id: TIA-CRIT-002
    signal: No way to mock dependencies
    evidence_indicators:
    - Concrete class instantiation inside methods
    - Static method dependencies
    - No interface abstractions
    explanation: |
      Without ability to mock dependencies, unit testing is impossible
      and all tests become integration tests.
    remediation: Introduce dependency injection and interfaces
  high:
  - id: TIA-HIGH-001
    signal: Constructor does too much work
    remediation: Move work to initialization methods
  - id: TIA-HIGH-002
    signal: Methods have side effects preventing isolation
    remediation: Separate side effects from pure logic
  - id: TIA-HIGH-003
    signal: Complex setup required for any test
    remediation: Improve test infrastructure and factories
  medium:
  - id: TIA-MED-001
    signal: Test doubles difficult to create
    remediation: Introduce simpler interfaces
  - id: TIA-MED-002
    signal: Private methods contain significant logic
    remediation: Extract to testable collaborators
  low:
  - id: TIA-LOW-001
    signal: Minor testability improvements possible
    remediation: Address during related refactoring
  - id: TIA-LOW-002
    signal: Test utilities could be improved
    remediation: Enhance test infrastructure
  positive:
  - id: TIA-POS-001
    signal: Code designed for testability
  - id: TIA-POS-002
    signal: Dependency injection widely used
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Analyze Coverage Gaps
    description: Identify low-coverage areas
    duration_estimate: 1 hour
  - id: '2'
    name: Examine Dependency Structure
    description: Analyze coupling and dependencies
    duration_estimate: 1 hour
  - id: '3'
    name: Identify Testing Barriers
    description: Catalog testability obstacles
    duration_estimate: 1 hour
  - id: '4'
    name: Propose Seam Points
    description: Identify where seams can be introduced
    duration_estimate: 1 hour
  - id: '5'
    name: Prioritize Improvements
    description: Rank testability improvements
    duration_estimate: 30 minutes
  - id: '6'
    name: Create Plan
    description: Document testability improvement plan
    duration_estimate: 1 hour
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Coverage Analysis
    - Testability Barriers
    - Seam Points
    - Improvement Plan
closeout_checklist:
- id: tia-001
  item: Testability barriers identified
  level: WARNING
  verification: manual
- id: tia-002
  item: Seam points documented
  level: WARNING
  verification: manual
- id: tia-003
  item: Improvement priority established
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - legacy-codebases
    - low-test-coverage-systems
  compliance_mappings:
  - framework: ISO 25010
    control: Testability
    description: Software testability characteristics
relationships:
  commonly_combined:
  - legacy-migration.technical-debt-assessment.test-debt
  - legacy-migration.code-modernization.refactoring-strategy
  depends_on:
  - code-quality.test-coverage
  feeds_into:
  - legacy-migration.code-modernization.refactoring-strategy
  - quality-assurance.test-strategy
