# ============================================================
# AUDIT: Data Synchronization Assessment
# Category: 33 - Legacy & Migration
# Subcategory: data-migration
# ============================================================

audit:
  id: "legacy-migration.data-migration.data-synchronization"
  name: "Data Synchronization Assessment Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "legacy-migration"
  category_number: 33
  subcategory: "data-migration"

  tier: "expert"
  estimated_duration: "6-10 hours"  # median: 8h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "data"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates data synchronization strategies and mechanisms for keeping source
    and target systems in sync during migration periods. This audit reviews
    change data capture (CDC), replication configurations, conflict resolution
    policies, and synchronization timing to ensure data consistency during
    parallel operation phases.

  why_it_matters: |
    During migration, both source and target systems may need to operate
    simultaneously with consistent data. Poor synchronization leads to data
    divergence, conflicts, and business decisions made on inconsistent data.
    Proper synchronization enables safe parallel operation and rollback.

  when_to_run:
    - "When planning parallel operation"
    - "Before enabling bidirectional sync"
    - "During cutover planning"
    - "When sync issues are detected"

prerequisites:
  required_artifacts:
    - type: "sync_architecture"
      description: "Data synchronization design"
    - type: "cdc_configuration"
      description: "Change data capture configuration"
    - type: "conflict_resolution_rules"
      description: "Conflict resolution policies"

  access_requirements:
    - "Replication system access"
    - "CDC tool access"
    - "Monitoring system access"
    - "Both source and target databases"

discovery:
  file_patterns:
    - glob: "**/replication*"
      purpose: "Find replication configurations"
    - glob: "**/cdc*"
      purpose: "Find CDC configurations"
    - glob: "**/sync*"
      purpose: "Find synchronization code"
    - glob: "**/debezium*"
      purpose: "Find Debezium configurations"

  interview_questions:
    - role: "Data Engineer"
      questions:
        - "How is data kept in sync between systems?"
        - "What is the replication lag?"
        - "How are conflicts resolved?"
    - role: "Database Administrator"
      questions:
        - "What CDC mechanism is used?"
        - "What happens if sync fails?"
        - "How is sync monitored?"

knowledge_sources:
  guides:
    - id: "cdc-patterns"
      name: "Change Data Capture Patterns"
      url: "https://docs.confluent.io/platform/current/connect/debezium-connect-cdc.html"
    - id: "dual-write"
      name: "Dual Write Patterns"
      url: "https://microservices.io/patterns/data/transactional-outbox.html"

  standards:
    - id: "cap-theorem"
      name: "CAP Theorem Considerations"
      relevance: "Distributed data consistency"

tooling:
  analysis_tools:
    - tool: "Debezium"
      purpose: "Change data capture"
    - tool: "AWS DMS"
      purpose: "Database migration and replication"
    - tool: "GoldenGate"
      purpose: "Oracle data replication"
    - tool: "Kafka Connect"
      purpose: "Streaming data integration"
    - tool: "pg_logical"
      purpose: "PostgreSQL logical replication"

signals:
  critical:
    - id: "DSA-CRIT-001"
      signal: "Data synchronization has unacceptable lag"
      evidence_indicators:
        - "Replication lag exceeds SLA"
        - "Business decisions on stale data"
        - "Sync cannot keep up with change volume"
      explanation: |
        Excessive sync lag means systems show different data, leading to
        confusion, errors, and incorrect business decisions.
      remediation: "Optimize sync performance or accept lag implications"

    - id: "DSA-CRIT-002"
      signal: "Conflict resolution undefined or inconsistent"
      evidence_indicators:
        - "No conflict resolution policy"
        - "Conflicts silently override data"
        - "Different resolution in different scenarios"
      explanation: |
        Without consistent conflict resolution, data integrity is compromised
        and the correct state becomes unknowable.
      remediation: "Define and implement consistent conflict resolution"

  high:
    - id: "DSA-HIGH-001"
      signal: "Sync monitoring insufficient"
      remediation: "Implement comprehensive sync monitoring and alerting"

    - id: "DSA-HIGH-002"
      signal: "Recovery from sync failure not tested"
      remediation: "Test and document sync recovery procedures"

    - id: "DSA-HIGH-003"
      signal: "Schema changes break synchronization"
      remediation: "Implement schema evolution strategy for sync"

  medium:
    - id: "DSA-MED-001"
      signal: "Sync performance variable"
      remediation: "Optimize and stabilize sync performance"

    - id: "DSA-MED-002"
      signal: "Sync configuration not version controlled"
      remediation: "Version control sync configurations"

  low:
    - id: "DSA-LOW-001"
      signal: "Minor sync optimizations possible"
      remediation: "Optimize in subsequent iterations"

    - id: "DSA-LOW-002"
      signal: "Sync documentation incomplete"
      remediation: "Complete sync documentation"

  positive:
    - id: "DSA-POS-001"
      signal: "Synchronization reliable with minimal lag"

    - id: "DSA-POS-002"
      signal: "Clear conflict resolution with audit trail"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Sync Architecture"
      description: "Understand synchronization design and flow"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Evaluate CDC Implementation"
      description: "Review change capture mechanism"
      duration_estimate: "2 hours"

    - id: "3"
      name: "Measure Sync Lag"
      description: "Test replication latency under load"
      duration_estimate: "2 hours"

    - id: "4"
      name: "Test Conflict Resolution"
      description: "Verify conflict handling"
      duration_estimate: "2 hours"

    - id: "5"
      name: "Review Monitoring"
      description: "Assess sync monitoring capabilities"
      duration_estimate: "1 hour"

    - id: "6"
      name: "Test Recovery"
      description: "Validate recovery from sync failures"
      duration_estimate: "2 hours"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Sync Architecture Review"
        - "Latency Analysis"
        - "Conflict Resolution Assessment"
        - "Monitoring Evaluation"
        - "Recommendations"

closeout_checklist:
  - id: "dsa-001"
    item: "Sync latency measured and acceptable"
    level: "WARNING"
    verification: "tool_output"
  - id: "dsa-002"
    item: "Conflict resolution verified"
    level: "WARNING"
    verification: "manual"
  - id: "dsa-003"
    item: "Recovery procedures tested"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["parallel-operation-migrations", "zero-downtime-migrations"]

  compliance_mappings:
    - framework: "SOX"
      control: "Data Integrity"
      description: "Data consistency during migration"
    - framework: "ISO 8000"
      control: "Data Quality"
      description: "Data synchronization quality"

relationships:
  commonly_combined:
    - "legacy-migration.data-migration.data-validation"
    - "operations.replication-monitoring"
  depends_on:
    - "legacy-migration.data-migration.schema-compatibility"
  feeds_into:
    - "legacy-migration.migration-planning.rollback-planning"
    - "operations.production-cutover"
