audit:
  id: legacy-migration.api-versioning.deprecation-management
  name: API Deprecation Management Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: legacy-migration
  category_number: 33
  subcategory: api-versioning
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: api
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the processes and implementation for deprecating API versions
    and endpoints including communication practices, deprecation timelines,
    consumer migration support, and sunset execution. This audit ensures
    deprecated APIs are phased out properly without disrupting consumers.
  why_it_matters: |
    Poor deprecation management results in consumer disruption, support burden
    from legacy versions, and security risks from maintaining old code. Proper
    deprecation enables API evolution while giving consumers adequate time and
    support to migrate.
  when_to_run:
  - When planning API deprecation
  - During API portfolio review
  - Before major version releases
  - As part of API governance
prerequisites:
  required_artifacts:
  - type: api_documentation
    description: API specifications with deprecation markers
  - type: consumer_list
    description: List of API consumers
  - type: deprecation_policy
    description: Deprecation policy documentation
  access_requirements:
  - API documentation access
  - Consumer analytics access
  - Communication channel access
discovery:
  file_patterns:
  - glob: '**/openapi*.{yaml,json}'
    purpose: Find API specs with deprecation
  - glob: '**/deprecation*'
    purpose: Find deprecation notices
  - glob: '**/changelog*'
    purpose: Find change announcements
  interview_questions:
  - role: API Product Owner
    questions:
    - How are deprecations communicated to consumers?
    - What is the typical deprecation timeline?
    - How do you track consumer migration progress?
  - role: Developer Relations
    questions:
    - What support is provided during deprecation?
    - How do consumers typically respond to deprecations?
    - What feedback channels exist?
knowledge_sources:
  guides:
  - id: api-deprecation
    name: API Deprecation Best Practices
    url: https://swagger.io/blog/api-development/api-deprecation/
  - id: sunset-header
    name: HTTP Sunset Header
    url: https://datatracker.ietf.org/doc/html/rfc8594
  standards:
  - id: rfc-8594
    name: RFC 8594 The Sunset HTTP Header Field
    relevance: Deprecation communication standard
tooling:
  analysis_tools:
  - tool: API Analytics
    purpose: Track deprecated endpoint usage
  - tool: Swagger UI
    purpose: Display deprecation warnings
  - tool: Postman
    purpose: Document deprecated endpoints
signals:
  critical:
  - id: ADM-CRIT-001
    signal: Deprecated APIs removed without adequate notice
    evidence_indicators:
    - Less than 30 days notice
    - No consumer communication
    - Breaking changes without warning
    explanation: |
      Removing APIs without notice breaks consumer applications and
      damages trust in the API platform.
    remediation: Reinstate API or establish proper deprecation process
  - id: ADM-CRIT-002
    signal: Deprecated APIs with known security vulnerabilities
    evidence_indicators:
    - Security issues in deprecated version
    - Consumers still using vulnerable endpoints
    - No patches planned for deprecated version
    explanation: |
      Security vulnerabilities in deprecated APIs expose consumers and
      the organization to risk.
    remediation: Patch security issues or accelerate migration
  high:
  - id: ADM-HIGH-001
    signal: No deprecation timeline communicated
    remediation: Publish clear deprecation timeline
  - id: ADM-HIGH-002
    signal: High consumer usage of deprecated endpoints
    remediation: Provide migration support and extend timeline if needed
  - id: ADM-HIGH-003
    signal: No migration path documented
    remediation: Document clear migration path to new version
  medium:
  - id: ADM-MED-001
    signal: Deprecation warnings not in API responses
    remediation: Add Sunset header and deprecation indicators
  - id: ADM-MED-002
    signal: Consumer tracking incomplete
    remediation: Implement comprehensive usage analytics
  low:
  - id: ADM-LOW-001
    signal: Documentation of deprecated APIs incomplete
    remediation: Update documentation with deprecation details
  - id: ADM-LOW-002
    signal: Historical deprecation records incomplete
    remediation: Maintain deprecation history
  positive:
  - id: ADM-POS-001
    signal: Clear communication and support for deprecations
  - id: ADM-POS-002
    signal: Consumer migration tracking with high compliance
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Deprecated APIs
    description: List all currently deprecated APIs
    duration_estimate: 1 hour
  - id: '2'
    name: Review Communication
    description: Assess deprecation communication practices
    duration_estimate: 1 hour
  - id: '3'
    name: Analyze Consumer Usage
    description: Check usage of deprecated endpoints
    duration_estimate: 1 hour
  - id: '4'
    name: Evaluate Migration Support
    description: Review migration documentation and support
    duration_estimate: 1 hour
  - id: '5'
    name: Assess Timeline Compliance
    description: Verify deprecation timelines are met
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Create deprecation management report
    duration_estimate: 1 hour
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Deprecated API Inventory
    - Communication Assessment
    - Consumer Migration Status
    - Recommendations
closeout_checklist:
- id: adm-001
  item: All deprecated APIs inventoried
  level: WARNING
  verification: manual
- id: adm-002
  item: Consumer usage analyzed
  level: WARNING
  verification: tool_output
- id: adm-003
  item: Migration support assessed
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - api-providers
    - platform-organizations
  compliance_mappings:
  - framework: API Governance
    control: Lifecycle Management
    description: API deprecation management
relationships:
  commonly_combined:
  - legacy-migration.api-versioning.versioning-strategy
  - legacy-migration.api-versioning.consumer-migration
  depends_on:
  - api-design.api-inventory
  feeds_into:
  - legacy-migration.sunset-decommission.api-retirement
