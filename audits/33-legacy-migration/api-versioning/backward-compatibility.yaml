audit:
  id: legacy-migration.api-versioning.backward-compatibility
  name: API Backward Compatibility Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: legacy-migration
  category_number: 33
  subcategory: api-versioning
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: api
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates whether API changes maintain backward compatibility with existing
    consumers. This audit compares API versions to identify breaking changes,
    validates that non-breaking changes don't affect existing integrations, and
    ensures compatibility testing is adequate.
  why_it_matters: |
    Breaking changes without proper versioning disrupt consumers and damage trust.
    Understanding what constitutes a breaking change and ensuring backward
    compatibility enables API evolution without consumer disruption. Automated
    compatibility checking prevents accidental breaking changes.
  when_to_run:
  - Before API releases
  - During CI/CD pipeline
  - When API changes are proposed
  - During API review
prerequisites:
  required_artifacts:
  - type: api_specifications
    description: Current and previous API specs
  - type: compatibility_tests
    description: Consumer compatibility tests
  - type: change_log
    description: API change documentation
  access_requirements:
  - API specification access
  - Test execution capability
  - Previous version access
discovery:
  file_patterns:
  - glob: '**/openapi*.{yaml,json}'
    purpose: Find OpenAPI specifications
  - glob: '**/api-v*/**'
    purpose: Find versioned API code
  - glob: '**/contract-tests/**'
    purpose: Find contract tests
  interview_questions:
  - role: API Developer
    questions:
    - How do you verify backward compatibility?
    - What tools check for breaking changes?
    - How are compatibility issues discovered?
  - role: QA Engineer
    questions:
    - What compatibility testing exists?
    - How are consumer contracts validated?
    - Are there automated compatibility checks?
knowledge_sources:
  guides:
  - id: breaking-changes
    name: API Breaking Changes Guide
    url: https://developers.google.com/discovery/v1/performance#breaking-changes
  - id: consumer-driven-contracts
    name: Consumer-Driven Contracts
    url: https://martinfowler.com/articles/consumerDrivenContracts.html
  standards:
  - id: openapi-spec
    name: OpenAPI Specification
    relevance: API specification standard
tooling:
  analysis_tools:
  - tool: openapi-diff
    purpose: Detect breaking changes
    command: openapi-diff old-spec.yaml new-spec.yaml
  - tool: Optic
    purpose: API change detection and review
  - tool: Pact
    purpose: Consumer-driven contract testing
    command: pact-verifier --provider-base-url=http://api
  - tool: dredd
    purpose: API testing against spec
    command: dredd openapi.yaml http://api
  - tool: Spectral
    purpose: API linting
    command: spectral lint openapi.yaml
signals:
  critical:
  - id: ABC-CRIT-001
    signal: Breaking changes in production without versioning
    evidence_indicators:
    - Required field removed
    - Response structure changed
    - Endpoint path modified
    explanation: |
      Breaking changes without versioning immediately break all consumers,
      causing outages and integration failures.
    remediation: Revert change or release as new version with migration support
  - id: ABC-CRIT-002
    signal: No compatibility testing before release
    evidence_indicators:
    - No contract tests
    - No breaking change detection
    - Manual compatibility verification only
    explanation: |
      Without automated compatibility testing, breaking changes are not
      caught until they affect production consumers.
    remediation: Implement automated compatibility testing in CI/CD
  high:
  - id: ABC-HIGH-001
    signal: Breaking change detection gaps
    remediation: Implement comprehensive breaking change detection
  - id: ABC-HIGH-002
    signal: Consumer contracts not validated
    remediation: Implement consumer-driven contract testing
  - id: ABC-HIGH-003
    signal: Field type changes without migration
    remediation: Implement graceful type evolution strategy
  medium:
  - id: ABC-MED-001
    signal: Optional field handling inconsistent
    remediation: Standardize optional field behavior
  - id: ABC-MED-002
    signal: Error response format variations
    remediation: Standardize error response format
  low:
  - id: ABC-LOW-001
    signal: Documentation of compatibility policy incomplete
    remediation: Document compatibility guarantees
  - id: ABC-LOW-002
    signal: Minor response additions not announced
    remediation: Improve change communication
  positive:
  - id: ABC-POS-001
    signal: Automated compatibility testing in CI/CD
  - id: ABC-POS-002
    signal: Consumer-driven contracts validated
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Compare API Versions
    description: Identify differences between versions
    duration_estimate: 1 hour
  - id: '2'
    name: Classify Changes
    description: Categorize changes as breaking or non-breaking
    duration_estimate: 1 hour
  - id: '3'
    name: Review Compatibility Tests
    description: Assess existing compatibility test coverage
    duration_estimate: 1 hour
  - id: '4'
    name: Execute Contract Tests
    description: Run consumer contract validation
    duration_estimate: 1 hour
  - id: '5'
    name: Validate CI/CD Integration
    description: Check automated compatibility checking
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Create compatibility assessment report
    duration_estimate: 1 hour
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Breaking Change Analysis
    - Compatibility Test Coverage
    - CI/CD Integration Status
    - Recommendations
closeout_checklist:
- id: abc-001
  item: Breaking changes identified
  level: WARNING
  verification: tool_output
- id: abc-002
  item: Compatibility tests reviewed
  level: WARNING
  verification: manual
- id: abc-003
  item: Automation status assessed
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - api-providers
    - integration-platforms
  compliance_mappings:
  - framework: API Governance
    control: Compatibility
    description: API backward compatibility
relationships:
  commonly_combined:
  - legacy-migration.api-versioning.versioning-strategy
  - legacy-migration.compatibility-testing.contract-testing
  depends_on:
  - api-design.api-documentation
  feeds_into:
  - ci-cd.release-gates
  - quality-assurance.api-testing
