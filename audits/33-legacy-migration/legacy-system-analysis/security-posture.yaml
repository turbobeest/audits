# ============================================================
# AUDIT: Legacy Security Posture Assessment
# Category: 33 - Legacy & Migration
# Subcategory: legacy-system-analysis
# ============================================================

audit:
  id: "legacy-migration.legacy-system-analysis.security-posture"
  name: "Legacy Security Posture Assessment Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "legacy-migration"
  category_number: 33
  subcategory: "legacy-system-analysis"

  tier: "expert"
  estimated_duration: "6-10 hours"  # median: 8h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "system"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the security posture of legacy systems including authentication
    mechanisms, encryption standards, vulnerability exposure, compliance gaps,
    and security debt accumulated over time. This audit identifies security
    risks that must be addressed during migration or require immediate
    compensating controls.

  why_it_matters: |
    Legacy systems often have outdated security controls that don't meet current
    standards. They may use deprecated encryption, weak authentication, or have
    unpatched vulnerabilities. Understanding security posture is critical for
    both maintaining the current system and ensuring the migration improves
    security rather than preserving weaknesses.

  when_to_run:
    - "As part of security assessments"
    - "Before migration planning"
    - "After security incidents"
    - "During compliance audits"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Codebase for security analysis"
    - type: "architecture_documentation"
      description: "Security architecture documentation"
    - type: "vulnerability_scans"
      description: "Recent vulnerability scan results"

  access_requirements:
    - "Security scanning tool access"
    - "Read access to source code"
    - "Network scanning capabilities"
    - "Security configuration review access"

discovery:
  file_patterns:
    - glob: "**/*auth*"
      purpose: "Find authentication related code"
    - glob: "**/*crypto*"
      purpose: "Find cryptography implementations"
    - glob: "**/*.pem"
      purpose: "Find certificate files"
    - glob: "**/security*.{xml,json,yaml}"
      purpose: "Find security configurations"

  interview_questions:
    - role: "Security Engineer"
      questions:
        - "What are the known security gaps in this system?"
        - "What compensating controls are in place?"
        - "Are there any compliance exceptions?"
    - role: "Developer"
      questions:
        - "How is authentication implemented?"
        - "What encryption is used for sensitive data?"
        - "Are there any security practices you know are outdated?"

knowledge_sources:
  guides:
    - id: "owasp-legacy"
      name: "OWASP Legacy Application Security"
      url: "https://owasp.org/www-project-web-security-testing-guide/"
    - id: "nist-csf"
      name: "NIST Cybersecurity Framework"
      url: "https://www.nist.gov/cyberframework"

  standards:
    - id: "cis-benchmarks"
      name: "CIS Security Benchmarks"
      relevance: "Security configuration standards"
    - id: "pci-dss"
      name: "PCI DSS"
      relevance: "Payment security requirements"

tooling:
  analysis_tools:
    - tool: "Nessus"
      purpose: "Vulnerability scanning"
    - tool: "OWASP ZAP"
      purpose: "Web application security testing"
      command: "zap-cli quick-scan -s all http://target"
    - tool: "SonarQube"
      purpose: "Security code analysis"
    - tool: "Snyk"
      purpose: "Dependency vulnerability scanning"
      command: "snyk test"
    - tool: "Trivy"
      purpose: "Container security scanning"
      command: "trivy image target-image:tag"

signals:
  critical:
    - id: "SPA-CRIT-001"
      signal: "System uses deprecated encryption algorithms"
      evidence_indicators:
        - "MD5 or SHA1 for password hashing"
        - "DES or 3DES for encryption"
        - "SSL/TLS versions below 1.2"
      explanation: |
        Deprecated cryptographic algorithms can be broken with modern computing
        power, exposing sensitive data to compromise.
      remediation: "Implement modern cryptographic standards immediately"

    - id: "SPA-CRIT-002"
      signal: "Critical vulnerabilities with known exploits"
      evidence_indicators:
        - "CVSSv3 score 9.0+ vulnerabilities present"
        - "Exploits available in Metasploit or exploit-db"
        - "Active exploitation in the wild"
      explanation: |
        Known exploitable vulnerabilities represent immediate compromise risk.
      remediation: "Patch immediately or implement compensating controls"

    - id: "SPA-CRIT-003"
      signal: "Hardcoded credentials in source code"
      evidence_indicators:
        - "Passwords in configuration files"
        - "API keys in source code"
        - "Database credentials not externalized"
      explanation: |
        Hardcoded credentials can be extracted and used for unauthorized access.
      remediation: "Externalize credentials to secrets management"

  high:
    - id: "SPA-HIGH-001"
      signal: "Inadequate authentication mechanisms"
      remediation: "Implement modern authentication (OAuth, MFA)"

    - id: "SPA-HIGH-002"
      signal: "Missing input validation and sanitization"
      remediation: "Implement comprehensive input validation"

    - id: "SPA-HIGH-003"
      signal: "Excessive privileges in service accounts"
      remediation: "Apply principle of least privilege"

  medium:
    - id: "SPA-MED-001"
      signal: "Security logging insufficient"
      remediation: "Implement comprehensive security logging"

    - id: "SPA-MED-002"
      signal: "Security headers not implemented"
      remediation: "Add security headers to HTTP responses"

  low:
    - id: "SPA-LOW-001"
      signal: "Minor security configuration improvements possible"
      remediation: "Apply security hardening during maintenance"

    - id: "SPA-LOW-002"
      signal: "Security documentation outdated"
      remediation: "Update security documentation"

  positive:
    - id: "SPA-POS-001"
      signal: "Security controls meet current standards"

    - id: "SPA-POS-002"
      signal: "Regular security assessments with remediation"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Run Vulnerability Scans"
      description: "Execute automated vulnerability scanning"
      duration_estimate: "2 hours"

    - id: "2"
      name: "Analyze Authentication"
      description: "Review authentication mechanisms and practices"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Review Encryption"
      description: "Assess cryptographic implementations"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Assess Access Controls"
      description: "Review authorization and access management"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Check Compliance"
      description: "Evaluate against compliance requirements"
      duration_estimate: "2 hours"

    - id: "6"
      name: "Document Findings"
      description: "Create security assessment report"
      duration_estimate: "2 hours"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Vulnerability Assessment"
        - "Authentication Analysis"
        - "Encryption Review"
        - "Compliance Gaps"
        - "Remediation Priorities"

closeout_checklist:
  - id: "spa-001"
    item: "Vulnerability scan completed"
    level: "WARNING"
    verification: "tool_output"
  - id: "spa-002"
    item: "Critical vulnerabilities documented"
    level: "WARNING"
    verification: "manual"
  - id: "spa-003"
    item: "Security improvement requirements for migration documented"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["any-system", "regulated-industries", "data-processing-systems"]

  compliance_mappings:
    - framework: "ISO 27001"
      control: "A.14.2.1"
      description: "Secure development policy"
    - framework: "PCI DSS"
      control: "6.5"
      description: "Address common coding vulnerabilities"
    - framework: "SOC 2"
      control: "CC6.6"
      description: "System security"

relationships:
  commonly_combined:
    - "security.vulnerability-assessment"
    - "security.penetration-testing"
  depends_on:
    - "security.asset-inventory"
  feeds_into:
    - "legacy-migration.migration-planning.security-requirements"
    - "risk-management.security-risk-register"
