# ============================================================
# AUDIT: Attribute-Based Access
# Category: 34 - Business Logic & Domain
# Subcategory: authorization-logic
# ============================================================

audit:
  id: "business-logic-domain.authorization-logic.attribute-based-access"
  name: "Attribute-Based Access Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "business-logic-domain"
  category_number: 34
  subcategory: "authorization-logic"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "business-logic"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates attribute-based access control (ABAC) implementations including
    policy definitions, attribute evaluation, context handling, and decision
    enforcement. This audit examines whether ABAC policies correctly express
    business rules and are consistently evaluated across the system.

  why_it_matters: |
    ABAC enables fine-grained access control based on user, resource, action,
    and environmental attributes. However, complex ABAC policies can be
    difficult to understand and verify. Incorrect ABAC policies can both
    grant excessive access and block legitimate operations.

  when_to_run:
    - "When implementing ABAC"
    - "After policy changes"
    - "During security reviews"
    - "When access issues reported"

prerequisites:
  required_artifacts:
    - type: "policy_definitions"
      description: "ABAC policy files"
    - type: "source_code"
      description: "Policy evaluation code"
    - type: "test_cases"
      description: "Policy test scenarios"

  access_requirements:
    - "Read access to policy definitions"
    - "Access to policy evaluation code"
    - "Access to policy testing tools"

discovery:
  file_patterns:
    - glob: "**/policies/**/*.rego"
      purpose: "Find OPA Rego policies"
    - glob: "**/policies/**/*.polar"
      purpose: "Find Oso Polar policies"
    - glob: "**/policies/**/*.{yaml,json}"
      purpose: "Find policy configuration files"
    - glob: "**/*Policy*.{ts,java,cs,py}"
      purpose: "Find policy implementation code"

  interview_questions:
    - role: "Security Engineer"
      questions:
        - "What ABAC framework is used?"
        - "How are policies tested?"
        - "How complex are your access rules?"
    - role: "Lead Developer"
      questions:
        - "How are attributes collected for decisions?"
        - "What is the performance impact of policy evaluation?"
        - "How do you debug authorization issues?"

knowledge_sources:
  guides:
    - id: "nist-abac"
      name: "NIST ABAC Guide"
      url: "https://csrc.nist.gov/publications/detail/sp/800-162/final"
    - id: "opa-documentation"
      name: "Open Policy Agent Documentation"
      url: "https://www.openpolicyagent.org/docs/latest/"

  standards:
    - id: "xacml"
      name: "XACML Standard"
      relevance: "ABAC policy language standard"

tooling:
  analysis_tools:
    - tool: "Open Policy Agent"
      purpose: "ABAC policy engine"
    - tool: "Oso"
      purpose: "Authorization framework"
    - tool: "OPA Playground"
      purpose: "Policy testing"
    - tool: "Conftest"
      purpose: "Policy unit testing"

signals:
  critical:
    - id: "ABA-CRIT-001"
      signal: "Policies grant unintended access"
      evidence_indicators:
        - "Policy logic errors allow access"
        - "Overly permissive default rules"
        - "Missing deny conditions"
      explanation: |
        Incorrect ABAC policies can grant access to unauthorized users.
        Complex policy logic makes these errors difficult to detect.
      remediation: "Review and fix policy logic; add policy unit tests"

    - id: "ABA-CRIT-002"
      signal: "Policy evaluation can be bypassed"
      evidence_indicators:
        - "Endpoints without policy checks"
        - "Inconsistent policy enforcement"
        - "Policy failures defaulting to allow"
      explanation: |
        If policy evaluation can be bypassed or skipped, ABAC provides
        no security benefit.
      remediation: "Ensure all access goes through policy evaluation; use default-deny"

  high:
    - id: "ABA-HIGH-001"
      signal: "Attribute sources not validated"
      evidence_indicators:
        - "Attributes from untrusted sources"
        - "User-controlled attributes in decisions"
        - "No attribute verification"
      remediation: "Validate all attribute sources; use trusted providers"

    - id: "ABA-HIGH-002"
      signal: "Policies not tested systematically"
      evidence_indicators:
        - "No policy unit tests"
        - "Policy changes not tested"
        - "Edge cases not covered"
      remediation: "Implement comprehensive policy testing"

  medium:
    - id: "ABA-MED-001"
      signal: "Policy complexity makes review difficult"
      evidence_indicators:
        - "Deeply nested conditions"
        - "Policies difficult to understand"
        - "No policy documentation"
      remediation: "Simplify policies; add documentation; use policy templates"

    - id: "ABA-MED-002"
      signal: "Policy evaluation performance issues"
      evidence_indicators:
        - "Slow authorization decisions"
        - "High policy evaluation latency"
        - "No caching of decisions"
      remediation: "Optimize policies; implement decision caching"

  low:
    - id: "ABA-LOW-001"
      signal: "Policy debugging difficult"
      evidence_indicators:
        - "Cannot trace why access was denied"
        - "No decision logging"
      remediation: "Add decision explanation logging"

  positive:
    - id: "ABA-POS-001"
      signal: "Comprehensive policy unit test coverage"
    - id: "ABA-POS-002"
      signal: "Clear, well-documented policies"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Policy Framework"
      description: "Understand ABAC implementation"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Analyze Policies"
      description: "Review policy definitions for correctness"
      duration_estimate: "2 hours"

    - id: "3"
      name: "Test Policy Scenarios"
      description: "Execute test cases against policies"
      duration_estimate: "1 hour"
      tools:
        - name: "OPA"
          action: "Run policy tests"

    - id: "4"
      name: "Review Attribute Sources"
      description: "Verify attribute collection and validation"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Document Findings"
      description: "Compile ABAC audit findings"
      duration_estimate: "30 minutes"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      description: "List of ABAC issues"

    - type: "policy_inventory"
      format: "structured"
      description: "Inventory of ABAC policies"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Policy Framework Review"
        - "Policy Analysis"
        - "Test Results"
        - "Recommendations"

closeout_checklist:
  - id: "aba-001"
    item: "Policy framework reviewed"
    level: "REQUIRED"
    verification: "manual"
  - id: "aba-002"
    item: "Policy correctness verified"
    level: "REQUIRED"
    verification: "automated"
  - id: "aba-003"
    item: "Attribute sources validated"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["enterprise-applications", "government-systems", "complex-authorization"]

  compliance_mappings:
    - framework: "NIST SP 800-162"
      control: "ABAC Implementation"
      description: "Attribute-based access control"

relationships:
  commonly_combined:
    - "business-logic-domain.authorization-logic.role-based-access-design"
    - "security.access-control"
  depends_on:
    - "architecture-design.authorization-architecture"
  feeds_into:
    - "security.access-control-assessment"
