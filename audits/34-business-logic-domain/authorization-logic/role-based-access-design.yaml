# ============================================================
# AUDIT: Role-Based Access Design
# Category: 34 - Business Logic & Domain
# Subcategory: authorization-logic
# ============================================================

audit:
  id: "business-logic-domain.authorization-logic.role-based-access-design"
  name: "Role-Based Access Design Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "business-logic-domain"
  category_number: 34
  subcategory: "authorization-logic"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "business-logic"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates role-based access control (RBAC) design including role definitions,
    permission assignments, role hierarchies, and the principle of least privilege.
    This audit examines whether roles are properly scoped, permissions are
    appropriately granular, and the role model supports business needs without
    being overly complex.

  why_it_matters: |
    Poor RBAC design leads to security vulnerabilities, compliance violations,
    and operational inefficiency. Overly permissive roles create security risks,
    while overly restrictive roles hinder productivity. Good role design balances
    security and usability.

  when_to_run:
    - "During security reviews"
    - "When designing new features"
    - "Before compliance audits"
    - "After security incidents"

prerequisites:
  required_artifacts:
    - type: "role_definitions"
      description: "Role and permission documentation"
    - type: "source_code"
      description: "Authorization implementation"
    - type: "access_matrix"
      description: "Role-permission mappings"

  access_requirements:
    - "Read access to authorization code"
    - "Access to role definitions"
    - "Access to permission configurations"

discovery:
  file_patterns:
    - glob: "**/*Role*.{ts,java,cs,py}"
      purpose: "Find role definitions"
    - glob: "**/*Permission*.{ts,java,cs,py}"
      purpose: "Find permission code"
    - glob: "**/auth/**/*.{ts,java,cs,py}"
      purpose: "Find authorization code"
    - glob: "**/rbac/**/*.{ts,java,cs,py}"
      purpose: "Find RBAC implementations"
    - glob: "**/policies/**/*.{yaml,json}"
      purpose: "Find policy configurations"

  interview_questions:
    - role: "Security Engineer"
      questions:
        - "How are roles and permissions designed?"
        - "Is there a role hierarchy?"
        - "How do you ensure least privilege?"
    - role: "Business Analyst"
      questions:
        - "What access levels do different users need?"
        - "Are there issues with current role assignments?"
        - "What business functions require special access?"

knowledge_sources:
  guides:
    - id: "nist-rbac"
      name: "NIST RBAC Model"
      url: "https://csrc.nist.gov/projects/role-based-access-control"
    - id: "rbac-best-practices"
      name: "RBAC Best Practices"
      url: "https://www.owasp.org/index.php/Access_Control_Cheat_Sheet"

  standards:
    - id: "nist-sp-800-162"
      name: "NIST SP 800-162"
      relevance: "ABAC/RBAC standards"

tooling:
  analysis_tools:
    - tool: "Open Policy Agent"
      purpose: "Policy evaluation and testing"
    - tool: "Casbin"
      purpose: "Authorization library"
    - tool: "Access control matrix tools"
      purpose: "Visualize role-permission mappings"

signals:
  critical:
    - id: "RBA-CRIT-001"
      signal: "Overly permissive admin or super-user roles"
      evidence_indicators:
        - "Admin role has all permissions"
        - "No separation of duties for admin functions"
        - "Wide use of admin roles"
      explanation: |
        Overly permissive roles violate least privilege and create massive
        blast radius for compromised accounts. Admin roles should be
        tightly scoped and rarely assigned.
      remediation: "Split admin roles by function; minimize admin role usage"

    - id: "RBA-CRIT-002"
      signal: "Roles allow unauthorized data access"
      evidence_indicators:
        - "Users can access data from other tenants"
        - "Horizontal privilege escalation possible"
        - "Row-level security not enforced"
      explanation: |
        When roles don't properly scope data access, users can access
        data they shouldn't, creating security and compliance issues.
      remediation: "Implement row-level security; scope roles to appropriate data"

  high:
    - id: "RBA-HIGH-001"
      signal: "Roles too coarse-grained"
      evidence_indicators:
        - "Few roles with many permissions"
        - "All-or-nothing access choices"
        - "Users with unnecessary permissions"
      remediation: "Create more granular roles; split by business function"

    - id: "RBA-HIGH-002"
      signal: "No role hierarchy causing duplication"
      evidence_indicators:
        - "Same permissions in multiple roles"
        - "Permission changes require multiple updates"
        - "Inconsistent permissions across similar roles"
      remediation: "Implement role hierarchy; inherit common permissions"

  medium:
    - id: "RBA-MED-001"
      signal: "Role proliferation creating management burden"
      evidence_indicators:
        - "Hundreds of roles"
        - "Difficult to understand which role to assign"
        - "Orphaned roles no longer used"
      remediation: "Consolidate similar roles; establish role governance"

    - id: "RBA-MED-002"
      signal: "Permissions not aligned with business functions"
      evidence_indicators:
        - "Technical permission names"
        - "Permissions don't map to job functions"
        - "Business users confused by permissions"
      remediation: "Align permissions with business terminology and functions"

  low:
    - id: "RBA-LOW-001"
      signal: "Role and permission documentation incomplete"
      evidence_indicators:
        - "No description of role purposes"
        - "Permission meanings unclear"
      remediation: "Document all roles and permissions with clear descriptions"

  positive:
    - id: "RBA-POS-001"
      signal: "Well-designed role hierarchy with least privilege"
    - id: "RBA-POS-002"
      signal: "Clear mapping between roles and business functions"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Roles and Permissions"
      description: "Document all roles and their permissions"
      duration_estimate: "1-2 hours"

    - id: "2"
      name: "Analyze Permission Assignments"
      description: "Review permission-to-role mappings"
      duration_estimate: "1-2 hours"

    - id: "3"
      name: "Assess Least Privilege"
      description: "Verify roles follow least privilege"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Review Role Hierarchy"
      description: "Analyze role inheritance structure"
      duration_estimate: "30 minutes"

    - id: "5"
      name: "Document Findings"
      description: "Compile RBAC design findings"
      duration_estimate: "30 minutes"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      description: "List of RBAC design issues"

    - type: "access_matrix"
      format: "structured"
      description: "Role-permission access matrix"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Role Inventory"
        - "Permission Analysis"
        - "Least Privilege Assessment"
        - "Recommendations"

closeout_checklist:
  - id: "rba-001"
    item: "All roles documented"
    level: "REQUIRED"
    verification: "manual"
  - id: "rba-002"
    item: "Permission assignments reviewed"
    level: "REQUIRED"
    verification: "manual"
  - id: "rba-003"
    item: "Least privilege verified"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["all-applications"]

  compliance_mappings:
    - framework: "SOX"
      control: "Access Controls"
      description: "Role-based access control"
    - framework: "HIPAA"
      control: "Access Control"
      description: "Role-based access for healthcare data"

relationships:
  commonly_combined:
    - "business-logic-domain.authorization-logic.permission-enforcement"
    - "security.access-control"
  depends_on:
    - "requirements-specification.access-requirements"
  feeds_into:
    - "compliance-legal.access-compliance"
