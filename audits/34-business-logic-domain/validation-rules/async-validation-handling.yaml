audit:
  id: business-logic-domain.validation-rules.async-validation-handling
  name: Async Validation Handling Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: business-logic-domain
  category_number: 34
  subcategory: validation-rules
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: business-logic
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates asynchronous validation patterns including server-side uniqueness
    checks, external service validations, debouncing strategies, and handling
    of validation timing issues. This audit examines how async validations
    are triggered, how their results are integrated with synchronous validation,
    and how race conditions are prevented.
  why_it_matters: |
    Async validation provides better UX by checking constraints before submission
    but introduces complexity. Poor async validation leads to race conditions,
    inconsistent state, and confusing user experiences. Proper handling ensures
    reliable real-time validation feedback.
  when_to_run:
  - When implementing real-time validation
  - After timing-related validation issues
  - When adding uniqueness checks
  - During form UX reviews
prerequisites:
  required_artifacts:
  - type: source_code
    description: Async validation implementations
  - type: api_endpoints
    description: Validation API endpoints
  - type: ui_components
    description: Form components with async validation
  access_requirements:
  - Read access to validation code
  - Access to form components
  - Access to validation APIs
discovery:
  file_patterns:
  - glob: '**/*async*valid*.{ts,java,cs,py}'
    purpose: Find async validation code
  - glob: '**/hooks/**/useValidat*.{ts,tsx}'
    purpose: Find validation hooks
  - glob: '**/forms/**/*.{ts,tsx,vue}'
    purpose: Find form validation code
  - glob: '**/api/**/valid*.{ts,java,cs,py}'
    purpose: Find validation API endpoints
  interview_questions:
  - role: Frontend Developer
    questions:
    - How do you handle async validation in forms?
    - How do you prevent race conditions?
    - What debouncing strategy is used?
  - role: Backend Developer
    questions:
    - What validations require server calls?
    - How do you handle validation API performance?
    - Are there caching strategies for validation?
knowledge_sources:
  guides:
  - id: async-form-validation
    name: Async Form Validation Patterns
    url: https://react-hook-form.com/advanced-usage#AsyncValidation
  - id: debounce-patterns
    name: Debouncing and Throttling
    url: https://css-tricks.com/debouncing-throttling-explained-examples/
  standards:
  - id: ux-best-practices
    name: Form Validation UX
    relevance: User experience for async validation
tooling:
  analysis_tools:
  - tool: React Hook Form
    purpose: Async validation support
  - tool: Network timing tools
    purpose: Analyze validation timing
  - tool: Storybook
    purpose: Test async validation states
signals:
  critical:
  - id: AVH-CRIT-001
    signal: Async validation race conditions allow invalid data
    evidence_indicators:
    - Fast typing bypasses uniqueness check
    - Stale validation results applied
    - Submit before async validation completes
    explanation: |
      Race conditions in async validation can allow invalid data to
      be submitted, defeating the purpose of validation.
    remediation: Track validation request IDs; discard stale results
  - id: AVH-CRIT-002
    signal: Server-side validation skipped if async fails
    evidence_indicators:
    - Network failure bypasses validation
    - Timeout doesn't block submission
    - No fallback validation
    explanation: |
      If async validation failure silently allows submission, data
      integrity relies on unreliable network calls.
    remediation: Require async validation success or block submission; revalidate on server
  high:
  - id: AVH-HIGH-001
    signal: No debouncing on async validation
    evidence_indicators:
    - API call on every keystroke
    - Rate limiting errors
    - Slow form response during typing
    remediation: Implement debouncing for async validation triggers
  - id: AVH-HIGH-002
    signal: Async validation state unclear to users
    evidence_indicators:
    - No loading indicator during validation
    - Confusing intermediate states
    - User unsure if field is valid
    remediation: Show clear loading/valid/invalid states
  medium:
  - id: AVH-MED-001
    signal: Async validation errors not properly handled
    evidence_indicators:
    - Network errors shown as validation failures
    - No retry mechanism
    - Generic error for validation API issues
    remediation: Distinguish validation failures from API errors; add retry
  - id: AVH-MED-002
    signal: Async and sync validation not coordinated
    evidence_indicators:
    - Sync errors cleared by async success
    - Confusing error state management
    - Validation order issues
    remediation: Coordinate sync and async validation results
  low:
  - id: AVH-LOW-001
    signal: Async validation too slow
    evidence_indicators:
    - Multi-second validation delays
    - Poor perceived performance
    remediation: Optimize validation APIs; consider caching
  positive:
  - id: AVH-POS-001
    signal: Well-debounced async validation with clear state
  - id: AVH-POS-002
    signal: Race conditions properly handled
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify Async Validations
    description: Map all async validation points
    duration_estimate: 30 minutes
  - id: '2'
    name: Review Timing Handling
    description: Analyze debouncing and race condition prevention
    duration_estimate: 1-2 hours
  - id: '3'
    name: Test Race Conditions
    description: Attempt to create race condition scenarios
    duration_estimate: 1 hour
  - id: '4'
    name: Check State Management
    description: Review validation state handling
    duration_estimate: 30 minutes
  - id: '5'
    name: Document Findings
    description: Compile async validation findings
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
    description: List of async validation issues
  - type: timing_analysis
    format: structured
    description: Analysis of validation timing
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Async Validation Inventory
    - Race Condition Analysis
    - State Management Review
    - Recommendations
closeout_checklist:
- id: avh-001
  item: Async validations mapped
  level: REQUIRED
  verification: manual
- id: avh-002
  item: Race conditions tested
  level: REQUIRED
  verification: manual
- id: avh-003
  item: State management reviewed
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - web-applications
    - spa
    - form-heavy-applications
  compliance_mappings:
  - framework: UX Best Practices
    control: Form Validation
    description: Async validation UX
relationships:
  commonly_combined:
  - business-logic-domain.validation-rules.input-validation-completeness
  - frontend.state-management
  depends_on:
  - api-design.validation-endpoints
  feeds_into:
  - user-experience.form-completion
