audit:
  id: business-logic-domain.validation-rules.data-format-validation
  name: Data Format Validation Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: business-logic-domain
  category_number: 34
  subcategory: validation-rules
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: business-logic
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates validation of data formats including email addresses, phone numbers,
    postal codes, URLs, IDs, and other formatted fields. This audit examines
    whether format validation is appropriate for the business context, consistent
    across the application, and handles international formats correctly.
  why_it_matters: |
    Improper format validation leads to poor data quality and user frustration.
    Overly strict validation rejects valid inputs, while too lenient validation
    accepts garbage data. Format validation must balance strictness with
    usability and international compatibility.
  when_to_run:
  - When implementing data entry forms
  - After user complaints about rejected inputs
  - When expanding internationally
  - During data quality reviews
prerequisites:
  required_artifacts:
  - type: source_code
    description: Format validation implementations
  - type: api_specs
    description: API format specifications
  - type: business_requirements
    description: Format requirements
  access_requirements:
  - Read access to validation code
  - Access to format specifications
discovery:
  file_patterns:
  - glob: '**/validators/**/*.{ts,java,cs,py}'
    purpose: Find validation implementations
  - glob: '**/*Pattern*.{ts,java,cs,py}'
    purpose: Find pattern/regex definitions
  - glob: '**/utils/**/format*.{ts,java,cs,py}'
    purpose: Find format utilities
  - glob: '**/*Regex*.{ts,java,cs,py}'
    purpose: Find regex definitions
  interview_questions:
  - role: UX Designer
    questions:
    - What format frustrations do users report?
    - Do international users have issues with format validation?
  - role: Lead Developer
    questions:
    - What format standards are used?
    - How do you validate international formats?
    - Are there known issues with format validation?
knowledge_sources:
  guides:
  - id: email-validation
    name: Email Validation Best Practices
    url: https://www.regular-expressions.info/email.html
  - id: phone-validation
    name: International Phone Number Validation
    url: https://github.com/google/libphonenumber
  standards:
  - id: e164
    name: E.164 Phone Number Format
    relevance: International phone number standard
  - id: rfc-5322
    name: RFC 5322 Email Format
    relevance: Email address format standard
tooling:
  analysis_tools:
  - tool: libphonenumber
    purpose: Phone number validation and formatting
  - tool: email-validator
    purpose: Email validation library
  - tool: postal codes libraries
    purpose: International postal code validation
signals:
  critical:
  - id: DFV-CRIT-001
    signal: Format validation allows injection attacks
    evidence_indicators:
    - Script tags accepted in text fields
    - SQL characters not escaped
    - Format validation doesn't sanitize
    explanation: |
      Format validation that doesn't prevent malicious input enables
      injection attacks and security vulnerabilities.
    remediation: Add sanitization in addition to format validation
  high:
  - id: DFV-HIGH-001
    signal: Format validation rejects valid international data
    evidence_indicators:
    - International phone numbers rejected
    - Non-US postal codes fail
    - Accented characters in names rejected
    remediation: Use international-aware validation; test with global data
  - id: DFV-HIGH-002
    signal: Email validation too permissive
    evidence_indicators:
    - Obviously invalid emails accepted
    - Missing domain validation
    - Typo-squatting emails not detected
    remediation: Implement proper email format validation
  medium:
  - id: DFV-MED-001
    signal: Format validation inconsistent across application
    evidence_indicators:
    - Different email patterns in different forms
    - Phone format varies by feature
    - No centralized format validators
    remediation: Centralize format validation; use consistent patterns
  - id: DFV-MED-002
    signal: Custom regex for standard formats
    evidence_indicators:
    - Hand-written email regex
    - Custom phone number patterns
    - Reinventing standard validations
    remediation: Use established libraries for standard format validation
  low:
  - id: DFV-LOW-001
    signal: Format validation errors not user-friendly
    evidence_indicators:
    - No example of expected format
    - Technical regex error messages
    remediation: Provide format examples and clear error messages
  positive:
  - id: DFV-POS-001
    signal: International format support with appropriate libraries
  - id: DFV-POS-002
    signal: Clear format hints and examples for users
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Format Fields
    description: Identify all fields requiring format validation
    duration_estimate: 30 minutes
  - id: '2'
    name: Review Validation Patterns
    description: Analyze format validation implementations
    duration_estimate: 1-2 hours
  - id: '3'
    name: Test International Formats
    description: Verify international data is accepted
    duration_estimate: 1 hour
  - id: '4'
    name: Check Consistency
    description: Verify format validation is consistent
    duration_estimate: 30 minutes
  - id: '5'
    name: Document Findings
    description: Compile format validation findings
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
    description: List of format validation issues
  - type: format_inventory
    format: structured
    description: Inventory of formatted fields
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Format Field Inventory
    - Validation Analysis
    - International Support
    - Recommendations
closeout_checklist:
- id: dfv-001
  item: Format fields inventoried
  level: REQUIRED
  verification: manual
- id: dfv-002
  item: International formats tested
  level: REQUIRED
  verification: automated
- id: dfv-003
  item: Consistency verified
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - all-applications
  compliance_mappings:
  - framework: WCAG
    control: Input Assistance
    description: Accessible format guidance
relationships:
  commonly_combined:
  - business-logic-domain.validation-rules.input-validation-completeness
  - internationalization.locale-support
  depends_on:
  - requirements-specification.data-requirements
  feeds_into:
  - data-management.data-quality
