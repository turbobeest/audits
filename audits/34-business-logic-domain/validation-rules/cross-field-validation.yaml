audit:
  id: business-logic-domain.validation-rules.cross-field-validation
  name: Cross-Field Validation Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: business-logic-domain
  category_number: 34
  subcategory: validation-rules
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: business-logic
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates validation rules that depend on relationships between multiple
    fields. This audit examines date range validations, conditional required
    fields, mutually exclusive options, sum validations, and other inter-field
    dependencies. It ensures all cross-field business rules are properly
    validated.
  why_it_matters: |
    Cross-field validation errors are a common source of data quality issues.
    When individual fields validate but their combination is invalid, business
    logic fails. These validations are often overlooked because they are more
    complex to implement than single-field validation.
  when_to_run:
  - During form and API design reviews
  - After data quality issues with related fields
  - When implementing complex business forms
  - Before major releases
prerequisites:
  required_artifacts:
  - type: source_code
    description: Validation implementations
  - type: business_requirements
    description: Cross-field validation rules
  - type: data_models
    description: Entity definitions
  access_requirements:
  - Read access to validation code
  - Access to form specifications
  - Access to API specifications
discovery:
  file_patterns:
  - glob: '**/validators/**/*.{ts,java,cs,py}'
    purpose: Find validation implementations
  - glob: '**/*Validator*.{ts,java,cs,py}'
    purpose: Find validator classes
  - glob: '**/dto/**/*.{ts,java,cs,py}'
    purpose: Find DTOs with validation
  - glob: '**/forms/**/*.{ts,tsx,vue}'
    purpose: Find form validation code
  interview_questions:
  - role: Business Analyst
    questions:
    - What fields depend on each other?
    - When is one field required based on another?
    - What combinations of values are invalid?
  - role: Lead Developer
    questions:
    - How do you implement cross-field validation?
    - Are there known gaps in cross-field rules?
    - Is validation consistent between client and server?
knowledge_sources:
  guides:
  - id: class-level-validation
    name: Class-Level Validation Constraints
    url: https://hibernate.org/validator/documentation/
  - id: form-validation-patterns
    name: Complex Form Validation Patterns
    url: https://react-hook-form.com/advanced-usage
  standards:
  - id: jsr-380
    name: Bean Validation 2.0
    relevance: Cross-field validation annotations
tooling:
  analysis_tools:
  - tool: Bean Validation
    purpose: Java cross-field validation
  - tool: Yup/Zod
    purpose: JavaScript schema validation
  - tool: FluentValidation
    purpose: .NET validation framework
signals:
  critical:
  - id: CFV-CRIT-001
    signal: Date range validation missing (end before start)
    evidence_indicators:
    - End date can be before start date
    - Invalid date ranges in database
    - Business logic failures from invalid ranges
    explanation: |
      Invalid date ranges cause scheduling conflicts, incorrect
      calculations, and business logic failures.
    remediation: Add date range validation ensuring end >= start
  - id: CFV-CRIT-002
    signal: Mutually exclusive options both selectable
    evidence_indicators:
    - Contradictory options selected together
    - Undefined behavior for conflicting choices
    - Data with impossible combinations
    explanation: |
      Mutually exclusive options that can both be selected lead to
      undefined behavior and incorrect processing.
    remediation: Implement mutual exclusion validation
  high:
  - id: CFV-HIGH-001
    signal: Conditional required fields not validated
    evidence_indicators:
    - Required field blank when condition met
    - Conditional rules only on frontend
    - Incomplete data accepted by API
    remediation: Implement conditional required validation on server
  - id: CFV-HIGH-002
    signal: Sum/percentage validation missing
    evidence_indicators:
    - Allocations don't sum to 100%
    - Line items don't match total
    - Distribution fields exceed or fall short of total
    remediation: Add validation for fields that must sum to specific values
  medium:
  - id: CFV-MED-001
    signal: Cross-field validation only on client
    evidence_indicators:
    - Server accepts invalid combinations
    - API calls bypass UI validation
    - Automated tools submit invalid data
    remediation: Duplicate cross-field validation on server
  - id: CFV-MED-002
    signal: Referential validation missing
    evidence_indicators:
    - References to non-existent entities
    - Circular references created
    - Parent-child relationship violations
    remediation: Add referential validation before accepting data
  low:
  - id: CFV-LOW-001
    signal: Cross-field error messages unclear
    evidence_indicators:
    - Error doesn't indicate which fields
    - Generic validation failure message
    remediation: Provide specific error messages identifying related fields
  positive:
  - id: CFV-POS-001
    signal: Comprehensive cross-field validation at all levels
  - id: CFV-POS-002
    signal: Clear error messages for field relationships
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify Cross-Field Rules
    description: Document all field dependencies and rules
    duration_estimate: 1 hour
  - id: '2'
    name: Map to Implementations
    description: Find where rules are enforced
    duration_estimate: 1 hour
  - id: '3'
    name: Test Validation Coverage
    description: Verify all rules are enforced
    duration_estimate: 1 hour
  - id: '4'
    name: Check Server-Side Enforcement
    description: Verify server validates all cross-field rules
    duration_estimate: 30 minutes
  - id: '5'
    name: Document Findings
    description: Compile cross-field validation findings
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
    description: List of cross-field validation gaps
  - type: dependency_matrix
    format: structured
    description: Matrix of field dependencies
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Field Dependency Analysis
    - Validation Coverage
    - Recommendations
closeout_checklist:
- id: cfv-001
  item: All cross-field rules documented
  level: REQUIRED
  verification: manual
- id: cfv-002
  item: Server-side enforcement verified
  level: REQUIRED
  verification: automated
- id: cfv-003
  item: Error messages reviewed
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - enterprise-applications
    - form-heavy-applications
  compliance_mappings:
  - framework: Data Quality
    control: Validation
    description: Cross-field data validation
relationships:
  commonly_combined:
  - business-logic-domain.validation-rules.input-validation-completeness
  - business-logic-domain.validation-rules.business-constraint-enforcement
  depends_on:
  - requirements-specification.validation-requirements
  feeds_into:
  - data-management.data-quality
