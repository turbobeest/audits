# ============================================================
# AUDIT: Algorithm Correctness
# Category: 34 - Business Logic & Domain
# Subcategory: calculation-logic
# ============================================================

audit:
  id: "business-logic-domain.calculation-logic.algorithm-correctness"
  name: "Algorithm Correctness Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "business-logic-domain"
  category_number: 34
  subcategory: "calculation-logic"

  tier: "expert"
  estimated_duration: "4-8 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "business-logic"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the correctness of business algorithms including scoring, rating,
    ranking, optimization, and statistical calculations. This audit examines
    algorithm implementations against their specifications, verifies mathematical
    correctness, and ensures edge cases are handled properly.

  why_it_matters: |
    Incorrect algorithms produce wrong business outcomes. Credit scoring errors
    deny loans to qualified applicants, pricing algorithms can cause losses,
    and recommendation algorithms can miss revenue opportunities. Algorithm
    correctness directly impacts business results.

  when_to_run:
    - "When implementing new algorithms"
    - "After algorithm-related issues"
    - "During mathematical review cycles"
    - "Before deploying algorithm changes"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Algorithm implementations"
    - type: "algorithm_specs"
      description: "Mathematical specifications"
    - type: "test_cases"
      description: "Known-correct test examples"

  access_requirements:
    - "Read access to algorithm code"
    - "Access to algorithm specifications"
    - "Access to test data"

discovery:
  file_patterns:
    - glob: "**/*Algorithm*.{ts,java,cs,py}"
      purpose: "Find algorithm implementations"
    - glob: "**/*Score*.{ts,java,cs,py}"
      purpose: "Find scoring algorithms"
    - glob: "**/*Calculator*.{ts,java,cs,py}"
      purpose: "Find calculation logic"
    - glob: "**/*Rating*.{ts,java,cs,py}"
      purpose: "Find rating algorithms"
    - glob: "**/ml/**/*.{py,ts}"
      purpose: "Find machine learning code"

  interview_questions:
    - role: "Data Scientist"
      questions:
        - "What algorithms are critical to the business?"
        - "How do you verify algorithm correctness?"
        - "What edge cases have caused problems?"
    - role: "Lead Developer"
      questions:
        - "How are algorithms tested?"
        - "Are there known issues with any algorithms?"
        - "How are algorithm changes validated?"

knowledge_sources:
  guides:
    - id: "algorithm-verification"
      name: "Algorithm Verification Techniques"
      url: "https://en.wikipedia.org/wiki/Formal_verification"
    - id: "property-based-testing"
      name: "Property-Based Testing"
      url: "https://hypothesis.works/articles/what-is-hypothesis/"

  standards:
    - id: "statistical-standards"
      name: "Statistical Computation Standards"
      relevance: "Numerical algorithm standards"

tooling:
  analysis_tools:
    - tool: "Property-based testing (Hypothesis, QuickCheck)"
      purpose: "Generate algorithm test cases"
    - tool: "Numerical verification tools"
      purpose: "Verify mathematical correctness"
    - tool: "Symbolic math (SymPy, Mathematica)"
      purpose: "Verify formulas"
    - tool: "Fuzz testing"
      purpose: "Discover algorithm edge cases"

signals:
  critical:
    - id: "ALC-CRIT-001"
      signal: "Algorithm produces incorrect results"
      evidence_indicators:
        - "Output does not match specification"
        - "Known-correct test cases fail"
        - "Mathematical formula incorrectly implemented"
      explanation: |
        Incorrect algorithm results lead to wrong business decisions. In
        regulated industries, this can cause compliance violations and
        legal liability.
      remediation: "Fix algorithm implementation; verify against specification"

    - id: "ALC-CRIT-002"
      signal: "Algorithm has numerical stability issues"
      evidence_indicators:
        - "Results vary significantly with small input changes"
        - "Overflow or underflow errors"
        - "Division by zero possible"
      explanation: |
        Numerical instability causes unpredictable results and system
        failures. These issues are often difficult to reproduce and debug.
      remediation: "Improve numerical stability; use appropriate numeric types and ranges"

  high:
    - id: "ALC-HIGH-001"
      signal: "Edge cases not handled correctly"
      evidence_indicators:
        - "Empty input causes errors"
        - "Extreme values produce wrong results"
        - "Boundary conditions not tested"
      remediation: "Add edge case handling; test boundary conditions"

    - id: "ALC-HIGH-002"
      signal: "Algorithm differs from documented specification"
      evidence_indicators:
        - "Implementation diverges from spec"
        - "Undocumented modifications"
        - "Parameters differ from specification"
      remediation: "Align implementation with specification; document deviations"

  medium:
    - id: "ALC-MED-001"
      signal: "Algorithm not tested with realistic data"
      evidence_indicators:
        - "Only simple test cases"
        - "Production data characteristics not tested"
        - "Statistical distributions not considered"
      remediation: "Test with realistic data distributions; add statistical tests"

    - id: "ALC-MED-002"
      signal: "Algorithm performance degrades with scale"
      evidence_indicators:
        - "O(n^2) or worse complexity"
        - "Memory usage grows unbounded"
        - "Timeouts with large inputs"
      remediation: "Optimize algorithm; add performance tests"

  low:
    - id: "ALC-LOW-001"
      signal: "Algorithm implementation not readable"
      evidence_indicators:
        - "Magic numbers without explanation"
        - "No comments on formula"
        - "Variable names unclear"
      remediation: "Add documentation; use meaningful names; explain formulas"

  positive:
    - id: "ALC-POS-001"
      signal: "Algorithm verified with property-based testing"
    - id: "ALC-POS-002"
      signal: "Clear mapping between specification and implementation"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Critical Algorithms"
      description: "Map algorithms critical to business"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Review Against Specifications"
      description: "Compare implementations to specifications"
      duration_estimate: "2-3 hours"

    - id: "3"
      name: "Test Known Cases"
      description: "Verify against known-correct results"
      duration_estimate: "1-2 hours"

    - id: "4"
      name: "Test Edge Cases"
      description: "Verify boundary and edge case handling"
      duration_estimate: "1 hour"
      tools:
        - name: "Property-based testing"
          action: "Generate edge case tests"

    - id: "5"
      name: "Document Findings"
      description: "Compile algorithm correctness findings"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      description: "List of algorithm correctness issues"

    - type: "algorithm_inventory"
      format: "structured"
      description: "Inventory of critical algorithms"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Algorithm Inventory"
        - "Correctness Analysis"
        - "Edge Case Review"
        - "Recommendations"

closeout_checklist:
  - id: "alc-001"
    item: "Critical algorithms identified"
    level: "REQUIRED"
    verification: "manual"
  - id: "alc-002"
    item: "Specification compliance verified"
    level: "REQUIRED"
    verification: "manual"
  - id: "alc-003"
    item: "Edge cases tested"
    level: "WARNING"
    verification: "automated"

governance:
  applicable_to:
    archetypes: ["fintech", "analytics", "machine-learning", "pricing-systems"]

  compliance_mappings:
    - framework: "Model Risk Management"
      control: "Model Validation"
      description: "Algorithm validation requirements"

relationships:
  commonly_combined:
    - "business-logic-domain.calculation-logic.financial-accuracy"
    - "testing-quality-assurance.algorithm-testing"
  depends_on:
    - "requirements-specification.algorithm-requirements"
  feeds_into:
    - "testing-quality-assurance.model-validation"
