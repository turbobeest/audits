audit:
  id: business-logic-domain.calculation-logic.pro-rata-calculation
  name: Pro-Rata Calculation Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: business-logic-domain
  category_number: 34
  subcategory: calculation-logic
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: business-logic
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates pro-rata calculation logic for billing, allocations, and apportionments.
    This audit examines how amounts are divided proportionally over time periods,
    how partial periods are handled, how days are counted, and how remainders are
    distributed. It ensures pro-rata calculations are fair, consistent, and match
    business expectations.
  why_it_matters: |
    Pro-rata calculations affect customer billing, revenue recognition, and cost
    allocation. Incorrect pro-rata logic causes billing disputes, revenue errors,
    and fairness issues. Customers are particularly sensitive to proration
    accuracy in subscription and billing contexts.
  when_to_run:
  - When implementing billing systems
  - After proration-related disputes
  - During billing accuracy reviews
  - Before pricing model changes
prerequisites:
  required_artifacts:
  - type: source_code
    description: Pro-rata calculation implementations
  - type: business_requirements
    description: Proration business rules
  - type: test_cases
    description: Proration test scenarios
  access_requirements:
  - Read access to billing/calculation code
  - Access to proration specifications
discovery:
  file_patterns:
  - glob: '**/*ProRata*.{ts,java,cs,py}'
    purpose: Find pro-rata calculation code
  - glob: '**/*Proration*.{ts,java,cs,py}'
    purpose: Find proration logic
  - glob: '**/billing/**/*.{ts,java,cs,py}'
    purpose: Find billing calculations
  - glob: '**/*Allocation*.{ts,java,cs,py}'
    purpose: Find allocation logic
  interview_questions:
  - role: Finance Team
    questions:
    - How should partial periods be calculated?
    - What day counting convention do you use?
    - How should remainders be handled?
  - role: Lead Developer
    questions:
    - How is proration calculated?
    - How do you handle month-length variations?
    - Are there known proration issues?
knowledge_sources:
  guides:
  - id: proration-methods
    name: Proration Calculation Methods
    url: https://www.chargebee.com/blog/proration-guide/
  - id: day-count-conventions
    name: Day Count Conventions
    url: https://en.wikipedia.org/wiki/Day_count_convention
  standards:
  - id: asc-606
    name: ASC 606 Revenue Recognition
    relevance: Revenue allocation requirements
tooling:
  analysis_tools:
  - tool: Billing system documentation
    purpose: Understand proration approach
  - tool: Spreadsheet verification
    purpose: Manual calculation verification
  - tool: Property-based testing
    purpose: Generate proration test cases
signals:
  critical:
  - id: PRC-CRIT-001
    signal: Pro-rata calculation produces incorrect amounts
    evidence_indicators:
    - Calculated amount differs from expected
    - Customer billing disputes
    - Revenue recognition errors
    explanation: |
      Incorrect proration directly affects customer billing and revenue.
      Even small errors compound across customer base and time periods.
    remediation: Fix calculation logic; verify against known-correct examples
  - id: PRC-CRIT-002
    signal: Remainders lost in allocation
    evidence_indicators:
    - Allocated amounts don't sum to total
    - Penny amounts disappearing
    - Systematic under-collection
    explanation: |
      When remainders are lost during allocation, the business either
      loses revenue or overcharges customers. Both cause problems.
    remediation: Implement remainder distribution; ensure total preservation
  high:
  - id: PRC-HIGH-001
    signal: Day counting inconsistent
    evidence_indicators:
    - Different methods for months with different lengths
    - Leap year handling inconsistent
    - 30/360 vs actual/actual not specified
    remediation: Standardize day counting convention; document and apply consistently
  - id: PRC-HIGH-002
    signal: Partial period start/end unclear
    evidence_indicators:
    - Inclusive vs. exclusive boundaries unclear
    - Start day charged differently than end day
    - Off-by-one errors at boundaries
    remediation: Define and document boundary conventions; apply consistently
  medium:
  - id: PRC-MED-001
    signal: Proration granularity inappropriate
    evidence_indicators:
    - Daily proration when monthly expected
    - No proration when customer expects it
    - Granularity mismatch with pricing
    remediation: Align proration granularity with business requirements
  - id: PRC-MED-002
    signal: Proration rules not documented
    evidence_indicators:
    - Different understanding across teams
    - No written specification
    - Logic only visible in code
    remediation: Document proration rules in business specifications
  low:
  - id: PRC-LOW-001
    signal: Proration calculation not centralized
    evidence_indicators:
    - Multiple proration implementations
    - Inconsistent approaches across features
    remediation: Centralize proration logic; create shared utility
  positive:
  - id: PRC-POS-001
    signal: Comprehensive proration test suite
  - id: PRC-POS-002
    signal: Clear documentation of proration rules
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify Proration Calculations
    description: Map all pro-rata calculation locations
    duration_estimate: 30 minutes
  - id: '2'
    name: Review Calculation Logic
    description: Analyze proration algorithms
    duration_estimate: 1-2 hours
  - id: '3'
    name: Verify Day Counting
    description: Check day counting convention consistency
    duration_estimate: 1 hour
  - id: '4'
    name: Test Remainder Handling
    description: Verify remainders are not lost
    duration_estimate: 1 hour
  - id: '5'
    name: Document Findings
    description: Compile pro-rata calculation findings
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
    description: List of pro-rata calculation issues
  - type: proration_inventory
    format: structured
    description: Inventory of proration calculations
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Proration Logic Analysis
    - Day Counting Review
    - Remainder Handling
    - Recommendations
closeout_checklist:
- id: prc-001
  item: All proration calculations identified
  level: REQUIRED
  verification: manual
- id: prc-002
  item: Calculation accuracy verified
  level: REQUIRED
  verification: automated
- id: prc-003
  item: Remainder handling tested
  level: WARNING
  verification: automated
governance:
  applicable_to:
    archetypes:
    - saas
    - subscription-business
    - fintech
    - utilities
  compliance_mappings:
  - framework: ASC 606
    control: Revenue Recognition
    description: Pro-rata revenue allocation
relationships:
  commonly_combined:
  - business-logic-domain.calculation-logic.financial-accuracy
  - business-logic-domain.calculation-logic.rounding-precision
  depends_on:
  - requirements-specification.billing-requirements
  feeds_into:
  - billing.billing-accuracy
