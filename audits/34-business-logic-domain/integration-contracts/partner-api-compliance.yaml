# ============================================================
# AUDIT: Partner API Compliance
# Category: 34 - Business Logic & Domain
# Subcategory: integration-contracts
# ============================================================

audit:
  id: "business-logic-domain.integration-contracts.partner-api-compliance"
  name: "Partner API Compliance Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "business-logic-domain"
  category_number: 34
  subcategory: "integration-contracts"

  tier: "expert"
  estimated_duration: "4-8 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "business-logic"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates compliance with partner API specifications and contracts. This
    audit examines whether integrations correctly implement partner API
    requirements, handle responses properly, respect rate limits, and follow
    partner guidelines for data handling and usage.

  why_it_matters: |
    Partner API violations can result in service disruption, termination of
    partnership, and legal liability. Incorrect implementations cause integration
    failures that impact business operations. Compliance with partner contracts
    is essential for maintaining B2B relationships.

  when_to_run:
    - "When implementing new partner integrations"
    - "Before partner compliance audits"
    - "After API version upgrades"
    - "When experiencing integration issues"

prerequisites:
  required_artifacts:
    - type: "partner_contracts"
      description: "Partner API documentation and agreements"
    - type: "source_code"
      description: "Partner API integration code"
    - type: "api_logs"
      description: "API call logs for analysis"

  access_requirements:
    - "Read access to integration code"
    - "Access to partner API documentation"
    - "Access to integration logs"

discovery:
  file_patterns:
    - glob: "**/integrations/**/*.{ts,java,cs,py}"
      purpose: "Find integration code"
    - glob: "**/clients/**/*.{ts,java,cs,py}"
      purpose: "Find API client code"
    - glob: "**/external/**/*.{ts,java,cs,py}"
      purpose: "Find external API code"
    - glob: "**/partners/**/*.{ts,java,cs,py}"
      purpose: "Find partner integration code"

  interview_questions:
    - role: "Integration Engineer"
      questions:
        - "What partner APIs do you integrate with?"
        - "How do you stay current with partner API changes?"
        - "Have there been compliance issues?"
    - role: "Business Relationship Manager"
      questions:
        - "What are the key contract requirements?"
        - "Are there SLA requirements?"
        - "What data usage restrictions exist?"

knowledge_sources:
  guides:
    - id: "api-integration-patterns"
      name: "API Integration Patterns"
      url: "https://www.enterpriseintegrationpatterns.com/"
    - id: "partner-api-best-practices"
      name: "Partner API Best Practices"
      url: "https://swagger.io/blog/api-strategy/"

  standards:
    - id: "openapi"
      name: "OpenAPI Specification"
      relevance: "API contract standards"

tooling:
  analysis_tools:
    - tool: "OpenAPI validators"
      purpose: "Validate API contract compliance"
    - tool: "Postman/Newman"
      purpose: "API contract testing"
    - tool: "Pact"
      purpose: "Consumer-driven contract testing"
    - tool: "API monitoring tools"
      purpose: "Monitor API compliance"

signals:
  critical:
    - id: "PAC-CRIT-001"
      signal: "Integration violates partner data usage requirements"
      evidence_indicators:
        - "Data stored longer than permitted"
        - "Data shared with unauthorized parties"
        - "Data used for unauthorized purposes"
      explanation: |
        Violating partner data usage agreements can result in contract
        termination, legal action, and loss of access to critical services.
      remediation: "Review and comply with data usage requirements; implement data controls"

    - id: "PAC-CRIT-002"
      signal: "Integration exceeds rate limits causing service disruption"
      evidence_indicators:
        - "Frequent 429 errors"
        - "Account warnings from partner"
        - "Service throttled or blocked"
      explanation: |
        Exceeding rate limits can result in service disruption and
        potential contract violations.
      remediation: "Implement rate limiting; use backoff strategies"

  high:
    - id: "PAC-HIGH-001"
      signal: "Using deprecated API endpoints"
      evidence_indicators:
        - "Deprecation warnings in responses"
        - "Using sunset API versions"
        - "No migration plan"
      remediation: "Migrate to current API versions; monitor deprecations"

    - id: "PAC-HIGH-002"
      signal: "Error responses not handled per partner spec"
      evidence_indicators:
        - "Error codes ignored"
        - "Retry on non-retryable errors"
        - "Error handling doesn't match documentation"
      remediation: "Implement error handling per partner documentation"

  medium:
    - id: "PAC-MED-001"
      signal: "Required API fields not populated"
      evidence_indicators:
        - "Optional fields treated as not required"
        - "Default values for required fields"
        - "Validation errors from partner"
      remediation: "Review field requirements; populate all required fields"

    - id: "PAC-MED-002"
      signal: "Authentication not following partner guidelines"
      evidence_indicators:
        - "Incorrect OAuth flows"
        - "Token refresh not implemented properly"
        - "Credentials not rotated as required"
      remediation: "Follow partner authentication guidelines"

  low:
    - id: "PAC-LOW-001"
      signal: "Integration documentation out of date"
      evidence_indicators:
        - "Documentation doesn't match implementation"
        - "Partner API version not documented"
      remediation: "Update integration documentation"

  positive:
    - id: "PAC-POS-001"
      signal: "Contract tests verify partner API compliance"
    - id: "PAC-POS-002"
      signal: "Automated monitoring of partner API health"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Partner Integrations"
      description: "Document all partner API integrations"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Review Contract Requirements"
      description: "Document key contract requirements"
      duration_estimate: "1-2 hours"

    - id: "3"
      name: "Verify Implementation Compliance"
      description: "Check code against contract requirements"
      duration_estimate: "2-3 hours"

    - id: "4"
      name: "Test API Interactions"
      description: "Verify API calls match specification"
      duration_estimate: "1 hour"
      tools:
        - name: "Pact"
          action: "Run contract tests"

    - id: "5"
      name: "Document Findings"
      description: "Compile partner API compliance findings"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      description: "List of compliance issues"

    - type: "integration_inventory"
      format: "structured"
      description: "Inventory of partner integrations"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Partner Inventory"
        - "Compliance Analysis"
        - "Contract Requirements"
        - "Recommendations"

closeout_checklist:
  - id: "pac-001"
    item: "Partner integrations inventoried"
    level: "REQUIRED"
    verification: "manual"
  - id: "pac-002"
    item: "Contract requirements reviewed"
    level: "REQUIRED"
    verification: "manual"
  - id: "pac-003"
    item: "Compliance verified"
    level: "WARNING"
    verification: "automated"

governance:
  applicable_to:
    archetypes: ["b2b-applications", "platform-integrations", "fintech"]

  compliance_mappings:
    - framework: "Contract Management"
      control: "Partner Compliance"
      description: "Partner API contract compliance"

relationships:
  commonly_combined:
    - "business-logic-domain.integration-contracts.contract-testing"
    - "api-management.partner-apis"
  depends_on:
    - "architecture-design.integration-architecture"
  feeds_into:
    - "vendor-management.partner-compliance"
