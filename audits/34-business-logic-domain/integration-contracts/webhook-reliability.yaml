audit:
  id: business-logic-domain.integration-contracts.webhook-reliability
  name: Webhook Reliability Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: business-logic-domain
  category_number: 34
  subcategory: integration-contracts
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: business-logic
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates webhook reliability for both sending and receiving. This audit
    examines retry mechanisms, signature verification, delivery guarantees,
    timeout handling, and failure monitoring. It ensures webhooks are delivered
    reliably and processed securely.
  why_it_matters: |
    Webhooks are critical for real-time integrations. Unreliable webhooks cause
    missed events, delayed processing, and inconsistent state. Proper webhook
    implementation ensures partners receive timely notifications and events
    are not lost.
  when_to_run:
  - When implementing webhook systems
  - After webhook delivery failures
  - When onboarding new webhook consumers
  - During integration reviews
prerequisites:
  required_artifacts:
  - type: source_code
    description: Webhook implementation code
  - type: webhook_config
    description: Webhook configuration
  - type: delivery_logs
    description: Webhook delivery logs
  access_requirements:
  - Read access to webhook code
  - Access to delivery logs
  - Test endpoint access
discovery:
  file_patterns:
  - glob: '**/*Webhook*.{ts,java,cs,py}'
    purpose: Find webhook code
  - glob: '**/webhooks/**/*.{ts,java,cs,py}'
    purpose: Find webhook implementations
  - glob: '**/callbacks/**/*.{ts,java,cs,py}'
    purpose: Find callback handling code
  - glob: '**/events/**/*Sender*.{ts,java,cs,py}'
    purpose: Find event sending code
  interview_questions:
  - role: Integration Engineer
    questions:
    - What retry strategy do you use for webhooks?
    - How do you verify webhook signatures?
    - What happens when webhook delivery fails?
  - role: Operations
    questions:
    - How do you monitor webhook delivery?
    - What is the webhook success rate?
    - How do you handle webhook failures?
knowledge_sources:
  guides:
  - id: stripe-webhooks
    name: Stripe Webhooks Best Practices
    url: https://stripe.com/docs/webhooks/best-practices
  - id: webhook-security
    name: Webhook Security
    url: https://webhooks.fyi/security/signatures
  standards:
  - id: standard-webhooks
    name: Standard Webhooks
    relevance: Webhook implementation standard
tooling:
  analysis_tools:
  - tool: Webhook testing tools
    purpose: Test webhook delivery
  - tool: RequestBin/webhook.site
    purpose: Capture and inspect webhooks
  - tool: Delivery monitoring
    purpose: Track webhook success rates
signals:
  critical:
  - id: WHR-CRIT-001
    signal: No retry mechanism for failed deliveries
    evidence_indicators:
    - Failed webhooks not retried
    - Events lost on delivery failure
    - No dead letter handling
    explanation: |
      Without retries, transient failures cause permanent event loss.
      Partners miss critical notifications and integrations break.
    remediation: Implement retry with exponential backoff
  - id: WHR-CRIT-002
    signal: No signature verification on received webhooks
    evidence_indicators:
    - Webhooks processed without validation
    - No HMAC signature checking
    - Spoofed webhooks possible
    explanation: |
      Without signature verification, attackers can send fake webhooks
      triggering unauthorized actions.
    remediation: Verify webhook signatures before processing
  high:
  - id: WHR-HIGH-001
    signal: Webhook processing not idempotent
    evidence_indicators:
    - Duplicate webhooks cause duplicate effects
    - No event ID tracking
    - Retry causes duplicate processing
    remediation: Make webhook handlers idempotent; track processed event IDs
  - id: WHR-HIGH-002
    signal: No delivery monitoring or alerting
    evidence_indicators:
    - Unknown webhook success rates
    - Failures discovered by partners
    - No metrics on delivery
    remediation: Implement webhook delivery monitoring and alerting
  medium:
  - id: WHR-MED-001
    signal: Insufficient retry attempts
    evidence_indicators:
    - Only few retry attempts
    - Short retry window
    - Failures during maintenance windows not recovered
    remediation: Increase retry attempts over longer window; notify on permanent failure
  - id: WHR-MED-002
    signal: No webhook replay capability
    evidence_indicators:
    - Cannot resend failed webhooks
    - No manual trigger option
    - Lost events unrecoverable
    remediation: Implement webhook replay functionality
  low:
  - id: WHR-LOW-001
    signal: Webhook documentation incomplete
    evidence_indicators:
    - Event types not documented
    - Payload schemas unclear
    remediation: Document all webhook events with payload schemas
  positive:
  - id: WHR-POS-001
    signal: Robust retry with exponential backoff
  - id: WHR-POS-002
    signal: Signature verification and idempotent processing
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Webhook Architecture
    description: Understand webhook sending/receiving implementation
    duration_estimate: 1 hour
  - id: '2'
    name: Analyze Retry Mechanism
    description: Review retry strategy and configuration
    duration_estimate: 1 hour
  - id: '3'
    name: Verify Security
    description: Check signature generation and verification
    duration_estimate: 30 minutes
  - id: '4'
    name: Test Failure Scenarios
    description: Test webhook delivery under failure conditions
    duration_estimate: 1 hour
  - id: '5'
    name: Document Findings
    description: Compile webhook reliability findings
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
    description: List of webhook reliability issues
  - type: webhook_inventory
    format: structured
    description: Inventory of webhook types
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Architecture Review
    - Reliability Analysis
    - Security Assessment
    - Recommendations
closeout_checklist:
- id: whr-001
  item: Webhook architecture reviewed
  level: REQUIRED
  verification: manual
- id: whr-002
  item: Retry mechanism verified
  level: REQUIRED
  verification: automated
- id: whr-003
  item: Security verified
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - api-providers
    - event-driven-systems
    - b2b-platforms
  compliance_mappings:
  - framework: API Security
    control: Webhook Security
    description: Webhook security and reliability
relationships:
  commonly_combined:
  - business-logic-domain.integration-contracts.idempotency-handling
  - business-logic-domain.event-handling.event-handler-reliability
  depends_on:
  - infrastructure.webhook-infrastructure
  feeds_into:
  - operations-monitoring.webhook-monitoring
