# ============================================================
# AUDIT: Edge Case Coverage
# Category: 34 - Business Logic & Domain
# Subcategory: business-rules
# ============================================================

audit:
  id: "business-logic-domain.business-rules.edge-case-coverage"
  name: "Edge Case Coverage Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "business-logic-domain"
  category_number: 34
  subcategory: "business-rules"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "business-logic"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the handling of edge cases and boundary conditions in business
    rules. This audit examines whether business logic correctly handles extreme
    values, empty inputs, null values, boundary conditions, and unusual but
    valid scenarios. It identifies gaps in edge case handling that could cause
    system failures or incorrect business outcomes.

  why_it_matters: |
    Edge cases are where bugs hide. Business rules that work for typical scenarios
    often fail at boundaries, with empty collections, zero values, or maximum
    limits. These failures can cause financial losses, data corruption, and
    security vulnerabilities. Thorough edge case coverage prevents production
    incidents.

  when_to_run:
    - "During code reviews for new business rules"
    - "Before major releases"
    - "After discovering production edge case bugs"
    - "When expanding business rule coverage"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Business rule implementations"
    - type: "business_requirements"
      description: "Business rule specifications with boundary conditions"
    - type: "test_cases"
      description: "Existing test coverage"

  access_requirements:
    - "Read access to business logic code"
    - "Access to test suites"
    - "Access to business requirements"

discovery:
  file_patterns:
    - glob: "**/domain/**/*.{ts,java,cs,py}"
      purpose: "Find domain logic implementations"
    - glob: "**/rules/**/*.{ts,java,cs,py}"
      purpose: "Find business rule implementations"
    - glob: "**/test/**/*Edge*.*"
      purpose: "Find edge case tests"
    - glob: "**/test/**/*Boundary*.*"
      purpose: "Find boundary tests"

  interview_questions:
    - role: "Lead Developer"
      questions:
        - "How do you identify edge cases for business rules?"
        - "What edge case bugs have been found in production?"
        - "Are boundary conditions documented in requirements?"
    - role: "QA Engineer"
      questions:
        - "How do you test edge cases?"
        - "What boundary conditions are most problematic?"
        - "Are there areas known to have weak edge case coverage?"

knowledge_sources:
  guides:
    - id: "boundary-value-analysis"
      name: "Boundary Value Analysis"
      url: "https://www.tutorialspoint.com/software_testing_dictionary/boundary_value_analysis.htm"

  standards:
    - id: "equivalence-partitioning"
      name: "Equivalence Partitioning"
      relevance: "Test case design for edge cases"

tooling:
  analysis_tools:
    - tool: "PIT Mutation Testing"
      purpose: "Identify missing edge case tests"
    - tool: "JaCoCo"
      purpose: "Code coverage including branches"
    - tool: "Istanbul"
      purpose: "JavaScript code coverage"
    - tool: "Property-Based Testing Tools"
      purpose: "Automatically discover edge cases"

signals:
  critical:
    - id: "ECC-CRIT-001"
      signal: "Business rule fails with null or empty input"
      evidence_indicators:
        - "NullPointerException in production logs"
        - "Empty collection causes system crash"
        - "Missing null checks in critical paths"
      explanation: |
        Null and empty inputs are common in production. When business rules
        crash instead of handling these gracefully, it causes service outages
        and data corruption.
      remediation: "Add defensive null/empty checks; define expected behavior for edge inputs"

    - id: "ECC-CRIT-002"
      signal: "Boundary values cause incorrect calculations"
      evidence_indicators:
        - "Zero values produce wrong results"
        - "Maximum values cause overflow"
        - "Boundary conditions not tested"
      explanation: |
        Boundary value bugs in financial calculations can cause significant
        monetary losses. Off-by-one errors and overflow conditions are
        particularly dangerous.
      remediation: "Implement boundary condition handling; add boundary value tests"

  high:
    - id: "ECC-HIGH-001"
      signal: "Negative values not handled in positive-only contexts"
      evidence_indicators:
        - "Prices accept negative values"
        - "Quantities allow negative numbers"
        - "No validation for sign constraints"
      remediation: "Add sign validation for values that must be positive"

    - id: "ECC-HIGH-002"
      signal: "Collection edge cases not handled"
      evidence_indicators:
        - "Single-element collections treated differently"
        - "Empty collections cause unexpected behavior"
        - "Maximum collection size not enforced"
      remediation: "Handle empty, single-element, and maximum-size collections explicitly"

  medium:
    - id: "ECC-MED-001"
      signal: "Date edge cases not handled"
      evidence_indicators:
        - "Leap years cause issues"
        - "Month-end calculations incorrect"
        - "Timezone edge cases not handled"
      remediation: "Add comprehensive date edge case handling and tests"

    - id: "ECC-MED-002"
      signal: "String edge cases not handled"
      evidence_indicators:
        - "Empty strings treated as valid"
        - "Whitespace-only strings not validated"
        - "Unicode characters cause issues"
      remediation: "Implement comprehensive string validation"

  low:
    - id: "ECC-LOW-001"
      signal: "Edge case behavior not documented"
      evidence_indicators:
        - "No documentation of boundary behavior"
        - "Expected edge case results unclear"
      remediation: "Document expected behavior for all edge cases"

  positive:
    - id: "ECC-POS-001"
      signal: "Comprehensive boundary value tests in place"
    - id: "ECC-POS-002"
      signal: "Property-based testing used to discover edge cases"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Critical Business Rules"
      description: "List business rules requiring edge case analysis"
      duration_estimate: "30 minutes"

    - id: "2"
      name: "Enumerate Edge Cases"
      description: "Document potential edge cases for each rule"
      duration_estimate: "1-2 hours"

    - id: "3"
      name: "Review Code for Edge Handling"
      description: "Analyze code to verify edge case handling"
      duration_estimate: "1-2 hours"

    - id: "4"
      name: "Check Test Coverage"
      description: "Verify tests exist for identified edge cases"
      duration_estimate: "1 hour"
      tools:
        - name: "PIT Mutation Testing"
          action: "Run mutation tests to find untested edges"

    - id: "5"
      name: "Document Findings"
      description: "Compile edge case coverage findings"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      description: "List of missing edge case handling"

    - type: "edge_case_matrix"
      format: "structured"
      description: "Matrix of rules and their edge cases"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Edge Case Analysis"
        - "Coverage Gaps"
        - "Test Recommendations"

closeout_checklist:
  - id: "ecc-001"
    item: "Critical business rules analyzed for edge cases"
    level: "REQUIRED"
    verification: "manual"
  - id: "ecc-002"
    item: "Edge case matrix created"
    level: "REQUIRED"
    verification: "manual"
  - id: "ecc-003"
    item: "Test coverage gaps documented"
    level: "WARNING"
    verification: "automated"

governance:
  applicable_to:
    archetypes: ["enterprise-applications", "fintech", "e-commerce", "healthcare"]

  compliance_mappings:
    - framework: "FDA 21 CFR Part 11"
      control: "Validation"
      description: "Edge case testing for regulated systems"

relationships:
  commonly_combined:
    - "business-logic-domain.business-rules.rule-completeness"
    - "testing-quality-assurance.boundary-testing"
  depends_on:
    - "requirements-specification.business-requirements"
  feeds_into:
    - "testing-quality-assurance.test-coverage"
