# ============================================================
# AUDIT: Rule Engine Evaluation
# Category: 34 - Business Logic & Domain
# Subcategory: business-rules
# ============================================================

audit:
  id: "business-logic-domain.business-rules.rule-engine-evaluation"
  name: "Rule Engine Evaluation Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "business-logic-domain"
  category_number: 34
  subcategory: "business-rules"

  tier: "expert"
  estimated_duration: "4-8 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "business-logic"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the implementation and configuration of business rule engines. This
    audit examines rule engine selection appropriateness, rule definition quality,
    execution performance, conflict resolution, and maintainability. It assesses
    whether the rule engine effectively separates business rules from application
    code and supports business user involvement.

  why_it_matters: |
    Rule engines enable business agility by allowing non-developers to modify
    business logic. However, poorly implemented rule engines create performance
    problems, maintenance nightmares, and security vulnerabilities. Proper
    evaluation ensures the rule engine adds value rather than complexity.

  when_to_run:
    - "When evaluating rule engine adoption"
    - "During performance optimization reviews"
    - "Before major rule changes"
    - "When experiencing rule-related issues"

prerequisites:
  required_artifacts:
    - type: "rule_definitions"
      description: "Business rule definitions in rule engine"
    - type: "source_code"
      description: "Rule engine integration code"
    - type: "performance_data"
      description: "Rule execution metrics"

  access_requirements:
    - "Access to rule engine administration"
    - "Read access to rule definitions"
    - "Access to performance monitoring"

discovery:
  file_patterns:
    - glob: "**/*.drl"
      purpose: "Find Drools rule files"
    - glob: "**/*.dmn"
      purpose: "Find DMN decision files"
    - glob: "**/rules/**/*.{json,yaml,xml}"
      purpose: "Find rule configuration files"
    - glob: "**/*RuleEngine*.*"
      purpose: "Find rule engine integration code"

  interview_questions:
    - role: "Business Analyst"
      questions:
        - "Can you modify business rules without developer involvement?"
        - "How do you test rule changes before deployment?"
        - "Are there rules that are difficult to express in the rule engine?"
    - role: "Lead Developer"
      questions:
        - "Why was this rule engine selected?"
        - "What are the performance characteristics?"
        - "How are rule conflicts handled?"

knowledge_sources:
  guides:
    - id: "drools-documentation"
      name: "Drools Documentation"
      url: "https://docs.drools.org/"
    - id: "dmn-specification"
      name: "DMN Specification"
      url: "https://www.omg.org/dmn/"

  standards:
    - id: "decision-model-notation"
      name: "Decision Model and Notation (DMN)"
      relevance: "Standardized decision modeling"

tooling:
  analysis_tools:
    - tool: "Drools"
      purpose: "Java-based rule engine"
    - tool: "Easy Rules"
      purpose: "Lightweight Java rule engine"
    - tool: "NRules"
      purpose: ".NET rule engine"
    - tool: "json-rules-engine"
      purpose: "JavaScript rule engine"

signals:
  critical:
    - id: "REE-CRIT-001"
      signal: "Rule engine allows arbitrary code execution"
      evidence_indicators:
        - "Rules can execute system commands"
        - "No sandboxing of rule execution"
        - "Rule definitions editable without security review"
      explanation: |
        Rule engines that allow arbitrary code execution create security
        vulnerabilities. Malicious or erroneous rules could compromise
        the entire system.
      remediation: "Implement strict sandboxing; limit rule actions to safe operations"

    - id: "REE-CRIT-002"
      signal: "Rule conflicts produce non-deterministic behavior"
      evidence_indicators:
        - "Same input produces different results across executions"
        - "Rule order affects outcomes unexpectedly"
        - "No conflict resolution strategy defined"
      explanation: |
        Non-deterministic rule execution makes the system unpredictable and
        impossible to test reliably. Business users cannot trust rule outcomes.
      remediation: "Define explicit conflict resolution; use rule priorities and exclusions"

  high:
    - id: "REE-HIGH-001"
      signal: "Rule engine performance inadequate for load"
      evidence_indicators:
        - "Rule evaluation causes latency spikes"
        - "Memory consumption grows with rule complexity"
        - "Rule execution time exceeds SLA"
      remediation: "Optimize rule definitions; consider rule compilation or caching"

    - id: "REE-HIGH-002"
      signal: "Rules not version controlled"
      evidence_indicators:
        - "No audit trail for rule changes"
        - "Cannot rollback rule modifications"
        - "Rules stored only in database"
      remediation: "Store rules in version control; implement change tracking"

  medium:
    - id: "REE-MED-001"
      signal: "Rules too complex for business users"
      evidence_indicators:
        - "Rules require developer expertise to modify"
        - "Business analysts cannot understand rule logic"
        - "No rule documentation for business users"
      remediation: "Simplify rule structure; provide business-friendly interfaces"

    - id: "REE-MED-002"
      signal: "Rule testing is manual and incomplete"
      evidence_indicators:
        - "No automated rule testing"
        - "Test coverage for rules unknown"
        - "Rule changes deployed without testing"
      remediation: "Implement automated rule testing framework"

  low:
    - id: "REE-LOW-001"
      signal: "Rule organization makes maintenance difficult"
      evidence_indicators:
        - "Rules scattered without clear structure"
        - "No naming conventions for rules"
      remediation: "Organize rules by business domain; establish naming conventions"

  positive:
    - id: "REE-POS-001"
      signal: "Business users can safely modify rules without developer help"
    - id: "REE-POS-002"
      signal: "Comprehensive rule testing with automated verification"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Assess Rule Engine Selection"
      description: "Evaluate if the rule engine fits the use case"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Review Rule Definitions"
      description: "Analyze rule quality, complexity, and organization"
      duration_estimate: "2 hours"

    - id: "3"
      name: "Evaluate Performance"
      description: "Measure rule execution performance under load"
      duration_estimate: "1-2 hours"

    - id: "4"
      name: "Check Security Controls"
      description: "Verify rule engine security configuration"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Document Findings"
      description: "Compile rule engine evaluation findings"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      description: "List of rule engine issues"

    - type: "performance_report"
      format: "structured"
      description: "Rule execution performance analysis"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Rule Engine Assessment"
        - "Performance Analysis"
        - "Security Review"
        - "Recommendations"

closeout_checklist:
  - id: "ree-001"
    item: "Rule engine configuration reviewed"
    level: "REQUIRED"
    verification: "manual"
  - id: "ree-002"
    item: "Performance characteristics documented"
    level: "REQUIRED"
    verification: "automated"
  - id: "ree-003"
    item: "Security controls verified"
    level: "WARNING"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["enterprise-applications", "fintech", "insurance"]

  compliance_mappings:
    - framework: "SOX"
      control: "Change Management"
      description: "Rule change control and auditability"

relationships:
  commonly_combined:
    - "business-logic-domain.business-rules.rule-completeness"
    - "performance-efficiency.rule-performance"
  depends_on:
    - "architecture-design.technology-selection"
  feeds_into:
    - "operations-monitoring.rule-monitoring"
