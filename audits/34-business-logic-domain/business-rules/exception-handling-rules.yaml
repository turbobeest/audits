audit:
  id: business-logic-domain.business-rules.exception-handling-rules
  name: Exception Handling Rules Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: business-logic-domain
  category_number: 34
  subcategory: business-rules
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: business-logic
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates how business rules handle exceptions and error conditions. This
    audit examines whether business rule violations are properly communicated,
    exceptions are handled gracefully, error recovery mechanisms exist, and
    business-meaningful error messages are provided. It ensures that rule
    failures do not cause system instability.
  why_it_matters: |
    Poor exception handling in business rules leads to confusing error messages,
    data corruption, and poor user experience. When business rule violations
    are not communicated clearly, users cannot correct their actions and support
    teams struggle to resolve issues. Proper exception handling maintains
    system stability and user trust.
  when_to_run:
  - During code reviews for error handling
  - After user complaints about confusing errors
  - Before major releases
  - When improving user experience
prerequisites:
  required_artifacts:
  - type: source_code
    description: Business rule implementations
  - type: error_catalogs
    description: Error code and message documentation
  - type: user_feedback
    description: User complaints about errors
  access_requirements:
  - Read access to business logic code
  - Access to error message resources
  - Access to support ticket data
discovery:
  file_patterns:
  - glob: '**/domain/**/*Exception*.{ts,java,cs,py}'
    purpose: Find business exception definitions
  - glob: '**/exceptions/**/*.{ts,java,cs,py}'
    purpose: Find exception classes
  - glob: '**/errors/**/*.{ts,java,cs,py}'
    purpose: Find error handling code
  - glob: '**/rules/**/*.{ts,java,cs,py}'
    purpose: Find business rule implementations
  interview_questions:
  - role: Support Team
    questions:
    - What error messages do users find most confusing?
    - Are there common issues from unclear business rule errors?
  - role: Lead Developer
    questions:
    - How are business rule violations communicated?
    - Is there an error code standard?
    - How do you handle partial failures in multi-step rules?
knowledge_sources:
  guides:
  - id: error-handling-best-practices
    name: Error Handling Best Practices
    url: https://docs.microsoft.com/en-us/dotnet/standard/exceptions/best-practices-for-exceptions
  standards:
  - id: problem-details
    name: RFC 7807 Problem Details
    relevance: Standardized error response format
tooling:
  analysis_tools:
  - tool: SonarQube
    purpose: Detect exception handling issues
  - tool: ErrorProne
    purpose: Java exception handling analysis
  - tool: ESLint error handling rules
    purpose: JavaScript exception analysis
signals:
  critical:
  - id: EHR-CRIT-001
    signal: Business rule failures swallowed silently
    evidence_indicators:
    - Empty catch blocks
    - Exceptions logged but not re-thrown
    - Silent data corruption on rule failure
    explanation: |
      When business rule failures are silently swallowed, the system proceeds
      with invalid data, causing corruption and incorrect business outcomes
      that are difficult to trace.
    remediation: Ensure all rule failures are properly communicated; never silently swallow exceptions
  - id: EHR-CRIT-002
    signal: Technical exceptions exposed to users
    evidence_indicators:
    - Stack traces shown in UI
    - Database errors visible to users
    - Internal class names in error messages
    explanation: |
      Technical exception details expose system internals, creating security
      risks and confusing users. Business rule violations should be translated
      to user-friendly messages.
    remediation: Implement exception translation layer; create user-friendly error messages
  high:
  - id: EHR-HIGH-001
    signal: No distinction between business and technical exceptions
    evidence_indicators:
    - Generic exception type for all errors
    - Cannot programmatically distinguish rule violations
    - Same handling for user errors and system failures
    remediation: Create business exception hierarchy; separate business from technical errors
  - id: EHR-HIGH-002
    signal: Partial operations not rolled back on rule failure
    evidence_indicators:
    - Incomplete data after rule failure
    - No transaction boundaries around rule execution
    - Orphaned records from failed operations
    remediation: Implement proper transaction handling; rollback on rule failures
  medium:
  - id: EHR-MED-001
    signal: Error messages lack actionable guidance
    evidence_indicators:
    - Generic 'invalid input' messages
    - No indication of how to fix the error
    - Missing specific field or rule information
    remediation: Include specific guidance in error messages; identify what to fix
  - id: EHR-MED-002
    signal: Multiple rule violations reported one at a time
    evidence_indicators:
    - Users must fix errors iteratively
    - Only first validation failure returned
    - Poor user experience on forms
    remediation: Collect and return all rule violations together
  low:
  - id: EHR-LOW-001
    signal: Error codes not standardized
    evidence_indicators:
    - Inconsistent error code formats
    - No error code catalog
    - Duplicate error codes
    remediation: Establish error code standards; maintain error catalog
  positive:
  - id: EHR-POS-001
    signal: Business exceptions provide clear, actionable messages
  - id: EHR-POS-002
    signal: All rule violations collected and returned together
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Exception Types
    description: Catalog all business exception types
    duration_estimate: 30 minutes
  - id: '2'
    name: Analyze Exception Handling
    description: Review how exceptions are caught and handled
    duration_estimate: 1-2 hours
    tools:
    - name: SonarQube
      action: Run exception handling analysis
  - id: '3'
    name: Review Error Messages
    description: Evaluate quality of error messages
    duration_estimate: 1 hour
  - id: '4'
    name: Check Transaction Handling
    description: Verify rollback on rule failures
    duration_estimate: 1 hour
  - id: '5'
    name: Document Findings
    description: Compile exception handling findings
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
    description: List of exception handling issues
  - type: error_catalog
    format: structured
    description: Catalog of business errors and messages
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Exception Handling Analysis
    - Error Message Review
    - Recommendations
closeout_checklist:
- id: ehr-001
  item: Exception types cataloged
  level: REQUIRED
  verification: manual
- id: ehr-002
  item: Silent exception handling identified
  level: REQUIRED
  verification: automated
- id: ehr-003
  item: Error message quality reviewed
  level: WARNING
  verification: manual
governance:
  applicable_to:
    archetypes:
    - enterprise-applications
    - fintech
    - e-commerce
    - healthcare
  compliance_mappings:
  - framework: WCAG
    control: Error Handling
    description: Accessible error messages
relationships:
  commonly_combined:
  - business-logic-domain.business-rules.rule-completeness
  - user-experience.error-handling
  depends_on:
  - architecture-design.error-handling-strategy
  feeds_into:
  - user-experience.user-feedback
