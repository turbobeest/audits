audit:
  id: blockchain-distributed-ledger.smart-contract-quality.error-handling
  name: Error Handling Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: smart-contract-quality
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: software
  default_profiles:
  - full
  - blockchain
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates smart contract error handling to ensure
    proper validation and meaningful error messages. It examines:
    - Input validation completeness
    - Custom error usage vs. require strings
    - Error message informativeness
    - Return value checking
    - External call failure handling
    - Revert reason consistency
  why_it_matters: |
    Error handling affects security and usability:
    - Missing validation enables exploits
    - Silent failures corrupt state
    - Poor error messages frustrate debugging
    - Unchecked returns mask failures
    - Consistent errors improve UX

    Proper error handling prevents bugs and aids diagnosis.
  when_to_run:
  - Smart contract development
  - Code review
  - Pre-deployment audit
  - UX improvement
prerequisites:
  required_artifacts:
  - type: source_code
    description: Smart contract source code
  access_requirements:
  - Access to contract source
discovery:
  code_patterns:
  - pattern: (require|revert|assert)
    type: regex
    scope: source
    purpose: Detect error handling
  - pattern: error\s+\w+
    type: regex
    scope: source
    purpose: Detect custom errors
  - pattern: \.call\{|transfer\(|send\(
    type: regex
    scope: source
    purpose: Detect external calls
  file_patterns:
  - glob: '**/*.sol'
    purpose: Solidity contracts
signals:
  critical:
  - id: ERR-CRIT-001
    signal: Critical input validation missing
    evidence_indicators:
    - External input used without check
    - Zero address not validated
    - Amount overflow not checked
    explanation: |
      Missing input validation allows invalid data to corrupt
      state or enable exploits. All external inputs must be
      validated.
    remediation: |
      - Validate all function parameters
      - Check for zero addresses
      - Verify amounts are valid
      - Add bounds checking
    cwe: CWE-20
  - id: ERR-CRIT-002
    signal: External call return value ignored
    evidence_indicators:
    - transfer() return not checked
    - External call success ignored
    - Silent failure possible
    explanation: |
      Ignored return values can hide failures, leaving state
      inconsistent. Token transfers may silently fail.
    remediation: |
      - Check all external call returns
      - Use SafeERC20 for token transfers
      - Revert on failure
      - Handle success/failure explicitly
    cwe: CWE-252
  high:
  - id: ERR-HIGH-001
    signal: Assert used for input validation
    evidence_indicators:
    - assert() on user input
    - assert for expected conditions
    - Gas consumed on assert failure
    explanation: |
      assert() consumes all remaining gas and should only be used
      for invariant checks, not input validation. Use require()
      for validation.
    remediation: |
      - Replace assert with require for validation
      - Reserve assert for invariants
      - Use custom errors for gas efficiency
      - Review all assert usage
  - id: ERR-HIGH-002
    signal: Silent failure on try/catch
    evidence_indicators:
    - Empty catch block
    - Error swallowed without action
    - State inconsistent after catch
    explanation: |
      Swallowing errors without proper handling can leave state
      inconsistent or hide important failures.
    remediation: |
      - Handle all caught errors
      - Log or emit failure events
      - Ensure consistent state
      - Document error handling
  medium:
  - id: ERR-MED-001
    signal: Require strings instead of custom errors
    evidence_indicators:
    - Long require() strings
    - No custom error definitions
    - Increased deployment cost
    explanation: |
      Require strings increase deployment and runtime gas costs.
      Custom errors are more gas-efficient and provide better
      error handling.
    remediation: |
      - Define custom errors
      - Replace require strings
      - Include relevant parameters
      - Maintain readability
  - id: ERR-MED-002
    signal: Inconsistent error messages
    evidence_indicators:
    - Same error different messages
    - Unclear error descriptions
    - Non-standard error format
    explanation: |
      Inconsistent errors complicate debugging and user
      experience. Standard, clear errors improve usability.
    remediation: |
      - Standardize error messages
      - Use consistent format
      - Include relevant context
      - Document error conditions
  low:
  - id: ERR-LOW-001
    signal: Error conditions not documented
    evidence_indicators:
    - No NatSpec for errors
    - Revert conditions unclear
    - Error codes not listed
    explanation: |
      Undocumented errors make integration and debugging
      difficult for users and developers.
    remediation: |
      - Document all error conditions
      - Add NatSpec to custom errors
      - List all revert conditions
      - Include in API docs
  positive:
  - id: ERR-POS-001
    signal: Comprehensive error handling
    evidence_indicators:
    - Complete input validation
    - Return values checked
    - Custom errors used
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: code-reviewer
  steps:
  - id: '1'
    name: Error Handling Analysis
    description: |
      Analyze error handling patterns.
    duration_estimate: 30 min
    commands:
    - purpose: Find require/revert
      command: |
        grep -rniE "(require|revert)\s*\(" \
          --include="*.sol" . 2>/dev/null | head -30
    - purpose: Find custom errors
      command: |
        grep -rniE "error\s+\w+\s*\(" \
          --include="*.sol" . 2>/dev/null | head -20
    - purpose: Find assert usage
      command: |
        grep -rniE "assert\s*\(" \
          --include="*.sol" . 2>/dev/null | head -10
    expected_findings:
    - Validation patterns
    - Error definitions
    - Error handling coverage
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Error Handling Analysis
    - Validation Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 2
    blockchain:
      included: true
      priority: 2
closeout_checklist:
- id: err-001
  item: Input validation complete
  level: CRITICAL
  verification: manual
  verification_notes: Verify all inputs are validated
  expected: Confirmed by reviewer
- id: err-002
  item: External call returns checked
  level: BLOCKING
  verification: manual
  verification_notes: Verify return values are handled
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - defi
    - enterprise
relationships:
  commonly_combined:
  - blockchain.smart-contract-security.access-control
  - blockchain.smart-contract-quality.code-complexity
  - blockchain.integration.off-chain-data
