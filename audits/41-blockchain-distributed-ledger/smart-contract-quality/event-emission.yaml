audit:
  id: blockchain-distributed-ledger.smart-contract-quality.event-emission
  name: Event Emission Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: smart-contract-quality
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: software
  default_profiles:
  - full
  - blockchain
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates smart contract event emission to ensure
    proper logging of state changes and actions. It examines:
    - Event coverage for state changes
    - Indexed parameter usage
    - Event parameter completeness
    - ERC standard event compliance
    - Event emission ordering
    - Gas-efficient event design
  why_it_matters: |
    Events are essential for blockchain applications:
    - Off-chain services depend on events for state
    - Missing events break indexer functionality
    - Indexed parameters enable efficient filtering
    - Standard events ensure ecosystem compatibility
    - Events provide audit trail for forensics

    Comprehensive events enable reliable off-chain integration.
  when_to_run:
  - Smart contract development
  - Integration testing
  - Pre-deployment review
  - Indexer integration
prerequisites:
  required_artifacts:
  - type: source_code
    description: Smart contract source code
  - type: documentation
    description: Event documentation
  access_requirements:
  - Access to contract source
  - Interface specifications
discovery:
  code_patterns:
  - pattern: event\s+\w+
    type: regex
    scope: source
    purpose: Detect event definitions
  - pattern: emit\s+\w+
    type: regex
    scope: source
    purpose: Detect event emissions
  - pattern: indexed
    type: regex
    scope: source
    purpose: Detect indexed parameters
  file_patterns:
  - glob: '**/*.sol'
    purpose: Solidity contracts
  - glob: '**/interfaces/**/*.sol'
    purpose: Interface contracts
signals:
  high:
  - id: EVENT-HIGH-001
    signal: State changes without events
    evidence_indicators:
    - Balance changes not logged
    - Ownership transfers silent
    - Critical actions not emitted
    explanation: |
      State changes without events are invisible to off-chain
      systems. This breaks integrations and removes audit trail.
    remediation: |
      - Add events for all state changes
      - Emit before state change for reentrancy
      - Include relevant parameters
      - Follow standard patterns
  - id: EVENT-HIGH-002
    signal: Standard events missing or incorrect
    evidence_indicators:
    - ERC20 Transfer not emitted
    - ERC721 events non-compliant
    - Standard event signature wrong
    explanation: |
      Non-compliant standard events break ecosystem tooling.
      Wallets, indexers, and explorers depend on standard events.
    remediation: |
      - Implement all standard events
      - Verify event signatures match EIP
      - Test with standard tools
      - Review compliance checklist
  medium:
  - id: EVENT-MED-001
    signal: Indexed parameters insufficient
    evidence_indicators:
    - Addresses not indexed
    - Important IDs not indexed
    - Filtering not possible
    explanation: |
      Without indexed parameters, events cannot be efficiently
      filtered. Indexers and UIs depend on indexed fields.
    remediation: |
      - Index addresses (up to 3 per event)
      - Index IDs and keys
      - Balance gas cost vs. utility
      - Follow standard indexing
  - id: EVENT-MED-002
    signal: Events emitted in wrong order
    evidence_indicators:
    - Emit after external call
    - Event order inconsistent
    - Dependent events misordered
    explanation: |
      Event emission after external calls can be affected by
      reentrancy, causing incorrect ordering or missing events.
    remediation: |
      - Emit events before external calls
      - Follow Checks-Effects-Interactions
      - Maintain consistent ordering
      - Test event sequences
  low:
  - id: EVENT-LOW-001
    signal: Event parameters incomplete
    evidence_indicators:
    - Missing actor address
    - Previous value not included
    - Context insufficient
    explanation: |
      Incomplete event parameters make forensic analysis and
      debugging difficult.
    remediation: |
      - Include actor (msg.sender)
      - Include before/after values
      - Add sufficient context
      - Document parameter meanings
  - id: EVENT-LOW-002
    signal: Events not documented
    evidence_indicators:
    - No NatSpec for events
    - Parameter meanings unclear
    - When emitted not specified
    explanation: |
      Undocumented events are difficult to integrate with and
      may be misunderstood by consumers.
    remediation: |
      - Add NatSpec to all events
      - Document when each emits
      - Explain parameter meanings
      - Include in API documentation
  positive:
  - id: EVENT-POS-001
    signal: Comprehensive event coverage
    evidence_indicators:
    - All state changes logged
    - Standard compliance
    - Good documentation
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: code-reviewer
  steps:
  - id: '1'
    name: Event Analysis
    description: |
      Analyze event definitions and emissions.
    duration_estimate: 30 min
    commands:
    - purpose: Find event definitions
      command: |
        grep -rniE "event\s+\w+" \
          --include="*.sol" . 2>/dev/null | head -30
    - purpose: Find event emissions
      command: |
        grep -rniE "emit\s+\w+" \
          --include="*.sol" . 2>/dev/null | head -30
    expected_findings:
    - Event definitions
    - Emission patterns
    - Indexed usage
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Event Analysis
    - Coverage Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 3
    blockchain:
      included: true
      priority: 3
closeout_checklist:
- id: event-001
  item: State changes have events
  level: BLOCKING
  verification: manual
  verification_notes: Verify all state changes emit events
  expected: Confirmed by reviewer
- id: event-002
  item: Standard events compliant
  level: WARNING
  verification: manual
  verification_notes: Verify ERC events match specification
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - defi
    - token
    - nft-platform
relationships:
  commonly_combined:
  - blockchain.token-economic.token-standard-compliance
  - blockchain.integration.indexer-reliability
  - blockchain.smart-contract-quality.code-complexity

# Glossary of domain-specific terms:
glossary:
  "timelock": "Governance mechanism requiring delay between proposal and execution"
  "reentrancy": "Vulnerability where external call allows re-entering function before completion"
  "oracle": "External data feed providing off-chain information to smart contracts"
