audit:
  id: blockchain-distributed-ledger.governance.voting-power
  name: Voting Power Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: governance
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: software
  default_profiles:
  - full
  - blockchain
  - dao
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates voting power calculation and distribution
    for fairness and security. It examines:
    - Voting power source (token, NFT, reputation)
    - Power calculation method
    - Delegation implementation
    - Power concentration risk
    - Snapshot timing
    - Anti-sybil measures
  why_it_matters: |
    Voting power determines governance control:
    - Concentrated power enables capture
    - Flawed calculation distorts outcomes
    - Delegation bugs affect representation
    - Manipulation undermines legitimacy
    - Fair distribution ensures decentralization

    Voting power design affects governance integrity.
  when_to_run:
  - Governance design
  - Token distribution
  - Power audit
  - Decentralization assessment
prerequisites:
  required_artifacts:
  - type: source_code
    description: Voting power contracts
  - type: data
    description: Token distribution data
  access_requirements:
  - Voting contract code
  - Distribution analytics
discovery:
  code_patterns:
  - pattern: (votingPower|getVotes|balanceOf)
    type: regex
    scope: source
    purpose: Detect voting power
  - pattern: (delegate|delegates|delegatee)
    type: regex
    scope: source
    purpose: Detect delegation
  - pattern: (checkpoint|snapshot|getPastVotes)
    type: regex
    scope: source
    purpose: Detect snapshots
  file_patterns:
  - glob: '**/*.sol'
    purpose: Solidity contracts
signals:
  critical:
  - id: VOTE-CRIT-001
    signal: Voting power manipulable
    evidence_indicators:
    - Power from current balance
    - No snapshot mechanism
    - Flash loan power possible
    explanation: |
      Manipulable voting power allows attackers to temporarily
      gain control through borrowing or market manipulation.
    remediation: |
      - Use snapshot-based power
      - Implement ERC20Votes
      - Lock power before votes
      - Add manipulation detection
    cwe: CWE-362
  - id: VOTE-CRIT-002
    signal: Delegation bugs allow power multiplication
    evidence_indicators:
    - Self-delegation loops
    - Delegation overflow
    - Power double-counting
    explanation: |
      Delegation bugs can multiply voting power, allowing
      attackers to control governance unfairly.
    remediation: |
      - Prevent delegation loops
      - Verify power conservation
      - Test delegation thoroughly
      - Use audited implementation
  high:
  - id: VOTE-HIGH-001
    signal: Extreme power concentration
    evidence_indicators:
    - Few addresses hold majority
    - Team controls > 50%
    - Gini coefficient high
    explanation: |
      Concentrated voting power enables minority control and
      undermines decentralization.
    remediation: |
      - Improve distribution
      - Implement quadratic voting
      - Add power caps
      - Encourage delegation
  - id: VOTE-HIGH-002
    signal: Vote buying mechanism possible
    evidence_indicators:
    - Delegation for rent
    - Bribe markets exist
    - Voting incentives distorted
    explanation: |
      Vote buying undermines governance by allowing money to
      directly purchase outcomes.
    remediation: |
      - Make vote buying unprofitable
      - Implement conviction voting
      - Add time-weighted voting
      - Monitor for bribes
  medium:
  - id: VOTE-MED-001
    signal: Delegation not transparent
    evidence_indicators:
    - Delegation off-chain
    - Power sources unclear
    - Delegation history hidden
    explanation: |
      Non-transparent delegation makes governance analysis
      and accountability difficult.
    remediation: |
      - Make delegation on-chain
      - Emit delegation events
      - Provide delegation analytics
      - Show power sources
  - id: VOTE-MED-002
    signal: Vote power decay not implemented
    evidence_indicators:
    - Old votes count same
    - No recency weighting
    - Inactive voters dominate
    explanation: |
      Without decay, inactive long-term holders may dominate
      over active participants.
    remediation: |
      - Consider vote decay
      - Implement activity weighting
      - Incentivize participation
      - Balance stability and activity
  low:
  - id: VOTE-LOW-001
    signal: Voting power not visible
    evidence_indicators:
    - Power difficult to query
    - No power dashboard
    - Distribution unknown
    explanation: |
      Hidden voting power makes governance opaque and
      reduces participation.
    remediation: |
      - Display voting power
      - Show power distribution
      - Provide delegation info
      - Build governance dashboard
  positive:
  - id: VOTE-POS-001
    signal: Fair voting power design
    evidence_indicators:
    - Snapshot-based
    - Distributed power
    - Transparent delegation
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: governance-analyst
  steps:
  - id: '1'
    name: Voting Power Analysis
    description: |
      Analyze voting power calculation and distribution.
    duration_estimate: 30 min
    commands:
    - purpose: Find voting power logic
      command: |
        grep -rniE "(votingPower|getVotes|getPastVotes)" \
          --include="*.sol" . 2>/dev/null | head -30
    - purpose: Find delegation
      command: |
        grep -rniE "(delegate|delegates)" \
          --include="*.sol" . 2>/dev/null | head -20
    expected_findings:
    - Power calculation
    - Delegation implementation
    - Snapshot usage
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Voting Power Analysis
    - Distribution Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 2
    blockchain:
      included: true
      priority: 2
closeout_checklist:
- id: vote-001
  item: Voting power not manipulable
  level: CRITICAL
  verification: manual
  verification_notes: Verify snapshot-based voting power
  expected: Confirmed by reviewer
- id: vote-002
  item: Power distribution reasonable
  level: WARNING
  verification: manual
  verification_notes: Verify no extreme concentration
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - dao
    - governance
    - token
relationships:
  commonly_combined:
  - blockchain.governance.governance-mechanism
  - blockchain.token-economic.token-distribution
  - blockchain.token-economic.incentive-alignment
