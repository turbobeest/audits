audit:
  id: blockchain-distributed-ledger.integration.indexer-reliability
  name: Indexer Reliability Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: integration
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: software
  default_profiles:
  - full
  - blockchain
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates blockchain indexer integration for
    reliability and correctness. It examines:
    - Indexer data consistency
    - Reorg handling
    - Query reliability
    - Fallback mechanisms
    - Data freshness
    - Schema correctness
  why_it_matters: |
    Applications depend on indexers for data:
    - Direct chain queries are slow/expensive
    - Indexers provide historical data
    - Incorrect indexing causes bugs
    - Reorg handling affects consistency
    - Availability affects application uptime

    Reliable indexer integration enables good UX.
  when_to_run:
  - Indexer integration
  - TheGraph deployment
  - Data layer review
  - Performance optimization
prerequisites:
  required_artifacts:
  - type: source_code
    description: Subgraph or indexer code
  - type: documentation
    description: Data schema documentation
  access_requirements:
  - Indexer source code
  - Query interface
discovery:
  code_patterns:
  - pattern: (subgraph|thegraph|indexer)
    type: regex
    scope: source
    purpose: Detect indexer usage
  - pattern: (graphql|query|gql)
    type: regex
    scope: source
    purpose: Detect GraphQL usage
  - pattern: (handleEvent|handleBlock)
    type: regex
    scope: source
    purpose: Detect event handlers
  file_patterns:
  - glob: '**/*.{ts,js}'
    purpose: Indexer code
  - glob: '**/subgraph.yaml'
    purpose: Subgraph manifest
  - glob: '**/*.graphql'
    purpose: GraphQL schema
signals:
  high:
  - id: INDEX-HIGH-001
    signal: Reorg handling missing
    evidence_indicators:
    - No reorg awareness
    - Reverted data remains
    - Inconsistent after reorg
    explanation: |
      Without reorg handling, indexer data becomes inconsistent
      when chain reorganizations occur.
    remediation: |
      - Implement reorg handling
      - Use supported reorg features
      - Test with reorg scenarios
      - Monitor for inconsistencies
  - id: INDEX-HIGH-002
    signal: Single indexer dependency
    evidence_indicators:
    - No fallback indexer
    - Hosted service only
    - Single point of failure
    explanation: |
      Single indexer dependency causes application failure
      when indexer is unavailable.
    remediation: |
      - Add fallback indexer
      - Run self-hosted backup
      - Implement direct chain fallback
      - Monitor indexer health
  medium:
  - id: INDEX-MED-001
    signal: Data freshness not checked
    evidence_indicators:
    - Stale data displayed
    - Sync status ignored
    - No freshness indicator
    explanation: |
      Applications may display stale data if indexer sync
      status is not checked.
    remediation: |
      - Check indexer sync status
      - Display freshness indicator
      - Handle stale data appropriately
      - Monitor sync lag
  - id: INDEX-MED-002
    signal: Schema mismatch possible
    evidence_indicators:
    - Contract changes not reflected
    - Schema out of date
    - New events not indexed
    explanation: |
      Schema mismatches cause missing or incorrect data when
      contracts are updated.
    remediation: |
      - Keep schema in sync
      - Update indexer with contracts
      - Test schema compatibility
      - Version schemas
  low:
  - id: INDEX-LOW-001
    signal: Query optimization missing
    evidence_indicators:
    - Slow queries
    - Excessive data fetched
    - No pagination
    explanation: |
      Unoptimized queries cause poor performance and may
      hit rate limits.
    remediation: |
      - Optimize query patterns
      - Implement pagination
      - Use query batching
      - Cache common queries
  - id: INDEX-LOW-002
    signal: Error handling insufficient
    evidence_indicators:
    - Query failures not caught
    - UI breaks on errors
    - No retry logic
    explanation: |
      Poor error handling causes application failures when
      indexer has issues.
    remediation: |
      - Catch all query errors
      - Implement retry logic
      - Show error states
      - Log for debugging
  positive:
  - id: INDEX-POS-001
    signal: Reliable indexer integration
    evidence_indicators:
    - Reorg handling
    - Fallback mechanism
    - Freshness checking
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: backend-engineer
  steps:
  - id: '1'
    name: Indexer Integration Analysis
    description: |
      Analyze indexer integration patterns.
    duration_estimate: 30 min
    commands:
    - purpose: Find indexer usage
      command: |
        grep -rniE "(subgraph|thegraph|graphql)" \
          --include="*.js" --include="*.ts" . 2>/dev/null | head -30
    - purpose: Find subgraph config
      command: |
        find . -name "subgraph.yaml" 2>/dev/null | head -5
    expected_findings:
    - Indexer integration
    - Query patterns
    - Error handling
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Indexer Analysis
    - Reliability Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 3
    blockchain:
      included: true
      priority: 3
closeout_checklist:
- id: index-001
  item: Reorg handling implemented
  level: BLOCKING
  verification: manual
  verification_notes: Verify indexer handles reorgs
  expected: Confirmed by reviewer
- id: index-002
  item: Fallback mechanism exists
  level: WARNING
  verification: manual
  verification_notes: Verify backup indexer available
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - dapp
    - analytics
    - frontend
relationships:
  commonly_combined:
  - blockchain.smart-contract-quality.event-emission
  - blockchain.consensus-network.fork-handling
  - blockchain.integration.rpc-provider
