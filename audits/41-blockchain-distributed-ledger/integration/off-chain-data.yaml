audit:
  id: blockchain-distributed-ledger.integration.off-chain-data
  name: Off-Chain Data Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: integration
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: software
  default_profiles:
  - full
  - blockchain
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates off-chain data integration including
    oracles and external data sources. It examines:
    - Data source reliability
    - Data freshness validation
    - Oracle decentralization
    - Fallback data sources
    - Data manipulation resistance
    - API integration security
  why_it_matters: |
    Off-chain data affects on-chain decisions:
    - Oracles can be manipulated
    - Stale data causes incorrect results
    - Single sources can fail or lie
    - API integrations expose attack surface
    - Data quality affects contract behavior

    Reliable off-chain data is critical for protocol function.
  when_to_run:
  - Oracle integration
  - External data usage
  - Price feed integration
  - API dependency review
prerequisites:
  required_artifacts:
  - type: source_code
    description: Oracle integration code
  - type: documentation
    description: Data source documentation
  access_requirements:
  - Integration source code
  - Data source specifications
discovery:
  code_patterns:
  - pattern: (oracle|chainlink|api3|band)
    type: regex
    scope: source
    purpose: Detect oracle usage
  - pattern: (fetch|request|callback)
    type: regex
    scope: source
    purpose: Detect data fetching
  - pattern: (httpGet|httpPost|request)
    type: regex
    scope: source
    purpose: Detect API calls
  file_patterns:
  - glob: '**/*.sol'
    purpose: Solidity contracts
  - glob: '**/*.{js,ts}'
    purpose: Off-chain code
signals:
  critical:
  - id: OFFCH-CRIT-001
    signal: Single centralized data source
    evidence_indicators:
    - One oracle/API dependency
    - No fallback source
    - Single point of failure
    explanation: |
      Single data sources can fail, be compromised, or provide
      incorrect data, with no alternative.
    remediation: |
      - Use decentralized oracles
      - Implement fallback sources
      - Aggregate multiple sources
      - Monitor source health
    cwe: CWE-757
  - id: OFFCH-CRIT-002
    signal: Data freshness not validated
    evidence_indicators:
    - Timestamp not checked
    - Stale data accepted
    - No freshness requirement
    explanation: |
      Stale data can differ significantly from current values,
      enabling exploitation with outdated information.
    remediation: |
      - Validate data timestamp
      - Define freshness threshold
      - Reject stale data
      - Monitor freshness
  high:
  - id: OFFCH-HIGH-001
    signal: Oracle response not validated
    evidence_indicators:
    - Response used without checks
    - Error responses not handled
    - Malformed data accepted
    explanation: |
      Unvalidated oracle responses may contain errors or
      malicious data.
    remediation: |
      - Validate all responses
      - Check response format
      - Handle errors gracefully
      - Bound acceptable values
  - id: OFFCH-HIGH-002
    signal: API key exposed
    evidence_indicators:
    - API key in contract
    - Key in public code
    - Unauthorized access possible
    explanation: |
      Exposed API keys allow unauthorized use and potential
      manipulation of data requests.
    remediation: |
      - Keep keys off-chain
      - Use secure key management
      - Rotate compromised keys
      - Limit key permissions
  medium:
  - id: OFFCH-MED-001
    signal: Callback not protected
    evidence_indicators:
    - Anyone can call callback
    - Oracle response spoofable
    - No callback authentication
    explanation: |
      Unprotected callbacks allow attackers to inject fake
      oracle responses.
    remediation: |
      - Verify callback caller
      - Use request ID matching
      - Authenticate responses
      - Test callback security
  - id: OFFCH-MED-002
    signal: No data source redundancy
    evidence_indicators:
    - Single source failure halts protocol
    - No degradation strategy
    - Hard dependency
    explanation: |
      Without redundancy, data source failures halt protocol
      operation.
    remediation: |
      - Implement redundancy
      - Design graceful degradation
      - Use multiple providers
      - Plan for outages
  low:
  - id: OFFCH-LOW-001
    signal: Data source not documented
    evidence_indicators:
    - Source not identified
    - Trust assumptions unclear
    - Data format undocumented
    explanation: |
      Undocumented data sources make security assessment and
      maintenance difficult.
    remediation: |
      - Document all data sources
      - Explain trust model
      - Describe data format
      - Note update frequency
  positive:
  - id: OFFCH-POS-001
    signal: Robust off-chain integration
    evidence_indicators:
    - Decentralized sources
    - Freshness validation
    - Proper error handling
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: integration-engineer
  steps:
  - id: '1'
    name: Off-Chain Data Analysis
    description: |
      Analyze off-chain data integration.
    duration_estimate: 30 min
    commands:
    - purpose: Find oracle usage
      command: |
        grep -rniE "(oracle|chainlink|api3)" \
          --include="*.sol" . 2>/dev/null | head -30
    - purpose: Find data validation
      command: |
        grep -rniE "(timestamp|updatedAt|freshness)" \
          --include="*.sol" . 2>/dev/null | head -20
    expected_findings:
    - Data sources used
    - Validation patterns
    - Error handling
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Data Source Analysis
    - Reliability Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 2
    blockchain:
      included: true
      priority: 2
closeout_checklist:
- id: offch-001
  item: Data freshness validated
  level: CRITICAL
  verification: manual
  verification_notes: Verify stale data is rejected
  expected: Confirmed by reviewer
- id: offch-002
  item: Multiple data sources
  level: WARNING
  verification: manual
  verification_notes: Verify fallback sources exist
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - defi
    - oracle-consumer
    - data-driven
relationships:
  commonly_combined:
  - blockchain.smart-contract-security.oracle-manipulation
  - blockchain.smart-contract-security.flash-loan-attack
  - blockchain.smart-contract-quality.error-handling

# Glossary of domain-specific terms:
glossary:
  "timelock": "Governance mechanism requiring delay between proposal and execution"
  "reentrancy": "Vulnerability where external call allows re-entering function before completion"
  "oracle": "External data feed providing off-chain information to smart contracts"
