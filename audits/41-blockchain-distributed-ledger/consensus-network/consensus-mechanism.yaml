audit:
  id: blockchain-distributed-ledger.consensus-network.consensus-mechanism
  name: Consensus Mechanism Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: consensus-network
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: infrastructure
  default_profiles:
  - full
  - blockchain
  blocks_phase: true
  parallelizable: true
description:
  what: |
    This audit evaluates the blockchain consensus mechanism selection
    and implementation for security and reliability. It examines:
    - Consensus algorithm selection (PoW, PoS, PoA, BFT)
    - Attack resistance (51%, long-range, nothing-at-stake)
    - Validator selection and incentives
    - Block finality guarantees
    - Network partition handling
    - Consensus parameter configuration
  why_it_matters: |
    Consensus mechanism is the foundation of blockchain security:
    - Wrong choice compromises entire network
    - 51% attacks can rewrite history
    - PoS has unique attack vectors
    - BFT consensus has validator limits
    - Finality affects application design

    Consensus security determines overall system trustworthiness.
  when_to_run:
  - Blockchain deployment planning
  - Network configuration review
  - Security assessment
  - Fork or upgrade planning
prerequisites:
  required_artifacts:
  - type: documentation
    description: Consensus mechanism documentation
  - type: configuration
    description: Consensus parameters
  access_requirements:
  - Network specifications
  - Validator information
discovery:
  code_patterns:
  - pattern: (consensus|validator|stake|epoch)
    type: regex
    scope: config
    purpose: Detect consensus configuration
  - pattern: (PoS|PoW|PoA|BFT|PBFT|Tendermint)
    type: regex
    scope: documentation
    purpose: Detect consensus type
  file_patterns:
  - glob: '**/genesis.json'
    purpose: Genesis configuration
  - glob: '**/config.toml'
    purpose: Node configuration
signals:
  critical:
  - id: CONS-CRIT-001
    signal: Consensus vulnerable to 51% attack
    evidence_indicators:
    - Low hash rate or stake concentration
    - Cheap attack cost
    - Insufficient validator distribution
    explanation: |
      51% attacks allow double-spending and chain reorganization.
      Attack cost must significantly exceed potential profit.
    remediation: |
      - Increase network hash rate or stake
      - Distribute validation more widely
      - Implement finality checkpoints
      - Monitor for attack indicators
  - id: CONS-CRIT-002
    signal: Validator set too centralized
    evidence_indicators:
    - Few validators control majority
    - Single entity controls consensus
    - Validator collusion risk
    explanation: |
      Centralized validation defeats decentralization benefits.
      Colluding validators can censor or manipulate transactions.
    remediation: |
      - Expand validator set
      - Implement validator diversity requirements
      - Add economic penalties for collusion
      - Monitor validator behavior
  high:
  - id: CONS-HIGH-001
    signal: Long-range attack vulnerability (PoS)
    evidence_indicators:
    - No checkpointing mechanism
    - Old keys can create alternative chain
    - Weak subjectivity not handled
    explanation: |
      In PoS, old validators can create alternative history from
      genesis. Long-range attacks require weak subjectivity
      assumptions and checkpointing.
    remediation: |
      - Implement regular checkpointing
      - Define weak subjectivity period
      - Require social consensus for deep reorgs
      - Document trust assumptions
  - id: CONS-HIGH-002
    signal: Nothing-at-stake not mitigated (PoS)
    evidence_indicators:
    - No slashing for equivocation
    - Validators can sign multiple forks
    - Fork voting cost is zero
    explanation: |
      Without slashing, PoS validators can sign all forks for
      free, undermining finality and enabling attacks.
    remediation: |
      - Implement slashing for double-signing
      - Require stake lockup
      - Penalize equivocation
      - Monitor for double-voting
  medium:
  - id: CONS-MED-001
    signal: Block time too long or variable
    evidence_indicators:
    - High block time variance
    - Unpredictable confirmation times
    - Poor UX from slow finality
    explanation: |
      Variable or long block times affect user experience and
      application design. Predictability is valuable.
    remediation: |
      - Tune consensus parameters
      - Monitor block time statistics
      - Document expected times
      - Consider fast finality chains
  - id: CONS-MED-002
    signal: Validator incentives misaligned
    evidence_indicators:
    - Rewards don't match costs
    - Rational behavior harms network
    - MEV extraction uncontrolled
    explanation: |
      Misaligned incentives lead validators to behavior that
      harms users or network health.
    remediation: |
      - Analyze validator economics
      - Align rewards with desired behavior
      - Control MEV extraction
      - Monitor validator profitability
  low:
  - id: CONS-LOW-001
    signal: Consensus parameters not documented
    evidence_indicators:
    - Block time, epoch unclear
    - Finality guarantees not stated
    - Attack costs not analyzed
    explanation: |
      Undocumented consensus parameters make security analysis
      and application design difficult.
    remediation: |
      - Document all parameters
      - State finality guarantees
      - Publish attack cost analysis
      - Keep documentation current
  positive:
  - id: CONS-POS-001
    signal: Robust consensus implementation
    evidence_indicators:
    - Proven consensus mechanism
    - Adequate decentralization
    - Attack resistance documented
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: security-architect
  steps:
  - id: '1'
    name: Consensus Analysis
    description: |
      Analyze consensus mechanism and parameters.
    duration_estimate: 60 min
    commands:
    - purpose: Check genesis configuration
      command: |
        find . -name "genesis.json" -o -name "genesis.yaml" 2>/dev/null | \
          xargs cat 2>/dev/null | head -100
    - purpose: Find consensus configuration
      command: |
        grep -rniE "(consensus|validator|epoch)" \
          --include="*.json" --include="*.toml" --include="*.yaml" . 2>/dev/null | head -30
    expected_findings:
    - Consensus type
    - Validator configuration
    - Finality parameters
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Consensus Analysis
    - Security Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 1
    blockchain:
      included: true
      priority: 1
closeout_checklist:
- id: cons-001
  item: 51% attack cost analyzed
  level: CRITICAL
  verification: manual
  verification_notes: Verify attack cost exceeds potential profit
  expected: Confirmed by reviewer
- id: cons-002
  item: Validator decentralization adequate
  level: BLOCKING
  verification: manual
  verification_notes: Verify no single entity controls consensus
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - l1
    - l2
    - private-chain
relationships:
  commonly_combined:
  - blockchain.consensus-network.node-configuration
  - blockchain.consensus-network.finality-guarantee
  - blockchain.key-management.private-key-security
