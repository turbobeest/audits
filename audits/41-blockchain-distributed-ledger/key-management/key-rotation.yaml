audit:
  id: blockchain-distributed-ledger.key-management.key-rotation
  name: Key Rotation Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: key-management
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: software
  default_profiles:
  - full
  - blockchain
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates key rotation mechanisms to limit exposure
    from compromised keys. It examines:
    - Rotation capability existence
    - Rotation procedures
    - Transition period handling
    - Old key revocation
    - Emergency rotation
    - Key version tracking
  why_it_matters: |
    Key rotation limits damage from compromise:
    - Compromised keys expire naturally
    - Regular rotation reduces exposure window
    - Old keys can be revoked
    - Supports incident response
    - Meets compliance requirements

    Rotation capability is essential for key lifecycle management.
  when_to_run:
  - Key management review
  - Security policy audit
  - Incident response planning
  - Compliance assessment
prerequisites:
  required_artifacts:
  - type: source_code
    description: Key rotation implementation
  - type: documentation
    description: Rotation procedures
  access_requirements:
  - Key management code
  - Rotation policy documentation
discovery:
  code_patterns:
  - pattern: (rotate|rotation|revoke|expire)
    type: regex
    scope: source
    purpose: Detect rotation mechanisms
  - pattern: (keyVersion|nonce|validUntil)
    type: regex
    scope: source
    purpose: Detect key versioning
  - pattern: (updateKey|changeOwner|setKey)
    type: regex
    scope: source
    purpose: Detect key update functions
  file_patterns:
  - glob: '**/*.{sol,js,ts}'
    purpose: Application code
signals:
  high:
  - id: KEYR-HIGH-001
    signal: No key rotation capability
    evidence_indicators:
    - Keys cannot be changed
    - No rotation function
    - Hardcoded keys
    explanation: |
      Without rotation capability, compromised keys remain valid
      indefinitely. This prevents incident response.
    remediation: |
      - Implement key rotation mechanism
      - Design for key changeability
      - Support emergency rotation
      - Plan upgrade path if needed
  - id: KEYR-HIGH-002
    signal: Old keys not revoked on rotation
    evidence_indicators:
    - Previous keys still valid
    - No revocation mechanism
    - Overlap window unlimited
    explanation: |
      If old keys remain valid after rotation, compromise of
      old keys still enables attack.
    remediation: |
      - Revoke old keys on rotation
      - Implement key expiration
      - Track valid key versions
      - Enforce revocation
  medium:
  - id: KEYR-MED-001
    signal: Rotation requires downtime
    evidence_indicators:
    - Key change not atomic
    - Service interruption during rotation
    - No overlap period
    explanation: |
      Rotation requiring downtime discourages regular rotation
      and complicates emergency response.
    remediation: |
      - Implement atomic key transition
      - Support key overlap period
      - Design for zero-downtime rotation
      - Test rotation procedure
  - id: KEYR-MED-002
    signal: Emergency rotation slow
    evidence_indicators:
    - Long rotation delay
    - Multi-step manual process
    - Waiting period for emergency
    explanation: |
      Slow emergency rotation extends damage window during
      active compromise.
    remediation: |
      - Design fast emergency rotation
      - Reduce timelock for emergency
      - Pre-authorize emergency rotation
      - Practice emergency procedures
  low:
  - id: KEYR-LOW-001
    signal: Rotation not scheduled
    evidence_indicators:
    - No rotation policy
    - Ad-hoc rotation only
    - Last rotation unknown
    explanation: |
      Without scheduled rotation, keys may remain unchanged
      indefinitely, accumulating risk.
    remediation: |
      - Define rotation policy
      - Schedule regular rotation
      - Track rotation history
      - Automate rotation reminders
  - id: KEYR-LOW-002
    signal: Rotation not tested
    evidence_indicators:
    - Rotation procedure untested
    - No rotation drill
    - Process may fail
    explanation: |
      Untested rotation may fail when needed, especially
      during emergency response.
    remediation: |
      - Test rotation regularly
      - Conduct rotation drills
      - Document test results
      - Update procedures from learnings
  positive:
  - id: KEYR-POS-001
    signal: Robust key rotation
    evidence_indicators:
    - Rotation capability exists
    - Old keys revoked
    - Emergency rotation available
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: security-auditor
  steps:
  - id: '1'
    name: Key Rotation Analysis
    description: |
      Analyze key rotation capability and procedures.
    duration_estimate: 30 min
    commands:
    - purpose: Find rotation mechanisms
      command: |
        grep -rniE "(rotate|rotation|revoke)" \
          --include="*.sol" --include="*.js" --include="*.ts" . 2>/dev/null | head -30
    - purpose: Find key update functions
      command: |
        grep -rniE "(updateKey|setKey|changeOwner)" \
          --include="*.sol" . 2>/dev/null | head -20
    expected_findings:
    - Rotation capability
    - Revocation handling
    - Key versioning
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Rotation Analysis
    - Capability Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 3
    blockchain:
      included: true
      priority: 3
closeout_checklist:
- id: keyr-001
  item: Key rotation capability exists
  level: BLOCKING
  verification: manual
  verification_notes: Verify keys can be rotated
  expected: Confirmed by reviewer
- id: keyr-002
  item: Old keys revoked on rotation
  level: WARNING
  verification: manual
  verification_notes: Verify previous keys are invalidated
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - enterprise
    - custody
    - compliance
relationships:
  commonly_combined:
  - blockchain.key-management.private-key-security
  - blockchain.key-management.multi-signature
  - blockchain.governance.admin-key-risk

# Glossary of domain-specific terms:
glossary:
  "timelock": "Governance mechanism requiring delay between proposal and execution"
  "reentrancy": "Vulnerability where external call allows re-entering function before completion"
  "oracle": "External data feed providing off-chain information to smart contracts"
