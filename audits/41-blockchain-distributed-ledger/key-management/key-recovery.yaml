audit:
  id: blockchain-distributed-ledger.key-management.key-recovery
  name: Key Recovery Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: key-management
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: software
  default_profiles:
  - full
  - blockchain
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates key recovery mechanisms to ensure users
    can recover access without compromising security. It examines:
    - Seed phrase generation and storage
    - Social recovery implementation
    - Backup encryption and distribution
    - Recovery flow security
    - Time-delay recovery
    - Guardian selection
  why_it_matters: |
    Key recovery balances security and usability:
    - Lost keys mean lost assets without recovery
    - Weak recovery enables account takeover
    - Social recovery requires trusted parties
    - Recovery delay prevents immediate theft
    - Users forget passwords and lose devices

    Secure recovery enables adoption without compromising security.
  when_to_run:
  - Wallet development
  - Recovery mechanism review
  - User experience audit
  - Security assessment
prerequisites:
  required_artifacts:
  - type: source_code
    description: Recovery mechanism code
  - type: documentation
    description: Recovery procedures
  access_requirements:
  - Recovery mechanism source
  - User flow documentation
discovery:
  code_patterns:
  - pattern: (recover|recovery|guardian|social)
    type: regex
    scope: source
    purpose: Detect recovery mechanisms
  - pattern: (mnemonic|seed|backup)
    type: regex
    scope: source
    purpose: Detect seed phrase handling
  - pattern: (timelock|delay|cooldown)
    type: regex
    scope: source
    purpose: Detect time delays
  file_patterns:
  - glob: '**/*.{sol,js,ts}'
    purpose: Application code
signals:
  critical:
  - id: RECOV-CRIT-001
    signal: Recovery enables immediate account takeover
    evidence_indicators:
    - No recovery delay
    - No notification to owner
    - Instant key replacement
    explanation: |
      Immediate recovery allows attackers who compromise recovery
      to instantly take over accounts before detection.
    remediation: |
      - Add time delay to recovery
      - Notify owner during delay
      - Allow cancellation during delay
      - Implement progressive delays
    cwe: CWE-287
  - id: RECOV-CRIT-002
    signal: Single guardian can recover
    evidence_indicators:
    - One guardian sufficient
    - Low guardian threshold
    - No multi-party requirement
    explanation: |
      Single guardian recovery means one compromised guardian
      enables account takeover.
    remediation: |
      - Require multiple guardians
      - Set appropriate threshold
      - Diversify guardian selection
      - Use time-based conditions
  high:
  - id: RECOV-HIGH-001
    signal: Seed phrase storage insecure
    evidence_indicators:
    - Seed stored in plaintext
    - Cloud backup unencrypted
    - Seed visible in screenshots
    explanation: |
      Insecure seed phrase storage enables theft through backup
      compromise, screenshots, or device access.
    remediation: |
      - Encrypt seed at rest
      - Disable screenshots during display
      - Warn users about secure storage
      - Consider encrypted cloud backup
  - id: RECOV-HIGH-002
    signal: Guardian selection vulnerable
    evidence_indicators:
    - Guardians can be same entity
    - No guardian verification
    - Guardians easily compromised
    explanation: |
      Weak guardian selection undermines social recovery security.
      Guardians must be diverse and trustworthy.
    remediation: |
      - Require guardian diversity
      - Verify guardian identity
      - Limit guardian overlap
      - Educate on guardian selection
  medium:
  - id: RECOV-MED-001
    signal: Recovery not tested
    evidence_indicators:
    - Users haven't tested recovery
    - No recovery drill
    - Process unclear to users
    explanation: |
      Untested recovery may fail when needed. Users should
      verify recovery works before relying on it.
    remediation: |
      - Prompt users to test recovery
      - Provide recovery testing mode
      - Document recovery steps clearly
      - Verify backup validity
  - id: RECOV-MED-002
    signal: Guardian notification missing
    evidence_indicators:
    - Guardians unaware of role
    - No activation notification
    - Guardian contact info not verified
    explanation: |
      Guardians must be reachable and aware of their role
      for recovery to work.
    remediation: |
      - Notify guardians of role
      - Verify guardian contact info
      - Alert guardians on recovery attempt
      - Provide guardian interface
  low:
  - id: RECOV-LOW-001
    signal: Recovery documentation incomplete
    evidence_indicators:
    - Recovery steps unclear
    - Edge cases not documented
    - User guidance missing
    explanation: |
      Unclear recovery documentation leads to errors or
      abandoned recovery attempts.
    remediation: |
      - Document all recovery paths
      - Provide step-by-step guides
      - Cover edge cases
      - Include troubleshooting
  positive:
  - id: RECOV-POS-001
    signal: Secure recovery implementation
    evidence_indicators:
    - Time delay implemented
    - Multi-guardian threshold
    - User notification
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: security-auditor
  steps:
  - id: '1'
    name: Recovery Mechanism Analysis
    description: |
      Analyze key recovery implementation.
    duration_estimate: 30 min
    commands:
    - purpose: Find recovery patterns
      command: |
        grep -rniE "(recover|guardian|social)" \
          --include="*.sol" --include="*.js" --include="*.ts" . 2>/dev/null | head -30
    - purpose: Find time delays
      command: |
        grep -rniE "(timelock|delay|cooldown)" \
          --include="*.sol" . 2>/dev/null | head -20
    expected_findings:
    - Recovery mechanisms
    - Guardian implementation
    - Time controls
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Recovery Analysis
    - Security Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 2
    blockchain:
      included: true
      priority: 2
closeout_checklist:
- id: recov-001
  item: Recovery has time delay
  level: CRITICAL
  verification: manual
  verification_notes: Verify recovery includes protective delay
  expected: Confirmed by reviewer
- id: recov-002
  item: Multi-party recovery required
  level: BLOCKING
  verification: manual
  verification_notes: Verify single party cannot recover alone
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - wallet
    - custody
    - consumer
relationships:
  commonly_combined:
  - blockchain.key-management.private-key-security
  - blockchain.key-management.multi-signature
  - blockchain.smart-contract-security.access-control

# Glossary of domain-specific terms:
glossary:
  "timelock": "Governance mechanism requiring delay between proposal and execution"
  "reentrancy": "Vulnerability where external call allows re-entering function before completion"
  "oracle": "External data feed providing off-chain information to smart contracts"
