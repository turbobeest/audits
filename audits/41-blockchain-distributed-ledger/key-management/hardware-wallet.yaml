audit:
  id: blockchain-distributed-ledger.key-management.hardware-wallet
  name: Hardware Wallet Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: key-management
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: software
  default_profiles:
  - full
  - blockchain
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates hardware wallet integration for security
    and proper implementation. It examines:
    - Hardware wallet integration correctness
    - Transaction signing flow
    - Address verification
    - Derivation path handling
    - Device communication security
    - Fallback handling
  why_it_matters: |
    Hardware wallets provide strong key protection:
    - Keys never leave secure element
    - Physical confirmation required
    - Resistant to malware
    - Address verification prevents attacks
    - Widely trusted in ecosystem

    Proper integration is essential to maintain security benefits.
  when_to_run:
  - Hardware wallet integration
  - Signing flow review
  - Security audit
  - New device support
prerequisites:
  required_artifacts:
  - type: source_code
    description: Hardware wallet integration code
  - type: documentation
    description: Integration documentation
  access_requirements:
  - Integration source code
  - Hardware wallet for testing
discovery:
  code_patterns:
  - pattern: (ledger|trezor|hardware.*wallet)
    type: regex
    scope: source
    purpose: Detect hardware wallet usage
  - pattern: (derivation|path|hdPath|BIP44)
    type: regex
    scope: source
    purpose: Detect derivation paths
  - pattern: (getAddress|signTransaction|signMessage)
    type: regex
    scope: source
    purpose: Detect signing operations
  file_patterns:
  - glob: '**/*.{js,ts}'
    purpose: Integration code
signals:
  critical:
  - id: HWWAL-CRIT-001
    signal: Address not verified on device
    evidence_indicators:
    - Address used without verification
    - No display on hardware device
    - Address substitution possible
    explanation: |
      Without address verification on the hardware device,
      malware can substitute addresses for attacker addresses.
    remediation: |
      - Always verify addresses on device
      - Display address during signing
      - Prompt user to confirm address match
      - Reject unverified addresses
    cwe: CWE-345
  - id: HWWAL-CRIT-002
    signal: Transaction details not displayed
    evidence_indicators:
    - Blind signing enabled
    - Transaction details not shown
    - User signs without verification
    explanation: |
      Blind signing prevents users from verifying transaction
      details, enabling signing of malicious transactions.
    remediation: |
      - Require transaction display
      - Disable blind signing if possible
      - Show clear transaction details
      - Educate users on verification
  high:
  - id: HWWAL-HIGH-001
    signal: Derivation path not validated
    evidence_indicators:
    - Arbitrary derivation paths accepted
    - Non-standard paths used
    - Path injection possible
    explanation: |
      Malicious derivation paths can derive keys to addresses
      the attacker controls or expose other accounts.
    remediation: |
      - Validate derivation paths
      - Use standard paths (BIP44)
      - Restrict path modifications
      - Warn on non-standard paths
  - id: HWWAL-HIGH-002
    signal: Device communication not secured
    evidence_indicators:
    - USB communication unprotected
    - Man-in-middle possible
    - Device authenticity not verified
    explanation: |
      Unsecured device communication may allow interception
      or device spoofing.
    remediation: |
      - Use encrypted communication
      - Verify device authenticity
      - Check device certificates
      - Handle communication securely
  medium:
  - id: HWWAL-MED-001
    signal: No fallback for device unavailable
    evidence_indicators:
    - Application unusable without device
    - No graceful degradation
    - Error handling poor
    explanation: |
      Users should be able to view balances and prepare
      transactions even without device connected.
    remediation: |
      - Allow read-only operation without device
      - Provide clear device connection guidance
      - Handle disconnection gracefully
      - Queue transactions for later signing
  - id: HWWAL-MED-002
    signal: Firmware version not checked
    evidence_indicators:
    - Outdated firmware accepted
    - Security updates not enforced
    - Version not displayed
    explanation: |
      Outdated firmware may have known vulnerabilities.
      Users should be prompted to update.
    remediation: |
      - Check firmware version
      - Warn on outdated versions
      - Suggest firmware updates
      - Document minimum versions
  low:
  - id: HWWAL-LOW-001
    signal: Device setup guidance missing
    evidence_indicators:
    - No setup instructions
    - Security practices not explained
    - User education absent
    explanation: |
      Users need guidance on secure hardware wallet setup
      and usage.
    remediation: |
      - Provide setup guidance
      - Explain security practices
      - Link to manufacturer documentation
      - Cover backup procedures
  positive:
  - id: HWWAL-POS-001
    signal: Secure hardware wallet integration
    evidence_indicators:
    - Address verification implemented
    - Transaction display required
    - Derivation paths validated
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: security-auditor
  steps:
  - id: '1'
    name: Hardware Wallet Integration Analysis
    description: |
      Analyze hardware wallet integration security.
    duration_estimate: 30 min
    commands:
    - purpose: Find hardware wallet usage
      command: |
        grep -rniE "(ledger|trezor|hardware)" \
          --include="*.js" --include="*.ts" . 2>/dev/null | head -30
    - purpose: Find signing operations
      command: |
        grep -rniE "(signTransaction|signMessage|getAddress)" \
          --include="*.js" --include="*.ts" . 2>/dev/null | head -20
    expected_findings:
    - Hardware wallet integration
    - Signing implementation
    - Address handling
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Integration Analysis
    - Security Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 2
    blockchain:
      included: true
      priority: 2
closeout_checklist:
- id: hwwal-001
  item: Address verification on device
  level: CRITICAL
  verification: manual
  verification_notes: Verify addresses must be confirmed on device
  expected: Confirmed by reviewer
- id: hwwal-002
  item: Transaction details displayed
  level: BLOCKING
  verification: manual
  verification_notes: Verify transaction details shown for confirmation
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - wallet
    - custody
    - enterprise
relationships:
  commonly_combined:
  - blockchain.key-management.private-key-security
  - blockchain.key-management.multi-signature
  - blockchain.smart-contract-security.signature-verification
