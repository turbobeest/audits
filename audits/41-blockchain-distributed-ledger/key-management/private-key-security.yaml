audit:
  id: blockchain-distributed-ledger.key-management.private-key-security
  name: Private Key Security Audit
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: blockchain-distributed-ledger
  category_number: 41
  subcategory: key-management
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: software
  default_profiles:
  - full
  - blockchain
  - security
  blocks_phase: true
  parallelizable: true
description:
  what: |
    This audit evaluates private key security throughout the key
    lifecycle. It examines:
    - Key generation randomness
    - Key storage security
    - Key encryption at rest
    - Key access controls
    - Key transmission security
    - Key backup procedures
  why_it_matters: |
    Private keys control blockchain assets:
    - Compromised keys mean total loss of assets
    - Weak key generation enables prediction
    - Unencrypted storage enables theft
    - Key exposure in logs/errors is common
    - Key backup failures cause loss

    Private key security is the foundation of blockchain security.
  when_to_run:
  - Wallet development
  - Key management review
  - Security audit
  - Custody solution review
prerequisites:
  required_artifacts:
  - type: source_code
    description: Key handling code
  - type: documentation
    description: Key management procedures
  access_requirements:
  - Key management source code
  - Infrastructure documentation
discovery:
  code_patterns:
  - pattern: (privateKey|private_key|secretKey)
    type: regex
    scope: source
    purpose: Detect key handling
  - pattern: (generate.*key|createWallet|newAccount)
    type: regex
    scope: source
    purpose: Detect key generation
  - pattern: (encrypt|decrypt|kdf|pbkdf)
    type: regex
    scope: source
    purpose: Detect key encryption
  file_patterns:
  - glob: '**/*.{js,ts,py,sol}'
    purpose: Application code
  - glob: '**/.env*'
    purpose: Environment files
signals:
  critical:
  - id: PKEY-CRIT-001
    signal: Private key in source code or config
    evidence_indicators:
    - Hardcoded private key
    - Key in .env committed to repo
    - Key in configuration file
    explanation: |
      Hardcoded or committed keys are exposed to anyone with
      repository access, enabling immediate theft.
    remediation: |
      - Remove keys from code/config
      - Use secure key storage
      - Rotate exposed keys immediately
      - Add to .gitignore
    cwe: CWE-798
  - id: PKEY-CRIT-002
    signal: Weak key generation
    evidence_indicators:
    - Math.random() for key generation
    - Predictable seed values
    - Insufficient entropy source
    explanation: |
      Weak randomness in key generation enables attackers to
      predict or brute-force private keys.
    remediation: |
      - Use cryptographically secure RNG
      - Use hardware RNG where available
      - Verify entropy sources
      - Test key generation randomness
    cwe: CWE-330
  high:
  - id: PKEY-HIGH-001
    signal: Key stored unencrypted
    evidence_indicators:
    - Plain text key files
    - No encryption at rest
    - Key in database unencrypted
    explanation: |
      Unencrypted key storage allows theft if storage is
      compromised.
    remediation: |
      - Encrypt keys at rest
      - Use strong key derivation (Argon2, scrypt)
      - Implement secure key storage
      - Use hardware security modules
  - id: PKEY-HIGH-002
    signal: Key logged or exposed in errors
    evidence_indicators:
    - Key in log output
    - Key in error messages
    - Key visible in stack traces
    explanation: |
      Keys in logs or errors may be exposed through log
      aggregation, error reporting, or debugging output.
    remediation: |
      - Never log private keys
      - Redact keys from errors
      - Review logging for key exposure
      - Use structured logging with filtering
  medium:
  - id: PKEY-MED-001
    signal: Key backup procedures weak
    evidence_indicators:
    - No key backup
    - Unencrypted backup
    - Backup same location as primary
    explanation: |
      Weak backups risk key loss or theft from backup location.
    remediation: |
      - Implement encrypted backups
      - Store backups in separate location
      - Test backup restoration
      - Document backup procedures
  - id: PKEY-MED-002
    signal: Key access not audited
    evidence_indicators:
    - No access logging
    - Key use unmonitored
    - Unauthorized access not detected
    explanation: |
      Without audit logging, unauthorized key access may go
      undetected.
    remediation: |
      - Log all key access
      - Monitor for anomalies
      - Alert on suspicious access
      - Review access logs regularly
  low:
  - id: PKEY-LOW-001
    signal: Key management not documented
    evidence_indicators:
    - No key lifecycle documentation
    - Procedures unclear
    - Roles undefined
    explanation: |
      Undocumented key management leads to inconsistent practices
      and potential security gaps.
    remediation: |
      - Document key lifecycle
      - Define roles and responsibilities
      - Create key management policy
      - Train team members
  positive:
  - id: PKEY-POS-001
    signal: Secure key management
    evidence_indicators:
    - Keys encrypted at rest
    - Secure generation
    - Access audited
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: security-auditor
  steps:
  - id: '1'
    name: Key Security Analysis
    description: |
      Analyze private key handling security.
    duration_estimate: 60 min
    commands:
    - purpose: Find key handling
      command: |
        grep -rniE "(privateKey|private_key|secretKey)" \
          --include="*.js" --include="*.ts" --include="*.py" . 2>/dev/null | head -30
    - purpose: Check for hardcoded keys
      command: |
        grep -rniE "0x[a-fA-F0-9]{64}" \
          --include="*.js" --include="*.ts" --include="*.py" --include="*.env" . 2>/dev/null | head -10
    expected_findings:
    - Key handling patterns
    - Storage security
    - Potential exposures
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Key Security Analysis
    - Risk Assessment
    - Recommendations
profiles:
  membership:
    quick:
      included: false
    full:
      included: true
      priority: 1
    blockchain:
      included: true
      priority: 1
closeout_checklist:
- id: pkey-001
  item: No keys in source code
  level: CRITICAL
  verification: |
    grep -rniE "0x[a-fA-F0-9]{64}" \
      --include="*.js" --include="*.ts" --include="*.sol" . 2>/dev/null | \
      wc -l | xargs -I{} test {} -eq 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: pkey-002
  item: Keys encrypted at rest
  level: BLOCKING
  verification: manual
  verification_notes: Verify key storage is encrypted
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - blockchain
    - wallet
    - custody
    - financial
relationships:
  commonly_combined:
  - blockchain.key-management.multi-signature
  - blockchain.key-management.hardware-wallet
  - blockchain.smart-contract-security.access-control
