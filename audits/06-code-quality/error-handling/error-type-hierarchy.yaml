audit:
  id: code-quality.error-handling.error-type-hierarchy
  name: Error Type Hierarchy Assessment Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: error-handling
  tier: expert
  estimated_duration: 40 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: codebase
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the design and structure of custom exception/error type
    hierarchies in the codebase. This includes checking for proper inheritance
    relationships, meaningful error categorization, consistent naming, and
    appropriate granularity of error types.
  why_it_matters: |
    A well-designed error type hierarchy enables precise error handling,
    meaningful error categorization, and clear communication of failure modes.
    Poor hierarchies lead to catch blocks that are too broad or too narrow,
    inconsistent error handling, and difficulty in understanding what went wrong.
  when_to_run:
  - During API design
  - Error handling strategy reviews
  - When adding new error types
  - Architecture reviews
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  access_requirements:
  - Read access to source code repository
discovery:
  code_patterns:
  - pattern: class\s+\w*(Exception|Error)\s+extends
    type: regex
    scope: source
    purpose: Identify custom exception classes
  - pattern: interface\s+\w*Error
    type: regex
    scope: source
    purpose: Identify error interfaces
  - pattern: enum\s+\w*(Error|ErrorCode|ErrorType)
    type: regex
    scope: source
    purpose: Identify error code enums
  file_patterns:
  - glob: '**/*.{java,cs,ts,py,rb}'
    purpose: Object-oriented source files
  - glob: '**/errors/*.{java,ts}'
    purpose: Error definition directories
  - glob: '**/exceptions/*.{java,ts}'
    purpose: Exception definition directories
knowledge_sources:
  guides:
  - id: effective-java-exceptions
    name: Effective Java - Use Exceptions Only for Exceptional Conditions
    url: https://www.oreilly.com/library/view/effective-java/9780134686097/
    offline_cache: false
  - id: exception-design
    name: Exception Design Guidelines
    url: https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/exceptions
    offline_cache: true
  - id: clean-architecture-errors
    name: Clean Architecture - Error Handling
    url: https://blog.cleancoder.com/
    offline_cache: false
tooling:
  static_analysis:
  - tool: sonarqube
    purpose: Exception hierarchy analysis
    offline_capable: false
  - tool: checkstyle
    purpose: Java exception rules
    offline_capable: true
  - tool: custom-lint
    purpose: Error naming conventions
    offline_capable: true
  scripts:
  - id: error-hierarchy-scan
    language: bash
    purpose: Map exception hierarchy
    source: inline
    code: |
      # Find all custom exception classes
      grep -rn --include="*.{java,ts}" -E "class\s+\w*(Exception|Error)\s+extends" . 2>/dev/null | head -50
signals:
  critical:
  - id: EH-HIER-CRIT-001
    signal: All custom exceptions extend base Exception directly
    evidence_pattern: class\s+\w+Exception\s+extends\s+Exception
    explanation: |
      Flat exception hierarchies provide no semantic grouping, making
      it impossible to catch related exceptions together.
    remediation: Create intermediate base classes for error categories
  - id: EH-HIER-CRIT-002
    signal: Error types without proper base class
    evidence_pattern: class\s+\w+Error\s*\{|class\s+\w+Error\s+extends\s+Object
    explanation: |
      Custom errors that don't extend standard Error/Exception classes
      may not work correctly with error handling mechanisms.
    remediation: Extend from appropriate base error class
  high:
  - id: EH-HIER-HIGH-001
    signal: Deep exception hierarchy (>4 levels)
    evidence_pattern: exception_hierarchy_depth > 4
    explanation: |
      Very deep exception hierarchies are over-engineered and make
      it unclear which level to catch.
    remediation: Flatten hierarchy to 2-3 levels maximum
  - id: EH-HIER-HIGH-002
    signal: Duplicate exception types for same error condition
    evidence_pattern: multiple.*exception.*same.*condition
    explanation: |
      Duplicate exception types create confusion about which to use
      and inconsistent handling.
    remediation: Consolidate duplicate exception types
  medium:
  - id: EH-HIER-MED-001
    signal: Exception names don't follow conventions
    remediation: Follow naming convention (XxxException or XxxError)
    evidence_description: class\s+\w+(?<!Exception|Error)\s+extends\s+\w*Exception
  - id: EH-HIER-MED-002
    signal: Missing standard exception types
    evidence_pattern: no.*(ValidationException|NotFoundError)
    remediation: Create standard exceptions for common cases
  low:
  - id: EH-HIER-LOW-001
    signal: Exception classes without custom fields
    evidence_pattern: class\s+\w+Exception.*\{\s*\}
    remediation: Add contextual fields when useful
  positive:
  - id: EH-HIER-POS-001
    signal: Well-organized exception hierarchy
    evidence_pattern: 2-3.*level.*hierarchy
  - id: EH-HIER-POS-002
    signal: Domain-specific exception base classes
    evidence_pattern: (Application|Domain|Infrastructure)Exception
  - id: EH-HIER-POS-003
    signal: Error codes with exceptions
    evidence_pattern: errorCode|ErrorCode
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Exception Types
    description: |
      Find all custom exception/error types in the codebase to
      understand the current hierarchy.
    duration_estimate: 10 min
    commands:
    - purpose: Find exception classes
      command: |
        grep -rn --include="*.{java,ts}" -E "class\s+\w*(Exception|Error)\s+(extends|implements)" . 2>/dev/null | head -100
    - purpose: Find error interfaces
      command: |
        grep -rn --include="*.{java,ts}" -E "(interface|type)\s+\w*Error" . 2>/dev/null | head -30
    expected_findings:
    - Exception class inventory
    - Error interface inventory
  - id: '2'
    name: Map Hierarchy Relationships
    description: |
      Build a map of which exceptions extend which base classes
      to understand the hierarchy structure.
    duration_estimate: 10 min
    commands:
    - purpose: Find inheritance relationships
      command: |
        grep -rn --include="*.{java,ts}" -E "class\s+\w+\s+extends\s+\w*Exception" . 2>/dev/null | head -50
    expected_findings:
    - Hierarchy structure
    - Depth assessment
  - id: '3'
    name: Analyze Naming Conventions
    description: |
      Check if exception names follow consistent conventions
      and are descriptive.
    duration_estimate: 10 min
    expected_findings:
    - Naming convention adherence
    - Naming issues
  - id: '4'
    name: Evaluate Hierarchy Design
    description: |
      Assess whether the hierarchy enables appropriate catch
      granularity and semantic grouping.
    duration_estimate: 10 min
    expected_findings:
    - Design assessment
    - Improvement recommendations
output:
  deliverables:
  - type: finding_list
    format: structured
    content:
    - exception_name
    - parent_class
    - depth
    - issues
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Exception Hierarchy Map
    - Design Assessment
    - Recommendations
  confidence_guidance:
    high: Clear hierarchy issues detected
    medium: Potential issues, design review needed
    low: May be intentional design choice
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: exception-design
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires comprehensive hierarchy analysis
    full:
      included: true
      priority: 2
    quality:
      included: true
      priority: 1
closeout_checklist:
- id: error-hier-001
  item: Exception type inventory completed
  level: BLOCKING
  verification: |
    grep -rn --include="*.{java,ts}" -E "class\s+\w*(Exception|Error)\s+extends" . 2>/dev/null | wc -l
  expected: Count documented
- id: error-hier-002
  item: Hierarchy depth assessed
  level: WARNING
  verification: manual
  verification_notes: Review hierarchy depth
  expected: Max depth documented
- id: error-hier-003
  item: Naming conventions reviewed
  level: WARNING
  verification: manual
  verification_notes: Review exception naming
  expected: Conventions documented
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
  - framework: .NET Design Guidelines
    controls:
    - Exception Design
  - framework: Java Code Conventions
    controls:
    - Exception Naming
relationships:
  commonly_combined:
  - code-quality.error-handling.exception-granularity
  - code-quality.error-handling.error-message-quality
  - code-quality.documentation.api-documentation
