# ============================================================
# AUDIT FILE - Mutation Testing v1.0
# ============================================================

# ============================================================
# SECTION 1: IDENTITY & METADATA
# ============================================================

audit:
  id: "code-quality.testing.mutation-testing"

  name: "Mutation Testing"

  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "code-quality"
  category_number: 6
  subcategory: "testing"

  tier: "phd"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "complete"
  requires_runtime: true
  destructive: false

# ============================================================
# SECTION 2: EXECUTION CLASSIFICATION
# ============================================================

execution:
  automatable: "yes"

  severity: "medium"

  scope: "testing"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

# ============================================================
# SECTION 3: DESCRIPTION & RATIONALE
# ============================================================

description:
  what: |
    Evaluates test suite quality through mutation testing, which
    introduces small code changes (mutants) to verify that tests
    can detect them. Measures mutation score as an indicator of
    test effectiveness beyond simple coverage metrics.

  why_it_matters: |
    High code coverage doesn't guarantee test quality. Tests may
    execute code without meaningful assertions. Mutation testing
    reveals whether tests actually verify behavior by checking if
    they fail when code is intentionally broken.

  when_to_run:
    - "After achieving target coverage levels"
    - "When test quality is questioned"
    - "Periodic test suite assessment"
    - "Before major releases"

# ============================================================
# SECTION 4: PREREQUISITES
# ============================================================

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Complete source code repository"
    - type: "test_suite"
      description: "Passing test suite with reasonable coverage"

  access_requirements:
    - "Ability to run test suite"
    - "Mutation testing tool installed"
    - "Sufficient compute resources (mutation testing is CPU-intensive)"

# ============================================================
# SECTION 5: DISCOVERY SPECIFICATION
# ============================================================

discovery:
  file_patterns:
    - glob: "**/stryker.conf.*"
      purpose: "Stryker mutation testing configuration"
    - glob: "**/mutmut_config.py"
      purpose: "Python mutmut configuration"
    - glob: "**/pitest*"
      purpose: "Java PIT mutation testing"

# ============================================================
# SECTION 6: EXTERNAL KNOWLEDGE SOURCES
# ============================================================

knowledge_sources:
  guides:
    - id: "stryker-mutator"
      name: "Stryker Mutator Documentation"
      url: "https://stryker-mutator.io/docs/"
      offline_cache: true
    - id: "mutmut"
      name: "mutmut Documentation"
      url: "https://mutmut.readthedocs.io/"
      offline_cache: true

    - id: "xunit-patterns"
      name: "xUnit Test Patterns: Refactoring Test Code"
      url: "https://www.amazon.com/xUnit-Test-Patterns-Refactoring-Code/dp/0131495054"
      offline_cache: false

    - id: "working-effectively-legacy"
      name: "Working Effectively with Legacy Code"
      url: "https://www.oreilly.com/library/view/working-effectively-with/0131177052/"
      offline_cache: false

  papers:
    - id: "mutation-testing-study"
      title: "Are Mutants a Valid Substitute for Real Faults?"
      url: "https://homes.cs.washington.edu/~rjust/publ/mutants_real_faults_fse_2014.pdf"

# ============================================================
# SECTION 7: TOOLING & AUTOMATION
# ============================================================

tooling:
  static_analysis:
    - tool: "stryker"
      purpose: "JavaScript/TypeScript mutation testing"
      offline_capable: true
    - tool: "mutmut"
      purpose: "Python mutation testing"
      offline_capable: true
    - tool: "pitest"
      purpose: "Java mutation testing"
      offline_capable: true
    - tool: "go-mutesting"
      purpose: "Go mutation testing"
      offline_capable: true

  scripts:
    - id: "mutation-test-run"
      language: "bash"
      purpose: "Run mutation testing"
      source: "inline"
      code: |
        #!/bin/bash
        npx stryker run 2>/dev/null || mutmut run 2>/dev/null

# ============================================================
# SECTION 8: SIGNALS & FINDINGS TAXONOMY
# ============================================================

signals:
  critical:
    - id: "MUT-CRIT-001"
      signal: "Mutation score below 30%"
      evidence_pattern: "Very low percentage of mutants killed"
      explanation: |
        Extremely low mutation score indicates tests are not
        verifying behavior, just executing code.
      remediation: "Add meaningful assertions; review test quality"

  high:
    - id: "MUT-HIGH-001"
      signal: "Mutation score below 60% in critical modules"
      evidence_pattern: "Low mutation score in business logic"
      explanation: |
        Critical code with weak tests poses high regression risk.
      remediation: "Strengthen assertions in critical module tests"

    - id: "MUT-HIGH-002"
      signal: "Many survived mutants in conditional logic"
      evidence_pattern: "Boundary and conditional mutants surviving"
      explanation: |
        Survived conditional mutants indicate edge cases are
        not being tested.
      remediation: "Add boundary condition and edge case tests"

  medium:
    - id: "MUT-MED-001"
      signal: "Mutation score 60-75%"
      remediation: "Target specific survived mutants for improvement"

    - id: "MUT-MED-002"
      signal: "Arithmetic mutants surviving"
      remediation: "Add tests that verify calculations"

  low:
    - id: "MUT-LOW-001"
      signal: "Some equivalent mutants marked as survived"

  positive:
    - id: "MUT-POS-001"
      signal: "Mutation score above 80%"
    - id: "MUT-POS-002"
      signal: "Critical modules have high mutation coverage"

# ============================================================
# SECTION 9: EXECUTION PROCEDURE
# ============================================================

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Configure mutation testing"
      description: |
        Verify mutation testing tools are configured or set up
        initial configuration.
      duration_estimate: "20 min"
      commands:
        - purpose: "Check for Stryker config"
          command: "cat stryker.conf.js 2>/dev/null || cat stryker.conf.json 2>/dev/null"
      expected_findings:
        - "Mutation tool configuration"
        - "Files included/excluded"

    - id: "2"
      name: "Run mutation testing on critical modules"
      description: |
        Execute mutation testing focused on business-critical
        code to assess test quality.
      duration_estimate: "60-120 min"
      commands:
        - purpose: "Run Stryker on src directory"
          command: "npx stryker run --mutate 'src/**/*.ts' 2>&1 | tail -50"
      expected_findings:
        - "Mutation score"
        - "Survived mutant details"

    - id: "3"
      name: "Analyze survived mutants"
      description: |
        Review survived mutants to understand test weaknesses.
      duration_estimate: "30 min"
      expected_findings:
        - "Categories of survived mutants"
        - "Missing test scenarios"

    - id: "4"
      name: "Identify test improvements"
      description: |
        Based on survived mutants, identify specific tests
        that need strengthening.
      duration_estimate: "25 min"
      expected_findings:
        - "Tests needing better assertions"
        - "Missing edge case tests"

    - id: "5"
      name: "Establish baseline and targets"
      description: |
        Document current mutation score and set improvement
        targets.
      duration_estimate: "15 min"
      expected_findings:
        - "Baseline mutation score"
        - "Target score for improvement"

# ============================================================
# SECTION 10: OUTPUT SPECIFICATION
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Mutation Score Analysis"
        - "Survived Mutant Categories"
        - "Test Improvement Plan"

    - type: "metrics"
      format: "table"
      fields:
        - "mutation_score"
        - "mutants_killed"
        - "mutants_survived"
        - "mutants_timed_out"

  confidence_guidance:
    high: "Full mutation testing executed with detailed results"
    medium: "Partial mutation testing on critical modules"
    low: "Estimated from coverage and test inspection"

# ============================================================
# SECTION 11: OFFLINE SUPPORT
# ============================================================

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "stryker-mutator"
        priority: "recommended"

# ============================================================
# SECTION 12: PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: false
      reason: "Mutation testing is time-intensive"
    full:
      included: true
      priority: 3

# ============================================================
# SECTION 13: DETERMINISTIC VERIFICATION
# ============================================================

closeout_checklist:
  - id: "mutation-testing-001"
    item: "Mutation testing executed"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Confirm mutation test run completed"
    expected: "Confirmed by reviewer"

  - id: "mutation-testing-002"
    item: "Mutation score above 60%"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Review mutation score from report"
    expected: "Confirmed by reviewer"

  - id: "mutation-testing-003"
    item: "Survived mutants analyzed"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Document key survived mutant categories"
    expected: "Confirmed by reviewer"

# ============================================================
# SECTION 14: GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "ISO 25010"
      controls: ["Testability", "Reliability"]

# ============================================================
# SECTION 15: RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "code-quality.testing.unit-test-coverage"
    - "code-quality.static-analysis.code-complexity"
