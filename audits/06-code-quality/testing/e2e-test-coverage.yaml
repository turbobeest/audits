# ============================================================
# AUDIT FILE - E2E Test Coverage v1.0
# ============================================================

# ============================================================
# SECTION 1: IDENTITY & METADATA
# ============================================================

audit:
  id: "code-quality.testing.e2e-test-coverage"

  name: "E2E Test Coverage"

  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "code-quality"
  category_number: 6
  subcategory: "testing"

  tier: "expert"
  estimated_duration: "2-4 hours"  # median: 3h

  completeness: "complete"
  requires_runtime: true
  destructive: false

# ============================================================
# SECTION 2: EXECUTION CLASSIFICATION
# ============================================================

execution:
  automatable: "partial"

  severity: "high"

  scope: "testing"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: false

# ============================================================
# SECTION 3: DESCRIPTION & RATIONALE
# ============================================================

description:
  what: |
    Evaluates end-to-end test coverage for critical user journeys,
    business workflows, and system-wide scenarios. Assesses whether
    E2E tests verify the complete system from user perspective
    through all integrated components.

  why_it_matters: |
    E2E tests validate the system as users experience it, catching
    issues that unit and integration tests miss. They verify that
    all components work together correctly and that critical user
    workflows function properly in production-like conditions.

  when_to_run:
    - "Before major releases"
    - "After UI/UX changes"
    - "When modifying critical workflows"
    - "Periodic regression verification"

# ============================================================
# SECTION 4: PREREQUISITES
# ============================================================

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Complete source code repository"
    - type: "test_suite"
      description: "E2E test suite"
    - type: "running_system"
      description: "Deployed test environment"

  access_requirements:
    - "Test environment access"
    - "E2E testing tools configured"
    - "Test user accounts"

# ============================================================
# SECTION 5: DISCOVERY SPECIFICATION
# ============================================================

discovery:
  file_patterns:
    - glob: "**/*.e2e.test.*"
      purpose: "E2E test files"
    - glob: "**/e2e/**/*.test.*"
      purpose: "E2E test directory"
    - glob: "**/cypress/**/*.cy.*"
      purpose: "Cypress test files"
    - glob: "**/playwright/**/*.spec.*"
      purpose: "Playwright test files"
    - glob: "**/*.feature"
      purpose: "Cucumber/Gherkin feature files"

  code_patterns:
    - pattern: "cy\\.|page\\.|browser\\."
      type: "regex"
      scope: "source"
      purpose: "E2E framework API usage"
    - pattern: "Given|When|Then|And"
      type: "keyword"
      scope: "source"
      purpose: "BDD scenario patterns"

# ============================================================
# SECTION 6: EXTERNAL KNOWLEDGE SOURCES
# ============================================================

knowledge_sources:
  guides:
    - id: "cypress-docs"
      name: "Cypress Documentation"
      url: "https://docs.cypress.io/"
      offline_cache: true
    - id: "playwright-docs"
      name: "Playwright Documentation"
      url: "https://playwright.dev/docs/intro"
      offline_cache: true

    - id: "xunit-patterns"
      name: "xUnit Test Patterns: Refactoring Test Code"
      url: "https://www.amazon.com/xUnit-Test-Patterns-Refactoring-Code/dp/0131495054"
      offline_cache: false

    - id: "working-effectively-legacy"
      name: "Working Effectively with Legacy Code"
      url: "https://www.oreilly.com/library/view/working-effectively-with/0131177052/"
      offline_cache: false

# ============================================================
# SECTION 7: TOOLING & AUTOMATION
# ============================================================

tooling:
  static_analysis:
    - tool: "cypress"
      purpose: "E2E testing framework"
      offline_capable: true
    - tool: "playwright"
      purpose: "Cross-browser E2E testing"
      offline_capable: true
    - tool: "selenium"
      purpose: "Browser automation"
      offline_capable: true
    - tool: "puppeteer"
      purpose: "Chrome automation"
      offline_capable: true

  scripts:
    - id: "e2e-test-run"
      language: "bash"
      purpose: "Run E2E tests"
      source: "inline"
      code: |
        #!/bin/bash
        npx cypress run 2>/dev/null || npx playwright test 2>/dev/null

# ============================================================
# SECTION 8: SIGNALS & FINDINGS TAXONOMY
# ============================================================

signals:
  critical:
    - id: "E2E-CRIT-001"
      signal: "No E2E tests for critical user journeys"
      evidence_pattern: "Absence of E2E tests for checkout, login, etc."
      explanation: |
        Critical user workflows without E2E tests risk production
        failures that affect users directly.
      remediation: "Implement E2E tests for top 5-10 user journeys"

  high:
    - id: "E2E-HIGH-001"
      signal: "Authentication flows untested end-to-end"
      evidence_pattern: "No E2E tests for login, logout, password reset"
      explanation: |
        Authentication issues have severe user impact and
        security implications.
      remediation: "Add comprehensive auth flow E2E tests"

    - id: "E2E-HIGH-002"
      signal: "Payment/transaction flows untested"
      evidence_pattern: "No E2E tests for payment processing"
      explanation: |
        Payment flow failures directly impact revenue and
        user trust.
      remediation: "Implement E2E tests for all payment scenarios"

  medium:
    - id: "E2E-MED-001"
      signal: "E2E tests only cover happy paths"
      remediation: "Add error scenario and edge case E2E tests"

    - id: "E2E-MED-002"
      signal: "E2E tests not cross-browser"
      remediation: "Configure E2E suite for multiple browsers"

  low:
    - id: "E2E-LOW-001"
      signal: "E2E test execution time excessive"

  positive:
    - id: "E2E-POS-001"
      signal: "Critical journeys have E2E coverage"
    - id: "E2E-POS-002"
      signal: "E2E tests run in CI on every PR"

# ============================================================
# SECTION 9: EXECUTION PROCEDURE
# ============================================================

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory critical user journeys"
      description: |
        Identify the most critical user workflows that must
        be verified end-to-end.
      duration_estimate: "30 min"
      questions:
        - "What are the top 10 user journeys by business impact?"
        - "Which workflows involve payment or sensitive data?"
      expected_findings:
        - "Priority-ordered journey list"
        - "Business criticality assessment"

    - id: "2"
      name: "Map E2E tests to journeys"
      description: |
        Cross-reference critical journeys with existing E2E
        tests to identify coverage gaps.
      duration_estimate: "25 min"
      commands:
        - purpose: "Find E2E test files"
          command: "find . -name '*.e2e.*' -o -name '*.cy.*' -o -name '*.spec.ts' -path '*/e2e/*' 2>/dev/null | head -30"
      expected_findings:
        - "Journey to test mapping"
        - "Coverage gaps"

    - id: "3"
      name: "Run E2E test suite"
      description: |
        Execute E2E tests and analyze results.
      duration_estimate: "40 min"
      commands:
        - purpose: "Run Cypress tests"
          command: "npx cypress run --reporter spec 2>&1 | tail -50"
      expected_findings:
        - "Pass/fail results"
        - "Execution time"

    - id: "4"
      name: "Evaluate test stability"
      description: |
        Review E2E tests for flakiness and reliability.
      duration_estimate: "20 min"
      expected_findings:
        - "Flaky test identification"
        - "Stability metrics"

    - id: "5"
      name: "Verify CI/CD integration"
      description: |
        Check that E2E tests run in CI and gate deployments.
      duration_estimate: "15 min"
      commands:
        - purpose: "Check for E2E in CI"
          command: "grep -rn 'cypress\\|playwright\\|e2e' .github/workflows/ 2>/dev/null"
      expected_findings:
        - "E2E CI configuration"
        - "Deployment gating"

# ============================================================
# SECTION 10: OUTPUT SPECIFICATION
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "User Journey Coverage"
        - "Test Quality Assessment"
        - "Recommendations"

    - type: "metrics"
      format: "table"
      fields:
        - "critical_journeys_total"
        - "critical_journeys_covered"
        - "e2e_test_count"
        - "pass_rate"

  confidence_guidance:
    high: "Journeys mapped, tests executed and verified"
    medium: "Test presence confirmed, partial execution"
    low: "Estimated from test file analysis"

# ============================================================
# SECTION 11: OFFLINE SUPPORT
# ============================================================

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "cypress-docs"
        priority: "recommended"

# ============================================================
# SECTION 12: PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: false
      reason: "E2E analysis and execution requires significant time"
    full:
      included: true
      priority: 1

# ============================================================
# SECTION 13: DETERMINISTIC VERIFICATION
# ============================================================

closeout_checklist:
  - id: "e2e-test-001"
    item: "E2E tests exist"
    level: "CRITICAL"
    verification: "find . -name '*.e2e.*' -o -name '*.cy.*' 2>/dev/null | head -1 | grep -q . && echo PASS || echo FAIL"
    expected: "PASS"

  - id: "e2e-test-002"
    item: "Critical user journeys covered"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify top 5 journeys have E2E tests"
    expected: "Confirmed by reviewer"

  - id: "e2e-test-003"
    item: "E2E tests pass"
    level: "BLOCKING"
    verification: "npx cypress run 2>/dev/null && echo PASS || echo FAIL"
    expected: "PASS"

# ============================================================
# SECTION 14: GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "ISO 25010"
      controls: ["Functional Suitability", "Reliability"]

# ============================================================
# SECTION 15: RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "code-quality.testing.integration-test-coverage"
    - "code-quality.testing.visual-regression"
    - "code-quality.testing.accessibility-testing"
