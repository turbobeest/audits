# ============================================================
# AUDIT FILE - Accessibility Testing v1.0
# ============================================================

# ============================================================
# SECTION 1: IDENTITY & METADATA
# ============================================================

audit:
  id: "code-quality.testing.accessibility-testing"

  name: "Accessibility Testing"

  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "code-quality"
  category_number: 6
  subcategory: "testing"

  tier: "expert"
  estimated_duration: "2-4 hours"  # median: 3h

  completeness: "complete"
  requires_runtime: true
  destructive: false

# ============================================================
# SECTION 2: EXECUTION CLASSIFICATION
# ============================================================

execution:
  automatable: "partial"

  severity: "high"

  scope: "testing"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

# ============================================================
# SECTION 3: DESCRIPTION & RATIONALE
# ============================================================

description:
  what: |
    Evaluates accessibility (a11y) testing coverage including automated
    WCAG compliance checks, screen reader testing, keyboard navigation
    verification, and color contrast validation. Assesses both tooling
    and testing practices for accessibility.

  why_it_matters: |
    Accessibility is both a legal requirement (ADA, WCAG) and ethical
    imperative. Inaccessible applications exclude users with disabilities
    and create legal liability. Automated testing catches many common
    issues before they affect users.

  when_to_run:
    - "Before public releases"
    - "After UI changes"
    - "When addressing accessibility issues"
    - "Periodic compliance verification"

# ============================================================
# SECTION 4: PREREQUISITES
# ============================================================

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "UI source code"
    - type: "running_system"
      description: "Running application"

  access_requirements:
    - "Browser automation tools"
    - "Accessibility testing tools"

# ============================================================
# SECTION 5: DISCOVERY SPECIFICATION
# ============================================================

discovery:
  file_patterns:
    - glob: "**/*.a11y.test.*"
      purpose: "Accessibility test files"
    - glob: "**/accessibility/**/*.test.*"
      purpose: "Accessibility test directory"

  code_patterns:
    - pattern: "axe|toHaveNoViolations|a11y"
      type: "regex"
      scope: "source"
      purpose: "Accessibility testing patterns"
    - pattern: "aria-|role=|alt="
      type: "regex"
      scope: "source"
      purpose: "ARIA attribute usage"

# ============================================================
# SECTION 6: EXTERNAL KNOWLEDGE SOURCES
# ============================================================

knowledge_sources:
  specifications:
    - id: "wcag"
      name: "Web Content Accessibility Guidelines (WCAG) 2.1"
      url: "https://www.w3.org/WAI/WCAG21/quickref/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "axe-docs"
      name: "Axe Accessibility Testing"
      url: "https://www.deque.com/axe/"
      offline_cache: true
    - id: "jest-axe"
      name: "jest-axe Documentation"
      url: "https://github.com/nickcolley/jest-axe"
      offline_cache: true

    - id: "xunit-patterns"
      name: "xUnit Test Patterns: Refactoring Test Code"
      url: "https://www.amazon.com/xUnit-Test-Patterns-Refactoring-Code/dp/0131495054"
      offline_cache: false

    - id: "working-effectively-legacy"
      name: "Working Effectively with Legacy Code"
      url: "https://www.oreilly.com/library/view/working-effectively-with/0131177052/"
      offline_cache: false

# ============================================================
# SECTION 7: TOOLING & AUTOMATION
# ============================================================

tooling:
  static_analysis:
    - tool: "axe-core"
      purpose: "Automated WCAG testing"
      offline_capable: true
    - tool: "jest-axe"
      purpose: "Jest accessibility assertions"
      offline_capable: true
    - tool: "pa11y"
      purpose: "Accessibility test runner"
      offline_capable: true
    - tool: "Lighthouse"
      purpose: "Accessibility audit"
      offline_capable: true
    - tool: "eslint-plugin-jsx-a11y"
      purpose: "React accessibility linting"
      offline_capable: true

  scripts:
    - id: "a11y-test-run"
      language: "bash"
      purpose: "Run accessibility tests"
      source: "inline"
      code: |
        #!/bin/bash
        npx jest --testPathPattern=a11y 2>/dev/null || npx pa11y http://localhost:3000 2>/dev/null

# ============================================================
# SECTION 8: SIGNALS & FINDINGS TAXONOMY
# ============================================================

signals:
  critical:
    - id: "A11Y-CRIT-001"
      signal: "No automated accessibility testing"
      evidence_pattern: "Absence of axe or similar tooling"
      explanation: |
        Without automated a11y testing, WCAG violations can
        easily reach production, affecting users and creating
        legal risk.
      remediation: "Implement axe-core testing in component and E2E tests"

    - id: "A11Y-CRIT-002"
      signal: "Critical WCAG violations present"
      evidence_pattern: "Level A WCAG failures"
      explanation: |
        Level A violations are the most severe accessibility
        issues that prevent access for many users.
      remediation: "Fix all Level A violations immediately"

  high:
    - id: "A11Y-HIGH-001"
      signal: "Forms lack proper labeling"
      evidence_pattern: "Input elements without labels"
      explanation: |
        Unlabeled form fields are unusable for screen reader users.
      remediation: "Add proper labels or aria-label to all form inputs"

    - id: "A11Y-HIGH-002"
      signal: "Images lack alt text"
      evidence_pattern: "img elements without alt attribute"
      explanation: |
        Missing alt text makes images inaccessible to vision-
        impaired users.
      remediation: "Add meaningful alt text to all images"

  medium:
    - id: "A11Y-MED-001"
      signal: "Color contrast issues"
      remediation: "Ensure text meets WCAG contrast ratios"

    - id: "A11Y-MED-002"
      signal: "Keyboard navigation incomplete"
      remediation: "Ensure all interactive elements are keyboard accessible"

  low:
    - id: "A11Y-LOW-001"
      signal: "Minor ARIA attribute issues"

  positive:
    - id: "A11Y-POS-001"
      signal: "No WCAG Level A/AA violations"
    - id: "A11Y-POS-002"
      signal: "Accessibility testing in CI"

# ============================================================
# SECTION 9: EXECUTION PROCEDURE
# ============================================================

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Check for accessibility tooling"
      description: |
        Verify that accessibility testing tools are configured
        in the project.
      duration_estimate: "15 min"
      commands:
        - purpose: "Check for axe/jest-axe"
          command: "grep -rn 'axe\\|jest-axe\\|toHaveNoViolations' package.json 2>/dev/null"
        - purpose: "Check for a11y ESLint plugin"
          command: "grep -rn 'jsx-a11y' package.json .eslintrc* 2>/dev/null"
      expected_findings:
        - "Accessibility tools configured"
        - "Linting rules enabled"

    - id: "2"
      name: "Run automated accessibility tests"
      description: |
        Execute accessibility tests to identify WCAG violations.
      duration_estimate: "25 min"
      commands:
        - purpose: "Run axe tests"
          command: "npm run test:a11y 2>&1 | tail -50"
        - purpose: "Run Lighthouse audit"
          command: "npx lighthouse http://localhost:3000 --only-categories=accessibility --output=json 2>/dev/null | jq '.categories.accessibility.score'"
      expected_findings:
        - "WCAG violations"
        - "Accessibility score"

    - id: "3"
      name: "Review ARIA usage"
      description: |
        Analyze code for proper ARIA attribute usage.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find ARIA usage"
          command: "grep -rn 'aria-\\|role=' . --include='*.tsx' --include='*.jsx' 2>/dev/null | head -30"
      expected_findings:
        - "ARIA pattern usage"
        - "Potential misuse"

    - id: "4"
      name: "Check keyboard navigation"
      description: |
        Verify that interactive elements are keyboard accessible.
      duration_estimate: "20 min"
      expected_findings:
        - "Focus management"
        - "Tab order issues"

    - id: "5"
      name: "Verify CI integration"
      description: |
        Check that accessibility tests run in CI.
      duration_estimate: "10 min"
      commands:
        - purpose: "Check for a11y in CI"
          command: "grep -rn 'a11y\\|accessibility\\|axe\\|lighthouse' .github/workflows/ 2>/dev/null"
      expected_findings:
        - "CI accessibility configuration"
        - "Blocking behavior"

# ============================================================
# SECTION 10: OUTPUT SPECIFICATION
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "WCAG Compliance Status"
        - "Violation Inventory"
        - "Remediation Plan"

    - type: "metrics"
      format: "table"
      fields:
        - "level_a_violations"
        - "level_aa_violations"
        - "accessibility_score"
        - "automated_test_coverage"

  confidence_guidance:
    high: "Automated tests run, manual verification performed"
    medium: "Automated scan completed"
    low: "Partial scanning only"

# ============================================================
# SECTION 11: OFFLINE SUPPORT
# ============================================================

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag"
        priority: "required"

# ============================================================
# SECTION 12: PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: false
      reason: "Accessibility testing requires running application"
    full:
      included: true
      priority: 1

# ============================================================
# SECTION 13: DETERMINISTIC VERIFICATION
# ============================================================

closeout_checklist:
  - id: "accessibility-001"
    item: "Accessibility testing configured"
    level: "CRITICAL"
    verification: "grep -rq 'axe\\|jest-axe' package.json && echo PASS || echo FAIL"
    expected: "PASS"

  - id: "accessibility-002"
    item: "No Level A WCAG violations"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Run axe and verify no critical violations"
    expected: "Confirmed by reviewer"

  - id: "accessibility-003"
    item: "Accessibility tests in CI"
    level: "BLOCKING"
    verification: "grep -rq 'a11y\\|accessibility' .github/workflows/ && echo PASS || echo FAIL"
    expected: "PASS"

# ============================================================
# SECTION 14: GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["web-applications", "mobile-applications"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["Level A", "Level AA"]
    - framework: "ADA"
      controls: ["Section 508"]
    - framework: "EN 301 549"
      controls: ["European Accessibility"]

# ============================================================
# SECTION 15: RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "code-quality.testing.e2e-test-coverage"
    - "code-quality.testing.visual-regression"
