audit:
  id: code-quality.testing.unit-test-coverage
  name: Unit Test Coverage
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: testing
  tier: expert
  estimated_duration: 1-2 hours  # median: 1h
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: 'yes'
  severity: high
  scope: testing
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Measures unit test coverage across the codebase including line
    coverage, branch coverage, and function coverage. Identifies
    untested code paths and evaluates coverage quality beyond raw
    percentage metrics.
  why_it_matters: |
    Unit tests are the first line of defense against regressions and
    bugs. Low coverage means code changes are made without safety nets.
    However, coverage percentage alone doesn't guarantee test quality;
    meaningful assertions and edge case handling matter equally.
  when_to_run:
  - Every CI build
  - Before releases
  - During code review
  - Periodic quality assessment
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete source code repository
  - type: test_suite
    description: Existing unit test suite
  access_requirements:
  - Ability to run test suite
  - Coverage reporting tools installed
discovery:
  file_patterns:
  - glob: '**/*.test.js'
    purpose: JavaScript test files
  - glob: '**/*.spec.js'
    purpose: JavaScript spec files
  - glob: '**/*.test.ts'
    purpose: TypeScript test files
  - glob: '**/*.spec.ts'
    purpose: TypeScript spec files
  - glob: '**/test_*.py'
    purpose: Python test files
  - glob: '**/*_test.py'
    purpose: Python test files
  - glob: '**/*_test.go'
    purpose: Go test files
knowledge_sources:
  guides:
  - id: istanbul-coverage
    name: Istanbul Coverage Documentation
    url: https://istanbul.js.org/
    offline_cache: true
  - id: pytest-cov
    name: pytest-cov Documentation
    url: https://pytest-cov.readthedocs.io/
    offline_cache: true
  - id: xunit-patterns
    name: 'xUnit Test Patterns: Refactoring Test Code'
    url: https://www.amazon.com/xUnit-Test-Patterns-Refactoring-Code/dp/0131495054
    offline_cache: false
  - id: working-effectively-legacy
    name: Working Effectively with Legacy Code
    url: https://www.oreilly.com/library/view/working-effectively-with/0131177052/
    offline_cache: false
  learning_resources:
  - id: testing-book
    title: Unit Testing Principles, Practices, and Patterns
    type: book
    reference: Vladimir Khorikov, ISBN 978-1617296277
tooling:
  static_analysis:
  - tool: istanbul/nyc
    purpose: JavaScript/TypeScript coverage
    offline_capable: true
  - tool: pytest-cov
    purpose: Python coverage
    offline_capable: true
  - tool: go test -cover
    purpose: Go coverage
    offline_capable: true
  - tool: JaCoCo
    purpose: Java coverage
    offline_capable: true
  scripts:
  - id: coverage-report
    language: bash
    purpose: Generate coverage report
    source: inline
    code: |
      #!/bin/bash
      npm run test:coverage 2>/dev/null || pytest --cov=. 2>/dev/null || go test -cover ./... 2>/dev/null
signals:
  critical:
  - id: UTCOV-CRIT-001
    signal: No unit tests present
    evidence_pattern: Absence of test files in project
    explanation: |
      A codebase without unit tests has no regression protection
      and makes safe refactoring nearly impossible.
    remediation: Implement unit tests starting with critical business logic
  high:
  - id: UTCOV-HIGH-001
    signal: Overall coverage below 50%
    evidence_pattern: Coverage report showing <50% line coverage
    explanation: |
      Low coverage means most code changes are unverified,
      creating high regression risk.
    remediation: Prioritize testing critical paths; aim for 80% minimum
  - id: UTCOV-HIGH-002
    signal: Critical business logic untested
    evidence_pattern: 0% coverage on payment, auth, or core domain code
    explanation: |
      Business-critical code requires thorough testing to
      prevent costly production issues.
    remediation: Immediately add tests for critical modules
  medium:
  - id: UTCOV-MED-001
    signal: Coverage between 50-70%
    remediation: Incrementally improve coverage with each PR
  - id: UTCOV-MED-002
    signal: High line coverage but low branch coverage
    remediation: Add tests for edge cases and error paths
  low:
  - id: UTCOV-LOW-001
    signal: Utility code lacks tests
  positive:
  - id: UTCOV-POS-001
    signal: Coverage above 80% with good branch coverage
  - id: UTCOV-POS-002
    signal: Coverage thresholds enforced in CI
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Run test suite with coverage
    description: |
      Execute the test suite with coverage instrumentation
      to collect coverage data.
    duration_estimate: 20 min
    commands:
    - purpose: Run JavaScript tests with coverage
      command: npm run test:coverage 2>/dev/null || npx jest --coverage 2>/dev/null
    - purpose: Run Python tests with coverage
      command: pytest --cov=. --cov-report=term-missing 2>/dev/null | head -50
    expected_findings:
    - Overall coverage percentage
    - Per-file coverage breakdown
  - id: '2'
    name: Analyze coverage distribution
    description: |
      Examine coverage distribution across modules to
      identify poorly tested areas.
    duration_estimate: 15 min
    expected_findings:
    - Modules with lowest coverage
    - Coverage distribution pattern
  - id: '3'
    name: Evaluate branch coverage
    description: |
      Review branch coverage separately from line coverage
      to assess edge case testing.
    duration_estimate: 10 min
    expected_findings:
    - Branch coverage percentage
    - Untested branches
  - id: '4'
    name: Identify critical untested code
    description: |
      Correlate coverage gaps with business criticality
      to prioritize testing efforts.
    duration_estimate: 15 min
    expected_findings:
    - Critical code without tests
    - Risk assessment of gaps
  - id: '5'
    name: Verify CI coverage enforcement
    description: |
      Check that coverage thresholds are enforced in CI
      to prevent regression.
    duration_estimate: 10 min
    commands:
    - purpose: Check for coverage thresholds in CI
      command: grep -rn 'coverage\|threshold' .github/workflows/ package.json jest.config.* 2>/dev/null
        | head -20
    expected_findings:
    - Coverage threshold configuration
    - CI enforcement behavior
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Coverage Metrics
    - Critical Gaps
    - Improvement Plan
  - type: metrics
    format: table
    fields:
    - line_coverage
    - branch_coverage
    - function_coverage
    - files_below_threshold
  confidence_guidance:
    high: Coverage measured via instrumented test run
    medium: Coverage estimated from partial test run
    low: Coverage inferred without running tests
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: istanbul-coverage
      priority: recommended
profiles:
  membership:
    quick:
      included: true
      priority: 1
    full:
      included: true
      priority: 1
closeout_checklist:
- id: unit-test-coverage-001
  item: Unit tests exist
  level: CRITICAL
  verification: find . -name '*.test.*' -o -name '*_test.*' -o -name 'test_*' 2>/dev/null | head -1 |
    grep -q . && echo PASS || echo FAIL
  expected: PASS
- id: unit-test-coverage-002
  item: Coverage above 70%
  level: BLOCKING
  verification: manual
  verification_notes: Review coverage report for overall percentage
  expected: Confirmed by reviewer
- id: unit-test-coverage-003
  item: Coverage thresholds enforced in CI
  level: WARNING
  verification: grep -rq 'threshold\|coverageThreshold' package.json jest.config.* .github/workflows/
    2>/dev/null && echo PASS || echo FAIL
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Reliability
    - Testability
relationships:
  commonly_combined:
  - code-quality.testing.integration-test-coverage
  - code-quality.testing.mutation-testing
  - code-quality.static-analysis.code-complexity
