audit:
  id: code-quality.static-analysis.type-safety
  name: Type Safety
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: static-analysis
  tier: phd
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: 'yes'
  severity: high
  scope: codebase
  default_profiles:
  - full
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates type safety practices across the codebase including type
    annotation coverage, strictness levels, type inference quality, and
    runtime type validation. Assesses both static type checking configuration
    and actual type safety in practice.
  why_it_matters: |
    Strong type safety catches bugs at compile time rather than runtime,
    provides better IDE support and refactoring confidence, serves as
    documentation, and prevents entire classes of errors. Weak typing
    leads to runtime surprises and harder debugging.
  when_to_run:
  - Initial codebase assessment
  - Before enabling stricter type checking
  - After migrating from dynamic to typed language
  - Periodic quality monitoring
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete source code repository
  - type: configuration
    description: Type checker configuration (tsconfig.json, mypy.ini, etc.)
  access_requirements:
  - Read access to source code
  - Type checker tools installed
discovery:
  file_patterns:
  - glob: '**/tsconfig.json'
    purpose: TypeScript configuration
  - glob: '**/jsconfig.json'
    purpose: JavaScript type checking configuration
  - glob: '**/mypy.ini'
    purpose: Python mypy configuration
  - glob: '**/pyrightconfig.json'
    purpose: Python Pyright configuration
  - glob: '**/pyproject.toml'
    purpose: Python project configuration with type settings
  - glob: '**/*.pyi'
    purpose: Python type stub files
  - glob: '**/*.d.ts'
    purpose: TypeScript declaration files
  code_patterns:
  - pattern: :\s*any\b|as\s+any\b
    type: regex
    scope: source
    purpose: Detect TypeScript any usage
  - pattern: '#\s*type:\s*ignore'
    type: regex
    scope: source
    purpose: Detect Python type ignore comments
  - pattern: \bAny\b.*import.*typing
    type: regex
    scope: source
    purpose: Detect Python Any type usage
knowledge_sources:
  guides:
  - id: typescript-strict
    name: TypeScript Strict Mode
    url: https://www.typescriptlang.org/tsconfig#strict
    offline_cache: true
  - id: mypy-docs
    name: Mypy Documentation
    url: https://mypy.readthedocs.io/
    offline_cache: true
  - id: nist-800-218
    name: NIST SP 800-218 - Secure Software Development Framework
    url: https://csrc.nist.gov/publications/detail/sp/800-218/final
    offline_cache: false
  papers:
  - id: gradual-typing
    title: Gradual Typing for Functional Languages
    url: https://wphomes.soic.indiana.edu/jsiek/files/2016/04/gradual-typing.pdf
tooling:
  static_analysis:
  - tool: tsc
    purpose: TypeScript compiler for type checking
    offline_capable: true
  - tool: mypy
    purpose: Python static type checker
    offline_capable: true
  - tool: pyright
    purpose: Python static type checker (fast)
    offline_capable: true
  - tool: flow
    purpose: JavaScript static type checker
    offline_capable: true
  scripts:
  - id: type-coverage
    language: bash
    purpose: Check TypeScript type coverage
    source: inline
    code: |
      #!/bin/bash
      npx type-coverage --detail 2>/dev/null || echo "type-coverage not installed"
signals:
  critical:
  - id: TYPE-CRIT-001
    signal: Type checking disabled or not configured
    evidence_pattern: Absence of tsconfig.json or mypy.ini
    explanation: |
      Without type checking, an entire category of bugs goes
      undetected until runtime, significantly increasing defect
      risk and debugging time.
    remediation: Configure type checker with at least basic strictness
  high:
  - id: TYPE-HIGH-001
    signal: Strict mode disabled with many any types
    evidence_pattern: 'strict: false and high any usage'
    explanation: |
      Non-strict mode with prevalent any types provides minimal
      type safety benefits while creating false confidence.
    remediation: Enable strict mode incrementally; eliminate any types
  - id: TYPE-HIGH-002
    signal: Type coverage below 70%
    evidence_pattern: type-coverage output < 70%
    explanation: |
      Low type coverage means large portions of code lack
      type safety guarantees.
    remediation: Add type annotations to uncovered code; prioritize critical paths
  - id: TYPE-HIGH-003
    signal: Excessive type assertions bypassing safety
    evidence_pattern: 'High count of ''as'' casts or type: ignore'
    explanation: |
      Type assertions bypass the type checker and can hide
      actual type errors.
    remediation: Review and eliminate unsafe assertions; use type guards instead
  medium:
  - id: TYPE-MED-001
    signal: Implicit any parameters in functions
    remediation: Add explicit parameter type annotations
  - id: TYPE-MED-002
    signal: Missing return type annotations
    remediation: Add return type annotations for public functions
  low:
  - id: TYPE-LOW-001
    signal: Type annotations missing on internal functions
  positive:
  - id: TYPE-POS-001
    signal: Strict mode enabled with high type coverage
  - id: TYPE-POS-002
    signal: No any types in production code
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review type checker configuration
    description: |
      Examine type checker configuration to understand strictness
      levels and enabled checks.
    duration_estimate: 15 min
    commands:
    - purpose: Review TypeScript config
      command: cat tsconfig.json 2>/dev/null | head -50
    - purpose: Review mypy config
      command: cat mypy.ini 2>/dev/null || grep -A 20 '\[mypy\]' pyproject.toml 2>/dev/null
    expected_findings:
    - Strictness level configured
    - Enabled/disabled checks
  - id: '2'
    name: Run type checker
    description: |
      Execute type checker to identify current type errors
      and warnings.
    duration_estimate: 15 min
    commands:
    - purpose: Run TypeScript type check
      command: npx tsc --noEmit 2>&1 | head -50
    - purpose: Run mypy
      command: mypy . 2>&1 | head -50
    expected_findings:
    - Current type errors
    - Warning categories
  - id: '3'
    name: Measure type coverage
    description: |
      Calculate percentage of code covered by type annotations.
    duration_estimate: 15 min
    commands:
    - purpose: TypeScript type coverage
      command: npx type-coverage 2>/dev/null
    expected_findings:
    - Type coverage percentage
    - Files with lowest coverage
  - id: '4'
    name: Analyze any/ignore usage
    description: |
      Count and review uses of any type and type ignore
      comments that bypass safety.
    duration_estimate: 20 min
    commands:
    - purpose: Count TypeScript any usage
      command: 'grep -rn '': any\|as any'' . --include=''*.ts'' --include=''*.tsx'' 2>/dev/null | wc -l'
    - purpose: Count Python type ignores
      command: 'grep -rn ''type: ignore'' . --include=''*.py'' 2>/dev/null | wc -l'
    expected_findings:
    - Any/ignore counts
    - Patterns in any usage
  - id: '5'
    name: Verify CI type checking
    description: |
      Ensure type checking is enforced in CI/CD pipeline.
    duration_estimate: 10 min
    commands:
    - purpose: Check for type checking in CI
      command: grep -rn 'tsc\|mypy\|pyright' .github/workflows/ 2>/dev/null
    expected_findings:
    - CI type check configuration
    - Whether type errors block builds
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Type Safety Metrics
    - Configuration Review
    - Recommendations
  - type: metrics
    format: table
    fields:
    - type_coverage_percentage
    - any_usage_count
    - type_ignore_count
    - strict_mode_enabled
  confidence_guidance:
    high: Type coverage tools executed, configuration verified
    medium: Partial analysis, some metrics unavailable
    low: Manual estimation without tooling
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: typescript-strict
      priority: recommended
    - source_id: mypy-docs
      priority: recommended
profiles:
  membership:
    quick:
      included: false
      reason: Thorough type analysis requires time
    full:
      included: true
      priority: 1
closeout_checklist:
- id: type-safety-001
  item: Type checker configured for project
  level: CRITICAL
  verification: test -f tsconfig.json -o -f mypy.ini -o -f pyrightconfig.json && echo PASS || echo FAIL
  expected: PASS
- id: type-safety-002
  item: Type checking passes without errors
  level: BLOCKING
  verification: npx tsc --noEmit 2>&1 | grep -c 'error' | xargs test 0 -eq && echo PASS || echo FAIL
  expected: PASS
- id: type-safety-003
  item: Type coverage above 80%
  level: WARNING
  verification: manual
  verification_notes: Review type-coverage output
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Reliability
    - Maintainability
relationships:
  commonly_combined:
  - code-quality.static-analysis.null-safety
  - code-quality.static-analysis.linting-coverage
