audit:
  id: code-quality.static-analysis.security-scanning
  name: Security Scanning
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: static-analysis
  tier: phd
  estimated_duration: 2-4 hours  # median: 3h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: 'yes'
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - security
  blocks_phase: true
  parallelizable: true
description:
  what: |
    Performs comprehensive static application security testing (SAST)
    to identify security vulnerabilities in source code. Covers injection
    flaws, authentication issues, cryptographic weaknesses, sensitive data
    exposure, and other OWASP Top 10 vulnerabilities.
  why_it_matters: |
    Security vulnerabilities in code can lead to data breaches, system
    compromise, regulatory violations, and reputational damage. Static
    security analysis catches vulnerabilities early when they are cheapest
    to fix and before they reach production.
  when_to_run:
  - Every pull request
  - Before releases
  - After security-sensitive changes
  - Regular security audits
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete source code repository
  access_requirements:
  - Read access to source code
  - Security scanning tools installed or accessible
discovery:
  file_patterns:
  - glob: '**/*.py'
    purpose: Python source for security analysis
  - glob: '**/*.js'
    purpose: JavaScript source for security analysis
  - glob: '**/*.ts'
    purpose: TypeScript source for security analysis
  - glob: '**/*.java'
    purpose: Java source for security analysis
  - glob: '**/*.go'
    purpose: Go source for security analysis
  code_patterns:
  - pattern: eval\(|exec\(|subprocess\.call.*shell=True
    type: regex
    scope: source
    purpose: Detect command injection risks
  - pattern: \bpassword\s*=\s*['"][^'"]+['"]
    type: regex
    scope: source
    purpose: Detect hardcoded credentials
  - pattern: \bSQL\b.*\+|f['"].*SELECT|\bquery\(.*\+|\bexecute\(.*%
    type: regex
    scope: source
    purpose: Detect SQL injection patterns
  - pattern: innerHTML\s*=|document\.write\(|\$\(.*\)\.html\(
    type: regex
    scope: source
    purpose: Detect XSS vulnerabilities
knowledge_sources:
  specifications:
  - id: owasp-top10
    name: OWASP Top 10
    url: https://owasp.org/Top10/
    offline_cache: true
    priority: required
  - id: cwe-top25
    name: CWE Top 25 Most Dangerous Software Weaknesses
    url: https://cwe.mitre.org/top25/
    offline_cache: true
    priority: required
  guides:
  - id: owasp-testing
    name: OWASP Testing Guide
    url: https://owasp.org/www-project-web-security-testing-guide/
    offline_cache: true
  - id: nist-800-218
    name: NIST SP 800-218 - Secure Software Development Framework
    url: https://csrc.nist.gov/publications/detail/sp/800-218/final
    offline_cache: false
tooling:
  static_analysis:
  - tool: semgrep
    purpose: Multi-language SAST with custom rules
    offline_capable: true
  - tool: bandit
    purpose: Python security linting
    offline_capable: true
  - tool: eslint-plugin-security
    purpose: JavaScript security rules
    offline_capable: true
  - tool: gosec
    purpose: Go security checker
    offline_capable: true
  - tool: brakeman
    purpose: Ruby on Rails security scanner
    offline_capable: true
  - tool: CodeQL
    purpose: GitHub's semantic code analysis
    offline_capable: false
  - tool: SonarQube
    purpose: Comprehensive security analysis
    offline_capable: false
  scripts:
  - id: security-scan
    language: bash
    purpose: Run multiple security scanners
    source: inline
    code: |
      #!/bin/bash
      echo "=== Semgrep ===" && semgrep --config auto . 2>/dev/null
      echo "=== Bandit ===" && bandit -r . 2>/dev/null
      echo "=== gosec ===" && gosec ./... 2>/dev/null
signals:
  critical:
  - id: SEC-CRIT-001
    signal: SQL injection vulnerability
    evidence_pattern: String concatenation in SQL queries
    explanation: |
      SQL injection allows attackers to execute arbitrary SQL,
      potentially accessing, modifying, or deleting all data.
    remediation: Use parameterized queries or ORM; never concatenate user input
  - id: SEC-CRIT-002
    signal: Command injection vulnerability
    evidence_pattern: eval(), exec(), or shell=True with user input
    explanation: |
      Command injection allows remote code execution on the server.
    remediation: Use safe APIs; validate and sanitize all inputs
  - id: SEC-CRIT-003
    signal: Hardcoded credentials or API keys
    evidence_pattern: password=, api_key=, secret= with literal values
    explanation: |
      Hardcoded credentials can be extracted from code and used
      to compromise systems.
    remediation: Use environment variables or secrets management
  high:
  - id: SEC-HIGH-001
    signal: Cross-site scripting (XSS) vulnerability
    evidence_pattern: innerHTML, document.write with user input
    explanation: |
      XSS allows attackers to execute scripts in user browsers,
      stealing sessions or credentials.
    remediation: Use safe DOM APIs; escape output; implement CSP
  - id: SEC-HIGH-002
    signal: Insecure cryptography usage
    evidence_pattern: MD5, SHA1 for passwords; ECB mode; weak key sizes
    explanation: |
      Weak cryptography can be broken, exposing protected data.
    remediation: 'Use modern algorithms: bcrypt for passwords, AES-GCM, SHA-256+'
  - id: SEC-HIGH-003
    signal: Path traversal vulnerability
    evidence_pattern: File operations with user-controlled paths
    explanation: |
      Path traversal allows reading or writing arbitrary files.
    remediation: Validate and sanitize paths; use allowlists
  medium:
  - id: SEC-MED-001
    signal: Missing input validation
    remediation: Implement input validation at all entry points
  - id: SEC-MED-002
    signal: Sensitive data in logs
    remediation: Sanitize logs; never log credentials or PII
  low:
  - id: SEC-LOW-001
    signal: Missing security headers
  positive:
  - id: SEC-POS-001
    signal: No high/critical security findings
  - id: SEC-POS-002
    signal: Security scanning integrated in CI/CD
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Run SAST tools
    description: |
      Execute static application security testing tools
      appropriate for each language in the codebase.
    duration_estimate: 30 min
    commands:
    - purpose: Run Semgrep security rules
      command: semgrep --config auto . --severity ERROR --severity WARNING 2>/dev/null | head -100
    - purpose: Run Bandit for Python
      command: bandit -r . -ll 2>/dev/null | head -100
    - purpose: Run gosec for Go
      command: gosec ./... 2>/dev/null | head -100
    expected_findings:
    - Security vulnerabilities by severity
    - Vulnerability locations and types
  - id: '2'
    name: Check for hardcoded secrets
    description: |
      Scan for hardcoded credentials, API keys, and other
      sensitive values in code.
    duration_estimate: 15 min
    commands:
    - purpose: Search for hardcoded secrets
      command: grep -rn 'password\s*=\|api_key\s*=\|secret\s*=' . --include='*.py' --include='*.js' --include='*.ts'
        2>/dev/null | grep -v test | head -20
    expected_findings:
    - Potential hardcoded credentials
    - API keys in source code
  - id: '3'
    name: Analyze injection patterns
    description: |
      Search for patterns that indicate injection vulnerabilities
      (SQL, command, XSS).
    duration_estimate: 20 min
    commands:
    - purpose: Find potential SQL injection
      command: grep -rn 'execute.*%\|query.*+' . --include='*.py' --include='*.js' 2>/dev/null | head
        -20
    expected_findings:
    - Potential injection points
    - Unsafe query construction
  - id: '4'
    name: Review cryptography usage
    description: |
      Check for weak or deprecated cryptographic algorithms
      and implementations.
    duration_estimate: 15 min
    commands:
    - purpose: Find weak crypto algorithms
      command: grep -rn 'MD5\|SHA1\|DES\|ECB' . --include='*.py' --include='*.js' --include='*.java' 2>/dev/null
        | head -20
    expected_findings:
    - Deprecated algorithms in use
    - Cryptographic weaknesses
  - id: '5'
    name: Verify CI/CD security scanning
    description: |
      Ensure security scanning is integrated into the CI/CD
      pipeline and blocks on critical findings.
    duration_estimate: 10 min
    commands:
    - purpose: Check for security scanning in CI
      command: grep -rn 'semgrep\|bandit\|codeql\|security' .github/workflows/ 2>/dev/null
    expected_findings:
    - CI security scan configuration
    - Blocking behavior on findings
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Critical Findings
    - Vulnerability Inventory
    - Remediation Roadmap
  - type: metrics
    format: table
    fields:
    - critical_findings
    - high_findings
    - medium_findings
    - owasp_categories_affected
  confidence_guidance:
    high: Multiple tools confirm, manual verification performed
    medium: Single tool detection, pattern matches
    low: Heuristic detection, requires manual review
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: owasp-top10
      priority: required
    - source_id: cwe-top25
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Security scanning requires thorough analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: security-scanning-001
  item: No critical security vulnerabilities
  level: CRITICAL
  verification: semgrep --config auto . --severity ERROR --json 2>/dev/null | jq '.results | length' |
    xargs test 0 -eq && echo PASS || echo FAIL
  expected: PASS
- id: security-scanning-002
  item: No hardcoded credentials detected
  level: CRITICAL
  verification: manual
  verification_notes: Review secrets scan results
  expected: Confirmed by reviewer
- id: security-scanning-003
  item: Security scanning in CI/CD pipeline
  level: BLOCKING
  verification: grep -rq 'semgrep\|codeql\|security' .github/workflows/ && echo PASS || echo FAIL
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: OWASP Top 10
    controls:
    - All categories
  - framework: SOC 2
    controls:
    - CC6.1
    - CC6.6
    - CC6.7
  - framework: PCI DSS
    controls:
    - '6.3'
    - '6.5'
relationships:
  commonly_combined:
  - code-quality.static-analysis.dependency-vulnerability
  - code-quality.static-analysis.static-analysis-ci
