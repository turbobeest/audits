# ============================================================
# AUDIT: God Class Detection
# ============================================================

audit:
  id: "code-quality.code-smells.god-class"
  name: "God Class Detection Audit"
  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "code-quality"
  category_number: 6
  subcategory: "code-smells"

  tier: "expert"
  estimated_duration: "45 minutes"

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "quality"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Identifies classes that have grown too large, taking on too many
    responsibilities. God classes typically have excessive lines of code,
    numerous methods and fields, low cohesion, and high coupling to many
    other classes. They violate the Single Responsibility Principle.

  why_it_matters: |
    God classes are difficult to understand, test, and maintain. They create
    tight coupling throughout the system, making changes risky. They become
    bottlenecks for team collaboration as multiple developers often need to
    modify the same file. Martin Fowler identifies the Large Class smell as
    a primary refactoring target.

  when_to_run:
    - "During architecture reviews"
    - "Before major refactoring"
    - "When classes exceed size thresholds"
    - "Technical debt assessments"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Application source code with class definitions"

  access_requirements:
    - "Read access to source code repository"

discovery:
  code_patterns:
    - pattern: "^\\s*(class|interface)\\s+\\w+"
      type: "regex"
      scope: "source"
      purpose: "Identify class declarations"

    - pattern: "^\\s*(public|private|protected).*\\s+\\w+\\s*\\("
      type: "regex"
      scope: "source"
      purpose: "Identify method declarations"

  file_patterns:
    - glob: "**/*.{java,cs,ts,py,rb}"
      purpose: "Object-oriented source files"

knowledge_sources:
  specifications:
    - id: "cwe-1080"
      name: "CWE-1080: Source Code File with Excessive Number of Lines of Code"
      url: "https://cwe.mitre.org/data/definitions/1080.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "fowler-refactoring"
      name: "Martin Fowler - Refactoring (Large Class)"
      url: "https://refactoring.com/catalog/extractClass.html"
      offline_cache: true

    - id: "clean-code"
      name: "Robert C. Martin - Clean Code (Classes)"
      url: "https://www.oreilly.com/library/view/clean-code-a/9780136083238/"
      offline_cache: false

    - id: "refactoring-fowler"
      name: "Martin Fowler - Refactoring"
      url: "https://refactoring.com/"
      offline_cache: false

    - id: "refactoring-catalog"
      name: "Refactoring Catalog"
      url: "https://refactoring.com/catalog/"
      offline_cache: false

tooling:
  static_analysis:
    - tool: "sonarqube"
      purpose: "God class and complexity detection"
      offline_capable: false
    - tool: "pmd"
      purpose: "Java god class detection"
      offline_capable: true
    - tool: "radon"
      purpose: "Python class metrics"
      offline_capable: true
    - tool: "eslint-plugin-sonarjs"
      purpose: "TypeScript/JavaScript cognitive complexity"
      offline_capable: true

  scripts:
    - id: "god-class-scan"
      language: "bash"
      purpose: "Detect large classes by line count"
      source: "inline"
      code: |
        # Find large class files
        find . -name "*.java" -o -name "*.ts" -o -name "*.py" | xargs wc -l 2>/dev/null | sort -rn | head -20

signals:
  critical:
    - id: "CS-GOD-CRIT-001"
      signal: "Class with more than 2000 lines of code"
      evidence_pattern: "class_loc > 2000"
      cwe: "CWE-1080"
      explanation: |
        Extremely large classes are virtually impossible to maintain and
        understand. They indicate severe architectural problems.
      remediation: "Extract classes using Extract Class refactoring"

    - id: "CS-GOD-CRIT-002"
      signal: "Class with more than 50 methods"
      evidence_pattern: "class_method_count > 50"
      cwe: "CWE-1080"
      explanation: |
        Classes with excessive methods have too many responsibilities
        and should be decomposed into focused collaborators.
      remediation: "Apply Single Responsibility Principle - split into focused classes"

  high:
    - id: "CS-GOD-HIGH-001"
      signal: "Class with 500-2000 lines of code"
      evidence_pattern: "500 < class_loc <= 2000"
      cwe: "CWE-1080"
      explanation: |
        Large classes are difficult to test comprehensively and often
        become change bottlenecks.
      remediation: "Identify cohesive groups of methods and extract classes"

    - id: "CS-GOD-HIGH-002"
      signal: "Class with more than 20 dependencies"
      evidence_pattern: "import_count > 20 || injection_count > 20"
      explanation: |
        High dependency count indicates low cohesion and too many
        responsibilities.
      remediation: "Apply Interface Segregation and extract focused classes"

  medium:
    - id: "CS-GOD-MED-001"
      signal: "Class with 20-50 methods"
      evidence_pattern: "20 < method_count <= 50"
      remediation: "Review for potential extraction opportunities"

    - id: "CS-GOD-MED-002"
      signal: "Class with more than 15 fields/properties"
      evidence_pattern: "field_count > 15"
      remediation: "Consider extracting data classes or value objects"

  low:
    - id: "CS-GOD-LOW-001"
      signal: "Class growing steadily over time"
      evidence_pattern: "class_loc_growth > 10% per month"
      remediation: "Monitor and establish growth limits"

  positive:
    - id: "CS-GOD-POS-001"
      signal: "All classes under 500 lines"
      evidence_pattern: "max_class_loc < 500"
    - id: "CS-GOD-POS-002"
      signal: "Average class size under 200 lines"
      evidence_pattern: "avg_class_loc < 200"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Measure Class Sizes"
      description: |
        Calculate lines of code for each class in the codebase to
        identify size outliers.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find large class files"
          command: |
            find . -name "*.java" -o -name "*.ts" -o -name "*.cs" 2>/dev/null | xargs wc -l 2>/dev/null | sort -rn | head -30
        - purpose: "Count methods in large files"
          command: |
            find . -name "*.java" | head -5 | xargs grep -c "^\s*(public|private|protected)" 2>/dev/null
      expected_findings:
        - "List of largest classes"
        - "Line counts per class"

    - id: "2"
      name: "Count Methods and Fields"
      description: |
        For identified large classes, count methods and fields to
        assess responsibility spread.
      duration_estimate: "10 min"
      commands:
        - purpose: "Count methods in TypeScript classes"
          command: |
            grep -rn --include="*.ts" -E "^\s*(public|private|protected|async)?\s*(static)?\s*\w+\s*\(" . 2>/dev/null | cut -d: -f1 | sort | uniq -c | sort -rn | head -20
      expected_findings:
        - "Method counts per class"
        - "Field counts per class"

    - id: "3"
      name: "Analyze Dependencies"
      description: |
        Count imports and constructor injections to assess coupling level.
      duration_estimate: "10 min"
      commands:
        - purpose: "Count imports per file"
          command: |
            grep -rn --include="*.{ts,java}" "^import" . 2>/dev/null | cut -d: -f1 | sort | uniq -c | sort -rn | head -20
      expected_findings:
        - "Import counts per class"
        - "Dependency injection counts"

    - id: "4"
      name: "Identify Refactoring Candidates"
      description: |
        Based on metrics, identify classes that should be prioritized
        for refactoring.
      duration_estimate: "10 min"
      expected_findings:
        - "Prioritized refactoring list"
        - "Suggested extraction points"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
      content:
        - "class_name"
        - "file_path"
        - "line_count"
        - "method_count"
        - "dependency_count"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "God Class Inventory"
        - "Metrics Analysis"
        - "Refactoring Recommendations"

  confidence_guidance:
    high: "Metrics clearly exceed thresholds"
    medium: "Metrics suggest potential issues"
    low: "Manual review recommended"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "fowler-refactoring"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive analysis"
    full:
      included: true
      priority: 1
    quality:
      included: true
      priority: 1

closeout_checklist:
  - id: "god-class-001"
    item: "Class size analysis completed"
    level: "BLOCKING"
    verification: |
      find . \( -name "*.java" -o -name "*.ts" -o -name "*.cs" \) 2>/dev/null | xargs wc -l 2>/dev/null | tail -1
    expected: "Analysis complete"

  - id: "god-class-002"
    item: "No classes exceed 2000 lines"
    level: "CRITICAL"
    verification: |
      find . \( -name "*.java" -o -name "*.ts" -o -name "*.cs" \) 2>/dev/null | xargs wc -l 2>/dev/null | awk '$1 > 2000 {count++} END {print count+0}'
    expected: "0"

  - id: "god-class-003"
    item: "Large classes documented"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Review output for classes > 500 lines"
    expected: "All documented"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "CWE"
      controls: ["CWE-1080"]
    - framework: "ISO 25010"
      controls: ["Maintainability", "Modularity"]

relationships:
  commonly_combined:
    - "code-quality.maintainability.cyclomatic-complexity"
    - "code-quality.code-smells.feature-envy"
    - "code-quality.code-smells.data-clump"
