audit:
  id: code-quality.technical-debt.deprecation-management
  name: Deprecation Management Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: technical-debt
  tier: expert
  estimated_duration: 1.5 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: codebase
  default_profiles:
  - full
  - maintenance
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates how deprecated code, APIs, and features are managed throughout
    their lifecycle. Reviews deprecation policies, communication practices,
    migration paths, and sunset timelines. Ensures deprecated elements are
    properly marked, documented, and eventually removed according to policy.
  why_it_matters: |
    Poor deprecation management leads to confusion, broken integrations, and
    accumulated dead code. Clear deprecation policies with migration paths
    enable consumers to transition smoothly. Without proper management,
    deprecated code remains indefinitely, increasing maintenance burden and
    security risk from unmaintained code paths.
  when_to_run:
  - Before major version releases
  - API evolution planning
  - Quarterly codebase cleanup
  - After dependency updates
prerequisites:
  required_artifacts:
  - type: source_code
    description: Codebase with API surfaces
  - type: documentation
    description: API documentation and changelogs
  - type: policy
    description: Deprecation policy if exists
  access_requirements:
  - Read access to source code
  - Access to API documentation
  - Access to changelog history
discovery:
  code_patterns:
  - pattern: '@deprecated|@Deprecated|deprecated'
    type: regex
    scope: source
    purpose: Find deprecated markers
  - pattern: '@obsolete|obsolete'
    type: regex
    scope: source
    purpose: Find obsolete markers
  - pattern: will.?be.?removed|scheduled.?for.?removal
    type: regex
    scope: comments
    purpose: Find removal notices
  - pattern: use.*instead|prefer.*instead|replaced.?by
    type: regex
    scope: comments
    purpose: Find migration guidance
  file_patterns:
  - glob: '**/CHANGELOG.md'
    purpose: Deprecation announcements
  - glob: '**/MIGRATION.md'
    purpose: Migration guides
  - glob: '**/DEPRECATION.md'
    purpose: Deprecation policy
knowledge_sources:
  specifications:
  - id: semver
    name: Semantic Versioning 2.0.0
    url: https://semver.org/
    offline_cache: true
    priority: required
  guides:
  - id: api-deprecation
    name: API Deprecation Best Practices
    url: https://cloud.google.com/apis/design/compatibility
    offline_cache: true
  - id: refactoring-fowler
    name: Martin Fowler - Refactoring
    url: https://refactoring.com/
    offline_cache: false
  - id: refactoring-catalog
    name: Refactoring Catalog
    url: https://refactoring.com/catalog/
    offline_cache: false
  - id: clean-code
    name: Robert C. Martin - Clean Code
    url: https://www.oreilly.com/library/view/clean-code-a/9780136083238/
    offline_cache: false
tooling:
  static_analysis:
  - tool: eslint
    purpose: Deprecated API usage detection
    offline_capable: true
  - tool: jsdoc
    purpose: Documentation deprecation tags
    offline_capable: true
  scripts:
  - id: deprecation-scan
    language: bash
    purpose: Find deprecation markers
    source: inline
    code: |
      # Find all deprecated markers
      grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
        -E "@deprecated|@Deprecated|deprecated" .
signals:
  critical:
  - id: DEPR-CRIT-001
    signal: No deprecation policy
    evidence_pattern: absence of deprecation guidelines
    explanation: |
      Project has no defined deprecation policy. This leads to
      inconsistent deprecation practices and consumer confusion.
    remediation: Define deprecation policy with timelines and communication requirements
  - id: DEPR-CRIT-002
    signal: Deprecated code without migration path
    evidence_pattern: '@deprecated(?!.*use|.*instead|.*see|.*migrate)'
    explanation: |
      Code is marked deprecated but provides no guidance on
      alternatives. Consumers cannot migrate without guidance.
    remediation: Add migration guidance to all deprecation notices
  high:
  - id: DEPR-HIGH-001
    signal: Long-standing deprecated code (over 2 major versions)
    evidence_pattern: deprecated code older than 2 versions
    explanation: |
      Deprecated code has remained for multiple major versions,
      indicating incomplete deprecation process.
    remediation: Review and remove long-deprecated code or extend timeline with justification
  - id: DEPR-HIGH-002
    signal: Deprecated code without sunset date
    evidence_pattern: '@deprecated(?!.*version|.*date|.*removed)'
    explanation: |
      Deprecation has no defined removal timeline. Consumers
      cannot plan migration without known deadline.
    remediation: Add removal timeline to all deprecation notices
  medium:
  - id: DEPR-MED-001
    signal: Deprecated code still actively used internally
    evidence_pattern: deprecated functions called elsewhere
    remediation: Migrate internal usage before or alongside external deprecation
  - id: DEPR-MED-002
    signal: Missing deprecation warnings at runtime
    evidence_pattern: deprecated without runtime warning
    remediation: Add runtime warnings for deprecated API usage
  low:
  - id: DEPR-LOW-001
    signal: Inconsistent deprecation format
    evidence_pattern: mixed deprecation styles
    remediation: Standardize deprecation annotation format
  positive:
  - id: DEPR-POS-001
    signal: Clear deprecation policy documented
    evidence_pattern: DEPRECATION.md or policy section
  - id: DEPR-POS-002
    signal: Deprecations include migration paths
    evidence_pattern: '@deprecated.*use.*instead'
  - id: DEPR-POS-003
    signal: Changelog tracks deprecations
    evidence_pattern: '## Deprecated section in CHANGELOG'
procedure:
  context:
    cognitive_mode: methodical
    ensemble_role: lifecycle-auditor
  steps:
  - id: '1'
    name: Review Deprecation Policy
    description: |
      Examine existing deprecation policy and
      guidelines for the project.
    duration_estimate: 15 min
    commands:
    - purpose: Find deprecation policy
      command: |
        find . -name "*deprecat*" -type f 2>/dev/null
    - purpose: Check contributing guide
      command: |
        grep -i "deprecat" CONTRIBUTING.md 2>/dev/null
    expected_findings:
    - Policy documentation
    - Timeline guidelines
  - id: '2'
    name: Inventory Deprecated Code
    description: |
      Create inventory of all deprecated code,
      APIs, and features.
    duration_estimate: 25 min
    commands:
    - purpose: Find deprecated markers
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
          -E "@deprecated|@Deprecated" .
    - purpose: Find obsolete markers
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
          -i "obsolete" .
    expected_findings:
    - Deprecated code inventory
    - Count by component
  - id: '3'
    name: Analyze Migration Guidance
    description: |
      Verify deprecated items include clear
      migration paths and alternatives.
    duration_estimate: 20 min
    commands:
    - purpose: Check for migration guidance
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -A2 \
          "@deprecated" . | grep -i "use\|instead\|migrate"
    - purpose: Find migration docs
      command: |
        find . -name "*migration*" -o -name "*MIGRATE*" 2>/dev/null
    expected_findings:
    - Migration guidance coverage
    - Migration documentation
  - id: '4'
    name: Review Sunset Timelines
    description: |
      Verify deprecated items have defined
      removal timelines.
    duration_estimate: 15 min
    commands:
    - purpose: Check for removal dates
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -A2 \
          "@deprecated" . | grep -i "version\|date\|removed"
    - purpose: Check changelog for removals
      command: |
        grep -i "removed\|breaking" CHANGELOG.md 2>/dev/null | head -20
    expected_findings:
    - Timeline coverage
    - Historical removals
  - id: '5'
    name: Check Internal Usage
    description: |
      Verify deprecated code is not actively
      used within the codebase.
    duration_estimate: 15 min
    commands:
    - purpose: Find deprecated function names
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
          "@deprecated" . | grep -oE "function\s+\w+|def\s+\w+"
    expected_findings:
    - Internal usage analysis
    - Migration readiness
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Deprecation Inventory
    - Migration Guidance Assessment
    - Timeline Compliance
    - Recommendations
  confidence_guidance:
    high: Clear policy with complete migration paths
    medium: Deprecations exist but gaps in guidance
    low: Ad-hoc deprecation without policy
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: semver
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires lifecycle analysis
    full:
      included: true
      priority: 2
    maintenance:
      included: true
      priority: 1
closeout_checklist:
- id: depr-001
  item: Deprecation policy exists
  level: REQUIRED
  verification: |
    find . -name "*deprecat*" -type f 2>/dev/null | wc -l
  expected: Greater than 0 or documented elsewhere
- id: depr-002
  item: All deprecations have migration paths
  level: BLOCKING
  verification: |
    grep -r "@deprecated" . | wc -l
    grep -r "@deprecated" . | grep -i "use\|instead" | wc -l
  expected: Counts should match
- id: depr-003
  item: Deprecations have removal timelines
  level: WARNING
  verification: Manual review of deprecation notices
  agent_alternative: Use static analysis tools to generate metrics; check for existing code review comments
  expected: All have timelines
governance:
  applicable_to:
    archetypes:
    - library
    - api
    - platform
  compliance_frameworks:
  - framework: Semantic Versioning
    controls:
    - API Compatibility
  - framework: ISO 25010
    controls:
    - Maintainability
relationships:
  commonly_combined:
  - code-quality.technical-debt.migration-completeness
  - code-quality.documentation.changelog-maintenance
  - code-quality.documentation.api-documentation
