audit:
  id: code-quality.technical-debt.migration-completeness
  name: Migration Completeness Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: technical-debt
  tier: expert
  estimated_duration: 2 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: codebase
  default_profiles:
  - full
  - maintenance
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates completeness of ongoing or recent migrations including database
    schema migrations, framework upgrades, API version transitions, and code
    modernization efforts. Identifies incomplete migrations, orphaned migration
    code, and technical debt from partial transitions.
  why_it_matters: |
    Incomplete migrations create technical debt in the form of dual codepaths,
    compatibility layers, and mixed patterns. Each incomplete migration adds
    cognitive load and maintenance burden. Teams often start migrations but
    don't complete them, leaving code in inconsistent states that compound
    over time.
  when_to_run:
  - After major framework upgrades
  - Post database migrations
  - Quarterly codebase reviews
  - Before new migrations
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete codebase access
  - type: migration_files
    description: Database migrations
  - type: documentation
    description: Migration plans and documentation
  access_requirements:
  - Read access to all source code
  - Access to migration history
  - Access to version control history
discovery:
  code_patterns:
  - pattern: TODO.*migrat|FIXME.*migrat|migration.*incomplete
    type: regex
    scope: comments
    purpose: Find incomplete migration markers
  - pattern: legacy|LEGACY|v1_|_v1|old_|_old
    type: regex
    scope: source
    purpose: Find legacy code patterns
  - pattern: compatibility|compat_|backward
    type: regex
    scope: source
    purpose: Find compatibility layers
  - pattern: temporarily|temp_migration|migration_temp
    type: regex
    scope: source
    purpose: Find temporary migration code
  file_patterns:
  - glob: '**/migrations/**'
    purpose: Database migrations
  - glob: '**/db/migrate/**'
    purpose: Rails migrations
  - glob: '**/alembic/**'
    purpose: Python Alembic migrations
  - glob: '**/MIGRATION*.md'
    purpose: Migration documentation
knowledge_sources:
  specifications:
  - id: migration-patterns
    name: Database Migration Patterns
    url: https://martinfowler.com/articles/evodb.html
    offline_cache: true
    priority: recommended
  guides:
  - id: strangler-pattern
    name: Strangler Fig Application Pattern
    url: https://martinfowler.com/bliki/StranglerFigApplication.html
    offline_cache: true
  - id: refactoring-fowler
    name: Martin Fowler - Refactoring
    url: https://refactoring.com/
    offline_cache: false
  - id: refactoring-catalog
    name: Refactoring Catalog
    url: https://refactoring.com/catalog/
    offline_cache: false
  - id: clean-code
    name: Robert C. Martin - Clean Code
    url: https://www.oreilly.com/library/view/clean-code-a/9780136083238/
    offline_cache: false
tooling:
  static_analysis:
  - tool: custom
    purpose: Migration completeness analysis
    offline_capable: true
  scripts:
  - id: migration-scan
    language: bash
    purpose: Find migration artifacts
    source: inline
    code: |
      # Find migration-related code
      grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
        -i "migrat\|legacy\|compat" .
signals:
  critical:
  - id: MIG-CRIT-001
    signal: Abandoned migration in progress
    evidence_pattern: migration code with TODO over 6 months old
    explanation: |
      Migration was started but appears abandoned. Partial migrations
      create inconsistent code states and ongoing maintenance burden.
    remediation: Complete or rollback abandoned migrations
  - id: MIG-CRIT-002
    signal: Dual codepaths for same functionality
    evidence_pattern: v1 and v2 implementations both active
    explanation: |
      Multiple implementations of same functionality exist due to
      incomplete migration. This doubles maintenance and testing burden.
    remediation: Complete migration to single implementation
  high:
  - id: MIG-HIGH-001
    signal: Temporary compatibility layers persisting
    evidence_pattern: compat.*layer|backward.*compat
    explanation: |
      Compatibility layers meant to be temporary have become permanent.
      These add complexity and performance overhead.
    remediation: Complete migration and remove compatibility layers
  - id: MIG-HIGH-002
    signal: Orphaned migration code
    evidence_pattern: dead code from incomplete migration
    explanation: |
      Code from previous migration attempts remains unused but present.
      This creates confusion and maintenance burden.
    remediation: Remove orphaned migration code
  medium:
  - id: MIG-MED-001
    signal: Mixed patterns from partial migration
    evidence_pattern: old and new patterns coexisting
    remediation: Complete migration to consistent patterns
  - id: MIG-MED-002
    signal: Missing migration documentation
    evidence_pattern: migrations without documentation
    remediation: Document migration status and remaining work
  low:
  - id: MIG-LOW-001
    signal: No migration tracking
    evidence_pattern: no migration status documentation
    remediation: Create migration tracking document
  positive:
  - id: MIG-POS-001
    signal: Clean migration history
    evidence_pattern: complete migrations with cleanup
  - id: MIG-POS-002
    signal: Migration documentation current
    evidence_pattern: up-to-date migration status docs
  - id: MIG-POS-003
    signal: Consistent code patterns
    evidence_pattern: single pattern used throughout
procedure:
  context:
    cognitive_mode: investigative
    ensemble_role: migration-auditor
  steps:
  - id: '1'
    name: Inventory Active Migrations
    description: |
      Identify all ongoing or recently completed
      migrations in the codebase.
    duration_estimate: 25 min
    commands:
    - purpose: Find migration directories
      command: |
        find . -type d -name "*migration*" 2>/dev/null
    - purpose: Find migration markers
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
          -i "TODO.*migrat\|FIXME.*migrat" .
    expected_findings:
    - Migration inventory
    - Incomplete migration markers
  - id: '2'
    name: Analyze Legacy Code Patterns
    description: |
      Search for legacy code patterns indicating
      incomplete migrations.
    duration_estimate: 25 min
    commands:
    - purpose: Find legacy markers
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
          -E "legacy|LEGACY|v1_|_v1|old_" .
    - purpose: Find compatibility layers
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
          -i "compat\|backward" .
    expected_findings:
    - Legacy code inventory
    - Compatibility layer count
  - id: '3'
    name: Check Database Migration Status
    description: |
      Review database migration files and their
      completion status.
    duration_estimate: 20 min
    commands:
    - purpose: List migration files
      command: |
        find . -path "*/migrations/*.py" -o -path "*/migrate/*.rb" 2>/dev/null | head -20
    - purpose: Check for pending migrations
      command: |
        # Framework-specific command
        ls -la migrations/ 2>/dev/null || ls -la db/migrate/ 2>/dev/null
    expected_findings:
    - Migration file inventory
    - Pending migration status
  - id: '4'
    name: Review Version Control History
    description: |
      Examine commit history for stalled migration
      branches or incomplete work.
    duration_estimate: 20 min
    commands:
    - purpose: Find migration-related branches
      command: |
        git branch -a 2>/dev/null | grep -i "migrat\|upgrade\|v2"
    - purpose: Check recent migration commits
      command: |
        git log --oneline --all --grep="migrat" 2>/dev/null | head -20
    expected_findings:
    - Migration branches
    - Migration commit history
  - id: '5'
    name: Assess Dual Codepaths
    description: |
      Identify cases where old and new implementations
      coexist for same functionality.
    duration_estimate: 30 min
    commands:
    - purpose: Find v1/v2 patterns
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
          -E "_v[12]|V[12]_|\bv[12]\b" .
    - purpose: Find new/old patterns
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" \
          -E "new_|_new|old_|_old" .
    expected_findings:
    - Dual implementation inventory
    - Cleanup candidates
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Migration Status Overview
    - Incomplete Migrations
    - Technical Debt Assessment
    - Recommendations
  confidence_guidance:
    high: All migrations complete with cleanup
    medium: Active migrations with clear plans
    low: Multiple incomplete migrations
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: migration-patterns
      priority: recommended
profiles:
  membership:
    quick:
      included: false
      reason: Requires deep code analysis
    full:
      included: true
      priority: 2
    maintenance:
      included: true
      priority: 1
closeout_checklist:
- id: mig-001
  item: No abandoned migrations
  level: CRITICAL
  verification: |
    grep -rn --include="*.{js,ts,py,java,go}" "TODO.*migrat" . | wc -l
  expected: 0 or documented exceptions
- id: mig-002
  item: No dual codepaths
  level: BLOCKING
  verification: |
    grep -rn --include="*.{js,ts,py,java,go}" -E "_v[12]|V[12]_" . | wc -l
  expected: 0 or documented temporary
- id: mig-003
  item: Migration status documented
  level: WARNING
  verification: |
    find . -name "*MIGRATION*" -type f 2>/dev/null | wc -l
  expected: Greater than 0
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
relationships:
  commonly_combined:
  - code-quality.technical-debt.deprecation-management
  - code-quality.technical-debt.legacy-code-isolation
  - code-quality.technical-debt.tech-debt-inventory
