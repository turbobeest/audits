audit:
  id: code-quality.maintainability.comment-ratio
  name: Comment Ratio Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: maintainability
  tier: expert
  estimated_duration: 30 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: low
  scope: codebase
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Measures the ratio of comments to code in the codebase. Analyzes comment
    density, distribution, and quality. Identifies areas that may be
    under-documented or over-commented with redundant information.
  why_it_matters: |
    Appropriate commenting aids understanding, but too few comments leave
    complex logic unexplained while too many clutter the code. Industry
    guidance suggests 10-20% comment ratio for most codebases. More important
    than quantity is comment quality - explaining "why" rather than "what".
  when_to_run:
  - Documentation audits
  - Code quality assessments
  - New developer onboarding preparation
  - Technical debt reviews
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  access_requirements:
  - Read access to source code
discovery:
  code_patterns:
  - pattern: //.*|/\*[^*]*\*+(?:[^/*][^*]*\*+)*/|#.*
    type: regex
    scope: source
    purpose: Identify comments
  - pattern: '"""[^"]*"""|''''''[^'']*'''''''
    type: regex
    scope: source
    purpose: Identify docstrings
  file_patterns:
  - glob: '**/*.{js,ts,py,java,go,rb,cs}'
    purpose: Source code files
knowledge_sources:
  guides:
  - id: clean-code-comments
    name: Clean Code - Comments
    url: https://www.oreilly.com/library/view/clean-code-a/9780136083238/
    offline_cache: true
    priority: required
  - id: pragmatic-programmer
    name: The Pragmatic Programmer
    url: https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/
    offline_cache: false
tooling:
  static_analysis:
  - tool: cloc
    purpose: Count lines of code and comments
    offline_capable: true
  - tool: lizard
    purpose: Code analysis with comment metrics
    offline_capable: true
  scripts:
  - id: comment-ratio
    language: bash
    purpose: Calculate comment ratio
    source: inline
    code: |
      cloc --quiet --json . 2>/dev/null | jq '.SUM | {code: .code, comment: .comment, ratio: (.comment / .code * 100)}'
signals:
  critical:
  - id: CR-CRIT-001
    signal: Comment ratio below 1%
    evidence_pattern: comment_ratio < 1%
    explanation: |
      Virtually no comments suggest complex logic goes unexplained,
      making the code very difficult for new developers to understand.
    remediation: Add documentation for complex sections
  high:
  - id: CR-HIGH-001
    signal: Complex files with no comments
    evidence_pattern: complex_file && comments == 0
    explanation: |
      Files with high complexity but no comments are particularly
      challenging to understand and maintain.
    remediation: Document complex algorithms and business logic
  - id: CR-HIGH-002
    signal: Comment ratio above 50%
    evidence_pattern: comment_ratio > 50%
    explanation: |
      Excessive commenting often indicates commented-out code,
      redundant comments, or code that is too complex.
    remediation: Remove dead code and redundant comments
  medium:
  - id: CR-MED-001
    signal: Comment ratio between 1-5%
    evidence_pattern: 1% <= comment_ratio < 5%
    remediation: Consider adding more documentation
  - id: CR-MED-002
    signal: Public APIs without documentation comments
    evidence_pattern: public_api_no_docs
    remediation: Add JSDoc/docstrings to public interfaces
  low:
  - id: CR-LOW-001
    signal: Commented-out code blocks
    evidence_pattern: commented_code_blocks
    remediation: Remove commented code, use version control
  positive:
  - id: CR-POS-001
    signal: Comment ratio between 10-20%
    evidence_pattern: 10% <= comment_ratio <= 20%
  - id: CR-POS-002
    signal: All public APIs documented
    evidence_pattern: api_documentation_complete
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Count Code and Comments
    description: |
      Use line counting tools to measure code, comment, and
      blank line counts across the codebase.
    duration_estimate: 10 min
    commands:
    - purpose: Run cloc analysis
      command: |
        cloc --by-file --quiet . 2>/dev/null | head -50
    - purpose: Get summary stats
      command: |
        cloc --quiet . 2>/dev/null
    expected_findings:
    - Line counts by category
    - Overall comment ratio
  - id: '2'
    name: Analyze Distribution
    description: |
      Examine how comments are distributed across files and
      modules.
    duration_estimate: 10 min
    expected_findings:
    - Comment ratio by file
    - Under-documented areas
    - Over-documented areas
  - id: '3'
    name: Assess Comment Quality
    description: |
      Sample comments to evaluate whether they explain "why"
      vs merely restating "what" the code does.
    duration_estimate: 10 min
    expected_findings:
    - Comment quality assessment
    - Redundant comment identification
output:
  deliverables:
  - type: metrics
    format: structured
    content:
    - overall_comment_ratio
    - comment_ratio_by_file
    - code_lines
    - comment_lines
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Comment Analysis
    - Distribution Assessment
    - Recommendations
  confidence_guidance:
    high: Full codebase analysis with cloc
    medium: Partial analysis or sampling
    low: Rough estimation only
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: clean-code-comments
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 3
    full:
      included: true
      priority: 2
    quality:
      included: true
      priority: 2
closeout_checklist:
- id: cr-001
  item: Comment ratio calculated
  level: BLOCKING
  verification: Numeric ratio available
  expected: Percentage value
- id: cr-002
  item: Under-documented areas identified
  level: WARNING
  verification: Low-comment files listed
  expected: Improvement candidates
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
relationships:
  commonly_combined:
  - code-quality.maintainability.naming-convention
  - code-quality.documentation.code-documentation
  - code-quality.documentation.api-documentation
