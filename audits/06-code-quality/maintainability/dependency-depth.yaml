audit:
  id: code-quality.maintainability.dependency-depth
  name: Dependency Depth Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: maintainability
  tier: expert
  estimated_duration: 45 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: medium
  scope: codebase
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Analyzes the depth and complexity of dependency chains in the codebase.
    Measures how many levels of transitive dependencies exist, identifies
    deep dependency paths that create fragility, and evaluates dependency
    tree complexity.
  why_it_matters: |
    Deep dependency chains create hidden coupling and make changes unpredictable.
    A change in a deeply nested dependency can cascade through many layers.
    Research shows projects with dependency depth > 5 have 2x more integration
    issues. Shallow, flat dependency structures are more maintainable and
    predictable.
  when_to_run:
  - Dependency audits
  - After adding new dependencies
  - Security vulnerability assessments
  - Build performance analysis
prerequisites:
  required_artifacts:
  - type: dependency_manifest
    description: Package dependency files (package.json, requirements.txt, etc.)
  - type: lock_file
    description: Dependency lock files for precise analysis
  access_requirements:
  - Read access to dependency files
discovery:
  file_patterns:
  - glob: '**/package.json'
    purpose: Node.js dependencies
  - glob: '**/package-lock.json'
    purpose: Node.js lock file
  - glob: '**/requirements.txt'
    purpose: Python dependencies
  - glob: '**/go.mod'
    purpose: Go dependencies
  - glob: '**/Cargo.toml'
    purpose: Rust dependencies
knowledge_sources:
  guides:
  - id: dependency-management
    name: Dependency Management Best Practices
    url: https://docs.npmjs.com/cli/v8/configuring-npm/package-lock-json
    offline_cache: true
  - id: clean-code
    name: Robert C. Martin - Clean Code
    url: https://www.oreilly.com/library/view/clean-code-a/9780136083238/
    offline_cache: false
  - id: pragmatic-programmer
    name: The Pragmatic Programmer
    url: https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/
    offline_cache: false
tooling:
  static_analysis:
  - tool: npm
    purpose: Node.js dependency tree
    offline_capable: true
  - tool: pipdeptree
    purpose: Python dependency tree
    offline_capable: true
  scripts:
  - id: dep-depth-check
    language: bash
    purpose: Analyze dependency depth
    source: inline
    code: |
      npm ls --all --depth=10 2>/dev/null | head -100
signals:
  critical:
  - id: DD-CRIT-001
    signal: Dependency chain depth > 10
    evidence_pattern: max_depth > 10
    explanation: |
      Extremely deep dependency chains create significant fragility.
      Updates to deeply nested dependencies can have unpredictable
      effects throughout the system.
    remediation: Review necessity of dependencies, consider alternatives
  - id: DD-CRIT-002
    signal: Multiple versions of same dependency at different depths
    evidence_pattern: duplicate_version_conflict
    explanation: |
      Version conflicts in dependency tree can cause runtime issues
      and unpredictable behavior.
    remediation: Deduplicate and align dependency versions
  high:
  - id: DD-HIGH-001
    signal: Dependency chain depth between 7-10
    evidence_pattern: 7 <= max_depth <= 10
    explanation: |
      High dependency depth increases build times, security surface
      area, and maintenance burden.
    remediation: Evaluate if all dependencies are necessary
  - id: DD-HIGH-002
    signal: More than 500 transitive dependencies
    evidence_pattern: transitive_count > 500
    explanation: |
      Large dependency trees increase security exposure and make
      updates complex and risky.
    remediation: Audit and reduce dependency footprint
  medium:
  - id: DD-MED-001
    signal: Dependency depth between 5-7
    evidence_pattern: 5 <= max_depth < 7
    remediation: Monitor and avoid adding more depth
  low:
  - id: DD-LOW-001
    signal: No dependency tree analysis performed
    evidence_pattern: no_dep_analysis
    remediation: Add dependency audit to CI pipeline
  positive:
  - id: DD-POS-001
    signal: Maximum dependency depth <= 4
    evidence_pattern: max_depth <= 4
  - id: DD-POS-002
    signal: Flat dependency structure with minimal nesting
    evidence_pattern: avg_depth < 2
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Generate Dependency Tree
    description: |
      Build complete dependency tree including all transitive
      dependencies.
    duration_estimate: 10 min
    commands:
    - purpose: Generate npm dependency tree
      command: |
        npm ls --all 2>/dev/null | head -200
    - purpose: Count total dependencies
      command: |
        npm ls --all --parseable 2>/dev/null | wc -l
    expected_findings:
    - Complete dependency tree
    - Total dependency count
  - id: '2'
    name: Calculate Depth Metrics
    description: |
      Determine maximum and average dependency chain depths.
    duration_estimate: 10 min
    expected_findings:
    - Maximum chain depth
    - Average chain depth
    - Deepest dependency paths
  - id: '3'
    name: Identify Version Conflicts
    description: |
      Find cases where the same dependency appears at multiple
      versions in the tree.
    duration_estimate: 15 min
    commands:
    - purpose: Find duplicate packages
      command: |
        npm ls --all 2>/dev/null | grep -E "deduped|UNMET" | head -50
    expected_findings:
    - Version conflict list
    - Deduplication opportunities
  - id: '4'
    name: Assess Critical Paths
    description: |
      Identify which deep dependencies are on critical paths
      for application functionality.
    duration_estimate: 10 min
    expected_findings:
    - Critical path dependencies
    - Reduction opportunities
output:
  deliverables:
  - type: metrics
    format: structured
    content:
    - max_dependency_depth
    - avg_dependency_depth
    - total_dependencies
    - version_conflicts
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Depth Analysis
    - Conflict Assessment
    - Recommendations
  confidence_guidance:
    high: Complete dependency tree with lock file
    medium: Dependency manifest without lock file
    low: Partial dependency information
offline:
  capability: full
profiles:
  membership:
    quick:
      included: true
      priority: 2
    full:
      included: true
      priority: 1
    quality:
      included: true
      priority: 2
closeout_checklist:
- id: dd-001
  item: Dependency tree analyzed
  level: BLOCKING
  verification: Tree generated and parsed
  expected: Depth metrics available
- id: dd-002
  item: Version conflicts documented
  level: WARNING
  verification: Conflict list generated
  expected: All conflicts identified
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: OWASP
    controls:
    - A06:2021 - Vulnerable Components
relationships:
  commonly_combined:
  - code-quality.maintainability.coupling
  - security-trust.supply-chain.dependency-audit
  - reliability-resilience.dependency.version-pinning
