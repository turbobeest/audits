audit:
  id: code-quality.maintainability.cyclomatic-complexity
  name: Cyclomatic Complexity Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: maintainability
  tier: expert
  estimated_duration: 45 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: high
  scope: codebase
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Measures the cyclomatic complexity (McCabe complexity) of functions and
    methods throughout the codebase. Cyclomatic complexity counts the number
    of linearly independent paths through code, calculated as the number of
    decision points (if, while, for, case, catch, &&, ||) plus one.
  why_it_matters: |
    High cyclomatic complexity correlates strongly with defect probability.
    NIST research shows functions with complexity >10 are 25% more likely
    to contain bugs. Code with complexity >20 is nearly impossible to test
    thoroughly and becomes a maintenance burden. Industry standards recommend
    keeping complexity under 10, with hard limits at 15.
  when_to_run:
  - During code reviews
  - Before major releases
  - During refactoring initiatives
  - Technical debt assessments
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  access_requirements:
  - Read access to source code
discovery:
  code_patterns:
  - pattern: if|else|while|for|case|catch|&&|\|\|
    type: regex
    scope: source
    purpose: Identify branching constructs
  file_patterns:
  - glob: '**/*.{js,ts,py,java,go,rb,cs}'
    purpose: Source code files
knowledge_sources:
  specifications:
  - id: mccabe-1976
    name: McCabe Complexity Metric (1976)
    url: https://www.mccabe.com/pdf/mccabe-nist235r.pdf
    offline_cache: true
    priority: required
  guides:
  - id: nist-complexity
    name: NIST Structured Testing - Cyclomatic Complexity
    url: https://www.mccabe.com/pdf/mccabe-nist235r.pdf
    offline_cache: true
  - id: clean-code
    name: Robert C. Martin - Clean Code
    url: https://www.oreilly.com/library/view/clean-code-a/9780136083238/
    offline_cache: false
  - id: pragmatic-programmer
    name: The Pragmatic Programmer
    url: https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/
    offline_cache: false
tooling:
  static_analysis:
  - tool: eslint
    purpose: JavaScript/TypeScript complexity analysis
    offline_capable: true
  - tool: radon
    purpose: Python complexity analysis
    offline_capable: true
  - tool: gocyclo
    purpose: Go complexity analysis
    offline_capable: true
  - tool: lizard
    purpose: Multi-language complexity analyzer
    offline_capable: true
  scripts:
  - id: complexity-scan
    language: bash
    purpose: Run complexity analysis
    source: inline
    code: |
      # Using lizard for multi-language support
      lizard --CCN 10 -w . 2>/dev/null || echo "Install lizard: pip install lizard"
signals:
  critical:
  - id: CC-CRIT-001
    signal: Functions with complexity > 50
    evidence_pattern: cyclomatic_complexity > 50
    cwe: CWE-1121
    explanation: |
      Extremely high complexity makes code virtually untestable and
      unmaintainable. Such functions are prime candidates for complete
      rewrite and are significant defect sources.
    remediation: Break function into smaller, focused functions
  - id: CC-CRIT-002
    signal: Critical path functions with complexity > 20
    evidence_pattern: critical_function && complexity > 20
    cwe: CWE-1121
    explanation: |
      High complexity in critical business logic or security functions
      increases risk of subtle bugs with significant impact.
    remediation: Prioritize refactoring of high-risk complex functions
  high:
  - id: CC-HIGH-001
    signal: Functions with complexity between 20-50
    evidence_pattern: 20 <= complexity <= 50
    cwe: CWE-1121
    explanation: |
      Functions in this range are difficult to test comprehensively
      and prone to containing hidden bugs. Testing all paths is
      impractical.
    remediation: Refactor to reduce complexity below 15
  - id: CC-HIGH-002
    signal: More than 10% of functions exceed complexity 10
    evidence_pattern: high_complexity_ratio > 10%
    explanation: |
      Significant portion of codebase exceeds recommended complexity
      limits, indicating systemic maintainability issues.
    remediation: Establish complexity limits in CI and refactor hotspots
  medium:
  - id: CC-MED-001
    signal: Functions with complexity between 10-20
    evidence_pattern: 10 <= complexity < 20
    remediation: Consider simplification when modifying these functions
  low:
  - id: CC-LOW-001
    signal: No complexity tooling configured
    evidence_pattern: no_complexity_tools
    remediation: Add complexity linting to CI pipeline
  positive:
  - id: CC-POS-001
    signal: Average complexity below 5
    evidence_pattern: avg_complexity < 5
  - id: CC-POS-002
    signal: No functions exceed complexity 10
    evidence_pattern: max_complexity <= 10
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Run Complexity Analysis
    description: |
      Execute complexity analysis tools against the entire codebase
      to gather metrics for all functions and methods.
    duration_estimate: 15 min
    commands:
    - purpose: Run lizard for multi-language analysis
      command: |
        lizard -l python -l javascript -l java -l go . 2>/dev/null
    - purpose: Run ESLint complexity rule
      command: |
        npx eslint --rule 'complexity: [warn, 10]' --format json . 2>/dev/null
    expected_findings:
    - Per-function complexity scores
    - Files with high complexity
  - id: '2'
    name: Identify Complexity Hotspots
    description: |
      Sort functions by complexity and identify the most problematic
      areas requiring attention.
    duration_estimate: 10 min
    expected_findings:
    - Top 20 most complex functions
    - Files with highest average complexity
  - id: '3'
    name: Calculate Distribution Statistics
    description: |
      Compute statistical measures of complexity distribution
      across the codebase.
    duration_estimate: 10 min
    expected_findings:
    - Average and median complexity
    - Percentage exceeding thresholds
    - Complexity by module/package
  - id: '4'
    name: Assess Impact and Priority
    description: |
      Evaluate which complex functions are in critical paths or
      frequently modified to prioritize remediation.
    duration_estimate: 10 min
    expected_findings:
    - Complex functions in critical paths
    - Complex functions with high churn
output:
  deliverables:
  - type: metrics
    format: structured
    content:
    - function_complexity_list
    - avg_complexity
    - max_complexity
    - threshold_violation_count
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Complexity Distribution
    - Hotspot Analysis
    - Recommendations
  confidence_guidance:
    high: Comprehensive analysis with tooling support
    medium: Partial language coverage
    low: Manual analysis only
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: mccabe-1976
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 2
    full:
      included: true
      priority: 1
    quality:
      included: true
      priority: 1
closeout_checklist:
- id: cc-001
  item: Complexity analysis completed
  level: BLOCKING
  verification: All source files analyzed
  expected: Complexity scores for all functions
- id: cc-002
  item: No critical complexity violations
  level: WARNING
  verification: No functions > 50 complexity
  expected: Zero critical violations
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
  - framework: CWE
    controls:
    - CWE-1121
relationships:
  commonly_combined:
  - code-quality.maintainability.cognitive-complexity
  - code-quality.maintainability.function-length
  - code-quality.technical-debt.debt-assessment
