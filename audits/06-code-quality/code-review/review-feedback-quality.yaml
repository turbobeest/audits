# ============================================================
# AUDIT: Review Feedback Quality
# ============================================================

audit:
  id: "code-quality.code-review.review-feedback-quality"
  name: "Review Feedback Quality Audit"
  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "code-quality"
  category_number: 6
  subcategory: "code-review"

  tier: "expert"
  estimated_duration: "1 hour"

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "repository"

  default_profiles:
    - "full"
    - "quality"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the quality and constructiveness of feedback provided during code
    reviews. Analyzes comment tone, actionability, specificity, and educational
    value. Identifies patterns of unhelpful feedback including vague criticism,
    unconstructive negativity, and missed opportunities for knowledge transfer.

  why_it_matters: |
    Review feedback quality directly impacts developer growth and team culture.
    Constructive reviews accelerate skill development and create psychological
    safety. Studies show developers receiving quality feedback improve code
    quality 40% faster. Toxic or unhelpful reviews increase turnover risk by
    2.5x and reduce collaboration.

  when_to_run:
    - "Team culture assessments"
    - "After developer satisfaction surveys"
    - "During review process improvements"
    - "Manager one-on-one preparation"

prerequisites:
  required_artifacts:
    - type: "review_comments"
      description: "Historical review comment content"
    - type: "pr_metadata"
      description: "Pull request context and outcomes"

  access_requirements:
    - "Access to review comment content"
    - "Historical PR data access"

discovery:
  code_patterns:
    - pattern: "nit:|style:|suggestion:|consider:|LGTM|looks good"
      type: "regex"
      scope: "review_comments"
      purpose: "Identify common feedback patterns"
    - pattern: "why did you|this is wrong|bad|terrible"
      type: "regex"
      scope: "review_comments"
      purpose: "Find potentially negative patterns"

  file_patterns:
    - glob: ".github/pull_request_template.md"
      purpose: "PR template with review guidance"
    - glob: "docs/review-guidelines.md"
      purpose: "Team review guidelines"

knowledge_sources:
  guides:
    - id: "google-review-comments"
      name: "Google - Writing Good Code Review Comments"
      url: "https://google.github.io/eng-practices/review/reviewer/comments.html"
      offline_cache: true
      priority: "required"
    - id: "kind-reviews"
      name: "How to Make Your Code Reviews Kinder"
      url: "https://www.alexandra-hill.com/2018/06/25/the-art-of-giving-and-receiving-code-reviews/"
      offline_cache: true

tooling:
  scripts:
    - id: "feedback-analysis"
      language: "bash"
      purpose: "Extract review comments for analysis"
      source: "inline"
      code: |
        gh pr list --state merged --limit 20 --json number,reviews \
          --jq '.[] | .reviews[].body'

signals:
  critical:
    - id: "RFQ-CRIT-001"
      signal: "Pattern of hostile or demeaning comments"
      evidence_pattern: "hostile_comment_pattern"
      explanation: |
        Review comments containing personal attacks, condescension, or
        humiliation create toxic culture and drive away talent.
      remediation: "Establish code of conduct for reviews and address with individuals"

  high:
    - id: "RFQ-HIGH-001"
      signal: "Majority of comments lack actionable suggestions"
      evidence_pattern: "non_actionable_rate > 50%"
      explanation: |
        Comments that identify problems without suggesting solutions leave
        authors frustrated and don't facilitate learning.
      remediation: "Train reviewers to include 'instead, try...' suggestions"

    - id: "RFQ-HIGH-002"
      signal: "Feedback frequently lacks context or reasoning"
      evidence_pattern: "unexplained_requests > 40%"
      explanation: |
        Requests without explanation don't help developers understand why
        changes are needed, missing educational opportunity.
      remediation: "Encourage 'because...' explanations in review comments"

  medium:
    - id: "RFQ-MED-001"
      signal: "Over-focus on style issues vs logic"
      evidence_pattern: "style_to_logic_ratio > 3"
      remediation: "Automate style checks, redirect review focus to design/logic"

    - id: "RFQ-MED-002"
      signal: "Inconsistent feedback standards across reviewers"
      evidence_pattern: "reviewer_quality_variance > 2x"
      remediation: "Develop shared review guidelines and training"

  low:
    - id: "RFQ-LOW-001"
      signal: "Limited use of positive reinforcement"
      evidence_pattern: "positive_comments < 10%"
      remediation: "Encourage acknowledging good patterns in reviews"

  positive:
    - id: "RFQ-POS-001"
      signal: "Comments include educational resources"
      evidence_pattern: "link_sharing_rate > 20%"
    - id: "RFQ-POS-002"
      signal: "Balanced positive and constructive feedback"
      evidence_pattern: "positive_rate > 20% && constructive_rate > 50%"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Collect Review Comments"
      description: |
        Extract review comments from a representative sample of PRs
        for qualitative and quantitative analysis.
      duration_estimate: "15 min"
      commands:
        - purpose: "Get review comments"
          command: |
            gh pr list --state merged --limit 30 --json number,reviews
      expected_findings:
        - "Comment content corpus"
        - "Reviewer-comment mapping"

    - id: "2"
      name: "Categorize Feedback Types"
      description: |
        Classify comments by type: style, logic, security, performance,
        design, and by tone: constructive, neutral, negative.
      duration_estimate: "20 min"
      expected_findings:
        - "Comment type distribution"
        - "Tone classification"

    - id: "3"
      name: "Assess Actionability"
      description: |
        Evaluate what percentage of comments include specific,
        actionable suggestions versus vague criticism.
      duration_estimate: "15 min"
      expected_findings:
        - "Actionable comment percentage"
        - "Suggestion inclusion rate"

    - id: "4"
      name: "Identify Patterns by Reviewer"
      description: |
        Analyze feedback patterns per reviewer to identify training
        needs or exemplary reviewers.
      duration_estimate: "10 min"
      expected_findings:
        - "Per-reviewer quality metrics"
        - "Best practice examples"

output:
  deliverables:
    - type: "metrics"
      format: "structured"
      content:
        - "actionable_comment_rate"
        - "positive_feedback_rate"
        - "comment_type_distribution"
        - "reviewer_quality_scores"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Feedback Quality Analysis"
        - "Reviewer Patterns"
        - "Recommendations"

  confidence_guidance:
    high: "Large sample with content analysis completed"
    medium: "Limited sample analyzed"
    low: "Insufficient data for meaningful analysis"

offline:
  capability: "minimal"

  cache_manifest:
    knowledge:
      - source_id: "google-review-comments"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires substantial manual analysis"
    full:
      included: true
      priority: 3
    quality:
      included: true
      priority: 1

closeout_checklist:
  - id: "rfq-001"
    item: "Comment sample analyzed"
    level: "BLOCKING"
    verification: "Minimum 50 comments reviewed"
    expected: "Analysis results available"

  - id: "rfq-002"
    item: "No hostile patterns identified"
    level: "CRITICAL"
    verification: "Hostile comment rate < 5%"
    expected: "Safe review environment"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "Team Health Metrics"
      controls: ["Psychological Safety"]

relationships:
  commonly_combined:
    - "code-quality.code-review.review-depth"
    - "code-quality.code-review.review-checklist"
    - "code-quality.code-review.review-metrics"
