audit:
  id: code-quality.code-review.codeowner-coverage
  name: Code Owner Coverage Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: code-review
  tier: expert
  estimated_duration: 30 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: medium
  scope: repository
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates the configuration and effectiveness of CODEOWNERS files in
    ensuring appropriate experts review changes to critical code areas.
    Analyzes coverage of the codebase, accuracy of ownership assignments,
    and enforcement of owner approval requirements.
  why_it_matters: |
    CODEOWNERS ensures domain experts review changes to code they understand
    deeply, catching subtle bugs that general reviewers might miss. Projects
    with comprehensive CODEOWNERS coverage report 35% fewer defects in critical
    components. Without proper ownership, changes to security-sensitive or
    complex areas may be reviewed by developers lacking necessary expertise.
  when_to_run:
  - After team restructuring
  - When adding new components
  - During onboarding new team members
  - Quarterly ownership reviews
prerequisites:
  required_artifacts:
  - type: codeowners_file
    description: CODEOWNERS file in repository
  - type: team_data
    description: Current team membership
  access_requirements:
  - Read access to repository
  - Access to organization member data
discovery:
  code_patterns:
  - pattern: ^[^#].*@
    type: regex
    scope: CODEOWNERS
    purpose: Identify ownership rules
  file_patterns:
  - glob: .github/CODEOWNERS
    purpose: GitHub CODEOWNERS file
  - glob: CODEOWNERS
    purpose: Root CODEOWNERS file
  - glob: docs/CODEOWNERS
    purpose: Alternative CODEOWNERS location
knowledge_sources:
  specifications:
  - id: github-codeowners
    name: GitHub CODEOWNERS Documentation
    url: https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-code-owners
    offline_cache: true
    priority: required
tooling:
  static_analysis:
  - tool: grep
    purpose: Parse CODEOWNERS rules
    offline_capable: true
  scripts:
  - id: codeowner-coverage
    language: bash
    purpose: Calculate CODEOWNERS coverage percentage
    source: inline
    code: |
      # Find files not covered by CODEOWNERS
      find . -type f -name "*.ts" -o -name "*.js" -o -name "*.py" | head -100
signals:
  critical:
  - id: COC-CRIT-001
    signal: No CODEOWNERS file exists
    evidence_pattern: codeowners_not_found
    explanation: |
      Without CODEOWNERS, there's no automated assignment of expert reviewers,
      leaving critical code vulnerable to review by non-experts.
    remediation: Create CODEOWNERS file with ownership rules for critical paths
  - id: COC-CRIT-002
    signal: Security-sensitive paths have no owners
    evidence_pattern: security_paths_uncovered
    explanation: |
      Authentication, authorization, and crypto code lacks designated experts,
      increasing risk of security issues being missed in review.
    remediation: Assign security team as owners of security-related paths
  high:
  - id: COC-HIGH-001
    signal: CODEOWNERS coverage below 50%
    evidence_pattern: coverage < 50%
    explanation: |
      Most code changes won't trigger expert review, reducing the
      effectiveness of the code ownership system.
    remediation: Expand CODEOWNERS rules to cover more of the codebase
  - id: COC-HIGH-002
    signal: Owners reference invalid users/teams
    evidence_pattern: invalid_owner_references
    explanation: |
      Stale CODEOWNERS references to departed employees or renamed teams
      cause assignment failures or missed reviews.
    remediation: Audit and update all owner references
  medium:
  - id: COC-MED-001
    signal: Owner approval not required for merge
    evidence_pattern: owner_approval_not_required
    remediation: Enable 'Require review from Code Owners' in branch protection
  - id: COC-MED-002
    signal: Some paths have only one owner
    evidence_pattern: single_owner_paths > 0
    remediation: Assign backup owners to critical paths
  low:
  - id: COC-LOW-001
    signal: CODEOWNERS file lacks documentation
    evidence_pattern: no_comments_in_codeowners
    remediation: Add comments explaining ownership rationale
  positive:
  - id: COC-POS-001
    signal: CODEOWNERS coverage above 80%
    evidence_pattern: coverage >= 80%
  - id: COC-POS-002
    signal: All critical paths have multiple owners
    evidence_pattern: critical_paths_multi_owner
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Locate CODEOWNERS File
    description: |
      Find the CODEOWNERS file and parse its rules to understand
      current ownership configuration.
    duration_estimate: 5 min
    commands:
    - purpose: Find CODEOWNERS
      command: |
        find . -name "CODEOWNERS" -type f 2>/dev/null
    - purpose: Parse ownership rules
      command: |
        cat .github/CODEOWNERS 2>/dev/null || cat CODEOWNERS 2>/dev/null
    expected_findings:
    - CODEOWNERS file location
    - Ownership rule patterns
  - id: '2'
    name: Calculate Coverage
    description: |
      Determine what percentage of the codebase is covered by
      CODEOWNERS rules.
    duration_estimate: 10 min
    expected_findings:
    - Percentage of files with owners
    - Uncovered directories
  - id: '3'
    name: Validate Owner References
    description: |
      Verify that all referenced users and teams exist and have
      repository access.
    duration_estimate: 10 min
    commands:
    - purpose: Extract owner references
      command: |
        grep -oE '@[a-zA-Z0-9_-]+(/[a-zA-Z0-9_-]+)?' .github/CODEOWNERS 2>/dev/null | sort -u
    expected_findings:
    - Valid owner list
    - Invalid or stale references
  - id: '4'
    name: Check Enforcement
    description: |
      Verify that code owner approval is required in branch
      protection settings.
    duration_estimate: 5 min
    commands:
    - purpose: Check branch protection
      command: |
        gh api repos/{owner}/{repo}/branches/main/protection 2>/dev/null
    expected_findings:
    - Require code owner reviews setting
    - Enforcement status
output:
  deliverables:
  - type: metrics
    format: structured
    content:
    - codeowners_coverage_percentage
    - uncovered_critical_paths
    - invalid_owner_count
    - single_owner_path_count
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Coverage Analysis
    - Owner Validation
    - Recommendations
  confidence_guidance:
    high: CODEOWNERS parsed and all owners validated
    medium: CODEOWNERS found but validation incomplete
    low: CODEOWNERS not found or unparseable
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: github-codeowners
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 3
    full:
      included: true
      priority: 2
    quality:
      included: true
      priority: 1
closeout_checklist:
- id: coc-001
  item: CODEOWNERS file exists and is valid
  level: BLOCKING
  verification: File found and parseable
  expected: Valid CODEOWNERS file
- id: coc-002
  item: Coverage percentage calculated
  level: WARNING
  verification: Numeric coverage value
  expected: Percentage between 0-100
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC8.1
  - framework: ISO 27001
    controls:
    - A.9.2.3
relationships:
  commonly_combined:
  - code-quality.code-review.reviewer-distribution
  - code-quality.code-review.approval-requirements
  - code-quality.code-review.pr-review-coverage
