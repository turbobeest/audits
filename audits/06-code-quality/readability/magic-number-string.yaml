audit:
  id: code-quality.readability.magic-number-string
  name: Magic Numbers and Strings Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: readability
  tier: expert
  estimated_duration: 25 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: codebase
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Identifies magic numbers (unexplained numeric literals) and magic strings
    (hardcoded string literals) scattered throughout code instead of being
    defined as named constants. Detects values used in calculations, conditions,
    and comparisons that lack semantic meaning without context.
  why_it_matters: |
    Magic values make code harder to understand and maintain. Developers must
    guess what "86400" means (seconds in a day) or why we compare to "ACTIVE".
    When values need to change, finding all instances is error-prone. Studies
    show magic numbers are a top-10 source of maintenance bugs, and named
    constants reduce errors by making intent explicit.
  when_to_run:
  - Code review processes
  - Refactoring initiatives
  - New developer onboarding
  - Technical debt assessments
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  access_requirements:
  - Read access to source code
discovery:
  code_patterns:
  - pattern: \b[0-9]{3,}\b
    type: regex
    scope: source
    purpose: Detect large numeric literals
  - pattern: ==\s*[0-9]+|!=\s*[0-9]+|>\s*[0-9]+|<\s*[0-9]+
    type: regex
    scope: source
    purpose: Detect numeric comparisons
  - pattern: ==\s*['"][a-zA-Z]+['"]
    type: regex
    scope: source
    purpose: Detect string comparisons
  - pattern: \*\s*[0-9]+|/\s*[0-9]+|%\s*[0-9]+
    type: regex
    scope: source
    purpose: Detect arithmetic with literals
  file_patterns:
  - glob: '**/*.{js,ts,jsx,tsx,py,java,go,rb,cs}'
    purpose: Source code files
  - glob: '!**/*test*'
    purpose: Exclude test files
  - glob: '!**/*spec*'
    purpose: Exclude spec files
knowledge_sources:
  guides:
  - id: clean-code
    name: Clean Code - Meaningful Names
    url: https://www.oreilly.com/library/view/clean-code/9780136083238/
    offline_cache: true
  - id: refactoring
    name: Refactoring - Replace Magic Number with Symbolic Constant
    url: https://refactoring.guru/replace-magic-number-with-symbolic-constant
    offline_cache: true
  - id: pragmatic-programmer
    name: The Pragmatic Programmer
    url: https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/
    offline_cache: false
  learning_resources:
  - id: refactoring-book
    title: 'Refactoring: Improving the Design of Existing Code'
    type: book
    reference: 'ISBN: 978-0134757599'
tooling:
  static_analysis:
  - tool: eslint
    purpose: JavaScript no-magic-numbers rule
    offline_capable: true
  - tool: pylint
    purpose: Python magic value detection
    offline_capable: true
  - tool: checkstyle
    purpose: Java magic number detection
    offline_capable: true
  scripts:
  - id: magic-scan
    language: bash
    purpose: Detect magic numbers and strings
    source: inline
    code: |
      # Find numeric literals in comparisons (excluding 0, 1, -1)
      grep -rn --include="*.py" -E "(==|!=|>|<|>=|<=)\s*[0-9]{2,}" . 2>/dev/null | grep -v test | head -20
      # Find hardcoded strings in comparisons
      grep -rn --include="*.py" -E "==\s*['\"][A-Za-z]{3,}['\"]" . 2>/dev/null | grep -v test | head -20
      # Find multiplication/division with literals
      grep -rn --include="*.py" -E "[*/%]\s*[0-9]{2,}" . 2>/dev/null | grep -v test | head -20
signals:
  critical:
  - id: MNS-CRIT-001
    signal: Magic numbers in security-critical code
    evidence_pattern: Hardcoded timeouts, key sizes, iteration counts
    cwe: CWE-547
    explanation: |
      Hardcoded security parameters like key sizes, iteration counts,
      or timeout values are difficult to update and may not meet current
      security standards. They also make security audits difficult.
    remediation: Define security constants with clear naming and documentation
  - id: MNS-CRIT-002
    signal: Magic strings for authentication/authorization states
    evidence_pattern: Hardcoded role names, permission strings
    cwe: CWE-547
    explanation: |
      Scattered hardcoded strings for auth states like "admin", "ACTIVE",
      or "authorized" create security risks when strings are inconsistently
      used or changed in some places but not others.
    remediation: Create enum or constant module for auth states
  high:
  - id: MNS-HIGH-001
    signal: Same magic number used in multiple locations
    evidence_pattern: Identical numeric literal appears 3+ times
    explanation: |
      When the same magic number appears multiple times, changing the
      value requires finding and updating all instances. Missing one
      causes subtle bugs.
    remediation: Extract to named constant
  - id: MNS-HIGH-002
    signal: Magic numbers in business logic calculations
    evidence_pattern: Arithmetic with unexplained literals
    explanation: |
      Calculations using magic numbers like "price * 0.0825" or
      "seconds / 86400" hide business rules and make verification
      impossible without external documentation.
    remediation: Define named constants with documentation
  medium:
  - id: MNS-MED-001
    signal: Hardcoded configuration values
    evidence_pattern: Port numbers, URLs, file paths as literals
    remediation: Move to configuration file or environment variables
  - id: MNS-MED-002
    signal: Status strings scattered through code
    evidence_pattern: String comparisons for state
    remediation: Create enum or status constants module
  low:
  - id: MNS-LOW-001
    signal: Magic numbers in array indices
    evidence_pattern: array[3] style access
    remediation: Use named constants or destructuring
  positive:
  - id: MNS-POS-001
    signal: Constants module defines domain values
  - id: MNS-POS-002
    signal: Enums used for status and state values
  - id: MNS-POS-003
    signal: ESLint no-magic-numbers rule enabled
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Detect Magic Numbers
    description: |
      Search for numeric literals used in comparisons, calculations,
      and assignments that lack semantic meaning.
    duration_estimate: 8 min
    commands:
    - purpose: Find numeric comparisons
      command: |
        grep -rn --include="*.py" -E "(==|!=|>|<|>=|<=)\s*[0-9]{2,}" . 2>/dev/null | grep -v test | grep -v _test | wc -l
    - purpose: Sample numeric literals
      command: |
        grep -rn --include="*.py" -E "\b[0-9]{3,}\b" . 2>/dev/null | grep -v test | grep -v _test | head -20
    expected_findings:
    - Count of magic numbers
    - Common magic number patterns
  - id: '2'
    name: Detect Magic Strings
    description: |
      Search for hardcoded string literals used in comparisons
      and conditionals.
    duration_estimate: 7 min
    commands:
    - purpose: Find string comparisons
      command: |
        grep -rn --include="*.py" -E "==\s*['\"][A-Za-z_]{3,}['\"]" . 2>/dev/null | grep -v test | head -20
    - purpose: Find status/state strings
      command: |
        grep -rn --include="*.py" -E "['\"]*(active|inactive|pending|completed|error|success)['\"]" . 2>/dev/null | grep -vi "test\|spec" | head -15
    expected_findings:
    - Hardcoded string locations
    - Status string patterns
  - id: '3'
    name: Check for Constants Definition
    description: |
      Verify if the project has a constants module or uses
      enums for commonly used values.
    duration_estimate: 5 min
    commands:
    - purpose: Find constants files
      command: |
        find . -name "*constant*" -o -name "*config*" -o -name "*enum*" 2>/dev/null | grep -E "\.(py|js|ts|java)$" | head -10
    - purpose: Find enum definitions
      command: |
        grep -rn --include="*.py" "class.*Enum\|from enum import" . 2>/dev/null | head -10
    expected_findings:
    - Constants module existence
    - Enum usage patterns
  - id: '4'
    name: Check Linting Rules
    description: |
      Verify if magic number/string detection is enforced
      through linting.
    duration_estimate: 5 min
    commands:
    - purpose: Check ESLint for magic number rule
      command: |
        grep -r "no-magic-numbers" .eslintrc* 2>/dev/null
    - purpose: Check for other linting rules
      command: |
        grep -r "magic" .pylintrc pylintrc pyproject.toml 2>/dev/null
    expected_findings:
    - Linting rule status
    - Enforcement gaps
output:
  deliverables:
  - type: finding_list
    format: structured
    content:
    - magic_number_instances
    - magic_string_instances
    - repeated_values
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Magic Value Analysis
    - Refactoring Recommendations
  confidence_guidance:
    high: Comprehensive automated scan
    medium: Sampling with manual review
    low: Limited scope analysis
offline:
  capability: full
profiles:
  membership:
    quick:
      included: true
      priority: 3
    full:
      included: true
      priority: 2
    quality:
      included: true
      priority: 1
closeout_checklist:
- id: mns-001
  item: Constants module exists
  level: WARNING
  verification: |
    find . -name "*constant*" -o -name "*config*" 2>/dev/null | grep -qE "\.(py|js|ts)$" && echo "PASS" || echo "FAIL"
  expected: PASS
- id: mns-002
  item: Limited magic numbers in non-test code
  level: WARNING
  verification: |
    grep -rn --include="*.py" -E "(==|!=)\s*[0-9]{3,}" . 2>/dev/null | grep -v test | wc -l | awk '{print ($1 < 20) ? "PASS" : "FAIL"}'
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: CWE
    controls:
    - CWE-547
  - framework: ISO 25010
    controls:
    - Maintainability
relationships:
  commonly_combined:
  - code-quality.readability.self-documenting-code
  - code-quality.readability.variable-name-clarity
  - code-quality.maintainability.code-organization
