audit:
  id: code-quality.readability.code-formatting-consistency
  name: Code Formatting Consistency Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: readability
  tier: expert
  estimated_duration: 20 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: low
  scope: codebase
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Analyzes the codebase for consistent application of formatting rules
    including indentation (spaces vs tabs, width), line length, brace
    placement, whitespace usage, import ordering, and blank line conventions.
    Verifies that automated formatters are configured and applied consistently.
  why_it_matters: |
    Inconsistent formatting creates visual noise that hampers code reading.
    Studies show consistent formatting reduces code comprehension time by
    up to 20%. Formatting inconsistencies also cause unnecessary merge
    conflicts, wasted code review time, and indicate lack of tooling
    discipline in the development process.
  when_to_run:
  - Repository setup and configuration
  - CI/CD pipeline reviews
  - New developer onboarding
  - After codebase migrations
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: config_files
    description: Formatter configuration files
  access_requirements:
  - Read access to source code
discovery:
  code_patterns:
  - pattern: '^\t+ '
    type: regex
    scope: source
    purpose: Detect mixed tabs and spaces
  - pattern: .{120,}
    type: regex
    scope: source
    purpose: Detect lines exceeding 120 characters
  - pattern: \s+$
    type: regex
    scope: source
    purpose: Detect trailing whitespace
  file_patterns:
  - glob: '**/.prettierrc*'
    purpose: Prettier configuration
  - glob: '**/.editorconfig'
    purpose: EditorConfig configuration
  - glob: '**/pyproject.toml'
    purpose: Python project config (black, isort)
  - glob: '**/.eslintrc*'
    purpose: ESLint configuration
knowledge_sources:
  guides:
  - id: prettier-docs
    name: Prettier Documentation
    url: https://prettier.io/docs/en/
    offline_cache: true
  - id: black-docs
    name: Black Code Formatter Documentation
    url: https://black.readthedocs.io/
    offline_cache: true
  - id: editorconfig
    name: EditorConfig Specification
    url: https://editorconfig.org/
    offline_cache: true
  - id: clean-code
    name: Robert C. Martin - Clean Code
    url: https://www.oreilly.com/library/view/clean-code-a/9780136083238/
    offline_cache: false
  - id: pragmatic-programmer
    name: The Pragmatic Programmer
    url: https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/
    offline_cache: false
tooling:
  static_analysis:
  - tool: prettier
    purpose: JavaScript/TypeScript formatting
    offline_capable: true
  - tool: black
    purpose: Python formatting
    offline_capable: true
  - tool: gofmt
    purpose: Go formatting
    offline_capable: true
  - tool: rustfmt
    purpose: Rust formatting
    offline_capable: true
  scripts:
  - id: format-check
    language: bash
    purpose: Check formatting consistency
    source: inline
    code: |
      # Check for mixed indentation
      find . -name "*.py" -exec grep -l $'^\t' {} \; 2>/dev/null | head -10
      # Check for trailing whitespace
      grep -rln --include="*.{py,js,ts}" '\s$' . 2>/dev/null | head -10
      # Check for long lines
      grep -rn --include="*.py" '.{120}' . 2>/dev/null | wc -l
signals:
  critical:
  - id: CFC-CRIT-001
    signal: No formatting tools configured
    evidence_pattern: No .prettierrc, .editorconfig, or formatter config
    explanation: |
      Without automated formatters, formatting consistency relies entirely
      on manual discipline, which inevitably fails. This leads to
      perpetual formatting debates and inconsistent code.
    remediation: Configure and enforce automated formatting
  - id: CFC-CRIT-002
    signal: Formatter configured but not enforced in CI
    evidence_pattern: Config exists but no CI check
    explanation: |
      Having formatter configuration without CI enforcement means formatting
      rules are suggestions only. Code will drift out of compliance over time.
    remediation: Add formatting check to CI pipeline
  high:
  - id: CFC-HIGH-001
    signal: Mixed indentation styles within files
    evidence_pattern: Files with both tabs and spaces
    explanation: |
      Mixed tabs and spaces cause alignment issues and create visual
      inconsistency. Most formatters cannot handle mixed styles properly.
    remediation: Convert all files to consistent indentation
  - id: CFC-HIGH-002
    signal: Significant portion of files unformatted
    evidence_pattern: More than 20% of files fail format check
    explanation: |
      When a large portion of files are unformatted, it indicates the
      formatter is not being used consistently, often due to missing
      pre-commit hooks or CI checks.
    remediation: Run formatter on entire codebase and add pre-commit hook
  medium:
  - id: CFC-MED-001
    signal: Inconsistent line length limits
    evidence_pattern: Different max lengths across file types
    remediation: Standardize line length across languages
  - id: CFC-MED-002
    signal: Trailing whitespace present
    evidence_pattern: \s+$
    remediation: Configure editor to trim trailing whitespace
  low:
  - id: CFC-LOW-001
    signal: Import ordering not enforced
    evidence_pattern: No isort/import-sort configuration
    remediation: Add import sorting to formatter config
  positive:
  - id: CFC-POS-001
    signal: Automated formatter configured and enforced in CI
  - id: CFC-POS-002
    signal: Pre-commit hooks enforce formatting
  - id: CFC-POS-003
    signal: EditorConfig present for cross-editor consistency
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Check Formatter Configuration
    description: |
      Verify that formatting tools are configured for the
      languages used in the project.
    duration_estimate: 5 min
    commands:
    - purpose: Find formatter configs
      command: |
        find . -name ".prettierrc*" -o -name ".editorconfig" -o -name "pyproject.toml" -o -name ".eslintrc*" 2>/dev/null | head -20
    - purpose: Check for pre-commit hooks
      command: |
        test -f .pre-commit-config.yaml && grep -l "prettier\|black\|gofmt" .pre-commit-config.yaml 2>/dev/null
    expected_findings:
    - Formatter configurations present
    - Pre-commit hook status
  - id: '2'
    name: Run Format Check
    description: |
      Execute formatters in check mode to identify files that
      are out of compliance.
    duration_estimate: 5 min
    commands:
    - purpose: Check Python formatting
      command: |
        black --check . 2>&1 | tail -20 || echo "Black not installed or no Python files"
    - purpose: Check JavaScript formatting
      command: |
        npx prettier --check "**/*.{js,ts,jsx,tsx}" 2>&1 | tail -20 || echo "Prettier not installed"
    expected_findings:
    - Files needing formatting
    - Compliance percentage
  - id: '3'
    name: Check for Common Issues
    description: |
      Look for common formatting problems like mixed indentation,
      trailing whitespace, and long lines.
    duration_estimate: 5 min
    commands:
    - purpose: Find mixed indentation
      command: |
        find . -name "*.py" -type f -exec grep -l $'^\t' {} \; 2>/dev/null | wc -l
    - purpose: Find trailing whitespace
      command: |
        grep -rln --include="*.{py,js,ts}" '\s$' . 2>/dev/null | wc -l
    - purpose: Find long lines
      command: |
        grep -rn --include="*.py" '.\{120\}' . 2>/dev/null | wc -l
    expected_findings:
    - Indentation issues
    - Trailing whitespace count
    - Long line count
  - id: '4'
    name: Verify CI Enforcement
    description: |
      Check that formatting is verified in the CI pipeline.
    duration_estimate: 5 min
    commands:
    - purpose: Check CI config for format step
      command: |
        grep -r "prettier\|black\|format" .github/workflows/ .gitlab-ci.yml Jenkinsfile 2>/dev/null | head -10
    expected_findings:
    - CI format check status
    - Enforcement gaps
output:
  deliverables:
  - type: finding_list
    format: structured
    content:
    - unformatted_files
    - formatting_issues
    - config_status
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Formatter Configuration
    - Compliance Status
    - Recommendations
  confidence_guidance:
    high: Automated check with comprehensive coverage
    medium: Partial automation or sampling
    low: Manual review only
offline:
  capability: full
profiles:
  membership:
    quick:
      included: true
      priority: 3
    full:
      included: true
      priority: 2
    quality:
      included: true
      priority: 1
closeout_checklist:
- id: cfc-001
  item: Formatter configuration exists
  level: BLOCKING
  verification: |
    (test -f .prettierrc || test -f .prettierrc.json || test -f .editorconfig || test -f pyproject.toml) && echo "PASS" || echo "FAIL"
  expected: PASS
- id: cfc-002
  item: No mixed indentation
  level: WARNING
  verification: |
    find . -name "*.py" -type f -exec grep -l $'^\t' {} \; 2>/dev/null | wc -l | awk '{print ($1 == 0) ? "PASS" : "FAIL"}'
  expected: PASS
- id: cfc-003
  item: CI enforces formatting
  level: WARNING
  verification: |
    grep -rq "prettier\|black\|format" .github/workflows/ 2>/dev/null && echo "PASS" || echo "FAIL"
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
relationships:
  commonly_combined:
  - code-quality.readability.naming-convention
  - code-quality.documentation.inline-comments
