audit:
  id: code-quality.idioms.deprecated-api-usage
  name: Deprecated API Usage Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: idioms
  tier: expert
  estimated_duration: 45 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: 'yes'
  severity: high
  scope: codebase
  default_profiles:
  - full
  - quick
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Identifies usage of deprecated APIs, methods, functions, and language
    features throughout the codebase. This includes deprecated standard library
    functions, framework APIs marked for removal, and language features that
    have been superseded by newer alternatives.
  why_it_matters: |
    Deprecated APIs are scheduled for removal and may have security vulnerabilities
    or bugs that won't be fixed. Continued use creates technical debt, risks
    breaking changes during upgrades, and may indicate the codebase isn't being
    actively maintained. Security patches often aren't backported to deprecated APIs.
  when_to_run:
  - Before dependency upgrades
  - During security audits
  - Regular maintenance cycles
  - Technical debt assessments
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  - type: dependency_manifest
    description: Package manifest files
  access_requirements:
  - Read access to source code repository
discovery:
  code_patterns:
  - pattern: \barguments\b|\bcaller\b|\bcallee\b
    type: regex
    scope: source
    purpose: Detect deprecated JS arguments object properties
  - pattern: __proto__|Object\.prototype\.__defineGetter__
    type: regex
    scope: source
    purpose: Detect deprecated prototype manipulation
  - pattern: from collections import.*Callable|from collections import.*Mapping
    type: regex
    scope: source
    purpose: Detect deprecated collections imports
  - pattern: asyncio\.get_event_loop\(\)
    type: regex
    scope: source
    purpose: Detect deprecated asyncio patterns
  - pattern: componentWillMount|componentWillReceiveProps|componentWillUpdate
    type: regex
    scope: source
    purpose: Detect deprecated React lifecycle methods
  - pattern: new Buffer\(|Buffer\([^f]
    type: regex
    scope: source
    purpose: Detect deprecated Buffer constructor
  file_patterns:
  - glob: '**/*.{js,ts,jsx,tsx,py,java,go}'
    purpose: Source code files
knowledge_sources:
  specifications:
  - id: mdn-deprecated
    name: MDN Deprecated Features
    url: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Deprecated_and_obsolete_features
    offline_cache: true
    priority: required
  - id: python-deprecated
    name: Python Deprecations
    url: https://docs.python.org/3/library/warnings.html#warning-categories
    offline_cache: true
    priority: required
  guides:
  - id: node-deprecations
    name: Node.js Deprecations
    url: https://nodejs.org/api/deprecations.html
    offline_cache: true
  - id: react-deprecations
    name: React Lifecycle Methods Deprecation
    url: https://legacy.reactjs.org/blog/2018/03/27/update-on-async-rendering.html
    offline_cache: true
  - id: design-patterns-gof
    name: 'Design Patterns: Elements of Reusable Object-Oriented Software'
    url: https://www.oreilly.com/library/view/design-patterns-elements/0201633612/
    offline_cache: false
  - id: effective-java
    name: Effective Java
    url: https://www.oreilly.com/library/view/effective-java-3rd/9780134686097/
    offline_cache: false
tooling:
  static_analysis:
  - tool: eslint
    purpose: JavaScript/TypeScript deprecation detection
    offline_capable: true
  - tool: pylint
    purpose: Python deprecation warnings
    offline_capable: true
  - tool: deprecation-detector
    purpose: Multi-language deprecation detection
    offline_capable: true
  scripts:
  - id: deprecated-scan
    language: bash
    purpose: Scan for deprecated API usage
    source: inline
    code: |
      echo "=== JavaScript/TypeScript Deprecations ==="
      echo "--- Deprecated Buffer constructor ---"
      grep -rn "new Buffer\|Buffer(" --include="*.js" --include="*.ts" . 2>/dev/null | grep -v node_modules | head -20

      echo "--- Deprecated __proto__ ---"
      grep -rn "__proto__" --include="*.js" --include="*.ts" . 2>/dev/null | grep -v node_modules | head -10

      echo "=== Python Deprecations ==="
      echo "--- Deprecated collections imports ---"
      grep -rn "from collections import.*Callable\|from collections import.*Mapping" --include="*.py" . 2>/dev/null | head -10

      echo "=== React Deprecations ==="
      grep -rn "componentWillMount\|componentWillReceiveProps" --include="*.jsx" --include="*.tsx" . 2>/dev/null | head -20
signals:
  critical:
  - id: DEPR-CRIT-001
    signal: Security-sensitive deprecated API in use
    evidence_pattern: new Buffer\(|crypto\.createCipher\(
    explanation: |
      Deprecated crypto APIs have known vulnerabilities. Buffer constructor
      without encoding is vulnerable to memory exposure attacks.
    remediation: Use Buffer.from(), Buffer.alloc(), and modern crypto APIs
  - id: DEPR-CRIT-002
    signal: Deprecated API removed in target runtime version
    evidence_pattern: APIs removed in Node 18+, Python 3.11+
    explanation: |
      Using APIs that have been completely removed will cause runtime
      failures when upgrading.
    remediation: Migrate to replacement APIs immediately
  high:
  - id: DEPR-HIGH-001
    signal: Deprecated React lifecycle methods
    evidence_pattern: componentWillMount|componentWillReceiveProps|componentWillUpdate
    explanation: |
      These methods are removed in React 18 strict mode and cause issues
      with concurrent features. They indicate outdated component patterns.
    remediation: Migrate to componentDidMount, getDerivedStateFromProps, or useEffect
  - id: DEPR-HIGH-002
    signal: Deprecated Python collections imports
    evidence_pattern: from collections import Callable|Mapping|MutableMapping
    explanation: |
      Abstract base classes moved to collections.abc in Python 3.3 and
      direct import from collections is removed in Python 3.10+.
    remediation: Import from collections.abc instead
  - id: DEPR-HIGH-003
    signal: Deprecated Node.js APIs
    evidence_pattern: url\.parse\(|domain\.
    explanation: |
      These APIs are deprecated and have known security issues.
      Modern alternatives provide better security and functionality.
    remediation: Use URL constructor instead of url.parse()
  medium:
  - id: DEPR-MED-001
    signal: Deprecated asyncio event loop acquisition
    evidence_pattern: asyncio\.get_event_loop\(\)
    remediation: Use asyncio.get_running_loop() or asyncio.run()
  - id: DEPR-MED-002
    signal: Deprecated Express middleware
    evidence_pattern: bodyParser\.|express\.json\(\)|express\.urlencoded\(\)
    remediation: Use built-in express.json() and express.urlencoded() (Express 4.16+)
  - id: DEPR-MED-003
    signal: Deprecated JavaScript features
    evidence_pattern: arguments\.callee|with\s*\(
    remediation: Use named functions and explicit object references
  low:
  - id: DEPR-LOW-001
    signal: Console deprecation warnings in dependencies
    evidence_pattern: DeprecationWarning in npm install
    remediation: Update dependencies to versions without deprecation warnings
  - id: DEPR-LOW-002
    signal: Deprecated but not yet removed APIs
    evidence_pattern: APIs marked @deprecated in JSDoc
    remediation: Plan migration to replacement APIs
  positive:
  - id: DEPR-POS-001
    signal: No deprecated API usage detected
    evidence_pattern: Zero deprecation warnings from linters
  - id: DEPR-POS-002
    signal: Active deprecation migration tracking
    evidence_pattern: TODO comments with deprecation migration plans
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Run Language-Specific Deprecation Checks
    description: |
      Execute linters and analyzers configured to detect deprecated
      API usage.
    duration_estimate: 15 min
    commands:
    - purpose: ESLint deprecation check
      command: |
        npx eslint --rule 'no-buffer-constructor: error' --rule 'no-deprecated-api: warn' . 2>/dev/null || echo "ESLint not configured"
    - purpose: Python deprecation warnings
      command: |
        python -W default::DeprecationWarning -c "import warnings; warnings.filterwarnings('default', category=DeprecationWarning)" 2>&1 | head -30
    expected_findings:
    - Linter-detected deprecations
    - Runtime deprecation warnings
  - id: '2'
    name: Scan for Known Deprecated Patterns
    description: |
      Search for common deprecated API patterns that automated tools
      might miss.
    duration_estimate: 15 min
    commands:
    - purpose: JavaScript deprecated APIs
      command: |
        grep -rn "new Buffer\|__proto__\|arguments\.callee\|with\s*(" \
          --include="*.js" --include="*.ts" . 2>/dev/null | grep -v node_modules | head -30
    - purpose: Python deprecated imports
      command: |
        grep -rn "from collections import.*\(Callable\|Mapping\|Sequence\)" \
          --include="*.py" . 2>/dev/null | head -20
    - purpose: React deprecated methods
      command: |
        grep -rn "componentWillMount\|componentWillReceiveProps\|componentWillUpdate" \
          --include="*.jsx" --include="*.tsx" . 2>/dev/null | head -30
    expected_findings:
    - Pattern-matched deprecations
    - File locations
  - id: '3'
    name: Check Dependency Deprecations
    description: |
      Analyze npm install or pip install output for deprecation
      warnings from dependencies.
    duration_estimate: 10 min
    commands:
    - purpose: npm audit for deprecated packages
      command: |
        npm outdated 2>/dev/null | head -30 || echo "npm not available"
    - purpose: pip check for deprecated packages
      command: |
        pip list --outdated 2>/dev/null | head -30 || echo "pip not available"
    expected_findings:
    - Outdated dependencies
    - Dependencies with deprecation warnings
  - id: '4'
    name: Generate Migration Report
    description: |
      Compile findings into a prioritized migration report with
      replacement guidance.
    duration_estimate: 5 min
    expected_findings:
    - Prioritized deprecation inventory
    - Replacement API mapping
    - Migration effort estimates
output:
  deliverables:
  - type: finding_list
    format: structured
    content:
    - deprecated_api_inventory
    - replacement_mapping
    - affected_files
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Critical Deprecations
    - Migration Roadmap
    - Dependency Updates
  confidence_guidance:
    high: Linter or official documentation confirms deprecation
    medium: Pattern match with high likelihood
    low: Potential deprecation requiring verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: mdn-deprecated
      priority: required
    - source_id: node-deprecations
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 2
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: depr-001
  item: No security-critical deprecated APIs
  level: CRITICAL
  verification: grep -rn 'new Buffer\|crypto.createCipher' --include='*.js' --include='*.ts'
  expected: Zero matches
- id: depr-002
  item: Deprecated API inventory complete
  level: BLOCKING
  verification: All deprecated patterns scanned
  expected: Complete inventory
- id: depr-003
  item: Migration plan documented
  level: WARNING
  verification: Replacement API identified for each deprecation
  expected: Actionable migration plan
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: OWASP
    controls:
    - Using Components with Known Vulnerabilities
  - framework: CWE
    controls:
    - CWE-477
relationships:
  commonly_combined:
  - code-quality.idioms.modern-syntax-adoption
  - security.dependencies.vulnerability-scan
  - code-quality.technical-debt.debt-assessment
