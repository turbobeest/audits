audit:
  id: code-quality.idioms.anti-pattern-detection
  name: Anti-Pattern Detection Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: idioms
  tier: phd
  estimated_duration: 90 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: codebase
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Identifies common anti-patterns in the codebase that represent solutions
    that appear beneficial but ultimately create more problems than they solve.
    This includes design anti-patterns (God Object, Spaghetti Code), coding
    anti-patterns (Magic Numbers, Copy-Paste Programming), and architectural
    anti-patterns (Big Ball of Mud, Golden Hammer).
  why_it_matters: |
    Anti-patterns are deceptively attractive solutions that introduce hidden
    technical debt, make code harder to maintain, test, and evolve. They often
    indicate deeper design problems and can lead to cascading issues throughout
    the system. Early detection prevents accumulation of structural problems.
  when_to_run:
  - During architecture reviews
  - Technical debt assessments
  - Before major refactoring initiatives
  - New team member onboarding
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  access_requirements:
  - Read access to source code repository
  - Access to git history for churn analysis
discovery:
  code_patterns:
  - pattern: class\s+\w+.*\{[^}]{5000,}
    type: regex
    scope: source
    purpose: Detect God Objects (very large classes)
  - pattern: (\d{4,})[^\d]|[^\d](\d{4,})
    type: regex
    scope: source
    purpose: Detect Magic Numbers
  - pattern: catch\s*\([^)]*\)\s*\{\s*\}
    type: regex
    scope: source
    purpose: Detect empty catch blocks (swallowed exceptions)
  - pattern: if.*else\s+if.*else\s+if.*else\s+if
    type: regex
    scope: source
    purpose: Detect long if-else chains
  file_patterns:
  - glob: '**/*.{js,ts,py,java,go,cs,rb}'
    purpose: Source code files
knowledge_sources:
  learning_resources:
  - id: antipatterns-book
    title: 'AntiPatterns: Refactoring Software, Architectures, and Projects in Crisis'
    type: book
    reference: 'Brown, Malveau, McCormick, ISBN: 978-0471197133'
  - id: refactoring
    title: 'Refactoring: Improving the Design of Existing Code'
    type: book
    reference: 'Martin Fowler, ISBN: 978-0134757599'
  guides:
  - id: sourcemaking-antipatterns
    name: SourceMaking Anti-Patterns
    url: https://sourcemaking.com/antipatterns
    offline_cache: true
  - id: design-patterns-gof
    name: 'Design Patterns: Elements of Reusable Object-Oriented Software'
    url: https://www.oreilly.com/library/view/design-patterns-elements/0201633612/
    offline_cache: false
  - id: effective-java
    name: Effective Java
    url: https://www.oreilly.com/library/view/effective-java-3rd/9780134686097/
    offline_cache: false
tooling:
  static_analysis:
  - tool: eslint
    purpose: JavaScript anti-pattern detection
    offline_capable: true
  - tool: sonarqube
    purpose: Multi-language anti-pattern and code smell detection
    offline_capable: false
  - tool: pmd
    purpose: Java anti-pattern detection
    offline_capable: true
  - tool: pylint
    purpose: Python anti-pattern detection
    offline_capable: true
  scripts:
  - id: antipattern-scan
    language: bash
    purpose: Detect common anti-patterns
    source: inline
    code: |
      echo "=== God Object Detection ==="
      find . -name "*.java" -o -name "*.ts" -o -name "*.py" | xargs wc -l 2>/dev/null | sort -rn | head -20

      echo "=== Magic Number Detection ==="
      grep -rn "[^a-zA-Z0-9_][0-9]\{4,\}[^a-zA-Z0-9_]" --include="*.js" --include="*.ts" --include="*.py" . 2>/dev/null | head -30

      echo "=== Empty Catch Block Detection ==="
      grep -rn "catch.*{[ \t]*}" --include="*.js" --include="*.ts" --include="*.java" . 2>/dev/null | head -20
signals:
  critical:
  - id: ANTI-CRIT-001
    signal: God Object detected (class > 2000 lines or > 50 methods)
    evidence_pattern: class with >2000 lines or >50 methods
    explanation: |
      God Objects violate Single Responsibility Principle, making testing
      extremely difficult and changes risky. They become a bottleneck for
      development and a source of merge conflicts.
    remediation: Decompose into smaller, focused classes using Extract Class refactoring
  - id: ANTI-CRIT-002
    signal: Spaghetti Code with deeply nested control flow
    evidence_pattern: nesting depth > 5 levels
    explanation: |
      Deeply nested code (>5 levels) is nearly impossible to understand,
      test, and maintain. It indicates missing abstractions and poor design.
    remediation: Extract methods, use early returns, apply Guard Clauses pattern
  high:
  - id: ANTI-HIGH-001
    signal: Magic Numbers throughout codebase
    evidence_pattern: literal numbers without named constants
    explanation: |
      Magic numbers obscure intent, make changes error-prone (easy to miss
      occurrences), and prevent compile-time checking of related values.
    remediation: Extract to named constants with meaningful names
  - id: ANTI-HIGH-002
    signal: Copy-Paste Programming (duplicated code blocks)
    evidence_pattern: similar code blocks in multiple locations
    explanation: |
      Duplicated code multiplies maintenance effort and bug risk. Fixing
      a bug requires finding and fixing all copies, which is error-prone.
    remediation: Extract to shared functions/methods or use inheritance/composition
  - id: ANTI-HIGH-003
    signal: Swallowed exceptions (empty catch blocks)
    evidence_pattern: catch\s*\([^)]*\)\s*\{\s*\}
    explanation: |
      Empty catch blocks hide errors, making debugging extremely difficult.
      Problems go unnoticed until they cause cascading failures.
    remediation: Log exceptions at minimum, prefer proper error handling or re-throwing
  medium:
  - id: ANTI-MED-001
    signal: Primitive Obsession (using primitives for domain concepts)
    evidence_pattern: String for email, int for currency
    remediation: Create value objects for domain concepts
  - id: ANTI-MED-002
    signal: Feature Envy (methods that use other class data excessively)
    evidence_pattern: methods with many external object accesses
    remediation: Move method to the class whose data it uses most
  - id: ANTI-MED-003
    signal: Long Parameter Lists (>4 parameters)
    evidence_pattern: function\s*\([^)]*,[^)]*,[^)]*,[^)]*,
    remediation: Use parameter objects or builder pattern
  low:
  - id: ANTI-LOW-001
    signal: Comments explaining what code does (instead of why)
    evidence_pattern: // increment counter
    remediation: Write self-documenting code, comment only the 'why'
  - id: ANTI-LOW-002
    signal: Dead code (unreachable or unused code)
    evidence_pattern: return; followed by code
    remediation: Remove dead code, trust version control
  positive:
  - id: ANTI-POS-001
    signal: Small, focused classes with single responsibility
    evidence_pattern: classes <300 lines with cohesive methods
  - id: ANTI-POS-002
    signal: Named constants for all magic values
    evidence_pattern: const/final declarations for numeric values
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify Large Code Units
    description: |
      Scan for oversized files, classes, and functions that may indicate
      God Objects or other structural anti-patterns.
    duration_estimate: 15 min
    commands:
    - purpose: Find largest files
      command: |
        find . -name "*.js" -o -name "*.ts" -o -name "*.py" -o -name "*.java" | \
        xargs wc -l 2>/dev/null | sort -rn | head -30
    - purpose: Count methods per class (JS/TS)
      command: |
        grep -r "^\s*\(async\s\+\)\?\(public\|private\|protected\)\?\s*\w\+\s*(" --include="*.ts" . 2>/dev/null | \
        cut -d: -f1 | sort | uniq -c | sort -rn | head -20
    expected_findings:
    - Files exceeding size thresholds
    - Classes with excessive methods
  - id: '2'
    name: Detect Code Duplication
    description: |
      Identify copy-paste programming by finding similar code blocks
      across the codebase.
    duration_estimate: 20 min
    commands:
    - purpose: Find duplicate code with jscpd
      command: |
        npx jscpd . --min-lines 10 --min-tokens 50 --format json 2>/dev/null || echo "Install jscpd: npm install -g jscpd"
    expected_findings:
    - Duplicate code locations
    - Duplication percentage
  - id: '3'
    name: Scan for Magic Numbers
    description: |
      Identify hardcoded numeric literals that should be named constants.
    duration_estimate: 15 min
    commands:
    - purpose: Find magic numbers in source
      command: |
        grep -rn "[^a-zA-Z_][0-9]\{3,\}[^a-zA-Z0-9_]" --include="*.js" --include="*.ts" --include="*.py" . 2>/dev/null | \
        grep -v "node_modules\|test\|spec" | head -50
    expected_findings:
    - Magic number locations
    - Categorized by likely purpose
  - id: '4'
    name: Analyze Exception Handling
    description: |
      Check for swallowed exceptions, overly broad catches, and other
      exception handling anti-patterns.
    duration_estimate: 15 min
    commands:
    - purpose: Find empty catch blocks
      command: |
        grep -rn "catch.*{[ \t]*}" --include="*.js" --include="*.ts" --include="*.java" . 2>/dev/null | head -30
    - purpose: Find catch-all exceptions
      command: |
        grep -rn "catch\s*(Exception\|catch\s*(" --include="*.java" --include="*.py" . 2>/dev/null | head -30
    expected_findings:
    - Empty catch block locations
    - Overly broad exception handlers
  - id: '5'
    name: Assess Nesting Depth
    description: |
      Identify deeply nested control structures that indicate spaghetti code.
    duration_estimate: 15 min
    commands:
    - purpose: Measure nesting depth
      command: |
        grep -rn "^\s\{20,\}" --include="*.js" --include="*.ts" --include="*.py" . 2>/dev/null | head -30
    expected_findings:
    - Deeply nested code locations
    - Maximum nesting depths
  - id: '6'
    name: Generate Anti-Pattern Report
    description: |
      Compile findings into prioritized report with remediation guidance.
    duration_estimate: 10 min
    expected_findings:
    - Prioritized anti-pattern inventory
    - Remediation recommendations
    - Estimated effort assessments
output:
  deliverables:
  - type: finding_list
    format: structured
    content:
    - antipattern_inventory
    - locations_by_pattern
    - severity_distribution
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Critical Anti-Patterns
    - Remediation Roadmap
    - Prevention Recommendations
  confidence_guidance:
    high: Automated detection with verified impact
    medium: Pattern match requiring context review
    low: Heuristic indicators requiring expert judgment
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: sourcemaking-antipatterns
      priority: recommended
profiles:
  membership:
    quick:
      included: false
      reason: Anti-pattern detection requires thorough analysis
    full:
      included: true
      priority: 1
    quality:
      included: true
      priority: 1
closeout_checklist:
- id: anti-001
  item: God Objects identified
  level: CRITICAL
  verification: All classes >2000 lines documented
  expected: List of oversized classes
- id: anti-002
  item: Code duplication assessed
  level: BLOCKING
  verification: Duplication analysis completed
  expected: Duplication report with locations
- id: anti-003
  item: Exception handling reviewed
  level: CRITICAL
  verification: Empty catch blocks identified
  expected: No critical exception handling issues
- id: anti-004
  item: Remediation plan provided
  level: WARNING
  verification: Priority list with effort estimates
  expected: Actionable remediation roadmap
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
    - Reliability
  - framework: CWE
    controls:
    - CWE-390
    - CWE-584
relationships:
  commonly_combined:
  - code-quality.maintainability.cyclomatic-complexity
  - code-quality.technical-debt.debt-assessment
  - code-quality.idioms.idiomatic-code
