audit:
  id: code-quality.idioms.idiomatic-code
  name: Idiomatic Code Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: code-quality
  category_number: 6
  subcategory: idioms
  tier: expert
  estimated_duration: 60 minutes
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: codebase
  default_profiles:
  - full
  - quality
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates whether code follows language-specific idioms and conventions
    that are considered best practice within each programming language community.
    This includes examining variable naming, control flow patterns, data structure
    usage, and expression of common operations in the most natural way for each language.
  why_it_matters: |
    Idiomatic code is easier to read, maintain, and understand by developers
    familiar with the language. Non-idiomatic code signals inexperience, increases
    cognitive load during code review, and often hides subtle bugs. Following
    idioms also often leads to better performance as language runtimes and
    compilers are optimized for idiomatic patterns.
  when_to_run:
  - During code reviews
  - When onboarding new team members
  - During technical debt assessments
  - After language version upgrades
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code
  access_requirements:
  - Read access to source code repository
discovery:
  code_patterns:
  - pattern: for\s*\(.*\.length.*\)
    type: regex
    scope: source
    purpose: Detect non-idiomatic array iteration in JS/TS
  - pattern: if\s+\w+\s*==\s*True|if\s+\w+\s*==\s*False
    type: regex
    scope: source
    purpose: Detect non-idiomatic boolean comparison in Python
  - pattern: new Array\(|new Object\(
    type: regex
    scope: source
    purpose: Detect non-idiomatic object/array creation in JS
  file_patterns:
  - glob: '**/*.{js,ts,py,java,go,rb,rs}'
    purpose: Source code files to analyze
knowledge_sources:
  guides:
  - id: effective-go
    name: Effective Go
    url: https://go.dev/doc/effective_go
    offline_cache: true
  - id: pep8
    name: PEP 8 - Python Style Guide
    url: https://peps.python.org/pep-0008/
    offline_cache: true
  - id: airbnb-js
    name: Airbnb JavaScript Style Guide
    url: https://github.com/airbnb/javascript
    offline_cache: true
  - id: design-patterns-gof
    name: 'Design Patterns: Elements of Reusable Object-Oriented Software'
    url: https://www.oreilly.com/library/view/design-patterns-elements/0201633612/
    offline_cache: false
  learning_resources:
  - id: idiomatic-python
    title: Writing Idiomatic Python
    type: book
    reference: 'Jeff Knupp, ISBN: 978-1482374810'
  - id: effective-java
    title: Effective Java
    type: book
    reference: 'Joshua Bloch, ISBN: 978-0134685991'
tooling:
  static_analysis:
  - tool: eslint
    purpose: JavaScript/TypeScript idiom enforcement
    offline_capable: true
  - tool: pylint
    purpose: Python idiom and convention checking
    offline_capable: true
  - tool: golangci-lint
    purpose: Go idiom and style enforcement
    offline_capable: true
  - tool: rubocop
    purpose: Ruby idiom and style enforcement
    offline_capable: true
  - tool: clippy
    purpose: Rust idiom and lint checking
    offline_capable: true
  scripts:
  - id: idiom-scan
    language: bash
    purpose: Run multi-language idiom analysis
    source: inline
    code: |
      # Check for common non-idiomatic patterns
      echo "=== JavaScript/TypeScript Idiom Check ==="
      grep -rn "new Array\|new Object" --include="*.js" --include="*.ts" . 2>/dev/null || echo "No issues found"

      echo "=== Python Idiom Check ==="
      grep -rn "== True\|== False\|== None" --include="*.py" . 2>/dev/null || echo "No issues found"
signals:
  critical:
  - id: IDIOM-CRIT-001
    signal: Widespread use of deprecated language constructs
    evidence_pattern: 'var\s+\w+\s*=|with\s+\w+\s*:'
    explanation: |
      Using deprecated constructs like 'var' in JavaScript or 'with' statements
      indicates outdated code that may have scoping bugs and security issues.
    remediation: Migrate to modern equivalents (let/const, explicit object references)
  - id: IDIOM-CRIT-002
    signal: Manual iteration where built-in methods exist
    evidence_pattern: for.*in range\(len\(
    explanation: |
      Manual index-based iteration in Python instead of direct iteration or
      enumerate() indicates unfamiliarity with Pythonic patterns and is error-prone.
    remediation: Use direct iteration, enumerate(), or zip() as appropriate
  high:
  - id: IDIOM-HIGH-001
    signal: Explicit boolean comparisons
    evidence_pattern: if\s+\w+\s*==\s*(true|false|True|False)
    explanation: |
      Comparing booleans to true/false is redundant and non-idiomatic in most
      languages. It adds noise and can hide type coercion bugs.
    remediation: 'Use direct boolean evaluation: if (condition) or if condition'
  - id: IDIOM-HIGH-002
    signal: String concatenation in loops
    evidence_pattern: for.*\+=.*str|for.*\+.*String
    explanation: |
      Building strings through concatenation in loops is inefficient in most
      languages and non-idiomatic. Use join() or StringBuilder equivalents.
    remediation: Use language-appropriate string building (join, StringBuilder, etc.)
  medium:
  - id: IDIOM-MED-001
    signal: Non-idiomatic null/undefined checks
    evidence_pattern: typeof\s+\w+\s*===?\s*['"]undefined['"]
    explanation: |
      Using typeof for undefined checks is verbose. Modern JavaScript has
      optional chaining and nullish coalescing.
    remediation: Use optional chaining (?.) and nullish coalescing (??)
  - id: IDIOM-MED-002
    signal: Verbose object property assignment
    evidence_pattern: \{\s*\w+:\s*\w+\s*\}
    explanation: |
      Not using shorthand property syntax when variable name matches property
      name is unnecessarily verbose.
    remediation: 'Use shorthand syntax: { name } instead of { name: name }'
  low:
  - id: IDIOM-LOW-001
    signal: Inconsistent naming conventions
    evidence_pattern: Mixed camelCase and snake_case in same file
    remediation: Standardize on language-appropriate naming convention
  positive:
  - id: IDIOM-POS-001
    signal: Consistent use of modern language features
    evidence_pattern: const|let|arrow functions|destructuring
  - id: IDIOM-POS-002
    signal: Idiomatic error handling patterns
    evidence_pattern: try/except with specific exceptions|if err != nil
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify Primary Languages
    description: |
      Determine the programming languages used in the codebase and
      their relative prevalence to prioritize idiom checking.
    duration_estimate: 5 min
    commands:
    - purpose: Count files by language
      command: |
        find . -name "*.js" -o -name "*.ts" -o -name "*.py" -o -name "*.go" -o -name "*.java" | \
        sed 's/.*\.//' | sort | uniq -c | sort -rn
    expected_findings:
    - List of languages used
    - Primary language identification
  - id: '2'
    name: Run Language-Specific Linters
    description: |
      Execute appropriate linting tools for each language to identify
      non-idiomatic patterns automatically.
    duration_estimate: 20 min
    commands:
    - purpose: ESLint for JavaScript/TypeScript
      command: |
        npx eslint --ext .js,.ts . --format stylish 2>/dev/null || echo "ESLint not configured"
    - purpose: Pylint for Python
      command: |
        pylint --disable=all --enable=C0103,C0114,C0115,C0116,W0612 **/*.py 2>/dev/null || echo "Pylint not available"
    expected_findings:
    - Linter-detected idiom violations
    - Style guide deviations
  - id: '3'
    name: Manual Pattern Search
    description: |
      Search for common non-idiomatic patterns that linters may miss.
    duration_estimate: 15 min
    commands:
    - purpose: Find non-idiomatic JS patterns
      command: |
        grep -rn "new Array\|new Object\|== null\|== undefined" --include="*.js" --include="*.ts" . 2>/dev/null | head -50
    - purpose: Find non-idiomatic Python patterns
      command: |
        grep -rn "== True\|== False\|== None\|for.*range(len" --include="*.py" . 2>/dev/null | head -50
    expected_findings:
    - Non-idiomatic construct locations
    - Pattern frequency counts
  - id: '4'
    name: Assess and Prioritize
    description: |
      Evaluate the severity and frequency of idiom violations to
      prioritize remediation efforts.
    duration_estimate: 20 min
    expected_findings:
    - Most common violations
    - Files with highest violation density
    - Remediation priority list
output:
  deliverables:
  - type: finding_list
    format: structured
    content:
    - idiom_violations
    - violation_counts_by_type
    - affected_files
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Language-Specific Findings
    - Recommendations
  confidence_guidance:
    high: Linter-verified violations with clear remediation
    medium: Pattern matches requiring context evaluation
    low: Subjective style preferences
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: effective-go
      priority: recommended
    - source_id: pep8
      priority: recommended
profiles:
  membership:
    quick:
      included: false
      reason: Idiom checking requires thorough analysis
    full:
      included: true
      priority: 2
    quality:
      included: true
      priority: 1
closeout_checklist:
- id: idiom-001
  item: Language-specific linters executed
  level: BLOCKING
  verification: Linter output captured for primary languages
  expected: Complete linter reports
- id: idiom-002
  item: Critical idiom violations documented
  level: CRITICAL
  verification: All deprecated construct usages identified
  expected: List of critical violations with locations
- id: idiom-003
  item: Remediation recommendations provided
  level: WARNING
  verification: Each violation type has remediation guidance
  expected: Actionable recommendations
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ISO 25010
    controls:
    - Maintainability
    - Readability
relationships:
  commonly_combined:
  - code-quality.idioms.modern-syntax-adoption
  - code-quality.idioms.deprecated-api-usage
  - code-quality.maintainability.code-readability
