audit:
  id: risk-management.threat-modeling.countermeasure-mapping
  name: Countermeasure Mapping Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: risk-management
  category_number: 29
  subcategory: threat-modeling
  tier: phd
  estimated_duration: 3-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: organizational
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines countermeasure mapping practices:
    - Mapping controls to identified threats
    - Coverage analysis for all threats
    - Countermeasure effectiveness assessment
    - Gap identification and remediation
    - Defense in depth consideration
    - Documentation of countermeasure-threat relationships
    - Continuous mapping updates
  why_it_matters: |
    Countermeasure mapping ensures threats are actually addressed:
    - Identified threats need corresponding defenses
    - Unmapped threats represent unmitigated risk
    - OWASP emphasizes countermeasure identification in threat modeling
    - Defense in depth requires layered countermeasures
    - Mapping reveals coverage gaps
    - Validates that security investment addresses real threats
    - Supports compliance demonstration
  when_to_run:
  - After threat identification
  - During security architecture review
  - After control implementation
  - Annual security assessment
  - When threats change
prerequisites:
  required_artifacts:
  - type: threat_list
    description: List of identified threats
  - type: control_inventory
    description: Inventory of security controls
  - type: mapping_documentation
    description: Threat-countermeasure mapping
  access_requirements:
  - Access to threat documentation
  - Access to control inventory
  - Access to mapping documentation
discovery:
  code_patterns:
  - pattern: (countermeasure|mitigation|control).*threat
    type: regex
    scope: docs
    purpose: Find countermeasure mapping
  - pattern: (defense|protect|prevent).*threat
    type: regex
    scope: docs
    purpose: Find defense references
  - pattern: (mapping|coverage|address).*threat
    type: regex
    scope: docs
    purpose: Find mapping documentation
  file_patterns:
  - glob: '**/countermeasure*.{yaml,yml,json,md}'
    purpose: Countermeasure files
  - glob: '**/threat*mitigation*.{yaml,yml,json,md}'
    purpose: Threat mitigation files
  - glob: '**/control*mapping*.{yaml,yml,json,md}'
    purpose: Control mapping files
knowledge_sources:
  specifications:
  - id: owasp-countermeasures
    name: OWASP Threat Countermeasures
    url: https://owasp.org/www-community/Threat_Modeling
    offline_cache: true
    priority: required
  - id: nist-800-53
    name: NIST SP 800-53 Security Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  guides:
  - id: countermeasure-guide
    name: Security Countermeasure Selection Guide
    url: https://www.sans.org/
    offline_cache: true
tooling:
  static_analysis:
  - tool: mapping-analyzer
    purpose: Analyze countermeasure coverage
    offline_capable: true
  scripts:
  - id: mapping-scanner
    language: bash
    purpose: Scan for countermeasure mapping
    source: inline
    code: |
      #!/bin/bash
      echo "=== Countermeasure Mapping Scan ==="
      grep -rniE "(countermeasure|mitigation|control).*threat" \
        --include="*.yaml" --include="*.md" . 2>/dev/null | head -30
signals:
  critical:
  - id: CNTMAP-CRIT-001
    signal: No countermeasure mapping to threats
    evidence_indicators:
    - No mapping documentation
    - Threats without countermeasures
    - Controls not linked to threats
    explanation: |
      Without mapping, there is no assurance that identified threats
      are addressed. Controls may exist but not cover actual threats.
    remediation: |
      - Create threat-countermeasure mapping
      - Map controls to specific threats
      - Document relationships
      - Review for completeness
  - id: CNTMAP-CRIT-002
    signal: High-priority threats without countermeasures
    evidence_indicators:
    - Critical threats unmapped
    - No mitigation for top threats
    - Gaps in critical coverage
    explanation: |
      High-priority threats must have corresponding defenses. Gaps
      leave the organization exposed to significant risk.
    remediation: |
      - Identify gaps for high-priority threats
      - Implement countermeasures
      - Prioritize critical coverage
      - Verify implementation
  high:
  - id: CNTMAP-HIGH-001
    signal: Single point of defense for critical threats
    evidence_indicators:
    - No defense in depth
    - Single control per threat
    - Control failure means exposure
    explanation: |
      Defense in depth requires layered controls. Single defenses
      create single points of failure.
    remediation: |
      - Implement defense in depth
      - Add layered controls
      - Diversify countermeasures
      - Reduce single dependencies
  - id: CNTMAP-HIGH-002
    signal: Countermeasure effectiveness not verified
    evidence_indicators:
    - Untested controls
    - Unknown effectiveness
    - Assumed protection
    explanation: |
      Countermeasures should be verified effective. Assumed protection
      may be illusory.
    remediation: |
      - Verify control effectiveness
      - Test countermeasures
      - Validate protection
      - Address weaknesses
  medium:
  - id: CNTMAP-MED-001
    signal: Mapping not kept current
    evidence_indicators:
    - Stale mapping
    - New threats not mapped
    - Control changes not reflected
    explanation: |
      Mapping must stay current as threats and controls change.
      Stale mapping provides false assurance.
    remediation: |
      - Update mapping regularly
      - Track threat changes
      - Reflect control changes
      - Schedule reviews
  - id: CNTMAP-MED-002
    signal: Mapping not documented systematically
    evidence_indicators:
    - Informal knowledge only
    - Incomplete documentation
    - Hard to review mapping
    explanation: |
      Systematic documentation enables review and validation.
      Informal mapping is unreliable.
    remediation: |
      - Document mapping systematically
      - Use structured format
      - Enable review
      - Support audit
  low:
  - id: CNTMAP-LOW-001
    signal: No traceability from controls to threats
    evidence_indicators:
    - One-way mapping only
    - Cannot find threats from controls
    - Limited traceability
    explanation: |
      Bidirectional traceability supports both coverage analysis
      and control justification.
    remediation: |
      - Enable bidirectional traceability
      - Map threats to controls
      - Map controls to threats
      - Support both views
  positive:
  - id: CNTMAP-POS-001
    signal: Comprehensive countermeasure mapping
    evidence_indicators:
    - All threats mapped
    - Defense in depth
    - Documented relationships
  - id: CNTMAP-POS-002
    signal: Verified countermeasure effectiveness
    evidence_indicators:
    - Tested controls
    - Validated protection
    - Current mapping
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Mapping Review
    description: |
      Evaluate threat-countermeasure mapping documentation.
    duration_estimate: 45 min
    commands:
    - purpose: Find mapping documentation
      command: |
        find . -type f \( -name "*countermeasure*" -o -name "*mapping*" \
          -o -name "*mitigation*" \) -exec grep -l -i "threat" {} \; 2>/dev/null | head -15
    - purpose: Search for mapping relationships
      command: |
        grep -rniE "(countermeasure|control|mitigation)\\s*[=:]" \
          --include="*.yaml" --include="*.json" . 2>/dev/null | head -30
    expected_findings:
    - Mapping documentation
    - Threat-control relationships
    - Coverage scope
  - id: '2'
    name: Coverage Analysis
    description: |
      Analyze countermeasure coverage for threats.
    duration_estimate: 45 min
    commands:
    - purpose: Check for coverage analysis
      command: |
        grep -rniE "(coverage|gap|unmapped|unmitigated)" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | \
          grep -i "threat" | head -20
    - purpose: Find gap documentation
      command: |
        grep -rniE "(gap|missing|lack).*countermeasure" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | head -15
    expected_findings:
    - Coverage analysis
    - Gap identification
    - Unmapped threats
  - id: '3'
    name: Defense in Depth Review
    description: |
      Assess layered defense implementation.
    duration_estimate: 30 min
    commands:
    - purpose: Find defense in depth references
      command: |
        grep -rniE "(defense.in.depth|layered|multiple.control)" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | head -15
    - purpose: Check for multiple controls
      command: |
        grep -rniE "(multiple|layered|redundant).*control" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | head -15
    expected_findings:
    - Defense in depth approach
    - Layered controls
    - Control redundancy
  - id: '4'
    name: Effectiveness Review
    description: |
      Evaluate countermeasure effectiveness verification.
    duration_estimate: 30 min
    commands:
    - purpose: Find effectiveness verification
      command: |
        grep -rniE "(effective|verify|test|valid).*countermeasure" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | head -15
    - purpose: Check for testing
      command: |
        grep -rniE "(test|verify|assess).*control" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | head -15
    expected_findings:
    - Effectiveness verification
    - Testing evidence
    - Validation approach
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Mapping Assessment
    - Coverage Analysis
    - Defense in Depth Review
    - Recommendations
  - type: coverage_matrix
    format: table
    description: Threat-countermeasure coverage matrix
  confidence_guidance:
    high: Comprehensive mapping with defense in depth
    medium: Mapping exists but gaps in coverage or depth
    low: Minimal or no mapping
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: owasp-countermeasures
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires comprehensive mapping review
    full:
      included: true
      priority: 2
    security:
      included: true
      priority: 1
closeout_checklist:
- id: cntmap-001
  item: Countermeasure mapping exists
  level: CRITICAL
  verification: manual
  verification_notes: Verify mapping documentation
  expected: Confirmed by reviewer
- id: cntmap-002
  item: High-priority threats have countermeasures
  level: CRITICAL
  verification: manual
  verification_notes: Verify critical threat coverage
  expected: Confirmed by reviewer
- id: cntmap-003
  item: Defense in depth implemented
  level: BLOCKING
  verification: manual
  verification_notes: Verify layered controls
  expected: Confirmed by reviewer
- id: cntmap-004
  item: Countermeasure effectiveness verified
  level: WARNING
  verification: manual
  verification_notes: Check for effectiveness verification
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: OWASP
    controls:
    - Countermeasure Identification
  - framework: NIST 800-53
    controls:
    - Control Implementation
  - framework: SOC 2
    controls:
    - CC6.1
relationships:
  commonly_combined:
  - risk-management.threat-modeling.threat-identification
  - risk-management.threat-modeling.threat-prioritization
  - risk-management.risk-mitigation.mitigation-effectiveness
