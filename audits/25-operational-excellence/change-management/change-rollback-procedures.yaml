audit:
  id: operational-excellence.change-management.change-rollback-procedures
  name: Change Rollback Procedures Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: operational-excellence
  category_number: 25
  subcategory: change-management
  tier: phd
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: process
  default_profiles:
  - full
  - production
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines change rollback capabilities including:
    - Rollback procedure documentation
    - Automated vs manual rollback capabilities
    - Rollback testing and validation
    - Database migration rollback
    - Configuration rollback
    - Rollback decision criteria
    - Time-to-rollback targets
    - Partial rollback capabilities
  why_it_matters: |
    Effective rollback is essential for limiting change impact:
    - Quick rollback minimizes customer exposure to issues
    - Documented procedures ensure consistent execution
    - Tested rollback builds confidence in deployment
    - Irreversible changes require extra scrutiny

    Google SRE emphasizes that all changes should be reversible.
    Rollback is often faster than forward-fix and reduces stress
    during incident response.
  when_to_run:
  - Before major deployments
  - Quarterly operational reviews
  - After failed rollback attempts
  - When deployment architecture changes
  - During production readiness reviews
prerequisites:
  required_artifacts:
  - type: rollback_documentation
    description: Rollback procedure documentation
  - type: deployment_config
    description: Deployment and rollback configurations
  - type: migration_history
    description: Database migration history
  access_requirements:
  - Rollback documentation access
  - Deployment configuration access
  - CI/CD pipeline access
  - Database migration access
discovery:
  code_patterns:
  - pattern: (rollback|revert|undo|downgrade)
    type: regex
    scope: config
    purpose: Detect rollback configurations
  - pattern: (blue.green|canary|progressive|staged)
    type: regex
    scope: config
    purpose: Detect deployment strategies
  - pattern: (migration|migrate).*(down|rollback|revert)
    type: regex
    scope: source
    purpose: Detect database rollback
  file_patterns:
  - glob: '**/rollback*/**/*.{md,yaml,yml}'
    purpose: Rollback documentation
  - glob: '**/deploy*/**/*.{yaml,yml}'
    purpose: Deployment configurations
  - glob: '**/migrations/**/*'
    purpose: Database migrations
knowledge_sources:
  specifications:
  - id: google-sre-release
    name: Google SRE - Release Engineering
    url: https://sre.google/sre-book/release-engineering/
    offline_cache: true
    priority: required
  guides:
  - id: deployment-strategies
    name: Kubernetes Deployment Strategies
    url: https://kubernetes.io/docs/concepts/workloads/controllers/deployment/
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: kubectl
    purpose: Kubernetes rollback
    command: kubectl rollout history deployment
  - tool: helm
    purpose: Helm release rollback
    command: helm history release-name
  scripts:
  - id: rollback-scanner
    language: bash
    purpose: Find rollback configurations
    source: inline
    code: |
      #!/bin/bash
      echo "=== Rollback Configuration Scan ==="
      grep -rniE "(rollback|revert|undo)" \
        --include="*.yaml" --include="*.md" . 2>/dev/null | head -30
signals:
  critical:
  - id: CRP-CRIT-001
    signal: No rollback capability exists
    evidence_indicators:
    - Deployments cannot be reverted
    - No previous version retained
    - Changes are one-way only
    explanation: |
      Without rollback, problematic changes can only be addressed by
      forward-fixing, which takes longer and is riskier. Every change
      should be reversible as a safety mechanism.
    remediation: |
      - Implement deployment rollback capability
      - Retain previous versions
      - Configure automated rollback
      - Test rollback regularly
      - Document rollback procedures
  - id: CRP-CRIT-002
    signal: Database migrations are irreversible
    evidence_indicators:
    - No down migrations defined
    - Data destructive migrations
    - Schema changes cannot be undone
    explanation: |
      Irreversible database migrations trap applications in broken states.
      Down migrations should be defined and tested for all schema changes.
      Data migrations require careful rollback planning.
    remediation: |
      - Require down migrations for all schema changes
      - Test down migrations before deployment
      - Avoid destructive data changes
      - Implement data backup before migration
      - Document data rollback procedures
  high:
  - id: CRP-HIGH-001
    signal: Rollback procedures not documented
    evidence_indicators:
    - Rollback capability exists but undocumented
    - Procedures in tribal knowledge only
    - Steps unclear during incidents
    explanation: |
      Undocumented rollback forces improvisation during incidents.
      Clear documentation ensures consistent, rapid execution when
      rollback is needed urgently.
    remediation: |
      - Document rollback procedures
      - Include step-by-step instructions
      - Document verification steps
      - Make docs accessible during incidents
      - Review docs regularly
  - id: CRP-HIGH-002
    signal: Rollback not tested
    evidence_indicators:
    - Rollback capability assumed but untested
    - No rollback drills conducted
    - Last successful rollback unknown
    explanation: |
      Untested rollback may fail when needed. Regular testing validates
      that rollback actually works and keeps team practiced in execution.
    remediation: |
      - Test rollback regularly
      - Include in game day exercises
      - Track time-to-rollback
      - Fix issues found in testing
      - Validate after deployment changes
  medium:
  - id: CRP-MED-001
    signal: No rollback decision criteria
    evidence_indicators:
    - Unclear when to rollback vs forward-fix
    - Rollback decisions ad-hoc
    - Inconsistent rollback decisions
    explanation: |
      Clear criteria enable rapid rollback decisions. Without them,
      teams may hesitate or debate during incidents, extending impact.
    remediation: |
      - Define rollback criteria
      - Include error rate thresholds
      - Specify time-to-decision limits
      - Document in incident procedures
      - Train team on criteria
  - id: CRP-MED-002
    signal: Manual-only rollback
    evidence_indicators:
    - No automated rollback capability
    - Rollback requires many manual steps
    - Time-to-rollback is long
    explanation: |
      Manual rollback is slow and error-prone. Automated rollback
      enables faster recovery and reduces stress during incidents.
    remediation: |
      - Implement automated rollback
      - One-click or one-command rollback
      - Integrate with deployment pipeline
      - Enable auto-rollback on failure
      - Monitor rollback execution
  low:
  - id: CRP-LOW-001
    signal: Rollback metrics not tracked
    evidence_indicators:
    - Time-to-rollback unknown
    - Rollback frequency not measured
    - No rollback success rate
    explanation: |
      Metrics enable optimization and demonstrate capability. Tracking
      rollback metrics identifies improvement opportunities.
    remediation: |
      - Track time-to-rollback
      - Measure rollback frequency
      - Monitor success rate
      - Report metrics monthly
      - Set improvement targets
  positive:
  - id: CRP-POS-001
    signal: Automated rollback with clear decision criteria
    evidence_indicators:
    - One-command rollback available
    - Clear criteria for rollback decisions
    - Regular rollback testing
  - id: CRP-POS-002
    signal: Reversible database migrations
    evidence_indicators:
    - Down migrations defined and tested
    - Data backup before migrations
    - Rollback procedures documented
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Rollback Capability Review
    description: |
      Examine rollback configurations and capabilities.
    duration_estimate: 30 min
    commands:
    - purpose: Find rollback configurations
      command: |
        grep -rniE "(rollback|revert|undo)" \
          --include="*.yaml" --include="*.yml" . 2>/dev/null | head -30
    - purpose: Find deployment strategy configs
      command: |
        grep -rniE "(strategy|blue.green|canary|rolling)" \
          --include="*.yaml" . 2>/dev/null | head -20
    expected_findings:
    - Rollback configurations
    - Deployment strategies
    - Version retention
  - id: '2'
    name: Documentation Review
    description: |
      Examine rollback procedure documentation.
    duration_estimate: 30 min
    commands:
    - purpose: Find rollback documentation
      command: |
        find . -type f \( -name "*rollback*" -o -name "*revert*" \) \
          -name "*.md" 2>/dev/null | head -20
    - purpose: Search for rollback procedures
      command: |
        grep -rniE "(rollback|revert).*(procedure|step|how)" \
          --include="*.md" . 2>/dev/null | head -30
    expected_findings:
    - Rollback procedures
    - Step-by-step guides
    - Decision criteria
  - id: '3'
    name: Database Migration Review
    description: |
      Assess database rollback capabilities.
    duration_estimate: 30 min
    commands:
    - purpose: Find migration files
      command: |
        find . -type f \( -name "*migration*" -o -path "*migrate*" \) 2>/dev/null | head -20
    - purpose: Search for down migrations
      command: |
        grep -rniE "(down|rollback|revert)" \
          --include="*migration*" . 2>/dev/null | head -30
    expected_findings:
    - Migration files
    - Down migration presence
    - Rollback methods
  - id: '4'
    name: Testing and Metrics Review
    description: |
      Evaluate rollback testing and tracking.
    duration_estimate: 30 min
    commands:
    - purpose: Find rollback test documentation
      command: |
        grep -rniE "(test|validat|verif).*(rollback|revert)" \
          --include="*.md" . 2>/dev/null | head -20
    - purpose: Search for rollback metrics
      command: |
        grep -rniE "(metric|time|duration).*(rollback)" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | head -20
    expected_findings:
    - Testing records
    - Metrics tracking
    - Success/failure data
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Capability Assessment
    - Documentation Review
    - Database Rollback Analysis
    - Recommendations
  - type: rollback_matrix
    format: table
    description: Systems and their rollback capabilities
  confidence_guidance:
    high: Rollback documented and tested
    medium: Capability exists but testing unclear
    low: Rollback capability uncertain
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: google-sre-release
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Rollback audit requires thorough review
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1
closeout_checklist:
- id: crp-001
  item: Rollback capability exists
  level: CRITICAL
  verification: |
    grep -rniE "(rollback|revert)" \
      --include="*.yaml" . 2>/dev/null | wc -l | \
      xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: crp-002
  item: Rollback procedures are documented
  level: BLOCKING
  verification: |
    find . -type f -name "*rollback*.md" 2>/dev/null | wc -l | \
      xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: crp-003
  item: Database migrations are reversible
  level: BLOCKING
  verification: manual
  verification_notes: Verify down migrations exist for schema changes
  expected: Confirmed by reviewer
- id: crp-004
  item: Rollback is regularly tested
  level: WARNING
  verification: manual
  verification_notes: Verify rollback testing conducted
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC8.1
  - framework: ISO 27001
    controls:
    - A.12.1.2
  - framework: ITIL 4
    controls:
    - Change Enablement
relationships:
  commonly_combined:
  - operational-excellence.change-management.change-approval-process
  - operational-excellence.production-readiness.rollback-readiness
  - operational-excellence.runbook-procedures.recovery-procedures
