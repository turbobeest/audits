audit:
  id: operational-excellence.change-management.change-audit-trail
  name: Change Audit Trail Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: operational-excellence
  category_number: 25
  subcategory: change-management
  tier: phd
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: process
  default_profiles:
  - full
  - production
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines change audit trail practices including:
    - Change record completeness
    - Who, what, when, why documentation
    - Approval decision logging
    - Deployment artifact versioning
    - Configuration change tracking
    - Database change logging
    - Audit log retention
    - Audit trail accessibility
  why_it_matters: |
    Complete audit trails support compliance and operations:
    - Regulatory frameworks require change documentation
    - Troubleshooting needs change correlation
    - Security investigations require change history
    - Compliance audits need evidence of control

    SOC 2, ISO 27001, and PCI DSS all require change tracking.
    Beyond compliance, audit trails accelerate incident resolution
    by showing what changed before issues occurred.
  when_to_run:
  - Quarterly compliance reviews
  - Before compliance audits
  - After audit findings
  - When audit requirements change
  - During process improvement
prerequisites:
  required_artifacts:
  - type: audit_config
    description: Audit logging configurations
  - type: change_records
    description: Historical change records
  - type: retention_policy
    description: Log retention documentation
  access_requirements:
  - Audit log access
  - Change tracking system access
  - Configuration management access
  - Deployment history access
discovery:
  code_patterns:
  - pattern: (audit|log|record|track).*(change|deploy)
    type: regex
    scope: config
    purpose: Detect audit logging configurations
  - pattern: (retention|archive|preserve).*(log|audit|record)
    type: regex
    scope: config
    purpose: Detect retention settings
  file_patterns:
  - glob: '**/audit*/**/*.{yaml,yml,json}'
    purpose: Audit configurations
  - glob: '**/logging*/**/*.{yaml,yml}'
    purpose: Logging configurations
knowledge_sources:
  specifications:
  - id: soc2-change-management
    name: SOC 2 - Change Management Controls
    url: https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/sorhome.html
    offline_cache: true
    priority: required
  - id: iso27001-change-control
    name: ISO 27001 - Change Control
    url: https://www.iso.org/standard/27001
    offline_cache: true
    priority: required
  guides:
  - id: audit-trail-practices
    name: Audit Trail Best Practices
    url: https://csrc.nist.gov/publications/detail/sp/800-92/final
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: git
    purpose: Code change tracking
    command: git log --oneline
  - tool: kubectl
    purpose: Kubernetes change history
    command: kubectl rollout history
  scripts:
  - id: audit-config-scanner
    language: bash
    purpose: Find audit configurations
    source: inline
    code: |
      #!/bin/bash
      echo "=== Audit Trail Configuration Scan ==="
      grep -rniE "(audit|log|track).*(change|deploy|config)" \
        --include="*.yaml" --include="*.json" . 2>/dev/null | head -30
signals:
  critical:
  - id: CAT-CRIT-001
    signal: No change audit trail exists
    evidence_indicators:
    - Changes not logged
    - No record of who changed what
    - Change history unavailable
    explanation: |
      Without audit trails, organizations cannot demonstrate control
      for compliance, troubleshoot incidents effectively, or investigate
      security issues. All production changes must be recorded.
    remediation: |
      - Implement change audit logging
      - Configure deployment logging
      - Enable configuration tracking
      - Record approval decisions
      - Ensure log completeness
  - id: CAT-CRIT-002
    signal: Audit logs can be modified or deleted
    evidence_indicators:
    - Logs editable by deployers
    - No log integrity protection
    - Audit trail tamperable
    explanation: |
      Audit trails must be tamper-evident to be trustworthy.
      If deployers can modify or delete logs, the audit trail
      loses its value for compliance and investigation.
    remediation: |
      - Enable log immutability
      - Separate log access from deployment
      - Configure write-once logging
      - Implement log integrity verification
      - Alert on log tampering
  high:
  - id: CAT-HIGH-001
    signal: Audit records missing key fields
    evidence_indicators:
    - Who made change not recorded
    - What changed is incomplete
    - Why change made is missing
    explanation: |
      Complete audit records include: who (identity), what (details),
      when (timestamp), why (justification), and how (approval).
      Missing fields reduce audit trail value.
    remediation: |
      - Define required audit fields
      - Configure complete logging
      - Validate field population
      - Reject changes without required info
      - Audit record completeness
  - id: CAT-HIGH-002
    signal: Retention insufficient for compliance
    evidence_indicators:
    - Logs deleted before retention period
    - Historical data unavailable
    - Compliance period not covered
    explanation: |
      Compliance frameworks specify retention periods (often 1-7 years).
      Logs deleted before these periods prevent compliance demonstration
      and historical analysis.
    remediation: |
      - Identify retention requirements
      - Configure appropriate retention
      - Archive long-term storage
      - Verify retention compliance
      - Document retention policy
  medium:
  - id: CAT-MED-001
    signal: Database changes not audited
    evidence_indicators:
    - Schema changes unlogged
    - Data changes not tracked
    - Database audit disabled
    explanation: |
      Database changes are high-impact and should be audited.
      Without database audit, schema and data changes may go
      undetected, complicating troubleshooting and compliance.
    remediation: |
      - Enable database audit logging
      - Track schema changes
      - Log data modifications
      - Configure audit retention
      - Review database audit logs
  - id: CAT-MED-002
    signal: Configuration changes not tracked
    evidence_indicators:
    - Config changes unrecorded
    - No infrastructure change history
    - Environment drift undetected
    explanation: |
      Configuration changes can cause outages. Tracking enables
      change correlation during incidents and supports configuration
      as code practices.
    remediation: |
      - Implement configuration tracking
      - Use infrastructure as code
      - Version all configurations
      - Log configuration deployments
      - Enable change comparison
  low:
  - id: CAT-LOW-001
    signal: Audit trail not easily searchable
    evidence_indicators:
    - Manual log searching required
    - No centralized log access
    - Change correlation difficult
    explanation: |
      Searchable audit trails accelerate troubleshooting and audits.
      If logs require manual searching across systems, their value
      is reduced.
    remediation: |
      - Centralize audit logs
      - Enable search capabilities
      - Index key fields
      - Implement log aggregation
      - Create audit dashboards
  positive:
  - id: CAT-POS-001
    signal: Complete audit trail with integrity protection
    evidence_indicators:
    - All changes logged with full context
    - Logs tamper-evident
    - Retention meets compliance needs
  - id: CAT-POS-002
    signal: Searchable, centralized change history
    evidence_indicators:
    - Centralized log aggregation
    - Rapid search capability
    - Change correlation enabled
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Audit Configuration Review
    description: |
      Examine audit logging configurations.
    duration_estimate: 30 min
    commands:
    - purpose: Find audit configurations
      command: |
        find . -type f \( -name "*audit*" -o -name "*logging*" \) \
          \( -name "*.yaml" -o -name "*.json" \) 2>/dev/null | head -20
    - purpose: Search for audit settings
      command: |
        grep -rniE "(audit|log).*(enable|config|level)" \
          --include="*.yaml" --include="*.json" . 2>/dev/null | head -30
    expected_findings:
    - Audit configurations
    - Logging settings
    - Audit fields
  - id: '2'
    name: Record Completeness Review
    description: |
      Assess audit record completeness.
    duration_estimate: 30 min
    commands:
    - purpose: Find audit record requirements
      command: |
        grep -rniE "(who|what|when|why|user|change).*(log|record|audit)" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | head -30
    expected_findings:
    - Required fields
    - Record structure
    - Field population
  - id: '3'
    name: Retention Assessment
    description: |
      Evaluate audit log retention.
    duration_estimate: 30 min
    commands:
    - purpose: Find retention configuration
      command: |
        grep -rniE "(retention|archive|preserve|delete).*(day|month|year)" \
          --include="*.yaml" --include="*.md" . 2>/dev/null | head -20
    expected_findings:
    - Retention settings
    - Archive configuration
    - Compliance alignment
  - id: '4'
    name: Integrity and Access Review
    description: |
      Assess audit trail integrity and accessibility.
    duration_estimate: 30 min
    commands:
    - purpose: Find integrity controls
      command: |
        grep -rniE "(immutable|tamper|integrity|protect).*(log|audit)" \
          --include="*.yaml" --include="*.md" . 2>/dev/null | head -20
    - purpose: Search for centralization
      command: |
        grep -rniE "(central|aggregate|collect).*(log|audit)" \
          --include="*.yaml" . 2>/dev/null | head -20
    expected_findings:
    - Integrity controls
    - Centralization config
    - Access controls
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Audit Configuration Assessment
    - Record Completeness Review
    - Retention Analysis
    - Recommendations
  - type: compliance_matrix
    format: table
    description: Audit trail requirements by compliance framework
  confidence_guidance:
    high: Audit configurations documented and verifiable
    medium: Partial configuration, runtime verification needed
    low: Audit trail status unclear
offline:
  capability: partial
  runtime_required_for:
  - Log verification
  - Retention validation
  - Record sampling
  cache_manifest:
    knowledge:
    - source_id: soc2-change-management
      priority: required
    - source_id: iso27001-change-control
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Audit trail review requires thorough analysis
    full:
      included: true
      priority: 2
    production:
      included: true
      priority: 1
closeout_checklist:
- id: cat-001
  item: Change audit logging is configured
  level: CRITICAL
  verification: |
    grep -rniE "(audit|log).*(change|deploy)" \
      --include="*.yaml" . 2>/dev/null | wc -l | \
      xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: cat-002
  item: Audit records include required fields
  level: BLOCKING
  verification: manual
  verification_notes: Verify who, what, when, why are captured
  expected: Confirmed by reviewer
- id: cat-003
  item: Retention meets compliance requirements
  level: BLOCKING
  verification: manual
  verification_notes: Verify retention aligns with applicable frameworks
  expected: Confirmed by reviewer
- id: cat-004
  item: Audit logs are tamper-evident
  level: WARNING
  verification: manual
  verification_notes: Verify log integrity protection
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC8.1
    - CC7.2
  - framework: ISO 27001
    controls:
    - A.12.1.2
    - A.12.4.1
  - framework: PCI DSS
    controls:
    - 6.4.1
    - '10.1'
  - framework: HIPAA
    controls:
    - 164.312(b)
relationships:
  commonly_combined:
  - operational-excellence.change-management.change-approval-process
  - operational-excellence.incident-management.post-incident-review
  - security-trust.audit-logging.audit-completeness
