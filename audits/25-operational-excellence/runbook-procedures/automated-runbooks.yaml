audit:
  id: operational-excellence.runbook-procedures.automated-runbooks
  name: Automated Runbooks Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: operational-excellence
  category_number: 25
  subcategory: runbook-procedures
  tier: phd
  estimated_duration: 3-4 hours  # median: 3h
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: process
  default_profiles:
  - full
  - production
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines runbook automation including:
    - Automation coverage of manual procedures
    - Self-healing automation implementation
    - Runbook automation tools (Rundeck, StackStorm, etc.)
    - Auto-remediation from alerts
    - One-click remediation capabilities
    - Automation safety controls
    - Audit logging for automated actions
    - Rollback capabilities for automation
  why_it_matters: |
    Automated runbooks reduce toil and improve reliability:
    - Faster response than human execution
    - Consistent procedure execution every time
    - Reduced human error during high-stress situations
    - On-call responders freed for complex problem-solving

    Google SRE defines toil as "manual, repetitive, automatable" work.
    Runbook automation is a primary mechanism for reducing operational
    toil while maintaining operational consistency.
  when_to_run:
  - Quarterly operational reviews
  - When toil metrics indicate high manual work
  - After repeated manual runbook execution
  - During automation planning
  - When evaluating automation tools
prerequisites:
  required_artifacts:
  - type: runbook_documentation
    description: Manual runbook procedures
  - type: automation_config
    description: Automation tool configurations
  - type: alert_configuration
    description: Alert-to-automation mappings
  access_requirements:
  - Read access to runbook documentation
  - Automation tool configuration access
  - Alert configuration access
  - Execution history access
discovery:
  code_patterns:
  - pattern: (rundeck|stackstorm|ansible|terraform|automation)
    type: regex
    scope: config
    purpose: Detect automation tool configurations
  - pattern: (auto.remediat|self.heal|auto.recover|auto.scale)
    type: regex
    scope: config
    purpose: Detect auto-remediation patterns
  - pattern: (webhook|trigger|action).*(alert|incident)
    type: regex
    scope: config
    purpose: Detect alert-triggered automation
  file_patterns:
  - glob: '**/rundeck/**/*.yaml'
    purpose: Rundeck job definitions
  - glob: '**/stackstorm/**/*.yaml'
    purpose: StackStorm workflow definitions
  - glob: '**/automation/**/*.yaml'
    purpose: Automation configurations
  - glob: '**/*-runbook*.sh'
    purpose: Scripted runbooks
knowledge_sources:
  specifications:
  - id: google-sre-toil
    name: Google SRE - Eliminating Toil
    url: https://sre.google/sre-book/eliminating-toil/
    offline_cache: true
    priority: required
  guides:
  - id: rundeck-automation
    name: Rundeck Runbook Automation
    url: https://docs.rundeck.com/
    offline_cache: true
  - id: stackstorm-automation
    name: StackStorm Event-Driven Automation
    url: https://docs.stackstorm.com/
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: rundeck
    purpose: Runbook automation platform
    command: rd jobs list
  - tool: stackstorm
    purpose: Event-driven automation
    command: st2 action list
  scripts:
  - id: automation-scanner
    language: bash
    purpose: Find runbook automation configurations
    source: inline
    code: |
      #!/bin/bash
      echo "=== Runbook Automation Scan ==="
      find . -type f \( -name "*rundeck*" -o -name "*stackstorm*" -o -name "*automation*" \) \
        \( -name "*.yaml" -o -name "*.yml" \) 2>/dev/null | head -30
signals:
  critical:
  - id: AR-CRIT-001
    signal: Automated runbooks lack safety controls
    evidence_indicators:
    - No approval required for destructive operations
    - No rate limiting on auto-remediation
    - Automation can run without audit logging
    explanation: |
      Automation without safety controls can cause rapid, widespread damage.
      A misconfigured auto-remediation can restart services across the fleet
      or delete data faster than any human could. Safety controls are essential.
    remediation: |
      - Implement approval workflows for destructive operations
      - Add rate limiting to prevent cascading actions
      - Require audit logging for all automated actions
      - Implement dry-run modes for testing
      - Add circuit breakers for repeated failures
  - id: AR-CRIT-002
    signal: No rollback capability for automated actions
    evidence_indicators:
    - Automation makes irreversible changes
    - No undo or rollback procedure exists
    - State not captured before automation runs
    explanation: |
      Automated actions that cannot be reversed create high risk. If automation
      causes problems, operators must be able to quickly undo changes. Rollback
      should be automated too when possible.
    remediation: |
      - Capture state before making changes
      - Implement automated rollback procedures
      - Test rollback capabilities regularly
      - Document manual rollback for edge cases
      - Limit scope of automated changes
  high:
  - id: AR-HIGH-001
    signal: High-frequency manual runbooks not automated
    evidence_indicators:
    - Runbooks executed multiple times per week manually
    - Procedures are fully deterministic
    - No automation exists for common operations
    explanation: |
      Frequently executed manual runbooks are prime automation candidates.
      If a procedure is deterministic and executed often, it should be
      automated to reduce toil and improve consistency.
    remediation: |
      - Track manual runbook execution frequency
      - Prioritize automation by frequency
      - Identify automation blockers
      - Implement automation incrementally
      - Measure toil reduction
  - id: AR-HIGH-002
    signal: Alert-triggered remediation not implemented
    evidence_indicators:
    - Alerts require manual remediation
    - No webhook integration from alerting to automation
    - Self-healing not configured
    explanation: |
      Many alerts have known, deterministic remediations. Connecting alerts
      directly to automated remediation can resolve issues in seconds rather
      than waiting for human response.
    remediation: |
      - Identify alerts with deterministic fixes
      - Implement webhook-triggered automation
      - Start with safe, reversible remediations
      - Monitor automation effectiveness
      - Gradually expand coverage
  medium:
  - id: AR-MED-001
    signal: Automation execution not audited
    evidence_indicators:
    - No logs of what automation ran
    - No records of who triggered automation
    - Results not captured
    explanation: |
      Audit trails are essential for understanding what changed and debugging
      issues. All automated actions should be logged with context, results,
      and triggering information.
    remediation: |
      - Enable comprehensive audit logging
      - Capture trigger source and context
      - Log action results and duration
      - Retain logs for compliance period
      - Enable audit log searching
  - id: AR-MED-002
    signal: Automation tools not standardized
    evidence_indicators:
    - Multiple automation platforms in use
    - Inconsistent automation approaches
    - No center of excellence for automation
    explanation: |
      Fragmented automation approaches increase maintenance burden and
      reduce knowledge sharing. Standardizing on a common platform enables
      reuse and consistency.
    remediation: |
      - Evaluate and select standard automation platform
      - Migrate existing automation to standard
      - Document automation best practices
      - Establish automation review process
      - Train team on standard tools
  low:
  - id: AR-LOW-001
    signal: Automation coverage metrics not tracked
    evidence_indicators:
    - Percentage of automated runbooks unknown
    - Automation usage not measured
    - Toil reduction not quantified
    explanation: |
      Without metrics, organizations cannot demonstrate automation value
      or prioritize further investment. Tracking coverage and usage enables
      data-driven decisions.
    remediation: |
      - Calculate automation coverage percentage
      - Track automation execution frequency
      - Measure manual execution reduction
      - Report automation ROI
      - Set coverage targets
  positive:
  - id: AR-POS-001
    signal: Comprehensive runbook automation with safety controls
    evidence_indicators:
    - High automation coverage for frequent procedures
    - Safety controls implemented (approval, rate limiting)
    - Audit logging enabled
  - id: AR-POS-002
    signal: Alert-triggered auto-remediation operational
    evidence_indicators:
    - Self-healing configured for common issues
    - Automation reduces MTTR
    - Manual intervention decreasing
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Automation Tool Inventory
    description: |
      Identify automation tools and configurations in use.
    duration_estimate: 30 min
    commands:
    - purpose: Find automation tool configurations
      command: |
        find . -type f \( -name "*rundeck*" -o -name "*stackstorm*" \
          -o -name "*automation*" -o -name "*ansible*" \) \
          \( -name "*.yaml" -o -name "*.yml" \) 2>/dev/null | head -30
    - purpose: Find scripted runbooks
      command: |
        find . -type f \( -name "*runbook*.sh" -o -name "*remediat*.sh" \) 2>/dev/null | head -20
    expected_findings:
    - Automation tool configurations
    - Scripted runbooks
    - Automation coverage
  - id: '2'
    name: Safety Control Assessment
    description: |
      Evaluate safety controls for automated runbooks.
    duration_estimate: 30 min
    commands:
    - purpose: Find approval workflow configurations
      command: |
        grep -rniE "(approval|confirm|verify|dry.run)" \
          --include="*.yaml" --include="*.yml" . 2>/dev/null | head -30
    - purpose: Find rate limiting configurations
      command: |
        grep -rniE "(rate.limit|throttle|cooldown|circuit.breaker)" \
          --include="*.yaml" --include="*.yml" . 2>/dev/null | head -20
    expected_findings:
    - Approval workflows
    - Rate limiting
    - Safety mechanisms
  - id: '3'
    name: Alert-Automation Integration Review
    description: |
      Assess integration between alerts and automated remediation.
    duration_estimate: 30 min
    commands:
    - purpose: Find alert-to-automation webhooks
      command: |
        grep -rniE "(webhook|trigger|action).*(alert|incident)" \
          --include="*.yaml" --include="*.json" . 2>/dev/null | head -30
    - purpose: Find auto-remediation configurations
      command: |
        grep -rniE "(auto.remediat|self.heal|auto.recover)" \
          --include="*.yaml" . 2>/dev/null | head -20
    expected_findings:
    - Alert webhooks
    - Auto-remediation rules
    - Self-healing configuration
  - id: '4'
    name: Audit Logging Review
    description: |
      Verify audit logging for automated actions.
    duration_estimate: 30 min
    commands:
    - purpose: Find audit logging configurations
      command: |
        grep -rniE "(audit|log|record).*(action|execution|automation)" \
          --include="*.yaml" --include="*.json" . 2>/dev/null | head -20
    expected_findings:
    - Audit logging configuration
    - Log retention settings
    - Compliance alignment
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Automation Coverage Assessment
    - Safety Control Review
    - Alert Integration Analysis
    - Recommendations
  - type: automation_matrix
    format: table
    description: Runbooks and their automation status
  confidence_guidance:
    high: Automation tools and configurations fully observable
    medium: Partial visibility, some tools require runtime access
    low: Automation landscape unclear, requires interviews
offline:
  capability: partial
  runtime_required_for:
  - Automation tool verification
  - Execution history review
  - Safety control testing
  cache_manifest:
    knowledge:
    - source_id: google-sre-toil
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Automation audit requires comprehensive review
    full:
      included: true
      priority: 2
    production:
      included: true
      priority: 2
closeout_checklist:
- id: ar-001
  item: Automation safety controls implemented
  level: CRITICAL
  verification: |
    grep -rniE "(approval|dry.run|rate.limit)" \
      --include="*.yaml" . 2>/dev/null | \
      wc -l | xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: ar-002
  item: Automated actions are audit logged
  level: BLOCKING
  verification: manual
  verification_notes: Verify audit logging is enabled for all automation
  expected: Confirmed by reviewer
- id: ar-003
  item: High-frequency runbooks are automated
  level: WARNING
  verification: manual
  verification_notes: Verify frequently executed procedures have automation
  expected: Confirmed by reviewer
- id: ar-004
  item: Rollback capabilities exist
  level: WARNING
  verification: manual
  verification_notes: Verify automated actions can be rolled back
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC7.4
    - CC8.1
  - framework: ISO 27001
    controls:
    - A.12.1.1
    - A.12.1.2
relationships:
  commonly_combined:
  - operational-excellence.runbook-procedures.runbook-completeness
  - operational-excellence.operational-metrics.toil-measurement
  - operational-excellence.operational-metrics.automation-coverage
