audit:
  id: operational-excellence.runbook-procedures.recovery-procedures
  name: Recovery Procedures Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: operational-excellence
  category_number: 25
  subcategory: runbook-procedures
  tier: phd
  estimated_duration: 3-4 hours  # median: 3h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: process
  default_profiles:
  - full
  - production
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines system recovery procedures including:
    - Database restoration procedures
    - Service recovery runbooks
    - Data recovery from backups
    - Failover procedures
    - Cluster recovery processes
    - State reconstruction methods
    - Dependency recovery ordering
    - Verification procedures post-recovery
  why_it_matters: |
    Well-documented recovery procedures minimize downtime and data loss:
    - Recovery time directly impacts RTO achievement
    - Incorrect recovery can cause additional damage
    - Dependencies must be recovered in correct order
    - Verification ensures recovery completeness

    Recovery procedures are tested least but needed most. Without
    documented, validated procedures, teams must improvise during
    outages, extending recovery time and risking data integrity.
  when_to_run:
  - Quarterly disaster recovery reviews
  - After backup system changes
  - Before major releases
  - Following recovery failures
  - During compliance audits
prerequisites:
  required_artifacts:
  - type: recovery_documentation
    description: Recovery runbook documentation
  - type: backup_documentation
    description: Backup and restore procedures
  - type: architecture_docs
    description: System architecture and dependencies
  access_requirements:
  - Read access to recovery documentation
  - Backup system documentation access
  - Architecture documentation access
  - Test recovery verification
discovery:
  code_patterns:
  - pattern: (recover|restore|failover|failback)
    type: regex
    scope: docs
    purpose: Detect recovery procedure documentation
  - pattern: (backup|snapshot|point.in.time|pitr)
    type: regex
    scope: config
    purpose: Detect backup-related recovery
  - pattern: (rto|rpo|recovery.time|recovery.point)
    type: regex
    scope: docs
    purpose: Detect recovery objectives
  file_patterns:
  - glob: '**/recovery*/**/*.md'
    purpose: Recovery procedure directories
  - glob: '**/restore*/**/*.md'
    purpose: Restore procedure documentation
  - glob: '**/backup*/**/*.md'
    purpose: Backup documentation
  - glob: '**/failover*/**/*.md'
    purpose: Failover procedures
knowledge_sources:
  specifications:
  - id: nist-contingency
    name: NIST SP 800-34 - Contingency Planning
    url: https://csrc.nist.gov/publications/detail/sp/800-34/rev-1/final
    offline_cache: true
    priority: required
  guides:
  - id: aws-disaster-recovery
    name: AWS Disaster Recovery Whitepaper
    url: https://docs.aws.amazon.com/whitepapers/latest/disaster-recovery-workloads-on-aws/
    offline_cache: true
  - id: google-sre-recovery
    name: Google SRE - Managing Incidents
    url: https://sre.google/sre-book/managing-incidents/
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: aws-backup
    purpose: AWS backup and recovery
    command: aws backup list-recovery-points
  - tool: velero
    purpose: Kubernetes backup and restore
    command: velero backup get
  scripts:
  - id: recovery-doc-scanner
    language: bash
    purpose: Find recovery procedure documentation
    source: inline
    code: |
      #!/bin/bash
      echo "=== Recovery Procedure Documentation Scan ==="
      find . -type f \( -name "*recover*" -o -name "*restore*" \
        -o -name "*failover*" -o -name "*backup*" \) -name "*.md" 2>/dev/null | head -30
signals:
  critical:
  - id: RP-CRIT-001
    signal: No recovery procedures documented
    evidence_indicators:
    - No recovery runbooks exist
    - Restore procedures not documented
    - Failover process unknown
    explanation: |
      Without documented recovery procedures, teams must improvise during
      outages. This extends recovery time, increases error risk, and may
      result in data loss. Recovery procedures are essential for achieving
      RTO and RPO objectives.
    remediation: |
      - Document recovery procedures for all critical services
      - Create database restoration runbooks
      - Document failover procedures
      - Include verification steps
      - Test all recovery procedures
  - id: RP-CRIT-002
    signal: Recovery procedures never tested
    evidence_indicators:
    - No recovery testing records
    - Procedures untested since creation
    - Unknown if procedures work
    explanation: |
      Untested recovery procedures are unreliable. System changes, backup
      format changes, and procedural errors may prevent successful recovery.
      Regular testing validates recovery capability.
    remediation: |
      - Implement quarterly recovery testing
      - Test backup restoration regularly
      - Validate failover procedures
      - Document test results
      - Update procedures based on findings
  high:
  - id: RP-HIGH-001
    signal: Dependency recovery order not documented
    evidence_indicators:
    - No service dependency map for recovery
    - Recovery order not specified
    - Interdependencies not addressed
    explanation: |
      Complex systems have dependencies that must be recovered in order.
      Starting services before their dependencies can cause failures or
      data corruption. Recovery order must be explicitly documented.
    remediation: |
      - Map service dependencies for recovery
      - Document recovery order
      - Include dependency health checks
      - Automate ordered recovery where possible
      - Test dependency-aware recovery
  - id: RP-HIGH-002
    signal: No post-recovery verification procedures
    evidence_indicators:
    - Recovery ends without validation
    - No health checks after restore
    - Data integrity not verified
    explanation: |
      Recovery without verification may leave systems in inconsistent
      states. Verification ensures data integrity, service health, and
      functional correctness before declaring recovery complete.
    remediation: |
      - Define verification checklist per service
      - Include data integrity checks
      - Verify service health indicators
      - Test user-facing functionality
      - Document verification results
  - id: RP-HIGH-003
    signal: RTO/RPO not achievable with current procedures
    evidence_indicators:
    - Recovery time exceeds RTO
    - Backup gaps exceed RPO
    - Procedures too slow for objectives
    explanation: |
      Recovery procedures must meet RTO (Recovery Time Objective) and
      RPO (Recovery Point Objective) requirements. If procedures cannot
      achieve these objectives, business continuity is at risk.
    remediation: |
      - Measure actual recovery time
      - Verify backup frequency meets RPO
      - Optimize slow recovery steps
      - Automate where possible
      - Consider alternative recovery methods
  medium:
  - id: RP-MED-001
    signal: Recovery procedures require manual steps
    evidence_indicators:
    - Mostly manual recovery process
    - Limited automation
    - Human intervention required throughout
    explanation: |
      Manual recovery procedures are slower, error-prone, and require
      available trained personnel. Automation reduces recovery time and
      improves consistency.
    remediation: |
      - Identify automation opportunities
      - Script common recovery tasks
      - Implement orchestrated recovery
      - Retain manual fallback procedures
      - Test automated recovery regularly
  - id: RP-MED-002
    signal: Point-in-time recovery not documented
    evidence_indicators:
    - No PITR procedures exist
    - Can only restore to backup time
    - Transaction log recovery not documented
    explanation: |
      Point-in-time recovery (PITR) allows restoration to specific moments,
      minimizing data loss. Without PITR procedures, recovery is limited
      to backup timestamps, potentially losing significant data.
    remediation: |
      - Document PITR procedures
      - Verify transaction log backups
      - Test PITR restoration
      - Train team on PITR execution
      - Define PITR decision criteria
  low:
  - id: RP-LOW-001
    signal: Recovery metrics not tracked
    evidence_indicators:
    - Recovery time not measured
    - Success rate unknown
    - No recovery improvement tracking
    explanation: |
      Without metrics, organizations cannot verify RTO achievement or
      identify improvement opportunities. Tracking recovery metrics
      enables optimization and compliance demonstration.
    remediation: |
      - Measure recovery time for all tests
      - Track success/failure rates
      - Compare against RTO objectives
      - Identify bottlenecks
      - Report metrics quarterly
  positive:
  - id: RP-POS-001
    signal: Comprehensive recovery procedures with regular testing
    evidence_indicators:
    - Recovery documented for all critical services
    - Regular recovery testing conducted
    - RTO/RPO objectives achievable
  - id: RP-POS-002
    signal: Automated recovery with verification
    evidence_indicators:
    - Recovery procedures automated
    - Post-recovery verification automated
    - Dependency-aware recovery implemented
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Recovery Procedure Inventory
    description: |
      Identify all recovery procedure documentation.
    duration_estimate: 45 min
    commands:
    - purpose: Find recovery documentation
      command: |
        find . -type f \( -name "*recover*" -o -name "*restore*" \
          -o -name "*failover*" \) -name "*.md" 2>/dev/null | head -30
    - purpose: Find backup restoration docs
      command: |
        find . -type f -name "*backup*" -name "*.md" 2>/dev/null | head -20
    expected_findings:
    - Recovery procedure documents
    - Backup restoration guides
    - Failover procedures
  - id: '2'
    name: Service Coverage Assessment
    description: |
      Verify recovery procedures exist for all critical services.
    duration_estimate: 30 min
    commands:
    - purpose: Find service definitions
      command: |
        grep -rniE "(service|application).*(name|id)" \
          --include="*.yaml" --include="*.tf" . 2>/dev/null | head -30
    - purpose: Cross-reference with recovery docs
      command: |
        find . -name "*recover*.md" -exec basename {} \; 2>/dev/null | sort | head -30
    expected_findings:
    - Service inventory
    - Recovery coverage
    - Coverage gaps
  - id: '3'
    name: RTO/RPO Assessment
    description: |
      Review recovery time and point objectives.
    duration_estimate: 30 min
    commands:
    - purpose: Find RTO/RPO definitions
      command: |
        grep -rniE "(rto|rpo|recovery.time|recovery.point)" \
          --include="*.md" --include="*.yaml" . 2>/dev/null | head -30
    - purpose: Find backup frequency configuration
      command: |
        grep -rniE "(backup|snapshot).*(schedule|frequency|interval)" \
          --include="*.yaml" --include="*.tf" . 2>/dev/null | head -20
    expected_findings:
    - RTO definitions
    - RPO requirements
    - Backup schedules
  - id: '4'
    name: Testing and Verification Review
    description: |
      Assess recovery testing practices and verification procedures.
    duration_estimate: 30 min
    commands:
    - purpose: Find recovery test documentation
      command: |
        find . -type f \( -name "*test*" -o -name "*drill*" \) \
          -path "*recovery*" -name "*.md" 2>/dev/null | head -20
    - purpose: Find verification procedures
      command: |
        grep -rniE "(verify|validate|check|confirm).*(recovery|restore)" \
          --include="*.md" . 2>/dev/null | head -30
    expected_findings:
    - Test records
    - Verification procedures
    - Test results
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Procedure Coverage Assessment
    - RTO/RPO Analysis
    - Testing Review
    - Recommendations
  - type: recovery_matrix
    format: table
    description: Services and their recovery procedure status
  confidence_guidance:
    high: Recovery procedures documented and tested
    medium: Partial coverage, some testing conducted
    low: Recovery readiness unclear, requires verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: nist-contingency
      priority: required
    - source_id: google-sre-recovery
      priority: recommended
profiles:
  membership:
    quick:
      included: false
      reason: Recovery audit requires thorough review
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1
closeout_checklist:
- id: rp-001
  item: Recovery procedures exist for critical services
  level: CRITICAL
  verification: |
    find . -type f \( -name "*recover*" -o -name "*restore*" \) \
      -name "*.md" 2>/dev/null | wc -l | \
      xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: rp-002
  item: Recovery procedures tested within 12 months
  level: CRITICAL
  verification: manual
  verification_notes: Verify recovery testing conducted and documented
  expected: Confirmed by reviewer
- id: rp-003
  item: Recovery meets RTO/RPO objectives
  level: BLOCKING
  verification: manual
  verification_notes: Verify tested recovery times meet defined objectives
  expected: Confirmed by reviewer
- id: rp-004
  item: Post-recovery verification procedures exist
  level: WARNING
  verification: |
    grep -rniE "verify.*(recovery|restore)" \
      --include="*.md" . 2>/dev/null | wc -l | \
      xargs -I{} test {} -gt 0 && echo "PASS" || echo "NEEDS_REVIEW"
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC7.5
    - A1.2
  - framework: ISO 27001
    controls:
    - A.17.1.1
    - A.17.1.2
    - A.17.1.3
  - framework: NIST 800-53
    controls:
    - CP-9
    - CP-10
relationships:
  commonly_combined:
  - operational-excellence.runbook-procedures.emergency-procedures
  - operational-excellence.production-readiness.rollback-readiness
  - operational-excellence.capacity-planning.capacity-testing
