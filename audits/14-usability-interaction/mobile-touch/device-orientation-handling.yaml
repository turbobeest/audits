# ============================================================
# AUDIT: Device Orientation Handling Assessment
# ============================================================
# Evaluates how the application handles device orientation
# changes between portrait and landscape modes.
# ============================================================

audit:
  id: "usability-interaction.mobile-touch.device-orientation-handling"

  name: "Device Orientation Handling Assessment"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "usability-interaction"
  category_number: 14
  subcategory: "mobile-touch"

  tier: "expert"
  estimated_duration: "1-2 hours"  # median: 1h

  completeness: "complete"
  requires_runtime: true
  destructive: false

# ============================================================
# EXECUTION CLASSIFICATION
# ============================================================

execution:
  automatable: "partial"
  severity: "medium"
  scope: "codebase"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

# ============================================================
# DESCRIPTION & RATIONALE
# ============================================================

description:
  what: |
    This audit evaluates how the application handles device orientation
    changes between portrait and landscape modes. It examines layout
    adaptation, state preservation, content visibility, and whether
    orientation is appropriately locked or allowed for different features.

  why_it_matters: |
    Users rotate devices for various reasons - viewing media, typing
    with larger keyboards, or personal preference. Applications that
    handle orientation changes poorly lose user state, break layouts,
    or frustrate users by not supporting their preferred orientation.
    Some features genuinely work better in specific orientations.

  when_to_run:
    - "During mobile development"
    - "When users report orientation issues"
    - "When adding media/video features"
    - "During mobile UX audits"

# ============================================================
# PREREQUISITES
# ============================================================

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Mobile layout and orientation handling code"
    - type: "running_application"
      description: "Access on rotatable device"

  access_requirements:
    - "Access to layout CSS/components"
    - "Device that can rotate"
    - "Understanding of orientation requirements"

# ============================================================
# DISCOVERY SPECIFICATION
# ============================================================

discovery:
  code_patterns:
    - pattern: "orientation|Orientation"
      type: "keyword"
      scope: "source"
      purpose: "Find orientation handling"
    - pattern: "landscape|portrait"
      type: "keyword"
      scope: "source"
      purpose: "Find orientation-specific code"
    - pattern: "screen\\.orientation|matchMedia.*orientation"
      type: "regex"
      scope: "source"
      purpose: "Find orientation detection"

  file_patterns:
    - glob: "**/*layout*"
      purpose: "Find layout components"
    - glob: "**/*responsive*"
      purpose: "Find responsive utilities"

# ============================================================
# KNOWLEDGE SOURCES
# ============================================================

knowledge_sources:
  guides:
    - id: "mdn-orientation"
      name: "MDN - Screen Orientation API"
      url: "https://developer.mozilla.org/en-US/docs/Web/API/Screen_Orientation_API"
      offline_cache: true
    - id: "apple-orientation"
      name: "Apple HIG - Layout and Adaptivity"
      url: "https://developer.apple.com/design/human-interface-guidelines/layout"
      offline_cache: true

# ============================================================
# TOOLING & AUTOMATION
# ============================================================

tooling:
  scripts:
    - id: "orientation-finder"
      language: "bash"
      purpose: "Find orientation handling patterns"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Orientation Media Queries ==="
        grep -rn "orientation" --include="*.css" --include="*.scss" | head -15

        echo "=== Orientation API Usage ==="
        grep -rn "screen.orientation\|matchMedia.*orientation" --include="*.js" --include="*.ts" --include="*.jsx" --include="*.tsx" | head -10

        echo "=== Landscape/Portrait Specific ==="
        grep -rn "landscape\|portrait" --include="*.css" --include="*.scss" --include="*.jsx" --include="*.tsx" | head -15

# ============================================================
# SIGNALS & FINDINGS TAXONOMY
# ============================================================

signals:
  critical:
    - id: "ORIENT-CRIT-001"
      signal: "Layout breaks on orientation change"
      evidence_indicators:
        - "Content overflow in landscape"
        - "Elements overlap after rotation"
        - "Page becomes unusable in one orientation"
      explanation: |
        Broken layouts make the application unusable in certain
        orientations, frustrating users who prefer or need that mode.
      remediation: "Implement flexible layouts that work in both orientations"
    - id: "ORIENT-CRIT-002"
      signal: "User state/data lost on rotation"
      evidence_pattern: "Form data or app state cleared on orientation change"
      explanation: |
        Losing user data on rotation is extremely frustrating and
        may prevent users from completing tasks.
      remediation: "Preserve application state across orientation changes"

  high:
    - id: "ORIENT-HIGH-001"
      signal: "Orientation locked without clear justification"
      evidence_pattern: "App locked to portrait for non-specific reason"
      explanation: |
        Users have preferences for orientation. Locking without
        good reason (like video playback) frustrates users.
      remediation: "Allow both orientations unless feature specifically requires one"
    - id: "ORIENT-HIGH-002"
      signal: "Critical content hidden in one orientation"
      evidence_pattern: "Important UI elements not visible in landscape"
      explanation: |
        If users choose landscape, all necessary content should
        still be accessible.
      remediation: "Ensure all content accessible in both orientations"
    - id: "ORIENT-HIGH-003"
      signal: "Keyboard covers content in landscape"
      evidence_pattern: "No scrolling when keyboard appears in landscape"
      explanation: |
        Landscape keyboard takes more vertical space. Without
        scrolling, content being edited may be hidden.
      remediation: "Implement scroll behavior to keep focused input visible"

  medium:
    - id: "ORIENT-MED-001"
      signal: "No optimization for landscape viewing"
      evidence_pattern: "Same single-column layout in landscape"
      remediation: "Consider multi-column or optimized layouts for landscape"
    - id: "ORIENT-MED-002"
      signal: "Orientation change causes janky animation"
      evidence_pattern: "Visible layout jump on rotation"
      remediation: "Smooth orientation change transition"
    - id: "ORIENT-MED-003"
      signal: "Modal dialogs don't adapt to landscape"
      evidence_pattern: "Modals too tall for landscape viewport"
      remediation: "Make modals responsive to available viewport"

  low:
    - id: "ORIENT-LOW-001"
      signal: "Landscape layout could be better optimized"
      remediation: "Consider tablet-style layouts for landscape phone"
    - id: "ORIENT-LOW-002"
      signal: "No indication when orientation is locked"
      remediation: "Communicate to users if orientation is intentionally locked"

  positive:
    - id: "ORIENT-POS-001"
      signal: "Smooth layout adaptation on rotation"
    - id: "ORIENT-POS-002"
      signal: "State preserved across orientation changes"
    - id: "ORIENT-POS-003"
      signal: "Landscape layout optimized for wider viewport"
    - id: "ORIENT-POS-004"
      signal: "Appropriate orientation lock for video/media"

# ============================================================
# EXECUTION PROCEDURE
# ============================================================

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Audit Orientation Handling Code"
      description: |
        Search the codebase for orientation-specific handling
        and media queries.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find orientation CSS"
          command: "grep -rn 'orientation' --include='*.css' --include='*.scss' src/"
        - purpose: "Find orientation API usage"
          command: "grep -rn 'screen.orientation\\|orientation' --include='*.jsx' --include='*.tsx' src/"
      expected_findings:
        - "Orientation handling patterns"
        - "Media query usage"

    - id: "2"
      name: "Test Key Screens in Both Orientations"
      description: |
        Test primary application screens in both portrait and
        landscape orientations.
      duration_estimate: "30 min"
      questions:
        - "Does each screen work in portrait?"
        - "Does each screen work in landscape?"
        - "Is content accessible in both?"
        - "Do layouts adapt appropriately?"
      expected_findings:
        - "Screen-by-screen assessment"
        - "Layout issues"

    - id: "3"
      name: "Test State Preservation"
      description: |
        Enter data in forms and rotate device to verify
        state is preserved.
      duration_estimate: "20 min"
      questions:
        - "Is form data preserved on rotation?"
        - "Is scroll position maintained?"
        - "Are modal states preserved?"
        - "Is playback state maintained for media?"
      expected_findings:
        - "State preservation"
        - "Data loss scenarios"

    - id: "4"
      name: "Test Keyboard Interaction"
      description: |
        Test keyboard appearance in both orientations,
        especially in landscape.
      duration_estimate: "15 min"
      questions:
        - "Is focused input visible with keyboard in landscape?"
        - "Can user scroll to see content with keyboard open?"
        - "Does dismissing keyboard cause issues?"
      expected_findings:
        - "Keyboard handling"
        - "Viewport adjustment behavior"

# ============================================================
# OUTPUT SPECIFICATION
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Orientation Handling Patterns"
        - "Screen-by-Screen Assessment"
        - "State Preservation Testing"
        - "Recommendations"

  confidence_guidance:
    high: "Issues verified through device rotation testing"
    medium: "Issues identified through code review and emulator"
    low: "Potential issues based on code patterns"

# ============================================================
# OFFLINE SUPPORT
# ============================================================

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "mdn-orientation"
        priority: "recommended"

# ============================================================
# PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: false
      reason: "Requires device rotation testing"
    full:
      included: true
      priority: 3

# ============================================================
# CLOSEOUT CHECKLIST
# ============================================================

closeout_checklist:
  - id: "orient-001"
    item: "Layouts work in both orientations"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "All key screens tested in portrait and landscape"
    expected: "Confirmed by reviewer"

  - id: "orient-002"
    item: "State preserved on rotation"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Form data and app state survive rotation"
    expected: "Confirmed by reviewer"

  - id: "orient-003"
    item: "Keyboard doesn't hide content in landscape"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Focused input visible with landscape keyboard"
    expected: "Confirmed by reviewer"

# ============================================================
# GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["mobile-application", "responsive-web", "pwa"]

# ============================================================
# RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "usability-interaction.mobile-touch.responsive-behavior"
    - "usability-interaction.error-prevention.data-loss-prevention"
    - "usability-interaction.forms-input.form-layout"
