# ============================================================
# AUDIT: Draft Auto-Save Assessment
# ============================================================
# Evaluates auto-save and draft functionality for content
# creation and data entry features.
# ============================================================

audit:
  id: "usability-interaction.error-prevention.draft-auto-save"

  name: "Draft Auto-Save Assessment"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "usability-interaction"
  category_number: 14
  subcategory: "error-prevention"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

# ============================================================
# EXECUTION CLASSIFICATION
# ============================================================

execution:
  automatable: "partial"
  severity: "medium"
  scope: "codebase"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

# ============================================================
# DESCRIPTION & RATIONALE
# ============================================================

description:
  what: |
    This audit evaluates the implementation of auto-save and draft
    functionality for content creation features. It examines save
    frequency, user feedback, draft management, conflict resolution,
    and recovery mechanisms that protect user work.

  why_it_matters: |
    Auto-save is expected by users for any content creation feature.
    Gmail, Google Docs, and other modern applications have trained
    users to expect their work to be continuously saved. Missing or
    poor auto-save leads to data loss, user frustration, and negative
    perceptions of application quality.

  when_to_run:
    - "When implementing content creation features"
    - "When users report losing drafts"
    - "During content editor audits"
    - "When reviewing user satisfaction with editing features"

# ============================================================
# PREREQUISITES
# ============================================================

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Editor and content creation implementations"
    - type: "running_application"
      description: "Access to test auto-save behavior"

  access_requirements:
    - "Access to editor component source"
    - "Access to API/backend for save operations"
    - "Test account for draft testing"

# ============================================================
# DISCOVERY SPECIFICATION
# ============================================================

discovery:
  code_patterns:
    - pattern: "autosave|autoSave|auto-save"
      type: "keyword"
      scope: "source"
      purpose: "Find auto-save implementations"
    - pattern: "draft|Draft|saveDraft"
      type: "keyword"
      scope: "source"
      purpose: "Find draft functionality"
    - pattern: "debounce|throttle.*save"
      type: "regex"
      scope: "source"
      purpose: "Find save throttling patterns"
    - pattern: "lastSaved|savedAt|saveTime"
      type: "keyword"
      scope: "source"
      purpose: "Find save timestamp tracking"

  file_patterns:
    - glob: "**/*editor*"
      purpose: "Find editor components"
    - glob: "**/*compose*"
      purpose: "Find composition components"
    - glob: "**/*draft*"
      purpose: "Find draft-related files"

# ============================================================
# KNOWLEDGE SOURCES
# ============================================================

knowledge_sources:
  guides:
    - id: "google-autosave"
      name: "Google Docs - How Auto-Save Works"
      url: "https://support.google.com/docs/answer/6387857"
      offline_cache: true
    - id: "nngroup-autosave"
      name: "Nielsen Norman Group - Auto-Save UX"
      url: "https://www.nngroup.com/articles/auto-save/"
      offline_cache: true

# ============================================================
# TOOLING & AUTOMATION
# ============================================================

tooling:
  scripts:
    - id: "autosave-finder"
      language: "bash"
      purpose: "Find auto-save patterns"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Auto-Save Implementations ==="
        grep -rn "autosave\|autoSave\|auto-save" --include="*.jsx" --include="*.tsx" --include="*.ts" | head -15

        echo "=== Draft Management ==="
        grep -rn "draft\|Draft\|saveDraft" --include="*.jsx" --include="*.tsx" --include="*.ts" | head -15

        echo "=== Save Throttling ==="
        grep -rn "debounce.*save\|throttle.*save" --include="*.jsx" --include="*.tsx" | head -10

        echo "=== Save Status Indicators ==="
        grep -rn "lastSaved\|savedAt\|saving\|isSaving" --include="*.jsx" --include="*.tsx" | head -10

# ============================================================
# SIGNALS & FINDINGS TAXONOMY
# ============================================================

signals:
  critical:
    - id: "AUTOSAVE-CRIT-001"
      signal: "Content editor has no auto-save functionality"
      evidence_pattern: "Editor for significant content without auto-save"
      explanation: |
        Users expect auto-save for any content creation feature.
        Missing auto-save leads to data loss and user frustration.
      remediation: "Implement auto-save with 30-60 second intervals"
    - id: "AUTOSAVE-CRIT-002"
      signal: "Auto-save silently fails without user notification"
      evidence_pattern: "Save errors caught but not communicated to user"
      explanation: |
        Users believe their work is saved when auto-save runs.
        Silent failures lead to unexpected data loss.
      remediation: "Show clear error state when auto-save fails; prompt manual save"

  high:
    - id: "AUTOSAVE-HIGH-001"
      signal: "No save status indicator"
      evidence_pattern: "Auto-save runs without user feedback"
      explanation: |
        Users need confirmation that their work is being saved.
        Without feedback, they don't trust the system.
      remediation: "Show 'Saving...', 'Saved', and last saved timestamp"
    - id: "AUTOSAVE-HIGH-002"
      signal: "Auto-save interval too long"
      evidence_pattern: "Save interval >60 seconds or on exit only"
      explanation: |
        Long intervals increase potential data loss window.
        Users can lose significant work between saves.
      remediation: "Reduce interval to 30-60 seconds; consider save on significant changes"
    - id: "AUTOSAVE-HIGH-003"
      signal: "Drafts not recoverable after browser close"
      evidence_pattern: "No draft persistence across sessions"
      explanation: |
        Users may close browser accidentally or have crashes.
        Drafts should survive these events.
      remediation: "Persist drafts to backend or local storage for recovery"

  medium:
    - id: "AUTOSAVE-MED-001"
      signal: "No draft management interface"
      evidence_indicators:
        - "Cannot view list of drafts"
        - "Cannot delete old drafts"
        - "Cannot resume specific drafts"
      remediation: "Provide interface to view, resume, and manage drafts"
    - id: "AUTOSAVE-MED-002"
      signal: "Conflict handling missing for concurrent edits"
      evidence_pattern: "No detection or resolution for edit conflicts"
      remediation: "Detect and resolve conflicts when same content edited on multiple devices"
    - id: "AUTOSAVE-MED-003"
      signal: "Manual save still required for final submission"
      evidence_pattern: "Auto-save to draft but explicit publish/submit required"
      explanation: |
        This is often correct behavior, but should be clear to users
        that draft != published.
      remediation: "Clearly indicate draft vs published status"

  low:
    - id: "AUTOSAVE-LOW-001"
      signal: "Last saved timestamp format unclear"
      remediation: "Use relative time ('2 minutes ago') for recent, absolute for older"
    - id: "AUTOSAVE-LOW-002"
      signal: "Version history not available"
      remediation: "Consider implementing version history for important content"

  positive:
    - id: "AUTOSAVE-POS-001"
      signal: "Auto-save implemented with appropriate interval"
    - id: "AUTOSAVE-POS-002"
      signal: "Clear save status indicator visible"
    - id: "AUTOSAVE-POS-003"
      signal: "Draft recovery available across sessions"
    - id: "AUTOSAVE-POS-004"
      signal: "Version history accessible"

# ============================================================
# EXECUTION PROCEDURE
# ============================================================

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Content Creation Features"
      description: |
        Map all content creation features that should have
        auto-save functionality.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find editor components"
          command: "find src/ -name '*editor*' -o -name '*compose*' 2>/dev/null"
        - purpose: "Find auto-save code"
          command: "grep -rn 'autosave\\|autoSave' --include='*.jsx' --include='*.tsx' src/"
      expected_findings:
        - "Content creation feature inventory"
        - "Auto-save coverage"

    - id: "2"
      name: "Evaluate Auto-Save Implementation"
      description: |
        Review auto-save implementation details including interval,
        triggers, and error handling.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find save intervals"
          command: "grep -rn 'setInterval\\|setTimeout' --include='*.jsx' --include='*.tsx' src/ | grep -i save"
        - purpose: "Find debounce patterns"
          command: "grep -rn 'debounce\\|throttle' --include='*.jsx' --include='*.tsx' src/"
      questions:
        - "What triggers auto-save (time, changes, both)?"
        - "What is the save interval?"
        - "How are save errors handled?"
      expected_findings:
        - "Auto-save mechanics"
        - "Error handling approach"

    - id: "3"
      name: "Test Save Status Feedback"
      description: |
        Test how save status is communicated to users during
        editing sessions.
      duration_estimate: "25 min"
      questions:
        - "Is there a visible saving indicator?"
        - "Is 'saved' state clearly shown?"
        - "Is last saved time visible?"
        - "Are save errors clearly indicated?"
      expected_findings:
        - "Feedback quality"
        - "User awareness"

    - id: "4"
      name: "Test Draft Recovery"
      description: |
        Test draft persistence and recovery across browser
        events and sessions.
      duration_estimate: "30 min"
      questions:
        - "Are drafts recovered after browser refresh?"
        - "Are drafts recovered after browser close/reopen?"
        - "Can users access drafts from other devices?"
        - "How are draft conflicts handled?"
      expected_findings:
        - "Recovery capabilities"
        - "Cross-session persistence"

# ============================================================
# OUTPUT SPECIFICATION
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Content Creation Feature Inventory"
        - "Auto-Save Implementation Review"
        - "User Feedback Assessment"
        - "Draft Recovery Testing"
        - "Recommendations"

  confidence_guidance:
    high: "Issues verified through code review and functional testing"
    medium: "Issues identified through code review or testing alone"
    low: "Potential issues requiring additional scenario testing"

# ============================================================
# OFFLINE SUPPORT
# ============================================================

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "nngroup-autosave"
        priority: "recommended"

# ============================================================
# PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed functional testing"
    full:
      included: true
      priority: 2

# ============================================================
# CLOSEOUT CHECKLIST
# ============================================================

closeout_checklist:
  - id: "autosave-001"
    item: "Content editors have auto-save"
    level: "CRITICAL"
    verification: "grep -rn 'autosave\\|autoSave' --include='*.jsx' --include='*.tsx' --include='*.ts' src/ | wc -l"
    expected: ">0 auto-save implementations found"

  - id: "autosave-002"
    item: "Save status indicator present"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify 'Saving' and 'Saved' states visible during editing"
    expected: "Confirmed by reviewer"

  - id: "autosave-003"
    item: "Drafts persist across sessions"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Close browser during editing, reopen, draft recoverable"
    expected: "Confirmed by reviewer"

# ============================================================
# GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["web-application", "mobile-application", "saas", "cms"]

# ============================================================
# RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "usability-interaction.error-prevention.data-loss-prevention"
    - "usability-interaction.forms-input.multi-step-form-flow"
    - "usability-interaction.error-prevention.recovery-path"
