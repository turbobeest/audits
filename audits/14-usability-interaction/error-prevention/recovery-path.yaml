# ============================================================
# AUDIT: Recovery Path Assessment
# ============================================================
# Evaluates the availability and clarity of recovery paths when
# users encounter errors or get stuck in the application.
# ============================================================

audit:
  id: "usability-interaction.error-prevention.recovery-path"

  name: "Recovery Path Assessment"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "usability-interaction"
  category_number: 14
  subcategory: "error-prevention"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

# ============================================================
# EXECUTION CLASSIFICATION
# ============================================================

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

# ============================================================
# DESCRIPTION & RATIONALE
# ============================================================

description:
  what: |
    This audit evaluates the recovery paths available to users when they
    encounter errors, dead ends, or get stuck in the application. It
    examines error recovery flows, exit points, retry mechanisms, help
    access, and the ability to return to a known good state.

  why_it_matters: |
    Nielsen's Error Recovery heuristic emphasizes that users should be
    able to recognize, diagnose, and recover from errors. When users
    get stuck without clear recovery paths, they abandon tasks, contact
    support, or leave the application entirely. Good recovery paths
    reduce frustration and maintain user productivity.

  when_to_run:
    - "During error handling audits"
    - "When user abandonment is high at error points"
    - "When support tickets involve users being stuck"
    - "During usability testing reviews"

# ============================================================
# PREREQUISITES
# ============================================================

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Error handling and recovery implementations"
    - type: "running_application"
      description: "Access to trigger and recover from errors"

  access_requirements:
    - "Access to error handling code"
    - "Ability to simulate error conditions"
    - "Access to application flows"

# ============================================================
# DISCOVERY SPECIFICATION
# ============================================================

discovery:
  code_patterns:
    - pattern: "retry|Retry|again|Again"
      type: "keyword"
      scope: "source"
      purpose: "Find retry mechanisms"
    - pattern: "back|Back|return|Return|cancel|Cancel"
      type: "keyword"
      scope: "source"
      purpose: "Find navigation recovery options"
    - pattern: "reset|Reset|clear|Clear|start over"
      type: "keyword"
      scope: "source"
      purpose: "Find reset mechanisms"
    - pattern: "help|Help|support|Support|contact"
      type: "keyword"
      scope: "source"
      purpose: "Find help/support access"

  file_patterns:
    - glob: "**/error*"
      purpose: "Find error handling components"
    - glob: "**/fallback*"
      purpose: "Find fallback components"
    - glob: "**/404*"
      purpose: "Find not found pages"

# ============================================================
# KNOWLEDGE SOURCES
# ============================================================

knowledge_sources:
  specifications:
    - id: "nielsen-recovery"
      name: "Nielsen Norman Group - Error Recovery Heuristic"
      url: "https://www.nngroup.com/articles/ten-usability-heuristics/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "nngroup-errors"
      name: "Nielsen Norman Group - Helping Users Recover from Errors"
      url: "https://www.nngroup.com/articles/error-message-guidelines/"
      offline_cache: true

# ============================================================
# TOOLING & AUTOMATION
# ============================================================

tooling:
  scripts:
    - id: "recovery-path-finder"
      language: "bash"
      purpose: "Find recovery path patterns"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Retry Mechanisms ==="
        grep -rn "retry\|Retry\|try again" --include="*.jsx" --include="*.tsx" | head -15

        echo "=== Back/Return Options ==="
        grep -rn "go back\|Go Back\|return to\|Return to" --include="*.jsx" --include="*.tsx" | head -10

        echo "=== Error Boundaries ==="
        grep -rn "ErrorBoundary\|error-boundary" --include="*.jsx" --include="*.tsx" | head -10

        echo "=== Help/Support Links ==="
        grep -rn "help\|Help\|support\|Support\|contact" --include="*.jsx" --include="*.tsx" | \
          grep -i "link\|href\|button" | head -10

# ============================================================
# SIGNALS & FINDINGS TAXONOMY
# ============================================================

signals:
  critical:
    - id: "RECOVERY-CRIT-001"
      signal: "Error state provides no way forward"
      evidence_indicators:
        - "Error message with no buttons or links"
        - "Dead-end error page without navigation"
        - "User must manually navigate away or refresh"
      explanation: |
        Users stuck on error screens without exit options are
        completely blocked from continuing their task.
      remediation: "Always provide at least retry, go back, or go home options"
    - id: "RECOVERY-CRIT-002"
      signal: "Application crash with no error boundary"
      evidence_pattern: "JavaScript errors causing blank screen"
      explanation: |
        Unhandled errors that crash the UI leave users with no
        context or recovery option.
      remediation: "Implement error boundaries with meaningful fallback UI"

  high:
    - id: "RECOVERY-HIGH-001"
      signal: "No retry option for transient failures"
      evidence_pattern: "Network errors without retry button"
      explanation: |
        Many errors are transient (network blips, timeouts) and would
        succeed on retry. Missing retry forces users to start over.
      remediation: "Add retry button for operations that may succeed on retry"
    - id: "RECOVERY-HIGH-002"
      signal: "Cannot return to previous step in multi-step flow"
      evidence_pattern: "Error in wizard without back navigation"
      explanation: |
        Users who encounter errors mid-flow need to return to
        previous steps to correct issues.
      remediation: "Preserve navigation ability even in error states"
    - id: "RECOVERY-HIGH-003"
      signal: "No help or support access from error states"
      evidence_pattern: "Error pages without help links or support contact"
      explanation: |
        When users cannot resolve errors themselves, they need
        a path to get help.
      remediation: "Include help link or support contact on all error screens"

  medium:
    - id: "RECOVERY-MED-001"
      signal: "Reset/start over option missing for complex forms"
      evidence_pattern: "Long forms without clear way to reset"
      remediation: "Provide clear reset option for forms where starting over makes sense"
    - id: "RECOVERY-MED-002"
      signal: "Browser back button breaks application state"
      evidence_pattern: "Back button causes errors or lost state"
      remediation: "Ensure browser navigation works correctly throughout"
    - id: "RECOVERY-MED-003"
      signal: "Automatic retry without user control"
      evidence_pattern: "Infinite retry loops or uncontrolled retries"
      remediation: "Give users control over retry behavior; limit automatic retries"

  low:
    - id: "RECOVERY-LOW-001"
      signal: "Recovery options not visually prominent"
      remediation: "Make recovery action buttons clearly visible"
    - id: "RECOVERY-LOW-002"
      signal: "No contextual help for specific error types"
      remediation: "Add targeted help content for common error scenarios"

  positive:
    - id: "RECOVERY-POS-001"
      signal: "All error states provide recovery options"
    - id: "RECOVERY-POS-002"
      signal: "Retry available for transient errors"
    - id: "RECOVERY-POS-003"
      signal: "Error boundaries prevent complete crashes"
    - id: "RECOVERY-POS-004"
      signal: "Help access available from all error states"

# ============================================================
# EXECUTION PROCEDURE
# ============================================================

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Map Error States"
      description: |
        Identify all error states in the application and how
        they are presented to users.
      duration_estimate: "25 min"
      commands:
        - purpose: "Find error boundaries"
          command: "grep -rn 'ErrorBoundary\\|error-boundary' --include='*.jsx' --include='*.tsx' src/"
        - purpose: "Find error pages"
          command: "find src/ -name '*error*' -o -name '*404*' -o -name '*500*' 2>/dev/null"
      expected_findings:
        - "Error state inventory"
        - "Error boundary coverage"

    - id: "2"
      name: "Audit Recovery Options"
      description: |
        For each error state, document what recovery options
        are available to users.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find retry patterns"
          command: "grep -rn 'retry\\|Retry\\|try again' --include='*.jsx' --include='*.tsx' src/"
        - purpose: "Find back/return patterns"
          command: "grep -rn 'go back\\|Go Back\\|return to' --include='*.jsx' --include='*.tsx' src/"
      expected_findings:
        - "Recovery options per error state"
        - "Missing recovery paths"

    - id: "3"
      name: "Test Error Recovery Flows"
      description: |
        Trigger various error conditions and attempt to recover
        to verify paths work correctly.
      duration_estimate: "35 min"
      questions:
        - "Can users retry failed operations?"
        - "Can users navigate back from errors?"
        - "Can users access help when stuck?"
        - "Does browser back button work correctly?"
      expected_findings:
        - "Recovery flow functionality"
        - "Broken recovery paths"

    - id: "4"
      name: "Evaluate Help Access"
      description: |
        Review availability of help and support access from
        error states.
      duration_estimate: "20 min"
      questions:
        - "Is help available from all error screens?"
        - "Is support contact information provided?"
        - "Are there contextual help options for specific errors?"
      expected_findings:
        - "Help/support coverage"
        - "Access gaps"

# ============================================================
# OUTPUT SPECIFICATION
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Error State Inventory"
        - "Recovery Option Assessment"
        - "Flow Testing Results"
        - "Help Access Review"
        - "Recommendations"

  confidence_guidance:
    high: "Issues verified through code review and functional testing"
    medium: "Issues identified through code review or testing alone"
    low: "Potential issues requiring additional scenario testing"

# ============================================================
# OFFLINE SUPPORT
# ============================================================

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "nielsen-recovery"
        priority: "required"

# ============================================================
# PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive error scenario testing"
    full:
      included: true
      priority: 1

# ============================================================
# CLOSEOUT CHECKLIST
# ============================================================

closeout_checklist:
  - id: "recovery-001"
    item: "All error states provide recovery options"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Every error state has at least one recovery action"
    expected: "Confirmed by reviewer"

  - id: "recovery-002"
    item: "Error boundaries implemented"
    level: "CRITICAL"
    verification: "grep -rn 'ErrorBoundary' --include='*.jsx' --include='*.tsx' src/ | wc -l"
    expected: ">0 error boundaries found"

  - id: "recovery-003"
    item: "Help access from error states"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Help or support accessible from all error screens"
    expected: "Confirmed by reviewer"

# ============================================================
# GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["web-application", "mobile-application", "saas"]

# ============================================================
# RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "usability-interaction.error-prevention.error-message-clarity"
    - "usability-interaction.error-prevention.destructive-action-safeguard"
    - "usability-interaction.error-prevention.data-loss-prevention"
