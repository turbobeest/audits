# ============================================================
# AUDIT: Form Layout Assessment
# ============================================================
# Evaluates form structure, alignment, and visual organization
# for optimal user comprehension and completion rates.
# ============================================================

audit:
  id: "usability-interaction.forms-input.form-layout"

  name: "Form Layout Assessment"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "usability-interaction"
  category_number: 14
  subcategory: "forms-input"

  tier: "expert"
  estimated_duration: "2-4 hours"  # median: 3h

  completeness: "complete"
  requires_runtime: true
  destructive: false

# ============================================================
# EXECUTION CLASSIFICATION
# ============================================================

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

# ============================================================
# DESCRIPTION & RATIONALE
# ============================================================

description:
  what: |
    This audit examines form layouts across the application to ensure they
    follow established UX best practices for structure, alignment, and visual
    organization. It evaluates single-column vs multi-column layouts, field
    grouping, label placement, whitespace usage, and logical flow to optimize
    user comprehension and form completion rates.

  why_it_matters: |
    Form layout directly impacts completion rates, user satisfaction, and
    error frequency. Research shows that single-column layouts can increase
    completion rates by 15-30% compared to multi-column layouts. Poor form
    layout increases cognitive load, causes user confusion, and leads to
    form abandonment - directly affecting conversion rates and user retention.

  when_to_run:
    - "During design reviews of new forms"
    - "When form completion rates are below expected thresholds"
    - "After receiving user feedback about form confusion"
    - "During accessibility audits"

# ============================================================
# PREREQUISITES
# ============================================================

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Form component source code (HTML, JSX, Vue, etc.)"
    - type: "design_system"
      description: "Design system or style guide documentation"

  access_requirements:
    - "Access to form component source files"
    - "Access to running application for visual inspection"
    - "Access to form analytics data if available"

# ============================================================
# DISCOVERY SPECIFICATION
# ============================================================

discovery:
  code_patterns:
    - pattern: "<form|<Form"
      type: "regex"
      scope: "source"
      purpose: "Identify form elements in templates"
    - pattern: "display:\\s*(flex|grid|inline)"
      type: "regex"
      scope: "source"
      purpose: "Find layout CSS affecting forms"
    - pattern: "flex-direction|grid-template"
      type: "regex"
      scope: "source"
      purpose: "Identify column/row layout patterns"
    - pattern: "formik|react-hook-form|useForm"
      type: "regex"
      scope: "source"
      purpose: "Identify form library usage patterns"

  file_patterns:
    - glob: "**/*form*"
      purpose: "Find form-related components"
    - glob: "**/components/**/*input*"
      purpose: "Find input field components"
    - glob: "**/*.css"
      purpose: "Find form-related styles"

# ============================================================
# KNOWLEDGE SOURCES
# ============================================================

knowledge_sources:
  specifications:
    - id: "wcag-forms"
      name: "WCAG 2.2 - Forms"
      url: "https://www.w3.org/WAI/WCAG22/Understanding/labels-or-instructions"
      offline_cache: true
      priority: "required"

  guides:
    - id: "nielsen-forms"
      name: "Nielsen Norman Group - Form Design"
      url: "https://www.nngroup.com/articles/web-form-design/"
      offline_cache: true
    - id: "baymard-forms"
      name: "Baymard Institute - Form Usability"
      url: "https://baymard.com/blog/form-field-usability"
      offline_cache: true

  papers:
    - id: "cuf-study"
      title: "An Eyetracking Study of Web Form Layout"
      url: "https://www.uxmatters.com/mt/archives/2006/07/label-placement-in-forms.php"

# ============================================================
# TOOLING & AUTOMATION
# ============================================================

tooling:
  static_analysis:
    - tool: "axe-core"
      purpose: "Detect form accessibility issues"
      offline_capable: true
    - tool: "eslint-plugin-jsx-a11y"
      purpose: "Lint JSX for accessibility patterns"
      offline_capable: true

  scripts:
    - id: "form-layout-analyzer"
      language: "bash"
      purpose: "Identify multi-column form layouts"
      source: "inline"
      code: |
        #!/bin/bash
        # Find potential multi-column form layouts
        grep -rn "display:\s*flex" --include="*.css" --include="*.scss" | \
          grep -i form
        grep -rn "grid-template-columns" --include="*.css" --include="*.scss" | \
          grep -i form

# ============================================================
# SIGNALS & FINDINGS TAXONOMY
# ============================================================

signals:
  critical:
    - id: "FORMLAYOUT-CRIT-001"
      signal: "Form lacks any visible structure or grouping"
      evidence_pattern: "Forms with no fieldset, section, or visual grouping elements"
      explanation: |
        Forms without structure force users to process all fields as a
        undifferentiated list, dramatically increasing cognitive load and
        error rates. This is especially problematic for longer forms.
      remediation: "Group related fields using fieldset elements with legends or visual sections"

  high:
    - id: "FORMLAYOUT-HIGH-001"
      signal: "Multi-column layout used for sequential form fields"
      evidence_pattern: "grid-template-columns|flex-direction:\\s*row"
      explanation: |
        Research consistently shows single-column layouts improve form
        completion rates. Multi-column layouts create unclear reading paths
        and increase the chance of users missing fields.
      remediation: "Convert to single-column layout, reserving multi-column only for related short fields like city/state/zip"
    - id: "FORMLAYOUT-HIGH-002"
      signal: "Inconsistent label placement across form"
      evidence_pattern: "Mixed top-aligned, left-aligned, and placeholder-only labels"
      explanation: |
        Inconsistent label placement forces users to constantly reorient,
        slowing completion and increasing errors.
      remediation: "Standardize on top-aligned labels for most forms; left-aligned only for data-dense forms"

  medium:
    - id: "FORMLAYOUT-MED-001"
      signal: "Insufficient spacing between form sections"
      evidence_pattern: "margin-bottom < 16px between fieldsets or sections"
      remediation: "Use consistent, generous spacing (24-32px) between logical form sections"
    - id: "FORMLAYOUT-MED-002"
      signal: "Submit button not clearly distinguished from form fields"
      evidence_pattern: "Submit button styled similarly to input fields"
      remediation: "Make primary action button visually prominent with contrasting color and clear positioning"

  low:
    - id: "FORMLAYOUT-LOW-001"
      signal: "Optional fields not distinguished from required fields"
      remediation: "Mark optional fields explicitly rather than marking required fields"

  positive:
    - id: "FORMLAYOUT-POS-001"
      signal: "Single-column layout with logical field grouping"
    - id: "FORMLAYOUT-POS-002"
      signal: "Consistent top-aligned labels throughout form"
    - id: "FORMLAYOUT-POS-003"
      signal: "Clear visual hierarchy with primary and secondary actions"

# ============================================================
# EXECUTION PROCEDURE
# ============================================================

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Forms"
      description: |
        Identify all forms in the application by searching for form
        elements, form libraries, and related components.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find form components"
          command: "grep -rn '<form\\|<Form\\|useForm\\|Formik' src/"
        - purpose: "Find form-related CSS"
          command: "grep -rn 'form' --include='*.css' --include='*.scss' src/"
      expected_findings:
        - "List of all form components and their locations"
        - "Form styling patterns in use"

    - id: "2"
      name: "Analyze Layout Structure"
      description: |
        For each form, examine the layout structure including column
        arrangement, field grouping, and visual hierarchy.
      duration_estimate: "45 min"
      questions:
        - "Is the form using single or multi-column layout?"
        - "Are related fields visually grouped?"
        - "Is there a clear logical flow from top to bottom?"
      expected_findings:
        - "Layout pattern for each form"
        - "Grouping mechanisms in use"

    - id: "3"
      name: "Evaluate Label Placement"
      description: |
        Check label placement consistency and effectiveness across
        all forms in the application.
      duration_estimate: "30 min"
      questions:
        - "Are labels consistently positioned (top, left, or inline)?"
        - "Are any fields using placeholder-only labels?"
        - "Is there adequate space between labels and inputs?"
      expected_findings:
        - "Label placement patterns"
        - "Any placeholder-as-label anti-patterns"

    - id: "4"
      name: "Review Spacing and Visual Weight"
      description: |
        Analyze whitespace usage, visual grouping, and the visual
        hierarchy of form elements.
      duration_estimate: "25 min"
      questions:
        - "Is there consistent spacing between fields?"
        - "Are form sections clearly delineated?"
        - "Is the submit button visually prominent?"
      expected_findings:
        - "Spacing consistency findings"
        - "Visual hierarchy assessment"

# ============================================================
# OUTPUT SPECIFICATION
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Form Inventory"
        - "Layout Analysis"
        - "Key Findings"
        - "Recommendations"

  confidence_guidance:
    high: "Layout issues verified through both code review and visual inspection"
    medium: "Issues identified in code but not visually verified"
    low: "Potential issues based on pattern matching only"

# ============================================================
# OFFLINE SUPPORT
# ============================================================

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "wcag-forms"
        priority: "required"
      - source_id: "nielsen-forms"
        priority: "recommended"

# ============================================================
# PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: true
      priority: 2
    full:
      included: true
      priority: 1

# ============================================================
# CLOSEOUT CHECKLIST
# ============================================================

closeout_checklist:
  - id: "form-layout-001"
    item: "All forms inventoried and catalogued"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Reviewer confirms form inventory is complete"
    expected: "Confirmed by reviewer"

  - id: "form-layout-002"
    item: "Single-column layout verified for primary forms"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Visual inspection confirms single-column layout"
    expected: "Confirmed by reviewer"

  - id: "form-layout-003"
    item: "Label placement consistency verified"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Labels use consistent placement pattern"
    expected: "Confirmed by reviewer"

# ============================================================
# GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["web-application", "mobile-application", "saas"]

  compliance_frameworks:
    - framework: "WCAG"
      controls: ["1.3.1", "3.3.2"]

# ============================================================
# RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "usability-interaction.forms-input.field-label-clarity"
    - "usability-interaction.forms-input.validation-message"
    - "usability-interaction.cognitive-load.visual-hierarchy"
