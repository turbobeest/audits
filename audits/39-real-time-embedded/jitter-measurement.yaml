# ============================================================
# AUDIT: Jitter Measurement
# Category: 39 - Real-Time & Embedded Systems
# Subcategory: timing-analysis
# ============================================================

audit:
  id: "real-time-embedded.timing-analysis.jitter-measurement"
  name: "Jitter Measurement Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "real-time-embedded"
  category_number: 39
  subcategory: "timing-analysis"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "embedded-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Measures and analyzes timing jitter in real-time embedded systems including
    task activation jitter, output jitter, and interrupt latency variation.
    Examines sources of jitter such as scheduler overhead, interrupt handling,
    cache effects, and bus contention. Validates that jitter remains within
    acceptable bounds for control loop stability and signal processing accuracy.

  why_it_matters: |
    Excessive jitter degrades control system performance, causes signal
    aliasing in sampling systems, and leads to communication protocol failures.
    In motion control, jitter causes jerky movement and reduced precision.
    In audio/video systems, jitter causes artifacts and synchronization loss.
    Safety-critical systems require bounded jitter for deterministic behavior.

  when_to_run:
    - "During control system tuning"
    - "After scheduler changes"
    - "When integrating new peripherals"
    - "Before production release"
    - "After firmware updates"

prerequisites:
  required_artifacts:
    - type: "timing_requirements"
      description: "Jitter budget specifications for each task"
    - type: "system_architecture"
      description: "Task and interrupt architecture documentation"
    - type: "hardware_specs"
      description: "Timer and clock specifications"
    - type: "measurement_setup"
      description: "Test instrumentation configuration"

  access_requirements:
    - "Access to hardware debug interface"
    - "Logic analyzer or oscilloscope"
    - "Software instrumentation points"
    - "Long-term logging capability"

discovery:
  file_patterns:
    - glob: "**/timer*.c"
      purpose: "Find timer configuration"
    - glob: "**/control_loop*.c"
      purpose: "Find control loop implementations"
    - glob: "**/periodic_*.c"
      purpose: "Find periodic task implementations"
    - glob: "**/isr*.c"
      purpose: "Find interrupt service routines"
    - glob: "**/sampling*.c"
      purpose: "Find signal sampling code"

knowledge_sources:
  guides:
    - id: "jitter-analysis"
      name: "Real-Time Systems Jitter Analysis"
      url: "https://www.embedded.com/understanding-jitter"
    - id: "control-timing"
      name: "Timing Requirements for Control Systems"
      url: "https://www.mathworks.com/help/slrealtime/timing-requirements.html"

  standards:
    - id: "ieee-1588"
      name: "IEEE 1588 Precision Time Protocol"
      relevance: "Time synchronization jitter"
    - id: "ethercat"
      name: "EtherCAT Specification"
      relevance: "Industrial timing requirements"

tooling:
  analysis_tools:
    - tool: "oscilloscope"
      purpose: "Hardware timing measurement"
    - tool: "logic-analyzer"
      purpose: "Signal timing analysis"
    - tool: "tracealyzer"
      purpose: "RTOS timing visualization"
    - tool: "lttng"
      purpose: "Linux trace toolkit"

signals:
  critical:
    - id: "JIT-CRIT-001"
      signal: "Jitter exceeds control loop stability margin"
      evidence_indicators:
        - "Jitter greater than 10% of control period"
        - "Control instability observed"
        - "System oscillation detected"
      explanation: |
        Excessive jitter in control loops causes timing uncertainty that
        degrades controller performance and can lead to instability. The
        control algorithm design assumes bounded timing variation.
      remediation: "Reduce jitter through priority adjustment or dedicated timer"

    - id: "JIT-CRIT-002"
      signal: "Sampling jitter causes aliasing"
      evidence_indicators:
        - "Non-uniform sampling intervals"
        - "Jitter exceeds Nyquist margin"
        - "Signal distortion observed"
      explanation: |
        Sampling jitter in signal acquisition causes effective aliasing
        even when nominal sample rate satisfies Nyquist. This corrupts
        measurements and analysis results.
      remediation: "Use hardware timing for sampling or implement anti-jitter buffer"

  high:
    - id: "JIT-HIGH-001"
      signal: "Communication protocol timing violations"
      evidence_indicators:
        - "CAN frame timing out of spec"
        - "Protocol timeout events"
        - "Retransmission increase"
      explanation: |
        Industrial protocols have strict timing requirements. Jitter can
        cause protocol violations, dropped messages, and system failures.
      remediation: "Prioritize communication handling and reduce interference"

    - id: "JIT-HIGH-002"
      signal: "Interrupt latency jitter affects real-time performance"
      evidence_indicators:
        - "ISR entry time variation excessive"
        - "Missed hardware events"
        - "Inconsistent response times"
      explanation: |
        Variable interrupt latency causes unpredictable event response,
        potentially missing hardware deadlines or overrunning buffers.
      remediation: "Minimize critical sections, optimize interrupt priorities"

  medium:
    - id: "JIT-MED-001"
      signal: "Task activation jitter above threshold"
      evidence_indicators:
        - "Period variation greater than 1%"
        - "Scheduler overhead variation"
        - "Preemption timing inconsistent"
      explanation: |
        Activation jitter delays task start times, affecting overall
        timing predictability and resource utilization.
      remediation: "Adjust tick rate or use sporadic server"

    - id: "JIT-MED-002"
      signal: "Cache effects causing timing variation"
      evidence_indicators:
        - "Execution time bi-modal distribution"
        - "Cache miss patterns variable"
        - "Memory access jitter"
      explanation: |
        Cache behavior causes significant execution time variation.
        Cold cache paths take much longer than warm cache paths.
      remediation: "Lock critical code in cache or partition cache"

  low:
    - id: "JIT-LOW-001"
      signal: "Jitter measurement infrastructure incomplete"
      evidence_indicators:
        - "No systematic jitter logging"
        - "Statistical analysis missing"
        - "Long-term trends not tracked"
      explanation: |
        Without proper measurement infrastructure, jitter problems may
        go undetected until they cause field failures.
      remediation: "Implement comprehensive jitter monitoring"

  positive:
    - id: "JIT-POS-001"
      signal: "Jitter well within all requirements"
      evidence_indicators:
        - "Jitter under 1% of period"
        - "Consistent timing distribution"
        - "No outliers detected"

    - id: "JIT-POS-002"
      signal: "Comprehensive jitter analysis documented"
      evidence_indicators:
        - "Statistical characterization complete"
        - "Sources identified and mitigated"
        - "Long-term stability verified"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Define Jitter Requirements"
      description: "Establish acceptable jitter bounds for each timing-critical function"
      duration_estimate: "30 minutes"

    - id: "2"
      name: "Configure Measurement Infrastructure"
      description: "Set up hardware and software timing measurement points"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Collect Timing Data"
      description: "Gather timing samples under various operating conditions"
      duration_estimate: "1-2 hours"

    - id: "4"
      name: "Analyze Jitter Statistics"
      description: "Calculate mean, variance, max, and distribution of jitter"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Identify Jitter Sources"
      description: "Correlate jitter with system events and activities"
      duration_estimate: "1 hour"

    - id: "6"
      name: "Document Results and Recommendations"
      description: "Compile findings with mitigation strategies"
      duration_estimate: "30 minutes"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Measurement Methodology"
        - "Jitter Statistics by Task"
        - "Source Analysis"
        - "Recommendations"

closeout_checklist:
  - id: "jit-001"
    item: "Jitter requirements defined"
    level: "HIGH"
    verification: "manual"
  - id: "jit-002"
    item: "Measurement data collected"
    level: "CRITICAL"
    verification: "automated"
  - id: "jit-003"
    item: "Statistical analysis completed"
    level: "HIGH"
    verification: "automated"
  - id: "jit-004"
    item: "Jitter sources identified"
    level: "MEDIUM"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["embedded-systems", "control-systems", "automotive", "industrial"]

  compliance_mappings:
    - framework: "IEC 61131"
      control: "Task timing"
      description: "PLC timing requirements"
    - framework: "EtherCAT"
      control: "DC Synchronization"
      description: "Distributed clock jitter"
    - framework: "IEEE 1588"
      control: "PTP Jitter"
      description: "Time synchronization accuracy"

relationships:
  commonly_combined:
    - "real-time-embedded.timing-analysis.wcet-analysis"
    - "real-time-embedded.interrupt-handling.isr-latency-analysis"
  depends_on:
    - "real-time-embedded.rtos-configuration.scheduler-configuration"
  feeds_into:
    - "control-systems.stability-analysis"
    - "reliability.timing-reliability"

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
