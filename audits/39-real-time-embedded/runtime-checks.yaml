audit:
  id: real-time-embedded.firmware-quality.runtime-checks
  name: Runtime Checks Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: firmware-quality
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates runtime checking mechanisms including array bounds checking,
    arithmetic overflow detection, pointer validation, and runtime type
    information. Reviews compiler-provided checks, custom validation code,
    and error detection instrumentation.
  why_it_matters: |
    Runtime checks detect errors that static analysis misses - actual out-of-
    bounds accesses, arithmetic overflows with specific data, and invalid
    pointers. While checks add overhead, selective use in critical code
    catches errors before they cause failures. Safety-critical systems often
    require runtime checks for key computations.
  when_to_run:
  - During safety analysis
  - When implementing critical code
  - Before production release
  - After reliability issues
  - For safety certification
prerequisites:
  required_artifacts:
  - type: source_code
    description: Embedded firmware source code
  - type: compiler_configuration
    description: Compiler settings and flags
  - type: runtime_library
    description: Runtime support library
  - type: safety_requirements
    description: Runtime checking requirements
  access_requirements:
  - Access to source code
  - Access to compiler documentation
  - Access to build system
  - Test environment
discovery:
  file_patterns:
  - glob: '**/runtime_check*.c'
    purpose: Find runtime check implementations
  - glob: '**/bounds_check*.c'
    purpose: Find bounds checking code
  - glob: '**/overflow*.c'
    purpose: Find overflow detection
  - glob: '**/Makefile'
    purpose: Find compiler flags
  - glob: '**/CMakeLists.txt'
    purpose: Find build configuration
knowledge_sources:
  guides:
  - id: runtime-checks
    name: Runtime Error Detection
    url: https://www.embedded.com/runtime-checks
  - id: sanitizers
    name: Compiler Sanitizers Guide
    url: https://clang.llvm.org/docs/AddressSanitizer.html
  standards:
  - id: do-178c
    name: DO-178C Software Considerations
    relevance: Runtime verification
  - id: iec-61508
    name: IEC 61508 Functional Safety
    relevance: Runtime checks recommendation
tooling:
  analysis_tools:
  - tool: gcc-sanitizers
    purpose: Address and undefined behavior sanitizers
  - tool: polyspace
    purpose: Runtime error proving
  - tool: valgrind
    purpose: Memory error detection
signals:
  critical:
  - id: RTC-CRIT-001
    signal: No overflow checking in safety computations
    evidence_indicators:
    - Integer overflow possible
    - Safety calculation unprotected
    - No overflow detection
    explanation: |
      Arithmetic overflow in safety computations can cause incorrect
      results leading to unsafe system behavior.
    remediation: Add overflow checking for safety-critical calculations
  - id: RTC-CRIT-002
    signal: Array bounds violations in critical paths
    evidence_indicators:
    - Out-of-bounds access possible
    - No bounds checking
    - Buffer overflows likely
    explanation: |
      Buffer overflows corrupt memory and can cause crashes or
      security vulnerabilities. Critical paths need protection.
    remediation: Add bounds checking for critical array accesses
  high:
  - id: RTC-HIGH-001
    signal: Runtime checks disabled in production
    evidence_indicators:
    - All checks compiled out
    - NDEBUG in release build
    - No validation in production
    explanation: |
      Some runtime checks should remain in production for critical
      code paths to catch errors in the field.
    remediation: Enable selective checks in production for critical code
  - id: RTC-HIGH-002
    signal: Pointer validity not verified
    evidence_indicators:
    - Pointers used without null check
    - Dangling pointer possible
    - Invalid dereference likely
    explanation: |
      Invalid pointer dereferences cause crashes. Critical code
      should validate pointer validity.
    remediation: Add pointer validation in critical paths
  medium:
  - id: RTC-MED-001
    signal: Runtime check overhead excessive
    evidence_indicators:
    - Checks in tight loops
    - Performance significantly degraded
    - Timing requirements impacted
    explanation: |
      Excessive runtime checks can impact real-time performance.
      Balance safety with timing requirements.
    remediation: Optimize check placement for critical paths
  - id: RTC-MED-002
    signal: Check failures not properly handled
    evidence_indicators:
    - Check fails but continues
    - Error not logged
    - System state unknown after failure
    explanation: |
      When runtime checks fail, proper error handling is essential
      to maintain system safety and enable debugging.
    remediation: Implement proper error handling for check failures
  low:
  - id: RTC-LOW-001
    signal: Runtime checking strategy not documented
    evidence_indicators:
    - No checking guidelines
    - Check placement ad-hoc
    - Rationale not recorded
    explanation: |
      Documentation ensures consistent application and supports
      certification evidence.
    remediation: Document runtime checking strategy
  positive:
  - id: RTC-POS-001
    signal: Comprehensive runtime checking for critical code
    evidence_indicators:
    - Safety code protected
    - Overflow detection enabled
    - Bounds checking active
  - id: RTC-POS-002
    signal: Efficient runtime check implementation
    evidence_indicators:
    - Checks optimized for overhead
    - Selective checking strategy
    - Timing requirements met
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Compiler Check Configuration
    description: Examine compiler flags for runtime checking
    duration_estimate: 30 minutes
  - id: '2'
    name: Analyze Safety-Critical Paths
    description: Identify checks in safety-critical code
    duration_estimate: 1-2 hours
  - id: '3'
    name: Assess Overflow Detection
    description: Review arithmetic overflow handling
    duration_estimate: 1 hour
  - id: '4'
    name: Check Bounds Validation
    description: Evaluate array bounds checking coverage
    duration_estimate: 1 hour
  - id: '5'
    name: Evaluate Check Error Handling
    description: Review what happens when checks fail
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile assessment report
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Compiler Configuration Review
    - Safety Path Analysis
    - Check Coverage Assessment
    - Recommendations
closeout_checklist:
- id: rtc-001
  item: Compiler configuration reviewed
  level: HIGH
  verification: manual
- id: rtc-002
  item: Safety paths analyzed
  level: CRITICAL
  verification: manual
- id: rtc-003
  item: Overflow detection assessed
  level: HIGH
  verification: automated
- id: rtc-004
  item: Error handling evaluated
  level: HIGH
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - reliable
  compliance_mappings:
  - framework: DO-178C
    control: 6.3.4
    description: Runtime verification
  - framework: IEC 61508
    control: Table B.9
    description: Runtime checks
  - framework: ISO 26262
    control: Part 6
    description: Runtime verification
relationships:
  commonly_combined:
  - real-time-embedded.firmware-quality.defensive-coding-practices
  - real-time-embedded.firmware-quality.static-analysis-coverage
  depends_on:
  - build.compiler-configuration
  feeds_into:
  - safety.runtime-safety
  - reliability.error-detection
