audit:
  id: real-time-embedded.rtos-configuration.task-synchronization-review
  name: Task Synchronization Review Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: rtos-configuration
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Examines task synchronization mechanisms including mutexes, semaphores,
    event flags, and message queues. Reviews proper usage patterns, error
    handling, and potential race conditions. Evaluates synchronization
    primitive selection for each use case and identifies opportunities
    for simplification or optimization.
  why_it_matters: |
    Incorrect synchronization causes race conditions, deadlocks, and priority
    inversion - often intermittent bugs that are difficult to reproduce and
    diagnose. Data corruption from race conditions can cause safety failures.
    Deadlocks halt system operation. Proper synchronization is essential for
    correct concurrent system behavior.
  when_to_run:
  - During code review cycles
  - After adding concurrent features
  - When debugging intermittent issues
  - Before safety certification
  - After architecture changes
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete application source code
  - type: architecture_docs
    description: Task interaction documentation
  - type: rtos_api
    description: RTOS synchronization API documentation
  - type: data_flow
    description: Inter-task data flow documentation
  access_requirements:
  - Access to source code
  - Access to RTOS documentation
  - Static analysis tools
  - Runtime debugging capability
discovery:
  file_patterns:
  - glob: '**/mutex*.c'
    purpose: Find mutex usage
  - glob: '**/semaphore*.c'
    purpose: Find semaphore usage
  - glob: '**/queue*.c'
    purpose: Find queue usage
  - glob: '**/event*.c'
    purpose: Find event flag usage
  - glob: '**/sync*.c'
    purpose: Find synchronization code
knowledge_sources:
  guides:
  - id: rtos-sync
    name: RTOS Synchronization Primitives
    url: https://www.freertos.org/a00113.html
  - id: concurrency-patterns
    name: Embedded Concurrency Patterns
    url: https://www.embedded.com/concurrency-patterns
  standards:
  - id: misra-c
    name: MISRA C Guidelines
    relevance: Concurrency rules
  - id: cert-c
    name: CERT C Coding Standard
    relevance: Concurrency security
  - id: autosar
    name: AUTOSAR Concurrency
    relevance: Automotive concurrency patterns
tooling:
  analysis_tools:
  - tool: pc-lint
    purpose: Static concurrency analysis
  - tool: helgrind
    purpose: Race detection
  - tool: tracealyzer
    purpose: Synchronization visualization
  - tool: polyspace
    purpose: Formal concurrency analysis
signals:
  critical:
  - id: TSR-CRIT-001
    signal: Race condition on shared data
    evidence_indicators:
    - Unprotected access to shared variable
    - Missing mutex around critical section
    - Data corruption observed
    explanation: |
      Race conditions cause data corruption that can lead to safety
      failures. All shared data must be properly protected.
    remediation: Add appropriate synchronization protection
  - id: TSR-CRIT-002
    signal: Deadlock potential identified
    evidence_indicators:
    - Circular wait pattern detected
    - Multiple locks in different orders
    - System hang observed
    explanation: |
      Deadlocks halt system operation entirely. They must be prevented
      through consistent lock ordering or other mechanisms.
    remediation: Implement consistent lock ordering or deadlock avoidance
  high:
  - id: TSR-HIGH-001
    signal: Synchronization primitive misuse
    evidence_indicators:
    - Mutex used as binary semaphore
    - Semaphore used for mutual exclusion
    - Wrong primitive for use case
    explanation: |
      Different synchronization primitives have different semantics.
      Using the wrong type can cause subtle correctness issues.
    remediation: Use appropriate primitive for each synchronization need
  - id: TSR-HIGH-002
    signal: Missing timeout handling
    evidence_indicators:
    - Blocking calls with infinite timeout
    - No recovery from blocked state
    - System can hang on failure
    explanation: |
      Infinite blocking without timeout can cause system hangs if
      the awaited event never occurs due to bugs or failures.
    remediation: Use timeouts and handle timeout errors
  medium:
  - id: TSR-MED-001
    signal: Excessive synchronization overhead
    evidence_indicators:
    - Fine-grained locking causing contention
    - Lock/unlock in tight loops
    - Performance degradation
    explanation: |
      Over-synchronization reduces concurrency benefits and adds
      overhead. Balance protection with performance.
    remediation: Optimize synchronization granularity
  - id: TSR-MED-002
    signal: Error handling incomplete for sync operations
    evidence_indicators:
    - Return values not checked
    - Error conditions ignored
    - Silent failures possible
    explanation: |
      Synchronization operations can fail. Ignoring errors leaves
      the system in an inconsistent state.
    remediation: Check and handle all synchronization error returns
  low:
  - id: TSR-LOW-001
    signal: Synchronization design not documented
    evidence_indicators:
    - No concurrency architecture documentation
    - Lock relationships unclear
    - Protocol not specified
    explanation: |
      Documentation helps prevent errors during maintenance and
      supports analysis for certification.
    remediation: Document synchronization design and protocols
  positive:
  - id: TSR-POS-001
    signal: Clean synchronization architecture
    evidence_indicators:
    - Clear primitive selection rationale
    - Consistent usage patterns
    - No race conditions detected
  - id: TSR-POS-002
    signal: Comprehensive error handling
    evidence_indicators:
    - All returns checked
    - Timeouts used appropriately
    - Recovery mechanisms in place
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Synchronization Primitives
    description: Identify all mutexes, semaphores, queues, and events
    duration_estimate: 1 hour
  - id: '2'
    name: Map Shared Data Access
    description: Document all shared data and protecting primitives
    duration_estimate: 1-2 hours
  - id: '3'
    name: Analyze for Race Conditions
    description: Review for unprotected shared access
    duration_estimate: 1 hour
  - id: '4'
    name: Check for Deadlock Patterns
    description: Identify potential circular wait conditions
    duration_estimate: 1 hour
  - id: '5'
    name: Review Error Handling
    description: Verify proper handling of sync operation failures
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile analysis results and recommendations
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Synchronization Inventory
    - Race Condition Analysis
    - Deadlock Analysis
    - Recommendations
closeout_checklist:
- id: tsr-001
  item: All sync primitives inventoried
  level: HIGH
  verification: automated
- id: tsr-002
  item: Shared data mapped to protection
  level: CRITICAL
  verification: manual
- id: tsr-003
  item: Race conditions analyzed
  level: CRITICAL
  verification: automated
- id: tsr-004
  item: Deadlock patterns checked
  level: HIGH
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - automotive
    - concurrent
  compliance_mappings:
  - framework: MISRA C
    control: Dir 4.7
    description: Concurrency
  - framework: CERT C
    control: CON
    description: Concurrency rules
  - framework: DO-178C
    control: 6.3.3
    description: Resource management
relationships:
  commonly_combined:
  - real-time-embedded.rtos-configuration.priority-inversion-analysis
  - code-quality.concurrency-review
  depends_on:
  - architecture.task-design
  feeds_into:
  - reliability.race-condition-prevention
  - safety.concurrent-safety

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
