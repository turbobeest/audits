# ============================================================
# AUDIT: Industrial Ethernet
# Category: 39 - Real-Time & Embedded Systems
# Subcategory: communication-protocols
# ============================================================

audit:
  id: "real-time-embedded.communication-protocols.industrial-ethernet"
  name: "Industrial Ethernet Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "real-time-embedded"
  category_number: 39
  subcategory: "communication-protocols"

  tier: "expert"
  estimated_duration: "6-8 hours"  # median: 7h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "embedded-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Reviews industrial Ethernet protocol implementations including EtherCAT,
    PROFINET, EtherNet/IP, and Modbus TCP. Examines real-time performance,
    deterministic communication, synchronization, and network configuration.
    Evaluates conformance to protocol specifications and safety extensions.

  why_it_matters: |
    Industrial Ethernet enables real-time control over standard Ethernet
    infrastructure. Each protocol has specific timing, synchronization, and
    configuration requirements. Non-conformance causes communication failures,
    timing violations, and safety issues in motion control and process
    automation applications.

  when_to_run:
    - "During industrial network integration"
    - "Before production deployment"
    - "After network changes"
    - "For protocol conformance testing"
    - "When debugging communication issues"

prerequisites:
  required_artifacts:
    - type: "protocol_stack"
      description: "Industrial Ethernet stack source"
    - type: "network_design"
      description: "Network topology documentation"
    - type: "esi_files"
      description: "Device description files"
    - type: "timing_requirements"
      description: "Real-time requirements"

  access_requirements:
    - "Access to source code"
    - "Access to industrial network"
    - "Protocol analyzer"
    - "Network testing tools"

discovery:
  file_patterns:
    - glob: "**/ethercat*.c"
      purpose: "Find EtherCAT implementation"
    - glob: "**/profinet*.c"
      purpose: "Find PROFINET implementation"
    - glob: "**/ethernet_ip*.c"
      purpose: "Find EtherNet/IP code"
    - glob: "**/*.esi"
      purpose: "Find EtherCAT device files"
    - glob: "**/*.gsdml"
      purpose: "Find PROFINET device files"

knowledge_sources:
  guides:
    - id: "ethercat-intro"
      name: "EtherCAT Technology Group"
      url: "https://www.ethercat.org/"
    - id: "profinet"
      name: "PROFINET Specification"
      url: "https://www.profinet.com/"

  standards:
    - id: "iec-61158"
      name: "IEC 61158 Industrial Communication"
      relevance: "Industrial protocol standard"
    - id: "iec-61784"
      name: "IEC 61784 Communication Profiles"
      relevance: "Protocol profiles"
    - id: "iec-61784-3"
      name: "IEC 61784-3 Functional Safety"
      relevance: "Safety communication"

tooling:
  analysis_tools:
    - tool: "wireshark"
      purpose: "Protocol analysis"
    - tool: "ethercat-analyzer"
      purpose: "EtherCAT specific analysis"
    - tool: "proneta"
      purpose: "PROFINET analysis"
    - tool: "network-tap"
      purpose: "Traffic capture"

signals:
  critical:
    - id: "IE-CRIT-001"
      signal: "Real-time cycle time violated"
      evidence_indicators:
        - "Cycle overruns detected"
        - "Timing jitter excessive"
        - "Determinism not achieved"
      explanation: |
        Industrial Ethernet protocols require deterministic timing.
        Cycle violations cause control system failures.
      remediation: "Optimize stack and network to meet cycle time"

    - id: "IE-CRIT-002"
      signal: "Safety protocol not conformant"
      evidence_indicators:
        - "Safety layer incorrectly implemented"
        - "Watchdog not functioning"
        - "Black channel requirements not met"
      explanation: |
        Safety protocols (FSoE, PROFIsafe) have strict requirements.
        Non-conformance voids safety certification.
      remediation: "Ensure safety protocol conformance"

  high:
    - id: "IE-HIGH-001"
      signal: "Synchronization error between devices"
      evidence_indicators:
        - "DC sync failure"
        - "Clock drift excessive"
        - "Distributed control unstable"
      explanation: |
        Distributed clocks must be synchronized for coordinated control.
        Sync failures cause motion coordination problems.
      remediation: "Fix synchronization configuration and topology"

    - id: "IE-HIGH-002"
      signal: "Device description file mismatch"
      evidence_indicators:
        - "ESI/GSDML not matching implementation"
        - "Parameter errors"
        - "PDO configuration wrong"
      explanation: |
        Device files must match implementation exactly. Mismatches
        cause configuration errors and incorrect data mapping.
      remediation: "Update device description files"

  medium:
    - id: "IE-MED-001"
      signal: "Network topology not optimal"
      evidence_indicators:
        - "Daisy chain too long"
        - "Redundancy not configured"
        - "Single point of failure"
      explanation: |
        Network topology affects performance and reliability. Poor
        topology increases latency and reduces availability.
      remediation: "Optimize network topology"

    - id: "IE-MED-002"
      signal: "Diagnostic data not utilized"
      evidence_indicators:
        - "Protocol diagnostics ignored"
        - "Error counters not monitored"
        - "Issues go undetected"
      explanation: |
        Industrial Ethernet provides rich diagnostics. Not using them
        misses early warning of problems.
      remediation: "Implement diagnostic monitoring"

  low:
    - id: "IE-LOW-001"
      signal: "Protocol configuration not documented"
      evidence_indicators:
        - "Network settings unclear"
        - "Timing parameters not recorded"
        - "Device configuration missing"
      explanation: |
        Documentation supports maintenance and troubleshooting.
      remediation: "Document network and device configuration"

  positive:
    - id: "IE-POS-001"
      signal: "Conformant protocol implementation"
      evidence_indicators:
        - "Conformance testing passed"
        - "Timing requirements met"
        - "Safety layer certified"

    - id: "IE-POS-002"
      signal: "Robust network design"
      evidence_indicators:
        - "Redundancy implemented"
        - "Diagnostics monitored"
        - "Documentation complete"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Protocol Implementation"
      description: "Examine stack configuration and features"
      duration_estimate: "1-2 hours"

    - id: "2"
      name: "Analyze Timing Performance"
      description: "Measure cycle time and jitter"
      duration_estimate: "1-2 hours"

    - id: "3"
      name: "Verify Synchronization"
      description: "Check distributed clock operation"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Review Device Configuration"
      description: "Validate device files and mapping"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Assess Safety Protocol"
      description: "Review safety layer implementation"
      duration_estimate: "1 hour"

    - id: "6"
      name: "Document Findings"
      description: "Compile assessment report"
      duration_estimate: "30 minutes"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Protocol Implementation Review"
        - "Timing Analysis"
        - "Safety Assessment"
        - "Recommendations"

closeout_checklist:
  - id: "ie-001"
    item: "Protocol implementation reviewed"
    level: "HIGH"
    verification: "manual"
  - id: "ie-002"
    item: "Timing performance analyzed"
    level: "CRITICAL"
    verification: "automated"
  - id: "ie-003"
    item: "Synchronization verified"
    level: "HIGH"
    verification: "automated"
  - id: "ie-004"
    item: "Safety protocol assessed"
    level: "CRITICAL"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["industrial-automation", "motion-control", "process-control"]

  compliance_mappings:
    - framework: "IEC 61158"
      control: "Industrial Communication"
      description: "Protocol standard"
    - framework: "IEC 61784-3"
      control: "Functional Safety"
      description: "Safety communication"
    - framework: "ETG"
      control: "EtherCAT Conformance"
      description: "EtherCAT certification"

relationships:
  commonly_combined:
    - "real-time-embedded.communication-protocols.protocol-timing"
    - "real-time-embedded.communication-protocols.industrial-protocol-safety"
  depends_on:
    - "hardware.ethernet-controller"
    - "network.ethernet-infrastructure"
  feeds_into:
    - "automation.control-system-reliability"
    - "safety.functional-safety-communication"

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
