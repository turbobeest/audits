audit:
  id: real-time-embedded.firmware-quality.defensive-coding-practices
  name: Defensive Coding Practices Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: firmware-quality
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates defensive coding practices in embedded firmware including parameter
    validation, error checking, assertion usage, and graceful degradation.
    Reviews how code handles unexpected inputs, resource failures, and
    exceptional conditions to maintain safe operation.
  why_it_matters: |
    Defensive coding prevents errors from propagating and causing system failures.
    In embedded systems, crashes may be unrecoverable. Parameter validation catches
    interface errors early. Error checking prevents silent failures. Assertions
    catch programming errors in development. These practices are essential for
    building robust, safe embedded systems.
  when_to_run:
  - During code review
  - Before safety certification
  - After implementing new features
  - When improving reliability
  - For legacy code assessment
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete firmware source code
  - type: coding_standard
    description: Project coding guidelines
  - type: api_documentation
    description: Interface specifications
  access_requirements:
  - Access to source code
  - Access to coding standards
  - Static analysis tools
discovery:
  file_patterns:
  - glob: '**/*.c'
    purpose: Find C source files
  - glob: '**/*.h'
    purpose: Find header files
  - glob: '**/assert*.h'
    purpose: Find assertion definitions
  - glob: '**/error*.c'
    purpose: Find error handling code
knowledge_sources:
  guides:
  - id: defensive-coding
    name: Defensive Coding for Embedded Systems
    url: https://www.embedded.com/defensive-coding
  - id: safe-c
    name: Safe C Coding Practices
    url: https://www.embedded.com/safe-c
  standards:
  - id: cert-c
    name: CERT C Coding Standard
    relevance: Secure defensive coding
  - id: misra-c
    name: MISRA C Guidelines
    relevance: Defensive patterns
tooling:
  analysis_tools:
  - tool: pc-lint
    purpose: Parameter and return checking
  - tool: coverity
    purpose: Error handling analysis
  - tool: polyspace
    purpose: Runtime error detection
signals:
  critical:
  - id: DCP-CRIT-001
    signal: No parameter validation in public APIs
    evidence_indicators:
    - Null pointers not checked
    - Range validation missing
    - Buffer sizes not verified
    explanation: |
      Unvalidated parameters can cause crashes, memory corruption,
      or security vulnerabilities. All inputs must be validated.
    remediation: Add parameter validation to all public interfaces
  - id: DCP-CRIT-002
    signal: Critical error codes ignored
    evidence_indicators:
    - Return values not checked
    - Errors silently discarded
    - Resource allocation failures ignored
    explanation: |
      Ignoring errors allows system to continue in invalid state,
      leading to unpredictable failures later.
    remediation: Check and handle all error returns
  high:
  - id: DCP-HIGH-001
    signal: No assertions for invariants
    evidence_indicators:
    - No assert statements
    - Invariants not documented
    - Programming errors undetected
    explanation: |
      Assertions catch programming errors during development before
      they reach production. Missing assertions allow bugs to escape.
    remediation: Add assertions for function preconditions and invariants
  - id: DCP-HIGH-002
    signal: No graceful degradation for failures
    evidence_indicators:
    - Hard failures on any error
    - No fallback behavior
    - All errors treated as fatal
    explanation: |
      Graceful degradation maintains partial functionality during
      failures rather than complete system failure.
    remediation: Implement graceful degradation where possible
  medium:
  - id: DCP-MED-001
    signal: Inconsistent error handling patterns
    evidence_indicators:
    - Different approaches in different modules
    - No standard error types
    - Error propagation unclear
    explanation: |
      Inconsistent patterns are error-prone and harder to maintain.
      Standardized approach improves reliability.
    remediation: Establish and apply consistent error handling
  - id: DCP-MED-002
    signal: Assertions disabled in debug builds
    evidence_indicators:
    - NDEBUG defined even in debug
    - Assertions optimized out
    - No runtime checking
    explanation: |
      Assertions should be active in development builds to catch
      programming errors early.
    remediation: Enable assertions in development builds
  low:
  - id: DCP-LOW-001
    signal: Defensive coding practices not documented
    evidence_indicators:
    - No coding guidelines
    - Practices not specified
    - Training not provided
    explanation: |
      Documentation ensures consistent application and helps
      train developers on expected practices.
    remediation: Document defensive coding requirements
  positive:
  - id: DCP-POS-001
    signal: Comprehensive defensive coding
    evidence_indicators:
    - All inputs validated
    - All errors handled
    - Assertions used throughout
  - id: DCP-POS-002
    signal: Graceful degradation implemented
    evidence_indicators:
    - Fallback behaviors defined
    - Partial operation possible
    - Safe states achieved
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Parameter Validation
    description: Check input validation in public APIs
    duration_estimate: 1-2 hours
  - id: '2'
    name: Analyze Error Handling
    description: Review error checking and propagation
    duration_estimate: 1-2 hours
  - id: '3'
    name: Assess Assertion Usage
    description: Review assertion placement and coverage
    duration_estimate: 1 hour
  - id: '4'
    name: Check Degradation Behavior
    description: Evaluate graceful degradation capabilities
    duration_estimate: 30 minutes
  - id: '5'
    name: Review Coding Standards
    description: Assess documented practices and compliance
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile assessment report
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Parameter Validation Review
    - Error Handling Analysis
    - Assertion Assessment
    - Recommendations
closeout_checklist:
- id: dcp-001
  item: Parameter validation reviewed
  level: CRITICAL
  verification: manual
- id: dcp-002
  item: Error handling analyzed
  level: CRITICAL
  verification: automated
- id: dcp-003
  item: Assertion usage assessed
  level: HIGH
  verification: automated
- id: dcp-004
  item: Degradation behavior checked
  level: HIGH
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - robust
  compliance_mappings:
  - framework: CERT C
    control: Multiple rules
    description: Defensive coding practices
  - framework: MISRA C
    control: Dir 4.7, 4.11
    description: Error handling
  - framework: DO-178C
    control: 6.3.5
    description: Defensive programming
relationships:
  commonly_combined:
  - real-time-embedded.firmware-quality.misra-compliance
  - real-time-embedded.watchdog-recovery.fault-detection
  depends_on:
  - coding-standards.project-standards
  feeds_into:
  - reliability.robustness
  - safety.fault-tolerance

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
