audit:
  id: real-time-embedded.watchdog-recovery.watchdog-timer-configuration
  name: Watchdog Timer Configuration Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: watchdog-recovery
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews watchdog timer configuration including timeout period selection,
    refresh strategy, window mode settings, and relationship to system timing.
    Examines hardware watchdog capabilities, initialization sequence, and
    protection against accidental disable.
  why_it_matters: |
    Watchdog timers are the last line of defense against software hangs and
    runaway code. Improper configuration reduces effectiveness - timeout too
    long allows extended outages, too short causes spurious resets. Window
    mode catches both stuck and too-fast code. Safety-critical systems often
    require independent hardware watchdogs.
  when_to_run:
  - During system bring-up
  - After watchdog changes
  - Before safety certification
  - When debugging reset issues
  - For reliability assessment
prerequisites:
  required_artifacts:
  - type: watchdog_configuration
    description: Watchdog timer settings
  - type: hardware_manual
    description: Watchdog hardware documentation
  - type: system_timing
    description: Task timing requirements
  - type: refresh_code
    description: Watchdog kick implementation
  access_requirements:
  - Access to watchdog configuration
  - Access to source code
  - Hardware documentation
  - Debug/test capability
discovery:
  file_patterns:
  - glob: '**/watchdog*.c'
    purpose: Find watchdog code
  - glob: '**/wdt*.c'
    purpose: Find WDT implementation
  - glob: '**/iwdg*.c'
    purpose: Find independent WDT
  - glob: '**/wwdg*.c'
    purpose: Find window WDT
  - glob: '**/system_init*.c'
    purpose: Find initialization
knowledge_sources:
  guides:
  - id: watchdog-design
    name: Watchdog Timer Design
    url: https://www.embedded.com/watchdog-design
  - id: window-watchdog
    name: Window Watchdog Usage
    url: https://www.embedded.com/window-watchdog
  standards:
  - id: iec-61508
    name: IEC 61508 Functional Safety
    relevance: Watchdog requirements
  - id: iso-26262
    name: ISO 26262 Functional Safety
    relevance: Automotive watchdog
tooling:
  analysis_tools:
  - tool: debugger
    purpose: Watchdog register inspection
  - tool: oscilloscope
    purpose: Reset timing measurement
  - tool: logic-analyzer
    purpose: Refresh timing analysis
signals:
  critical:
  - id: WTC-CRIT-001
    signal: Watchdog not enabled
    evidence_indicators:
    - Watchdog disabled in code
    - No hardware watchdog active
    - System can hang indefinitely
    explanation: |
      Without watchdog, software hangs cause indefinite outages.
      Watchdog is essential for recovery from unexpected failures.
    remediation: Enable and properly configure watchdog timer
  - id: WTC-CRIT-002
    signal: Watchdog can be disabled by software
    evidence_indicators:
    - Disable possible after enable
    - No lock-out mechanism
    - Runaway code can disable
    explanation: |
      If software can disable watchdog, runaway code may do so before
      hanging. Watchdog should be locked once enabled.
    remediation: Enable watchdog lock-out after configuration
  high:
  - id: WTC-HIGH-001
    signal: Timeout period inappropriate
    evidence_indicators:
    - Timeout much longer than needed
    - Extended outage before reset
    - Or too short causing spurious resets
    explanation: |
      Timeout should be long enough for normal operation variance
      but short enough to minimize outage on failure.
    remediation: Set timeout appropriate for system requirements
  - id: WTC-HIGH-002
    signal: Single point refresh location
    evidence_indicators:
    - Refresh in one task only
    - Other tasks not monitored
    - Partial failure undetected
    explanation: |
      Refreshing from one location only monitors that code path.
      Multi-task systems need comprehensive monitoring.
    remediation: Implement multi-point watchdog monitoring
  medium:
  - id: WTC-MED-001
    signal: Window mode not used
    evidence_indicators:
    - No early refresh detection
    - Too-fast code not caught
    - Only timeout monitored
    explanation: |
      Window mode catches both stuck (late) and runaway (early)
      conditions. Provides better fault coverage.
    remediation: Consider window watchdog for better coverage
  - id: WTC-MED-002
    signal: No independence from main clock
    evidence_indicators:
    - Watchdog uses system clock
    - Clock failure affects watchdog
    - Common mode failure possible
    explanation: |
      Watchdog should use independent clock source so clock failures
      are detected. Shared clock creates vulnerability.
    remediation: Use watchdog with independent clock source
  low:
  - id: WTC-LOW-001
    signal: Watchdog configuration not documented
    evidence_indicators:
    - Timeout rationale missing
    - Configuration not specified
    - Refresh strategy undocumented
    explanation: |
      Documentation supports maintenance and certification evidence.
    remediation: Document watchdog configuration and rationale
  positive:
  - id: WTC-POS-001
    signal: Well-configured watchdog system
    evidence_indicators:
    - Appropriate timeout
    - Lock-out enabled
    - Comprehensive refresh strategy
  - id: WTC-POS-002
    signal: Window watchdog with independent clock
    evidence_indicators:
    - Window mode active
    - Independent oscillator
    - Maximum fault coverage
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Watchdog Hardware
    description: Document watchdog capabilities and configuration
    duration_estimate: 30 minutes
  - id: '2'
    name: Analyze Configuration
    description: Review timeout, window, and lock settings
    duration_estimate: 1 hour
  - id: '3'
    name: Examine Refresh Strategy
    description: Analyze where and how watchdog is refreshed
    duration_estimate: 1 hour
  - id: '4'
    name: Test Timeout Behavior
    description: Verify reset occurs on missed refresh
    duration_estimate: 1 hour
  - id: '5'
    name: Verify Lock-Out
    description: Confirm watchdog cannot be disabled
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile assessment report
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Hardware Capability Review
    - Configuration Analysis
    - Refresh Strategy Assessment
    - Recommendations
closeout_checklist:
- id: wtc-001
  item: Watchdog hardware reviewed
  level: HIGH
  verification: manual
- id: wtc-002
  item: Configuration analyzed
  level: CRITICAL
  verification: manual
- id: wtc-003
  item: Refresh strategy examined
  level: HIGH
  verification: manual
- id: wtc-004
  item: Timeout behavior tested
  level: CRITICAL
  verification: automated
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - reliable-systems
  compliance_mappings:
  - framework: IEC 61508
    control: Table A.1
    description: Watchdog recommendation
  - framework: ISO 26262
    control: Part 5
    description: Hardware safety mechanisms
  - framework: DO-178C
    control: 6.3.5
    description: Error handling
relationships:
  commonly_combined:
  - real-time-embedded.watchdog-recovery.fault-detection
  - real-time-embedded.watchdog-recovery.recovery-mechanisms
  depends_on:
  - hardware.watchdog-timer
  feeds_into:
  - reliability.system-recovery
  - safety.fault-tolerance
