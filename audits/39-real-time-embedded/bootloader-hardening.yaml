# ============================================================
# AUDIT: Bootloader Hardening
# Category: 39 - Real-Time & Embedded Systems
# Subcategory: bootloader-security
# ============================================================

audit:
  id: "real-time-embedded.bootloader-security.bootloader-hardening"
  name: "Bootloader Hardening Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "real-time-embedded"
  category_number: 39
  subcategory: "bootloader-security"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "embedded-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates bootloader security hardening measures including attack surface
    reduction, debug interface protection, memory protection during boot,
    and timing attack resistance. Reviews boot command handling, serial
    interface security, and protection against physical attacks.

  why_it_matters: |
    The bootloader is a critical attack target since compromise allows
    persistent malware. Hardening reduces attack surface and increases
    difficulty of exploitation. Debug interfaces, serial consoles, and
    timing side channels are common attack vectors that must be secured
    in production devices.

  when_to_run:
    - "Before production release"
    - "During security assessment"
    - "After bootloader changes"
    - "For penetration testing"
    - "Compliance verification"

prerequisites:
  required_artifacts:
    - type: "bootloader_source"
      description: "Complete bootloader source code"
    - type: "hardware_design"
      description: "Board design documentation"
    - type: "security_requirements"
      description: "Security hardening requirements"
    - type: "debug_configuration"
      description: "Debug interface documentation"

  access_requirements:
    - "Access to bootloader source"
    - "Access to hardware"
    - "Debug probe access"
    - "Serial interface access"

discovery:
  file_patterns:
    - glob: "**/bootloader*.c"
      purpose: "Find bootloader code"
    - glob: "**/console*.c"
      purpose: "Find console handling"
    - glob: "**/debug*.c"
      purpose: "Find debug code"
    - glob: "**/cmd_*.c"
      purpose: "Find command handlers"
    - glob: "**/auth*.c"
      purpose: "Find authentication code"

knowledge_sources:
  guides:
    - id: "bootloader-security"
      name: "Bootloader Security Guide"
      url: "https://www.embedded.com/bootloader-security"
    - id: "physical-attacks"
      name: "Protection Against Physical Attacks"
      url: "https://www.embedded.com/physical-security"

  standards:
    - id: "common-criteria"
      name: "Common Criteria"
      relevance: "Security evaluation"
    - id: "fips-140-3"
      name: "FIPS 140-3"
      relevance: "Cryptographic module security"

tooling:
  analysis_tools:
    - tool: "jtag-debugger"
      purpose: "Debug interface testing"
    - tool: "uart-analyzer"
      purpose: "Serial interface analysis"
    - tool: "power-analyzer"
      purpose: "Side channel analysis"

signals:
  critical:
    - id: "BH-CRIT-001"
      signal: "Debug interface enabled in production"
      evidence_indicators:
        - "JTAG/SWD accessible"
        - "No debug authentication"
        - "Full system access via debug"
      explanation: |
        Enabled debug interfaces allow complete system compromise.
        Debug must be disabled or authenticated in production.
      remediation: "Disable or secure debug interfaces"

    - id: "BH-CRIT-002"
      signal: "Bootloader console has dangerous commands"
      evidence_indicators:
        - "Memory write commands"
        - "No authentication required"
        - "Boot sequence bypassable"
      explanation: |
        Dangerous console commands enable attackers to modify system
        and bypass security. Remove or authenticate sensitive commands.
      remediation: "Remove or authenticate dangerous boot commands"

  high:
    - id: "BH-HIGH-001"
      signal: "Serial console enabled without timeout"
      evidence_indicators:
        - "Boot waits for console input"
        - "No timeout to continue boot"
        - "DoS possible"
      explanation: |
        Console that blocks boot enables denial of service. Console
        should timeout and continue if no input.
      remediation: "Add timeout to console wait"

    - id: "BH-HIGH-002"
      signal: "Memory not protected during boot"
      evidence_indicators:
        - "All memory accessible"
        - "No MPU during boot"
        - "Boot code modifiable"
      explanation: |
        Unprotected memory during boot allows corruption of boot
        code through other vectors. Enable protection early.
      remediation: "Enable memory protection early in boot"

  medium:
    - id: "BH-MED-001"
      signal: "Timing attacks possible on verification"
      evidence_indicators:
        - "Verification time varies with data"
        - "No constant-time comparison"
        - "Side channel leakage"
      explanation: |
        Timing variations leak information about secrets. Cryptographic
        operations must be constant-time.
      remediation: "Implement constant-time verification"

    - id: "BH-MED-002"
      signal: "Error messages too detailed"
      evidence_indicators:
        - "Specific failure reasons exposed"
        - "Information aids attackers"
        - "Different error responses"
      explanation: |
        Detailed errors help attackers understand the system. Error
        messages should be generic in production.
      remediation: "Reduce error message detail in production"

  low:
    - id: "BH-LOW-001"
      signal: "Boot hardening not documented"
      evidence_indicators:
        - "Security measures unclear"
        - "Configuration not specified"
        - "Rationale missing"
      explanation: |
        Documentation supports consistent configuration and verification.
      remediation: "Document hardening measures and configuration"

  positive:
    - id: "BH-POS-001"
      signal: "Comprehensive bootloader hardening"
      evidence_indicators:
        - "Debug disabled or authenticated"
        - "Console secured"
        - "Memory protected"

    - id: "BH-POS-002"
      signal: "Side channel mitigations in place"
      evidence_indicators:
        - "Constant-time operations"
        - "Minimal information leakage"
        - "Physical protections"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Assess Debug Interface Security"
      description: "Test debug interface access and protection"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Review Console Security"
      description: "Analyze boot console and commands"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Evaluate Memory Protection"
      description: "Check memory protection during boot"
      duration_estimate: "1 hour"

    - id: "4"
      name: "Analyze Side Channels"
      description: "Review timing and power leakage"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Check Error Handling"
      description: "Review error message detail"
      duration_estimate: "30 minutes"

    - id: "6"
      name: "Document Findings"
      description: "Compile assessment report"
      duration_estimate: "30 minutes"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Debug Interface Assessment"
        - "Console Security Review"
        - "Protection Analysis"
        - "Recommendations"

closeout_checklist:
  - id: "bh-001"
    item: "Debug interfaces assessed"
    level: "CRITICAL"
    verification: "manual"
  - id: "bh-002"
    item: "Console security reviewed"
    level: "HIGH"
    verification: "manual"
  - id: "bh-003"
    item: "Memory protection evaluated"
    level: "HIGH"
    verification: "manual"
  - id: "bh-004"
    item: "Side channels analyzed"
    level: "MEDIUM"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["embedded-systems", "security-critical", "production-devices"]

  compliance_mappings:
    - framework: "Common Criteria"
      control: "AVA_VAN"
      description: "Vulnerability analysis"
    - framework: "IEC 62443"
      control: "SR 7.1"
      description: "Attack surface reduction"
    - framework: "FIPS 140-3"
      control: "Physical Security"
      description: "Physical attack protection"

relationships:
  commonly_combined:
    - "real-time-embedded.bootloader-security.secure-boot-chain"
    - "security.debug-interface-security"
  depends_on:
    - "hardware.debug-interface-design"
  feeds_into:
    - "security.attack-surface-reduction"
    - "certification.security-evaluation"
