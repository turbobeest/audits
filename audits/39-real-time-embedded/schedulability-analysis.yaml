# ============================================================
# AUDIT: Schedulability Analysis
# Category: 39 - Real-Time & Embedded Systems
# Subcategory: timing-analysis
# ============================================================

audit:
  id: "real-time-embedded.timing-analysis.schedulability-analysis"
  name: "Schedulability Analysis Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "real-time-embedded"
  category_number: 39
  subcategory: "timing-analysis"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "embedded-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates system schedulability using formal analysis techniques to prove
    that all tasks can meet their deadlines. Applies utilization bounds,
    response time analysis, and processor demand analysis depending on the
    scheduling algorithm. Considers task dependencies, shared resources,
    and aperiodic events in the analysis framework.

  why_it_matters: |
    Schedulability analysis provides mathematical proof that a task set is
    feasible before implementation and testing. This catch design flaws
    early when they are cheapest to fix. For safety certification, formal
    schedulability proof may be required to demonstrate timing correctness.
    Analysis also identifies margin available for future functionality.

  when_to_run:
    - "During system architecture design"
    - "After task set modifications"
    - "Before safety certification"
    - "When evaluating design alternatives"
    - "Before adding new features"

prerequisites:
  required_artifacts:
    - type: "task_set_specification"
      description: "Complete task parameters (C, T, D, priority)"
    - type: "wcet_results"
      description: "WCET values for all tasks"
    - type: "scheduling_policy"
      description: "Scheduler algorithm documentation"
    - type: "resource_model"
      description: "Shared resource and synchronization"

  access_requirements:
    - "Access to system specifications"
    - "Access to schedulability tools"
    - "Task timing documentation"
    - "Architecture documents"

discovery:
  file_patterns:
    - glob: "**/task_spec*.yaml"
      purpose: "Find task specifications"
    - glob: "**/scheduling*.c"
      purpose: "Find scheduler implementation"
    - glob: "**/FreeRTOSConfig.h"
      purpose: "Find RTOS configuration"
    - glob: "**/priority*.h"
      purpose: "Find priority assignments"
    - glob: "**/timing_budget*.xlsx"
      purpose: "Find timing budgets"

knowledge_sources:
  guides:
    - id: "rma-handbook"
      name: "Rate Monotonic Analysis Handbook"
      url: "https://www.sei.cmu.edu/reports/93tr023.pdf"
    - id: "edf-analysis"
      name: "EDF Schedulability Analysis"
      url: "https://www.cs.duke.edu/~anderson/papers/edf_survey.pdf"

  standards:
    - id: "do-178c"
      name: "DO-178C Software Considerations"
      relevance: "Aviation scheduling requirements"
    - id: "arinc-653"
      name: "ARINC 653 Partitioning"
      relevance: "Aviation time partitioning"
    - id: "autosar"
      name: "AUTOSAR OS Specification"
      relevance: "Automotive scheduling"

tooling:
  analysis_tools:
    - tool: "cheddar"
      purpose: "Schedulability analysis framework"
    - tool: "mast"
      purpose: "Modeling and analysis suite"
    - tool: "uppaal"
      purpose: "Model checking for timing"
    - tool: "times"
      purpose: "Timing analysis environment"

signals:
  critical:
    - id: "SCHED-CRIT-001"
      signal: "Task set not schedulable"
      evidence_indicators:
        - "Utilization exceeds bound"
        - "Response time analysis fails"
        - "Processor demand exceeds supply"
      explanation: |
        When schedulability analysis fails, it proves that at least one task
        cannot guarantee deadline compliance. The system must be redesigned.
      remediation: "Reduce utilization, optimize tasks, or adjust deadlines"

    - id: "SCHED-CRIT-002"
      signal: "Safety-critical tasks have lowest priority"
      evidence_indicators:
        - "Critical tasks can be preempted by non-critical"
        - "Priority assignment violates safety requirements"
        - "Deadline miss risk in critical function"
      explanation: |
        Priority inversion where non-critical tasks can delay safety-critical
        tasks is a design flaw that can lead to safety failures.
      remediation: "Reassign priorities according to criticality"

  high:
    - id: "SCHED-HIGH-001"
      signal: "Schedulability margin insufficient"
      evidence_indicators:
        - "Utilization above 80% of bound"
        - "No room for additional functionality"
        - "Sensitive to WCET changes"
      explanation: |
        Minimal margin leaves no room for growth or variation. The system
        may become infeasible with minor changes.
      remediation: "Reduce utilization to maintain adequate margin"

    - id: "SCHED-HIGH-002"
      signal: "Blocking analysis incomplete"
      evidence_indicators:
        - "Shared resources not in model"
        - "Blocking times not calculated"
        - "Priority ceiling not implemented"
      explanation: |
        Without blocking analysis, schedulability results are optimistic
        and may not reflect actual system behavior.
      remediation: "Include all shared resources in analysis"

  medium:
    - id: "SCHED-MED-001"
      signal: "Aperiodic tasks not properly analyzed"
      evidence_indicators:
        - "Sporadic arrivals assumed periodic"
        - "Burst behavior not modeled"
        - "Server capacity inadequate"
      explanation: |
        Aperiodic and sporadic tasks require special analysis methods.
        Treating them as periodic may be incorrect.
      remediation: "Apply appropriate analysis for aperiodic tasks"

    - id: "SCHED-MED-002"
      signal: "Multi-rate dependencies not considered"
      evidence_indicators:
        - "Data age violations possible"
        - "Precedence constraints not modeled"
        - "End-to-end latency not analyzed"
      explanation: |
        Tasks with rate dependencies may have additional timing constraints
        beyond individual deadlines.
      remediation: "Include end-to-end timing analysis"

  low:
    - id: "SCHED-LOW-001"
      signal: "Schedulability model outdated"
      evidence_indicators:
        - "Model does not match implementation"
        - "Parameters not updated after changes"
        - "Version mismatch with code"
      explanation: |
        The analysis model must be kept synchronized with implementation.
        Outdated models provide incorrect results.
      remediation: "Update model to match current implementation"

  positive:
    - id: "SCHED-POS-001"
      signal: "System schedulable with healthy margin"
      evidence_indicators:
        - "Utilization under 70% of bound"
        - "All response times under 80% of deadline"
        - "Room for future growth"

    - id: "SCHED-POS-002"
      signal: "Complete formal schedulability proof"
      evidence_indicators:
        - "All factors included"
        - "Assumptions documented and validated"
        - "Results independently verified"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Build Task Model"
      description: "Create complete task set model with all parameters"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Apply Utilization Test"
      description: "Perform quick schedulability check using utilization bounds"
      duration_estimate: "30 minutes"

    - id: "3"
      name: "Conduct Response Time Analysis"
      description: "Calculate worst-case response times for all tasks"
      duration_estimate: "1-2 hours"

    - id: "4"
      name: "Analyze Blocking Effects"
      description: "Include shared resource blocking in analysis"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Evaluate Margin and Sensitivity"
      description: "Assess robustness to parameter variations"
      duration_estimate: "1 hour"

    - id: "6"
      name: "Document Results"
      description: "Create schedulability analysis report"
      duration_estimate: "30 minutes"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Task Model"
        - "Schedulability Analysis Results"
        - "Margin Analysis"
        - "Recommendations"

closeout_checklist:
  - id: "sched-001"
    item: "Task model complete and accurate"
    level: "CRITICAL"
    verification: "manual"
  - id: "sched-002"
    item: "Schedulability analysis performed"
    level: "CRITICAL"
    verification: "automated"
  - id: "sched-003"
    item: "Blocking effects included"
    level: "HIGH"
    verification: "manual"
  - id: "sched-004"
    item: "Margin analysis completed"
    level: "MEDIUM"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["embedded-systems", "safety-critical", "automotive", "avionics"]

  compliance_mappings:
    - framework: "DO-178C"
      control: "6.3.4"
      description: "Scheduling analysis"
    - framework: "ISO 26262"
      control: "Part 6"
      description: "Software timing"
    - framework: "ARINC 653"
      control: "Partitioning"
      description: "Time partitioning"

relationships:
  commonly_combined:
    - "real-time-embedded.timing-analysis.wcet-analysis"
    - "real-time-embedded.rtos-configuration.scheduler-configuration"
  depends_on:
    - "real-time-embedded.timing-analysis.wcet-analysis"
    - "real-time-embedded.rtos-configuration.task-priority-analysis"
  feeds_into:
    - "safety.functional-safety-analysis"
    - "certification.timing-certification"

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
