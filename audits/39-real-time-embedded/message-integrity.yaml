audit:
  id: real-time-embedded.communication-protocols.message-integrity
  name: Message Integrity Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: communication-protocols
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews message integrity mechanisms including checksums, CRCs, sequence
    numbers, and timeout detection. Examines protection against corruption,
    message loss, duplication, and reordering. Evaluates residual error
    probability for safety-critical communication.
  why_it_matters: |
    Communication errors corrupt data used for control decisions. In safety-
    critical systems, message integrity mechanisms must achieve specified
    residual error probability. CRC selection affects detection capability.
    Sequence numbers catch loss and duplication. Complete integrity requires
    multiple mechanisms working together.
  when_to_run:
  - During protocol design
  - Before safety certification
  - After communication issues
  - When implementing safety protocols
  - For compliance verification
prerequisites:
  required_artifacts:
  - type: protocol_implementation
    description: Message handling source code
  - type: integrity_design
    description: Integrity mechanism documentation
  - type: safety_requirements
    description: Residual error requirements
  - type: error_analysis
    description: Error probability analysis
  access_requirements:
  - Access to source code
  - Protocol analyzer
  - Error injection capability
  - Test environment
discovery:
  file_patterns:
  - glob: '**/crc*.c'
    purpose: Find CRC implementations
  - glob: '**/checksum*.c'
    purpose: Find checksum code
  - glob: '**/integrity*.c'
    purpose: Find integrity checking
  - glob: '**/sequence*.c'
    purpose: Find sequence handling
  - glob: '**/message*.c'
    purpose: Find message handling
knowledge_sources:
  guides:
  - id: crc-selection
    name: CRC Selection Guide
    url: https://www.embedded.com/crc-selection
  - id: safety-comm
    name: Safety Communication Patterns
    url: https://www.embedded.com/safety-communication
  standards:
  - id: iec-61784-3
    name: IEC 61784-3 Functional Safety
    relevance: Safety communication profiles
  - id: iec-61508
    name: IEC 61508 Functional Safety
    relevance: Communication integrity requirements
tooling:
  analysis_tools:
  - tool: error-injector
    purpose: Error injection testing
  - tool: protocol-analyzer
    purpose: Message capture
  - tool: crc-calculator
    purpose: CRC verification
signals:
  critical:
  - id: MI-CRIT-001
    signal: CRC insufficient for safety requirements
    evidence_indicators:
    - CRC polynomial too weak
    - Residual error probability too high
    - HD insufficient for message length
    explanation: |
      Safety-critical communication requires CRC with specified
      Hamming distance and residual error probability.
    remediation: Select CRC with adequate strength for requirements
  - id: MI-CRIT-002
    signal: Lost messages not detected
    evidence_indicators:
    - No sequence numbers
    - No timeout detection
    - Lost data goes unnoticed
    explanation: |
      Lost messages leave gaps in data that must be detected.
      Sequence numbers and timeouts catch message loss.
    remediation: Implement sequence numbers and timeout monitoring
  high:
  - id: MI-HIGH-001
    signal: Duplicate messages not detected
    evidence_indicators:
    - No duplication protection
    - Retries cause duplicates
    - Data applied twice
    explanation: |
      Duplicate messages cause incorrect behavior if not detected.
      Sequence numbers enable duplicate detection.
    remediation: Implement duplicate detection mechanism
  - id: MI-HIGH-002
    signal: Message reordering not handled
    evidence_indicators:
    - Out-of-order messages accepted
    - No sequence checking
    - Old data overwrites new
    explanation: |
      Reordered messages can cause incorrect control if not detected.
      Sequence numbers catch reordering.
    remediation: Implement sequence order verification
  medium:
  - id: MI-MED-001
    signal: CRC implementation incorrect
    evidence_indicators:
    - Polynomial or initialization wrong
    - CRC doesn't match specification
    - Interoperability issues
    explanation: |
      CRC implementation must exactly match specification for proper
      error detection and interoperability.
    remediation: Verify CRC implementation against specification
  - id: MI-MED-002
    signal: Integrity check can be bypassed
    evidence_indicators:
    - Check optional or skippable
    - Error handling path skips check
    - Partial bypass possible
    explanation: |
      Integrity checks must be mandatory on all paths. Bypass
      defeats the protection.
    remediation: Ensure integrity checks cannot be bypassed
  low:
  - id: MI-LOW-001
    signal: Integrity analysis not documented
    evidence_indicators:
    - Residual error not calculated
    - CRC selection rationale missing
    - Mechanism coverage unclear
    explanation: |
      Documentation supports verification and certification.
    remediation: Document integrity mechanism analysis
  positive:
  - id: MI-POS-001
    signal: Comprehensive message integrity
    evidence_indicators:
    - CRC meets requirements
    - Loss, duplication, reorder detected
    - Residual error acceptable
  - id: MI-POS-002
    signal: Properly analyzed integrity mechanisms
    evidence_indicators:
    - Error probability calculated
    - CRC strength verified
    - Coverage documented
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Integrity Requirements
    description: Document residual error and coverage requirements
    duration_estimate: 30 minutes
  - id: '2'
    name: Analyze CRC Implementation
    description: Verify CRC polynomial and implementation
    duration_estimate: 1-2 hours
  - id: '3'
    name: Review Sequence Handling
    description: Check loss, duplication, and reorder detection
    duration_estimate: 1 hour
  - id: '4'
    name: Test Error Detection
    description: Inject errors to verify detection
    duration_estimate: 1-2 hours
  - id: '5'
    name: Calculate Residual Error
    description: Verify error probability meets requirements
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile assessment report
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Integrity Requirements
    - CRC Analysis
    - Error Detection Testing
    - Recommendations
closeout_checklist:
- id: mi-001
  item: Integrity requirements documented
  level: CRITICAL
  verification: manual
- id: mi-002
  item: CRC implementation verified
  level: HIGH
  verification: automated
- id: mi-003
  item: Error detection tested
  level: HIGH
  verification: automated
- id: mi-004
  item: Residual error calculated
  level: HIGH
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - industrial
  compliance_mappings:
  - framework: IEC 61784-3
    control: Communication Integrity
    description: Safety communication
  - framework: IEC 61508
    control: Table A.14
    description: Communication integrity
  - framework: ISO 26262
    control: Part 6
    description: Message integrity
relationships:
  commonly_combined:
  - real-time-embedded.communication-protocols.protocol-timing
  - real-time-embedded.communication-protocols.industrial-protocol-safety
  depends_on:
  - cryptography.crc-analysis
  feeds_into:
  - safety.communication-safety
  - reliability.data-integrity
