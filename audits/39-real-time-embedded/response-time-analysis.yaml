# ============================================================
# AUDIT: Response Time Analysis
# Category: 39 - Real-Time & Embedded Systems
# Subcategory: timing-analysis
# ============================================================

audit:
  id: "real-time-embedded.timing-analysis.response-time-analysis"
  name: "Response Time Analysis Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "real-time-embedded"
  category_number: 39
  subcategory: "timing-analysis"

  tier: "expert"
  estimated_duration: "4-8 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "embedded-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Performs formal response time analysis (RTA) to calculate worst-case response
    times for all tasks in the system. Applies standard RTA equations accounting
    for preemption, blocking, and interference from higher priority tasks.
    Extends basic analysis to include release jitter, execution time variation,
    and multi-core considerations where applicable.

  why_it_matters: |
    Response time analysis provides mathematically rigorous deadline verification.
    Unlike simulation or testing which can only show a subset of scenarios, RTA
    proves timing properties for all possible execution sequences. This is
    essential for safety certification where absence of deadline misses must
    be demonstrated conclusively.

  when_to_run:
    - "After any task parameter changes"
    - "During system design phase"
    - "Before safety certification"
    - "When adding new functionality"
    - "After WCET updates"

prerequisites:
  required_artifacts:
    - type: "task_model"
      description: "Complete task set model with all parameters"
    - type: "wcet_data"
      description: "WCET values for all tasks"
    - type: "blocking_data"
      description: "Maximum blocking times from shared resources"
    - type: "interrupt_model"
      description: "Interrupt handler timing parameters"

  access_requirements:
    - "Access to timing specifications"
    - "Access to RTA calculation tools"
    - "System architecture documentation"
    - "Shared resource documentation"

discovery:
  file_patterns:
    - glob: "**/task_config*.c"
      purpose: "Find task configuration"
    - glob: "**/rtos_config*.h"
      purpose: "Find RTOS configuration"
    - glob: "**/mutex*.c"
      purpose: "Find mutex usage patterns"
    - glob: "**/semaphore*.c"
      purpose: "Find semaphore usage"
    - glob: "**/timing_model*.yaml"
      purpose: "Find timing model specification"

knowledge_sources:
  guides:
    - id: "rta-tutorial"
      name: "Response Time Analysis Tutorial"
      url: "https://www.cs.york.ac.uk/rts/materials/rta.pdf"
    - id: "blocking-analysis"
      name: "Priority Ceiling Protocol Analysis"
      url: "https://ieeexplore.ieee.org/document/57058"

  standards:
    - id: "do-178c"
      name: "DO-178C Software Considerations"
      relevance: "Aviation timing verification"
    - id: "iso-26262"
      name: "ISO 26262 Functional Safety"
      relevance: "Automotive timing proof"

tooling:
  analysis_tools:
    - tool: "cheddar"
      purpose: "Schedulability analysis"
    - tool: "mast"
      purpose: "Response time calculation"
    - tool: "times-tool"
      purpose: "Timing analyzer"
    - tool: "excel-rta"
      purpose: "Custom RTA spreadsheets"

signals:
  critical:
    - id: "RTA-CRIT-001"
      signal: "Response time exceeds deadline"
      evidence_indicators:
        - "Calculated R > D"
        - "Convergence to value above deadline"
        - "No feasible solution exists"
      explanation: |
        When response time analysis shows R > D, the task cannot meet its
        deadline under worst-case conditions. This is a fundamental timing
        failure requiring immediate design changes.
      remediation: "Reduce WCET, increase deadline, or adjust priorities"

    - id: "RTA-CRIT-002"
      signal: "RTA iteration does not converge"
      evidence_indicators:
        - "Fixed point iteration diverges"
        - "Utilization above 100%"
        - "Blocking dominates execution"
      explanation: |
        Non-convergence indicates the system is overloaded and cannot
        guarantee timing for at least one task. The task set is infeasible.
      remediation: "Reduce system load or remove functionality"

  high:
    - id: "RTA-HIGH-001"
      signal: "Response time analysis incomplete"
      evidence_indicators:
        - "Blocking times not included"
        - "Release jitter ignored"
        - "Interrupt overhead missing"
      explanation: |
        Incomplete analysis underestimates true response times. All
        interference sources must be included for valid results.
      remediation: "Complete analysis with all interference factors"

    - id: "RTA-HIGH-002"
      signal: "Minimal deadline margin in analysis"
      evidence_indicators:
        - "Response time over 90% of deadline"
        - "Sensitivity to parameter changes"
        - "No safety margin"
      explanation: |
        Tight margins indicate fragile timing. Small changes in WCET
        or blocking could cause deadline misses.
      remediation: "Optimize to increase margin or adjust requirements"

  medium:
    - id: "RTA-MED-001"
      signal: "Analysis assumptions not validated"
      evidence_indicators:
        - "Task independence assumed but not verified"
        - "Blocking bounds not tight"
        - "WCET estimates uncertain"
      explanation: |
        RTA results are only valid if assumptions hold. Unvalidated
        assumptions weaken the analysis guarantees.
      remediation: "Validate all analysis assumptions with evidence"

    - id: "RTA-MED-002"
      signal: "Multi-core interference not modeled"
      evidence_indicators:
        - "Shared bus contention ignored"
        - "Cache interference missing"
        - "Memory bandwidth constraints"
      explanation: |
        On multi-core systems, interference between cores through shared
        resources must be included in response time calculations.
      remediation: "Extend analysis to include multi-core effects"

  low:
    - id: "RTA-LOW-001"
      signal: "RTA documentation insufficient"
      evidence_indicators:
        - "Calculation steps not recorded"
        - "Input parameters not traceable"
        - "Tool version not documented"
      explanation: |
        Proper documentation is required for certification audits and
        future maintenance of the timing analysis.
      remediation: "Document complete RTA methodology and inputs"

  positive:
    - id: "RTA-POS-001"
      signal: "All response times well below deadlines"
      evidence_indicators:
        - "R < 0.8D for all tasks"
        - "Positive margin throughout"
        - "Robust to parameter variation"

    - id: "RTA-POS-002"
      signal: "Comprehensive RTA with validated assumptions"
      evidence_indicators:
        - "Complete interference model"
        - "All assumptions verified"
        - "Results match measurements"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Gather Task Parameters"
      description: "Collect C, T, D, priority, and jitter for all tasks"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Determine Blocking Times"
      description: "Calculate maximum blocking from shared resources"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Apply RTA Equations"
      description: "Calculate response time for each task iteratively"
      duration_estimate: "2 hours"

    - id: "4"
      name: "Include Additional Factors"
      description: "Add release jitter, interrupt interference, and overheads"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Validate Results"
      description: "Compare calculated response times with measurements"
      duration_estimate: "1-2 hours"

    - id: "6"
      name: "Document Analysis"
      description: "Record methodology, inputs, and results"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Task Model"
        - "Response Time Results"
        - "Sensitivity Analysis"
        - "Recommendations"

closeout_checklist:
  - id: "rta-001"
    item: "All task parameters collected"
    level: "CRITICAL"
    verification: "manual"
  - id: "rta-002"
    item: "Blocking analysis completed"
    level: "HIGH"
    verification: "manual"
  - id: "rta-003"
    item: "RTA calculations verified"
    level: "CRITICAL"
    verification: "automated"
  - id: "rta-004"
    item: "Results validated against measurements"
    level: "HIGH"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["embedded-systems", "safety-critical", "automotive", "avionics"]

  compliance_mappings:
    - framework: "DO-178C"
      control: "6.3.4"
      description: "Timing analysis requirements"
    - framework: "ISO 26262"
      control: "Part 6"
      description: "Software timing verification"

relationships:
  commonly_combined:
    - "real-time-embedded.timing-analysis.wcet-analysis"
    - "real-time-embedded.timing-analysis.deadline-verification"
  depends_on:
    - "real-time-embedded.timing-analysis.wcet-analysis"
    - "real-time-embedded.rtos-configuration.priority-inversion-analysis"
  feeds_into:
    - "safety.functional-safety-verification"
    - "certification.timing-certification"

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
