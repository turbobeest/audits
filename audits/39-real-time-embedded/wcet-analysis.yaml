# ============================================================
# AUDIT: WCET Analysis
# Category: 39 - Real-Time & Embedded Systems
# Subcategory: timing-analysis
# ============================================================

audit:
  id: "real-time-embedded.timing-analysis.wcet-analysis"
  name: "WCET Analysis Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "real-time-embedded"
  category_number: 39
  subcategory: "timing-analysis"

  tier: "expert"
  estimated_duration: "6-12 hours"  # median: 9h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "embedded-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Examines Worst-Case Execution Time (WCET) analysis practices for safety-critical
    embedded systems. Reviews static analysis tools, measurement-based approaches,
    and hybrid methods used to determine upper bounds on execution time. Validates
    that WCET estimates are sound, tight, and appropriate for the target hardware
    including cache behavior, pipeline effects, and memory access patterns.

  why_it_matters: |
    Accurate WCET analysis is fundamental to real-time system correctness. Under-
    estimated WCET leads to deadline misses and potential safety hazards in
    avionics, automotive, and medical devices. Over-estimated WCET wastes
    computational resources and may render designs infeasible. DO-178C, ISO 26262,
    and IEC 61508 all require demonstrated timing analysis for certification.

  when_to_run:
    - "During initial system design"
    - "Before safety certification"
    - "After code or compiler changes"
    - "When changing target hardware"
    - "After optimization passes"

prerequisites:
  required_artifacts:
    - type: "firmware_source"
      description: "Complete embedded source code including all libraries"
    - type: "hardware_specs"
      description: "Target processor documentation and timing characteristics"
    - type: "compiler_info"
      description: "Compiler version and optimization settings"
    - type: "memory_map"
      description: "Memory layout and cache configuration"

  access_requirements:
    - "Access to source code repository"
    - "Access to static WCET analysis tools"
    - "Hardware debug probe for measurement"
    - "Target hardware for validation"

discovery:
  file_patterns:
    - glob: "**/*.c"
      purpose: "Find C source files for analysis"
    - glob: "**/*.h"
      purpose: "Find header files for function signatures"
    - glob: "**/Makefile"
      purpose: "Identify build configuration"
    - glob: "**/*.ld"
      purpose: "Find linker scripts for memory layout"
    - glob: "**/timing_*.c"
      purpose: "Find timing-critical code paths"

knowledge_sources:
  guides:
    - id: "wcet-state-of-art"
      name: "WCET Analysis State of the Art"
      url: "https://www.absint.com/wcet.htm"
    - id: "timing-analysis-guide"
      name: "Timing Analysis for Real-Time Systems"
      url: "https://www.rapitasystems.com/timing-analysis"

  standards:
    - id: "do-178c"
      name: "DO-178C Software Considerations"
      relevance: "Aviation WCET requirements"
    - id: "iso-26262"
      name: "ISO 26262 Functional Safety"
      relevance: "Automotive timing analysis"
    - id: "iec-61508"
      name: "IEC 61508 Functional Safety"
      relevance: "Industrial safety systems"

tooling:
  analysis_tools:
    - tool: "ait-wcet"
      purpose: "AbsInt aiT WCET analyzer"
    - tool: "rapitime"
      purpose: "Rapita measurement-based timing"
    - tool: "bound-t"
      purpose: "Tidorum WCET tool"
    - tool: "chronos"
      purpose: "Open source WCET analyzer"
    - tool: "sweet"
      purpose: "Swedish WCET tool"

signals:
  critical:
    - id: "WCET-CRIT-001"
      signal: "WCET exceeds task period in safety-critical path"
      evidence_indicators:
        - "Analyzed WCET greater than deadline"
        - "Insufficient schedulability margin"
        - "No runtime monitoring for overruns"
      explanation: |
        When WCET exceeds the assigned period, the task cannot guarantee deadline
        compliance. In safety-critical systems this can lead to catastrophic
        failure. Immediate redesign or optimization is required.
      remediation: "Redesign algorithm, optimize code, or adjust scheduling"

    - id: "WCET-CRIT-002"
      signal: "Unbounded loops or recursion in timing-critical code"
      evidence_indicators:
        - "Loop bounds not statically determinable"
        - "Recursive functions without depth limits"
        - "Dynamic memory allocation in critical paths"
      explanation: |
        Unbounded constructs make WCET analysis impossible. Static analyzers
        cannot determine upper bounds, making timing certification infeasible.
      remediation: "Add explicit bounds to all loops and recursion depths"

  high:
    - id: "WCET-HIGH-001"
      signal: "WCET analysis pessimism exceeds 50%"
      evidence_indicators:
        - "Large gap between WCET and measured times"
        - "Infeasible path combinations in analysis"
        - "Overly conservative cache assumptions"
      explanation: |
        Excessive pessimism in WCET analysis wastes computational resources
        and may make feasible designs appear infeasible. Tighter bounds needed.
      remediation: "Provide flow facts, refine cache analysis, use hybrid methods"

    - id: "WCET-HIGH-002"
      signal: "Missing WCET annotations for complex code"
      evidence_indicators:
        - "No loop bound annotations present"
        - "Missing call graph information"
        - "Undefined external function timing"
      explanation: |
        Without proper annotations, WCET tools must make worst-case assumptions
        that may be unrealistic, leading to overly pessimistic results.
      remediation: "Add WCET annotations for loops, calls, and flow constraints"

  medium:
    - id: "WCET-MED-001"
      signal: "Hardware timing model incomplete or outdated"
      evidence_indicators:
        - "Processor model not matching target revision"
        - "Cache configuration mismatch"
        - "Missing peripheral timing data"
      explanation: |
        Inaccurate hardware models lead to incorrect WCET estimates. The timing
        model must accurately reflect the actual target hardware behavior.
      remediation: "Update hardware timing model to match target configuration"

    - id: "WCET-MED-002"
      signal: "Measurement-based WCET lacks coverage"
      evidence_indicators:
        - "Branch coverage below 100%"
        - "Untested input combinations"
        - "Missing worst-case scenarios"
      explanation: |
        Measurement-based WCET requires extensive testing to find worst-case
        paths. Incomplete coverage may miss the true worst case.
      remediation: "Increase test coverage and validate against static analysis"

  low:
    - id: "WCET-LOW-001"
      signal: "WCET analysis documentation incomplete"
      evidence_indicators:
        - "Missing analysis assumptions"
        - "Undocumented flow facts sources"
        - "No traceability to requirements"
      explanation: |
        Complete documentation is required for certification audits and future
        maintenance. All assumptions and constraints must be recorded.
      remediation: "Document all WCET analysis assumptions and methodology"

  positive:
    - id: "WCET-POS-001"
      signal: "All tasks meet timing requirements with margin"
      evidence_indicators:
        - "WCET within 80% of deadline"
        - "Positive schedulability analysis"
        - "Consistent measurement validation"

    - id: "WCET-POS-002"
      signal: "Comprehensive WCET analysis with tight bounds"
      evidence_indicators:
        - "Pessimism under 20%"
        - "Complete flow fact annotations"
        - "Validated hardware model"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Timing-Critical Code Paths"
      description: "Map all functions and code paths with timing requirements"
      duration_estimate: "1-2 hours"

    - id: "2"
      name: "Review WCET Tool Configuration"
      description: "Verify tool settings match target hardware and compiler"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Analyze Loop and Recursion Bounds"
      description: "Verify all loops have determinable upper bounds"
      duration_estimate: "2-3 hours"

    - id: "4"
      name: "Evaluate WCET Results"
      description: "Review WCET estimates against deadline requirements"
      duration_estimate: "1-2 hours"

    - id: "5"
      name: "Validate with Measurements"
      description: "Compare static WCET against measurement-based results"
      duration_estimate: "2-3 hours"

    - id: "6"
      name: "Document Findings and Recommendations"
      description: "Compile analysis results and improvement recommendations"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "WCET Analysis Methodology"
        - "Results by Task"
        - "Schedulability Analysis"
        - "Recommendations"

closeout_checklist:
  - id: "wcet-001"
    item: "All timing-critical paths identified"
    level: "CRITICAL"
    verification: "manual"
  - id: "wcet-002"
    item: "WCET tool configuration verified"
    level: "HIGH"
    verification: "automated"
  - id: "wcet-003"
    item: "All loops bounded"
    level: "CRITICAL"
    verification: "automated"
  - id: "wcet-004"
    item: "Results validated against measurements"
    level: "HIGH"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["embedded-systems", "safety-critical", "automotive", "avionics", "medical-devices"]

  compliance_mappings:
    - framework: "DO-178C"
      control: "6.3.4"
      description: "Timing and scheduling analysis"
    - framework: "ISO 26262"
      control: "Part 6"
      description: "Software timing requirements"
    - framework: "IEC 61508"
      control: "7.4.3"
      description: "Software architecture timing"

relationships:
  commonly_combined:
    - "real-time-embedded.rtos-configuration.scheduler-configuration"
    - "real-time-embedded.timing-analysis.deadline-verification"
  depends_on:
    - "hardware.processor-specs"
    - "build.compiler-configuration"
  feeds_into:
    - "reliability.embedded-reliability"
    - "safety.functional-safety-analysis"

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
