audit:
  id: real-time-embedded.rtos-configuration.timer-management
  name: Timer Management Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: rtos-configuration
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews software timer usage and configuration in RTOS-based systems.
    Examines timer callback implementations, timer task priority, resolution
    versus overhead trade-offs, and proper handling of timer expiration.
    Evaluates one-shot versus periodic timer selection and timer drift
    considerations for long-running applications.
  why_it_matters: |
    Software timers enable time-based functionality without dedicated hardware.
    However, timer callbacks execute in timer task context with timing
    constraints. Long callbacks block other timers. Timer resolution affects
    accuracy. Improper timer use causes timing errors, missed deadlines,
    and excessive CPU utilization.
  when_to_run:
  - When implementing timed features
  - After timing accuracy issues
  - Before timing certification
  - When optimizing CPU usage
  - During RTOS configuration review
prerequisites:
  required_artifacts:
  - type: source_code
    description: Timer-related source code
  - type: rtos_configuration
    description: Timer subsystem configuration
  - type: timing_requirements
    description: Timer accuracy requirements
  - type: callback_implementations
    description: Timer callback source code
  access_requirements:
  - Access to source code
  - Access to RTOS configuration
  - Timing measurement tools
  - Debug/trace capability
discovery:
  file_patterns:
  - glob: '**/timer*.c'
    purpose: Find timer implementations
  - glob: '**/FreeRTOSConfig.h'
    purpose: Find timer configuration
  - glob: '**/callback*.c'
    purpose: Find callback implementations
  - glob: '**/timeout*.c'
    purpose: Find timeout handlers
  - glob: '**/delay*.c'
    purpose: Find delay implementations
knowledge_sources:
  guides:
  - id: freertos-timers
    name: FreeRTOS Software Timers
    url: https://www.freertos.org/RTOS-software-timer.html
  - id: timer-design
    name: Embedded Timer Design Patterns
    url: https://www.embedded.com/timer-design
  standards:
  - id: autosar-os
    name: AUTOSAR OS Alarms
    relevance: Automotive timer model
  - id: osek-alarms
    name: OSEK Alarm Specification
    relevance: OSEK timer model
tooling:
  analysis_tools:
  - tool: tracealyzer
    purpose: Timer visualization
  - tool: oscilloscope
    purpose: Timer accuracy measurement
  - tool: profiler
    purpose: Callback execution time
signals:
  critical:
  - id: TIM-CRIT-001
    signal: Timer callback blocks other timers
    evidence_indicators:
    - Callback execution exceeds tick period
    - Timer queue backup observed
    - Other timers delayed significantly
    explanation: |
      Timer callbacks execute sequentially in timer task. Long callbacks
      delay all pending timers, causing timing errors throughout system.
    remediation: Move long operations from callback to dedicated task
  - id: TIM-CRIT-002
    signal: Timer task priority inappropriate
    evidence_indicators:
    - Critical timers delayed by other tasks
    - Timer task at low priority
    - Timing requirements not met
    explanation: |
      Timer task priority must be set according to timer criticality.
      Low priority causes unpredictable timer delays.
    remediation: Set timer task priority appropriate for timer requirements
  high:
  - id: TIM-HIGH-001
    signal: Timer resolution insufficient for requirements
    evidence_indicators:
    - Tick rate coarser than needed
    - Timer accuracy requirements not met
    - Quantization errors significant
    explanation: |
      Timer resolution is limited by tick rate. Coarse resolution
      causes timing inaccuracy for short intervals.
    remediation: Increase tick rate or use hardware timers
  - id: TIM-HIGH-002
    signal: Timer drift in long-running periodic timers
    evidence_indicators:
    - Cumulative error over time
    - Period variation accumulates
    - Synchronization lost
    explanation: |
      Periodic timers can drift due to execution overhead and
      scheduling delays. Long-running applications accumulate error.
    remediation: Use absolute time references or compensate for drift
  medium:
  - id: TIM-MED-001
    signal: Excessive timer count
    evidence_indicators:
    - Large number of active timers
    - Timer management overhead high
    - Memory consumed by timer structures
    explanation: |
      Large timer counts increase management overhead and memory
      usage. Consider consolidation or alternative approaches.
    remediation: Consolidate timers or use different approach
  - id: TIM-MED-002
    signal: One-shot timer recreation overhead
    evidence_indicators:
    - Frequent timer create/delete cycles
    - Dynamic allocation in timer path
    - Fragmentation from timer structures
    explanation: |
      Recreating one-shot timers adds overhead. Consider using
      auto-reload timers or timer pools.
    remediation: Use timer pools or auto-reload with disable
  low:
  - id: TIM-LOW-001
    signal: Timer usage not documented
    evidence_indicators:
    - Timer purpose unclear
    - Timing requirements not specified
    - Callback behavior undocumented
    explanation: |
      Documentation supports maintenance and helps verify timing
      requirements are met.
    remediation: Document timer usage and requirements
  positive:
  - id: TIM-POS-001
    signal: Timer system well-designed
    evidence_indicators:
    - Callbacks lightweight
    - Resolution appropriate
    - Drift managed
  - id: TIM-POS-002
    signal: Timer configuration optimized
    evidence_indicators:
    - Timer count reasonable
    - Overhead acceptable
    - Requirements met
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Software Timers
    description: Document all timers and their purposes
    duration_estimate: 1 hour
  - id: '2'
    name: Review Timer Configuration
    description: Examine timer subsystem settings
    duration_estimate: 30 minutes
  - id: '3'
    name: Analyze Callback Implementations
    description: Review callback code for length and blocking
    duration_estimate: 1-2 hours
  - id: '4'
    name: Measure Timer Accuracy
    description: Verify timer accuracy meets requirements
    duration_estimate: 1 hour
  - id: '5'
    name: Assess Drift for Periodic Timers
    description: Evaluate long-term timing stability
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile analysis results and recommendations
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Timer Inventory
    - Configuration Review
    - Accuracy Analysis
    - Recommendations
closeout_checklist:
- id: tim-001
  item: All timers inventoried
  level: HIGH
  verification: manual
- id: tim-002
  item: Callbacks reviewed for length
  level: HIGH
  verification: automated
- id: tim-003
  item: Timer accuracy verified
  level: HIGH
  verification: automated
- id: tim-004
  item: Configuration assessed
  level: MEDIUM
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - industrial
  compliance_mappings:
  - framework: AUTOSAR
    control: OS Alarms
    description: Timer requirements
  - framework: DO-178C
    control: 6.3.4
    description: Timing functions
relationships:
  commonly_combined:
  - real-time-embedded.rtos-configuration.scheduler-configuration
  - real-time-embedded.timing-analysis.jitter-measurement
  depends_on:
  - requirements.timing-requirements
  feeds_into:
  - real-time-embedded.timing-analysis.deadline-verification

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
