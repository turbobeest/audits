audit:
  id: real-time-embedded.communication-protocols.serial-protocol-implementation
  name: Serial Protocol Implementation Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: communication-protocols
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews serial communication protocol implementations including UART,
    RS-232, RS-485, SPI, and I2C. Examines hardware configuration, buffer
    management, framing, error handling, and multi-drop addressing for
    half-duplex networks.
  why_it_matters: |
    Serial protocols remain common in embedded systems for sensor interfaces,
    debug ports, and legacy integration. Incorrect configuration causes data
    corruption, timing issues, or communication failures. RS-485 multi-drop
    requires proper turnaround timing. Buffer management affects throughput
    and reliability.
  when_to_run:
  - During peripheral integration
  - After communication issues
  - Before production release
  - When debugging data corruption
  - For interface compliance
prerequisites:
  required_artifacts:
  - type: driver_code
    description: Serial driver source code
  - type: protocol_spec
    description: Protocol specification
  - type: hardware_config
    description: UART/SPI/I2C configuration
  - type: interface_design
    description: Interface documentation
  access_requirements:
  - Access to source code
  - Serial analyzer/sniffer
  - Oscilloscope
  - Test equipment
discovery:
  file_patterns:
  - glob: '**/uart*.c'
    purpose: Find UART driver
  - glob: '**/serial*.c'
    purpose: Find serial code
  - glob: '**/spi*.c'
    purpose: Find SPI driver
  - glob: '**/i2c*.c'
    purpose: Find I2C driver
  - glob: '**/rs485*.c'
    purpose: Find RS-485 code
knowledge_sources:
  guides:
  - id: uart-guide
    name: UART Configuration Guide
    url: https://www.embedded.com/uart-guide
  - id: rs485-guide
    name: RS-485 Design Guide
    url: https://www.embedded.com/rs485
  standards:
  - id: eia-232
    name: EIA/TIA-232
    relevance: RS-232 standard
  - id: eia-485
    name: EIA/TIA-485
    relevance: RS-485 standard
  - id: i2c-spec
    name: I2C Specification
    relevance: I2C standard
tooling:
  analysis_tools:
  - tool: logic-analyzer
    purpose: Signal capture
  - tool: serial-monitor
    purpose: Data capture
  - tool: oscilloscope
    purpose: Signal quality
  - tool: protocol-decoder
    purpose: Protocol analysis
signals:
  critical:
  - id: SPI-CRIT-001
    signal: Data corruption from timing issues
    evidence_indicators:
    - Baud rate mismatch
    - Clock phase/polarity wrong
    - Setup/hold violations
    explanation: |
      Timing errors cause data corruption. Clock configuration must
      match between devices.
    remediation: Verify and correct timing configuration
  - id: SPI-CRIT-002
    signal: Buffer overflow causing data loss
    evidence_indicators:
    - Receive buffer overflow
    - Data lost
    - DMA not keeping up
    explanation: |
      Buffer overflow loses data. Buffer size and processing rate
      must handle worst-case traffic.
    remediation: Increase buffer size or processing rate
  high:
  - id: SPI-HIGH-001
    signal: RS-485 turnaround timing incorrect
    evidence_indicators:
    - Direction switch too slow
    - Collision on multi-drop bus
    - Echoes or garbled data
    explanation: |
      RS-485 requires proper timing for direction switching on
      half-duplex buses to avoid collisions.
    remediation: Configure correct turnaround timing
  - id: SPI-HIGH-002
    signal: Framing errors not handled
    evidence_indicators:
    - Frame errors ignored
    - State machine doesn't recover
    - Protocol hangs on error
    explanation: |
      Framing errors occur from noise or configuration mismatch.
      Protocol must handle and recover from errors.
    remediation: Implement proper framing error recovery
  medium:
  - id: SPI-MED-001
    signal: Flow control not implemented
    evidence_indicators:
    - No RTS/CTS or XON/XOFF
    - Data loss at high rates
    - Buffer overflow possible
    explanation: |
      Flow control prevents buffer overflow at high data rates or
      slow processing.
    remediation: Implement appropriate flow control
  - id: SPI-MED-002
    signal: No parity or error detection
    evidence_indicators:
    - Parity disabled
    - No higher-layer checksum
    - Errors go undetected
    explanation: |
      Some form of error detection is needed to catch corruption.
      Parity or protocol checksum should be used.
    remediation: Enable parity or implement protocol checksum
  low:
  - id: SPI-LOW-001
    signal: Serial configuration not documented
    evidence_indicators:
    - Baud rate not specified
    - Wiring not documented
    - Protocol not described
    explanation: |
      Documentation supports integration and troubleshooting.
    remediation: Document serial interface configuration
  positive:
  - id: SPI-POS-001
    signal: Robust serial implementation
    evidence_indicators:
    - Correct timing configuration
    - Error handling implemented
    - Buffer management appropriate
  - id: SPI-POS-002
    signal: Complete interface documentation
    evidence_indicators:
    - Configuration documented
    - Protocol specified
    - Pinout and wiring clear
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Hardware Configuration
    description: Examine timing and electrical configuration
    duration_estimate: 1 hour
  - id: '2'
    name: Analyze Buffer Management
    description: Review buffer sizes and overflow handling
    duration_estimate: 30 minutes
  - id: '3'
    name: Check Error Handling
    description: Verify error detection and recovery
    duration_estimate: 1 hour
  - id: '4'
    name: Test Signal Quality
    description: Measure signal integrity
    duration_estimate: 1 hour
  - id: '5'
    name: Verify Protocol Operation
    description: Test end-to-end communication
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile assessment report
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Configuration Review
    - Error Handling Analysis
    - Signal Quality
    - Recommendations
closeout_checklist:
- id: spi-001
  item: Hardware configuration reviewed
  level: HIGH
  verification: manual
- id: spi-002
  item: Buffer management analyzed
  level: HIGH
  verification: manual
- id: spi-003
  item: Error handling verified
  level: HIGH
  verification: automated
- id: spi-004
  item: Signal quality tested
  level: MEDIUM
  verification: automated
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - peripheral-interface
    - legacy-integration
  compliance_mappings:
  - framework: EIA-232
    control: Interface Standard
    description: RS-232 compliance
  - framework: EIA-485
    control: Interface Standard
    description: RS-485 compliance
  - framework: I2C
    control: Specification
    description: I2C compliance
relationships:
  commonly_combined:
  - real-time-embedded.communication-protocols.message-integrity
  - hardware.electrical-interface
  depends_on:
  - hardware.serial-peripheral
  feeds_into:
  - communication.interface-reliability
  - debugging.serial-debugging
