audit:
  id: real-time-embedded.rtos-configuration.task-priority-analysis
  name: Task Priority Analysis Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: rtos-configuration
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Analyzes task priority assignments in RTOS-based systems to ensure optimal
    scheduling behavior and deadline compliance. Reviews priority allocation
    methodology including Rate Monotonic, Deadline Monotonic, and criticality-
    based approaches. Examines priority consistency across system modes and
    identifies potential priority-related issues.
  why_it_matters: |
    Correct priority assignment is fundamental to real-time system correctness.
    Improper priorities cause lower-priority tasks to block higher-priority
    tasks, leading to deadline misses. In safety-critical systems, incorrect
    priorities can result in critical functions being delayed by less important
    work, potentially causing hazardous conditions.
  when_to_run:
  - During initial system design
  - After adding new tasks
  - Before safety certification
  - When experiencing timing issues
  - After requirements changes
prerequisites:
  required_artifacts:
  - type: task_specifications
    description: Complete task set with timing requirements
  - type: priority_assignments
    description: Current priority configuration
  - type: criticality_levels
    description: Safety criticality assignments
  - type: rtos_documentation
    description: RTOS scheduler documentation
  access_requirements:
  - Access to source code
  - Access to RTOS configuration
  - System requirements documents
  - Safety analysis artifacts
discovery:
  file_patterns:
  - glob: '**/FreeRTOSConfig.h'
    purpose: Find FreeRTOS configuration
  - glob: '**/priorities.h'
    purpose: Find priority definitions
  - glob: '**/task_config*.c'
    purpose: Find task configuration
  - glob: '**/osconfig.h'
    purpose: Find OS configuration
  - glob: '**/thread_priorities.h'
    purpose: Find thread priorities
knowledge_sources:
  guides:
  - id: rma-priority
    name: Rate Monotonic Priority Assignment
    url: https://www.sei.cmu.edu/reports/93tr023.pdf
  - id: priority-design
    name: Real-Time Priority Design Guide
    url: https://www.freertos.org/RTOS-task-priority.html
  standards:
  - id: autosar
    name: AUTOSAR OS Specification
    relevance: Automotive priority rules
  - id: osek
    name: OSEK/VDX Specification
    relevance: OSEK priority model
  - id: arinc-653
    name: ARINC 653 Specification
    relevance: Aviation partitioning
tooling:
  analysis_tools:
  - tool: cheddar
    purpose: Priority analysis
  - tool: tracealyzer
    purpose: Priority visualization
  - tool: lauterbach-trace
    purpose: Task trace analysis
signals:
  critical:
  - id: TPA-CRIT-001
    signal: Safety-critical task at lower priority than non-critical task
    evidence_indicators:
    - Critical function can be preempted by lower-criticality work
    - Safety function may miss deadline
    - ASIL task blocked by QM task
    explanation: |
      When non-critical tasks can preempt safety-critical tasks, hazardous
      conditions may result from delayed critical responses. This violates
      fundamental safety principles.
    remediation: Reassign priorities to ensure critical tasks are highest
  - id: TPA-CRIT-002
    signal: Priority assignment violates Rate Monotonic optimality
    evidence_indicators:
    - Shorter period task at lower priority
    - Schedulability compromised
    - Suboptimal priority order
    explanation: |
      For fixed-priority systems, Rate Monotonic assignment is optimal.
      Violating this reduces schedulability and may cause deadline misses.
    remediation: Apply Rate Monotonic priority assignment
  high:
  - id: TPA-HIGH-001
    signal: Priority levels exhausted or sparse
    evidence_indicators:
    - All priority levels used
    - No room for new tasks
    - Large priority gaps
    explanation: |
      Limited priority levels constrain future expansion. Sparse usage
      wastes available scheduling flexibility.
    remediation: Consolidate or redistribute priority levels
  - id: TPA-HIGH-002
    signal: Multiple tasks sharing same priority without rationale
    evidence_indicators:
    - Tasks at same priority compete for CPU
    - Round-robin among unrelated tasks
    - No documented justification
    explanation: |
      Same-priority tasks time-share, which may not match requirements.
      This should be intentional, not accidental.
    remediation: Review and justify priority sharing or differentiate
  medium:
  - id: TPA-MED-001
    signal: Priority assignment methodology not documented
    evidence_indicators:
    - No priority allocation rationale
    - Assignment appears ad-hoc
    - Traceability to requirements missing
    explanation: |
      Without documented methodology, priority decisions cannot be
      reviewed or maintained effectively.
    remediation: Document priority assignment methodology and rationale
  - id: TPA-MED-002
    signal: Mode-dependent priorities inconsistent
    evidence_indicators:
    - Priorities change between modes
    - Transition timing unclear
    - Potential race conditions
    explanation: |
      Dynamic priority changes must be carefully managed to avoid
      timing anomalies during transitions.
    remediation: Analyze mode transition timing behavior
  low:
  - id: TPA-LOW-001
    signal: Priority naming convention unclear
    evidence_indicators:
    - Priority values not descriptive
    - Magic numbers in code
    - No priority level documentation
    explanation: |
      Clear naming improves maintainability and reduces errors when
      modifying priority assignments.
    remediation: Define named constants for priority levels
  positive:
  - id: TPA-POS-001
    signal: Well-structured priority assignment
    evidence_indicators:
    - Follows Rate Monotonic or documented alternative
    - Critical tasks highest priority
    - Adequate margin for growth
  - id: TPA-POS-002
    signal: Priority design fully documented
    evidence_indicators:
    - Methodology explained
    - All assignments justified
    - Traceable to requirements
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory All Tasks and Priorities
    description: Document all tasks with current priority assignments
    duration_estimate: 1 hour
  - id: '2'
    name: Map to Timing Requirements
    description: Associate tasks with periods, deadlines, and criticality
    duration_estimate: 30 minutes
  - id: '3'
    name: Evaluate Assignment Methodology
    description: Assess if priorities follow valid allocation scheme
    duration_estimate: 1 hour
  - id: '4'
    name: Check Criticality Alignment
    description: Verify safety-critical tasks have appropriate priority
    duration_estimate: 1 hour
  - id: '5'
    name: Analyze Priority Interactions
    description: Identify potential preemption and blocking issues
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile analysis results and recommendations
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Task Priority Inventory
    - Methodology Assessment
    - Issues Identified
    - Recommendations
closeout_checklist:
- id: tpa-001
  item: All tasks and priorities documented
  level: HIGH
  verification: manual
- id: tpa-002
  item: Priority methodology evaluated
  level: HIGH
  verification: manual
- id: tpa-003
  item: Criticality alignment verified
  level: CRITICAL
  verification: manual
- id: tpa-004
  item: Interactions analyzed
  level: MEDIUM
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - automotive
    - avionics
  compliance_mappings:
  - framework: ISO 26262
    control: Part 6
    description: Software architecture design
  - framework: DO-178C
    control: 5.2.2
    description: Software design
  - framework: AUTOSAR
    control: OS
    description: Task configuration
relationships:
  commonly_combined:
  - real-time-embedded.timing-analysis.schedulability-analysis
  - real-time-embedded.rtos-configuration.priority-inversion-analysis
  depends_on:
  - requirements.timing-requirements
  - safety.criticality-analysis
  feeds_into:
  - real-time-embedded.timing-analysis.deadline-verification
  - safety.functional-safety-analysis
