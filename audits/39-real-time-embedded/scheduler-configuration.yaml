audit:
  id: real-time-embedded.rtos-configuration.scheduler-configuration
  name: Scheduler Configuration Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: rtos-configuration
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews RTOS scheduler configuration including scheduling algorithm selection,
    tick rate, time slice duration, and preemption settings. Evaluates scheduler
    overhead impact on system timing, hook function usage, and configuration
    parameter appropriateness for the application workload.
  why_it_matters: |
    Scheduler configuration directly affects timing predictability, CPU overhead,
    and responsiveness. Incorrect tick rate wastes CPU cycles or reduces timing
    resolution. Inappropriate preemption settings can cause priority inversion
    or excessive context switching. Proper configuration balances overhead
    against timing requirements.
  when_to_run:
  - During initial RTOS setup
  - After performance issues
  - Before timing analysis
  - When optimizing CPU usage
  - After RTOS version updates
prerequisites:
  required_artifacts:
  - type: rtos_configuration
    description: RTOS configuration files
  - type: timing_requirements
    description: Application timing requirements
  - type: task_specifications
    description: Task characteristics and needs
  - type: hardware_specs
    description: Target timer capabilities
  access_requirements:
  - Access to RTOS configuration
  - Access to source code
  - Timing measurement tools
  - Hardware documentation
discovery:
  file_patterns:
  - glob: '**/FreeRTOSConfig.h'
    purpose: Find FreeRTOS configuration
  - glob: '**/rtosconfig.h'
    purpose: Find RTOS configuration
  - glob: '**/os_cfg.h'
    purpose: Find uC/OS configuration
  - glob: '**/kernel_config.h'
    purpose: Find kernel configuration
  - glob: '**/scheduler*.c'
    purpose: Find scheduler customizations
knowledge_sources:
  guides:
  - id: freertos-config
    name: FreeRTOS Configuration Guide
    url: https://www.freertos.org/a00110.html
  - id: rtos-scheduling
    name: RTOS Scheduling Algorithms
    url: https://www.embedded.com/rtos-scheduling
  standards:
  - id: autosar-os
    name: AUTOSAR OS Specification
    relevance: Automotive scheduler requirements
  - id: osek-os
    name: OSEK OS Specification
    relevance: OSEK scheduler model
  - id: posix-scheduling
    name: POSIX Real-Time Scheduling
    relevance: POSIX scheduler policies
tooling:
  analysis_tools:
  - tool: tracealyzer
    purpose: Visualize scheduler behavior
  - tool: systemview
    purpose: Real-time scheduler analysis
  - tool: profiler
    purpose: Measure scheduler overhead
signals:
  critical:
  - id: SCH-CRIT-001
    signal: Scheduler tick rate too low for timing requirements
    evidence_indicators:
    - Tick period > minimum required resolution
    - Timer-based delays inaccurate
    - Deadline granularity insufficient
    explanation: |
      When tick rate is lower than required timing resolution, delays
      and timeouts become inaccurate, potentially causing deadline misses
      or inefficient polling.
    remediation: Increase tick rate to match timing requirements
  - id: SCH-CRIT-002
    signal: Preemption disabled in fixed-priority system
    evidence_indicators:
    - Cooperative scheduling with priority tasks
    - High-priority tasks wait for yield
    - Response time analysis invalid
    explanation: |
      Disabling preemption in systems requiring priority-based scheduling
      defeats the purpose of priorities. High-priority tasks cannot
      preempt lower-priority tasks.
    remediation: Enable preemptive scheduling or redesign for cooperative
  high:
  - id: SCH-HIGH-001
    signal: Scheduler overhead excessive
    evidence_indicators:
    - Tick handler consumes >1% CPU
    - Context switch time excessive
    - Overhead impacts timing budget
    explanation: |
      High scheduler overhead reduces available CPU for application
      tasks and must be accounted for in timing analysis.
    remediation: Reduce tick rate, optimize hooks, or use different RTOS
  - id: SCH-HIGH-002
    signal: Time slicing misconfigured for application
    evidence_indicators:
    - Time slice too short causing thrashing
    - Time slice too long starving tasks
    - Round-robin behavior unexpected
    explanation: |
      Time slice configuration affects same-priority task behavior
      and must match application requirements.
    remediation: Tune time slice for application workload
  medium:
  - id: SCH-MED-001
    signal: Idle hook blocking or performing lengthy operations
    evidence_indicators:
    - Idle hook has long execution time
    - Power management issues
    - Responsiveness degraded
    explanation: |
      Idle hook should be lightweight. Heavy operations delay task
      resumption and affect power management.
    remediation: Move lengthy operations to dedicated task
  - id: SCH-MED-002
    signal: Tick hook adds significant overhead
    evidence_indicators:
    - Tick hook execution time high
    - Overhead added to every tick
    - Cumulative impact significant
    explanation: |
      Tick hook runs at tick rate, so even moderate execution time
      accumulates to significant overhead.
    remediation: Minimize tick hook or move work to task
  low:
  - id: SCH-LOW-001
    signal: Scheduler configuration not documented
    evidence_indicators:
    - Configuration rationale missing
    - Default values used without review
    - No timing overhead analysis
    explanation: |
      Configuration decisions should be documented for maintenance
      and to support timing analysis.
    remediation: Document scheduler configuration rationale
  positive:
  - id: SCH-POS-001
    signal: Scheduler configuration optimized for application
    evidence_indicators:
    - Tick rate matches requirements
    - Overhead acceptable
    - Configuration justified
  - id: SCH-POS-002
    signal: Scheduler overhead characterized and documented
    evidence_indicators:
    - Context switch time measured
    - Tick handler overhead known
    - Included in timing analysis
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Scheduler Configuration
    description: Examine all scheduler-related configuration parameters
    duration_estimate: 1 hour
  - id: '2'
    name: Assess Timing Requirements Match
    description: Verify configuration supports timing requirements
    duration_estimate: 30 minutes
  - id: '3'
    name: Measure Scheduler Overhead
    description: Quantify tick handler and context switch overhead
    duration_estimate: 1 hour
  - id: '4'
    name: Analyze Hook Functions
    description: Review idle, tick, and other hook implementations
    duration_estimate: 30 minutes
  - id: '5'
    name: Evaluate Preemption Settings
    description: Verify preemption configuration is appropriate
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile analysis results and recommendations
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Configuration Review
    - Overhead Analysis
    - Timing Impact Assessment
    - Recommendations
closeout_checklist:
- id: sch-001
  item: Scheduler configuration reviewed
  level: HIGH
  verification: manual
- id: sch-002
  item: Overhead measured
  level: HIGH
  verification: automated
- id: sch-003
  item: Hook functions analyzed
  level: MEDIUM
  verification: manual
- id: sch-004
  item: Preemption settings verified
  level: HIGH
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - automotive
    - industrial
  compliance_mappings:
  - framework: AUTOSAR
    control: OS Configuration
    description: OS parameter settings
  - framework: DO-178C
    control: 6.3.1
    description: Software architecture
  - framework: IEC 61508
    control: 7.4.5
    description: Software module testing
relationships:
  commonly_combined:
  - real-time-embedded.timing-analysis.schedulability-analysis
  - real-time-embedded.rtos-configuration.task-priority-analysis
  depends_on:
  - requirements.timing-requirements
  feeds_into:
  - real-time-embedded.timing-analysis.deadline-verification
  - performance.cpu-utilization
