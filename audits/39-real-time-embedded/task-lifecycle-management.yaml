audit:
  id: real-time-embedded.rtos-configuration.task-lifecycle-management
  name: Task Lifecycle Management Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: rtos-configuration
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Reviews task creation, deletion, suspension, and state transition patterns.
    Examines resource cleanup during task termination, proper initialization
    sequences, and handling of task state changes. Evaluates static versus
    dynamic task creation approaches and their implications for determinism
    and memory management.
  why_it_matters: |
    Improper task lifecycle management causes resource leaks, orphaned
    resources, and undefined behavior. Dynamic task creation in real-time
    paths introduces non-determinism. Incomplete cleanup during task deletion
    leaks memory and handles. Well-managed task lifecycle ensures predictable
    behavior and resource conservation.
  when_to_run:
  - During system architecture design
  - After adding dynamic task creation
  - When debugging resource issues
  - Before safety certification
  - During code review
prerequisites:
  required_artifacts:
  - type: source_code
    description: Task implementation source code
  - type: architecture_docs
    description: Task architecture documentation
  - type: rtos_api
    description: RTOS task API documentation
  - type: memory_map
    description: Task stack and memory allocation
  access_requirements:
  - Access to source code
  - Access to RTOS documentation
  - Memory debugging tools
  - Runtime monitoring capability
discovery:
  file_patterns:
  - glob: '**/task*.c'
    purpose: Find task implementations
  - glob: '**/thread*.c'
    purpose: Find thread implementations
  - glob: '**/create_task*.c'
    purpose: Find task creation code
  - glob: '**/init*.c'
    purpose: Find initialization code
  - glob: '**/main.c'
    purpose: Find main task creation
knowledge_sources:
  guides:
  - id: freertos-tasks
    name: FreeRTOS Task Management
    url: https://www.freertos.org/a00019.html
  - id: task-design
    name: Embedded Task Design Patterns
    url: https://www.embedded.com/task-design
  standards:
  - id: autosar-os
    name: AUTOSAR OS Tasks
    relevance: Automotive task model
  - id: osek-tasks
    name: OSEK Task Specification
    relevance: OSEK task model
  - id: posix-threads
    name: POSIX Threads
    relevance: POSIX thread lifecycle
tooling:
  analysis_tools:
  - tool: tracealyzer
    purpose: Task lifecycle visualization
  - tool: valgrind
    purpose: Memory leak detection
  - tool: pc-lint
    purpose: Static task analysis
signals:
  critical:
  - id: TLC-CRIT-001
    signal: Resource leak on task deletion
    evidence_indicators:
    - Memory not freed before task delete
    - Handles not released
    - Growing memory usage over time
    explanation: |
      Resource leaks accumulate over time, eventually exhausting
      system resources and causing failures.
    remediation: Implement proper cleanup before task deletion
  - id: TLC-CRIT-002
    signal: Task creation in time-critical path
    evidence_indicators:
    - xTaskCreate called in real-time code
    - Non-deterministic timing from creation
    - Memory allocation during operation
    explanation: |
      Task creation involves memory allocation and initialization
      with variable timing. This is inappropriate for real-time paths.
    remediation: Create tasks at startup, not during operation
  high:
  - id: TLC-HIGH-001
    signal: Task deletion leaves orphaned resources
    evidence_indicators:
    - Owned mutexes not released
    - Queues with pending messages abandoned
    - Timers left active
    explanation: |
      Orphaned resources can block other tasks or continue executing
      callbacks with invalid context.
    remediation: Release all owned resources before task deletion
  - id: TLC-HIGH-002
    signal: Self-deletion without proper cleanup
    evidence_indicators:
    - Task deletes itself
    - Stack and TCB not freed
    - No external cleanup mechanism
    explanation: |
      When a task deletes itself, it cannot free its own stack and
      TCB. An external mechanism is required.
    remediation: Use idle task cleanup or dedicated deletion task
  medium:
  - id: TLC-MED-001
    signal: Task suspension used inappropriately
    evidence_indicators:
    - Tasks suspended indefinitely
    - Suspension used for synchronization
    - Priority inversion from suspension
    explanation: |
      Task suspension is a blunt mechanism that can cause deadlock
      if the suspended task holds resources. Use proper synchronization.
    remediation: Replace suspension with proper synchronization
  - id: TLC-MED-002
    signal: Inconsistent task initialization
    evidence_indicators:
    - No standard init pattern
    - Order-dependent initialization
    - Race during startup
    explanation: |
      Inconsistent initialization can cause startup races and
      order-dependent failures.
    remediation: Implement systematic initialization sequence
  low:
  - id: TLC-LOW-001
    signal: Task lifecycle not documented
    evidence_indicators:
    - State transitions unclear
    - Creation/deletion points not documented
    - Resource ownership ambiguous
    explanation: |
      Documentation supports maintenance and prevents errors
      when modifying task structure.
    remediation: Document task lifecycle and state transitions
  positive:
  - id: TLC-POS-001
    signal: Static task creation at startup
    evidence_indicators:
    - All tasks created during init
    - No dynamic creation during operation
    - Deterministic task set
  - id: TLC-POS-002
    signal: Clean task lifecycle management
    evidence_indicators:
    - Proper resource cleanup
    - Consistent patterns
    - Well-documented lifecycle
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Tasks and Creation Points
    description: Document all tasks and where they are created
    duration_estimate: 1 hour
  - id: '2'
    name: Analyze Lifecycle Patterns
    description: Review creation, deletion, and state changes
    duration_estimate: 1-2 hours
  - id: '3'
    name: Check Resource Cleanup
    description: Verify proper cleanup on task termination
    duration_estimate: 1 hour
  - id: '4'
    name: Review Initialization Sequence
    description: Assess startup order and dependencies
    duration_estimate: 30 minutes
  - id: '5'
    name: Verify Dynamic Behavior
    description: Check for runtime task creation/deletion
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile analysis results and recommendations
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Task Inventory
    - Lifecycle Analysis
    - Resource Management
    - Recommendations
closeout_checklist:
- id: tlc-001
  item: All tasks inventoried
  level: HIGH
  verification: manual
- id: tlc-002
  item: Lifecycle patterns analyzed
  level: HIGH
  verification: manual
- id: tlc-003
  item: Resource cleanup verified
  level: HIGH
  verification: automated
- id: tlc-004
  item: Initialization sequence reviewed
  level: MEDIUM
  verification: manual
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - resource-constrained
  compliance_mappings:
  - framework: AUTOSAR
    control: OS Tasks
    description: Task management
  - framework: DO-178C
    control: 6.3.1
    description: Software architecture
  - framework: MISRA C
    control: Dir 4.12
    description: Dynamic memory
relationships:
  commonly_combined:
  - real-time-embedded.memory-management.static-allocation-analysis
  - real-time-embedded.rtos-configuration.task-synchronization-review
  depends_on:
  - architecture.task-design
  feeds_into:
  - reliability.resource-management
  - memory.leak-prevention

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
