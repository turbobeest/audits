audit:
  id: real-time-embedded.communication-protocols.protocol-error-handling
  name: Protocol Error Handling Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: communication-protocols
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates error handling in communication protocols including timeout
    management, retry strategies, error recovery, and notification mechanisms.
    Reviews how communication failures are detected, reported, and recovered
    from without system-wide impact.
  why_it_matters: |
    Communication errors are inevitable - noise, disconnections, and device
    failures occur. Proper error handling maintains system operation during
    transient errors and enables graceful degradation for persistent failures.
    Poor error handling causes system hangs, cascading failures, or silent
    data corruption.
  when_to_run:
  - During protocol implementation
  - When debugging communication issues
  - Before production deployment
  - After reliability issues
  - For robustness testing
prerequisites:
  required_artifacts:
  - type: protocol_implementation
    description: Protocol stack source code
  - type: error_handling_design
    description: Error handling documentation
  - type: requirements
    description: Error behavior requirements
  - type: test_procedures
    description: Error injection tests
  access_requirements:
  - Access to source code
  - Error injection capability
  - Protocol analyzer
  - Test environment
discovery:
  file_patterns:
  - glob: '**/error*.c'
    purpose: Find error handling code
  - glob: '**/retry*.c'
    purpose: Find retry logic
  - glob: '**/timeout*.c'
    purpose: Find timeout handling
  - glob: '**/recovery*.c'
    purpose: Find recovery code
  - glob: '**/protocol*.c'
    purpose: Find protocol implementation
knowledge_sources:
  guides:
  - id: protocol-error-handling
    name: Protocol Error Handling Patterns
    url: https://www.embedded.com/error-handling
  - id: retry-strategies
    name: Communication Retry Strategies
    url: https://www.embedded.com/retry-strategies
  standards:
  - id: iec-61131
    name: IEC 61131
    relevance: PLC communication error handling
  - id: autosar-com
    name: AUTOSAR COM
    relevance: Automotive error handling
tooling:
  analysis_tools:
  - tool: error-injector
    purpose: Fault injection
  - tool: protocol-analyzer
    purpose: Error monitoring
  - tool: debugger
    purpose: Error path debugging
signals:
  critical:
  - id: PEH-CRIT-001
    signal: Error causes system hang
    evidence_indicators:
    - Infinite wait on error
    - No timeout on blocking call
    - System unresponsive
    explanation: |
      Communication errors must not cause system hangs. All blocking
      operations need timeouts.
    remediation: Add timeouts to all blocking protocol operations
  - id: PEH-CRIT-002
    signal: Errors corrupt system state
    evidence_indicators:
    - Partial data accepted
    - State machine stuck
    - Invalid data used
    explanation: |
      Error handling must ensure system remains in consistent state.
      Partial or corrupted data must be rejected.
    remediation: Ensure atomic operations and state consistency
  high:
  - id: PEH-HIGH-001
    signal: No retry mechanism
    evidence_indicators:
    - Single attempt only
    - Transient errors cause failure
    - No retry strategy
    explanation: |
      Transient errors are common. Retry mechanisms recover from
      most transient failures.
    remediation: Implement appropriate retry strategy
  - id: PEH-HIGH-002
    signal: Retry storm possible
    evidence_indicators:
    - Unlimited retries
    - No backoff
    - Network congestion from retries
    explanation: |
      Unlimited retries with no backoff can overload the network
      and prevent recovery.
    remediation: Implement retry limits and exponential backoff
  medium:
  - id: PEH-MED-001
    signal: Error not reported to application
    evidence_indicators:
    - Errors handled silently
    - Application unaware of failures
    - No error status
    explanation: |
      Applications may need to take action on communication errors.
      Error status should be available.
    remediation: Report error status to application layer
  - id: PEH-MED-002
    signal: No connection health monitoring
    evidence_indicators:
    - No heartbeat or keep-alive
    - Dead connection undetected
    - Silent failure possible
    explanation: |
      Inactive connections may fail silently. Health monitoring
      detects failed connections.
    remediation: Implement connection health monitoring
  low:
  - id: PEH-LOW-001
    signal: Error handling not documented
    evidence_indicators:
    - Error behavior unclear
    - Retry policy not specified
    - Timeout values not documented
    explanation: |
      Documentation supports debugging and maintenance.
    remediation: Document error handling behavior and configuration
  positive:
  - id: PEH-POS-001
    signal: Comprehensive error handling
    evidence_indicators:
    - All errors handled
    - Appropriate retry strategy
    - No system impact
  - id: PEH-POS-002
    signal: Graceful degradation on errors
    evidence_indicators:
    - Partial operation continues
    - Error recovery automatic
    - Application notified
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Error Scenarios
    description: Document all possible error conditions
    duration_estimate: 1 hour
  - id: '2'
    name: Review Error Handling Code
    description: Examine error handling implementation
    duration_estimate: 1-2 hours
  - id: '3'
    name: Analyze Retry Strategy
    description: Review retry mechanism and limits
    duration_estimate: 30 minutes
  - id: '4'
    name: Test Error Scenarios
    description: Inject errors and verify handling
    duration_estimate: 1-2 hours
  - id: '5'
    name: Check System Impact
    description: Verify errors don't affect other functions
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile assessment report
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Error Scenario Inventory
    - Handling Code Review
    - Test Results
    - Recommendations
closeout_checklist:
- id: peh-001
  item: Error scenarios inventoried
  level: HIGH
  verification: manual
- id: peh-002
  item: Handling code reviewed
  level: HIGH
  verification: manual
- id: peh-003
  item: Error scenarios tested
  level: CRITICAL
  verification: automated
- id: peh-004
  item: System impact verified
  level: HIGH
  verification: automated
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - networked-systems
    - control-systems
  compliance_mappings:
  - framework: IEC 61508
    control: 7.4.4
    description: Error handling
  - framework: AUTOSAR
    control: COM Error Handling
    description: Communication errors
  - framework: DO-178C
    control: 6.3.5
    description: Error detection and handling
relationships:
  commonly_combined:
  - real-time-embedded.communication-protocols.message-integrity
  - real-time-embedded.watchdog-recovery.fault-detection
  depends_on:
  - requirements.error-handling-requirements
  feeds_into:
  - reliability.communication-reliability
  - robustness.fault-tolerance
