audit:
  id: real-time-embedded.interrupt-handling.interrupt-storm-protection
  name: Interrupt Storm Protection Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: real-time-embedded
  category_number: 39
  subcategory: interrupt-handling
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: embedded-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates protection mechanisms against interrupt storms where interrupts
    arrive at excessive rates potentially starving the system. Reviews rate
    limiting, interrupt coalescing, adaptive disable mechanisms, and recovery
    from storm conditions.
  why_it_matters: |
    Interrupt storms can occur from hardware faults, electrical noise, or
    software bugs. Without protection, storms consume all CPU time in ISRs,
    starving tasks completely. The system appears hung even though interrupts
    are being serviced. Proper protection maintains system functionality during
    abnormal conditions.
  when_to_run:
  - During interrupt architecture review
  - After reliability issues
  - When implementing fault tolerance
  - Before safety certification
  - After adding interrupt sources
prerequisites:
  required_artifacts:
  - type: interrupt_architecture
    description: Interrupt handling design
  - type: source_code
    description: ISR implementations
  - type: fault_requirements
    description: Fault handling requirements
  - type: rate_specifications
    description: Expected interrupt rates
  access_requirements:
  - Access to source code
  - Hardware fault injection capability
  - Interrupt rate monitoring
  - System behavior observation
discovery:
  file_patterns:
  - glob: '**/isr*.c'
    purpose: Find ISR implementations
  - glob: '**/interrupt_monitor*.c'
    purpose: Find rate monitoring
  - glob: '**/rate_limit*.c'
    purpose: Find rate limiting code
  - glob: '**/fault_handler*.c'
    purpose: Find fault handling
  - glob: '**/error_recovery*.c'
    purpose: Find recovery mechanisms
knowledge_sources:
  guides:
  - id: interrupt-storms
    name: Handling Interrupt Storms
    url: https://www.embedded.com/interrupt-storms
  - id: fault-tolerance
    name: Fault-Tolerant Interrupt Design
    url: https://www.embedded.com/fault-tolerant-interrupts
  standards:
  - id: iec-61508
    name: IEC 61508 Functional Safety
    relevance: Fault tolerance requirements
  - id: iso-26262
    name: ISO 26262 Functional Safety
    relevance: Fault handling
tooling:
  analysis_tools:
  - tool: fault-injector
    purpose: Simulate interrupt storms
  - tool: tracealyzer
    purpose: Monitor interrupt rates
  - tool: oscilloscope
    purpose: Measure interrupt frequency
signals:
  critical:
  - id: ISP-CRIT-001
    signal: No interrupt storm protection exists
    evidence_indicators:
    - No rate limiting
    - No adaptive disable
    - System hangs under storm
    explanation: |
      Without protection, interrupt storms render the system
      unresponsive by consuming all CPU time in ISR processing.
    remediation: Implement interrupt rate monitoring and limiting
  - id: ISP-CRIT-002
    signal: Storm condition not detected or logged
    evidence_indicators:
    - No rate monitoring
    - Storm goes unnoticed
    - No diagnostic information
    explanation: |
      Undetected storms mask underlying hardware or software problems.
      Detection enables diagnosis and recovery.
    remediation: Add interrupt rate monitoring and alerting
  high:
  - id: ISP-HIGH-001
    signal: Protection too slow to prevent impact
    evidence_indicators:
    - Significant processing before limit kicks in
    - Tasks starved during detection period
    - Recovery delayed
    explanation: |
      Slow detection allows significant system impact before
      protection activates. Detection must be fast.
    remediation: Reduce detection latency
  - id: ISP-HIGH-002
    signal: Critical interrupts disabled during protection
    evidence_indicators:
    - All interrupts disabled
    - Safety-critical interrupt blocked
    - System unsafe during protection
    explanation: |
      Protection should not disable safety-critical interrupts.
      Selective protection needed.
    remediation: Exempt critical interrupts from blanket disable
  medium:
  - id: ISP-MED-001
    signal: Recovery from storm not automatic
    evidence_indicators:
    - Interrupt stays disabled after storm
    - Manual intervention required
    - Service degraded permanently
    explanation: |
      Automatic recovery enables system to resume normal operation
      after transient storm conditions clear.
    remediation: Implement automatic re-enable with backoff
  - id: ISP-MED-002
    signal: Storm source not identified
    evidence_indicators:
    - Which interrupt unclear
    - Aggregate monitoring only
    - Debugging difficult
    explanation: |
      Identifying the storm source enables targeted response
      and root cause diagnosis.
    remediation: Monitor individual interrupt sources
  low:
  - id: ISP-LOW-001
    signal: Storm protection not documented
    evidence_indicators:
    - Protection thresholds not specified
    - Behavior not described
    - Configuration not explained
    explanation: |
      Documentation supports configuration tuning and helps
      diagnose protection behavior.
    remediation: Document storm protection design and thresholds
  positive:
  - id: ISP-POS-001
    signal: Comprehensive storm protection
    evidence_indicators:
    - Rate monitoring active
    - Selective protection
    - Automatic recovery
  - id: ISP-POS-002
    signal: Storm conditions logged and alarmed
    evidence_indicators:
    - Detection triggers alert
    - Source identified
    - Event logged for diagnosis
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Protection Mechanisms
    description: Document existing storm protection
    duration_estimate: 1 hour
  - id: '2'
    name: Analyze Rate Monitoring
    description: Review interrupt rate tracking implementation
    duration_estimate: 30 minutes
  - id: '3'
    name: Test Storm Behavior
    description: Inject storm conditions and observe response
    duration_estimate: 1-2 hours
  - id: '4'
    name: Verify Critical Interrupt Handling
    description: Ensure critical interrupts remain functional
    duration_estimate: 30 minutes
  - id: '5'
    name: Check Recovery Mechanisms
    description: Verify system recovers from storm
    duration_estimate: 30 minutes
  - id: '6'
    name: Document Findings
    description: Compile analysis results and recommendations
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Protection Mechanism Review
    - Storm Testing Results
    - Recovery Analysis
    - Recommendations
closeout_checklist:
- id: isp-001
  item: Protection mechanisms reviewed
  level: HIGH
  verification: manual
- id: isp-002
  item: Storm behavior tested
  level: HIGH
  verification: automated
- id: isp-003
  item: Critical interrupt handling verified
  level: CRITICAL
  verification: manual
- id: isp-004
  item: Recovery tested
  level: HIGH
  verification: automated
governance:
  applicable_to:
    archetypes:
    - embedded-systems
    - safety-critical
    - fault-tolerant
  compliance_mappings:
  - framework: IEC 61508
    control: 7.4.4
    description: Fault tolerance
  - framework: ISO 26262
    control: Part 5
    description: Hardware fault handling
  - framework: DO-178C
    control: 6.3.5
    description: Error handling
relationships:
  commonly_combined:
  - real-time-embedded.watchdog-recovery.fault-detection
  - real-time-embedded.interrupt-handling.interrupt-priority-configuration
  depends_on:
  - requirements.fault-tolerance-requirements
  feeds_into:
  - reliability.fault-tolerance
  - safety.fault-handling

# Glossary of domain-specific terms:
glossary:
  "WCET": "Worst-Case Execution Time - maximum possible execution time for a code path"
  "ISR": "Interrupt Service Routine - function executed in response to hardware interrupt"
  "jitter": "Variation in timing between expected and actual execution"
