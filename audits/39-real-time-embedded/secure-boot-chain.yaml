# ============================================================
# AUDIT: Secure Boot Chain
# Category: 39 - Real-Time & Embedded Systems
# Subcategory: bootloader-security
# ============================================================

audit:
  id: "real-time-embedded.bootloader-security.secure-boot-chain"
  name: "Secure Boot Chain Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "real-time-embedded"
  category_number: 39
  subcategory: "bootloader-security"

  tier: "expert"
  estimated_duration: "6-10 hours"  # median: 8h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "embedded-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the secure boot implementation including hardware root of trust,
    boot stage verification, chain of trust establishment, and anti-rollback
    mechanisms. Reviews cryptographic implementations, key storage, and
    verification failure handling throughout the boot sequence.

  why_it_matters: |
    Secure boot prevents execution of unauthorized or malicious code by verifying
    each boot stage before execution. A compromised boot chain allows attackers
    to persist through power cycles and bypass all higher-level security.
    Automotive, industrial, and IoT devices increasingly require secure boot
    for safety and cybersecurity compliance.

  when_to_run:
    - "During security architecture review"
    - "Before security certification"
    - "After bootloader changes"
    - "When implementing secure boot"
    - "For penetration testing preparation"

prerequisites:
  required_artifacts:
    - type: "bootloader_source"
      description: "Complete bootloader source code"
    - type: "boot_architecture"
      description: "Boot chain design documentation"
    - type: "crypto_specs"
      description: "Cryptographic implementation specs"
    - type: "key_management"
      description: "Key storage and provisioning documentation"

  access_requirements:
    - "Access to bootloader source"
    - "Access to secure element documentation"
    - "Hardware security module access"
    - "Debug capability for boot stages"

discovery:
  file_patterns:
    - glob: "**/bootloader*.c"
      purpose: "Find bootloader code"
    - glob: "**/secure_boot*.c"
      purpose: "Find secure boot implementation"
    - glob: "**/verify*.c"
      purpose: "Find verification code"
    - glob: "**/crypto*.c"
      purpose: "Find cryptographic code"
    - glob: "**/key*.c"
      purpose: "Find key handling"

knowledge_sources:
  guides:
    - id: "arm-secure-boot"
      name: "ARM Secure Boot Guide"
      url: "https://developer.arm.com/documentation"
    - id: "uefi-secure-boot"
      name: "UEFI Secure Boot"
      url: "https://uefi.org/specifications"

  standards:
    - id: "nist-secure-boot"
      name: "NIST SP 800-147"
      relevance: "BIOS protection guidelines"
    - id: "unece-wp29"
      name: "UN ECE WP.29 Cybersecurity"
      relevance: "Automotive secure boot"
    - id: "iec-62443"
      name: "IEC 62443"
      relevance: "Industrial cybersecurity"

tooling:
  analysis_tools:
    - tool: "openssl"
      purpose: "Certificate and signature analysis"
    - tool: "binwalk"
      purpose: "Firmware analysis"
    - tool: "jtag-debugger"
      purpose: "Boot process debugging"

signals:
  critical:
    - id: "SBC-CRIT-001"
      signal: "No hardware root of trust"
      evidence_indicators:
        - "First stage not verified"
        - "No secure element"
        - "Boot can start from untrusted source"
      explanation: |
        Without hardware root of trust, the entire boot chain can be
        compromised. Secure boot must anchor to hardware-protected key.
      remediation: "Implement hardware root of trust (OTP, secure element)"

    - id: "SBC-CRIT-002"
      signal: "Verification can be bypassed"
      evidence_indicators:
        - "Debug mode skips verification"
        - "Fallback to unsigned boot"
        - "Verification optional"
      explanation: |
        Bypass mechanisms allow attackers to load unauthorized code.
        Verification must be mandatory with no bypass path.
      remediation: "Remove all verification bypass mechanisms"

  high:
    - id: "SBC-HIGH-001"
      signal: "Weak cryptographic algorithms used"
      evidence_indicators:
        - "SHA-1 for verification"
        - "RSA-1024 or smaller"
        - "Deprecated algorithms"
      explanation: |
        Weak cryptography can be broken, allowing forged signatures.
        Use current recommended algorithms.
      remediation: "Upgrade to SHA-256/384/512 and RSA-2048+ or ECDSA"

    - id: "SBC-HIGH-002"
      signal: "Keys stored insecurely"
      evidence_indicators:
        - "Keys in unprotected flash"
        - "Keys accessible via debug"
        - "No key protection hardware"
      explanation: |
        Exposed keys enable attackers to sign malicious firmware.
        Keys must be protected by hardware.
      remediation: "Store keys in secure element or OTP fuses"

  medium:
    - id: "SBC-MED-001"
      signal: "No anti-rollback protection"
      evidence_indicators:
        - "Old firmware can be installed"
        - "No version checking"
        - "Downgrade attack possible"
      explanation: |
        Rollback to older vulnerable firmware bypasses security
        patches. Version enforcement is essential.
      remediation: "Implement anti-rollback with monotonic counter"

    - id: "SBC-MED-002"
      signal: "Verification failure handling insecure"
      evidence_indicators:
        - "Boots anyway on failure"
        - "Enters debug mode"
        - "Information leaked on failure"
      explanation: |
        Improper failure handling may still allow attack progression
        or leak information useful to attackers.
      remediation: "Implement safe failure mode with no information leakage"

  low:
    - id: "SBC-LOW-001"
      signal: "Secure boot not documented"
      evidence_indicators:
        - "Boot chain unclear"
        - "Key management undocumented"
        - "Recovery process undefined"
      explanation: |
        Documentation supports security analysis and incident response.
      remediation: "Document complete secure boot architecture"

  positive:
    - id: "SBC-POS-001"
      signal: "Complete chain of trust established"
      evidence_indicators:
        - "Hardware root of trust"
        - "All stages verified"
        - "Strong cryptography"

    - id: "SBC-POS-002"
      signal: "Robust anti-rollback and key protection"
      evidence_indicators:
        - "Version enforcement active"
        - "Keys hardware-protected"
        - "No bypass mechanisms"

procedure:
  context:
    cognitive_mode: "analytical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Map Boot Chain"
      description: "Document all boot stages and verification points"
      duration_estimate: "1-2 hours"

    - id: "2"
      name: "Analyze Root of Trust"
      description: "Examine hardware trust anchor implementation"
      duration_estimate: "1-2 hours"

    - id: "3"
      name: "Review Cryptographic Implementation"
      description: "Assess algorithms and implementations"
      duration_estimate: "1-2 hours"

    - id: "4"
      name: "Evaluate Key Protection"
      description: "Review key storage and provisioning"
      duration_estimate: "1 hour"

    - id: "5"
      name: "Check Anti-Rollback Mechanisms"
      description: "Verify version enforcement"
      duration_estimate: "1 hour"

    - id: "6"
      name: "Test Bypass Attempts"
      description: "Attempt to circumvent secure boot"
      duration_estimate: "1-2 hours"

    - id: "7"
      name: "Document Findings"
      description: "Compile security assessment report"
      duration_estimate: "1 hour"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Boot Chain Analysis"
        - "Cryptographic Review"
        - "Key Management Assessment"
        - "Vulnerability Assessment"
        - "Recommendations"

closeout_checklist:
  - id: "sbc-001"
    item: "Boot chain mapped"
    level: "CRITICAL"
    verification: "manual"
  - id: "sbc-002"
    item: "Root of trust analyzed"
    level: "CRITICAL"
    verification: "manual"
  - id: "sbc-003"
    item: "Cryptography reviewed"
    level: "HIGH"
    verification: "manual"
  - id: "sbc-004"
    item: "Bypass testing completed"
    level: "CRITICAL"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["embedded-systems", "security-critical", "automotive", "iot"]

  compliance_mappings:
    - framework: "IEC 62443"
      control: "SL 3-4"
      description: "Secure boot requirements"
    - framework: "UN ECE WP.29"
      control: "R155"
      description: "Automotive cybersecurity"
    - framework: "NIST SP 800-147"
      control: "Platform Integrity"
      description: "BIOS protection"

relationships:
  commonly_combined:
    - "real-time-embedded.bootloader-security.firmware-signing"
    - "real-time-embedded.bootloader-security.secure-update"
  depends_on:
    - "hardware.secure-element"
    - "cryptography.key-management"
  feeds_into:
    - "security.platform-security"
    - "certification.security-certification"
