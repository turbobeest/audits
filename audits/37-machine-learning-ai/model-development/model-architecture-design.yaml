# ============================================================
# AUDIT: Model Architecture Design
# Category: 37 - Machine Learning & AI
# Subcategory: model-development
# ============================================================

audit:
  id: "machine-learning-ai.model-development.model-architecture-design"
  name: "Model Architecture Design Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "machine-learning-ai"
  category_number: 37
  subcategory: "model-development"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "ml-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the design and implementation of model architectures including layer
    configurations, activation functions, regularization strategies, and architectural
    decisions. Examines whether architecture choices are appropriate for the problem,
    well-documented, and maintainable.

  why_it_matters: |
    Model architecture directly impacts performance, inference speed, and maintainability.
    Poor architectural choices lead to underfitting, overfitting, or unnecessary complexity.
    Well-designed architectures balance capacity with efficiency and are adaptable to
    changing requirements.

  when_to_run:
    - "During model design phase"
    - "Before committing to production architecture"
    - "When model performance is unsatisfactory"
    - "During model optimization efforts"

prerequisites:
  required_artifacts:
    - type: "model_code"
      description: "Access to model architecture code"
    - type: "design_docs"
      description: "Architecture design documentation"
    - type: "performance_benchmarks"
      description: "Model performance measurements"

  access_requirements:
    - "Read access to model implementation"
    - "Access to architecture diagrams"
    - "Access to performance metrics"
    - "Access to design rationale documentation"

discovery:
  file_patterns:
    - glob: "**/models/**/*.py"
      purpose: "Find model architecture definitions"
    - glob: "**/networks/**/*.py"
      purpose: "Find neural network implementations"
    - glob: "**/architectures/**"
      purpose: "Find architecture configurations"
    - glob: "**/*.onnx"
      purpose: "Find exported model artifacts"

knowledge_sources:
  guides:
    - id: "pytorch-docs"
      name: "PyTorch Neural Network Documentation"
      url: "https://pytorch.org/docs/stable/nn.html"
    - id: "keras-docs"
      name: "Keras Layers Documentation"
      url: "https://keras.io/api/layers/"

  standards:
    - id: "dl-best-practices"
      name: "Deep Learning Best Practices"
      relevance: "Neural network design patterns"

tooling:
  analysis_tools:
    - tool: "torchinfo"
      purpose: "Model architecture visualization"
    - tool: "netron"
      purpose: "Neural network visualization"
    - tool: "pytorch-profiler"
      purpose: "Model performance profiling"
    - tool: "flops-counter"
      purpose: "Computational complexity analysis"

signals:
  critical:
    - id: "AD-CRIT-001"
      signal: "Architecture fundamentally mismatched to problem"
      evidence_indicators:
        - "CNN used for sequential data without justification"
        - "No attention mechanism for long-range dependencies"
        - "Architecture cannot capture required patterns"
      explanation: |
        Using an inappropriate architecture leads to fundamental performance limitations
        that cannot be overcome by training or tuning. Architecture must match problem structure.
      remediation: "Reassess problem requirements and select appropriate architecture family"

    - id: "AD-CRIT-002"
      signal: "Severe overfitting due to architecture"
      evidence_indicators:
        - "Model capacity far exceeds data complexity"
        - "No regularization implemented"
        - "Training/validation gap extremely large"
      explanation: |
        Over-parameterized models without proper regularization memorize training data
        instead of learning generalizable patterns, leading to poor production performance.
      remediation: "Reduce model capacity and implement appropriate regularization"

  high:
    - id: "AD-HIGH-001"
      signal: "Architecture not optimized for inference"
      remediation: "Consider inference-optimized architectures or quantization"

    - id: "AD-HIGH-002"
      signal: "Missing skip connections in deep networks"
      remediation: "Add residual connections to improve gradient flow"

    - id: "AD-HIGH-003"
      signal: "Inefficient layer implementations"
      remediation: "Use optimized layer implementations"

  medium:
    - id: "AD-MED-001"
      signal: "Architecture design rationale not documented"
      remediation: "Document architectural decisions and alternatives considered"

    - id: "AD-MED-002"
      signal: "No ablation studies on architecture components"
      remediation: "Conduct ablation studies to justify complexity"

    - id: "AD-MED-003"
      signal: "Architecture not modular"
      remediation: "Refactor into modular, reusable components"

  low:
    - id: "AD-LOW-001"
      signal: "Inconsistent layer naming conventions"
      remediation: "Standardize layer naming across model"

    - id: "AD-LOW-002"
      signal: "Architecture visualization not available"
      remediation: "Generate and maintain architecture diagrams"

  positive:
    - id: "AD-POS-001"
      signal: "Well-documented architecture with clear rationale"
    - id: "AD-POS-002"
      signal: "Modular design enabling component reuse"
    - id: "AD-POS-003"
      signal: "Architecture optimized for both training and inference"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Architecture Design"
      description: "Examine model architecture and design decisions"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Assess Problem Fit"
      description: "Evaluate whether architecture matches problem requirements"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Analyze Capacity and Regularization"
      description: "Review model capacity and regularization strategies"
      duration_estimate: "45 minutes"

    - id: "4"
      name: "Evaluate Efficiency"
      description: "Profile computational and memory efficiency"
      duration_estimate: "45 minutes"

    - id: "5"
      name: "Review Documentation"
      description: "Assess architecture documentation and diagrams"
      duration_estimate: "30 minutes"

    - id: "6"
      name: "Check Modularity"
      description: "Evaluate code modularity and reusability"
      duration_estimate: "30 minutes"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Architecture Analysis"
        - "Capacity and Efficiency"
        - "Recommendations"

closeout_checklist:
  - id: "ad-001"
    item: "Architecture-problem fit assessed"
    level: "CRITICAL"
    verification: "manual"

  - id: "ad-002"
    item: "Efficiency profiled"
    level: "HIGH"
    verification: "automated"

  - id: "ad-003"
    item: "Documentation reviewed"
    level: "MEDIUM"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["ml-systems", "ai-applications"]

  compliance_mappings:
    - framework: "EU AI Act"
      control: "Technical Documentation"
      description: "Requirements for AI system architecture documentation"

relationships:
  commonly_combined:
    - "machine-learning-ai.model-development.model-selection-process"
    - "machine-learning-ai.model-validation.model-testing"
  depends_on:
    - "machine-learning-ai.data-quality.training-data-quality"
  feeds_into:
    - "machine-learning-ai.model-deployment.model-optimization"
