# ============================================================
# AUDIT: Feature Store Management
# Category: 37 - Machine Learning & AI
# Subcategory: mlops-infrastructure
# ============================================================

audit:
  id: "machine-learning-ai.mlops-infrastructure.feature-store-management"
  name: "Feature Store Management Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "machine-learning-ai"
  category_number: 37
  subcategory: "mlops-infrastructure"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "ml-systems"

  default_profiles:
    - "full"
    - "quick"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates feature store infrastructure including feature definition, versioning,
    serving infrastructure, feature discovery, and training-serving consistency.
    Examines whether the feature store enables reliable and efficient feature management.

  why_it_matters: |
    Feature stores solve critical ML infrastructure problems including training-serving
    skew, feature reuse, and point-in-time correctness. A well-managed feature store
    accelerates ML development, improves reliability, and reduces technical debt.

  when_to_run:
    - "When evaluating feature store implementation"
    - "After feature store deployment"
    - "When scaling ML operations"
    - "During ML platform reviews"

prerequisites:
  required_artifacts:
    - type: "feature_store"
      description: "Access to feature store system"
    - type: "feature_definitions"
      description: "Feature definitions and metadata"
    - type: "serving_infrastructure"
      description: "Feature serving system access"

  access_requirements:
    - "Access to feature store"
    - "Access to feature definitions"
    - "Access to serving APIs"
    - "Access to monitoring dashboards"

discovery:
  file_patterns:
    - glob: "**/feast/**"
      purpose: "Find Feast configurations"
    - glob: "**/feature_store/**"
      purpose: "Find feature store code"
    - glob: "**/features/**"
      purpose: "Find feature definitions"

knowledge_sources:
  guides:
    - id: "feast-docs"
      name: "Feast Documentation"
      url: "https://docs.feast.dev/"
    - id: "tecton-docs"
      name: "Tecton Documentation"
      url: "https://docs.tecton.ai/"

  standards:
    - id: "feature-store-best-practices"
      name: "Feature Store Best Practices"
      relevance: "Feature management standards"

tooling:
  analysis_tools:
    - tool: "feast"
      purpose: "Open source feature store"
    - tool: "tecton"
      purpose: "Enterprise feature platform"
    - tool: "hopsworks"
      purpose: "Feature store platform"
    - tool: "vertex-ai-feature-store"
      purpose: "GCP feature store"

signals:
  critical:
    - id: "FS-CRIT-001"
      signal: "Training-serving skew from feature store"
      evidence_indicators:
        - "Features computed differently in training vs serving"
        - "Point-in-time correctness violations"
        - "Feature values inconsistent"
      explanation: |
        Training-serving skew from the feature store defeats its purpose and causes
        model performance degradation in production.
      remediation: "Audit feature pipelines and ensure consistent computation"

    - id: "FS-CRIT-002"
      signal: "Feature store serving outages"
      evidence_indicators:
        - "Feature serving unavailable"
        - "High latency affecting model serving"
        - "No fallback mechanisms"
      explanation: |
        Feature store outages directly impact model serving, causing prediction
        failures and user impact.
      remediation: "Implement high availability and caching/fallbacks"

  high:
    - id: "FS-HIGH-001"
      signal: "Feature versioning not implemented"
      remediation: "Implement feature versioning"

    - id: "FS-HIGH-002"
      signal: "No feature discovery mechanism"
      remediation: "Implement feature catalog and discovery"

    - id: "FS-HIGH-003"
      signal: "Feature serving latency too high"
      remediation: "Optimize serving with caching and indexing"

  medium:
    - id: "FS-MED-001"
      signal: "Feature documentation incomplete"
      remediation: "Document all features with metadata"

    - id: "FS-MED-002"
      signal: "Feature lineage not tracked"
      remediation: "Implement feature lineage tracking"

    - id: "FS-MED-003"
      signal: "No feature monitoring"
      remediation: "Add feature quality monitoring"

  low:
    - id: "FS-LOW-001"
      signal: "Feature naming inconsistent"
      remediation: "Establish feature naming conventions"

    - id: "FS-LOW-002"
      signal: "Unused features not cleaned up"
      remediation: "Implement feature deprecation process"

  positive:
    - id: "FS-POS-001"
      signal: "Consistent training-serving features"
    - id: "FS-POS-002"
      signal: "Comprehensive feature catalog with discovery"
    - id: "FS-POS-003"
      signal: "Low-latency, highly available serving"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Feature Store Architecture"
      description: "Assess overall feature store design"
      duration_estimate: "1 hour"

    - id: "2"
      name: "Check Training-Serving Consistency"
      description: "Verify features are consistent across environments"
      duration_estimate: "1 hour"

    - id: "3"
      name: "Evaluate Serving Performance"
      description: "Profile feature serving latency and availability"
      duration_estimate: "45 minutes"

    - id: "4"
      name: "Assess Discovery and Catalog"
      description: "Review feature discoverability"
      duration_estimate: "30 minutes"

    - id: "5"
      name: "Check Versioning"
      description: "Verify feature versioning implementation"
      duration_estimate: "30 minutes"

    - id: "6"
      name: "Review Monitoring"
      description: "Assess feature monitoring coverage"
      duration_estimate: "30 minutes"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Architecture Assessment"
        - "Consistency Analysis"
        - "Performance Review"
        - "Recommendations"

closeout_checklist:
  - id: "fs-001"
    item: "Training-serving consistency verified"
    level: "CRITICAL"
    verification: "automated"

  - id: "fs-002"
    item: "Serving performance assessed"
    level: "HIGH"
    verification: "automated"

  - id: "fs-003"
    item: "Discovery capabilities reviewed"
    level: "MEDIUM"
    verification: "manual"

governance:
  applicable_to:
    archetypes: ["ml-systems", "ai-applications", "data-platforms"]

  compliance_mappings:
    - framework: "SOC 2"
      control: "Data Management"
      description: "Data infrastructure requirements"

relationships:
  commonly_combined:
    - "machine-learning-ai.model-development.feature-engineering-quality"
    - "machine-learning-ai.data-quality.data-pipeline-reliability"
  depends_on:
    - "infrastructure-as-code.data-infrastructure"
  feeds_into:
    - "machine-learning-ai.model-deployment.model-serving"
