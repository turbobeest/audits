audit:
  id: machine-learning-ai.model-deployment.model-containerization
  name: Model Containerization Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: machine-learning-ai
  category_number: 37
  subcategory: model-deployment
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: medium
  scope: ml-systems
  default_profiles:
  - full
  - quick
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates model containerization practices including Docker image construction,
    dependency management, size optimization, security scanning, and reproducibility.
    Examines whether containers enable reliable and secure model deployment.
  why_it_matters: |
    Containers are the standard deployment unit for ML models. Poor containerization
    leads to deployment failures, security vulnerabilities, slow startup times, and
    environment inconsistencies. Well-built containers ensure reliable, secure, and
    efficient model deployment.
  when_to_run:
  - When establishing containerization practices
  - Before production deployment
  - After security scan findings
  - During deployment optimization
prerequisites:
  required_artifacts:
  - type: dockerfile
    description: Container build definitions
  - type: image_registry
    description: Access to container registry
  - type: security_scans
    description: Container security scan results
  access_requirements:
  - Access to Dockerfiles
  - Access to container registry
  - Access to build pipelines
  - Access to security scanning tools
discovery:
  file_patterns:
  - glob: '**/Dockerfile*'
    purpose: Find Dockerfiles
  - glob: '**/*.dockerfile'
    purpose: Find dockerfile variants
  - glob: '**/docker-compose*.yaml'
    purpose: Find compose files
  - glob: '**/requirements*.txt'
    purpose: Find Python dependencies
knowledge_sources:
  guides:
  - id: docker-best-practices
    name: Docker Best Practices
    url: https://docs.docker.com/develop/develop-images/dockerfile_best-practices/
  - id: ml-docker
    name: Docker for ML
    url: https://ml-ops.org/content/docker-for-ml
  standards:
  - id: container-security
    name: Container Security Best Practices
    relevance: Secure container deployment
tooling:
  analysis_tools:
  - tool: docker
    purpose: Container runtime
  - tool: trivy
    purpose: Container security scanning
  - tool: hadolint
    purpose: Dockerfile linting
  - tool: dive
    purpose: Image size analysis
  - tool: buildx
    purpose: Multi-platform builds
signals:
  critical:
  - id: MC-CRIT-001
    signal: Critical vulnerabilities in container image
    evidence_indicators:
    - CVEs with high CVSS scores
    - Unpatched base images
    - Known exploitable vulnerabilities
    explanation: |
      Container vulnerabilities can be exploited to compromise model serving
      infrastructure, steal data, or manipulate predictions.
    remediation: Update base images and dependencies, rescan for vulnerabilities
  - id: MC-CRIT-002
    signal: Secrets embedded in container image
    evidence_indicators:
    - API keys in image layers
    - Credentials in environment variables
    - Sensitive config in image
    explanation: |
      Embedded secrets can be extracted from images, leading to unauthorized access
      and security breaches.
    remediation: Remove secrets and use secret management systems
  high:
  - id: MC-HIGH-001
    signal: Container image not reproducible
    remediation: Pin all dependencies and base image versions
  - id: MC-HIGH-002
    signal: Running as root user
    remediation: Create and use non-root user
  - id: MC-HIGH-003
    signal: Image size too large
    remediation: Use multi-stage builds and optimize layers
  medium:
  - id: MC-MED-001
    signal: No health check defined
    remediation: Add container health check
  - id: MC-MED-002
    signal: Build context includes unnecessary files
    remediation: Optimize .dockerignore
  - id: MC-MED-003
    signal: No layer caching optimization
    remediation: Order Dockerfile instructions for cache efficiency
  low:
  - id: MC-LOW-001
    signal: Dockerfile not linted
    remediation: Add Hadolint to CI pipeline
  - id: MC-LOW-002
    signal: No image tagging strategy
    remediation: Implement consistent image tagging
  positive:
  - id: MC-POS-001
    signal: Minimal, secure base image
  - id: MC-POS-002
    signal: No critical vulnerabilities in scans
  - id: MC-POS-003
    signal: Optimized image size with caching
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review Dockerfile
    description: Examine Dockerfile for best practices
    duration_estimate: 45 minutes
  - id: '2'
    name: Run Security Scan
    description: Scan image for vulnerabilities
    duration_estimate: 30 minutes
  - id: '3'
    name: Check for Secrets
    description: Scan for embedded credentials
    duration_estimate: 30 minutes
  - id: '4'
    name: Analyze Image Size
    description: Review image layers and optimization
    duration_estimate: 30 minutes
  - id: '5'
    name: Test Reproducibility
    description: Verify builds are reproducible
    duration_estimate: 45 minutes
  - id: '6'
    name: Review Security Configuration
    description: Check user, permissions, and configuration
    duration_estimate: 30 minutes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Security Analysis
    - Optimization Review
    - Reproducibility Assessment
    - Recommendations
closeout_checklist:
- id: mc-001
  item: Security scan completed
  level: CRITICAL
  verification: automated
- id: mc-002
  item: Secrets scan completed
  level: CRITICAL
  verification: automated
- id: mc-003
  item: Image optimization reviewed
  level: MEDIUM
  verification: manual
governance:
  applicable_to:
    archetypes:
    - ml-systems
    - ai-applications
  compliance_mappings:
  - framework: SOC 2
    control: Security
    description: Container security requirements
relationships:
  commonly_combined:
  - machine-learning-ai.model-deployment.model-serving
  - security-audit.container-security
  depends_on:
  - infrastructure-as-code.container-infrastructure
  feeds_into:
  - machine-learning-ai.model-deployment.progressive-rollout
