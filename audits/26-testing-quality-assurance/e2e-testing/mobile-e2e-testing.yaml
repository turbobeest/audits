# ============================================================
# AUDIT: Mobile E2E Testing
# ============================================================
# Evaluates E2E testing for mobile experiences including
# responsive design and native mobile applications.
# ============================================================

audit:
  id: "testing-quality-assurance.e2e-testing.mobile-e2e-testing"
  name: "Mobile E2E Testing"
  version: "1.0.0"
  last_updated: "2026-01-22"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 26
  subcategory: "e2e-testing"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "testing"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates E2E testing coverage for mobile experiences including
    responsive web testing at mobile viewports, touch interactions,
    mobile-specific features (gestures, orientation), and native
    mobile app testing where applicable.

  why_it_matters: |
    Mobile traffic often exceeds 50% of web visits. Users on mobile
    devices have different interaction patterns, screen constraints,
    and expectations. Testing only on desktop misses responsive design
    bugs, touch interaction issues, and mobile-specific performance
    problems that degrade user experience.

  when_to_run:
    - "Pre-release validation"
    - "After responsive design changes"
    - "New mobile feature development"
    - "Mobile UX review"

prerequisites:
  required_artifacts:
    - type: "e2e_tests"
      description: "E2E test suite"
    - type: "mobile_requirements"
      description: "Mobile device/viewport requirements"

  access_requirements:
    - "Source code repository access"
    - "Mobile emulation or device access"
    - "Mobile testing infrastructure"

discovery:
  file_patterns:
    - glob: "**/mobile/**/*.{test,spec}.*"
      purpose: "Mobile-specific tests"
    - glob: "**/*mobile*.{test,spec}.*"
      purpose: "Mobile test files"

  code_patterns:
    - pattern: "setViewport|viewport|mobile"
      type: "regex"
      scope: "test"
      purpose: "Viewport configuration"
    - pattern: "touch|swipe|tap|gesture"
      type: "regex"
      scope: "test"
      purpose: "Touch interaction testing"
    - pattern: "iPhone|Android|device"
      type: "regex"
      scope: "config"
      purpose: "Device emulation"

knowledge_sources:
  guides:
    - id: "mobile-testing"
      name: "Mobile Testing with Playwright"
      url: "https://playwright.dev/docs/emulation"
      offline_cache: true
    - id: "responsive-testing"
      name: "Responsive Testing Guide"
      url: "https://www.browserstack.com/guide/responsive-testing-on-real-devices"
      offline_cache: true

  learning_resources:
    - id: "mobile-automation"
      title: "Mobile Test Automation"
      type: "documentation"
      reference: "https://appium.io/docs/en/about-appium/intro/"

tooling:
  infrastructure_tools:
    - tool: "Playwright"
      purpose: "Mobile viewport emulation"
      offline_capable: false
    - tool: "Appium"
      purpose: "Native mobile app testing"
      offline_capable: false
    - tool: "BrowserStack"
      purpose: "Real mobile device testing"
      offline_capable: false
    - tool: "Detox"
      purpose: "React Native E2E testing"
      offline_capable: false

  scripts:
    - id: "mobile-test-check"
      language: "bash"
      purpose: "Check mobile testing configuration"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Mobile E2E Testing Analysis ==="

        echo "Mobile viewport configurations:"
        grep -r 'viewport\|mobile' --include='*.config.*' . 2>/dev/null | head -10

        echo ""
        echo "Touch interaction tests:"
        grep -r -c 'touch\|swipe\|tap\|gesture' --include='*.spec.*' . 2>/dev/null | awk -F: '{sum+=$2} END {print sum}'

        echo ""
        echo "Device emulation:"
        grep -r 'iPhone\|Android\|iPad\|device' --include='*.config.*' --include='*.spec.*' . 2>/dev/null | head -10

        echo ""
        echo "Mobile-specific test files:"
        find . -name '*mobile*' -name '*.spec.*' 2>/dev/null | wc -l

signals:
  critical:
    - id: "MOBILE-CRIT-001"
      signal: "No mobile viewport testing"
      evidence_pattern: "E2E tests only run at desktop resolution"
      explanation: |
        Without mobile viewport testing, responsive design bugs
        are undetected. UI elements may overlap, be unreachable,
        or render incorrectly on mobile devices, significantly
        impacting the majority of users.
      remediation: |
        Add mobile viewport testing:
        1. Configure mobile viewport presets (iPhone, Android)
        2. Run critical journeys at mobile viewports
        3. Test touch-specific interactions
        4. Include mobile in CI browser matrix

    - id: "MOBILE-CRIT-002"
      signal: "Critical journeys not tested on mobile"
      evidence_pattern: "Checkout, login only tested at desktop viewport"
      explanation: |
        Users complete critical journeys on mobile. If these flows
        are broken on mobile, you lose customers. Mobile-first
        testing is essential for modern web applications.
      remediation: |
        Test critical journeys on mobile:
        - Login/authentication
        - Checkout/purchase
        - Core product features
        - Account management

  high:
    - id: "MOBILE-HIGH-001"
      signal: "Touch interactions not tested"
      evidence_pattern: "No swipe, gesture, or tap tests"
      explanation: |
        Mobile users interact via touch, not mouse. Touch targets,
        swipe gestures, and tap behaviors must be explicitly tested
        as they differ from click interactions.
      remediation: |
        Add touch interaction tests:
        - Touch target size verification
        - Swipe/scroll behaviors
        - Tap vs click behaviors
        - Gesture navigation

    - id: "MOBILE-HIGH-002"
      signal: "Only emulation, no real device testing"
      evidence_pattern: "Testing only via browser emulation"
      explanation: |
        Browser emulation doesn't catch all mobile issues. Real
        device testing reveals performance, rendering, and touch
        accuracy issues that emulators miss.
      remediation: |
        Add real device testing:
        - Use BrowserStack, Sauce Labs, or local devices
        - Test on popular device models
        - Include both iOS and Android
        - Test across device generations

  medium:
    - id: "MOBILE-MED-001"
      signal: "Single mobile viewport only"
      evidence_pattern: "Testing at one mobile resolution only"
      remediation: "Test multiple viewport sizes (phone small/large, tablet)"

    - id: "MOBILE-MED-002"
      signal: "Orientation changes not tested"
      evidence_pattern: "No portrait/landscape orientation tests"
      remediation: "Test key flows in both orientations"

  low:
    - id: "MOBILE-LOW-001"
      signal: "Mobile-specific performance not measured"
      evidence_pattern: "No mobile performance metrics collected"

  positive:
    - id: "MOBILE-POS-001"
      signal: "Comprehensive mobile testing"
      evidence_pattern: "Multiple viewports, touch tests, real devices"

    - id: "MOBILE-POS-002"
      signal: "Mobile-first test strategy"
      evidence_pattern: "Mobile viewports run before desktop"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review mobile requirements"
      description: |
        Determine mobile testing requirements based on user traffic.
      duration_estimate: "15 min"
      questions:
        - "What percentage of traffic is mobile?"
        - "What devices/viewports must be supported?"
        - "Are there native mobile apps?"
      expected_findings:
        - "Mobile traffic analysis"
        - "Device requirements"

    - id: "2"
      name: "Check viewport configuration"
      description: |
        Review E2E test configuration for mobile viewports.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find viewport configs"
          command: "grep -r 'viewport\\|device' --include='*.config.*' . 2>/dev/null | head -15"
        - purpose: "Find mobile test files"
          command: "find . -name '*mobile*' -name '*.spec.*' 2>/dev/null"
      expected_findings:
        - "Configured viewports"
        - "Mobile test coverage"

    - id: "3"
      name: "Analyze touch testing"
      description: |
        Check for touch and gesture interaction testing.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find touch tests"
          command: "grep -r 'touch\\|tap\\|swipe' --include='*.spec.*' . 2>/dev/null | head -15"
      expected_findings:
        - "Touch test coverage"
        - "Gesture testing"

    - id: "4"
      name: "Verify device coverage"
      description: |
        Check device emulation and real device testing.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find device configurations"
          command: "grep -r 'iPhone\\|Android\\|iPad' --include='*.config.*' . 2>/dev/null | head -10"
        - purpose: "Check CI mobile testing"
          command: "grep -r 'mobile\\|device' .github/workflows/ 2>/dev/null | head -10"
      expected_findings:
        - "Device coverage"
        - "CI mobile integration"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "mobile_coverage"
      format: "table"
      sections:
        - "Viewport Coverage"
        - "Touch Testing"
        - "Device Testing"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Mobile Testing Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Configuration analysis with test execution"
    medium: "Configuration analysis only"
    low: "Pattern matching"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "mobile-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed analysis"
    production:
      included: true
      priority: 4
    full:
      included: true
      priority: 7

closeout_checklist:
  - id: "mobile-001"
    item: "Mobile viewport testing configured"
    level: "CRITICAL"
    verification: "grep -r 'viewport' --include='*.config.*' . 2>/dev/null | wc -l"
    expected: "Count > 0"

  - id: "mobile-002"
    item: "Critical journeys tested on mobile"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify key flows run at mobile viewports"
    expected: "Confirmed by reviewer"

  - id: "mobile-003"
    item: "Touch interactions covered"
    level: "WARNING"
    verification: "grep -r 'touch\\|tap' --include='*.spec.*' . 2>/dev/null | wc -l"
    expected: "Count documented"

governance:
  applicable_to:
    archetypes:
      - "web-application"
      - "mobile-app"
      - "saas"

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["Mobile Accessibility"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.e2e-testing.cross-browser-testing"
    - "testing-quality-assurance.e2e-testing.e2e-test-coverage"
    - "accessibility.mobile.mobile-accessibility"
