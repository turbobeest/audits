# ============================================================
# AUDIT: Cross-Browser Testing
# ============================================================
# Evaluates E2E testing across multiple browsers and browser
# versions.
# ============================================================

audit:
  id: "testing-quality-assurance.e2e-testing.cross-browser-testing"
  name: "Cross-Browser Testing"
  version: "1.0.0"
  last_updated: "2026-01-22"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 26
  subcategory: "e2e-testing"

  tier: "expert"
  estimated_duration: "1-2 hours"  # median: 1h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "yes"
  severity: "medium"
  scope: "testing"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates E2E test coverage across multiple browsers (Chrome, Firefox,
    Safari, Edge) and browser versions. Assesses browser matrix configuration,
    identifies browser-specific test failures, and verifies cross-browser
    compatibility testing is part of the release process.

  why_it_matters: |
    Users access applications from different browsers with varying
    rendering engines, JavaScript implementations, and quirks. Testing
    only on Chrome misses Safari rendering issues, Firefox compatibility
    problems, and Edge-specific behaviors. Cross-browser bugs frustrate
    users and damage credibility.

  when_to_run:
    - "Pre-release validation"
    - "After CSS/UI changes"
    - "New feature development"
    - "Browser support policy updates"

prerequisites:
  required_artifacts:
    - type: "e2e_tests"
      description: "E2E test suite"
    - type: "browser_support"
      description: "Documented browser support policy"

  access_requirements:
    - "Source code repository access"
    - "Multiple browser environments"
    - "Cross-browser testing infrastructure"

discovery:
  file_patterns:
    - glob: "**/playwright.config.*"
      purpose: "Playwright multi-browser config"
    - glob: "**/cypress.config.*"
      purpose: "Cypress browser config"

  code_patterns:
    - pattern: "chromium|firefox|webkit|safari|edge"
      type: "regex"
      scope: "config"
      purpose: "Browser configuration"
    - pattern: "projects.*browser|browsers\\s*:"
      type: "regex"
      scope: "config"
      purpose: "Multi-browser setup"

knowledge_sources:
  guides:
    - id: "cross-browser"
      name: "Cross Browser Testing Guide"
      url: "https://playwright.dev/docs/browsers"
      offline_cache: true
    - id: "browser-compat"
      name: "Browser Compatibility Testing"
      url: "https://www.browserstack.com/guide/cross-browser-testing-tutorial"
      offline_cache: true

  learning_resources:
    - id: "browser-testing"
      title: "Cross Browser Testing Handbook"
      type: "guide"
      reference: "https://www.lambdatest.com/learning-hub/cross-browser-testing"

tooling:
  infrastructure_tools:
    - tool: "Playwright"
      purpose: "Native multi-browser support"
      offline_capable: false
    - tool: "BrowserStack"
      purpose: "Cloud browser testing"
      offline_capable: false
    - tool: "Sauce Labs"
      purpose: "Cloud browser testing"
      offline_capable: false
    - tool: "LambdaTest"
      purpose: "Cloud browser testing"
      offline_capable: false

  scripts:
    - id: "browser-check"
      language: "bash"
      purpose: "Check cross-browser configuration"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Cross-Browser Testing Analysis ==="

        echo "Playwright browsers configured:"
        cat playwright.config.* 2>/dev/null | grep -E 'chromium|firefox|webkit' | head -10

        echo ""
        echo "Cypress browsers:"
        cat cypress.config.* 2>/dev/null | grep -E 'browser|chrome|firefox|edge' | head -10

        echo ""
        echo "CI browser matrix:"
        grep -r 'browser:' .github/workflows/ 2>/dev/null | head -10

signals:
  critical:
    - id: "CROSSBROWSER-CRIT-001"
      signal: "E2E tests only run on single browser"
      evidence_pattern: "Only Chrome/Chromium configured for E2E"
      explanation: |
        Testing only on Chrome misses issues on other browsers.
        Safari, Firefox, and Edge each have unique rendering
        behaviors and JavaScript quirks that must be tested.
      remediation: |
        Configure multi-browser testing:
        1. Add all supported browsers to test config
        2. Run critical tests on all browsers
        3. Run full suite on primary browser
        4. Include browser matrix in CI

    - id: "CROSSBROWSER-CRIT-002"
      signal: "No Safari/WebKit testing"
      evidence_pattern: "Safari not in browser matrix"
      explanation: |
        Safari has unique behaviors, especially on iOS. It's a
        significant portion of web traffic (especially mobile)
        and has known compatibility issues with modern CSS/JS.
      remediation: |
        Add Safari/WebKit testing:
        - Playwright: webkit project
        - BrowserStack: Safari browsers
        - Consider iOS Safari for mobile

  high:
    - id: "CROSSBROWSER-HIGH-001"
      signal: "Browser matrix not enforced in CI"
      evidence_pattern: "CI only runs tests on default browser"
      explanation: |
        Cross-browser testing only in development is unreliable.
        CI must enforce browser matrix testing to catch regressions
        before they reach production.
      remediation: |
        Add browser matrix to CI:
        - GitHub Actions: strategy.matrix.browser
        - Run critical tests on all browsers
        - Run full suite on merge

    - id: "CROSSBROWSER-HIGH-002"
      signal: "Browser-specific test skips not tracked"
      evidence_pattern: "Tests skipped on certain browsers without documentation"
      explanation: |
        Browser-specific skips indicate known compatibility issues
        that aren't being addressed. These represent technical debt
        and potential user-facing bugs.
      remediation: |
        Track and address browser-specific issues:
        - Document why tests are skipped per browser
        - Create issues for browser-specific bugs
        - Review skipped tests regularly

  medium:
    - id: "CROSSBROWSER-MED-001"
      signal: "Browser versions not specified"
      evidence_pattern: "Using 'latest' without version pinning"
      remediation: "Pin browser versions for reproducible results"

    - id: "CROSSBROWSER-MED-002"
      signal: "Mobile browsers not tested"
      evidence_pattern: "No mobile Safari or Chrome mobile testing"
      remediation: "Add mobile viewport and browser testing for mobile users"

  low:
    - id: "CROSSBROWSER-LOW-001"
      signal: "Legacy browser testing missing"
      evidence_pattern: "No tests for older supported browser versions"

  positive:
    - id: "CROSSBROWSER-POS-001"
      signal: "Comprehensive browser matrix"
      evidence_pattern: "Chrome, Firefox, Safari, Edge all tested"

    - id: "CROSSBROWSER-POS-002"
      signal: "Browser testing in CI pipeline"
      evidence_pattern: "All browsers tested on every PR"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review browser support policy"
      description: |
        Determine which browsers must be supported.
      duration_estimate: "10 min"
      questions:
        - "What browsers are officially supported?"
        - "What are the browser traffic percentages?"
        - "Are mobile browsers supported?"
      expected_findings:
        - "Browser support requirements"
        - "Priority ranking"

    - id: "2"
      name: "Check test configuration"
      description: |
        Review E2E test configuration for browser settings.
      duration_estimate: "15 min"
      commands:
        - purpose: "Check Playwright browsers"
          command: "cat playwright.config.* 2>/dev/null | grep -A5 'projects'"
        - purpose: "Check Cypress browser"
          command: "cat cypress.config.* 2>/dev/null | grep browser"
      expected_findings:
        - "Configured browsers"
        - "Configuration gaps"

    - id: "3"
      name: "Verify CI browser matrix"
      description: |
        Check that CI runs tests on multiple browsers.
      duration_estimate: "15 min"
      commands:
        - purpose: "Check CI matrix"
          command: "cat .github/workflows/*.yml 2>/dev/null | grep -A5 'matrix\\|browser'"
      expected_findings:
        - "CI browser coverage"
        - "Matrix configuration"

    - id: "4"
      name: "Identify browser-specific issues"
      description: |
        Find tests that fail or are skipped on specific browsers.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find browser-specific skips"
          command: "grep -r 'skip.*browser\\|webkit.*skip\\|firefox.*skip' --include='*.spec.*' . 2>/dev/null | head -10"
      expected_findings:
        - "Browser-specific failures"
        - "Skip patterns"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "browser_matrix"
      format: "table"
      sections:
        - "Supported Browsers"
        - "Test Coverage"
        - "CI Integration"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Browser Coverage Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Configuration analysis with CI verification"
    medium: "Configuration analysis only"
    low: "Estimated from patterns"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "cross-browser"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires infrastructure analysis"
    production:
      included: true
      priority: 5
    full:
      included: true
      priority: 9

closeout_checklist:
  - id: "crossbrowser-001"
    item: "Browser support policy documented"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "List supported browsers"
    expected: "Confirmed by reviewer"

  - id: "crossbrowser-002"
    item: "Browser matrix configured"
    level: "BLOCKING"
    verification: "cat playwright.config.* 2>/dev/null | grep -c 'chromium\\|firefox\\|webkit'"
    expected: "Count > 1"

  - id: "crossbrowser-003"
    item: "CI browser testing verified"
    level: "WARNING"
    verification: "grep -r 'browser' .github/workflows/ 2>/dev/null | wc -l"
    expected: "Count > 0"

governance:
  applicable_to:
    archetypes:
      - "web-application"
      - "saas"

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["Browser Compatibility"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.e2e-testing.e2e-test-coverage"
    - "testing-quality-assurance.e2e-testing.mobile-e2e-testing"
    - "accessibility.browser-compatibility.cross-browser-support"
