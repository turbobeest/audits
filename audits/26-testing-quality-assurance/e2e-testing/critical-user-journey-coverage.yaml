# ============================================================
# AUDIT: Critical User Journey Coverage
# ============================================================
# Evaluates E2E test coverage of critical user journeys and
# business-critical workflows.
# ============================================================

audit:
  id: "testing-quality-assurance.e2e-testing.critical-user-journey-coverage"
  name: "Critical User Journey Coverage"
  version: "1.0.0"
  last_updated: "2026-01-22"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 26
  subcategory: "e2e-testing"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "testing"

  default_profiles:
    - "full"
    - "production"
    - "security"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Evaluates end-to-end test coverage specifically for critical user
    journeys - the paths that generate revenue, ensure security, or
    provide core product value. Maps user stories to test scenarios
    and verifies complete journey coverage.

  why_it_matters: |
    Critical user journeys are where bugs have the highest business
    impact. A broken checkout flow loses revenue. A broken login
    blocks all users. E2E tests for critical journeys provide the
    last line of defense before production, catching issues that
    slip through unit and integration testing.

  when_to_run:
    - "Pre-release validation"
    - "After critical flow modifications"
    - "Deployment gate verification"
    - "Quarterly test strategy review"

prerequisites:
  required_artifacts:
    - type: "user_journeys"
      description: "Documented critical user journeys"
    - type: "e2e_tests"
      description: "E2E test suite"

  access_requirements:
    - "Source code repository access"
    - "Product/UX documentation"
    - "Test environment access"

discovery:
  file_patterns:
    - glob: "**/e2e/**/*{login,auth,checkout,payment}*"
      purpose: "Critical journey tests"
    - glob: "**/cypress/**/critical*"
      purpose: "Critical flow tests"

  code_patterns:
    - pattern: "login|checkout|payment|signup|register"
      type: "regex"
      scope: "test"
      purpose: "Critical journey indicators"
    - pattern: "critical|smoke|sanity"
      type: "regex"
      scope: "test"
      purpose: "Test priority markers"

  documents_to_review:
    - type: "User journey maps"
      purpose: "Identify critical paths"
    - type: "Product analytics"
      purpose: "Verify high-traffic flows"

knowledge_sources:
  guides:
    - id: "journey-testing"
      name: "User Journey Testing"
      url: "https://www.nngroup.com/articles/customer-journey-mapping/"
      offline_cache: true
    - id: "smoke-testing"
      name: "Smoke Testing Strategy"
      url: "https://www.guru99.com/smoke-testing.html"
      offline_cache: true

  learning_resources:
    - id: "journey-mapping"
      title: "Customer Journey Mapping"
      type: "book"
      reference: "ISBN 978-0814437148"

tooling:
  static_analysis:
    - tool: "Cypress"
      purpose: "E2E journey testing"
      offline_capable: false
    - tool: "Playwright"
      purpose: "Cross-browser journey testing"
      offline_capable: false

  scripts:
    - id: "journey-coverage"
      language: "bash"
      purpose: "Analyze critical journey coverage"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Critical User Journey Coverage ==="

        echo "Authentication journey tests:"
        grep -r -l 'login\|signin\|authenticate' --include='*.cy.*' --include='*.spec.*' . 2>/dev/null | wc -l

        echo ""
        echo "Registration journey tests:"
        grep -r -l 'signup\|register\|create.*account' --include='*.cy.*' --include='*.spec.*' . 2>/dev/null | wc -l

        echo ""
        echo "Checkout/payment tests:"
        grep -r -l 'checkout\|payment\|purchase\|buy' --include='*.cy.*' --include='*.spec.*' . 2>/dev/null | wc -l

        echo ""
        echo "Core workflow tests:"
        grep -r -l 'workflow\|journey\|flow' --include='*.cy.*' --include='*.spec.*' . 2>/dev/null | wc -l

signals:
  critical:
    - id: "JOURNEY-CRIT-001"
      signal: "Authentication flow lacks E2E coverage"
      evidence_pattern: "No E2E tests for login/logout flows"
      explanation: |
        Authentication is the gateway to the application. A broken
        login blocks all users. E2E tests must verify login works
        end-to-end, including session management and logout.
      remediation: |
        Add authentication journey tests:
        1. Valid login with correct credentials
        2. Invalid login with wrong password
        3. Session persistence across pages
        4. Logout and session termination
        5. Password reset flow
        6. MFA/2FA if applicable

    - id: "JOURNEY-CRIT-002"
      signal: "Revenue-generating flows uncovered"
      evidence_pattern: "Checkout/purchase flows without E2E tests"
      explanation: |
        Revenue-generating flows directly impact business. A broken
        checkout means lost sales. These flows must be tested
        end-to-end before every deployment.
      remediation: |
        Test all revenue flows:
        1. Add to cart journey
        2. Checkout process
        3. Payment processing
        4. Order confirmation
        5. Receipt/email generation

  high:
    - id: "JOURNEY-HIGH-001"
      signal: "Onboarding flow untested"
      evidence_pattern: "Registration/signup without E2E coverage"
      explanation: |
        Onboarding is the first impression. A broken signup loses
        potential customers permanently. The complete journey from
        landing to first value must be tested.
      remediation: |
        Test onboarding journey:
        1. Registration form submission
        2. Email verification (if applicable)
        3. Profile setup
        4. First-use experience
        5. Welcome flow completion

    - id: "JOURNEY-HIGH-002"
      signal: "Core value proposition flows untested"
      evidence_pattern: "Primary product features lack E2E coverage"
      explanation: |
        The core features that differentiate the product must work
        flawlessly. Users came for these features - if they're broken,
        users leave.
      remediation: |
        Identify and test core value flows:
        1. Map primary use cases
        2. Test complete workflows
        3. Verify key outcomes
        4. Test common variations

  medium:
    - id: "JOURNEY-MED-001"
      signal: "Error recovery paths untested"
      evidence_pattern: "No tests for journey interruption and recovery"
      remediation: "Test interrupted journeys: refresh, back button, timeout recovery"

    - id: "JOURNEY-MED-002"
      signal: "Journey variations not covered"
      evidence_pattern: "Only single path through journey tested"
      remediation: "Test common journey branches and alternatives"

  low:
    - id: "JOURNEY-LOW-001"
      signal: "Secondary journeys lack coverage"
      evidence_pattern: "Nice-to-have flows untested"

  positive:
    - id: "JOURNEY-POS-001"
      signal: "All critical journeys fully covered"
      evidence_pattern: "Complete E2E coverage of revenue and auth flows"

    - id: "JOURNEY-POS-002"
      signal: "Journeys tested in CI pipeline"
      evidence_pattern: "Critical journey tests block deployment"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify critical journeys"
      description: |
        Document all business-critical user journeys.
      duration_estimate: "30 min"
      questions:
        - "What journeys generate revenue?"
        - "What journeys are security-critical?"
        - "What are the top user flows by traffic?"
      expected_findings:
        - "Critical journey inventory"
        - "Priority ranking"

    - id: "2"
      name: "Map existing E2E tests"
      description: |
        Inventory E2E tests that cover critical journeys.
      duration_estimate: "25 min"
      commands:
        - purpose: "Find journey-related tests"
          command: "grep -r -l 'login\\|checkout\\|signup' --include='*.cy.*' --include='*.spec.*' . 2>/dev/null"
        - purpose: "List test descriptions"
          command: "grep -r 'describe\\|it\\(' --include='*.cy.*' . 2>/dev/null | grep -i 'journey\\|flow\\|login\\|checkout' | head -20"
      expected_findings:
        - "Test inventory"
        - "Coverage mapping"

    - id: "3"
      name: "Analyze coverage gaps"
      description: |
        Compare critical journeys to test coverage.
      duration_estimate: "25 min"
      commands:
        - purpose: "Check authentication tests"
          command: "find . -path '*e2e*' -name '*auth*' -o -path '*e2e*' -name '*login*' 2>/dev/null"
        - purpose: "Check checkout tests"
          command: "find . -path '*e2e*' -name '*checkout*' -o -path '*e2e*' -name '*payment*' 2>/dev/null"
      expected_findings:
        - "Coverage gaps"
        - "Missing critical tests"

    - id: "4"
      name: "Verify CI integration"
      description: |
        Check that critical journey tests run in CI.
      duration_estimate: "15 min"
      commands:
        - purpose: "Check CI config for E2E"
          command: "grep -r 'e2e\\|cypress\\|playwright' .github/workflows/ .gitlab-ci.yml 2>/dev/null | head -10"
      expected_findings:
        - "CI coverage"
        - "Deployment gates"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "journey_matrix"
      format: "table"
      sections:
        - "Critical Journeys"
        - "Test Coverage Status"
        - "Gap Analysis"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Journey Coverage Analysis"
        - "Priority Recommendations"

  confidence_guidance:
    high: "Complete journey mapping with test verification"
    medium: "Test inventory without full journey mapping"
    low: "Pattern matching only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "journey-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed analysis"
    security:
      included: true
      priority: 1
    production:
      included: true
      priority: 1
    full:
      included: true
      priority: 3

closeout_checklist:
  - id: "journey-001"
    item: "Critical journeys documented"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "List all business-critical user journeys"
    expected: "Confirmed by reviewer"

  - id: "journey-002"
    item: "Coverage mapped to journeys"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Match E2E tests to each critical journey"
    expected: "Confirmed by reviewer"

  - id: "journey-003"
    item: "Gaps prioritized"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Rank uncovered journeys by business impact"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "SOC2"
      controls: ["CC7.1"]
    - framework: "PCI-DSS"
      controls: ["6.5"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.e2e-testing.e2e-test-coverage"
    - "testing-quality-assurance.e2e-testing.e2e-test-stability"
    - "testing-quality-assurance.test-coverage.critical-path-coverage"
