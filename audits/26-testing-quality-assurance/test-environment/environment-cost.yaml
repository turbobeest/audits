audit:
  id: testing-quality-assurance.test-environment.environment-cost
  name: Environment Cost
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: testing-quality-assurance
  category_number: 26
  subcategory: test-environment
  tier: expert
  estimated_duration: 30-45 min
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: low
  scope: cost
  default_profiles:
  - full
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates cost efficiency of test environments including resource
    sizing, lifecycle management, scheduled shutdowns, and waste
    identification. Ensures testing infrastructure costs are
    proportional to value delivered.
  why_it_matters: |
    Test environments can account for significant infrastructure costs,
    especially in cloud. Idle resources, oversized instances, and
    forgotten environments waste money. Cost optimization frees budget
    for other improvements.
  when_to_run:
  - Cost review
  - Budget planning
  - Environment audit
  - Resource optimization
prerequisites:
  required_artifacts:
  - type: infrastructure_config
    description: Infrastructure definitions
  - type: cost_data
    description: Cost reporting if available
  access_requirements:
  - Infrastructure configuration access
  - Cost dashboard access (if available)
discovery:
  file_patterns:
  - glob: '**/terraform/**/*.tf'
    purpose: Infrastructure definitions
  - glob: '**/kubernetes/**/*.yaml'
    purpose: Kubernetes resources
  - glob: '**/docker-compose*.yml'
    purpose: Docker resources
  code_patterns:
  - pattern: 'instance_type|machine_type|resources:'
    type: regex
    scope: config
    purpose: Resource sizing
knowledge_sources:
  guides:
  - id: cost-optimization
    name: Cloud Cost Optimization
    url: https://aws.amazon.com/aws-cost-management/
    offline_cache: true
  - id: resource-rightsizing
    name: Resource Right-Sizing Guide
    url: https://cloud.google.com/compute/docs/instances/rightsizing
    offline_cache: true
  learning_resources:
  - id: finops
    title: FinOps Practices
    type: guide
    reference: Cloud Financial Management
tooling:
  static_analysis:
  - tool: Infracost
    purpose: Infrastructure cost estimation
    offline_capable: false
  - tool: Custom analysis
    purpose: Resource sizing detection
    offline_capable: true
  scripts:
  - id: cost-check
    language: bash
    purpose: Analyze resource sizing
    source: inline
    code: |
      #!/bin/bash
      echo "=== Environment Cost Analysis ==="

      echo "Instance types defined:"
      grep -r -E 'instance_type|machine_type|instanceType' --include='*.tf' --include='*.yaml' . 2>/dev/null | head -10

      echo ""
      echo "Resource limits:"
      grep -r -A5 'resources:' --include='*.yaml' . 2>/dev/null | head -20

      echo ""
      echo "Environment schedules:"
      grep -r 'schedule\|cron' --include='*.tf' --include='*.yaml' . 2>/dev/null | head -5

      echo ""
      echo "Auto-scaling configuration:"
      grep -r 'autoscaling\|replicas' --include='*.tf' --include='*.yaml' . 2>/dev/null | head -10

      echo ""
      echo "TTL/expiration settings:"
      grep -r 'ttl\|expir\|lifetime' --include='*.tf' --include='*.yaml' . 2>/dev/null | head -5
signals:
  critical:
  - id: ENVCOST-CRIT-001
    signal: Runaway environment costs
    evidence_pattern: Costs growing without controls
    explanation: |
      Uncontrolled cost growth indicates waste and lack of governance.
      Without visibility and controls, environments accumulate and
      consume budget meant for other purposes.
    remediation: |
      Implement cost controls:
      1. Set up cost monitoring
      2. Establish budgets and alerts
      3. Tag all resources
      4. Regular cost reviews
      5. Implement approval for expensive resources
  high:
  - id: ENVCOST-HIGH-001
    signal: 24/7 environments with low utilization
    evidence_pattern: Always-on but rarely used
    explanation: |
      Test environments running 24/7 when only used during business
      hours waste up to 70% of their cost. Scheduling shutdowns
      captures significant savings.
    remediation: |
      Implement scheduling:
      - Schedule non-prod environment shutdowns
      - Use on-demand environments
      - Implement auto-stop after idle
      - Convert to ephemeral where possible
  - id: ENVCOST-HIGH-002
    signal: Orphaned environments
    evidence_pattern: Forgotten environments still running
    explanation: |
      Environments created for testing and never cleaned up waste
      money indefinitely. Lifecycle management ensures environments
      are removed when no longer needed.
    remediation: |
      Clean up orphans:
      - Audit all running environments
      - Implement TTL for environments
      - Tag with owner and purpose
      - Regular cleanup automation
  medium:
  - id: ENVCOST-MED-001
    signal: Oversized resources
    evidence_pattern: Production-size instances for test
    remediation: Right-size resources for test workloads
  - id: ENVCOST-MED-002
    signal: No cost visibility
    evidence_pattern: Test costs not tracked separately
    remediation: Tag and track test environment costs
  low:
  - id: ENVCOST-LOW-001
    signal: Cost optimization not documented
    evidence_pattern: No cost-saving measures documented
  positive:
  - id: ENVCOST-POS-001
    signal: Scheduled environment shutdowns
    evidence_pattern: Non-business hours shutdown
  - id: ENVCOST-POS-002
    signal: Ephemeral environments
    evidence_pattern: Environments created and destroyed per PR
procedure:
  context:
    cognitive_mode: evaluative
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Review resource sizing
    description: |
      Check resource configurations for test environments.
    duration_estimate: 10 min
    commands:
    - purpose: Find instance types
      command: grep -r -E 'instance_type|machine_type' --include='*.tf' --include='*.yaml' . 2>/dev/null
        | head -10
    - purpose: Check resource limits
      command: grep -r -A3 'resources:' --include='*.yaml' . 2>/dev/null | head -15
    expected_findings:
    - Resource sizing
    - Over-provisioning
  - id: '2'
    name: Check lifecycle management
    description: |
      Look for environment lifecycle controls.
    duration_estimate: 10 min
    commands:
    - purpose: Find TTL settings
      command: grep -r 'ttl\|expir' --include='*.tf' --include='*.yaml' . 2>/dev/null | head -5
    - purpose: Find schedules
      command: grep -r 'schedule\|cron' --include='*.tf' --include='*.yaml' . 2>/dev/null | head -5
    expected_findings:
    - Lifecycle automation
    - Scheduling status
  - id: '3'
    name: Assess cost visibility
    description: |
      Evaluate cost tracking and visibility.
    duration_estimate: 10 min
    questions:
    - Are test environment costs tracked?
    - Is there a budget for test infrastructure?
    - Who reviews test environment costs?
    expected_findings:
    - Cost visibility
    - Budget status
  - id: '4'
    name: Identify waste
    description: |
      Look for obvious waste indicators.
    duration_estimate: 10 min
    questions:
    - Are there idle environments?
    - Are environments properly tagged?
    - When was last cleanup?
    expected_findings:
    - Waste indicators
    - Cleanup status
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: cost_report
    format: table
    sections:
    - Resource Sizing
    - Lifecycle Management
    - Cost Optimization Opportunities
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Cost Analysis
    - Recommendations
  confidence_guidance:
    high: Full cost analysis with billing data
    medium: Configuration analysis
    low: Pattern detection only
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: cost-optimization
      priority: recommended
profiles:
  membership:
    quick:
      included: false
      reason: Requires cost analysis
    full:
      included: true
      priority: 7
closeout_checklist:
- id: envcost-001
  item: Resource sizing reviewed
  level: WARNING
  verification: grep -r 'instance_type\|resources:' --include='*.tf' --include='*.yaml' . 2>/dev/null
    | wc -l
  expected: Count documented
- id: envcost-002
  item: Lifecycle management assessed
  level: WARNING
  verification: grep -r 'ttl\|schedule' --include='*.tf' --include='*.yaml' . 2>/dev/null | wc -l
  expected: Count documented
- id: envcost-003
  item: Cost optimization opportunities identified
  level: RECOMMENDED
  verification: manual
  verification_notes: Document potential savings
  expected: Opportunities listed
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: FinOps
    controls:
    - Cost Visibility
    - Cost Optimization
relationships:
  commonly_combined:
  - testing-quality-assurance.test-environment.environment-provisioning
  - cost-economics.cost-visibility.resource-tagging
  - infrastructure-iaac.resource-management.resource-lifecycle
