audit:
  id: testing-quality-assurance.security-testing.secret-scanning
  name: Secret Scanning
  version: 1.0.0
  last_updated: '2026-01-22'
  status: active
  category: testing-quality-assurance
  category_number: 26
  subcategory: security-testing
  tier: expert
  estimated_duration: 30-60 min
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: 'yes'
  severity: critical
  scope: security
  default_profiles:
  - full
  - security
  - quick
  blocks_phase: true
  parallelizable: true
description:
  what: |
    Evaluates secret scanning implementation including detection of
    API keys, passwords, tokens, and other sensitive credentials in
    source code. Assesses pre-commit hooks, CI/CD integration, and
    historical repository scanning.
  why_it_matters: |
    Leaked secrets are a top cause of data breaches. Once a credential
    is in git history, it's extremely difficult to fully remove.
    Attackers actively scan public repositories for secrets. Automated
    detection prevents costly credential rotation and potential breaches.
  when_to_run:
  - Repository setup
  - Security audit preparation
  - After suspected secret exposure
  - Regular security review
prerequisites:
  required_artifacts:
  - type: source_code
    description: Source code repository
  access_requirements:
  - Source code repository access
  - Git history access
discovery:
  file_patterns:
  - glob: '**/.gitleaks*'
    purpose: Gitleaks configuration
  - glob: '**/.pre-commit-config.yaml'
    purpose: Pre-commit hook configuration
  code_patterns:
  - pattern: gitleaks|trufflehog|detect-secrets|git-secrets
    type: regex
    scope: config
    purpose: Secret scanning tools
  - pattern: password|secret|api_key|token
    type: regex
    scope: source
    purpose: Potential hardcoded secrets
knowledge_sources:
  guides:
  - id: secret-scanning
    name: Secret Scanning Guide
    url: https://docs.github.com/en/code-security/secret-scanning
    offline_cache: true
  - id: gitleaks
    name: Gitleaks Documentation
    url: https://github.com/gitleaks/gitleaks
    offline_cache: true
  learning_resources:
  - id: secrets-management
    title: Secrets Management Best Practices
    type: article
    reference: https://owasp.org/www-community/controls/Secrets_Management
tooling:
  static_analysis:
  - tool: Gitleaks
    purpose: Open-source secret scanning
    offline_capable: true
  - tool: TruffleHog
    purpose: Git history secret scanning
    offline_capable: true
  - tool: detect-secrets
    purpose: Yelp secret detection
    offline_capable: true
  - tool: GitHub Secret Scanning
    purpose: Native GitHub scanning
    offline_capable: false
  scripts:
  - id: secret-scan
    language: bash
    purpose: Run secret scanning
    source: inline
    code: |
      #!/bin/bash
      echo "=== Secret Scanning Analysis ==="

      echo "Gitleaks configuration:"
      find . -name '.gitleaks*' 2>/dev/null

      echo ""
      echo "Pre-commit hooks:"
      cat .pre-commit-config.yaml 2>/dev/null | grep -A5 'gitleaks\|secrets'

      echo ""
      echo "Running gitleaks (if available):"
      gitleaks detect --source . 2>/dev/null | head -20 || echo "gitleaks not installed"

      echo ""
      echo "Potential secrets in code (basic pattern):"
      grep -r -n -E '(password|secret|api_key|token)\s*[=:]\s*["\047][^"\047]+["\047]' --include='*.{js,ts,py,java,go}' . 2>/dev/null | head -10
signals:
  critical:
  - id: SECRET-CRIT-001
    signal: No secret scanning configured
    evidence_pattern: No secret detection tools or pre-commit hooks
    explanation: |
      Without secret scanning, credentials can be committed and
      pushed without detection. Once in remote history, secrets
      are extremely difficult to fully purge and may already be
      compromised.
    remediation: |
      Implement secret scanning:
      1. Install Gitleaks or equivalent
      2. Add pre-commit hook for local detection
      3. Add CI scanning for repository
      4. Enable GitHub Secret Scanning if applicable
      5. Scan git history for existing secrets
  - id: SECRET-CRIT-002
    signal: Secrets detected in repository
    evidence_pattern: Active secrets found in code or history
    explanation: |
      Detected secrets indicate active security risk. The credentials
      may already be compromised and require immediate rotation.
      Historical secrets in git require repository cleanup.
    remediation: |
      Respond to detected secrets:
      1. Immediately rotate affected credentials
      2. Remove secrets from current code
      3. Consider git history cleanup (BFG or filter-branch)
      4. Audit access logs for compromise
      5. Implement proper secrets management
  high:
  - id: SECRET-HIGH-001
    signal: Pre-commit hooks not configured
    evidence_pattern: Secret scanning only in CI, not locally
    explanation: |
      Without pre-commit hooks, secrets reach the remote repository
      before detection. Local detection prevents secrets from ever
      entering git history.
    remediation: |
      Add pre-commit hooks:
      1. Install pre-commit framework
      2. Add gitleaks or detect-secrets hook
      3. Configure to run on commit
      4. Share configuration with team
  - id: SECRET-HIGH-002
    signal: Git history not scanned
    evidence_pattern: Only current branch scanned
    explanation: |
      Secrets in git history are as dangerous as current secrets.
      Attackers can access historical commits. Full history scanning
      catches legacy exposures.
    remediation: |
      Scan full git history:
      - Run gitleaks with --all-refs
      - Use TruffleHog for deep history scan
      - Check all branches and tags
      - Document and remediate findings
  medium:
  - id: SECRET-MED-001
    signal: Custom patterns not configured
    evidence_pattern: Only default secret patterns used
    remediation: Add custom patterns for internal secret formats
  - id: SECRET-MED-002
    signal: False positives not managed
    evidence_pattern: No allowlist or baseline configuration
    remediation: Configure allowlists for known false positives
  low:
  - id: SECRET-LOW-001
    signal: Secret scanning results not tracked
    evidence_pattern: No trending of findings over time
  positive:
  - id: SECRET-POS-001
    signal: Comprehensive secret scanning
    evidence_pattern: Pre-commit + CI + history scanning
  - id: SECRET-POS-002
    signal: Zero secrets detected
    evidence_pattern: Clean scan across all history
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Check scanning tools
    description: |
      Identify secret scanning tools and configuration.
    duration_estimate: 10 min
    commands:
    - purpose: Find gitleaks config
      command: find . -name '.gitleaks*' 2>/dev/null || echo 'No gitleaks config'
    - purpose: Check pre-commit
      command: cat .pre-commit-config.yaml 2>/dev/null | grep -A5 'gitleaks\|secrets'
    expected_findings:
    - Tool configuration
    - Hook setup
  - id: '2'
    name: Run secret scan
    description: |
      Execute secret scanning on repository.
    duration_estimate: 15 min
    commands:
    - purpose: Run gitleaks
      command: gitleaks detect --source . 2>/dev/null || echo 'Install gitleaks'
    - purpose: Quick pattern check
      command: grep -r -n 'api_key\|secret.*=' --include='*.{js,py,env}' . 2>/dev/null | head -15
    expected_findings:
    - Detected secrets
    - Potential false positives
  - id: '3'
    name: Verify CI integration
    description: |
      Confirm secret scanning runs in CI.
    duration_estimate: 10 min
    commands:
    - purpose: Check CI for scanning
      command: grep -r 'gitleaks\|trufflehog\|secrets' .github/workflows/ 2>/dev/null
    expected_findings:
    - CI integration
    - Blocking configuration
  - id: '4'
    name: Check git history
    description: |
      Determine if full history has been scanned.
    duration_estimate: 10 min
    questions:
    - Has full git history been scanned?
    - When was the last full history scan?
    - Were any historical secrets found?
    expected_findings:
    - History scanning status
    - Historical findings
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: secret_report
    format: table
    sections:
    - Detected Secrets
    - Tool Configuration
    - History Coverage
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Secret Scan Analysis
    - Remediation Actions
  confidence_guidance:
    high: Live scan with history verification
    medium: Current code scan only
    low: Configuration analysis only
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: secret-scanning
      priority: required
profiles:
  membership:
    quick:
      included: true
      reason: Fast and critical check
    security:
      included: true
      priority: 1
    full:
      included: true
      priority: 2
closeout_checklist:
- id: secret-001
  item: Secret scanning configured
  level: CRITICAL
  verification: test -f .gitleaks.toml -o -f .pre-commit-config.yaml && echo PASS || echo FAIL
  expected: PASS
- id: secret-002
  item: Repository scanned
  level: CRITICAL
  verification: gitleaks detect --source . 2>/dev/null && echo PASS || echo 'Run manually'
  expected: PASS (no secrets)
- id: secret-003
  item: Pre-commit hooks active
  level: WARNING
  verification: cat .pre-commit-config.yaml 2>/dev/null | grep -c 'gitleaks\|secrets'
  expected: Count > 0
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: PCI-DSS
    controls:
    - '3.4'
    - 6.5.3
  - framework: SOC2
    controls:
    - CC6.1
  - framework: GDPR
    controls:
    - Art. 32
relationships:
  commonly_combined:
  - testing-quality-assurance.security-testing.sast-integration
  - security-trust.secrets-management.secrets-storage
  - security-trust.access-control.credential-management
