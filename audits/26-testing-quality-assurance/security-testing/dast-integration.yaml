# ============================================================
# AUDIT: DAST Integration
# ============================================================
# Evaluates Dynamic Application Security Testing integration
# for runtime vulnerability detection.
# ============================================================

audit:
  id: "testing-quality-assurance.security-testing.dast-integration"
  name: "DAST Integration"
  version: "1.0.0"
  last_updated: "2026-01-22"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 26
  subcategory: "security-testing"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "yes"
  severity: "critical"
  scope: "security"

  default_profiles:
    - "full"
    - "security"
    - "production"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Evaluates Dynamic Application Security Testing (DAST) integration
    which tests running applications for security vulnerabilities.
    Assesses tool configuration, scan coverage, CI/CD integration,
    and finding management. DAST finds runtime vulnerabilities that
    SAST misses.

  why_it_matters: |
    DAST finds vulnerabilities that only appear at runtime: configuration
    issues, authentication flaws, and injection vulnerabilities that
    require actual execution. DAST tests the application as an attacker
    would, finding issues before attackers do.

  when_to_run:
    - "Pre-deployment security validation"
    - "Security tool evaluation"
    - "Compliance audit preparation"
    - "After major releases"

prerequisites:
  required_artifacts:
    - type: "running_application"
      description: "Deployable application"
    - type: "ci_config"
      description: "CI/CD pipeline configuration"

  access_requirements:
    - "Application deployment capability"
    - "DAST tool access"
    - "CI/CD configuration access"

discovery:
  file_patterns:
    - glob: "**/zap*"
      purpose: "OWASP ZAP configuration"
    - glob: "**/.dast*"
      purpose: "DAST configuration"

  code_patterns:
    - pattern: "zap|owasp|burp|nuclei|dast"
      type: "regex"
      scope: "config"
      purpose: "DAST tool configuration"

knowledge_sources:
  specifications:
    - id: "owasp-dast"
      name: "OWASP DAST Tools"
      url: "https://owasp.org/www-community/Vulnerability_Scanning_Tools"
      offline_cache: true
      priority: "required"

  guides:
    - id: "dast-guide"
      name: "DAST Implementation Guide"
      url: "https://owasp.org/www-project-devsecops-guideline/latest/02c-Dynamic-Application-Security-Testing"
      offline_cache: true
    - id: "zap-guide"
      name: "OWASP ZAP Getting Started"
      url: "https://www.zaproxy.org/getting-started/"
      offline_cache: true

  learning_resources:
    - id: "appsec-testing"
      title: "Application Security Testing"
      type: "course"
      reference: "OWASP Application Security Verification Standard"

tooling:
  infrastructure_tools:
    - tool: "OWASP ZAP"
      purpose: "Open-source DAST"
      offline_capable: true
    - tool: "Burp Suite"
      purpose: "Enterprise DAST"
      offline_capable: true
    - tool: "Nuclei"
      purpose: "Fast vulnerability scanner"
      offline_capable: true
    - tool: "Nikto"
      purpose: "Web server scanner"
      offline_capable: true

  scripts:
    - id: "dast-check"
      language: "bash"
      purpose: "Check DAST configuration"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== DAST Integration Analysis ==="

        echo "ZAP configuration:"
        find . -name '*zap*' 2>/dev/null | head -10

        echo ""
        echo "DAST in CI/CD:"
        grep -r -l 'zap\|dast\|nuclei' .github/workflows/ .gitlab-ci.yml 2>/dev/null

        echo ""
        echo "Security scan configs:"
        find . -name '*security*' -name '*.yaml' 2>/dev/null | head -10

signals:
  critical:
    - id: "DAST-CRIT-001"
      signal: "No DAST tool configured"
      evidence_pattern: "No DAST configuration or integration"
      explanation: |
        Without DAST, runtime vulnerabilities go undetected until
        exploitation. Configuration issues, authentication bypasses,
        and injection flaws that require execution to detect remain
        hidden.
      remediation: |
        Implement DAST:
        1. Choose tool (ZAP for open-source, commercial for enterprise)
        2. Configure scan scope and authentication
        3. Enable active and passive scanning
        4. Integrate into CI/CD pipeline
        5. Set up finding triage

    - id: "DAST-CRIT-002"
      signal: "DAST not scanning authenticated areas"
      evidence_pattern: "Only unauthenticated scanning configured"
      explanation: |
        Most application functionality requires authentication. DAST
        that only scans login pages misses vulnerabilities in the
        actual application features users access.
      remediation: |
        Configure authenticated scanning:
        - Provide valid test credentials
        - Configure session management
        - Scan all authenticated endpoints
        - Test role-based access controls

  high:
    - id: "DAST-HIGH-001"
      signal: "DAST not integrated in CI/CD"
      evidence_pattern: "Manual DAST execution only"
      explanation: |
        Manual DAST is inconsistent and often skipped. Automated
        DAST in CI ensures every deployment is scanned, catching
        regressions immediately.
      remediation: |
        Automate DAST in CI:
        - Deploy application in CI environment
        - Run DAST scans automatically
        - Fail on critical findings
        - Store scan results as artifacts

    - id: "DAST-HIGH-002"
      signal: "API endpoints not scanned"
      evidence_pattern: "Only web UI scanning, no API testing"
      explanation: |
        Modern applications have significant API surface. APIs
        often lack the validation present in UIs. DAST must cover
        both web and API endpoints.
      remediation: |
        Add API scanning:
        - Import OpenAPI/Swagger specifications
        - Configure API authentication
        - Scan all API endpoints
        - Test for API-specific vulnerabilities

  medium:
    - id: "DAST-MED-001"
      signal: "Scan scope too limited"
      evidence_pattern: "Only scanning subset of application"
      remediation: "Expand scan scope to cover full application"

    - id: "DAST-MED-002"
      signal: "Active scanning disabled"
      evidence_pattern: "Passive scanning only"
      remediation: "Enable active scanning for deeper vulnerability detection"

  low:
    - id: "DAST-LOW-001"
      signal: "DAST results not trending"
      evidence_pattern: "No historical scan comparison"

  positive:
    - id: "DAST-POS-001"
      signal: "Comprehensive DAST coverage"
      evidence_pattern: "Authenticated scans in CI with full scope"

    - id: "DAST-POS-002"
      signal: "Regular scheduled scans"
      evidence_pattern: "DAST running on schedule and deployments"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify DAST tools"
      description: |
        Find DAST tools configured for the project.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find DAST configs"
          command: "find . -name '*zap*' -o -name '*dast*' 2>/dev/null"
        - purpose: "Check CI for DAST"
          command: "grep -r 'zap\\|dast\\|nuclei' .github/workflows/ 2>/dev/null"
      expected_findings:
        - "DAST tool identification"
        - "Integration status"

    - id: "2"
      name: "Review scan configuration"
      description: |
        Analyze DAST scan settings and scope.
      duration_estimate: "20 min"
      commands:
        - purpose: "Check ZAP config"
          command: "cat zap*.yaml 2>/dev/null | head -30"
      expected_findings:
        - "Scan scope"
        - "Authentication config"

    - id: "3"
      name: "Verify CI integration"
      description: |
        Confirm DAST runs in deployment pipeline.
      duration_estimate: "15 min"
      commands:
        - purpose: "Check CI workflow"
          command: "cat .github/workflows/*.yml 2>/dev/null | grep -A10 -i 'dast\\|zap'"
      expected_findings:
        - "CI integration"
        - "Automation status"

    - id: "4"
      name: "Review scan history"
      description: |
        Examine recent DAST scan results.
      duration_estimate: "20 min"
      questions:
        - "When was the last scan?"
        - "What findings were discovered?"
        - "Are findings being remediated?"
      expected_findings:
        - "Scan frequency"
        - "Finding status"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "dast_report"
      format: "table"
      sections:
        - "Tool Configuration"
        - "Scan Coverage"
        - "CI Integration"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "DAST Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Full configuration review with scan results"
    medium: "Configuration analysis"
    low: "Pattern matching only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "owasp-dast"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires runtime analysis"
    security:
      included: true
      priority: 2
    production:
      included: true
      priority: 3
    full:
      included: true
      priority: 5

closeout_checklist:
  - id: "dast-001"
    item: "DAST tool identified"
    level: "CRITICAL"
    verification: "find . -name '*zap*' -o -name '*dast*' 2>/dev/null | wc -l"
    expected: "Count documented"

  - id: "dast-002"
    item: "CI integration verified"
    level: "BLOCKING"
    verification: "grep -r 'zap\\|dast' .github/workflows/ 2>/dev/null | wc -l"
    expected: "Count documented"

  - id: "dast-003"
    item: "Authenticated scanning confirmed"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Verify DAST scans authenticated endpoints"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "PCI-DSS"
      controls: ["6.6", "11.3"]
    - framework: "SOC2"
      controls: ["CC7.1"]
    - framework: "OWASP ASVS"
      controls: ["14.2"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.security-testing.sast-integration"
    - "testing-quality-assurance.security-testing.penetration-test-coverage"
    - "security-trust.vulnerability-management.vulnerability-scanning"
