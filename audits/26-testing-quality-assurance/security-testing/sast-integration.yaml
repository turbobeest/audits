# ============================================================
# AUDIT: SAST Integration
# ============================================================
# Evaluates Static Application Security Testing integration
# in the development workflow.
# ============================================================

audit:
  id: "testing-quality-assurance.security-testing.sast-integration"
  name: "SAST Integration"
  version: "1.0.0"
  last_updated: "2026-01-22"
  status: "active"

  category: "testing-quality-assurance"
  category_number: 26
  subcategory: "security-testing"

  tier: "expert"
  estimated_duration: "1-2 hours"  # median: 1h

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "yes"
  severity: "critical"
  scope: "security"

  default_profiles:
    - "full"
    - "security"
    - "production"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Evaluates Static Application Security Testing (SAST) integration
    including tool configuration, rule coverage, CI/CD pipeline
    integration, finding triage processes, and false positive
    management. SAST analyzes source code for security vulnerabilities
    without executing the application.

  why_it_matters: |
    SAST catches security vulnerabilities early in development when
    they're cheapest to fix. SQL injection, XSS, and other common
    vulnerabilities can be detected before code is deployed. Without
    SAST, security issues are discovered through exploits or expensive
    penetration testing.

  when_to_run:
    - "CI/CD pipeline setup"
    - "Security tool evaluation"
    - "Compliance audit preparation"
    - "Security posture review"

prerequisites:
  required_artifacts:
    - type: "source_code"
      description: "Source code repository"
    - type: "ci_config"
      description: "CI/CD pipeline configuration"

  access_requirements:
    - "Source code repository access"
    - "CI/CD configuration access"
    - "SAST tool configuration"

discovery:
  file_patterns:
    - glob: "**/.semgrep*"
      purpose: "Semgrep configuration"
    - glob: "**/sonar-project.properties"
      purpose: "SonarQube configuration"
    - glob: "**/.snyk"
      purpose: "Snyk configuration"

  code_patterns:
    - pattern: "semgrep|sonarqube|fortify|checkmarx|snyk"
      type: "regex"
      scope: "config"
      purpose: "SAST tool configuration"

knowledge_sources:
  specifications:
    - id: "owasp-sast"
      name: "OWASP Source Code Analysis Tools"
      url: "https://owasp.org/www-community/Source_Code_Analysis_Tools"
      offline_cache: true
      priority: "required"

  guides:
    - id: "sast-guide"
      name: "SAST Implementation Guide"
      url: "https://owasp.org/www-project-devsecops-guideline/latest/02b-Static-Application-Security-Testing"
      offline_cache: true

  learning_resources:
    - id: "devsecops"
      title: "DevSecOps Handbook"
      type: "book"
      reference: "ISBN 978-1788995504"

tooling:
  static_analysis:
    - tool: "Semgrep"
      purpose: "Open-source SAST"
      offline_capable: true
    - tool: "SonarQube"
      purpose: "Enterprise SAST"
      offline_capable: false
    - tool: "CodeQL"
      purpose: "GitHub SAST"
      offline_capable: true
    - tool: "Snyk Code"
      purpose: "Developer-friendly SAST"
      offline_capable: false
    - tool: "Checkmarx"
      purpose: "Enterprise SAST"
      offline_capable: false

  scripts:
    - id: "sast-check"
      language: "bash"
      purpose: "Check SAST configuration"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== SAST Integration Analysis ==="

        echo "Semgrep configuration:"
        find . -name '.semgrep*' 2>/dev/null

        echo ""
        echo "SonarQube configuration:"
        find . -name 'sonar*' 2>/dev/null

        echo ""
        echo "SAST in CI/CD:"
        grep -r -l 'semgrep\|sonar\|codeql\|snyk' .github/workflows/ .gitlab-ci.yml 2>/dev/null

        echo ""
        echo "Security rules:"
        grep -r 'security\|vuln\|owasp' --include='*.yaml' --include='*.yml' . 2>/dev/null | head -10

signals:
  critical:
    - id: "SAST-CRIT-001"
      signal: "No SAST tool configured"
      evidence_pattern: "No SAST configuration or CI integration"
      explanation: |
        Without SAST, security vulnerabilities in code are undetected
        until runtime exploits or manual review. Common issues like
        SQL injection and XSS are easily caught by SAST but devastating
        in production.
      remediation: |
        Implement SAST:
        1. Choose tool (Semgrep for open-source, SonarQube for enterprise)
        2. Configure for your languages
        3. Enable security rule sets
        4. Integrate into CI pipeline
        5. Establish finding triage process

    - id: "SAST-CRIT-002"
      signal: "SAST not blocking on critical findings"
      evidence_pattern: "SAST runs but doesn't fail builds"
      explanation: |
        SAST that doesn't block deployments is advisory only. Teams
        may ignore findings, allowing vulnerabilities to ship. Critical
        security findings must block deployment.
      remediation: |
        Configure blocking:
        - Fail CI on critical/high severity findings
        - Require review and resolution before merge
        - Track finding resolution time
        - Escalate unresolved critical findings

  high:
    - id: "SAST-HIGH-001"
      signal: "Security rule sets not enabled"
      evidence_pattern: "SAST configured but security rules disabled"
      explanation: |
        Default SAST configurations may focus on code quality, not
        security. Specific security rule sets must be enabled to
        catch vulnerabilities.
      remediation: |
        Enable security rules:
        - OWASP Top 10 rules
        - CWE-focused rule sets
        - Language-specific security rules
        - Custom rules for application patterns

    - id: "SAST-HIGH-002"
      signal: "Findings not triaged regularly"
      evidence_pattern: "Backlog of unreviewed SAST findings"
      explanation: |
        SAST generates false positives. Without triage, real issues
        get buried and teams lose trust in the tool. Regular triage
        separates actionable findings from noise.
      remediation: |
        Establish triage process:
        - Assign finding owners
        - Review new findings weekly
        - Suppress confirmed false positives
        - Track mean time to resolution

  medium:
    - id: "SAST-MED-001"
      signal: "SAST not running on pull requests"
      evidence_pattern: "SAST only on main branch"
      remediation: "Add SAST to PR checks for shift-left security"

    - id: "SAST-MED-002"
      signal: "Custom rules not implemented"
      evidence_pattern: "Only using default rule sets"
      remediation: "Add custom rules for application-specific patterns"

  low:
    - id: "SAST-LOW-001"
      signal: "SAST results not tracked over time"
      evidence_pattern: "No security trend analysis"

  positive:
    - id: "SAST-POS-001"
      signal: "Comprehensive SAST integration"
      evidence_pattern: "SAST on PRs with blocking enabled"

    - id: "SAST-POS-002"
      signal: "Low false positive rate"
      evidence_pattern: "Tuned rules with active triage"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify SAST tools"
      description: |
        Find SAST tools configured for the project.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find SAST configs"
          command: "find . -name '.semgrep*' -o -name 'sonar*' -o -name '.snyk' 2>/dev/null"
        - purpose: "Check CI for SAST"
          command: "grep -r 'semgrep\\|sonar\\|codeql' .github/workflows/ 2>/dev/null"
      expected_findings:
        - "SAST tool identification"
        - "Integration status"

    - id: "2"
      name: "Review rule configuration"
      description: |
        Analyze which security rules are enabled.
      duration_estimate: "20 min"
      commands:
        - purpose: "Check semgrep rules"
          command: "cat .semgrep.yaml 2>/dev/null | head -30"
        - purpose: "Check sonar rules"
          command: "cat sonar-project.properties 2>/dev/null"
      expected_findings:
        - "Enabled rule sets"
        - "Security coverage"

    - id: "3"
      name: "Verify CI integration"
      description: |
        Confirm SAST runs in CI/CD pipeline.
      duration_estimate: "15 min"
      commands:
        - purpose: "Check CI workflow"
          command: "cat .github/workflows/*.yml 2>/dev/null | grep -A10 -i 'sast\\|semgrep\\|sonar'"
      expected_findings:
        - "CI integration"
        - "Blocking configuration"

    - id: "4"
      name: "Assess finding management"
      description: |
        Review how SAST findings are handled.
      duration_estimate: "15 min"
      questions:
        - "How are findings triaged?"
        - "What is the finding backlog?"
        - "Are false positives suppressed?"
      expected_findings:
        - "Triage process"
        - "Finding backlog status"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "sast_report"
      format: "table"
      sections:
        - "Tool Configuration"
        - "Rule Coverage"
        - "CI Integration"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "SAST Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Full configuration review with CI verification"
    medium: "Configuration analysis"
    low: "Pattern matching only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "owasp-sast"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed analysis"
    security:
      included: true
      priority: 1
    production:
      included: true
      priority: 2
    full:
      included: true
      priority: 3

closeout_checklist:
  - id: "sast-001"
    item: "SAST tool identified"
    level: "CRITICAL"
    verification: "find . -name '.semgrep*' -o -name 'sonar*' 2>/dev/null | wc -l"
    expected: "Count > 0"

  - id: "sast-002"
    item: "CI integration verified"
    level: "BLOCKING"
    verification: "grep -r 'semgrep\\|sonar' .github/workflows/ 2>/dev/null | wc -l"
    expected: "Count > 0"

  - id: "sast-003"
    item: "Blocking on findings confirmed"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Verify SAST fails builds on critical findings"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "PCI-DSS"
      controls: ["6.3.2"]
    - framework: "SOC2"
      controls: ["CC7.1"]
    - framework: "ISO 27001"
      controls: ["A.14.2.1"]

relationships:
  commonly_combined:
    - "testing-quality-assurance.security-testing.dast-integration"
    - "testing-quality-assurance.security-testing.dependency-scanning"
    - "security-trust.secure-development.secure-coding-practices"
