# ============================================================
# AUDIT: Uptime Monitoring Audit
# ============================================================

audit:
  id: "reliability-resilience.high-availability.uptime-monitoring"
  name: "Uptime Monitoring Audit"
  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "reliability-resilience"
  category_number: 3
  subcategory: "high-availability"

  tier: "expert"
  estimated_duration: "2 hours"

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "infrastructure"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the uptime monitoring infrastructure including external
    synthetic monitoring, internal health checks, alerting configurations,
    and the comprehensiveness of monitoring coverage across all critical
    endpoints and services.

  why_it_matters: |
    Uptime monitoring is the foundation of availability management. Without
    comprehensive monitoring, outages go undetected, MTTR increases, and
    SLA measurements become unreliable. External monitoring validates the
    customer experience while internal monitoring enables rapid diagnosis.
    Gaps in monitoring coverage create blind spots where failures hide.

  when_to_run:
    - "During production readiness review"
    - "After adding new services or endpoints"
    - "When monitoring alerts seem noisy or incomplete"
    - "Following undetected outages"

prerequisites:
  required_artifacts:
    - type: "infrastructure"
      description: "Access to monitoring systems configuration"
    - type: "documentation"
      description: "Service catalog listing all production endpoints"

  access_requirements:
    - "Access to monitoring platform (Datadog, New Relic, Pingdom, etc.)"
    - "Access to alerting configuration"
    - "Access to service discovery or endpoint inventory"

discovery:
  file_patterns:
    - glob: "**/monitoring/**/*.yaml"
      purpose: "Find monitoring configuration files"
    - glob: "**/alerts/**/*.yaml"
      purpose: "Find alerting rules"

  metrics_queries:
    - system: "Prometheus"
      query: "up"
      purpose: "Identify all monitored targets"
      threshold: "All critical services should be present"
    - system: "Any synthetic monitoring"
      query: "List of monitored endpoints"
      purpose: "Verify external monitoring coverage"
      threshold: "All public endpoints should have synthetic checks"

knowledge_sources:
  guides:
    - id: "google-sre-monitoring"
      name: "Google SRE Book - Monitoring Distributed Systems"
      url: "https://sre.google/sre-book/monitoring-distributed-systems/"
      offline_cache: true

  learning_resources:
    - id: "observability-engineering"
      title: "Observability Engineering"
      type: "book"
      reference: "O'Reilly Media, 2022"

tooling:
  infrastructure_tools:
    - tool: "curl"
      purpose: "Test endpoint availability"
      command: "curl -s -o /dev/null -w '%{http_code}' https://example.com/health"

  monitoring_queries:
    - system: "Prometheus"
      query: "count by (job) (up == 1)"
      purpose: "Count healthy targets by job"

signals:
  critical:
    - id: "HA-MON-CRIT-001"
      signal: "No external synthetic monitoring configured"
      evidence_indicators:
        - "No third-party uptime monitoring service in use"
        - "All monitoring is internal to the infrastructure"
      explanation: |
        External monitoring validates the actual customer experience and
        detects issues invisible to internal monitoring (DNS, CDN, network path).
      remediation: "Implement external synthetic monitoring from multiple geographic locations"

    - id: "HA-MON-CRIT-002"
      signal: "Critical endpoints have no monitoring"
      evidence_indicators:
        - "Production endpoints not in monitoring inventory"
        - "Health check endpoints return errors"
      explanation: |
        Unmonitored endpoints can fail silently, extending outage duration
        and impacting customers without triggering alerts.
      remediation: "Add monitoring for all critical endpoints with appropriate check intervals"

  high:
    - id: "HA-MON-HIGH-001"
      signal: "Monitoring check intervals too long for SLA requirements"
      explanation: "Long check intervals delay outage detection, impacting MTTR"
      remediation: "Reduce check intervals to align with SLA detection requirements"

    - id: "HA-MON-HIGH-002"
      signal: "No alerting configured for uptime failures"
      explanation: "Monitoring without alerting requires manual observation to detect issues"
      remediation: "Configure alerts that notify on-call teams of availability failures"

  medium:
    - id: "HA-MON-MED-001"
      signal: "Monitoring from single geographic location only"
      remediation: "Add monitoring from multiple regions to detect localized issues"

    - id: "HA-MON-MED-002"
      signal: "No distinction between service degradation and complete outage"
      remediation: "Implement tiered alerting based on impact severity"

  low:
    - id: "HA-MON-LOW-001"
      signal: "Monitoring configuration not version controlled"

  positive:
    - id: "HA-MON-POS-001"
      signal: "Multi-region synthetic monitoring with proper coverage"
    - id: "HA-MON-POS-002"
      signal: "Alert routing based on service ownership"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Critical Endpoints"
      description: |
        Create or verify a complete list of all production endpoints
        that require uptime monitoring.
      duration_estimate: "30 min"
      questions:
        - "What are all the public-facing endpoints?"
        - "What internal services are critical to system function?"
        - "Are there API endpoints that need monitoring?"
      expected_findings:
        - "Complete endpoint inventory"
        - "Criticality classification of each endpoint"

    - id: "2"
      name: "Review External Monitoring"
      description: |
        Examine external synthetic monitoring configuration and coverage.
      duration_estimate: "30 min"
      commands:
        - purpose: "List configured synthetic checks"
          command: "Check monitoring platform UI or API for configured checks"
      expected_findings:
        - "List of externally monitored endpoints"
        - "Check intervals and timeout configurations"
        - "Geographic distribution of monitoring nodes"

    - id: "3"
      name: "Verify Internal Monitoring"
      description: |
        Review internal health checks and their integration with
        orchestration and load balancing systems.
      duration_estimate: "30 min"
      commands:
        - purpose: "Check Kubernetes liveness/readiness probes"
          command: "kubectl get pods -o jsonpath='{range .items[*]}{.spec.containers[*].livenessProbe}{end}'"
      expected_findings:
        - "Health check endpoint configurations"
        - "Probe configurations in orchestration"

    - id: "4"
      name: "Assess Alerting Configuration"
      description: |
        Review alert rules, thresholds, and notification routing
        for uptime-related issues.
      duration_estimate: "30 min"
      expected_findings:
        - "Alert thresholds and escalation policies"
        - "On-call notification channels"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Monitoring Coverage Analysis"
        - "Alerting Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Full access to monitoring systems with verification of configurations"
    medium: "Partial access or documentation-based review"
    low: "Interview-based assessment without direct system access"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "google-sre-monitoring"
        priority: "required"

profiles:
  membership:
    quick:
      included: true
      priority: 2
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "uptime-monitoring-001"
    item: "External synthetic monitoring is configured"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Confirm third-party monitoring service is active"
    expected: "Confirmed by reviewer"

  - id: "uptime-monitoring-002"
    item: "All critical endpoints have monitoring"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Cross-reference endpoint inventory with monitoring configuration"
    expected: "Confirmed by reviewer"

  - id: "uptime-monitoring-003"
    item: "Alerts are configured for availability failures"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify alert rules exist for uptime checks"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "SOC 2"
      controls: ["CC7.2"]

relationships:
  commonly_combined:
    - "reliability-resilience.high-availability.availability-sla"
    - "reliability-resilience.high-availability.health-check"
