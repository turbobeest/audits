audit:
  id: reliability-resilience.data-consistency.eventual-consistency
  name: Eventual Consistency Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: reliability-resilience
  category_number: 3
  subcategory: data-consistency
  tier: phd
  estimated_duration: 4 hours
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: data
  default_profiles:
  - full
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates systems using eventual consistency including NoSQL
    databases, distributed caches, and event-driven architectures.
    Assesses convergence guarantees, consistency windows, and
    how applications handle temporary inconsistencies.
  why_it_matters: |
    Eventually consistent systems trade immediate consistency for
    availability and partition tolerance (CAP theorem). Applications
    must correctly handle the consistency window where data may be
    stale. Improper handling causes user-visible bugs, lost updates,
    and data corruption.
  when_to_run:
  - When designing distributed systems
  - After adding eventually consistent data stores
  - When investigating data inconsistency issues
  - During distributed system architecture reviews
# NOTE: CAP Theorem Explanation
# The CAP theorem states that a distributed system can only guarantee 2 of 3 properties:
# - Consistency: All nodes see the same data at the same time
# - Availability: Every request receives a response (success/failure)
# - Partition tolerance: System continues operating despite network partitions
# Eventually consistent systems prioritize Availability and Partition tolerance over immediate Consistency.

prerequisites:
  required_artifacts:
  - type: architecture_docs
    description: System architecture showing data stores
  - type: application_code
    description: Code handling eventually consistent data
  - type: configuration
    description: Data store consistency configurations
  access_requirements:
  - Read access to system architecture documentation
  - Application code access
  - Data store configuration access
discovery:
knowledge_sources:
  specifications:
  - id: cap-theorem
    name: CAP Theorem and Distributed Systems
    url: https://en.wikipedia.org/wiki/CAP_theorem
    offline_cache: true
    priority: required
  papers:
  - id: vogels-ec
    title: Eventually Consistent - Werner Vogels
    url: https://www.allthingsdistributed.com/2008/12/eventually_consistent.html
  guides:
  - id: dynamodb-consistency
    name: DynamoDB Read Consistency
    url: https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.ReadConsistency.html
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: AWS CLI
    purpose: Check DynamoDB table settings
    command: aws dynamodb describe-table --table-name TABLE_NAME
  - tool: cqlsh
    purpose: Check Cassandra consistency settings
    command: cqlsh -e 'CONSISTENCY;'
  scripts:
  - id: measure-consistency-window
    language: python
    purpose: Measure replication lag and consistency window
    source: inline
    code: |
      # Measure time for writes to propagate
      # Implementation specific to data store
signals:
  critical:
  - id: EC-CRIT-001
    signal: Critical business operations rely on stale data without safeguards
    evidence_indicators:
    - Financial transactions using eventual consistency
    - Inventory decisions based on stale reads
    explanation: |
      Critical operations requiring strong consistency but using
      eventually consistent reads can cause financial loss or
      business errors.
    remediation: Use strong consistency for critical operations or implement compensating logic
  - id: EC-CRIT-002
    signal: No conflict resolution strategy for concurrent updates
    evidence_indicators:
    - Last-write-wins causing silent data loss
    - No version vectors or CRDTs
    explanation: |
      Without proper conflict resolution, concurrent updates can
      silently overwrite each other causing data loss.
    remediation: Implement proper conflict resolution (CRDTs, version vectors, etc.)
  high:
  - id: EC-HIGH-001
    signal: Consistency window exceeds user tolerance
    explanation: Users may see and act on stale data causing confusion
    remediation: Reduce consistency window or set appropriate user expectations
  - id: EC-HIGH-002
    signal: No monitoring of replication lag
    explanation: Consistency issues may go undetected until user reports
    remediation: Implement replication lag monitoring with alerting
  medium:
  - id: EC-MED-001
    signal: Mixed consistency models without clear documentation
    remediation: Document consistency guarantees for each operation type
  - id: EC-MED-002
    signal: No retry logic for consistency-related failures
    remediation: Implement appropriate retry logic with exponential backoff
  low:
  - id: EC-LOW-001
    signal: Eventual consistency assumptions not documented
  positive:
  - id: EC-POS-001
    signal: Appropriate consistency levels chosen for each use case
  - id: EC-POS-002
    signal: Conflict resolution strategies properly implemented
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Eventually Consistent Systems
    description: |
      Identify all data stores and systems using eventual
      consistency in the architecture.
    duration_estimate: 45 min
    questions:
    - Which data stores use eventual consistency?
    - What operations use eventually consistent reads?
    - What is the expected consistency window?
    expected_findings:
    - Inventory of eventually consistent systems
    - Consistency model by operation
  - id: '2'
    name: Assess Consistency Requirements
    description: |
      Evaluate whether eventual consistency is appropriate for
      each use case based on business requirements.
    duration_estimate: 45 min
    questions:
    - What are the consistency requirements for each operation?
    - What is the business impact of stale reads?
    - Are there operations requiring strong consistency?
    expected_findings:
    - Consistency requirement mapping
    - Potential mismatches
  - id: '3'
    name: Review Application Handling
    description: |
      Analyze how applications handle eventual consistency
      including stale reads and conflict resolution.
    duration_estimate: 60 min
    commands:
    - purpose: Find consistency level settings in code
      command: grep -r 'ConsistencyLevel\|consistentRead\|EVENTUAL\|QUORUM' --include='*.py' --include='*.java'
        --include='*.js'
    expected_findings:
    - Consistency handling patterns
    - Conflict resolution mechanisms
  - id: '4'
    name: Measure Consistency Window
    description: |
      If possible, measure actual replication lag and
      consistency windows.
    duration_estimate: 30 min
    questions:
    - What is the typical replication lag?
    - Is lag monitored and alerted?
    - What is the worst-case consistency window?
    expected_findings:
    - Measured consistency window
    - Monitoring coverage
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: consistency_matrix
    format: table
    columns:
    - System
    - Consistency Model
    - Typical Window
    - Conflict Resolution
    - Appropriate
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Consistency Model Analysis
    - Application Handling Review
    - Recommendations
  confidence_guidance:
    high: Consistency windows measured and code reviewed
    medium: Configuration reviewed without measurement
    low: Based on documentation without verification
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: cap-theorem
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Eventual consistency review requires distributed system analysis
    full:
      included: true
      priority: 1
closeout_checklist:
- id: ec-001
  item: Critical operations use appropriate consistency level
  level: CRITICAL
  verification: manual
  verification_notes: Review consistency requirements vs implementation
  expected: Confirmed by reviewer
- id: ec-002
  item: Conflict resolution strategy documented and implemented
  level: CRITICAL
  verification: manual
  verification_notes: Review conflict handling in code and documentation
  expected: Confirmed by reviewer
- id: ec-003
  item: Replication lag monitored with alerting
  level: BLOCKING
  verification: manual
  verification_notes: Check monitoring dashboards and alert configurations
  expected: Confirmed by reviewer
- id: ec-004
  item: Consistency guarantees documented for consumers
  level: WARNING
  verification: manual
  verification_notes: Review API documentation for consistency notes
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - distributed-systems
    - microservices
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC6.1
relationships:
  commonly_combined:
  - reliability-resilience.data-consistency.conflict-resolution
  - reliability-resilience.data-consistency.read-your-writes-consistency
  - reliability-resilience.data-consistency.distributed-transaction
