# ============================================================
# AUDIT: DR Test Coverage Audit
# ============================================================
# Evaluates disaster recovery testing practices, frequency,
# and coverage to ensure DR plans are validated.
# ============================================================

# ============================================================
# SECTION 1: IDENTITY & METADATA
# ============================================================

audit:
  id: "reliability-resilience.disaster-recovery.dr-test-coverage"

  name: "DR Test Coverage Audit"

  version: "1.0.0"
  last_updated: "2026-01-18"
  status: "active"

  category: "reliability-resilience"
  category_number: 3
  subcategory: "disaster-recovery"

  tier: "expert"
  estimated_duration: "4 hours"

  completeness: "complete"
  requires_runtime: false
  destructive: false

# ============================================================
# SECTION 2: EXECUTION CLASSIFICATION
# ============================================================

execution:
  automatable: "manual"

  severity: "high"

  scope: "process"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

# ============================================================
# SECTION 3: DESCRIPTION & RATIONALE
# ============================================================

description:
  what: |
    Evaluates disaster recovery testing practices including test types
    (tabletop, simulation, full failover), frequency, scope, and results
    analysis. Assesses whether testing validates RTO/RPO achievability
    and identifies gaps in DR capabilities.

  why_it_matters: |
    Untested disaster recovery plans have unknown effectiveness. Regular
    DR testing validates that procedures work, teams are prepared, and
    recovery objectives are achievable. Testing reveals gaps before
    actual disasters when the stakes are highest.

  when_to_run:
    - "After DR test completion for gap analysis"
    - "Quarterly to assess test coverage"
    - "Annual DR planning review"
    - "After significant system changes"

# ============================================================
# SECTION 4: PREREQUISITES
# ============================================================

prerequisites:
  required_artifacts:
    - type: "test_reports"
      description: "Historical DR test results and reports"
    - type: "test_schedule"
      description: "DR test calendar and plans"
    - type: "system_inventory"
      description: "List of systems requiring DR coverage"

  access_requirements:
    - "Access to DR test documentation"
    - "Test result reports and metrics"
    - "Stakeholder interviews"

# ============================================================
# SECTION 5: DISCOVERY SPECIFICATION
# ============================================================

discovery:
  file_patterns:
    - glob: "**/dr-test*"
      purpose: "DR test documentation"
    - glob: "**/disaster-recovery/**/*test*"
      purpose: "Test-related DR files"

  interviews:
    - role: "DR Coordinators"
      questions:
        - "What types of DR tests are conducted?"
        - "How often are full failover tests performed?"
        - "What systems are tested?"
        - "How are test results used to improve DR?"
      purpose: "Understand DR testing program"
    - role: "SRE/Platform Teams"
      questions:
        - "When was the last DR test for your systems?"
        - "Were any issues discovered during testing?"
        - "How realistic are the test scenarios?"
      purpose: "Assess test effectiveness from practitioner view"

  documents_to_review:
    - type: "DR test reports"
      purpose: "Review test results and findings"
    - type: "Post-test action items"
      purpose: "Assess follow-through on identified issues"

# ============================================================
# SECTION 6: EXTERNAL KNOWLEDGE SOURCES
# ============================================================

knowledge_sources:
  specifications:
    - id: "nist-cp"
      name: "NIST SP 800-34 - Contingency Planning Guide"
      url: "https://csrc.nist.gov/publications/detail/sp/800-34/rev-1/final"
      offline_cache: true
      priority: "required"

  guides:
    - id: "chaos-engineering"
      name: "Principles of Chaos Engineering"
      url: "https://principlesofchaos.org/"
      offline_cache: true
    - id: "sre-book"
      name: "Site Reliability Engineering"
      url: "https://sre.google/sre-book/table-of-contents/"
      offline_cache: true

# ============================================================
# SECTION 7: TOOLING & AUTOMATION
# ============================================================

tooling:
  assessment_tools:
    - tool: "Test coverage tracking"
      purpose: "Track which systems have been tested"
    - tool: "Chaos engineering platforms"
      purpose: "Automated failure injection testing"

  infrastructure_tools:
    - tool: "Gremlin/Chaos Monkey"
      purpose: "Controlled failure injection"
      command: "gremlin attack status"

# ============================================================
# SECTION 8: SIGNALS & FINDINGS TAXONOMY
# ============================================================

signals:
  critical:
    - id: "DRT-CRIT-001"
      signal: "No DR tests conducted in past 12 months"
      evidence_indicators:
        - "No test reports available"
        - "Last test over 12 months ago"
      explanation: |
        Long periods without testing mean DR plans are unvalidated.
        Systems and procedures change over time, potentially making
        untested plans ineffective.
      remediation: "Establish regular DR testing schedule with at least annual full tests"

    - id: "DRT-CRIT-002"
      signal: "Critical systems never tested in DR scenario"
      evidence_indicators:
        - "System not included in any DR test"
        - "Only partial testing of system"
      explanation: |
        Systems without DR testing have unknown recoverability.
        Recovery procedures are unproven.
      remediation: "Include all critical systems in DR test scope"

  high:
    - id: "DRT-HIGH-001"
      signal: "DR tests consistently fail to meet RTO/RPO"
      explanation: "Repeated failures indicate fundamental DR capability gaps"
      remediation: "Address root causes of test failures before next test"

    - id: "DRT-HIGH-002"
      signal: "Test findings not addressed between tests"
      explanation: "Unaddressed findings will cause repeated failures"
      remediation: "Implement tracking and resolution of test findings"

  medium:
    - id: "DRT-MED-001"
      signal: "Only tabletop exercises, no actual failover tests"
      remediation: "Conduct periodic actual failover tests in non-production"

    - id: "DRT-MED-002"
      signal: "Tests do not simulate realistic disaster scenarios"
      remediation: "Design tests based on actual risk scenarios"

  low:
    - id: "DRT-LOW-001"
      signal: "Test documentation incomplete or informal"

  positive:
    - id: "DRT-POS-001"
      signal: "Regular DR testing with comprehensive system coverage"
    - id: "DRT-POS-002"
      signal: "Test findings systematically tracked and resolved"

# ============================================================
# SECTION 9: EXECUTION PROCEDURE
# ============================================================

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review Test History"
      description: |
        Gather and review all DR test documentation from the
        past 12-24 months.
      duration_estimate: "45 min"
      questions:
        - "How many DR tests were conducted?"
        - "What types of tests (tabletop, simulation, failover)?"
        - "What was the scope of each test?"
      expected_findings:
        - "Test frequency and types"
        - "Historical test timeline"

    - id: "2"
      name: "Assess Coverage"
      description: |
        Map tested systems against the critical system inventory
        to identify testing gaps.
      duration_estimate: "45 min"
      questions:
        - "Which critical systems have been tested?"
        - "What scenarios have been tested?"
        - "Are there systems never included in DR tests?"
      expected_findings:
        - "Test coverage matrix"
        - "Identified gaps in testing"

    - id: "3"
      name: "Analyze Test Results"
      description: |
        Review test results to assess success rates and
        identify patterns of failure.
      duration_estimate: "60 min"
      questions:
        - "Did tests meet RTO/RPO targets?"
        - "What issues were discovered?"
        - "What were the root causes of failures?"
      expected_findings:
        - "Test success rates"
        - "Common failure patterns"

    - id: "4"
      name: "Evaluate Finding Resolution"
      description: |
        Assess whether issues identified in previous tests
        have been addressed.
      duration_estimate: "30 min"
      questions:
        - "Were action items created for test findings?"
        - "Have action items been completed?"
        - "Did subsequent tests show improvement?"
      expected_findings:
        - "Finding resolution rate"
        - "Improvement trends"

# ============================================================
# SECTION 10: OUTPUT SPECIFICATION
# ============================================================

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "coverage_matrix"
      format: "table"
      columns:
        - "System"
        - "Last Tested"
        - "Test Type"
        - "Result"
        - "Open Findings"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Test Coverage Analysis"
        - "Results Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Complete test documentation reviewed and validated"
    medium: "Partial test documentation with interview verification"
    low: "Limited documentation, primarily based on interviews"

# ============================================================
# SECTION 11: OFFLINE SUPPORT
# ============================================================

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "nist-cp"
        priority: "required"

# ============================================================
# SECTION 12: PROFILES
# ============================================================

profiles:
  membership:
    quick:
      included: false
      reason: "Test coverage review requires comprehensive analysis"
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1

# ============================================================
# SECTION 13: DETERMINISTIC VERIFICATION
# ============================================================

closeout_checklist:
  - id: "drt-001"
    item: "DR tests conducted within past 12 months"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Review test reports for dates"
    expected: "Confirmed by reviewer"

  - id: "drt-002"
    item: "All Tier-1 systems included in DR tests"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Cross-reference test scope with system inventory"
    expected: "Confirmed by reviewer"

  - id: "drt-003"
    item: "Test results document RTO/RPO achievement"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Review test reports for timing metrics"
    expected: "Confirmed by reviewer"

  - id: "drt-004"
    item: "Action items from previous tests tracked and resolved"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Review action item tracking and completion"
    expected: "Confirmed by reviewer"

# ============================================================
# SECTION 14: GOVERNANCE
# ============================================================

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "SOC 2"
      controls: ["CC7.5"]
    - framework: "ISO 22301"
      controls: ["8.5"]
    - framework: "NIST CSF"
      controls: ["PR.IP-10"]

# ============================================================
# SECTION 15: RELATIONSHIPS
# ============================================================

relationships:
  commonly_combined:
    - "reliability-resilience.disaster-recovery.dr-runbook-completeness"
    - "reliability-resilience.disaster-recovery.recovery-time-objective"
    - "reliability-resilience.resilience-testing.chaos-engineering"
