# ============================================================
# AUDIT: Consistent Navigation - WCAG 2.1 Compliance
# ============================================================
# Verifies navigation mechanisms appear in consistent order
# per WCAG 2.1 SC 3.2.3.

audit:
  id: "accessibility-inclusion.understandable-content.consistent-navigation"
  name: "Consistent Navigation Audit"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "understandable-content"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit verifies navigation mechanisms are consistent across
    pages per WCAG 2.1 SC 3.2.3 Consistent Navigation (Level AA).

    The audit covers:
    - Primary navigation menu position and order
    - Secondary/utility navigation consistency
    - Footer navigation consistency
    - Breadcrumb implementation
    - Search functionality placement
    - User account menu position
    - Mobile navigation patterns
    - Navigation within multi-step processes

  why_it_matters: |
    Consistent navigation is critical for user orientation:

    - Users with cognitive disabilities rely on predictable layouts
    - Blind users build mental models of site structure
    - Motor-impaired users benefit from predictable link positions
    - All users navigate more efficiently with consistency
    - Inconsistency causes confusion and disorientation

    When navigation moves or changes order between pages, users
    must relearn the interface repeatedly.

  when_to_run:
    - "When implementing navigation components"
    - "After adding new pages or sections"
    - "Before accessibility compliance audits"
    - "When refactoring site structure"
    - "During design system updates"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to navigation components"
    - type: "running_application"
      description: "Deployed instance for comparison"

  access_requirements:
    - "Read access to layout and navigation code"
    - "Browser access to running application"
    - "Access to all pages for comparison"

discovery:
  code_patterns:
    - pattern: "<nav|role=\"navigation\""
      type: "regex"
      scope: "source"
      purpose: "Find navigation elements"
    - pattern: "header|Header|navigation|Navigation"
      type: "regex"
      scope: "source"
      purpose: "Find header/navigation components"
    - pattern: "footer|Footer"
      type: "regex"
      scope: "source"
      purpose: "Find footer components"
    - pattern: "breadcrumb|Breadcrumb"
      type: "regex"
      scope: "source"
      purpose: "Find breadcrumb implementations"

  file_patterns:
    - glob: "**/layout*.{jsx,tsx}"
      purpose: "Layout components"
    - glob: "**/nav*.{jsx,tsx}"
      purpose: "Navigation components"
    - glob: "**/header*.{jsx,tsx}"
      purpose: "Header components"
    - glob: "**/footer*.{jsx,tsx}"
      purpose: "Footer components"

knowledge_sources:
  specifications:
    - id: "wcag-21"
      name: "WCAG 2.1 Quick Reference"
      url: "https://www.w3.org/WAI/WCAG21/quickref/"
      offline_cache: true
      priority: "recommended"
    - id: "wcag21-323"
      name: "WCAG 2.1 Success Criterion 3.2.3 Consistent Navigation"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/consistent-navigation.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "w3c-navigation"
      name: "W3C: Navigation Consistency Techniques"
      url: "https://www.w3.org/WAI/WCAG21/Techniques/general/G61"
      offline_cache: true
    - id: "nngroup-nav"
      name: "NN/g: Navigation Design"
      url: "https://www.nngroup.com/articles/navigation-cognitive-strain/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "axe-core"
      purpose: "Detect navigation structure issues"
      offline_capable: true

  scripts:
    - id: "find-nav-components"
      language: "bash"
      purpose: "Find navigation implementations"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Navigation Elements ==="
        grep -rln "nav>\|role=\"navigation\"\|Navigation" --include="*.jsx" --include="*.tsx" . | head -20
        echo ""
        echo "=== Header Components ==="
        grep -rln "Header\|<header" --include="*.jsx" --include="*.tsx" . | head -15

signals:
  critical:
    - id: "A11Y-NAV-CRIT-001"
      signal: "Primary navigation position changes between pages"
      evidence_pattern: "Nav component rendered differently on different routes"
      explanation: |
        Users expect navigation to be in the same position on
        every page. Position changes disorient users.
      remediation: "Use consistent layout component for all pages"
    - id: "A11Y-NAV-CRIT-002"
      signal: "Navigation items in different order on different pages"
      evidence_pattern: "Menu items reordered based on page context"
      explanation: |
        Link order must be consistent across pages for users to
        build reliable mental models.
      remediation: "Keep navigation item order consistent across all pages"

  high:
    - id: "A11Y-NAV-HIGH-001"
      signal: "Some pages missing expected navigation elements"
      explanation: "Navigation components should appear on all pages"
      remediation: "Include consistent navigation on all pages"
    - id: "A11Y-NAV-HIGH-002"
      signal: "Search functionality in different positions"
      explanation: "Search should be in a consistent location"
      remediation: "Place search in same position across all pages"
    - id: "A11Y-NAV-HIGH-003"
      signal: "Mobile navigation inconsistent with desktop"
      explanation: "Navigation order should be consistent across viewports"
      remediation: "Maintain consistent item order on mobile"

  medium:
    - id: "A11Y-NAV-MED-001"
      signal: "Breadcrumbs inconsistently implemented"
      remediation: "Add breadcrumbs consistently to applicable pages"
    - id: "A11Y-NAV-MED-002"
      signal: "User menu position varies"
      remediation: "Standardize account/user menu position"
    - id: "A11Y-NAV-MED-003"
      signal: "Footer navigation differs between sections"
      remediation: "Use consistent footer across site"

  low:
    - id: "A11Y-NAV-LOW-001"
      signal: "Minor styling differences in navigation"

  positive:
    - id: "A11Y-NAV-POS-001"
      signal: "Navigation position and order consistent across all pages"
    - id: "A11Y-NAV-POS-002"
      signal: "Shared layout component ensures consistency"
    - id: "A11Y-NAV-POS-003"
      signal: "Mobile navigation maintains desktop order"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify Navigation Components"
      description: |
        Find all navigation-related components and how
        they're used across the application.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find navigation components"
          command: "grep -rln 'Nav\\|Navigation\\|<nav' --include='*.jsx' --include='*.tsx' . | head -20"
        - purpose: "Find layout components"
          command: "grep -rln 'Layout\\|<header\\|<footer' --include='*.jsx' --include='*.tsx' . | head -15"
      expected_findings:
        - "Navigation component inventory"
        - "Layout structure"

    - id: "2"
      name: "Compare Navigation Across Pages"
      description: |
        Visit multiple pages and compare navigation position,
        order, and content.
      duration_estimate: "45 min"
      questions:
        - "Is the header in the same position on all pages?"
        - "Are navigation links in the same order?"
        - "Does the footer appear consistently?"
        - "Is search in the same location?"
        - "Is the user menu consistent?"
      expected_findings:
        - "Navigation consistency status"
        - "Pages with variations"

    - id: "3"
      name: "Test Mobile Navigation Consistency"
      description: |
        Verify navigation is consistent on mobile as well
        as desktop viewports.
      duration_estimate: "30 min"
      questions:
        - "Does mobile menu have same items as desktop?"
        - "Is item order consistent on mobile?"
        - "Is mobile menu position consistent?"
      expected_findings:
        - "Mobile navigation consistency"
        - "Viewport-specific variations"

    - id: "4"
      name: "Review Layout Architecture"
      description: |
        Examine how layouts ensure navigation consistency
        across all pages.
      duration_estimate: "30 min"
      commands:
        - purpose: "Check shared layout usage"
          command: "grep -rn 'Layout\\|layout' --include='*.jsx' --include='*.tsx' . | head -30"
      expected_findings:
        - "Layout architecture"
        - "Shared component patterns"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Navigation Component Analysis"
        - "Cross-Page Comparison"
        - "Mobile Consistency"
        - "Recommendations"

  confidence_guidance:
    high: "Compared all pages, documented navigation structure"
    medium: "Sampled pages with code review"
    low: "Code analysis only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag21-323"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires multi-page comparison"
    full:
      included: true
      priority: 2
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "consistent-nav-001"
    item: "Navigation position consistent across all pages"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Compare header/nav position on multiple pages"
    expected: "Confirmed by reviewer"

  - id: "consistent-nav-002"
    item: "Navigation item order consistent across pages"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify menu items appear in same order"
    expected: "Confirmed by reviewer"

  - id: "consistent-nav-003"
    item: "Mobile navigation consistent with desktop"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Compare mobile and desktop navigation"
    expected: "Confirmed by reviewer"

  - id: "consistent-nav-004"
    item: "Shared layout component used for consistency"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Review layout architecture in code"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["3.2.3"]
    - framework: "Section 508"
      controls: ["1194.22"]
    - framework: "EN 301 549"
      controls: ["9.3.2.3"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.understandable-content.consistent-identification"
    - "accessibility-inclusion.operable-keyboard.skip-link"
    - "accessibility-inclusion.operable-keyboard.focus-order"
