# ============================================================
# AUDIT: Pause, Stop, Hide Control - WCAG 2.1 Compliance
# ============================================================
# Verifies users can control moving, blinking, scrolling,
# and auto-updating content per WCAG 2.1 SC 2.2.2.

audit:
  id: "accessibility-inclusion.operable-timing.pause-stop-hide-control"
  name: "Pause, Stop, Hide Control Audit"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "operable-timing"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit verifies compliance with WCAG 2.1 SC 2.2.2 Pause,
    Stop, Hide (Level A), ensuring users can control dynamic content.

    The audit covers:
    - Auto-playing carousels and slideshows
    - News tickers and marquees
    - Auto-scrolling content
    - Animated advertisements
    - Background videos
    - Live streams and feeds
    - Auto-updating data (stocks, scores)
    - Blinking or flashing content

  why_it_matters: |
    Moving and auto-updating content creates significant barriers:

    - Distracting for users with attention disorders (ADHD)
    - Confusing for users with cognitive disabilities
    - Prevents screen reader users from accessing adjacent content
    - Causes vestibular distress for some users
    - Makes it impossible to read at one's own pace

    Users must be able to pause, stop, or hide content that moves
    automatically to use the page effectively.

  when_to_run:
    - "When implementing carousels or sliders"
    - "When adding auto-updating content"
    - "When implementing video backgrounds"
    - "Before accessibility compliance audits"
    - "When adding live feeds or streams"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to animation and auto-update code"
    - type: "running_application"
      description: "Deployed instance for testing"

  access_requirements:
    - "Read access to JavaScript and CSS"
    - "Browser access for testing"

discovery:
  code_patterns:
    - pattern: "autoplay|auto-play"
      type: "regex"
      scope: "source"
      purpose: "Find auto-play implementations"
    - pattern: "carousel|slider|slideshow"
      type: "regex"
      scope: "source"
      purpose: "Find carousel components"
    - pattern: "marquee|ticker|scroll.*auto"
      type: "regex"
      scope: "source"
      purpose: "Find scrolling text"
    - pattern: "setInterval.*update|auto.*refresh"
      type: "regex"
      scope: "source"
      purpose: "Find auto-updating patterns"
    - pattern: "@keyframes|animation:"
      type: "regex"
      scope: "source"
      purpose: "Find CSS animations"

  file_patterns:
    - glob: "**/carousel*.{jsx,tsx,vue}"
      purpose: "Carousel components"
    - glob: "**/slider*.{jsx,tsx,vue}"
      purpose: "Slider components"
    - glob: "**/feed*.{jsx,tsx,vue}"
      purpose: "Live feed components"

knowledge_sources:
  specifications:
    - id: "wcag21-222"
      name: "WCAG 2.1 Success Criterion 2.2.2 Pause, Stop, Hide"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/pause-stop-hide.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "w3c-pause-stop"
      name: "W3C: Pause, Stop, Hide Techniques"
      url: "https://www.w3.org/WAI/WCAG21/Techniques/general/G4"
      offline_cache: true
    - id: "a11y-carousels"
      name: "A11Y: Accessible Carousels"
      url: "https://www.a11yproject.com/posts/accessible-carousels/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "axe-core"
      purpose: "Detect auto-playing content issues"
      offline_capable: true

  scripts:
    - id: "find-autoplay-content"
      language: "bash"
      purpose: "Find auto-playing and animated content"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Auto-playing Content ==="
        grep -rn "autoplay\|auto-play" --include="*.html" --include="*.jsx" --include="*.tsx" . | head -20
        echo ""
        echo "=== Carousels/Sliders ==="
        grep -rln "carousel\|slider\|slideshow" --include="*.jsx" --include="*.tsx" --include="*.vue" . | head -15
        echo ""
        echo "=== Auto-refresh ==="
        grep -rn "setInterval.*update\|auto.*refresh" --include="*.js" --include="*.ts" . | head -15

signals:
  critical:
    - id: "A11Y-PAUSE-CRIT-001"
      signal: "Moving content with no pause control"
      evidence_pattern: "Carousel or animation without pause button"
      explanation: |
        Moving content must have a mechanism to pause, stop, or hide
        it. Without this, users cannot focus on the content.
      remediation: "Add visible pause/stop button for all auto-playing content"
    - id: "A11Y-PAUSE-CRIT-002"
      signal: "Auto-updating content with no control"
      evidence_pattern: "Live feed updates without pause option"
      explanation: |
        Auto-updating content can be disorienting and distracting.
        Users must be able to pause updates.
      remediation: "Add pause control for auto-updating content"

  high:
    - id: "A11Y-PAUSE-HIGH-001"
      signal: "Pause button not keyboard accessible"
      explanation: "Pause controls must be keyboard operable"
      remediation: "Ensure pause button can be focused and activated with keyboard"
    - id: "A11Y-PAUSE-HIGH-002"
      signal: "Pause state not announced to screen readers"
      explanation: "Users need to know when content is paused"
      remediation: "Use aria-pressed or aria-live to announce pause state"
    - id: "A11Y-PAUSE-HIGH-003"
      signal: "Content restarts when page is navigated"
      explanation: "User preference should be remembered"
      remediation: "Persist pause preference across navigation"

  medium:
    - id: "A11Y-PAUSE-MED-001"
      signal: "Pause control hard to find or small"
      remediation: "Make pause control visible and adequately sized"
    - id: "A11Y-PAUSE-MED-002"
      signal: "No option to completely disable animations"
      remediation: "Respect prefers-reduced-motion preference"
    - id: "A11Y-PAUSE-MED-003"
      signal: "Moving content doesn't pause on hover/focus"
      remediation: "Consider pausing on hover/focus in addition to button"

  low:
    - id: "A11Y-PAUSE-LOW-001"
      signal: "Pause control could be more prominent"

  positive:
    - id: "A11Y-PAUSE-POS-001"
      signal: "All moving content has pause control"
    - id: "A11Y-PAUSE-POS-002"
      signal: "Content pauses on hover and focus"
    - id: "A11Y-PAUSE-POS-003"
      signal: "prefers-reduced-motion respected"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Moving/Updating Content"
      description: |
        Identify all content that moves, blinks, scrolls,
        or updates automatically.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find carousels and sliders"
          command: "grep -rln 'carousel\\|slider\\|slideshow' --include='*.jsx' --include='*.tsx' --include='*.vue' ."
        - purpose: "Find auto-playing content"
          command: "grep -rn 'autoplay\\|auto-play' --include='*.html' --include='*.jsx' . | head -20"
        - purpose: "Find CSS animations"
          command: "grep -rn '@keyframes\\|animation:' --include='*.css' --include='*.scss' . | head -30"
      expected_findings:
        - "Complete dynamic content inventory"
        - "Animation types identified"

    - id: "2"
      name: "Test Pause Controls"
      description: |
        For each moving/updating element, verify pause/stop
        mechanism exists and works.
      duration_estimate: "45 min"
      questions:
        - "Does each carousel have a pause button?"
        - "Can auto-updating feeds be paused?"
        - "Do background videos have pause controls?"
        - "Is the control keyboard accessible?"
        - "Is pause state communicated to screen readers?"
      expected_findings:
        - "Pause control availability"
        - "Control accessibility status"

    - id: "3"
      name: "Test Reduced Motion Support"
      description: |
        Verify prefers-reduced-motion is respected.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find reduced motion support"
          command: "grep -rn 'prefers-reduced-motion' --include='*.css' --include='*.scss' --include='*.js' ."
      questions:
        - "Do animations stop when reduced motion is enabled?"
        - "Do carousels stop auto-advancing?"
        - "Is all motion stopped or just reduced?"
      expected_findings:
        - "Reduced motion support status"
        - "Coverage of animations"

    - id: "4"
      name: "Test 5-Second Rule"
      description: |
        Verify moving content that starts automatically
        stops within 5 seconds OR has pause control.
      duration_estimate: "20 min"
      questions:
        - "Does moving content stop after 5 seconds?"
        - "If not, is there a pause mechanism?"
        - "Does blinking content stop after 5 seconds?"
      expected_findings:
        - "5-second compliance"
        - "Ongoing motion handling"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Dynamic Content Inventory"
        - "Pause Control Assessment"
        - "Reduced Motion Support"
        - "5-Second Rule Compliance"
        - "Recommendations"

  confidence_guidance:
    high: "Tested all dynamic content with keyboard and screen reader"
    medium: "Runtime testing complete"
    low: "Code analysis only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag21-222"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive dynamic content review"
    full:
      included: true
      priority: 2
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "pause-stop-001"
    item: "All moving content has pause/stop control"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Test all carousels, animations, auto-updating content"
    expected: "Confirmed by reviewer"

  - id: "pause-stop-002"
    item: "Pause controls are keyboard accessible"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test pause button with Tab and Enter/Space"
    expected: "Confirmed by reviewer"

  - id: "pause-stop-003"
    item: "prefers-reduced-motion is respected"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Enable reduced motion and verify animations stop"
    expected: "Confirmed by reviewer"

  - id: "pause-stop-004"
    item: "Auto-updating content can be paused"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test live feeds and auto-refresh content"
    expected: "Confirmed by reviewer or N/A"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["2.2.2"]
    - framework: "Section 508"
      controls: ["1194.22(j)"]
    - framework: "EN 301 549"
      controls: ["9.2.2.2"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.perceivable-visual.animation-motion-control"
    - "accessibility-inclusion.operable-timing.time-limit-adjustability"
    - "accessibility-inclusion.perceivable-auditory.background-audio-control"
