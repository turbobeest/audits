# ============================================================
# AUDIT: Multiple Input Modality Support - WCAG 2.1 Compliance
# ============================================================
# Verifies functionality is available through multiple input
# methods (mouse, keyboard, touch, voice).

audit:
  id: "accessibility-inclusion.operable-timing.multiple-input-modality"
  name: "Multiple Input Modality Support Audit"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "operable-timing"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit verifies functionality is available through multiple
    input modalities, supporting users with different abilities and
    device preferences.

    The audit covers:
    - Mouse/pointer interactions
    - Keyboard navigation and activation
    - Touch gestures (mobile)
    - Voice control compatibility
    - Switch device support
    - Eye tracking compatibility
    - Alternative input device support
    - Multi-modal interaction patterns

  why_it_matters: |
    Users rely on different input methods based on their abilities:

    - Motor impairments may prevent mouse use
    - Blind users rely on keyboard
    - Mobile users need touch support
    - Voice control users (motor impairments, RSI)
    - Switch users (severe motor impairments)
    - Users may switch modalities contextually

    Limiting functionality to a single input method excludes users
    who cannot use that method.

  when_to_run:
    - "When implementing interactive features"
    - "When adding gesture-based interactions"
    - "Before accessibility compliance audits"
    - "When testing mobile versions"
    - "When supporting assistive technologies"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to interaction code"
    - type: "running_application"
      description: "Deployed instance for testing"

  access_requirements:
    - "Read access to source code"
    - "Browser with touch emulation"
    - "Voice control software access (optional)"
    - "Keyboard for testing"

discovery:
  code_patterns:
    - pattern: "onmousedown|onmouseup|onmousemove"
      type: "regex"
      scope: "source"
      purpose: "Find mouse-specific handlers"
    - pattern: "ontouchstart|ontouchmove|ontouchend"
      type: "regex"
      scope: "source"
      purpose: "Find touch-specific handlers"
    - pattern: "onkeydown|onkeyup|onkeypress"
      type: "regex"
      scope: "source"
      purpose: "Find keyboard handlers"
    - pattern: "onpointerdown|onpointermove|onpointerup"
      type: "regex"
      scope: "source"
      purpose: "Find pointer event handlers (unified)"
    - pattern: "swipe|pinch|gesture"
      type: "regex"
      scope: "source"
      purpose: "Find gesture implementations"

  file_patterns:
    - glob: "**/gesture*.{js,ts}"
      purpose: "Gesture handling code"
    - glob: "**/touch*.{js,ts}"
      purpose: "Touch handling code"
    - glob: "**/input*.{js,ts}"
      purpose: "Input handling code"

knowledge_sources:
  specifications:
    - id: "wcag21-211"
      name: "WCAG 2.1 Success Criterion 2.1.1 Keyboard"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/keyboard.html"
      offline_cache: true
      priority: "required"
    - id: "wcag21-255"
      name: "WCAG 2.1 Success Criterion 2.5.5 Target Size"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/target-size.html"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "mdn-pointer-events"
      name: "MDN: Pointer Events"
      url: "https://developer.mozilla.org/en-US/docs/Web/API/Pointer_events"
      offline_cache: true
    - id: "w3c-input-modalities"
      name: "W3C: Input Modalities"
      url: "https://www.w3.org/TR/pointerevents3/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "eslint-plugin-jsx-a11y"
      purpose: "Lint for missing keyboard handlers"
      offline_capable: true

  scripts:
    - id: "find-input-handlers"
      language: "bash"
      purpose: "Find input event handlers"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Mouse Events ==="
        grep -rn "onmouse\|onMouse" --include="*.jsx" --include="*.tsx" . | head -20
        echo ""
        echo "=== Touch Events ==="
        grep -rn "ontouch\|onTouch" --include="*.jsx" --include="*.tsx" . | head -15
        echo ""
        echo "=== Keyboard Events ==="
        grep -rn "onkey\|onKey" --include="*.jsx" --include="*.tsx" . | head -15
        echo ""
        echo "=== Pointer Events ==="
        grep -rn "onpointer\|onPointer" --include="*.jsx" --include="*.tsx" . | head -15

signals:
  critical:
    - id: "A11Y-INPUT-CRIT-001"
      signal: "Functionality only available via mouse"
      evidence_pattern: "onClick without keyboard equivalent for custom element"
      explanation: |
        Mouse-only functionality excludes keyboard users, including
        blind users, motor-impaired users, and voice control users.
      remediation: "Add keyboard handler (onKeyDown/onKeyUp) with Enter/Space support"
    - id: "A11Y-INPUT-CRIT-002"
      signal: "Gesture-only interaction without alternative"
      evidence_pattern: "Swipe/pinch without button or keyboard alternative"
      explanation: |
        Touch gestures are not available to users without touch
        screens or with motor impairments.
      remediation: "Provide button/keyboard alternatives for all gestures"

  high:
    - id: "A11Y-INPUT-HIGH-001"
      signal: "Hover-dependent content not available on focus or touch"
      explanation: "Hover content must be available via focus for keyboard users"
      remediation: "Show content on focus as well as hover"
    - id: "A11Y-INPUT-HIGH-002"
      signal: "Drag and drop has no keyboard alternative"
      explanation: "Drag operations must be available via keyboard"
      remediation: "Provide keyboard commands for reordering/moving"
    - id: "A11Y-INPUT-HIGH-003"
      signal: "Context menu content mouse-only"
      explanation: "Right-click content must be available via other means"
      remediation: "Provide menu button or keyboard shortcut"

  medium:
    - id: "A11Y-INPUT-MED-001"
      signal: "Touch targets too small on mobile"
      remediation: "Ensure minimum 44x44 CSS pixels for touch targets"
    - id: "A11Y-INPUT-MED-002"
      signal: "Multi-finger gestures required without alternative"
      remediation: "Provide single-point alternatives for complex gestures"
    - id: "A11Y-INPUT-MED-003"
      signal: "Voice control navigation not tested"
      remediation: "Test with voice control software"

  low:
    - id: "A11Y-INPUT-LOW-001"
      signal: "Input modality support could be more comprehensive"

  positive:
    - id: "A11Y-INPUT-POS-001"
      signal: "All functionality available via keyboard"
    - id: "A11Y-INPUT-POS-002"
      signal: "Touch and mouse equivalents provided"
    - id: "A11Y-INPUT-POS-003"
      signal: "Voice control compatible"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Input Handlers"
      description: |
        Identify all input event handlers to understand
        which modalities are supported.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find mouse events"
          command: "grep -rn 'onMouse\\|onclick\\|onClick' --include='*.jsx' --include='*.tsx' . | head -40"
        - purpose: "Find keyboard events"
          command: "grep -rn 'onKey\\|onkeydown' --include='*.jsx' --include='*.tsx' . | head -30"
        - purpose: "Find touch/gesture events"
          command: "grep -rn 'onTouch\\|swipe\\|gesture\\|pinch' --include='*.jsx' --include='*.tsx' . | head -20"
      expected_findings:
        - "Event handler distribution"
        - "Modality coverage gaps"

    - id: "2"
      name: "Keyboard Testing"
      description: |
        Test all interactive features using keyboard only.
      duration_estimate: "45 min"
      questions:
        - "Can all features be accessed with keyboard?"
        - "Can all mouse interactions be done with keyboard?"
        - "Are keyboard shortcuts documented?"
        - "Is focus visible throughout?"
      expected_findings:
        - "Keyboard accessibility status"
        - "Mouse-only features"

    - id: "3"
      name: "Touch/Mobile Testing"
      description: |
        Test on mobile or with touch emulation.
      duration_estimate: "30 min"
      questions:
        - "Are all features usable with touch?"
        - "Are touch targets adequately sized (44px minimum)?"
        - "Are gestures intuitive and discoverable?"
        - "Are alternatives provided for complex gestures?"
      expected_findings:
        - "Touch accessibility status"
        - "Target size issues"

    - id: "4"
      name: "Voice Control Testing (if applicable)"
      description: |
        Test with voice control software if available.
      duration_estimate: "30 min"
      questions:
        - "Can all buttons be activated by voice?"
        - "Are interactive elements labeled clearly?"
        - "Do voice commands conflict with app features?"
      expected_findings:
        - "Voice control compatibility"
        - "Labeling issues"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Input Modality Coverage"
        - "Keyboard Testing Results"
        - "Touch Testing Results"
        - "Voice Control Compatibility"
        - "Recommendations"

  confidence_guidance:
    high: "Tested with multiple input methods including AT"
    medium: "Keyboard and touch testing complete"
    low: "Code analysis only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag21-211"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires multi-modality testing"
    full:
      included: true
      priority: 2
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "input-modality-001"
    item: "All functionality available via keyboard"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Test all features with keyboard only"
    expected: "Confirmed by reviewer"

  - id: "input-modality-002"
    item: "Gestures have non-gesture alternatives"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify buttons/keyboard alternatives for gestures"
    expected: "Confirmed by reviewer"

  - id: "input-modality-003"
    item: "Touch targets meet minimum size (44px)"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Measure touch target sizes on mobile"
    expected: "Confirmed by reviewer"

  - id: "input-modality-004"
    item: "Hover content available on focus"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test hover content with keyboard focus"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["2.1.1", "2.5.1", "2.5.2", "2.5.4"]
    - framework: "EN 301 549"
      controls: ["9.2.1.1", "9.2.5.1", "9.2.5.2"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.operable-keyboard.full-keyboard-navigation"
    - "accessibility-inclusion.operable-timing.pointer-gesture-alternative"
    - "accessibility-inclusion.operable-timing.target-size"
