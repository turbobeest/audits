# ============================================================
# AUDIT: Pointer Gesture Alternatives - WCAG 2.1 Compliance
# ============================================================
# Verifies complex gestures have single-pointer alternatives
# per WCAG 2.1 SC 2.5.1.

audit:
  id: "accessibility-inclusion.operable-timing.pointer-gesture-alternative"
  name: "Pointer Gesture Alternatives Audit"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "operable-timing"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit verifies complex pointer gestures have single-pointer
    alternatives per WCAG 2.1 SC 2.5.1 Pointer Gestures (Level A).

    The audit covers:
    - Swipe gestures (left/right/up/down)
    - Pinch-to-zoom gestures
    - Multi-finger tap gestures
    - Rotation gestures
    - Path-based gestures (draw shapes)
    - Long-press gestures
    - Drag-and-drop operations
    - Custom gesture libraries

  why_it_matters: |
    Complex gestures require dexterity many users don't have:

    - Motor impairments may limit to single-finger/pointer
    - Some users can only use head pointers or eye tracking
    - Switch device users have limited gesture capability
    - Voice control simulates single-pointer actions
    - Assistive technology may not support multi-touch

    All functionality requiring complex gestures must have
    single-pointer alternatives.

  when_to_run:
    - "When implementing touch gestures"
    - "When adding swipe or pinch functionality"
    - "Before accessibility compliance audits"
    - "When building mobile interfaces"
    - "When using gesture libraries"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to gesture handling code"
    - type: "running_application"
      description: "Deployed instance for testing"

  access_requirements:
    - "Read access to JavaScript"
    - "Touch screen or emulation for testing"
    - "Browser DevTools"

discovery:
  code_patterns:
    - pattern: "swipe|pinch|zoom|rotate|gesture"
      type: "regex"
      scope: "source"
      purpose: "Find gesture implementations"
    - pattern: "touchmove|touchstart|touchend"
      type: "regex"
      scope: "source"
      purpose: "Find touch event handlers"
    - pattern: "hammerjs|interact.js|react-swipeable"
      type: "regex"
      scope: "source"
      purpose: "Find gesture libraries"
    - pattern: "pointerdown|pointermove|pointerup"
      type: "regex"
      scope: "source"
      purpose: "Find pointer event handlers"
    - pattern: "draggable|sortable|drag"
      type: "regex"
      scope: "source"
      purpose: "Find drag-and-drop patterns"

  file_patterns:
    - glob: "**/gesture*.{js,ts}"
      purpose: "Gesture handling code"
    - glob: "**/swipe*.{js,ts,jsx,tsx}"
      purpose: "Swipe implementations"
    - glob: "**/drag*.{js,ts,jsx,tsx}"
      purpose: "Drag implementations"

knowledge_sources:
  specifications:
    - id: "wcag21-251"
      name: "WCAG 2.1 Success Criterion 2.5.1 Pointer Gestures"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/pointer-gestures.html"
      offline_cache: true
      priority: "required"
    - id: "wcag21-252"
      name: "WCAG 2.1 Success Criterion 2.5.2 Pointer Cancellation"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/pointer-cancellation.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "w3c-gestures"
      name: "W3C: Pointer Gestures Techniques"
      url: "https://www.w3.org/WAI/WCAG21/Techniques/general/G215"
      offline_cache: true
    - id: "deque-gestures"
      name: "Deque: Touch Gesture Accessibility"
      url: "https://www.deque.com/blog/accessible-touch-targets/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "eslint"
      purpose: "Custom rules for gesture patterns"
      offline_capable: true

  scripts:
    - id: "find-gestures"
      language: "bash"
      purpose: "Find gesture implementations"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Gesture Libraries ==="
        grep -rn "hammerjs\|react-swipeable\|use-gesture\|interact.js" --include="*.json" --include="*.js" . | head -10
        echo ""
        echo "=== Swipe/Pinch/Zoom ==="
        grep -rn "swipe\|pinch\|zoom\|rotate" --include="*.js" --include="*.ts" --include="*.jsx" --include="*.tsx" . | head -30
        echo ""
        echo "=== Drag and Drop ==="
        grep -rn "drag\|sortable\|draggable" --include="*.jsx" --include="*.tsx" . | head -20

signals:
  critical:
    - id: "A11Y-GESTURE-CRIT-001"
      signal: "Essential functionality requires multi-point gesture"
      evidence_pattern: "Pinch-to-zoom with no zoom buttons"
      explanation: |
        Multi-point gestures (pinch, two-finger swipe) cannot be
        performed by users limited to single-pointer input.
      remediation: "Add button or keyboard alternatives for all multi-point gestures"
    - id: "A11Y-GESTURE-CRIT-002"
      signal: "Path-based gesture with no alternative"
      evidence_pattern: "Draw pattern to unlock with no PIN option"
      explanation: |
        Path-based gestures requiring specific movements exclude
        users who cannot perform precise movements.
      remediation: "Provide single-tap or keyboard alternative"

  high:
    - id: "A11Y-GESTURE-HIGH-001"
      signal: "Swipe navigation with no buttons"
      explanation: "Swipe to change content needs button alternatives"
      remediation: "Add prev/next buttons for swipe navigation"
    - id: "A11Y-GESTURE-HIGH-002"
      signal: "Drag-and-drop with no keyboard support"
      explanation: "Drag operations must have keyboard alternatives"
      remediation: "Implement arrow key or keyboard command for reordering"
    - id: "A11Y-GESTURE-HIGH-003"
      signal: "Long-press required with no alternative"
      explanation: "Long-press timing can be difficult for some users"
      remediation: "Provide tap alternative or context menu"

  medium:
    - id: "A11Y-GESTURE-MED-001"
      signal: "Gesture discoverable only through trial"
      remediation: "Provide visible affordances or instructions"
    - id: "A11Y-GESTURE-MED-002"
      signal: "Complex gesture has alternative but poorly discoverable"
      remediation: "Make single-pointer alternative prominent"
    - id: "A11Y-GESTURE-MED-003"
      signal: "Custom gestures not documented"
      remediation: "Document all gestures and their alternatives"

  low:
    - id: "A11Y-GESTURE-LOW-001"
      signal: "Gesture could be more intuitive"

  positive:
    - id: "A11Y-GESTURE-POS-001"
      signal: "All gestures have single-pointer alternatives"
    - id: "A11Y-GESTURE-POS-002"
      signal: "Gesture alternatives are prominent and discoverable"
    - id: "A11Y-GESTURE-POS-003"
      signal: "Keyboard support provided for all gestures"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Gesture Implementations"
      description: |
        Find all gesture-based interactions in the application.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find gesture libraries"
          command: "grep -r 'hammerjs\\|react-swipeable\\|use-gesture\\|interact' --include='package.json' ."
        - purpose: "Find gesture code"
          command: "grep -rn 'swipe\\|pinch\\|zoom\\|rotate\\|gesture' --include='*.js' --include='*.ts' --include='*.jsx' . | head -40"
        - purpose: "Find drag implementations"
          command: "grep -rn 'draggable\\|sortable\\|drag' --include='*.jsx' --include='*.tsx' . | head -30"
      expected_findings:
        - "Complete gesture inventory"
        - "Gesture library usage"

    - id: "2"
      name: "Categorize Gestures"
      description: |
        Classify gestures as single-pointer, multi-pointer,
        or path-based.
      duration_estimate: "20 min"
      questions:
        - "Which gestures require multiple fingers/pointers?"
        - "Which gestures require specific movement paths?"
        - "Which are simple single-point gestures?"
      expected_findings:
        - "Gesture classification"
        - "Complex gestures identified"

    - id: "3"
      name: "Verify Single-Pointer Alternatives"
      description: |
        For each complex gesture, verify a single-pointer
        alternative exists.
      duration_estimate: "45 min"
      questions:
        - "Does pinch-zoom have zoom buttons?"
        - "Does swipe have navigation buttons?"
        - "Does drag-and-drop have keyboard support?"
        - "Do multi-finger taps have single-tap alternatives?"
      expected_findings:
        - "Alternative availability"
        - "Missing alternatives"

    - id: "4"
      name: "Test Pointer Cancellation"
      description: |
        Verify actions can be cancelled (SC 2.5.2).
      duration_estimate: "20 min"
      questions:
        - "Can pointer-down be cancelled by moving away?"
        - "Is activation on up-event (not down-event)?"
        - "Can completed actions be undone?"
      expected_findings:
        - "Pointer cancellation support"
        - "Down-event activation issues"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Gesture Inventory"
        - "Single-Pointer Alternatives Analysis"
        - "Pointer Cancellation Assessment"
        - "Recommendations"

  confidence_guidance:
    high: "Tested with touch and single-pointer devices"
    medium: "Code analysis with runtime testing"
    low: "Code pattern analysis only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag21-251"
        priority: "required"
      - source_id: "wcag21-252"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires gesture inventory and testing"
    full:
      included: true
      priority: 2
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "gesture-alt-001"
    item: "Multi-point gestures have single-pointer alternatives"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Test all pinch/multi-finger gestures for alternatives"
    expected: "Confirmed by reviewer"

  - id: "gesture-alt-002"
    item: "Path-based gestures have alternatives"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Test any draw/path gestures for alternatives"
    expected: "Confirmed by reviewer"

  - id: "gesture-alt-003"
    item: "Swipe gestures have button alternatives"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify carousels and swipe navigation have buttons"
    expected: "Confirmed by reviewer"

  - id: "gesture-alt-004"
    item: "Drag-and-drop has keyboard alternative"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test drag operations with keyboard"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["2.5.1", "2.5.2"]
    - framework: "EN 301 549"
      controls: ["9.2.5.1", "9.2.5.2"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.operable-timing.multiple-input-modality"
    - "accessibility-inclusion.operable-timing.target-size"
    - "accessibility-inclusion.operable-keyboard.full-keyboard-navigation"
