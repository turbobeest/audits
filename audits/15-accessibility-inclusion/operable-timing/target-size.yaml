# ============================================================
# AUDIT: Target Size - WCAG 2.2 Compliance
# ============================================================
# Verifies interactive targets are large enough for accurate
# touch and pointer interactions.

audit:
  id: "accessibility-inclusion.operable-timing.target-size"
  name: "Target Size Audit"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "operable-timing"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit verifies interactive elements meet minimum target
    size requirements per:
    - WCAG 2.2 SC 2.5.5 Target Size (Minimum) - Level AA (24x24 CSS pixels)
    - WCAG 2.1 SC 2.5.5 Target Size - Level AAA (44x44 CSS pixels)

    The audit covers:
    - Buttons and links
    - Form controls (checkboxes, radio buttons)
    - Icon buttons
    - Close buttons and X icons
    - Mobile touch targets
    - Action links in lists
    - Toolbar buttons
    - Pagination controls

  why_it_matters: |
    Small targets create significant barriers:

    - Motor impairments affect fine motor control
    - Tremors make precise targeting difficult
    - Touch screens lack precision (finger tip ~7mm)
    - Mobile contexts (moving, one-handed)
    - Aging reduces motor precision

    Approximately 16% of the global population has some form of
    disability that may affect fine motor control.

  when_to_run:
    - "When implementing interactive components"
    - "When designing mobile interfaces"
    - "Before accessibility compliance audits"
    - "When adding icon-only buttons"
    - "After UI component library updates"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to CSS and component code"
    - type: "running_application"
      description: "Deployed instance for measurement"

  access_requirements:
    - "Read access to stylesheets"
    - "Browser DevTools for measurement"

discovery:
  code_patterns:
    - pattern: "width:\\s*[0-9]+px|height:\\s*[0-9]+px"
      type: "regex"
      scope: "source"
      purpose: "Find fixed pixel dimensions"
    - pattern: "padding:\\s*[0-9]+|padding-[a-z]+:\\s*[0-9]+"
      type: "regex"
      scope: "source"
      purpose: "Find padding that affects target size"
    - pattern: "<button|<a|<input"
      type: "regex"
      scope: "source"
      purpose: "Find interactive elements"
    - pattern: "icon-btn|icon-button|btn-icon"
      type: "regex"
      scope: "source"
      purpose: "Find icon button patterns"

  file_patterns:
    - glob: "**/button*.{css,scss}"
      purpose: "Button styles"
    - glob: "**/form*.{css,scss}"
      purpose: "Form element styles"
    - glob: "**/icon*.{css,scss}"
      purpose: "Icon styles"

knowledge_sources:
  specifications:
    - id: "wcag22-255"
      name: "WCAG 2.2 Success Criterion 2.5.5 Target Size (Minimum)"
      url: "https://www.w3.org/WAI/WCAG22/Understanding/target-size-minimum.html"
      offline_cache: true
      priority: "required"
    - id: "wcag21-255"
      name: "WCAG 2.1 Success Criterion 2.5.5 Target Size (Enhanced)"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/target-size.html"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "material-touch"
      name: "Material Design: Touch Target Size"
      url: "https://m3.material.io/foundations/accessible-design/accessibility-basics"
      offline_cache: true
    - id: "apple-hig"
      name: "Apple Human Interface Guidelines: Touch Targets"
      url: "https://developer.apple.com/design/human-interface-guidelines/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "axe-core"
      purpose: "Detect undersized targets"
      offline_capable: true
    - tool: "Pa11y"
      purpose: "Automated accessibility testing"
      offline_capable: true

  scripts:
    - id: "find-small-targets"
      language: "bash"
      purpose: "Find potentially undersized interactive elements"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Icon Buttons ==="
        grep -rn "icon-btn\|icon-button\|btn-icon" --include="*.jsx" --include="*.tsx" --include="*.css" . | head -20
        echo ""
        echo "=== Small Dimensions ==="
        grep -rn "width:\s*\([0-9]\|1[0-9]\|2[0-3]\)px\|height:\s*\([0-9]\|1[0-9]\|2[0-3]\)px" --include="*.css" --include="*.scss" . | head -20

signals:
  critical:
    - id: "A11Y-TARGET-CRIT-001"
      signal: "Interactive elements smaller than 24x24 CSS pixels"
      evidence_pattern: "Button or link with dimensions below 24x24px"
      explanation: |
        Targets smaller than 24x24 CSS pixels fail WCAG 2.2 AA
        and are difficult for users with motor impairments.
      remediation: "Increase target size to minimum 24x24px (44x44px recommended)"
    - id: "A11Y-TARGET-CRIT-002"
      signal: "Icon-only buttons with no visible clickable area"
      evidence_pattern: "Icon button relying only on icon size"
      explanation: |
        Icon buttons often have insufficient target size because
        they rely only on the icon dimensions.
      remediation: "Add padding or explicit dimensions to create adequate target"

  high:
    - id: "A11Y-TARGET-HIGH-001"
      signal: "Targets between 24x24 and 44x44 CSS pixels"
      explanation: "44x44px is recommended for AAA and mobile best practices"
      remediation: "Increase to 44x44px for enhanced accessibility"
    - id: "A11Y-TARGET-HIGH-002"
      signal: "Inline links in dense text"
      explanation: "Text links may have insufficient target size"
      remediation: "Ensure adequate line height and link styling"
    - id: "A11Y-TARGET-HIGH-003"
      signal: "Adjacent targets without adequate spacing"
      explanation: "Crowded targets lead to accidental activation"
      remediation: "Add minimum 8px spacing between adjacent targets"

  medium:
    - id: "A11Y-TARGET-MED-001"
      signal: "Form checkboxes and radio buttons rely on native size"
      remediation: "Use custom styling to increase touch target"
    - id: "A11Y-TARGET-MED-002"
      signal: "Close buttons (X) small and hard to activate"
      remediation: "Increase close button target to at least 44x44px"
    - id: "A11Y-TARGET-MED-003"
      signal: "Pagination links cramped"
      remediation: "Ensure adequate spacing between pagination controls"

  low:
    - id: "A11Y-TARGET-LOW-001"
      signal: "Target size meets minimum but could be larger"

  positive:
    - id: "A11Y-TARGET-POS-001"
      signal: "All targets meet 44x44px AAA recommendation"
    - id: "A11Y-TARGET-POS-002"
      signal: "Adequate spacing between adjacent targets"
    - id: "A11Y-TARGET-POS-003"
      signal: "Icon buttons have visible touch area"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Interactive Elements"
      description: |
        Identify all interactive elements that require
        target size evaluation.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find buttons"
          command: "grep -rn '<button\\|<Button' --include='*.jsx' --include='*.tsx' --include='*.html' . | wc -l"
        - purpose: "Find links"
          command: "grep -rn '<a href\\|<Link' --include='*.jsx' --include='*.tsx' . | wc -l"
        - purpose: "Find icon buttons"
          command: "grep -rn 'icon.*button\\|button.*icon\\|IconButton' --include='*.jsx' --include='*.tsx' . | head -20"
      expected_findings:
        - "Interactive element counts"
        - "Icon button locations"

    - id: "2"
      name: "Measure Critical Elements"
      description: |
        Use DevTools to measure actual rendered dimensions
        of interactive elements.
      duration_estimate: "45 min"
      questions:
        - "Are all buttons at least 24x24 CSS pixels?"
        - "Are mobile touch targets at least 44x44 CSS pixels?"
        - "Are icon-only buttons adequately sized?"
        - "Are close/dismiss buttons large enough?"
      expected_findings:
        - "Actual element dimensions"
        - "Elements failing minimum size"

    - id: "3"
      name: "Check Target Spacing"
      description: |
        Verify adequate spacing between adjacent interactive
        elements.
      duration_estimate: "30 min"
      questions:
        - "Is there at least 8px between adjacent targets?"
        - "Are toolbar buttons adequately spaced?"
        - "Are form controls spaced appropriately?"
      expected_findings:
        - "Spacing measurements"
        - "Crowded target areas"

    - id: "4"
      name: "Mobile Testing"
      description: |
        Test target sizes on actual mobile devices or
        accurate mobile simulation.
      duration_estimate: "30 min"
      questions:
        - "Can all buttons be activated easily on mobile?"
        - "Are touch targets reachable in one-handed use?"
        - "Do accidental activations occur?"
      expected_findings:
        - "Mobile usability issues"
        - "Touch target problems"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Target Size Measurements"
        - "Elements Below Minimum"
        - "Spacing Analysis"
        - "Mobile Testing Results"
        - "Recommendations"

  confidence_guidance:
    high: "Measured with DevTools, tested on mobile devices"
    medium: "DevTools measurements complete"
    low: "CSS analysis only"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "wcag22-255"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed measurement"
    full:
      included: true
      priority: 2
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "target-size-001"
    item: "All targets meet 24x24px minimum (WCAG 2.2 AA)"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Measure interactive elements with DevTools"
    expected: "Confirmed by reviewer"

  - id: "target-size-002"
    item: "Mobile touch targets meet 44x44px recommendation"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test on mobile device or emulator"
    expected: "Confirmed by reviewer"

  - id: "target-size-003"
    item: "Icon buttons have adequate target size"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Check all icon-only buttons for size"
    expected: "Confirmed by reviewer"

  - id: "target-size-004"
    item: "Adjacent targets adequately spaced"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Check spacing between adjacent interactive elements"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.2"
      controls: ["2.5.5", "2.5.8"]
    - framework: "WCAG 2.1"
      controls: ["2.5.5"]
    - framework: "EN 301 549"
      controls: ["9.2.5.5"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.operable-timing.multiple-input-modality"
    - "accessibility-inclusion.operable-timing.pointer-gesture-alternative"
    - "accessibility-inclusion.operable-keyboard.full-keyboard-navigation"
