# ============================================================
# AUDIT: Text Resize Support - WCAG 2.1 Compliance
# ============================================================
# Verifies content remains usable when text is resized up to 200%
# without assistive technology.

audit:
  id: "accessibility-inclusion.perceivable-visual.text-resize-support"
  name: "Text Resize Support Verification"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "perceivable-visual"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit verifies that text can be resized up to 200% without loss
    of content or functionality, as required by WCAG 2.1 Success Criterion
    1.4.4. It also examines reflow behavior at 400% zoom per SC 1.4.10.

    The audit covers:
    - Browser zoom functionality (100% to 200%)
    - Text-only zoom capabilities
    - Responsive breakpoint behavior
    - Container overflow handling
    - Relative unit usage (em, rem, %, vw/vh vs px)
    - Line height and spacing at enlarged sizes
    - Mobile pinch-to-zoom support

  why_it_matters: |
    Users with low vision often rely on text enlargement to read content.
    Approximately 4% of people have low vision that requires text
    enlargement. When text cannot be resized:

    - Users may be unable to read any content
    - Content overflow causes information loss
    - Horizontal scrolling creates navigation barriers
    - Fixed layouts become unusable at larger sizes
    - Legal accessibility requirements are violated

  when_to_run:
    - "During responsive design implementation"
    - "After layout or typography changes"
    - "Before accessibility compliance audits"
    - "When implementing new UI components"
    - "After CSS framework updates"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to CSS and layout code"
    - type: "running_application"
      description: "Deployed instance for zoom testing"

  access_requirements:
    - "Read access to CSS/SCSS files"
    - "Browser access to running application"
    - "Multiple browsers for cross-browser testing"

discovery:
  code_patterns:
    - pattern: "font-size:\\s*\\d+px"
      type: "regex"
      scope: "source"
      purpose: "Identify fixed pixel font sizes"
    - pattern: "line-height:\\s*\\d+px"
      type: "regex"
      scope: "source"
      purpose: "Identify fixed pixel line heights"
    - pattern: "max-width:\\s*\\d+px.*!important"
      type: "regex"
      scope: "source"
      purpose: "Identify fixed maximum widths that may cause overflow"
    - pattern: "overflow:\\s*(hidden|clip)"
      type: "regex"
      scope: "source"
      purpose: "Identify potential text clipping"
    - pattern: "white-space:\\s*nowrap"
      type: "regex"
      scope: "source"
      purpose: "Identify text that cannot wrap"
    - pattern: "user-scalable\\s*=\\s*(no|0)"
      type: "regex"
      scope: "source"
      purpose: "Identify viewport restrictions on mobile zoom"
    - pattern: "maximum-scale\\s*=\\s*1"
      type: "regex"
      scope: "source"
      purpose: "Identify viewport zoom limitations"

  file_patterns:
    - glob: "**/*.css"
      purpose: "CSS stylesheets"
    - glob: "**/*.scss"
      purpose: "SASS stylesheets"
    - glob: "**/index.html"
      purpose: "Viewport meta tags"
    - glob: "**/_app.{js,tsx}"
      purpose: "Next.js application root"

knowledge_sources:
  specifications:
    - id: "wcag-21"
      name: "WCAG 2.1 Quick Reference"
      url: "https://www.w3.org/WAI/WCAG21/quickref/"
      offline_cache: true
      priority: "recommended"
    - id: "wcag-22"
      name: "WCAG 2.2 Specification"
      url: "https://www.w3.org/TR/WCAG22/"
      offline_cache: true
      priority: "recommended"
    - id: "wcag21-144"
      name: "WCAG 2.1 Success Criterion 1.4.4 Resize Text"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/resize-text.html"
      offline_cache: true
      priority: "required"
    - id: "wcag21-1410"
      name: "WCAG 2.1 Success Criterion 1.4.10 Reflow"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/reflow.html"
      offline_cache: true
      priority: "required"
    - id: "wcag21-1412"
      name: "WCAG 2.1 Success Criterion 1.4.12 Text Spacing"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/text-spacing.html"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "webaim-textsize"
      name: "WebAIM: Text Accessibility"
      url: "https://webaim.org/techniques/fonts/"
      offline_cache: true
    - id: "mdn-viewport"
      name: "MDN: Viewport Meta Tag"
      url: "https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "stylelint"
      purpose: "Lint CSS for pixel-based font sizes"
      offline_capable: true
    - tool: "axe-core"
      purpose: "Automated accessibility testing including zoom"
      offline_capable: true

  scripts:
    - id: "find-fixed-fonts"
      language: "bash"
      purpose: "Find fixed pixel font sizes in CSS"
      source: "inline"
      code: |
        #!/bin/bash
        grep -rn "font-size:\s*[0-9]\+px" --include="*.css" --include="*.scss" . | \
          grep -v "// " | grep -v "/* " | head -50

signals:
  critical:
    - id: "A11Y-RESIZE-CRIT-001"
      signal: "Viewport meta tag prevents user scaling"
      evidence_pattern: "user-scalable=no or maximum-scale=1"
      explanation: |
        Preventing zoom on mobile devices completely blocks users
        with low vision from accessing content.
      remediation: "Remove user-scalable=no and maximum-scale restrictions from viewport meta"
    - id: "A11Y-RESIZE-CRIT-002"
      signal: "Text completely hidden at 200% zoom"
      evidence_pattern: "overflow:hidden on text containers with fixed heights"
      explanation: |
        When text is enlarged but clipped by containers, content
        becomes inaccessible.
      remediation: "Use min-height instead of height, allow overflow-y:auto"

  high:
    - id: "A11Y-RESIZE-HIGH-001"
      signal: "Content requires horizontal scrolling at 200% zoom"
      explanation: "Users should not need to scroll horizontally to read text"
      remediation: "Implement responsive reflow at larger text sizes"
    - id: "A11Y-RESIZE-HIGH-002"
      signal: "Navigation becomes unusable at enlarged sizes"
      explanation: "Navigation must remain functional at 200% zoom"
      remediation: "Implement responsive navigation that reflows properly"
    - id: "A11Y-RESIZE-HIGH-003"
      signal: "Form labels separate from inputs at enlarged sizes"
      explanation: "Labels must remain visually associated with their inputs"
      remediation: "Use relative positioning and flexible layouts"

  medium:
    - id: "A11Y-RESIZE-MED-001"
      signal: "Fixed pixel font sizes throughout codebase"
      remediation: "Convert to relative units (rem, em) for scalability"
    - id: "A11Y-RESIZE-MED-002"
      signal: "Line height uses fixed pixels"
      remediation: "Use unitless line-height values (1.5) for proper scaling"
    - id: "A11Y-RESIZE-MED-003"
      signal: "Content overlaps at 150% zoom"
      remediation: "Review spacing and use relative units"

  low:
    - id: "A11Y-RESIZE-LOW-001"
      signal: "Minor visual inconsistencies at 200% zoom"

  positive:
    - id: "A11Y-RESIZE-POS-001"
      signal: "All typography uses relative units"
    - id: "A11Y-RESIZE-POS-002"
      signal: "Content reflows properly up to 400% zoom"
    - id: "A11Y-RESIZE-POS-003"
      signal: "Mobile zoom is unrestricted"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Audit Viewport Configuration"
      description: |
        Check meta viewport tag configuration for zoom restrictions.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find viewport meta tags"
          command: "grep -rn 'viewport' --include='*.html' --include='*.jsx' --include='*.tsx' ."
        - purpose: "Check for zoom restrictions"
          command: "grep -rn 'user-scalable\\|maximum-scale' --include='*.html' ."
      expected_findings:
        - "Viewport configuration settings"
        - "Any zoom restrictions"

    - id: "2"
      name: "Analyze CSS Units"
      description: |
        Identify usage of fixed vs relative units for typography
        and spacing.
      duration_estimate: "30 min"
      commands:
        - purpose: "Count pixel-based font sizes"
          command: "grep -rc 'font-size:.*px' --include='*.css' --include='*.scss' . | grep -v ':0$'"
        - purpose: "Count relative font sizes"
          command: "grep -rc 'font-size:.*\\(rem\\|em\\|%\\)' --include='*.css' --include='*.scss' . | grep -v ':0$'"
      expected_findings:
        - "Ratio of fixed to relative units"
        - "Files requiring conversion"

    - id: "3"
      name: "Browser Zoom Testing"
      description: |
        Test the application at 100%, 150%, 200%, and 400% zoom
        levels across major browsers.
      duration_estimate: "60 min"
      questions:
        - "Is all content readable at 200% zoom?"
        - "Does content reflow without horizontal scrolling at 400% zoom (320px equivalent)?"
        - "Do interactive elements remain functional?"
        - "Are form labels still associated with inputs?"
        - "Does navigation remain accessible?"
      expected_findings:
        - "Layout breakage points"
        - "Overflow and clipping issues"
        - "Reflow behavior assessment"

    - id: "4"
      name: "Mobile Zoom Testing"
      description: |
        Verify pinch-to-zoom functionality on mobile devices.
      duration_estimate: "30 min"
      questions:
        - "Can users pinch to zoom on iOS Safari?"
        - "Can users pinch to zoom on Android Chrome?"
        - "Does zoomed content remain usable?"
      expected_findings:
        - "Mobile zoom functionality status"
        - "Touch target accessibility at zoom"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Zoom Testing Results"
        - "CSS Unit Analysis"
        - "Critical Failures"
        - "Remediation Plan"

  confidence_guidance:
    high: "Direct testing at specified zoom levels, verified across browsers"
    medium: "Static code analysis, pending runtime verification"
    low: "Inferred from CSS patterns"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag21-144"
        priority: "required"
      - source_id: "wcag21-1410"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive zoom testing across breakpoints"
    full:
      included: true
      priority: 2
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "text-resize-001"
    item: "Content usable at 200% browser zoom"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Test all major pages at 200% zoom, verify no content loss"
    expected: "Confirmed by reviewer"

  - id: "text-resize-002"
    item: "No viewport zoom restrictions on mobile"
    level: "CRITICAL"
    verification: "grep -r 'user-scalable.*no\\|maximum-scale.*1' --include='*.html' . | wc -l"
    expected: "0"

  - id: "text-resize-003"
    item: "Content reflows at 400% without horizontal scroll"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test at 400% zoom (320px width equivalent)"
    expected: "Confirmed by reviewer"

  - id: "text-resize-004"
    item: "Typography uses relative units"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Verify font-size declarations use rem/em"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["1.4.4", "1.4.10", "1.4.12"]
    - framework: "Section 508"
      controls: ["1194.22"]
    - framework: "EN 301 549"
      controls: ["9.1.4.4", "9.1.4.10"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.perceivable-visual.color-contrast"
    - "accessibility-inclusion.perceivable-visual.focus-indicator-visibility"
    - "accessibility-inclusion.operable-timing.target-size"
