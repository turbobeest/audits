# ============================================================
# AUDIT: Animation and Motion Control - WCAG 2.1 Compliance
# ============================================================
# Verifies users can control animations and motion to prevent
# vestibular disorders, seizures, and distraction.

audit:
  id: "accessibility-inclusion.perceivable-visual.animation-motion-control"
  name: "Animation and Motion Control Audit"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "perceivable-visual"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit examines motion, animation, and automatic content changes
    for compliance with WCAG 2.1 Success Criteria:
    - SC 2.2.2 Pause, Stop, Hide (Level A)
    - SC 2.3.1 Three Flashes or Below Threshold (Level A)
    - SC 2.3.3 Animation from Interactions (Level AAA)

    The audit covers:
    - Auto-playing videos and animations
    - Parallax scrolling effects
    - CSS animations and transitions
    - JavaScript-driven motion
    - Carousels and rotating content
    - Flashing or blinking content
    - Respecting prefers-reduced-motion media query
    - Motion triggered by user interaction

  why_it_matters: |
    Animations and motion can cause serious health issues for some users:

    - Vestibular disorders: Motion can cause nausea, dizziness, migraines
    - Photosensitive epilepsy: Flashing can trigger seizures
    - Attention disorders: Motion is highly distracting
    - Cognitive impairments: Auto-advancing content is hard to process

    Approximately 35% of adults over 40 have vestibular dysfunction,
    and 3% of epilepsy patients are photosensitive.

  when_to_run:
    - "When adding animations or transitions"
    - "When implementing carousels or auto-play content"
    - "Before accessibility compliance audits"
    - "When reviewing video content"
    - "After adding parallax or scroll-based effects"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to CSS and JavaScript code"
    - type: "running_application"
      description: "Deployed instance for motion testing"

  access_requirements:
    - "Read access to CSS and JavaScript files"
    - "Browser access to running application"
    - "Browser DevTools for animation inspection"

discovery:
  code_patterns:
    - pattern: "@keyframes"
      type: "regex"
      scope: "source"
      purpose: "Find CSS keyframe animations"
    - pattern: "animation:|animation-name:"
      type: "regex"
      scope: "source"
      purpose: "Find animation usage"
    - pattern: "transition:"
      type: "regex"
      scope: "source"
      purpose: "Find CSS transitions"
    - pattern: "transform:"
      type: "regex"
      scope: "source"
      purpose: "Find transform properties (often animated)"
    - pattern: "prefers-reduced-motion"
      type: "regex"
      scope: "source"
      purpose: "Find reduced motion support"
    - pattern: "autoplay"
      type: "regex"
      scope: "source"
      purpose: "Find auto-playing media"
    - pattern: "setInterval|requestAnimationFrame"
      type: "regex"
      scope: "source"
      purpose: "Find JavaScript animations"

  file_patterns:
    - glob: "**/*.css"
      purpose: "CSS stylesheets"
    - glob: "**/animation*.{js,ts}"
      purpose: "Animation JavaScript"
    - glob: "**/carousel*.{jsx,tsx}"
      purpose: "Carousel components"

knowledge_sources:
  specifications:
    - id: "wcag-21"
      name: "WCAG 2.1 Quick Reference"
      url: "https://www.w3.org/WAI/WCAG21/quickref/"
      offline_cache: true
      priority: "recommended"
    - id: "wcag-22"
      name: "WCAG 2.2 Specification"
      url: "https://www.w3.org/TR/WCAG22/"
      offline_cache: true
      priority: "recommended"
    - id: "wcag21-222"
      name: "WCAG 2.1 Success Criterion 2.2.2 Pause, Stop, Hide"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/pause-stop-hide.html"
      offline_cache: true
      priority: "required"
    - id: "wcag21-231"
      name: "WCAG 2.1 Success Criterion 2.3.1 Three Flashes or Below Threshold"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/three-flashes-or-below-threshold.html"
      offline_cache: true
      priority: "required"
    - id: "wcag21-233"
      name: "WCAG 2.1 Success Criterion 2.3.3 Animation from Interactions"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/animation-from-interactions.html"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "mdn-reduced-motion"
      name: "MDN: prefers-reduced-motion"
      url: "https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion"
      offline_cache: true
    - id: "a11y-motion"
      name: "A11Y Project: Reduced Motion"
      url: "https://www.a11yproject.com/posts/design-accessible-animation/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "axe-core"
      purpose: "Detect auto-playing media issues"
      offline_capable: true
    - tool: "PEAT (Photosensitive Epilepsy Analysis Tool)"
      purpose: "Analyze flashing content for seizure risk"
      offline_capable: true

  scripts:
    - id: "find-animations"
      language: "bash"
      purpose: "Find animation usage in codebase"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== CSS Animations ==="
        grep -rn "@keyframes\|animation:" --include="*.css" --include="*.scss" . | head -30
        echo ""
        echo "=== Reduced Motion Support ==="
        grep -rn "prefers-reduced-motion" --include="*.css" --include="*.scss" . | head -20

signals:
  critical:
    - id: "A11Y-MOTION-CRIT-001"
      signal: "Content flashes more than 3 times per second"
      evidence_pattern: "Animation with flash frequency > 3Hz over significant area"
      explanation: |
        Flashing content can trigger photosensitive seizures in
        susceptible individuals. This is a life-safety issue.
      remediation: "Remove or slow flashing to below 3 flashes per second"
    - id: "A11Y-MOTION-CRIT-002"
      signal: "Auto-playing video with no pause control"
      evidence_pattern: "<video autoplay> without controls"
      explanation: |
        Auto-playing content without controls violates Level A
        requirements and can be distressing for many users.
      remediation: "Add visible pause/stop controls for all auto-playing media"

  high:
    - id: "A11Y-MOTION-HIGH-001"
      signal: "Animations ignore prefers-reduced-motion"
      explanation: "Users who set reduced motion preference must be respected"
      remediation: "Add @media (prefers-reduced-motion: reduce) { } styles"
    - id: "A11Y-MOTION-HIGH-002"
      signal: "Carousel auto-advances with no controls"
      explanation: "Auto-advancing content must be pausable"
      remediation: "Add pause button and/or stop on hover/focus"
    - id: "A11Y-MOTION-HIGH-003"
      signal: "Parallax effects with no alternative"
      explanation: "Parallax can cause vestibular distress"
      remediation: "Disable parallax when prefers-reduced-motion is set"

  medium:
    - id: "A11Y-MOTION-MED-001"
      signal: "Excessive animation duration or distance"
      remediation: "Reduce animation duration and travel distance"
    - id: "A11Y-MOTION-MED-002"
      signal: "No option to disable non-essential animations"
      remediation: "Provide user preference to reduce motion"
    - id: "A11Y-MOTION-MED-003"
      signal: "Scroll-triggered animations without control"
      remediation: "Respect prefers-reduced-motion for scroll effects"

  low:
    - id: "A11Y-MOTION-LOW-001"
      signal: "Micro-interactions could be simplified"

  positive:
    - id: "A11Y-MOTION-POS-001"
      signal: "prefers-reduced-motion fully supported"
    - id: "A11Y-MOTION-POS-002"
      signal: "All auto-playing content has controls"
    - id: "A11Y-MOTION-POS-003"
      signal: "No flashing or strobing content present"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Animations and Motion"
      description: |
        Identify all animations, transitions, and auto-playing
        content in the application.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find CSS animations"
          command: "grep -rn '@keyframes\\|animation:' --include='*.css' --include='*.scss' ."
        - purpose: "Find auto-playing media"
          command: "grep -rn 'autoplay' --include='*.html' --include='*.jsx' --include='*.tsx' ."
        - purpose: "Find JavaScript animations"
          command: "grep -rn 'requestAnimationFrame\\|setInterval' --include='*.js' --include='*.ts' . | head -30"
      expected_findings:
        - "Complete inventory of motion effects"
        - "Auto-playing media locations"

    - id: "2"
      name: "Check prefers-reduced-motion Support"
      description: |
        Verify the application respects the user's reduced
        motion preference setting.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find reduced motion media queries"
          command: "grep -rn 'prefers-reduced-motion' --include='*.css' --include='*.scss' --include='*.js' ."
        - purpose: "Count animations vs reduced motion queries"
          command: "echo 'Animations:' && grep -rc '@keyframes' --include='*.css' . | grep -v ':0$' | wc -l"
      expected_findings:
        - "Coverage of reduced motion support"
        - "Gaps in motion preference handling"

    - id: "3"
      name: "Test Animation Controls"
      description: |
        Verify all auto-playing and looping content can be
        paused, stopped, or hidden by the user.
      duration_estimate: "45 min"
      questions:
        - "Can all auto-playing videos be paused?"
        - "Do carousels have pause controls?"
        - "Can background animations be stopped?"
        - "Is there a site-wide motion preference setting?"
      expected_findings:
        - "Control availability for each animation type"
        - "Missing controls"

    - id: "4"
      name: "Flash Analysis"
      description: |
        Check for any content that flashes, blinks, or strobes,
        measuring frequency and area.
      duration_estimate: "30 min"
      questions:
        - "Does any content flash more than 3 times per second?"
        - "Are there any strobing or pulsing effects?"
        - "Do any videos contain flashing scenes?"
      expected_findings:
        - "Any potential seizure risks"
        - "Flash frequency measurements"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Animation Inventory"
        - "Reduced Motion Support Status"
        - "Flash Analysis Results"
        - "Critical Violations"
        - "Remediation Recommendations"

  confidence_guidance:
    high: "Direct testing with DevTools and preference toggling"
    medium: "Code analysis complete, runtime testing pending"
    low: "Inferred from CSS patterns"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag21-222"
        priority: "required"
      - source_id: "wcag21-231"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive motion inventory and testing"
    full:
      included: true
      priority: 2
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "animation-motion-001"
    item: "No content flashes more than 3 times per second"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Review all animations and videos for flash frequency"
    expected: "Confirmed by reviewer"

  - id: "animation-motion-002"
    item: "prefers-reduced-motion is respected"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Enable reduced motion in OS/browser and verify animations stop"
    expected: "Confirmed by reviewer"

  - id: "animation-motion-003"
    item: "Auto-playing content has pause/stop controls"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test all carousels, videos, and auto-advancing content"
    expected: "Confirmed by reviewer"

  - id: "animation-motion-004"
    item: "Parallax effects respect reduced motion"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test scroll-based effects with reduced motion enabled"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["2.2.2", "2.3.1", "2.3.3"]
    - framework: "Section 508"
      controls: ["1194.22(j)"]
    - framework: "EN 301 549"
      controls: ["9.2.2.2", "9.2.3.1"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.operable-timing.pause-stop-hide-control"
    - "accessibility-inclusion.perceivable-visual.dark-mode-support"
    - "accessibility-inclusion.understandable-content.consistent-navigation"
