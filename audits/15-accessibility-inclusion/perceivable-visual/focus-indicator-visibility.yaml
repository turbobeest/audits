audit:
  id: accessibility-inclusion.perceivable-visual.focus-indicator-visibility
  name: Focus Indicator Visibility Audit
  version: 1.0.0
  last_updated: '2026-01-19'
  status: active
  category: accessibility-inclusion
  category_number: 15
  subcategory: perceivable-visual
  tier: expert
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - accessibility
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines keyboard focus indicators to ensure they meet
    WCAG 2.1 SC 2.4.7 (Focus Visible - Level AA) and WCAG 2.2 SC 2.4.11
    (Focus Not Obscured - Level AA) and SC 2.4.13 (Focus Appearance - Level AAA).

    The audit covers:
    - Visibility of focus outline/ring on all interactive elements
    - Contrast ratio of focus indicators (minimum 3:1)
    - Focus indicator area and thickness
    - Focus not obscured by sticky headers, modals, or tooltips
    - Consistency of focus styles across components
    - Custom focus styles vs browser defaults
    - Focus visibility in all themes (light/dark mode)
  why_it_matters: |
    Users who navigate with keyboards, switches, or other non-pointer
    devices rely entirely on focus indicators to know where they are
    on the page. Without visible focus:

    - Keyboard users cannot track their position
    - Users may accidentally activate wrong controls
    - Navigation becomes impossible for some users
    - Motor-impaired users lose independence
    - Legal accessibility requirements are violated
  when_to_run:
  - When customizing focus styles
  - After CSS resets or framework changes
  - When adding new interactive components
  - During accessibility compliance audits
  - When implementing dark mode or themes
prerequisites:
  required_artifacts:
  - type: codebase
    description: Access to CSS and component code
  - type: running_application
    description: Deployed instance for keyboard testing
  access_requirements:
  - Read access to all CSS files
  - Browser access to running application
  - Keyboard for navigation testing
discovery:
  code_patterns:
  - pattern: outline:\s*none
    type: regex
    scope: source
    purpose: Find removed focus outlines
  - pattern: outline:\s*0
    type: regex
    scope: source
    purpose: Find zeroed focus outlines
  - pattern: :focus\s*{[^}]*outline:\s*none
    type: regex
    scope: source
    purpose: Find focus state outline removal
  - pattern: :focus-visible
    type: regex
    scope: source
    purpose: Find modern focus-visible usage
  - pattern: outline-offset
    type: regex
    scope: source
    purpose: Find custom outline positioning
  - pattern: box-shadow.*focus
    type: regex
    scope: source
    purpose: Find box-shadow focus indicators
  file_patterns:
  - glob: '**/*.css'
    purpose: CSS stylesheets
  - glob: '**/reset*.css'
    purpose: CSS reset files
  - glob: '**/normalize*.css'
    purpose: Normalize CSS files
  - glob: '**/base*.css'
    purpose: Base styling files
knowledge_sources:
  specifications:
  - id: wcag-21
    name: WCAG 2.1 Quick Reference
    url: https://www.w3.org/WAI/WCAG21/quickref/
    offline_cache: true
    priority: recommended
  - id: wcag-22
    name: WCAG 2.2 Specification
    url: https://www.w3.org/TR/WCAG22/
    offline_cache: true
    priority: recommended
  - id: wcag21-247
    name: WCAG 2.1 Success Criterion 2.4.7 Focus Visible
    url: https://www.w3.org/WAI/WCAG21/Understanding/focus-visible.html
    offline_cache: true
    priority: required
  - id: wcag22-2411
    name: WCAG 2.2 Success Criterion 2.4.11 Focus Not Obscured (Minimum)
    url: https://www.w3.org/WAI/WCAG22/Understanding/focus-not-obscured-minimum.html
    offline_cache: true
    priority: required
  - id: wcag22-2413
    name: WCAG 2.2 Success Criterion 2.4.13 Focus Appearance
    url: https://www.w3.org/WAI/WCAG22/Understanding/focus-appearance.html
    offline_cache: true
    priority: recommended
  guides:
  - id: deque-focus
    name: 'Deque: Designing Visible Focus'
    url: https://www.deque.com/blog/give-site-focus-tips-designing-usable-focus-indicators/
    offline_cache: true
  - id: a11y-focus
    name: 'A11Y Project: Focus Styles'
    url: https://www.a11yproject.com/posts/never-remove-css-outlines/
    offline_cache: true
tooling:
  static_analysis:
  - tool: axe-core
    purpose: Detect focus indicator issues
    offline_capable: true
  - tool: stylelint
    purpose: Lint for outline:none anti-patterns
    offline_capable: true
  scripts:
  - id: find-outline-removal
    language: bash
    purpose: Find CSS that removes focus outlines
    source: inline
    code: |
      #!/bin/bash
      grep -rn "outline:\s*\(none\|0\)" --include="*.css" --include="*.scss" . | \
        grep -v "// " | grep -v "/\* "
signals:
  critical:
  - id: A11Y-FOCUS-CRIT-001
    signal: Focus outline removed globally without replacement
    explanation: |
      Removing focus outlines without providing an alternative makes
      keyboard navigation impossible for all users.
    remediation: Add visible focus styling - outline, box-shadow, or border
    evidence_description: '*:focus { outline: none } without alternative styling'
  - id: A11Y-FOCUS-CRIT-002
    signal: No visible focus indicator on interactive elements
    evidence_pattern: Elements with tabindex that have no focus style
    explanation: |
      Interactive elements must have visible focus indicators for
      keyboard users to track their position.
    remediation: Add :focus or :focus-visible styles with visible indicator
  high:
  - id: A11Y-FOCUS-HIGH-001
    signal: Focus indicator has insufficient contrast (< 3:1)
    explanation: Focus indicators must have 3:1 contrast against adjacent colors
    remediation: Increase contrast of focus outline/ring color
  - id: A11Y-FOCUS-HIGH-002
    signal: Focus indicator obscured by sticky elements
    explanation: WCAG 2.2 requires focused elements not be completely hidden
    remediation: Ensure focused elements scroll into view clear of sticky headers
  - id: A11Y-FOCUS-HIGH-003
    signal: Focus indicator too thin or small to perceive
    explanation: WCAG 2.2 AAA requires 2px minimum outline or equivalent area
    remediation: Increase outline width to at least 2px
  medium:
  - id: A11Y-FOCUS-MED-001
    signal: Inconsistent focus styles across components
    remediation: Standardize focus indicator styling in design system
  - id: A11Y-FOCUS-MED-002
    signal: Focus indicator not visible in dark mode
    remediation: Define separate focus colors for dark mode
  - id: A11Y-FOCUS-MED-003
    signal: Custom focus style weaker than browser default
    remediation: Ensure custom styles are at least as visible as default
  low:
  - id: A11Y-FOCUS-LOW-001
    signal: Focus indicator could be more prominent
  positive:
  - id: A11Y-FOCUS-POS-001
    signal: All elements have visible focus indicators
  - id: A11Y-FOCUS-POS-002
    signal: Focus-visible used for keyboard-only focus styles
  - id: A11Y-FOCUS-POS-003
    signal: Focus indicators meet WCAG 2.2 AAA appearance requirements
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Check for Focus Outline Removal
    description: |
      Search codebase for CSS that removes or hides focus outlines
      without providing visible alternatives.
    duration_estimate: 20 min
    commands:
    - purpose: Find outline:none declarations
      command: grep -rn 'outline:\s*none\|outline:\s*0' --include='*.css' --include='*.scss' .
    - purpose: Check for focus-visible usage
      command: grep -rn ':focus-visible' --include='*.css' --include='*.scss' .
    - purpose: Find custom focus styles
      command: grep -rn ':focus' --include='*.css' . | head -50
    expected_findings:
    - List of outline removal instances
    - Custom focus styling approaches used
  - id: '2'
    name: Keyboard Navigation Testing
    description: |
      Tab through the entire application using keyboard only,
      verifying focus visibility on every element.
    duration_estimate: 60 min
    questions:
    - Is focus visible on every interactive element?
    - Can you track focus position at all times?
    - Is focus visible in both light and dark modes?
    - Are custom components (dropdowns, modals) focusable?
    - Is focus ever obscured by sticky elements?
    expected_findings:
    - Elements with missing focus indicators
    - Focus visibility issues by component type
  - id: '3'
    name: Measure Focus Indicator Contrast
    description: |
      For visible focus indicators, verify the contrast ratio
      meets the 3:1 minimum requirement.
    duration_estimate: 30 min
    questions:
    - What is the contrast ratio of the focus indicator against the background?
    - What is the contrast ratio against the focused element?
    - Is the focus indicator visible on all backgrounds used?
    expected_findings:
    - Contrast ratios for focus indicators
    - Background combinations that fail
  - id: '4'
    name: Test Focus Not Obscured
    description: |
      Verify focused elements are not hidden behind sticky
      headers, footers, or overlays.
    duration_estimate: 30 min
    questions:
    - Are there sticky headers that could cover focused elements?
    - Do modals properly trap and show focus?
    - Is focus visible when scrolling through forms?
    expected_findings:
    - Situations where focus is obscured
    - Scroll behavior issues
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Focus Indicator Inventory
    - Keyboard Testing Results
    - Contrast Analysis
    - Critical Violations
    - Remediation Recommendations
  confidence_guidance:
    high: Manually tested with keyboard, contrast verified
    medium: Static analysis complete, testing pending
    low: Inferred from CSS patterns
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: wcag21-247
      priority: required
    - source_id: wcag22-2411
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 2
      reason: Focus visibility is critical for keyboard users
    full:
      included: true
      priority: 1
    accessibility:
      included: true
      priority: 1
closeout_checklist:
- id: focus-visibility-001
  item: No global outline:none without alternative focus styles
  level: CRITICAL
  verification: grep -r 'outline.*none' --include='*.css' . | grep -v ':focus' | wc -l
  expected: Manual review of results
- id: focus-visibility-002
  item: All interactive elements have visible focus indicator
  level: CRITICAL
  verification: manual
  agent_alternative: Use static analysis tools to generate metrics; check for existing code review comments
  verification_notes: Tab through entire application and verify focus visibility
  expected: Confirmed by reviewer
- id: focus-visibility-003
  item: Focus indicators have 3:1 minimum contrast
  level: BLOCKING
  verification: manual
  verification_notes: Measure contrast of focus indicators against backgrounds
  expected: Confirmed by reviewer
- id: focus-visibility-004
  item: Focus is not obscured by sticky elements
  level: BLOCKING
  verification: manual
  verification_notes: Test focus visibility with sticky headers/footers
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: WCAG 2.1
    controls:
    - 2.4.7
  - framework: WCAG 2.2
    controls:
    - 2.4.11
    - 2.4.13
  - framework: Section 508
    controls:
    - 1194.21(c)
  - framework: EN 301 549
    controls:
    - 9.2.4.7
    - 11.2.4.7
relationships:
  commonly_combined:
  - accessibility-inclusion.operable-keyboard.full-keyboard-navigation
  - accessibility-inclusion.operable-keyboard.focus-order
  - accessibility-inclusion.perceivable-visual.color-contrast
  - accessibility-inclusion.perceivable-visual.color-only-information
