# ============================================================
# AUDIT: Skip Links - WCAG 2.1 Compliance
# ============================================================
# Verifies skip links are provided to bypass repeated content
# per WCAG 2.1 Success Criterion 2.4.1.

audit:
  id: "accessibility-inclusion.operable-keyboard.skip-link"
  name: "Skip Link Audit"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "operable-keyboard"

  tier: "expert"
  estimated_duration: "1-2 hours"  # median: 1h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit verifies mechanisms exist to skip repeated content
    per WCAG 2.1 SC 2.4.1 Bypass Blocks (Level A).

    The audit covers:
    - Skip to main content link
    - Skip to navigation link
    - Skip links visibility on focus
    - Skip link target accuracy
    - Proper focus management after skip
    - ARIA landmarks as bypass mechanism
    - Heading structure for screen reader navigation
    - Table of contents for long pages

  why_it_matters: |
    Without skip links, keyboard and screen reader users must
    navigate through the same content on every page:

    - Navigation menus often have dozens of links
    - Headers, footers repeat on every page
    - Keyboard users must Tab through all items to reach content
    - Screen reader users must listen to repeated content
    - Makes routine navigation tedious and time-consuming

    A simple skip link can reduce navigation from dozens of
    Tab presses to just one or two.

  when_to_run:
    - "When implementing page layouts"
    - "After navigation structure changes"
    - "Before accessibility compliance audits"
    - "When adding new repeated sections"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to layout and navigation code"
    - type: "running_application"
      description: "Deployed instance for testing"

  access_requirements:
    - "Read access to HTML templates"
    - "Browser access for testing"

discovery:
  code_patterns:
    - pattern: "skip[-_]?(to)?[-_]?(main|content|nav)"
      type: "regex"
      scope: "source"
      purpose: "Find skip link implementations"
    - pattern: "#main|#content|#primary"
      type: "regex"
      scope: "source"
      purpose: "Find skip link targets"
    - pattern: "role=\"main\"|role=\"navigation\"|role=\"banner\""
      type: "regex"
      scope: "source"
      purpose: "Find ARIA landmarks"
    - pattern: "<main|<nav|<header|<footer"
      type: "regex"
      scope: "source"
      purpose: "Find HTML5 landmark elements"

  file_patterns:
    - glob: "**/layout*.{jsx,tsx,html}"
      purpose: "Layout files"
    - glob: "**/header*.{jsx,tsx,html}"
      purpose: "Header components"
    - glob: "**/app.{jsx,tsx}"
      purpose: "Application root"

knowledge_sources:
  specifications:
    - id: "wcag-21"
      name: "WCAG 2.1 Quick Reference"
      url: "https://www.w3.org/WAI/WCAG21/quickref/"
      offline_cache: true
      priority: "recommended"
    - id: "wcag21-241"
      name: "WCAG 2.1 Success Criterion 2.4.1 Bypass Blocks"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/bypass-blocks.html"
      offline_cache: true
      priority: "required"

  guides:
    - id: "webaim-skip"
      name: "WebAIM: Skip Navigation Links"
      url: "https://webaim.org/techniques/skipnav/"
      offline_cache: true
    - id: "a11y-skip"
      name: "A11Y Project: Skip Links"
      url: "https://www.a11yproject.com/posts/skip-nav-links/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "axe-core"
      purpose: "Detect missing skip links"
      offline_capable: true

  scripts:
    - id: "find-skip-links"
      language: "bash"
      purpose: "Find skip link implementations"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Skip Links ==="
        grep -rn "skip.*main\|skip.*content\|skip.*nav" --include="*.html" --include="*.jsx" --include="*.tsx" . | head -20
        echo ""
        echo "=== Landmarks ==="
        grep -rn "<main\|role=\"main\"\|<nav\|role=\"navigation\"" --include="*.html" --include="*.jsx" . | head -20

signals:
  critical:
    - id: "A11Y-SKIP-CRIT-001"
      signal: "No skip link and no landmark regions"
      evidence_pattern: "Page without skip-to-main link or ARIA landmarks"
      explanation: |
        Without any bypass mechanism, keyboard users must Tab through
        all navigation and repeated content to reach main content.
      remediation: "Add skip-to-main-content link AND/OR implement ARIA landmarks"

  high:
    - id: "A11Y-SKIP-HIGH-001"
      signal: "Skip link target doesn't exist"
      explanation: "Skip link href points to non-existent ID"
      remediation: "Ensure skip link target element exists with matching ID"
    - id: "A11Y-SKIP-HIGH-002"
      signal: "Skip link not first focusable element"
      explanation: "Skip link must be reached before navigation"
      remediation: "Place skip link as first element in page body"
    - id: "A11Y-SKIP-HIGH-003"
      signal: "Skip link hidden in way that prevents focus"
      explanation: "display:none or visibility:hidden prevent keyboard access"
      remediation: "Use CSS that keeps link focusable (off-screen positioning)"

  medium:
    - id: "A11Y-SKIP-MED-001"
      signal: "Skip link not visible on focus"
      remediation: "Show skip link on focus using :focus styles"
    - id: "A11Y-SKIP-MED-002"
      signal: "Focus not moved to skip target correctly"
      remediation: "Add tabindex='-1' to target element if needed"
    - id: "A11Y-SKIP-MED-003"
      signal: "Only one skip link for complex layout"
      remediation: "Consider multiple skip links for complex layouts"

  low:
    - id: "A11Y-SKIP-LOW-001"
      signal: "Skip link styling could be more visible"

  positive:
    - id: "A11Y-SKIP-POS-001"
      signal: "Skip link present and functional"
    - id: "A11Y-SKIP-POS-002"
      signal: "ARIA landmarks properly implemented"
    - id: "A11Y-SKIP-POS-003"
      signal: "Multiple skip links for complex layouts"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Check for Skip Link"
      description: |
        Verify a skip link exists and is properly positioned.
      duration_estimate: "15 min"
      commands:
        - purpose: "Find skip link"
          command: "grep -rn 'skip.*main\\|skip.*content' --include='*.html' --include='*.jsx' --include='*.tsx' ."
        - purpose: "Check link position"
          command: "head -50 src/index.html 2>/dev/null || head -50 public/index.html 2>/dev/null || grep -A5 '<body' --include='*.html' ."
      expected_findings:
        - "Skip link presence and position"
        - "Skip link target"

    - id: "2"
      name: "Test Skip Link Functionality"
      description: |
        Tab to skip link and verify it works correctly.
      duration_estimate: "20 min"
      questions:
        - "Is skip link the first focusable element?"
        - "Is skip link visible when focused?"
        - "Does activating skip link move focus to main content?"
        - "Is main content appropriately targeted?"
      expected_findings:
        - "Skip link functionality"
        - "Focus management accuracy"

    - id: "3"
      name: "Verify ARIA Landmarks"
      description: |
        Check if ARIA landmarks provide additional bypass options.
      duration_estimate: "20 min"
      commands:
        - purpose: "Find main landmark"
          command: "grep -rn '<main\\|role=\"main\"' --include='*.html' --include='*.jsx' --include='*.tsx' ."
        - purpose: "Find navigation landmark"
          command: "grep -rn '<nav\\|role=\"navigation\"' --include='*.html' --include='*.jsx' --include='*.tsx' ."
        - purpose: "Find banner/contentinfo"
          command: "grep -rn 'role=\"banner\"\\|role=\"contentinfo\"' --include='*.html' --include='*.jsx' ."
      expected_findings:
        - "Landmark implementation"
        - "Screen reader navigation options"

    - id: "4"
      name: "Test with Screen Reader"
      description: |
        Verify screen reader users can navigate by landmarks.
      duration_estimate: "20 min"
      questions:
        - "Can screen reader list all landmarks?"
        - "Can screen reader jump directly to main?"
        - "Are landmarks appropriately labeled?"
      expected_findings:
        - "Screen reader navigation experience"
        - "Landmark labeling quality"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Skip Link Analysis"
        - "ARIA Landmark Assessment"
        - "Keyboard Navigation Test"
        - "Recommendations"

  confidence_guidance:
    high: "Tested with keyboard and screen reader"
    medium: "Keyboard testing complete"
    low: "Code analysis only"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "wcag21-241"
        priority: "required"

profiles:
  membership:
    quick:
      included: true
      priority: 2
      reason: "Skip links are quick to verify and high impact"
    full:
      included: true
      priority: 2
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "skip-link-001"
    item: "Skip link present and functional"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Tab to first element and verify skip link appears and works"
    expected: "Confirmed by reviewer"

  - id: "skip-link-002"
    item: "Skip link visible on keyboard focus"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Tab to skip link and verify it becomes visible"
    expected: "Confirmed by reviewer"

  - id: "skip-link-003"
    item: "ARIA landmarks properly implemented"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify main, nav, banner landmarks exist"
    expected: "Confirmed by reviewer"

  - id: "skip-link-004"
    item: "Focus moves to target after skip"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Activate skip link and verify focus position"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["2.4.1"]
    - framework: "Section 508"
      controls: ["1194.22(o)"]
    - framework: "EN 301 549"
      controls: ["9.2.4.1"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.operable-keyboard.full-keyboard-navigation"
    - "accessibility-inclusion.operable-keyboard.focus-order"
    - "accessibility-inclusion.perceivable-visual.focus-indicator-visibility"
