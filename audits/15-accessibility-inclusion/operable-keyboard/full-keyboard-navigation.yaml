# ============================================================
# AUDIT: Full Keyboard Navigation - WCAG 2.1 Compliance
# ============================================================
# Verifies all functionality is accessible via keyboard
# per WCAG 2.1 Success Criterion 2.1.1.

audit:
  id: "accessibility-inclusion.operable-keyboard.full-keyboard-navigation"
  name: "Full Keyboard Navigation Audit"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "accessibility-inclusion"
  category_number: 15
  subcategory: "operable-keyboard"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "codebase"

  default_profiles:
    - "full"
    - "accessibility"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit verifies all functionality can be operated using
    keyboard alone per WCAG 2.1 SC 2.1.1 Keyboard (Level A) and
    SC 2.1.3 Keyboard (No Exception) (Level AAA).

    The audit covers:
    - Navigation through all interactive elements
    - Activation of links, buttons, and controls
    - Form input and submission
    - Custom widgets (dropdowns, modals, tabs, sliders)
    - Drag-and-drop operations with keyboard alternatives
    - Canvas and SVG interactions
    - Context menus and right-click alternatives
    - Touch gestures with keyboard equivalents

  why_it_matters: |
    Keyboard accessibility is fundamental to web accessibility:

    - Blind users navigate with keyboards via screen readers
    - Motor-impaired users may use switch devices or mouth sticks
    - Users with tremors cannot use a mouse precisely
    - Power users prefer keyboard for efficiency
    - Voice control systems often simulate keyboard input

    Approximately 2.5% of adults have motor impairments that
    affect mouse use. Keyboard failures block all these users.

  when_to_run:
    - "When implementing new interactive components"
    - "After JavaScript library updates"
    - "Before accessibility compliance audits"
    - "When adding custom widgets"
    - "During QA testing phases"

prerequisites:
  required_artifacts:
    - type: "codebase"
      description: "Access to HTML and JavaScript code"
    - type: "running_application"
      description: "Deployed instance for keyboard testing"

  access_requirements:
    - "Read access to component code"
    - "Browser access to running application"
    - "Physical keyboard for testing"

discovery:
  code_patterns:
    - pattern: "onclick\\s*="
      type: "regex"
      scope: "source"
      purpose: "Find click handlers that may need keyboard equivalents"
    - pattern: "addEventListener\\(['\"]click['\"]"
      type: "regex"
      scope: "source"
      purpose: "Find JavaScript click listeners"
    - pattern: "onmousedown|onmouseup|onmouseover"
      type: "regex"
      scope: "source"
      purpose: "Find mouse-only event handlers"
    - pattern: "tabindex\\s*=\\s*['\"]?-1"
      type: "regex"
      scope: "source"
      purpose: "Find elements removed from tab order"
    - pattern: "tabindex\\s*=\\s*['\"]?[2-9]|tabindex\\s*=\\s*['\"]?[0-9]{2,}"
      type: "regex"
      scope: "source"
      purpose: "Find potentially problematic positive tabindex"
    - pattern: "draggable|ondrag|ondrop"
      type: "regex"
      scope: "source"
      purpose: "Find drag-and-drop without keyboard alternative"

  file_patterns:
    - glob: "**/*.jsx"
      purpose: "React components"
    - glob: "**/*.tsx"
      purpose: "TypeScript components"
    - glob: "**/*.vue"
      purpose: "Vue components"
    - glob: "**/components/**/*.{js,ts}"
      purpose: "Component JavaScript"

knowledge_sources:
  specifications:
    - id: "wcag-21"
      name: "WCAG 2.1 Quick Reference"
      url: "https://www.w3.org/WAI/WCAG21/quickref/"
      offline_cache: true
      priority: "recommended"
    - id: "wcag21-211"
      name: "WCAG 2.1 Success Criterion 2.1.1 Keyboard"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/keyboard.html"
      offline_cache: true
      priority: "required"
    - id: "wcag21-213"
      name: "WCAG 2.1 Success Criterion 2.1.3 Keyboard (No Exception)"
      url: "https://www.w3.org/WAI/WCAG21/Understanding/keyboard-no-exception.html"
      offline_cache: true
      priority: "recommended"
    - id: "aria-practices"
      name: "WAI-ARIA Authoring Practices"
      url: "https://www.w3.org/WAI/ARIA/apg/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "webaim-keyboard"
      name: "WebAIM: Keyboard Accessibility"
      url: "https://webaim.org/techniques/keyboard/"
      offline_cache: true
    - id: "a11y-keyboard"
      name: "A11Y Project: Keyboard Testing"
      url: "https://www.a11yproject.com/posts/getting-started-with-keyboard-navigation/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "axe-core"
      purpose: "Detect keyboard accessibility issues"
      offline_capable: true
    - tool: "eslint-plugin-jsx-a11y"
      purpose: "Lint for keyboard accessibility in JSX"
      offline_capable: true

  scripts:
    - id: "find-mouse-only"
      language: "bash"
      purpose: "Find potential mouse-only handlers"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Mouse-only event handlers ==="
        grep -rn "onmousedown\|onmouseup\|onmouseover\|onmouseenter" \
          --include="*.jsx" --include="*.tsx" --include="*.html" . | head -30
        echo ""
        echo "=== Click handlers without keyboard equivalents ==="
        grep -rn "onclick\|onClick" --include="*.jsx" --include="*.tsx" . | \
          grep -v "onKeyDown\|onKeyPress\|onKeyUp" | head -30

signals:
  critical:
    - id: "A11Y-KEYBOARD-CRIT-001"
      signal: "Interactive element not keyboard accessible"
      evidence_pattern: "div/span with click handler but no tabindex or keyboard event"
      explanation: |
        Non-native interactive elements (div, span) are not keyboard
        accessible by default. Users cannot tab to or activate them.
      remediation: "Use native button/a elements OR add tabindex='0', role, and keyboard handlers"
    - id: "A11Y-KEYBOARD-CRIT-002"
      signal: "Functionality only available via mouse"
      evidence_pattern: "Feature requiring mouse drag or hover with no keyboard alternative"
      explanation: |
        All functionality must be available via keyboard. Mouse-only
        features exclude keyboard users entirely.
      remediation: "Provide keyboard alternative for all mouse interactions"

  high:
    - id: "A11Y-KEYBOARD-HIGH-001"
      signal: "Custom widget lacks keyboard interaction patterns"
      explanation: "Custom widgets need full keyboard support per ARIA patterns"
      remediation: "Implement keyboard patterns from WAI-ARIA Authoring Practices"
    - id: "A11Y-KEYBOARD-HIGH-002"
      signal: "Positive tabindex disrupts natural tab order"
      explanation: "tabindex > 0 creates confusing navigation order"
      remediation: "Use tabindex='0' and DOM order for tab sequence"
    - id: "A11Y-KEYBOARD-HIGH-003"
      signal: "Drag and drop has no keyboard alternative"
      explanation: "Drag operations must have keyboard equivalent"
      remediation: "Provide keyboard commands for drag/drop operations"

  medium:
    - id: "A11Y-KEYBOARD-MED-001"
      signal: "Keyboard shortcuts not documented"
      remediation: "Provide accessible documentation of keyboard shortcuts"
    - id: "A11Y-KEYBOARD-MED-002"
      signal: "Context menu content not available via keyboard"
      remediation: "Provide alternative access to context menu options"
    - id: "A11Y-KEYBOARD-MED-003"
      signal: "Hover content not available via keyboard"
      remediation: "Make hover content available on focus"

  low:
    - id: "A11Y-KEYBOARD-LOW-001"
      signal: "Keyboard interaction could be more efficient"

  positive:
    - id: "A11Y-KEYBOARD-POS-001"
      signal: "All interactive elements keyboard accessible"
    - id: "A11Y-KEYBOARD-POS-002"
      signal: "Custom widgets follow ARIA Authoring Practices"
    - id: "A11Y-KEYBOARD-POS-003"
      signal: "Keyboard shortcuts provided for efficiency"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory Interactive Elements"
      description: |
        Identify all interactive elements including native
        elements and custom widgets.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find click handlers"
          command: "grep -rn 'onClick\\|onclick' --include='*.jsx' --include='*.tsx' --include='*.html' . | head -50"
        - purpose: "Find custom interactive elements"
          command: "grep -rn 'role=\"button\"\\|role=\"link\"\\|role=\"tab\"' --include='*.jsx' --include='*.tsx' . | head -30"
        - purpose: "Find tabindex usage"
          command: "grep -rn 'tabindex\\|tabIndex' --include='*.jsx' --include='*.tsx' . | head -30"
      expected_findings:
        - "Complete list of interactive elements"
        - "Custom widget inventory"

    - id: "2"
      name: "Tab Through Entire Application"
      description: |
        Using only keyboard, tab through every page and
        verify all interactive elements are reachable.
      duration_estimate: "90 min"
      questions:
        - "Can all links be reached and activated with Enter?"
        - "Can all buttons be focused and activated with Enter/Space?"
        - "Can all form fields be reached and filled?"
        - "Can all custom widgets be operated?"
        - "Are any interactive elements skipped?"
      expected_findings:
        - "Elements not in tab order"
        - "Elements not keyboard activatable"

    - id: "3"
      name: "Test Custom Widgets"
      description: |
        Verify custom widgets (modals, dropdowns, tabs, etc.)
        implement correct keyboard patterns.
      duration_estimate: "60 min"
      questions:
        - "Do modals trap focus appropriately?"
        - "Can dropdowns be navigated with arrow keys?"
        - "Can tabs be navigated with arrow keys?"
        - "Do sliders support arrow key adjustment?"
        - "Can accordions be expanded/collapsed with Enter/Space?"
      expected_findings:
        - "Widget pattern compliance"
        - "Missing keyboard interactions"

    - id: "4"
      name: "Test Mouse-Dependent Features"
      description: |
        Identify any feature that appears to require mouse
        and verify keyboard alternatives exist.
      duration_estimate: "30 min"
      questions:
        - "Can drag-and-drop operations be done with keyboard?"
        - "Is hover-revealed content available on focus?"
        - "Are context menu items available via other means?"
        - "Can drawing/canvas tools be operated via keyboard?"
      expected_findings:
        - "Mouse-only features"
        - "Missing keyboard alternatives"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Interactive Element Inventory"
        - "Keyboard Navigation Results"
        - "Custom Widget Assessment"
        - "Critical Failures"
        - "Recommendations"

  confidence_guidance:
    high: "Complete keyboard testing performed"
    medium: "Sample testing with code analysis"
    low: "Code analysis only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "wcag21-211"
        priority: "required"
      - source_id: "aria-practices"
        priority: "required"

profiles:
  membership:
    quick:
      included: true
      priority: 1
      reason: "Keyboard access is fundamental to accessibility"
    full:
      included: true
      priority: 1
    accessibility:
      included: true
      priority: 1

closeout_checklist:
  - id: "keyboard-nav-001"
    item: "All interactive elements reachable via Tab"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Tab through entire application, verify nothing is skipped"
    expected: "Confirmed by reviewer"

  - id: "keyboard-nav-002"
    item: "All interactive elements activatable via keyboard"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Test Enter/Space activation on all buttons, links, controls"
    expected: "Confirmed by reviewer"

  - id: "keyboard-nav-003"
    item: "Custom widgets follow ARIA keyboard patterns"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Test modal, dropdown, tab, slider keyboard patterns"
    expected: "Confirmed by reviewer"

  - id: "keyboard-nav-004"
    item: "No positive tabindex values used"
    level: "WARNING"
    verification: "grep -r 'tabindex=\"[1-9]' --include='*.jsx' --include='*.tsx' --include='*.html' . | wc -l"
    expected: "0"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "WCAG 2.1"
      controls: ["2.1.1", "2.1.3"]
    - framework: "Section 508"
      controls: ["1194.21(a)"]
    - framework: "EN 301 549"
      controls: ["9.2.1.1", "11.2.1.1"]

relationships:
  commonly_combined:
    - "accessibility-inclusion.operable-keyboard.focus-order"
    - "accessibility-inclusion.operable-keyboard.focus-trap-prevention"
    - "accessibility-inclusion.perceivable-visual.focus-indicator-visibility"
