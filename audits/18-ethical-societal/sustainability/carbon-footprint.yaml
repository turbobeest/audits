# ============================================================
# AUDIT: Carbon Footprint
# ============================================================
# Evaluates the carbon emissions impact of software systems
# and digital infrastructure.

audit:
  id: "ethical-societal.sustainability.carbon-footprint"

  name: "Carbon Footprint"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "ethical-societal"
  category_number: 18
  subcategory: "sustainability"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "infrastructure"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates the carbon emissions impact of software systems including compute
    resources, data storage, network transfers, and end-user device energy.
    Quantifies emissions from infrastructure choices, usage patterns, and
    growth projections. Assesses carbon measurement practices, reduction
    strategies, and offsetting approaches.

  why_it_matters: |
    IT represents 2-4% of global carbon emissions and growing. Regulatory
    pressure increases - EU Corporate Sustainability Reporting Directive (CSRD)
    requires emissions disclosure. Investors and customers increasingly demand
    carbon transparency. Digital services have real environmental impact that
    responsible organizations must measure and reduce. Early carbon management
    creates competitive advantage.

  when_to_run:
    - "During infrastructure planning"
    - "When preparing sustainability reports"
    - "Before major scaling decisions"
    - "During annual environmental reviews"

prerequisites:
  required_artifacts:
    - type: "infrastructure_inventory"
      description: "Documentation of compute, storage, and network resources"
    - type: "usage_metrics"
      description: "System utilization and traffic data"

  access_requirements:
    - "Cloud provider carbon dashboards"
    - "Infrastructure utilization metrics"
    - "Energy consumption data"

discovery:
  code_patterns:
    - pattern: "(carbon|emission|co2|greenhouse|climate)"
      type: "regex"
      scope: "config"
      purpose: "Find carbon-related configuration"

  file_patterns:
    - glob: "**/sustainability/**"
      purpose: "Find sustainability modules"
    - glob: "**/*carbon*"
      purpose: "Locate carbon tracking"

  metrics_queries:
    - system: "Cloud Provider"
      query: "Carbon emissions by service"
      purpose: "Quantify infrastructure emissions"
      threshold: "Track trend and per-request metrics"
    - system: "Infrastructure metrics"
      query: "CPU/GPU utilization"
      purpose: "Assess compute efficiency"
      threshold: "Identify idle/underutilized resources"

knowledge_sources:
  specifications:
    - id: "ghg-protocol"
      name: "GHG Protocol Corporate Standard"
      url: "https://ghgprotocol.org/corporate-standard"
      offline_cache: true
      priority: "required"
    - id: "csrd"
      name: "EU Corporate Sustainability Reporting Directive"
      url: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:32022L2464"
      offline_cache: true
      priority: "required"

  guides:
    - id: "green-software"
      name: "Green Software Foundation Guidelines"
      url: "https://greensoftware.foundation/"
      offline_cache: true
    - id: "aws-carbon"
      name: "AWS Customer Carbon Footprint Tool"
      url: "https://aws.amazon.com/aws-cost-management/aws-customer-carbon-footprint-tool/"
      offline_cache: true
    - id: "azure-carbon"
      name: "Microsoft Emissions Impact Dashboard"
      url: "https://www.microsoft.com/en-us/sustainability/emissions-impact-dashboard"
      offline_cache: true

  papers:
    - id: "ai-carbon"
      title: "Energy and Policy Considerations for Deep Learning in NLP"
      url: "https://arxiv.org/abs/1906.02243"

tooling:
  infrastructure_tools:
    - tool: "Cloud Carbon Footprint"
      purpose: "Open source tool for measuring cloud carbon emissions"
      command: "ccf --config ./ccf-config.json"
    - tool: "CO2.js"
      purpose: "JavaScript library for carbon estimation"
      offline_capable: true

  scripts:
    - id: "carbon-estimator"
      language: "python"
      purpose: "Estimate carbon emissions from cloud usage"
      source: "inline"
      code: |
        # Carbon intensity factors (gCO2e/kWh) by region
        CARBON_INTENSITY = {
            'us-east-1': 379.5,  # Virginia
            'us-west-2': 103.5,  # Oregon (hydro)
            'eu-west-1': 316.0,  # Ireland
            'eu-north-1': 8.0,   # Sweden (low carbon)
        }

        # Power estimates (Watts) by instance type
        INSTANCE_POWER = {
            't3.micro': 5,
            't3.small': 10,
            'm5.large': 40,
            'm5.xlarge': 80,
            'g4dn.xlarge': 200,  # GPU
        }

        def estimate_emissions(instance_type, region, hours):
            """Estimate CO2 emissions in grams."""
            power_w = INSTANCE_POWER.get(instance_type, 50)
            energy_kwh = (power_w * hours) / 1000
            intensity = CARBON_INTENSITY.get(region, 400)
            return energy_kwh * intensity

signals:
  critical:
    - id: "CARB-CRIT-001"
      signal: "No carbon emissions measurement"
      evidence_indicators:
        - "No cloud carbon dashboards enabled"
        - "No emissions tracking or reporting"
        - "Unable to quantify infrastructure emissions"
      explanation: |
        Without measurement, emissions cannot be managed. CSRD and other
        regulations increasingly require emissions disclosure. Unmeasured
        emissions represent unmanaged risk and missed reduction opportunities.
      remediation: "Enable cloud provider carbon dashboards and implement tracking"

  high:
    - id: "CARB-HIGH-001"
      signal: "Resources deployed in high-carbon regions without justification"
      explanation: "Region selection significantly impacts carbon intensity"
      remediation: "Prefer low-carbon regions where latency requirements permit"

    - id: "CARB-HIGH-002"
      signal: "Significant idle or underutilized resources"
      explanation: "Idle resources consume energy without providing value"
      remediation: "Right-size resources and implement auto-scaling"

  medium:
    - id: "CARB-MED-001"
      signal: "No carbon reduction targets"
      remediation: "Set science-based carbon reduction targets"

    - id: "CARB-MED-002"
      signal: "Carbon offsetting without reduction strategy"
      remediation: "Prioritize reduction over offsetting"

  low:
    - id: "CARB-LOW-001"
      signal: "Carbon footprint not in sustainability reports"
      remediation: "Include digital carbon footprint in reporting"

  positive:
    - id: "CARB-POS-001"
      signal: "Carbon emissions tracked and reported"
    - id: "CARB-POS-002"
      signal: "Resources deployed in low-carbon regions"
    - id: "CARB-POS-003"
      signal: "Science-based reduction targets established"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory infrastructure"
      description: |
        Create complete inventory of compute, storage, and network
        resources across all environments.
      duration_estimate: "60 min"
      commands:
        - purpose: "List cloud resources"
          command: "aws resourcegroupstaggingapi get-resources --output json | jq '.ResourceTagMappingList | length'"
      expected_findings:
        - "Complete resource inventory"
        - "Resource distribution by region"

    - id: "2"
      name: "Measure emissions"
      description: |
        Quantify carbon emissions using cloud provider tools and
        calculation methodologies.
      duration_estimate: "90 min"
      questions:
        - "What are total emissions by scope?"
        - "Which services contribute most?"
        - "How do emissions trend over time?"
      expected_findings:
        - "Quantified emissions by scope and service"
        - "Emissions trend analysis"

    - id: "3"
      name: "Assess efficiency"
      description: |
        Evaluate resource utilization and identify waste including
        idle resources, over-provisioning, and inefficient patterns.
      duration_estimate: "60 min"
      expected_findings:
        - "Utilization efficiency metrics"
        - "Waste identification"

    - id: "4"
      name: "Review reduction strategies"
      description: |
        Assess existing carbon reduction strategies and identify
        additional opportunities.
      duration_estimate: "45 min"
      questions:
        - "Are resources in low-carbon regions where possible?"
        - "Is auto-scaling optimized?"
        - "Are carbon-aware computing practices used?"
      expected_findings:
        - "Strategy assessment"
        - "Additional opportunities"

    - id: "5"
      name: "Evaluate reporting"
      description: |
        Assess carbon reporting practices against regulatory
        requirements and stakeholder expectations.
      duration_estimate: "30 min"
      expected_findings:
        - "Reporting compliance assessment"
        - "Disclosure completeness"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "carbon_assessment"
      format: "structured"
      sections:
        - "Infrastructure Inventory"
        - "Emissions Quantification"
        - "Efficiency Analysis"
        - "Reduction Opportunities"
        - "Reporting Assessment"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Emissions Summary"
        - "Recommendations"

  confidence_guidance:
    high: "Full emissions measurement with verified data"
    medium: "Estimated emissions with some measured data"
    low: "Estimates based on resource inventory only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "ghg-protocol"
        priority: "required"
      - source_id: "green-software"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires detailed infrastructure analysis"
    full:
      included: true
      priority: 3

closeout_checklist:
  - id: "carb-001"
    item: "Carbon emissions measured"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Emissions quantified using cloud tools"
    expected: "Confirmed by reviewer"

  - id: "carb-002"
    item: "Emission sources identified"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Major emission sources documented"
    expected: "Confirmed by reviewer"

  - id: "carb-003"
    item: "Reduction opportunities identified"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Actionable reduction opportunities documented"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "GHG Protocol"
      controls: ["Scope 2", "Scope 3"]
    - framework: "EU CSRD"
      controls: ["Climate Reporting"]

relationships:
  commonly_combined:
    - "ethical-societal.sustainability.energy-efficiency"
    - "ethical-societal.sustainability.sustainable-hosting"
