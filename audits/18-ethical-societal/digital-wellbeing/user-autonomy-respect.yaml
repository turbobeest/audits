# ============================================================
# AUDIT: User Autonomy Respect
# ============================================================
# Evaluates product design for respect of user agency, informed
# choice, and control over their digital experience.

audit:
  id: "ethical-societal.digital-wellbeing.user-autonomy-respect"

  name: "User Autonomy Respect"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "ethical-societal"
  category_number: 18
  subcategory: "digital-wellbeing"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates respect for user autonomy including informed choice, meaningful
    control, reversibility of actions, and freedom from manipulation. Assesses
    whether users can understand, control, and exit their relationship with
    the product. Reviews transparency of algorithmic influence, data usage,
    and system behavior. Examines barriers to user agency.

  why_it_matters: |
    User autonomy is a fundamental ethical principle underlying privacy law,
    consumer protection, and human rights frameworks. Products that undermine
    autonomy through manipulation, lock-in, or opacity violate user trust and
    face increasing regulatory scrutiny. Respecting autonomy creates sustainable
    user relationships built on genuine value rather than exploitation.

  when_to_run:
    - "During ethical product design reviews"
    - "When designing user controls and settings"
    - "During consumer rights compliance assessments"
    - "Following concerns about user agency"

prerequisites:
  required_artifacts:
    - type: "product_design"
      description: "Product features and user control documentation"
    - type: "user_settings"
      description: "User preference and control implementations"

  access_requirements:
    - "User settings and controls implementation"
    - "Account management features"
    - "Data export and deletion capabilities"

discovery:
  code_patterns:
    - pattern: "(preference|setting|control|option|choice)"
      type: "regex"
      scope: "source"
      purpose: "Find user control implementations"
    - pattern: "(delete|remove|export|download|leave|quit)"
      type: "regex"
      scope: "source"
      purpose: "Locate exit and data control features"
    - pattern: "(algorithm|recommend|personalize|suggest)"
      type: "regex"
      scope: "source"
      purpose: "Find algorithmic influence points"

  file_patterns:
    - glob: "**/settings/**"
      purpose: "Find settings modules"
    - glob: "**/preferences/**"
      purpose: "Locate preference management"
    - glob: "**/account/**"
      purpose: "Find account management features"

  documents_to_review:
    - type: "User documentation"
      purpose: "Assess clarity of available controls"
    - type: "Terms of service"
      purpose: "Review user rights and limitations"

knowledge_sources:
  specifications:
    - id: "gdpr"
      name: "GDPR - Data Subject Rights"
      url: "https://gdpr-info.eu/"
      offline_cache: true
      priority: "required"
    - id: "dsa"
      name: "EU Digital Services Act"
      url: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:32022R2065"
      offline_cache: true
      priority: "required"

  guides:
    - id: "humane-design"
      name: "Center for Humane Technology Design Principles"
      url: "https://www.humanetech.com/"
      offline_cache: true
    - id: "ethical-os"
      name: "Ethical OS Toolkit"
      url: "https://ethicalos.org/"
      offline_cache: true

  papers:
    - id: "nudge-ethics"
      title: "Nudge Ethics and Autonomy"
      url: "https://plato.stanford.edu/entries/ethics-manipulation/"

tooling:
  assessment_tools:
    - tool: "Autonomy assessment checklist"
      purpose: "Structured evaluation of autonomy respect"

  scripts:
    - id: "autonomy-finder"
      language: "bash"
      purpose: "Find user control and exit mechanisms"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== User Settings ==="
        grep -r -E "(settings|preferences|options)" \
          --include="*.tsx" --include="*.jsx" . 2>/dev/null | head -20

        echo "=== Data Control ==="
        grep -r -E "(export|download|delete|remove).*data" \
          --include="*.py" --include="*.ts" . 2>/dev/null | head -20

        echo "=== Account Deletion ==="
        grep -r -E "(delete.*account|close.*account|deactivate)" \
          --include="*.py" --include="*.ts" . 2>/dev/null | head -20

        echo "=== Algorithm Control ==="
        grep -r -E "(algorithm|recommend|personalize).*(?:off|disable|control)" \
          --include="*.py" --include="*.ts" . 2>/dev/null | head -20

signals:
  critical:
    - id: "AUTO-CRIT-001"
      signal: "No account deletion capability"
      evidence_indicators:
        - "Cannot delete account"
        - "Deletion requires contacting support with long delays"
        - "Deletion is technically not implemented"
      explanation: |
        Users must be able to end their relationship with a service. GDPR
        provides right to erasure. Inability to leave traps users and
        violates fundamental autonomy.
      remediation: "Implement self-service account deletion"

    - id: "AUTO-CRIT-002"
      signal: "Data export not available"
      evidence_indicators:
        - "Cannot export user data"
        - "No data portability feature"
      explanation: |
        GDPR Article 20 provides right to data portability. Users need
        their data to exercise meaningful choice about platforms.
      remediation: "Implement comprehensive data export"

  high:
    - id: "AUTO-HIGH-001"
      signal: "No control over algorithmic recommendations"
      explanation: "Users cannot understand or influence what is shown to them"
      remediation: "Provide algorithmic transparency and control options"

    - id: "AUTO-HIGH-002"
      signal: "Irreversible actions without clear warning"
      explanation: "Users may make choices they cannot undo without understanding"
      remediation: "Add clear warnings and confirmation for irreversible actions"

  medium:
    - id: "AUTO-MED-001"
      signal: "Limited customization options"
      remediation: "Provide meaningful control over experience"

    - id: "AUTO-MED-002"
      signal: "Complex settings buried in menus"
      remediation: "Make important controls easily accessible"

  low:
    - id: "AUTO-LOW-001"
      signal: "No explanation of how choices affect experience"
      remediation: "Explain consequences of user choices"

  positive:
    - id: "AUTO-POS-001"
      signal: "Comprehensive, accessible settings dashboard"
    - id: "AUTO-POS-002"
      signal: "Clear data export and account deletion"
    - id: "AUTO-POS-003"
      signal: "Algorithmic transparency and control"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory user controls"
      description: |
        Map all user controls and settings including preferences,
        privacy settings, notification controls, and data management.
      duration_estimate: "45 min"
      commands:
        - purpose: "Find settings implementations"
          command: "grep -r -E '(settings|preferences|options)' --include='*.tsx' --include='*.jsx' ."
      expected_findings:
        - "Complete control inventory"
        - "Control accessibility assessment"

    - id: "2"
      name: "Evaluate data rights"
      description: |
        Assess implementation of data rights including access, export,
        rectification, and deletion capabilities.
      duration_estimate: "45 min"
      commands:
        - purpose: "Find data rights implementations"
          command: "grep -r -E '(export|download|delete).*data' --include='*.py' --include='*.ts' ."
      expected_findings:
        - "Data rights implementation status"
        - "Completeness assessment"

    - id: "3"
      name: "Assess account lifecycle"
      description: |
        Evaluate ability to create, modify, and delete accounts.
        Test friction in each lifecycle stage.
      duration_estimate: "45 min"
      expected_findings:
        - "Account lifecycle assessment"
        - "Exit friction evaluation"

    - id: "4"
      name: "Review algorithmic transparency"
      description: |
        Assess transparency about algorithmic influence and user
        ability to understand or control personalization.
      duration_estimate: "45 min"
      questions:
        - "Can users see why content is recommended?"
        - "Can users disable or modify personalization?"
        - "Is algorithmic influence disclosed?"
      expected_findings:
        - "Algorithmic transparency assessment"
        - "Control gaps"

    - id: "5"
      name: "Evaluate informed choice"
      description: |
        Assess whether users have sufficient information to make
        meaningful choices about their engagement.
      duration_estimate: "30 min"
      expected_findings:
        - "Information adequacy"
        - "Choice architecture assessment"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "autonomy_assessment"
      format: "structured"
      sections:
        - "Control Inventory"
        - "Data Rights Assessment"
        - "Account Lifecycle"
        - "Algorithmic Transparency"
        - "Informed Choice"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Key Findings"
        - "Autonomy Score"
        - "Recommendations"

  confidence_guidance:
    high: "Full system review with user journey testing"
    medium: "Code and feature review"
    low: "Documentation review only"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "gdpr"
        priority: "required"
      - source_id: "humane-design"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive autonomy assessment"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "auto-001"
    item: "Account deletion available"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Self-service account deletion implemented"
    expected: "Confirmed by reviewer"

  - id: "auto-002"
    item: "Data export available"
    level: "CRITICAL"
    verification: "grep -r -E '(export|download).*data' --include='*.py' --include='*.ts' . | wc -l | xargs -I{} test {} -gt 0 && echo PASS || echo FAIL"
    expected: "PASS"

  - id: "auto-003"
    item: "Key controls easily accessible"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Settings not buried in complex menus"
    expected: "Confirmed by reviewer"

  - id: "auto-004"
    item: "Irreversible actions have clear warnings"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Confirmation required for significant actions"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "GDPR"
      controls: ["Article 17", "Article 20"]
    - framework: "EU Digital Services Act"
      controls: ["Article 24-26"]

relationships:
  commonly_combined:
    - "ethical-societal.digital-wellbeing.dark-pattern-detection"
    - "ethical-societal.privacy-data-ethics.data-subject-rights"
