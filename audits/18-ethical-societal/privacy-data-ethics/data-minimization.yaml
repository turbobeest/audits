# ============================================================
# AUDIT: Data Minimization
# ============================================================
# Evaluates adherence to data minimization principles ensuring
# only necessary personal data is collected, processed, and retained.

audit:
  id: "ethical-societal.privacy-data-ethics.data-minimization"

  name: "Data Minimization"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "ethical-societal"
  category_number: 18
  subcategory: "privacy-data-ethics"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates adherence to the data minimization principle requiring that
    personal data collected is adequate, relevant, and limited to what is
    necessary for specified purposes. Reviews data collection points, storage
    practices, retention periods, and processing operations against stated
    purposes to identify excessive data collection or retention.

  why_it_matters: |
    Data minimization is a foundational GDPR principle (Article 5(1)(c)) and
    privacy best practice. Collecting more data than needed increases breach
    exposure, regulatory risk, and user privacy harm. Minimization reduces
    attack surface, simplifies compliance, and builds user trust. Violations
    can result in significant GDPR fines (up to 4% of global revenue).

  when_to_run:
    - "When designing new data collection features"
    - "During privacy impact assessments"
    - "After data processing purpose changes"
    - "During annual privacy audits"

prerequisites:
  required_artifacts:
    - type: "data_inventory"
      description: "Registry of personal data collected and processed"
    - type: "purpose_specification"
      description: "Documented purposes for data processing"

  access_requirements:
    - "Database schemas and data models"
    - "Data collection interface code"
    - "Privacy documentation and data flow diagrams"

discovery:
  code_patterns:
    - pattern: "(collect|gather|store|save|persist).*(?:personal|user|customer)"
      type: "regex"
      scope: "source"
      purpose: "Find personal data collection points"
    - pattern: "(email|phone|address|ssn|dob|location|ip_address)"
      type: "regex"
      scope: "source"
      purpose: "Identify specific PII fields"
    - pattern: "(optional|required|mandatory).*field"
      type: "regex"
      scope: "source"
      purpose: "Find optional vs required field designations"

  file_patterns:
    - glob: "**/models/**"
      purpose: "Find data models with PII"
    - glob: "**/schema*"
      purpose: "Locate database schemas"
    - glob: "**/forms/**"
      purpose: "Find data collection forms"

  documents_to_review:
    - type: "Data inventory"
      purpose: "Review what personal data is collected"
    - type: "Privacy policy"
      purpose: "Compare collection against stated purposes"
    - type: "Data flow diagrams"
      purpose: "Trace data through system"

knowledge_sources:
  specifications:
    - id: "gdpr-art5"
      name: "GDPR Article 5 - Principles"
      url: "https://gdpr-info.eu/art-5-gdpr/"
      offline_cache: true
      priority: "required"
    - id: "gdpr-art25"
      name: "GDPR Article 25 - Data Protection by Design"
      url: "https://gdpr-info.eu/art-25-gdpr/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "ico-minimization"
      name: "ICO Data Minimization Guidance"
      url: "https://ico.org.uk/for-organisations/guide-to-data-protection/guide-to-the-general-data-protection-regulation-gdpr/principles/data-minimisation/"
      offline_cache: true
    - id: "nist-privacy"
      name: "NIST Privacy Framework"
      url: "https://www.nist.gov/privacy-framework"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "data-inventory-scanner"
      purpose: "Identify PII fields in codebase"
      offline_capable: true

  scripts:
    - id: "pii-finder"
      language: "bash"
      purpose: "Find potential PII fields in code"
      source: "inline"
      code: |
        #!/bin/bash
        # Find common PII field patterns
        echo "=== Potential PII Fields ==="
        grep -r -E "(email|phone|address|ssn|social_security|dob|date_of_birth|passport|drivers_license|credit_card|ip_address|location|gps)" \
          --include="*.py" --include="*.ts" --include="*.java" --include="*.sql" . 2>/dev/null

        echo "=== Data Collection Points ==="
        grep -r -E "(user_input|form_data|collect|gather)" \
          --include="*.py" --include="*.ts" . 2>/dev/null

signals:
  critical:
    - id: "MIN-CRIT-001"
      signal: "Sensitive data collected without documented purpose"
      evidence_indicators:
        - "PII fields in database without business justification"
        - "Collection not mentioned in privacy policy"
        - "No documented processing purpose"
      explanation: |
        GDPR requires lawful basis and specified purpose for all personal data
        processing. Collecting data without documented purpose violates data
        minimization and purpose limitation principles.
      remediation: "Document purpose or remove unnecessary data collection"

    - id: "MIN-CRIT-002"
      signal: "No data retention limits defined"
      evidence_indicators:
        - "Personal data stored indefinitely"
        - "No retention policy implemented"
        - "No automated deletion processes"
      explanation: |
        Storage limitation principle requires data retention only as long as
        necessary. Indefinite retention violates GDPR and increases breach risk.
      remediation: "Implement retention policies and automated deletion"

  high:
    - id: "MIN-HIGH-001"
      signal: "Optional data collected as mandatory"
      explanation: "Collecting more than minimally necessary violates data minimization"
      remediation: "Make non-essential fields optional with clear explanation"

    - id: "MIN-HIGH-002"
      signal: "Data retained beyond stated retention period"
      explanation: "Holding data longer than necessary violates storage limitation"
      remediation: "Implement enforcement of retention periods"

  medium:
    - id: "MIN-MED-001"
      signal: "Full data retained when aggregated/anonymized would suffice"
      remediation: "Aggregate or anonymize data where individual records not needed"

    - id: "MIN-MED-002"
      signal: "Data copied to multiple systems without documented need"
      remediation: "Minimize data replication; document necessary copies"

  low:
    - id: "MIN-LOW-001"
      signal: "Data collection justification not documented"
      remediation: "Document business justification for each data element"

  positive:
    - id: "MIN-POS-001"
      signal: "Data minimization review in development process"
    - id: "MIN-POS-002"
      signal: "Automated retention enforcement implemented"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory personal data"
      description: |
        Create or verify inventory of all personal data collected and
        processed. Map data fields to sources and storage locations.
      duration_estimate: "60 min"
      commands:
        - purpose: "Find PII in data models"
          command: "grep -r -E '(email|phone|address|ssn|dob)' --include='*.py' --include='*.ts' --include='*.sql' ."
      expected_findings:
        - "Complete personal data inventory"
        - "Data sources and storage locations"

    - id: "2"
      name: "Map data to purposes"
      description: |
        For each personal data element, identify and document the
        specific processing purpose. Cross-reference with privacy policy.
      duration_estimate: "60 min"
      questions:
        - "What is the specific purpose for collecting each data element?"
        - "Is this purpose documented in the privacy policy?"
        - "Is this purpose necessary for the service?"
      expected_findings:
        - "Purpose mapping for each data element"
        - "Gaps between collection and documented purposes"

    - id: "3"
      name: "Assess necessity"
      description: |
        Evaluate whether each data element is necessary for its stated
        purpose. Identify data that could be minimized or eliminated.
      duration_estimate: "45 min"
      questions:
        - "Is this data element essential for the stated purpose?"
        - "Could the purpose be achieved with less data?"
        - "Are there alternatives to collecting this data?"
      expected_findings:
        - "Necessity assessment results"
        - "Candidates for elimination or minimization"

    - id: "4"
      name: "Review retention practices"
      description: |
        Assess data retention periods and enforcement mechanisms.
        Verify alignment with documented retention policies.
      duration_estimate: "45 min"
      commands:
        - purpose: "Find retention-related code"
          command: "grep -r -E '(retention|delete|purge|archive|expire)' --include='*.py' --include='*.ts' ."
      expected_findings:
        - "Retention period assessment"
        - "Enforcement mechanism status"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "data_inventory"
      format: "structured"
      sections:
        - "Personal Data Elements"
        - "Purpose Mapping"
        - "Retention Periods"
        - "Minimization Opportunities"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Key Findings"
        - "Recommendations"

  confidence_guidance:
    high: "Complete data inventory and purpose mapping"
    medium: "Partial inventory with documented gaps"
    low: "Limited access to data systems or documentation"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "gdpr-art5"
        priority: "required"
      - source_id: "ico-minimization"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive data inventory"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "min-001"
    item: "Personal data inventory complete"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "All personal data elements catalogued"
    expected: "Confirmed by reviewer"

  - id: "min-002"
    item: "Purpose documented for each data element"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Each data element has documented processing purpose"
    expected: "Confirmed by reviewer"

  - id: "min-003"
    item: "Retention periods defined"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Retention period specified for each data category"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "GDPR"
      controls: ["Article 5(1)(c)", "Article 5(1)(e)", "Article 25"]
    - framework: "CCPA"
      controls: ["1798.100"]

relationships:
  commonly_combined:
    - "ethical-societal.privacy-data-ethics.privacy-by-design"
    - "ethical-societal.privacy-data-ethics.data-subject-rights"
