# ============================================================
# AUDIT: Terms Compliance Audit
# ============================================================
# Evaluates compliance with terms of service, acceptable use
# policies, and contractual obligations with third-party services.

audit:
  id: "compliance-legal.legal-licensing.terms-compliance"

  name: "Terms Compliance Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "compliance-legal"
  category_number: 19
  subcategory: "legal-licensing"

  tier: "expert"
  estimated_duration: "3-5 hours"  # median: 4h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "organizational"

  default_profiles:
    - "full"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates compliance with terms of service and acceptable use policies
    for third-party services including cloud providers, SaaS platforms, APIs,
    and data providers. Reviews usage against contractual limitations,
    prohibited uses, and data handling requirements.

  why_it_matters: |
    Terms of service violations can result in service termination, legal
    action, and data loss. Cloud providers and API services actively enforce
    terms with account suspension. Non-compliance with data terms may
    expose organization to third-party liability. Understanding and following
    terms protects service continuity and legal standing.

  when_to_run:
    - "When onboarding new third-party services"
    - "Before launching new product features using services"
    - "During annual compliance reviews"
    - "After receiving terms violation notices"
    - "When expanding service usage"

prerequisites:
  required_artifacts:
    - type: "service_inventory"
      description: "Inventory of third-party services used"
    - type: "terms_documentation"
      description: "Terms of service for each service"
    - type: "usage_documentation"
      description: "How services are used"

  access_requirements:
    - "Service terms and agreements"
    - "Usage documentation"
    - "Integration configurations"
    - "Data flow diagrams"

discovery:
  code_patterns:
    - pattern: "(api|sdk|client|integration)"
      type: "regex"
      scope: "source"
      purpose: "Find third-party integrations"

  file_patterns:
    - glob: "**/integrations/**"
      purpose: "Find integration code"
    - glob: "**/config/*api*"
      purpose: "Locate API configurations"

  documents_to_review:
    - type: "Terms of Service"
      purpose: "Understand usage restrictions"
    - type: "Acceptable Use Policy"
      purpose: "Identify prohibited uses"
    - type: "API documentation"
      purpose: "Review rate limits and restrictions"

knowledge_sources:
  guides:
    - id: "contract-management"
      name: "Contract Management Best Practices"
      url: "https://www.worldcc.com/"
      offline_cache: true

tooling:
  assessment_tools:
    - tool: "Terms compliance checklist"
      purpose: "Structured terms review"

signals:
  critical:
    - id: "TRM-CRIT-001"
      signal: "Usage violates prohibitions in terms"
      evidence_indicators:
        - "Prohibited use case implemented"
        - "Data used in violation of terms"
        - "Service used for excluded purpose"
      explanation: |
        Violating explicit prohibitions risks immediate service termination
        and potential legal action. Service providers actively monitor
        for terms violations.
      remediation: "Cease prohibited use immediately and review compliance"

    - id: "TRM-CRIT-002"
      signal: "Data handling violates terms"
      evidence_indicators:
        - "Data retained beyond permitted period"
        - "Data shared in violation of terms"
        - "Data used for prohibited purposes"
      explanation: |
        Data handling violations breach contract and may expose to third-
        party claims. Data providers especially sensitive to unauthorized
        use or sharing.
      remediation: "Align data handling with terms requirements"

  high:
    - id: "TRM-HIGH-001"
      signal: "Rate limits exceeded or circumvented"
      explanation: "API abuse may result in service suspension"
      remediation: "Implement proper rate limiting and caching"

    - id: "TRM-HIGH-002"
      signal: "Commercial use without commercial license"
      explanation: "Many services have different terms for commercial use"
      remediation: "Obtain appropriate commercial license"

  medium:
    - id: "TRM-MED-001"
      signal: "Terms not reviewed for major services"
      remediation: "Review terms for all critical services"

    - id: "TRM-MED-002"
      signal: "No process for terms change monitoring"
      remediation: "Monitor terms updates for key services"

  low:
    - id: "TRM-LOW-001"
      signal: "Service terms not documented centrally"
      remediation: "Create central repository of service terms"

  positive:
    - id: "TRM-POS-001"
      signal: "Terms reviewed and documented for all services"
    - id: "TRM-POS-002"
      signal: "Compliance verification in service onboarding"
    - id: "TRM-POS-003"
      signal: "Regular compliance review process"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory third-party services"
      description: |
        Identify all third-party services in use including cloud,
        SaaS, APIs, and data services.
      duration_estimate: "45 min"
      questions:
        - "What cloud services are used?"
        - "What SaaS platforms are integrated?"
        - "What external APIs are called?"
        - "What data services are used?"
      expected_findings:
        - "Service inventory"
        - "Integration mapping"

    - id: "2"
      name: "Collect service terms"
      description: |
        Gather current terms of service, acceptable use policies,
        and relevant documentation for each service.
      duration_estimate: "30 min"
      expected_findings:
        - "Terms collection"
        - "Key restrictions identified"

    - id: "3"
      name: "Document actual usage"
      description: |
        Document how each service is actually used including
        data flows, volumes, and use cases.
      duration_estimate: "45 min"
      commands:
        - purpose: "Find integration code"
          command: "grep -r -E '(api|sdk|client)' --include='*.py' --include='*.ts' --include='*.java' . | head -30"
      expected_findings:
        - "Usage documentation"
        - "Data flow mapping"

    - id: "4"
      name: "Compare usage to terms"
      description: |
        Analyze actual usage against terms of service to identify
        potential violations.
      duration_estimate: "60 min"
      expected_findings:
        - "Compliance analysis"
        - "Violation identification"

    - id: "5"
      name: "Review data handling compliance"
      description: |
        Specifically assess data handling against data-related
        terms including storage, sharing, and retention.
      duration_estimate: "30 min"
      expected_findings:
        - "Data terms compliance"
        - "Handling requirements"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "terms_assessment"
      format: "structured"
      sections:
        - "Service Inventory"
        - "Terms Summary"
        - "Usage Analysis"
        - "Compliance Status"
        - "Data Handling Review"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Compliance Status"
        - "Recommendations"

  confidence_guidance:
    high: "All services reviewed with usage verification"
    medium: "Key services reviewed"
    low: "Limited service visibility"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "contract-management"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires thorough terms review"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "trm-001"
    item: "Third-party services inventoried"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Complete inventory of services used"
    expected: "Confirmed by reviewer"

  - id: "trm-002"
    item: "Terms reviewed for major services"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Key restrictions identified"
    expected: "Confirmed by reviewer"

  - id: "trm-003"
    item: "No terms violations identified"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Usage complies with terms"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "Contract compliance"
      controls: ["Third-party agreements"]

relationships:
  commonly_combined:
    - "compliance-legal.legal-licensing.software-license-management"
    - "compliance-legal.data-protection.data-processing-agreement"
