# ============================================================
# AUDIT: Export Control Audit
# ============================================================
# Evaluates compliance with export control regulations including
# EAR, ITAR, and international trade controls.

audit:
  id: "compliance-legal.legal-licensing.export-control"

  name: "Export Control Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "compliance-legal"
  category_number: 19
  subcategory: "legal-licensing"

  tier: "phd"
  estimated_duration: "6-10 hours"  # median: 8h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "organizational"

  default_profiles:
    - "full"

  blocks_phase: true
  parallelizable: false

description:
  what: |
    Evaluates compliance with export control regulations including US
    Export Administration Regulations (EAR), International Traffic in
    Arms Regulations (ITAR), sanctions (OFAC), and foreign national
    access restrictions. Reviews product classification, license
    requirements, and compliance processes.

  why_it_matters: |
    Export control violations carry severe penalties including criminal
    prosecution, massive fines, debarment from government contracts, and
    loss of export privileges. Applies to technology transfers including
    software, encryption, and deemed exports to foreign nationals.
    Increasing enforcement against both intentional and negligent violations.

  when_to_run:
    - "Before releasing products internationally"
    - "When hiring foreign nationals for sensitive work"
    - "During development of encryption capabilities"
    - "Before engaging with foreign entities"
    - "As part of compliance programs"

prerequisites:
  required_artifacts:
    - type: "product_classification"
      description: "Export classification (ECCN) for products"
    - type: "export_policy"
      description: "Export compliance policy"
    - type: "customer_screening"
      description: "Denied party screening process"

  access_requirements:
    - "Product specifications"
    - "Export classification documentation"
    - "Customer/partner information"
    - "Foreign national employee data"
    - "Encryption specifications"

discovery:
  code_patterns:
    - pattern: "(encrypt|crypto|cipher|aes|rsa)"
      type: "regex"
      scope: "source"
      purpose: "Find encryption implementations"
    - pattern: "(export|itar|ear|eccn)"
      type: "regex"
      scope: "docs"
      purpose: "Locate export documentation"

  file_patterns:
    - glob: "**/crypto/**"
      purpose: "Find cryptography implementations"
    - glob: "**/docs/*export*"
      purpose: "Locate export documentation"

  documents_to_review:
    - type: "Export classification"
      purpose: "Verify ECCN determination"
    - type: "Encryption specifications"
      purpose: "Evaluate encryption controls"
    - type: "Customer screening records"
      purpose: "Verify denied party screening"

  interviews:
    - role: "Export compliance officer"
      questions:
        - "What is the export classification process?"
        - "How is screening conducted?"
        - "What training is provided?"
      purpose: "Understand compliance program"
    - role: "Engineering leadership"
      questions:
        - "What encryption is implemented?"
        - "Are foreign nationals on sensitive projects?"
        - "What technology transfer occurs?"
      purpose: "Identify controlled technology"

knowledge_sources:
  specifications:
    - id: "ear"
      name: "Export Administration Regulations (EAR)"
      url: "https://www.bis.doc.gov/index.php/regulations/export-administration-regulations-ear"
      offline_cache: true
      priority: "required"
    - id: "itar"
      name: "International Traffic in Arms Regulations (ITAR)"
      url: "https://www.pmddtc.state.gov/ddtc_public/ddtc_public?id=ddtc_kb_article_page&sys_id=24d528fddbfc930044f9ff621f961987"
      offline_cache: true
      priority: "required"
    - id: "ofac"
      name: "OFAC Sanctions Programs"
      url: "https://home.treasury.gov/policy-issues/office-of-foreign-assets-control-sanctions-programs-and-information"
      offline_cache: true
      priority: "required"

  guides:
    - id: "bis-encryption"
      name: "BIS Encryption Guidelines"
      url: "https://www.bis.doc.gov/index.php/policy-guidance/encryption"
      offline_cache: true

tooling:
  assessment_tools:
    - tool: "Export classification worksheet"
      purpose: "ECCN determination"
    - tool: "Denied party screening"
      purpose: "Screen customers and partners"

signals:
  critical:
    - id: "EXP-CRIT-001"
      signal: "Exports to denied parties or embargoed countries"
      evidence_indicators:
        - "Sales to sanctioned entities"
        - "Technology transfer to embargoed destinations"
        - "No denied party screening"
      explanation: |
        Exports to denied parties or embargoed countries are criminal
        violations with severe penalties including imprisonment and
        massive fines. Companies have faced hundred-million-dollar
        settlements.
      remediation: "Implement denied party screening and cease prohibited exports"

    - id: "EXP-CRIT-002"
      signal: "Uncontrolled encryption technology export"
      evidence_indicators:
        - "Strong encryption exported without review"
        - "No encryption classification"
        - "Missing encryption registration"
      explanation: |
        Encryption is controlled under Category 5 Part 2 of the Commerce
        Control List. While many mass-market exceptions exist, controlled
        encryption requires license or classification for export.
      remediation: "Classify encryption and obtain necessary authorizations"

    - id: "EXP-CRIT-003"
      signal: "Deemed exports to unauthorized foreign nationals"
      evidence_indicators:
        - "Foreign nationals accessing controlled technology"
        - "No technology control plan"
        - "Unauthorized technology disclosure"
      explanation: |
        Release of controlled technology to foreign nationals in the US
        is a "deemed export" requiring same controls as physical export.
        Includes employment and collaboration scenarios.
      remediation: "Implement technology access controls for foreign nationals"

  high:
    - id: "EXP-HIGH-001"
      signal: "Products not export classified"
      explanation: "Cannot determine compliance without classification"
      remediation: "Complete ECCN classification for all products"

    - id: "EXP-HIGH-002"
      signal: "No export compliance program"
      explanation: "Systematic violations likely without program"
      remediation: "Implement formal export compliance program"

  medium:
    - id: "EXP-MED-001"
      signal: "Export training not conducted"
      remediation: "Implement export compliance training"

    - id: "EXP-MED-002"
      signal: "License exceptions not documented"
      remediation: "Document applicable license exceptions"

  low:
    - id: "EXP-LOW-001"
      signal: "Export records not centralized"
      remediation: "Centralize export compliance records"

  positive:
    - id: "EXP-POS-001"
      signal: "Comprehensive export compliance program"
    - id: "EXP-POS-002"
      signal: "Automated denied party screening"
    - id: "EXP-POS-003"
      signal: "Regular compliance training"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Identify controlled items"
      description: |
        Identify all products, technologies, and software that may
        be subject to export controls.
      duration_estimate: "60 min"
      questions:
        - "What products are exported?"
        - "What technology is transferred?"
        - "What encryption is implemented?"
      expected_findings:
        - "Controlled item inventory"
        - "Technology identification"

    - id: "2"
      name: "Verify export classification"
      description: |
        Review export classification (ECCN) for all controlled items
        and verify classification accuracy.
      duration_estimate: "90 min"
      commands:
        - purpose: "Find encryption implementations"
          command: "grep -r -E '(encrypt|aes|rsa|crypto)' --include='*.py' --include='*.ts' --include='*.java' . | head -30"
      expected_findings:
        - "Classification status"
        - "ECCN determination"

    - id: "3"
      name: "Assess screening processes"
      description: |
        Evaluate denied party and sanctions screening for customers,
        partners, and end-users.
      duration_estimate: "60 min"
      expected_findings:
        - "Screening process assessment"
        - "Coverage verification"

    - id: "4"
      name: "Review deemed exports"
      description: |
        Assess foreign national access to controlled technology
        and technology control measures.
      duration_estimate: "60 min"
      expected_findings:
        - "Deemed export assessment"
        - "Technology access controls"

    - id: "5"
      name: "Evaluate compliance program"
      description: |
        Review overall export compliance program including training,
        documentation, and monitoring.
      duration_estimate: "45 min"
      expected_findings:
        - "Program assessment"
        - "Process gaps"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "export_assessment"
      format: "structured"
      sections:
        - "Controlled Item Inventory"
        - "Classification Review"
        - "Screening Assessment"
        - "Deemed Export Analysis"
        - "Program Evaluation"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Compliance Status"
        - "Recommendations"

  confidence_guidance:
    high: "Full documentation reviewed with legal confirmation"
    medium: "Key products and processes reviewed"
    low: "Limited documentation access"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "ear"
        priority: "required"
      - source_id: "bis-encryption"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires thorough export control review"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "exp-001"
    item: "Products export classified"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "ECCN determined for all products"
    expected: "Confirmed by reviewer"

  - id: "exp-002"
    item: "Denied party screening operational"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "All customers/partners screened"
    expected: "Confirmed by reviewer"

  - id: "exp-003"
    item: "No prohibited exports identified"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "All exports properly authorized"
    expected: "Confirmed by reviewer"

  - id: "exp-004"
    item: "Deemed export controls in place"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Foreign national access controlled"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["international", "defense-adjacent", "encryption"]

  compliance_frameworks:
    - framework: "EAR"
      controls: ["15 CFR Parts 730-774"]
    - framework: "ITAR"
      controls: ["22 CFR Parts 120-130"]
    - framework: "OFAC"
      controls: ["Sanctions programs"]

relationships:
  commonly_combined:
    - "compliance-legal.data-protection.cross-border-data-transfer"
    - "compliance-legal.legal-licensing.terms-compliance"
