# ============================================================
# AUDIT: FedRAMP Compliance Audit
# ============================================================
# Evaluates compliance with Federal Risk and Authorization Management
# Program for cloud service providers serving federal agencies.

audit:
  id: "compliance-legal.industry-standards.fedramp-compliance"

  name: "FedRAMP Compliance Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "compliance-legal"
  category_number: 19
  subcategory: "industry-standards"

  tier: "phd"
  estimated_duration: "16-24 hours"  # median: 20h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "organizational"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: true
  parallelizable: false

description:
  what: |
    Comprehensive evaluation of FedRAMP compliance for cloud service providers
    seeking authorization to serve federal agencies. Reviews compliance with
    NIST SP 800-53 controls at Low, Moderate, or High impact levels. Assesses
    System Security Plan (SSP), Security Assessment Plan (SAP), continuous
    monitoring, and Plan of Action and Milestones (POA&M).

  why_it_matters: |
    FedRAMP authorization is required for cloud services used by federal
    agencies. Authorization opens significant government market opportunity
    estimated at $40+ billion annually. Without authorization, cloud providers
    cannot sell to federal customers. FedRAMP demonstrates rigorous security
    practices exceeding commercial standards.

  when_to_run:
    - "Before initiating FedRAMP authorization"
    - "During FedRAMP readiness assessment"
    - "As part of continuous monitoring"
    - "After significant system changes"
    - "During annual assessment preparation"

prerequisites:
  required_artifacts:
    - type: "ssp"
      description: "System Security Plan"
    - type: "boundary_diagram"
      description: "Authorization boundary documentation"
    - type: "control_matrix"
      description: "NIST 800-53 control implementation"

  access_requirements:
    - "System Security Plan documentation"
    - "Authorization boundary diagrams"
    - "Control implementation evidence"
    - "Continuous monitoring data"
    - "POA&M tracking"
    - "3PAO assessment reports"

discovery:
  code_patterns:
    - pattern: "(fedramp|nist|fips|gov.?cloud)"
      type: "regex"
      scope: "source"
      purpose: "Find FedRAMP-specific implementations"
    - pattern: "(fips.?140|encryption|mfa|piv)"
      type: "regex"
      scope: "source"
      purpose: "Locate security controls"

  file_patterns:
    - glob: "**/fedramp/**"
      purpose: "Find FedRAMP documentation"
    - glob: "**/ssp/**"
      purpose: "Locate SSP components"
    - glob: "**/controls/**"
      purpose: "Find control documentation"

  documents_to_review:
    - type: "System Security Plan"
      purpose: "Evaluate SSP completeness"
    - type: "Control implementation statements"
      purpose: "Assess control coverage"
    - type: "Continuous monitoring plan"
      purpose: "Review ConMon implementation"

  interviews:
    - role: "ISSO/Security"
      questions:
        - "What is the authorization boundary?"
        - "How are controls implemented and documented?"
        - "What is the continuous monitoring strategy?"
      purpose: "Understand security implementation"
    - role: "Engineering"
      questions:
        - "How is FIPS 140-2/3 encryption implemented?"
        - "What MFA solutions are deployed?"
        - "How is configuration management enforced?"
      purpose: "Assess technical controls"

knowledge_sources:
  specifications:
    - id: "fedramp-requirements"
      name: "FedRAMP Security Assessment Framework"
      url: "https://www.fedramp.gov/documents/"
      offline_cache: true
      priority: "required"
    - id: "nist-800-53"
      name: "NIST SP 800-53 Rev 5 Security Controls"
      url: "https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final"
      offline_cache: true
      priority: "required"
    - id: "fedramp-baselines"
      name: "FedRAMP Security Control Baselines"
      url: "https://www.fedramp.gov/baselines/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "fedramp-templates"
      name: "FedRAMP Templates and Documents"
      url: "https://www.fedramp.gov/templates/"
      offline_cache: true
    - id: "fedramp-conmon"
      name: "FedRAMP Continuous Monitoring Strategy"
      url: "https://www.fedramp.gov/conmon/"
      offline_cache: true

tooling:
  assessment_tools:
    - tool: "FedRAMP SSP template"
      purpose: "Document system security plan"
    - tool: "OSCAL tooling"
      purpose: "Machine-readable control documentation"

  scripts:
    - id: "fedramp-control-check"
      language: "bash"
      purpose: "Find FedRAMP control implementations"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== FIPS Encryption ==="
        grep -r -E "(fips|encryption|crypto)" \
          --include="*.yaml" --include="*.json" --include="*.tf" . 2>/dev/null

        echo "=== MFA/PIV ==="
        grep -r -E "(mfa|multi.?factor|piv|cac)" \
          --include="*.py" --include="*.ts" --include="*.yaml" . 2>/dev/null

signals:
  critical:
    - id: "FED-CRIT-001"
      signal: "Non-FIPS validated cryptography in use"
      evidence_indicators:
        - "Non-validated cryptographic modules"
        - "FIPS mode not enabled"
        - "Weak algorithms (DES, MD5)"
      explanation: |
        FedRAMP requires FIPS 140-2/3 validated cryptographic modules.
        Non-validated cryptography fails baseline control SC-13 and
        will not pass 3PAO assessment.
      remediation: "Implement FIPS 140-2/3 validated cryptographic modules"

    - id: "FED-CRIT-002"
      signal: "No System Security Plan"
      evidence_indicators:
        - "SSP does not exist"
        - "SSP significantly incomplete"
        - "Control implementations not documented"
      explanation: |
        SSP is cornerstone FedRAMP artifact. Without complete SSP,
        authorization cannot proceed. 3PAO cannot assess undocumented
        system.
      remediation: "Develop comprehensive SSP using FedRAMP template"

    - id: "FED-CRIT-003"
      signal: "Authorization boundary undefined"
      evidence_indicators:
        - "System boundaries not documented"
        - "Data flows not mapped"
        - "External connections not identified"
      explanation: |
        Authorization boundary defines scope of assessment. Undefined
        boundary prevents accurate risk assessment and control scoping.
      remediation: "Define and document authorization boundary clearly"

  high:
    - id: "FED-HIGH-001"
      signal: "MFA not implemented for all users"
      explanation: "IA-2 requires multi-factor authentication"
      remediation: "Implement MFA for all user authentication"

    - id: "FED-HIGH-002"
      signal: "No continuous monitoring program"
      explanation: "FedRAMP requires ongoing ConMon per NIST 800-137"
      remediation: "Implement continuous monitoring with monthly reporting"

    - id: "FED-HIGH-003"
      signal: "Vulnerability scanning not meeting frequency"
      explanation: "RA-5 requires monthly OS and weekly web app scanning"
      remediation: "Implement vulnerability scanning per FedRAMP requirements"

  medium:
    - id: "FED-MED-001"
      signal: "POA&M items overdue"
      remediation: "Address overdue POA&M items per remediation timelines"

    - id: "FED-MED-002"
      signal: "Configuration baseline not documented"
      remediation: "Document and enforce security configuration baselines"

    - id: "FED-MED-003"
      signal: "Incident response not tested"
      remediation: "Conduct annual incident response testing"

  low:
    - id: "FED-LOW-001"
      signal: "SSP not in OSCAL format"
      remediation: "Convert SSP to OSCAL for automation benefits"

  positive:
    - id: "FED-POS-001"
      signal: "Comprehensive SSP with all controls addressed"
    - id: "FED-POS-002"
      signal: "Automated continuous monitoring"
    - id: "FED-POS-003"
      signal: "FIPS 140-3 validated encryption throughout"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Determine impact level and baseline"
      description: |
        Identify appropriate FedRAMP impact level (Low, Moderate, High)
        based on federal information types processed.
      duration_estimate: "60 min"
      questions:
        - "What federal information types are processed?"
        - "What is the appropriate impact level?"
        - "Which baseline applies?"
      expected_findings:
        - "Impact level determination"
        - "Baseline identification"

    - id: "2"
      name: "Review System Security Plan"
      description: |
        Evaluate SSP completeness including system description,
        authorization boundary, and control implementations.
      duration_estimate: "180 min"
      expected_findings:
        - "SSP completeness assessment"
        - "Documentation gaps"

    - id: "3"
      name: "Assess control implementation"
      description: |
        Evaluate implementation of baseline controls across all
        control families.
      duration_estimate: "240 min"
      commands:
        - purpose: "Find security control implementations"
          command: "grep -r -E '(fips|mfa|encrypt|audit|access.?control)' --include='*.py' --include='*.ts' --include='*.yaml' ."
      expected_findings:
        - "Control implementation status"
        - "Control gaps"

    - id: "4"
      name: "Review continuous monitoring"
      description: |
        Evaluate ConMon program including vulnerability management,
        POA&M tracking, and monthly reporting.
      duration_estimate: "90 min"
      expected_findings:
        - "ConMon program status"
        - "Reporting compliance"

    - id: "5"
      name: "Evaluate authorization readiness"
      description: |
        Assess overall readiness for FedRAMP authorization process
        and identify remaining gaps.
      duration_estimate: "60 min"
      expected_findings:
        - "Authorization readiness"
        - "Remediation priorities"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "fedramp_assessment"
      format: "structured"
      sections:
        - "Impact Level Determination"
        - "SSP Review"
        - "Control Assessment by Family"
        - "Continuous Monitoring"
        - "Authorization Readiness"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Authorization Readiness Status"
        - "Gap Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Full SSP and control evidence reviewed"
    medium: "Key documentation reviewed, some gaps"
    low: "Limited documentation access"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "fedramp-requirements"
        priority: "required"
      - source_id: "nist-800-53"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires extensive control evaluation"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "fed-001"
    item: "System Security Plan complete"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "SSP addresses all baseline controls"
    expected: "Confirmed by reviewer"

  - id: "fed-002"
    item: "Authorization boundary defined"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Boundary diagram and description documented"
    expected: "Confirmed by reviewer"

  - id: "fed-003"
    item: "FIPS 140-2/3 cryptography implemented"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Validated modules in FIPS mode"
    expected: "Confirmed by reviewer"

  - id: "fed-004"
    item: "Continuous monitoring operational"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "ConMon meeting FedRAMP requirements"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["gov-cloud", "federal-contractor", "cloud-services"]

  compliance_frameworks:
    - framework: "FedRAMP"
      controls: ["All baselines"]
    - framework: "NIST SP 800-53"
      controls: ["Rev 5 controls"]
    - framework: "FISMA"
      controls: ["Federal requirements"]

relationships:
  commonly_combined:
    - "compliance-legal.industry-standards.nist-framework"
    - "compliance-legal.industry-standards.soc2-compliance"
    - "compliance-legal.audit-trail.audit-log-completeness"
