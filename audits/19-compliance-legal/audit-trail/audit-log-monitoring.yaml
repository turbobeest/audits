# ============================================================
# AUDIT: Audit Log Monitoring Audit
# ============================================================
# Evaluates monitoring, alerting, and analysis of audit logs
# for security events and compliance.

audit:
  id: "compliance-legal.audit-trail.audit-log-monitoring"

  name: "Audit Log Monitoring Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "compliance-legal"
  category_number: 19
  subcategory: "audit-trail"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "codebase"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates monitoring and analysis of audit logs for security events
    including SIEM integration, alerting rules, anomaly detection, review
    procedures, and incident correlation. Reviews coverage of security-relevant
    events and timeliness of detection and response.

  why_it_matters: |
    Logs are only valuable if monitored. Unmonitored logs provide historical
    record but no real-time protection. Compliance frameworks require log
    review and monitoring. Security monitoring enables detection of threats
    before they cause damage. Without monitoring, attacks succeed undetected.

  when_to_run:
    - "During security operations reviews"
    - "After implementing SIEM or logging changes"
    - "As part of compliance audits"
    - "Following security incidents"
    - "When evaluating detection capabilities"

prerequisites:
  required_artifacts:
    - type: "monitoring_config"
      description: "SIEM and alerting configurations"
    - type: "alert_rules"
      description: "Security alert rules and thresholds"
    - type: "review_procedures"
      description: "Log review procedures"

  access_requirements:
    - "SIEM or log management system"
    - "Alert configurations"
    - "Monitoring dashboards"
    - "Incident response procedures"

discovery:
  code_patterns:
    - pattern: "(siem|splunk|elastic|sentinel|chronicle)"
      type: "regex"
      scope: "config"
      purpose: "Find SIEM configurations"
    - pattern: "(alert|threshold|detect|monitor)"
      type: "regex"
      scope: "source"
      purpose: "Locate monitoring rules"

  file_patterns:
    - glob: "**/alerts/**"
      purpose: "Find alert configurations"
    - glob: "**/monitoring/**"
      purpose: "Locate monitoring setups"
    - glob: "**/siem/**"
      purpose: "Find SIEM configurations"

  documents_to_review:
    - type: "Alert rule documentation"
      purpose: "Evaluate detection coverage"
    - type: "Review procedures"
      purpose: "Assess manual review process"

knowledge_sources:
  specifications:
    - id: "nist-au-6"
      name: "NIST SP 800-53 AU-6 Audit Review, Analysis, and Reporting"
      url: "https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final"
      offline_cache: true
      priority: "required"

  guides:
    - id: "mitre-attack"
      name: "MITRE ATT&CK Detection"
      url: "https://attack.mitre.org/"
      offline_cache: true
    - id: "sigma-rules"
      name: "Sigma Detection Rules"
      url: "https://github.com/SigmaHQ/sigma"
      offline_cache: true

tooling:
  assessment_tools:
    - tool: "Detection coverage matrix"
      purpose: "Map detection against threats"

  scripts:
    - id: "monitoring-check"
      language: "bash"
      purpose: "Review monitoring configurations"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Alert Configurations ==="
        find . -name "*.yaml" -exec grep -l -E "(alert|rule|trigger)" {} \; 2>/dev/null | head -20

        echo "=== Monitoring Integrations ==="
        grep -r -E "(siem|splunk|elastic|datadog|pagerduty)" \
          --include="*.yaml" --include="*.json" . 2>/dev/null | head -20

signals:
  critical:
    - id: "LOGM-CRIT-001"
      signal: "No security log monitoring"
      evidence_indicators:
        - "No SIEM or log analysis"
        - "Logs collected but not monitored"
        - "No security alerting"
      explanation: |
        Unmonitored logs provide no real-time protection. Attacks succeed
        and persist undetected. Compliance frameworks require active log
        monitoring for security events.
      remediation: "Implement security log monitoring with SIEM"

    - id: "LOGM-CRIT-002"
      signal: "Critical events not alerting"
      evidence_indicators:
        - "Authentication failures not alerted"
        - "Privilege escalation not detected"
        - "Data access anomalies not flagged"
      explanation: |
        Critical security events require immediate alerting. Without
        alerting, security team cannot respond to attacks in progress.
      remediation: "Implement alerts for critical security events"

    - id: "LOGM-CRIT-003"
      signal: "Alerts not routed to response team"
      evidence_indicators:
        - "Alerts generated but not delivered"
        - "No on-call integration"
        - "Alerts go to unmonitored channel"
      explanation: |
        Alerts that don't reach responders are useless. Must have
        reliable delivery to security team with escalation.
      remediation: "Configure alert routing to security operations"

  high:
    - id: "LOGM-HIGH-001"
      signal: "Alert fatigue from excessive alerts"
      explanation: "Too many alerts causes important ones to be missed"
      remediation: "Tune alerts to reduce false positives"

    - id: "LOGM-HIGH-002"
      signal: "No correlation of related events"
      explanation: "Cannot detect multi-stage attacks without correlation"
      remediation: "Implement event correlation rules"

    - id: "LOGM-HIGH-003"
      signal: "No baseline for anomaly detection"
      explanation: "Cannot detect unusual activity without normal baseline"
      remediation: "Establish baselines and anomaly detection"

  medium:
    - id: "LOGM-MED-001"
      signal: "Log review not conducted regularly"
      remediation: "Implement scheduled log review procedures"

    - id: "LOGM-MED-002"
      signal: "Detection rules not updated"
      remediation: "Regularly update detection rules for new threats"

  low:
    - id: "LOGM-LOW-001"
      signal: "No threat hunting program"
      remediation: "Implement proactive threat hunting using logs"

  positive:
    - id: "LOGM-POS-001"
      signal: "Comprehensive SIEM with tuned alerting"
    - id: "LOGM-POS-002"
      signal: "MITRE ATT&CK mapped detection coverage"
    - id: "LOGM-POS-003"
      signal: "Automated response to critical events"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review monitoring architecture"
      description: |
        Evaluate log monitoring infrastructure including SIEM,
        log aggregation, and analysis capabilities.
      duration_estimate: "60 min"
      questions:
        - "What monitoring tools are deployed?"
        - "What logs are monitored?"
        - "How are events correlated?"
      expected_findings:
        - "Architecture assessment"
        - "Coverage mapping"

    - id: "2"
      name: "Assess alert coverage"
      description: |
        Evaluate security alerting rules and coverage of
        critical events.
      duration_estimate: "60 min"
      commands:
        - purpose: "Find alert rules"
          command: "grep -r -E '(alert|rule|threshold)' --include='*.yaml' --include='*.json' ."
      expected_findings:
        - "Alert coverage assessment"
        - "Gap identification"

    - id: "3"
      name: "Evaluate alert quality"
      description: |
        Assess alert quality including false positive rate,
        tuning, and actionability.
      duration_estimate: "45 min"
      questions:
        - "What is the false positive rate?"
        - "Are alerts actionable?"
        - "How are alerts prioritized?"
      expected_findings:
        - "Alert quality assessment"
        - "Tuning recommendations"

    - id: "4"
      name: "Review alert routing"
      description: |
        Evaluate alert delivery and escalation to security
        operations team.
      duration_estimate: "30 min"
      expected_findings:
        - "Routing assessment"
        - "Escalation verification"

    - id: "5"
      name: "Assess review procedures"
      description: |
        Evaluate manual log review procedures and frequency.
      duration_estimate: "30 min"
      expected_findings:
        - "Review procedure assessment"
        - "Documentation status"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "monitoring_assessment"
      format: "structured"
      sections:
        - "Architecture Review"
        - "Alert Coverage"
        - "Alert Quality"
        - "Alert Routing"
        - "Review Procedures"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Detection Coverage"
        - "Recommendations"

  confidence_guidance:
    high: "Full SIEM access with alert testing"
    medium: "Configuration reviewed with limited testing"
    low: "Limited access to monitoring systems"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "nist-au-6"
        priority: "required"
      - source_id: "mitre-attack"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires thorough monitoring assessment"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "logm-001"
    item: "Security log monitoring operational"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "SIEM or equivalent monitoring logs"
    expected: "Confirmed by reviewer"

  - id: "logm-002"
    item: "Critical event alerting configured"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Auth failures, privilege escalation alerted"
    expected: "Confirmed by reviewer"

  - id: "logm-003"
    item: "Alerts routed to security team"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Alerts delivered with escalation"
    expected: "Confirmed by reviewer"

  - id: "logm-004"
    item: "Alert tuning conducted"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "False positives managed, alerts actionable"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "SOC 2"
      controls: ["CC7.2", "CC7.3"]
    - framework: "PCI-DSS"
      controls: ["Requirement 10.6"]
    - framework: "HIPAA"
      controls: ["164.308(a)(1)(ii)(D)"]
    - framework: "NIST SP 800-53"
      controls: ["AU-6", "SI-4"]

relationships:
  commonly_combined:
    - "compliance-legal.audit-trail.audit-log-completeness"
    - "compliance-legal.audit-trail.audit-log-integrity"
    - "compliance-legal.data-protection.data-breach-notification"
