# ============================================================
# AUDIT: Data Breach Notification Audit
# ============================================================
# Evaluates data breach detection, assessment, and notification
# procedures across regulatory requirements.

audit:
  id: "compliance-legal.data-protection.data-breach-notification"

  name: "Data Breach Notification Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "compliance-legal"
  category_number: 19
  subcategory: "data-protection"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "process"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates organizational capability to detect, assess, contain, and
    report data breaches within regulatory timeframes. Reviews incident
    response procedures, breach assessment criteria, notification templates,
    communication channels, and documentation practices. Covers GDPR 72-hour,
    CCPA, state breach notification laws, and sector-specific requirements.

  why_it_matters: |
    Data breach notification is a regulatory requirement under GDPR (72 hours),
    CCPA, HIPAA (60 days), and numerous state laws. Failure to notify timely
    results in significant penalties, regulatory scrutiny, and reputational
    damage. Effective breach response minimizes harm to affected individuals
    and demonstrates organizational accountability.

  when_to_run:
    - "During incident response capability assessments"
    - "After security incidents or near-misses"
    - "As part of annual compliance reviews"
    - "When expanding into new jurisdictions"
    - "After regulatory changes to notification requirements"

prerequisites:
  required_artifacts:
    - type: "incident_response_plan"
      description: "Documented incident response procedures"
    - type: "breach_notification_templates"
      description: "Pre-approved notification templates"
    - type: "contact_registry"
      description: "Regulatory and stakeholder contact information"

  access_requirements:
    - "Incident response documentation"
    - "Security monitoring systems"
    - "Communication templates and procedures"
    - "Legal and compliance team"
    - "IT security team"

discovery:
  code_patterns:
    - pattern: "(breach|incident|alert|notification)"
      type: "regex"
      scope: "source"
      purpose: "Find breach detection code"
    - pattern: "(notify|alert|escalate)"
      type: "regex"
      scope: "source"
      purpose: "Locate notification mechanisms"

  file_patterns:
    - glob: "**/incident/**"
      purpose: "Find incident response modules"
    - glob: "**/security/alerts/**"
      purpose: "Locate alert handling code"
    - glob: "**/docs/*breach*"
      purpose: "Find breach documentation"

  documents_to_review:
    - type: "Incident Response Plan"
      purpose: "Evaluate breach procedures"
    - type: "Breach notification templates"
      purpose: "Assess notification readiness"
    - type: "Escalation matrices"
      purpose: "Review communication chains"

  interviews:
    - role: "Security Operations"
      questions:
        - "How are potential breaches detected?"
        - "What is the escalation process?"
        - "How quickly can breach scope be determined?"
      purpose: "Understand detection and assessment capability"
    - role: "Legal/Compliance"
      questions:
        - "What notification requirements apply?"
        - "Who has authority to determine notification need?"
        - "Are notification templates pre-approved?"
      purpose: "Understand legal readiness"

knowledge_sources:
  specifications:
    - id: "gdpr-art33-34"
      name: "GDPR Articles 33-34 Breach Notification"
      url: "https://gdpr-info.eu/art-33-gdpr/"
      offline_cache: true
      priority: "required"
    - id: "ccpa-breach"
      name: "CCPA Data Breach Provisions"
      url: "https://leginfo.legislature.ca.gov/faces/codes_displaySection.xhtml?lawCode=CIV&sectionNum=1798.150"
      offline_cache: true
      priority: "required"

  guides:
    - id: "edpb-breach"
      name: "EDPB Guidelines on Breach Notification"
      url: "https://edpb.europa.eu/our-work-tools/our-documents/guidelines/guidelines-92022-personal-data-breach-notification_en"
      offline_cache: true
    - id: "nist-ir"
      name: "NIST Computer Security Incident Handling Guide"
      url: "https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final"
      offline_cache: true

tooling:
  assessment_tools:
    - tool: "Breach notification checklist"
      purpose: "Structured evaluation of notification capability"
    - tool: "Tabletop exercise framework"
      purpose: "Test breach response procedures"

  scripts:
    - id: "breach-detection-check"
      language: "bash"
      purpose: "Find breach detection implementations"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Security Alert Patterns ==="
        grep -r -E "(security.?alert|breach.?detect|incident.?trigger)" \
          --include="*.py" --include="*.ts" --include="*.java" . 2>/dev/null

        echo "=== Notification Handlers ==="
        grep -r -E "(notify|escalate|alert)" \
          --include="*.py" --include="*.ts" . 2>/dev/null

signals:
  critical:
    - id: "BREACH-CRIT-001"
      signal: "No documented breach response procedure"
      evidence_indicators:
        - "No incident response plan exists"
        - "Breach procedures not documented"
        - "Roles and responsibilities unclear"
      explanation: |
        Without documented procedures, organizations cannot respond within
        required timeframes. GDPR requires 72-hour notification; this is
        impossible without pre-established processes.
      remediation: "Develop and document comprehensive breach response procedures"

    - id: "BREACH-CRIT-002"
      signal: "Cannot detect breaches in timely manner"
      evidence_indicators:
        - "No security monitoring"
        - "No anomaly detection"
        - "Long mean time to detect"
      explanation: |
        Detection is prerequisite to notification. Organizations cannot notify
        if they don't know a breach occurred. Delayed detection extends harm
        and violates "without undue delay" requirements.
      remediation: "Implement comprehensive security monitoring and detection"

    - id: "BREACH-CRIT-003"
      signal: "No mechanism to notify regulators within timeframes"
      evidence_indicators:
        - "No regulator contact information"
        - "No pre-approved notification templates"
        - "No clear authority to notify"
      explanation: |
        GDPR requires notification within 72 hours. Without pre-established
        channels and templates, meeting this deadline is unlikely. Delay
        constitutes separate violation.
      remediation: "Establish notification mechanisms, templates, and authorities"

  high:
    - id: "BREACH-HIGH-001"
      signal: "Breach assessment criteria not defined"
      explanation: "Need clear criteria to determine if notification required"
      remediation: "Define breach severity thresholds and notification triggers"

    - id: "BREACH-HIGH-002"
      signal: "No process to notify affected individuals"
      explanation: "GDPR Article 34 and state laws require individual notification"
      remediation: "Develop individual notification procedures and templates"

    - id: "BREACH-HIGH-003"
      signal: "Breach response not tested"
      explanation: "Untested procedures likely to fail under pressure"
      remediation: "Conduct regular tabletop exercises and simulations"

  medium:
    - id: "BREACH-MED-001"
      signal: "Breach documentation requirements unclear"
      remediation: "Define breach documentation standards and templates"

    - id: "BREACH-MED-002"
      signal: "No post-breach review process"
      remediation: "Implement lessons learned process after incidents"

  low:
    - id: "BREACH-LOW-001"
      signal: "Breach metrics not tracked"
      remediation: "Track mean time to detect, assess, and notify"

  positive:
    - id: "BREACH-POS-001"
      signal: "Breach response procedures tested regularly"
    - id: "BREACH-POS-002"
      signal: "Automated breach detection and alerting"
    - id: "BREACH-POS-003"
      signal: "Pre-approved notification templates ready"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review incident response plan"
      description: |
        Evaluate documented breach response procedures including detection,
        containment, assessment, notification, and recovery phases.
      duration_estimate: "60 min"
      questions:
        - "Does a documented IRP exist?"
        - "Are breach-specific procedures included?"
        - "Are roles and responsibilities defined?"
        - "Is escalation path clear?"
      expected_findings:
        - "IRP completeness assessment"
        - "Procedure gaps identified"

    - id: "2"
      name: "Assess detection capability"
      description: |
        Evaluate ability to detect breaches through monitoring,
        alerting, and anomaly detection systems.
      duration_estimate: "45 min"
      commands:
        - purpose: "Find monitoring implementations"
          command: "grep -r -E '(monitor|detect|alert|anomaly)' --include='*.py' --include='*.ts' --include='*.yaml' ."
      expected_findings:
        - "Detection capability status"
        - "Monitoring gaps"

    - id: "3"
      name: "Evaluate notification readiness"
      description: |
        Review notification templates, contact lists, and approval
        processes for regulatory and individual notifications.
      duration_estimate: "45 min"
      questions:
        - "Are notification templates pre-approved?"
        - "Is regulator contact information current?"
        - "Who has authority to approve notifications?"
      expected_findings:
        - "Notification readiness status"
        - "Template and contact gaps"

    - id: "4"
      name: "Test response procedures"
      description: |
        Conduct or review results of tabletop exercises testing
        breach response procedures against timeframes.
      duration_estimate: "60 min"
      expected_findings:
        - "Procedure effectiveness"
        - "Timeline adherence capability"

    - id: "5"
      name: "Review multi-jurisdictional requirements"
      description: |
        Map applicable breach notification requirements across
        jurisdictions and assess capability to meet each.
      duration_estimate: "45 min"
      expected_findings:
        - "Jurisdictional requirement mapping"
        - "Compliance gaps by jurisdiction"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "breach_readiness_assessment"
      format: "structured"
      sections:
        - "Detection Capability"
        - "Response Procedures"
        - "Notification Readiness"
        - "Jurisdictional Coverage"
        - "Testing Status"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Readiness Status"
        - "Recommendations"

  confidence_guidance:
    high: "Procedures reviewed, tabletop exercise conducted"
    medium: "Documentation reviewed, limited testing"
    low: "Partial documentation access"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "gdpr-art33-34"
        priority: "required"
      - source_id: "nist-ir"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires thorough procedure review"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "breach-001"
    item: "Breach response procedures documented"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Complete IRP with breach-specific procedures"
    expected: "Confirmed by reviewer"

  - id: "breach-002"
    item: "Breach detection capability verified"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Monitoring and alerting systems operational"
    expected: "Confirmed by reviewer"

  - id: "breach-003"
    item: "72-hour notification capability confirmed"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Templates, contacts, and approvals in place"
    expected: "Confirmed by reviewer"

  - id: "breach-004"
    item: "Breach response procedures tested"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Tabletop exercise conducted within 12 months"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "GDPR"
      controls: ["Article 33", "Article 34"]
    - framework: "CCPA"
      controls: ["Section 1798.150"]
    - framework: "HIPAA"
      controls: ["Breach Notification Rule"]
    - framework: "SOC 2"
      controls: ["CC7.4", "CC7.5"]

relationships:
  commonly_combined:
    - "compliance-legal.data-protection.gdpr-compliance"
    - "compliance-legal.audit-trail.audit-log-completeness"
    - "compliance-legal.audit-trail.audit-log-integrity"
