# ============================================================
# AUDIT: Data Processing Agreement Audit
# ============================================================
# Evaluates data processing agreements with vendors and partners
# for compliance with GDPR Article 28 and similar requirements.

audit:
  id: "compliance-legal.data-protection.data-processing-agreement"

  name: "Data Processing Agreement Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "compliance-legal"
  category_number: 19
  subcategory: "data-protection"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "documentation"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Evaluates data processing agreements (DPAs) with third-party processors
    for compliance with GDPR Article 28 mandatory clauses, CCPA service provider
    requirements, and industry best practices. Reviews subject matter, duration,
    nature and purpose of processing, data types, controller instructions,
    security measures, sub-processor management, and audit rights.

  why_it_matters: |
    Controllers remain responsible for processor compliance. Invalid or
    incomplete DPAs expose organizations to liability for processor failures.
    GDPR Article 28 mandates specific contractual elements; absence renders
    processing unlawful. DPA deficiencies are common audit findings and
    enforcement targets.

  when_to_run:
    - "When onboarding new vendors processing personal data"
    - "During annual vendor reviews"
    - "After regulatory updates to DPA requirements"
    - "When renewing vendor contracts"
    - "Following processor-related incidents"

prerequisites:
  required_artifacts:
    - type: "vendor_inventory"
      description: "List of vendors processing personal data"
    - type: "dpa_contracts"
      description: "Data processing agreements"
    - type: "security_assessments"
      description: "Vendor security assessments"

  access_requirements:
    - "Access to vendor contracts"
    - "Data processing agreements"
    - "Vendor security documentation"
    - "Sub-processor lists"
    - "Procurement/legal team"

discovery:
  file_patterns:
    - glob: "**/contracts/*dpa*"
      purpose: "Find DPA documents"
    - glob: "**/legal/*processing*"
      purpose: "Locate processing agreements"
    - glob: "**/vendor/**"
      purpose: "Find vendor documentation"

  documents_to_review:
    - type: "Data Processing Agreements"
      purpose: "Evaluate contractual compliance"
    - type: "Vendor security questionnaires"
      purpose: "Assess security representations"
    - type: "Sub-processor lists"
      purpose: "Evaluate sub-processor chain"

  interviews:
    - role: "Procurement/Legal"
      questions:
        - "What DPA template is used?"
        - "How are DPAs negotiated?"
        - "How is vendor compliance monitored?"
      purpose: "Understand DPA processes"
    - role: "Privacy/Compliance"
      questions:
        - "Are all processors under DPA?"
        - "How are sub-processor changes handled?"
        - "When were DPAs last reviewed?"
      purpose: "Assess DPA coverage and currency"

knowledge_sources:
  specifications:
    - id: "gdpr-art28"
      name: "GDPR Article 28 - Processor"
      url: "https://gdpr-info.eu/art-28-gdpr/"
      offline_cache: true
      priority: "required"
    - id: "gdpr-art32"
      name: "GDPR Article 32 - Security of Processing"
      url: "https://gdpr-info.eu/art-32-gdpr/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "edpb-controller-processor"
      name: "EDPB Guidelines on Controller and Processor"
      url: "https://edpb.europa.eu/our-work-tools/our-documents/guidelines/guidelines-072020-concepts-controller-and-processor-gdpr_en"
      offline_cache: true
    - id: "ico-contracts"
      name: "ICO Contracts and Liabilities Guidance"
      url: "https://ico.org.uk/for-organisations/uk-gdpr-guidance-and-resources/accountability-and-governance/contracts/"
      offline_cache: true

tooling:
  assessment_tools:
    - tool: "DPA compliance checklist"
      purpose: "Verify Article 28 mandatory clauses"
    - tool: "Vendor risk assessment template"
      purpose: "Evaluate processor risks"

signals:
  critical:
    - id: "DPA-CRIT-001"
      signal: "No DPA with processor handling personal data"
      evidence_indicators:
        - "Vendor processes personal data"
        - "No written agreement exists"
        - "Only standard service terms"
      explanation: |
        GDPR Article 28(3) requires processing to be governed by binding
        contract. Processing without DPA renders both controller and
        processor potentially liable for unlawful processing.
      remediation: "Execute compliant DPA before processing begins"

    - id: "DPA-CRIT-002"
      signal: "DPA missing mandatory Article 28 clauses"
      evidence_indicators:
        - "No documented instructions requirement"
        - "No security obligations"
        - "No audit rights"
      explanation: |
        Article 28(3) specifies mandatory clauses. Incomplete DPA fails
        to provide required protections and may not be enforceable as
        valid DPA.
      remediation: "Update DPA to include all mandatory clauses"

    - id: "DPA-CRIT-003"
      signal: "Sub-processors engaged without authorization"
      evidence_indicators:
        - "Sub-processors used without controller awareness"
        - "No sub-processor authorization clause"
        - "No notification of changes"
      explanation: |
        Article 28(2) requires prior authorization for sub-processors.
        Unauthorized sub-processing violates DPA and extends data to
        unvetted parties.
      remediation: "Implement sub-processor authorization and notification process"

  high:
    - id: "DPA-HIGH-001"
      signal: "No audit rights in DPA"
      explanation: "Article 28(3)(h) requires audit and inspection rights"
      remediation: "Add audit rights clause to DPA"

    - id: "DPA-HIGH-002"
      signal: "Security measures not specified"
      explanation: "DPA must specify technical and organizational measures"
      remediation: "Document specific security requirements in DPA"

    - id: "DPA-HIGH-003"
      signal: "No deletion/return obligations"
      explanation: "Article 28(3)(g) requires data deletion or return on termination"
      remediation: "Add data deletion/return clause to DPA"

  medium:
    - id: "DPA-MED-001"
      signal: "DPAs not regularly reviewed"
      remediation: "Establish annual DPA review process"

    - id: "DPA-MED-002"
      signal: "Sub-processor list not current"
      remediation: "Require and verify current sub-processor disclosures"

    - id: "DPA-MED-003"
      signal: "International transfer provisions missing"
      remediation: "Add transfer mechanism clauses where applicable"

  low:
    - id: "DPA-LOW-001"
      signal: "DPA registry not centralized"
      remediation: "Create centralized DPA tracking system"

  positive:
    - id: "DPA-POS-001"
      signal: "Comprehensive DPA template with all required clauses"
    - id: "DPA-POS-002"
      signal: "Regular vendor compliance verification"
    - id: "DPA-POS-003"
      signal: "Automated sub-processor change notifications"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory processors"
      description: |
        Identify all third parties processing personal data on behalf
        of the organization. Classify by data types and processing activities.
      duration_estimate: "45 min"
      questions:
        - "What vendors process personal data?"
        - "What data does each processor access?"
        - "What processing activities are performed?"
      expected_findings:
        - "Complete processor inventory"
        - "Processing activity mapping"

    - id: "2"
      name: "Verify DPA existence"
      description: |
        Confirm DPAs exist for all identified processors. Document
        any gaps where processing occurs without DPA.
      duration_estimate: "30 min"
      expected_findings:
        - "DPA coverage assessment"
        - "Gap identification"

    - id: "3"
      name: "Review DPA content"
      description: |
        Evaluate DPAs against Article 28(3) mandatory clauses and
        organizational requirements.
      duration_estimate: "90 min"
      questions:
        - "Does DPA specify subject matter and duration?"
        - "Are instructions and confidentiality requirements included?"
        - "Are security measures specified?"
        - "Are audit rights included?"
        - "Are sub-processor and termination provisions present?"
      expected_findings:
        - "Clause compliance status"
        - "Missing elements identified"

    - id: "4"
      name: "Assess sub-processor management"
      description: |
        Review sub-processor authorization, notification, and
        oversight provisions.
      duration_estimate: "45 min"
      expected_findings:
        - "Sub-processor management assessment"
        - "Notification process evaluation"

    - id: "5"
      name: "Evaluate security provisions"
      description: |
        Assess security measures specified in DPAs and verify
        alignment with actual processor practices.
      duration_estimate: "45 min"
      expected_findings:
        - "Security provision adequacy"
        - "Implementation verification"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "dpa_assessment"
      format: "structured"
      sections:
        - "Processor Inventory"
        - "DPA Coverage"
        - "Clause Analysis"
        - "Sub-Processor Review"
        - "Security Assessment"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Compliance Status"
        - "Recommendations"

  confidence_guidance:
    high: "All DPAs reviewed and verified"
    medium: "Key DPAs reviewed, some outstanding"
    low: "Partial DPA access"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "gdpr-art28"
        priority: "required"
      - source_id: "edpb-controller-processor"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires thorough contract review"
    full:
      included: true
      priority: 2

closeout_checklist:
  - id: "dpa-001"
    item: "All processors identified"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Complete processor inventory documented"
    expected: "Confirmed by reviewer"

  - id: "dpa-002"
    item: "DPAs exist for all processors"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Written DPA in place for each processor"
    expected: "Confirmed by reviewer"

  - id: "dpa-003"
    item: "DPAs contain all Article 28 mandatory clauses"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Checklist verification of required elements"
    expected: "Confirmed by reviewer"

  - id: "dpa-004"
    item: "Sub-processor authorization and notification in place"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Process for sub-processor management verified"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "GDPR"
      controls: ["Article 28", "Article 32"]
    - framework: "CCPA"
      controls: ["Service Provider requirements"]
    - framework: "UK GDPR"
      controls: ["Article 28"]

relationships:
  commonly_combined:
    - "compliance-legal.data-protection.gdpr-compliance"
    - "compliance-legal.data-protection.cross-border-data-transfer"
    - "compliance-legal.industry-standards.soc2-compliance"
