audit:
  id: compliance-legal.financial-reporting.segregation-of-duties
  name: Segregation of Duties Audit
  version: 1.0.0
  last_updated: '2026-01-19'
  status: active
  category: compliance-legal
  category_number: 19
  subcategory: financial-reporting
  tier: phd
  estimated_duration: 5-7 hours  # median: 6h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: process
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    Evaluates segregation of duties (SoD) controls including:
    - Incompatible duty identification and separation
    - Role-based access control alignment with SoD
    - Conflict detection in user access
    - Emergency and privileged access controls
    - Compensating controls for unavoidable conflicts
    - SoD violation monitoring and reporting
    - System-enforced vs. manually monitored controls
    - Cross-functional process segregation
  why_it_matters: |
    Segregation of duties is a fundamental internal control that
    prevents single individuals from controlling entire processes.
    SoD failures enable:
    - Fraud through undetected manipulation
    - Errors propagating without review
    - Asset misappropriation
    - Financial statement manipulation
    - SOX material weaknesses
    - Audit findings and qualifications
    - Regulatory sanctions
  when_to_run:
  - During annual SOX assessment
  - When implementing new systems
  - After organizational restructuring
  - During role and access reviews
prerequisites:
  required_artifacts:
  - type: sod_matrix
    description: Segregation of duties conflict matrix
  - type: role_definitions
    description: System role and permission definitions
  - type: user_access_list
    description: Current user access assignments
  access_requirements:
  - Identity management system
  - Role assignment data
  - Process documentation
  - Access review reports
discovery:
  code_patterns:
  - pattern: (role|permission|access|authorize)
    type: regex
    scope: source
    purpose: Identify access control implementations
  - pattern: (approv|review|sign.?off|verify)
    type: regex
    scope: source
    purpose: Find approval workflow code
  - pattern: (maker|checker|dual.?control)
    type: regex
    scope: source
    purpose: Locate dual control implementations
  file_patterns:
  - glob: '**/rbac/**'
    purpose: Role-based access control code
  - glob: '**/permissions/**'
    purpose: Permission management code
  - glob: '**/workflow/**'
    purpose: Approval workflow implementations
  documents_to_review:
  - type: SoD matrix
    purpose: Understand defined conflicts
  - type: Role definitions
    purpose: Review role-permission mapping
  - type: Process documentation
    purpose: Identify segregation points
  interviews:
  - role: Access Control Manager
    questions:
    - How is SoD defined and maintained?
    - How are SoD conflicts detected?
    - What compensating controls exist?
    purpose: Understand SoD control framework
  - role: Business Process Owners
    questions:
    - What are the key segregation points?
    - Who can approve their own work?
    - What override capabilities exist?
    purpose: Assess process segregation
knowledge_sources:
  specifications:
  - id: sox-sod
    name: SOX SoD Requirements
    url: https://www.sec.gov/
    offline_cache: true
    priority: required
  - id: coso-sod
    name: COSO Framework - Segregation of Duties
    url: https://www.coso.org/
    offline_cache: true
    priority: required
  guides:
  - id: isaca-sod
    name: ISACA SoD Best Practices
    url: https://www.isaca.org/
    offline_cache: true
tooling:
  assessment_tools:
  - tool: SoD Conflict Matrix Template
    purpose: Document and analyze conflicts
  - tool: Role Conflict Analysis Tool
    purpose: Detect conflicting role assignments
  scripts:
  - id: find-approval-flows
    language: bash
    purpose: Locate approval workflow implementations
    source: inline
    code: |
      #!/bin/bash
      echo "=== Approval Workflows ==="
      grep -r -E "(approv|sign.?off|authorize)" \
        --include="*.py" --include="*.java" --include="*.ts" . 2>/dev/null

      echo "=== Dual Control Points ==="
      grep -r -E "(maker|checker|dual|two.?person)" \
        --include="*.py" --include="*.java" . 2>/dev/null
signals:
  critical:
  - id: SOD-CRIT-001
    signal: Same person can initiate and approve transactions
    evidence_indicators:
    - User can create and approve their own transactions
    - No maker-checker control on financial entries
    - Self-approval enabled in workflow
    explanation: |
      Allowing self-approval enables fraud and undetected errors.
      This is a fundamental SoD violation constituting material weakness.
    remediation: Implement mandatory dual control for financial transactions
  - id: SOD-CRIT-002
    signal: Same person controls entire process end-to-end
    evidence_indicators:
    - Single user has access to all process steps
    - No segregation between creation and execution
    - Combined access to conflicting functions
    explanation: |
      End-to-end process control without segregation allows fraud
      without detection and constitutes a material weakness.
    remediation: Segregate process steps across different roles/individuals
  - id: SOD-CRIT-003
    signal: System administrator can modify financial data
    evidence_indicators:
    - DBA has production write access to financial tables
    - IT can modify financial records without logging
    - No separation between IT and financial data access
    explanation: |
      IT personnel with financial data modification capability
      bypass application controls and audit trails.
    remediation: Remove direct data modification capability from IT roles
  high:
  - id: SOD-HIGH-001
    signal: SoD conflicts not monitored
    explanation: Unmonitored SoD violations go undetected
    remediation: Implement SoD conflict monitoring and alerting
  - id: SOD-HIGH-002
    signal: Compensating controls not documented
    explanation: Undocumented compensating controls cannot be tested
    remediation: Document all compensating controls for unavoidable conflicts
  - id: SOD-HIGH-003
    signal: Emergency access bypasses SoD controls
    explanation: Uncontrolled emergency access creates hidden conflicts
    remediation: Implement emergency access with monitoring and review
  medium:
  - id: SOD-MED-001
    signal: SoD matrix incomplete or outdated
    remediation: Update SoD matrix to reflect current roles and processes
  - id: SOD-MED-002
    signal: Role definitions include conflicting permissions
    remediation: Refactor roles to eliminate embedded SoD conflicts
  low:
  - id: SOD-LOW-001
    signal: SoD violations not reported to management
  positive:
  - id: SOD-POS-001
    signal: Automated SoD conflict detection and prevention
  - id: SOD-POS-002
    signal: System-enforced maker-checker controls
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: SoD Framework Review
    description: |
      Assess the organization's SoD framework including
      conflict definitions and control design.
    duration_estimate: 45 min
    questions:
    - How are SoD conflicts defined?
    - Is there a comprehensive SoD matrix?
    - How are conflicts resolved?
    expected_findings:
    - Framework maturity assessment
    - Conflict definition completeness
    - Resolution process adequacy
  - id: '2'
    name: Role Analysis
    description: |
      Analyze role definitions for embedded SoD conflicts
      and excessive privilege combinations.
    duration_estimate: 60 min
    commands:
    - purpose: Find role definitions
      command: grep -r -E '(role|permission|grant)' --include='*.py' --include='*.java' --include='*.yaml'
        . | head -30
    expected_findings:
    - Role conflict identification
    - Privilege assessment
    - Role design evaluation
  - id: '3'
    name: User Access Conflict Detection
    description: |
      Identify users with conflicting access across roles
      and systems.
    duration_estimate: 75 min
    questions:
    - Do any users have incompatible role combinations?
    - Can users perform conflicting functions?
    - Are conflicts detected proactively?
    expected_findings:
    - User conflict inventory
    - Severity assessment
    - Detection capability evaluation
  - id: '4'
    name: Compensating Control Assessment
    description: |
      Evaluate compensating controls for unavoidable
      SoD conflicts.
    duration_estimate: 45 min
    questions:
    - What compensating controls exist?
    - Are they adequate to mitigate risk?
    - Are they documented and tested?
    expected_findings:
    - Compensating control inventory
    - Effectiveness assessment
    - Documentation adequacy
  - id: '5'
    name: Monitoring and Reporting
    description: |
      Assess ongoing SoD monitoring, violation detection,
      and management reporting.
    duration_estimate: 45 min
    expected_findings:
    - Monitoring capability
    - Detection effectiveness
    - Reporting adequacy
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: sod_assessment
    format: structured
    sections:
    - Framework Evaluation
    - Role Analysis
    - Conflict Inventory
    - Compensating Controls
    - Monitoring Assessment
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Key Findings
    - Material Weakness Assessment
    - Recommendations
  confidence_guidance:
    high: Complete access analysis with conflict testing
    medium: Sample-based conflict analysis
    low: Framework review without access testing
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: sox-sod
      priority: required
    - source_id: coso-sod
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires thorough access analysis
    full:
      included: true
      priority: 1
closeout_checklist:
- id: sod-001
  item: SoD framework evaluated
  level: CRITICAL
  verification: manual
  verification_notes: Confirm framework assessment complete
  expected: Confirmed by reviewer
- id: sod-002
  item: Role conflicts analyzed
  level: CRITICAL
  verification: manual
  verification_notes: Verify role-level conflict analysis complete
  expected: Confirmed by reviewer
- id: sod-003
  item: User access conflicts identified
  level: CRITICAL
  verification: manual
  verification_notes: Confirm user conflict inventory complete
  expected: Confirmed by reviewer
- id: sod-004
  item: Compensating controls assessed
  level: BLOCKING
  verification: manual
  verification_notes: Verify compensating control evaluation complete
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - public-company
    - financial-services
    - enterprise
  compliance_frameworks:
  - framework: SOX
    controls:
    - Section 404
    - ITGC
  - framework: COSO
    controls:
    - Control Activities
  - framework: COBIT
    controls:
    - DSS05
    - DSS06
relationships:
  commonly_combined:
  - compliance-legal.financial-reporting.sox-compliance
  - compliance-legal.risk-control.control-effectiveness
  - compliance-legal.policy-governance.policy-enforcement
