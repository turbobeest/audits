# ============================================================
# AUDIT FILE: Hotfix Process
# ============================================================
# Evaluates emergency hotfix procedures for rapid response
# to production issues while maintaining quality controls.
# ============================================================

audit:
  id: "devops-ci-cd.release-management.hotfix-process"
  name: "Hotfix Process Assessment"
  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "devops-ci-cd"
  category_number: 11
  subcategory: "release-management"

  tier: "expert"
  estimated_duration: "3 hours"

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "process"

  default_profiles:
    - "full"
    - "security"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit examines the hotfix process for emergency production fixes
    including expedited approval workflows, testing requirements, rollback
    procedures, and post-incident documentation. It evaluates whether
    hotfixes can be deployed rapidly while maintaining essential controls.

  why_it_matters: |
    Inadequate hotfix processes either delay critical fixes causing
    extended outages, or bypass too many controls creating additional
    risk. A well-designed hotfix process balances speed with safety
    for rapid incident resolution.

  when_to_run:
    - "After production incidents requiring hotfixes"
    - "During incident response planning"
    - "When establishing emergency procedures"
    - "Quarterly process reviews"

prerequisites:
  required_artifacts:
    - type: "hotfix_runbook"
      description: "Hotfix procedures and runbook"
    - type: "incident_history"
      description: "Historical hotfix deployments"

  access_requirements:
    - "Read access to hotfix procedures"
    - "Access to incident and deployment history"
    - "Permission to review approval workflows"

discovery:
  file_patterns:
    - glob: "**/hotfix*"
      purpose: "Hotfix-related files"
    - glob: "**/runbooks/emergency*"
      purpose: "Emergency procedures"
    - glob: "**/.github/workflows/*hotfix*.yaml"
      purpose: "Hotfix workflow definitions"

  code_patterns:
    - pattern: "hotfix|emergency|expedited|fast-track"
      type: "keyword"
      scope: "config"
      purpose: "Hotfix-related configurations"
    - pattern: "rollback|revert|undo"
      type: "keyword"
      scope: "config"
      purpose: "Rollback procedures"

  documents_to_review:
    - type: "incident_runbooks"
      purpose: "Emergency response procedures"
    - type: "hotfix_procedures"
      purpose: "Hotfix deployment guidelines"

knowledge_sources:
  guides:
    - id: "google-sre-oncall"
      name: "Google SRE - Being On-Call"
      url: "https://sre.google/sre-book/being-on-call/"
      offline_cache: true
    - id: "incident-management"
      name: "PagerDuty Incident Management"
      url: "https://incident.io/guides/incident-management"
      offline_cache: true

  specifications:
    - id: "gitflow"
      name: "Git Flow Hotfix Branches"
      url: "https://nvie.com/posts/a-successful-git-branching-model/"
      offline_cache: true
      priority: "recommended"

tooling:
  infrastructure_tools:
    - tool: "git"
      purpose: "Manage hotfix branches"
      command: "git checkout -b hotfix/critical-fix main"

  scripts:
    - id: "hotfix-check"
      language: "bash"
      purpose: "Find hotfix branches and commits"
      source: "inline"
      code: |
        #!/bin/bash
        # Find hotfix branches
        echo "=== Hotfix Branches ==="
        git branch -a | grep -i hotfix | head -10
        echo "=== Recent Hotfix Commits ==="
        git log --all --oneline --grep='hotfix\|emergency' | head -10

signals:
  critical:
    - id: "HOTFIX-CRIT-001"
      signal: "No defined hotfix process exists"
      evidence_indicators:
        - "No documented emergency deployment procedure"
        - "Ad-hoc approaches to critical fixes"
      explanation: |
        Without a defined process, hotfixes are handled inconsistently,
        critical fixes may be delayed, and essential controls may be
        inadvertently bypassed.
      remediation: "Document and socialize a clear hotfix process with defined roles"

    - id: "HOTFIX-CRIT-002"
      signal: "Hotfixes bypass all testing and approval"
      evidence_indicators:
        - "Emergency fixes deployed without any testing"
        - "No expedited approval process defined"
      explanation: |
        Completely bypassing controls increases risk that the hotfix
        introduces new issues or does not actually fix the problem.
      remediation: "Define minimum viable testing and approval for hotfixes"

  high:
    - id: "HOTFIX-HIGH-001"
      signal: "No rollback procedure for failed hotfixes"
      evidence_indicators:
        - "No documented rollback steps"
        - "Previous deployments not preserved for reversion"
      explanation: |
        Failed hotfixes without rollback capability extend incident
        duration and increase blast radius.
      remediation: "Implement and test rollback procedures with preserved previous versions"

    - id: "HOTFIX-HIGH-002"
      signal: "Hotfix changes not backported to development branch"
      evidence_pattern: "hotfix.*branch|cherry-pick"
      explanation: |
        Unbackported hotfixes cause divergence and regression when
        subsequent releases overwrite the fix.
      remediation: "Mandate backport of all hotfixes with automated tracking"

  medium:
    - id: "HOTFIX-MED-001"
      signal: "No post-incident review for hotfix deployments"
      remediation: "Conduct post-incident review for all hotfixes including process evaluation"

    - id: "HOTFIX-MED-002"
      signal: "Hotfix timing and authorship not tracked"
      remediation: "Log hotfix metadata including time, author, approver, and incident reference"

  low:
    - id: "HOTFIX-LOW-001"
      signal: "Hotfix process documentation not easily accessible during incidents"

  positive:
    - id: "HOTFIX-POS-001"
      signal: "Expedited but controlled hotfix process with mandatory post-review"
    - id: "HOTFIX-POS-002"
      signal: "Automated hotfix branch creation and backport tracking"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Document existing hotfix process"
      description: |
        Identify the current hotfix process including procedures,
        approval requirements, and tooling.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find hotfix documentation"
          command: "find . -name '*hotfix*' -o -name '*emergency*' 2>/dev/null | head -10"
        - purpose: "Check for hotfix workflows"
          command: "grep -ri 'hotfix\\|emergency' --include='*.yaml' --include='*.yml' .github/ 2>/dev/null | head -15"
      expected_findings:
        - "Hotfix process documentation"
        - "Workflow identification"

    - id: "2"
      name: "Evaluate testing requirements"
      description: |
        Review minimum testing requirements for hotfixes and
        verify they balance speed with safety.
      duration_estimate: "30 min"
      commands:
        - purpose: "Check hotfix test requirements"
          command: "grep -ri 'test\\|check\\|validation' --include='*hotfix*' . 2>/dev/null | head -10"
      expected_findings:
        - "Testing requirements for hotfixes"
        - "Speed vs. safety balance"

    - id: "3"
      name: "Review approval workflow"
      description: |
        Examine expedited approval process for hotfixes including
        required approvers and audit trail.
      duration_estimate: "30 min"
      questions:
        - "Who can approve hotfixes?"
        - "Is there an expedited approval path?"
        - "Are approvals logged and auditable?"
      expected_findings:
        - "Approval workflow documentation"
        - "Accountability mechanisms"

    - id: "4"
      name: "Verify rollback capability"
      description: |
        Confirm that rollback procedures exist and have been
        tested for hotfix scenarios.
      duration_estimate: "30 min"
      commands:
        - purpose: "Find rollback procedures"
          command: "grep -ri 'rollback\\|revert' --include='*.md' --include='*.yaml' . 2>/dev/null | head -15"
      expected_findings:
        - "Rollback procedure documentation"
        - "Testing verification"

    - id: "5"
      name: "Audit historical hotfixes"
      description: |
        Review recent hotfixes to assess process compliance
        and identify improvement areas.
      duration_estimate: "60 min"
      commands:
        - purpose: "Find recent hotfix activity"
          command: "git log --all --oneline --grep='hotfix\\|emergency\\|urgent' 2>/dev/null | head -20"
      expected_findings:
        - "Process compliance assessment"
        - "Historical patterns"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Process Assessment"
        - "Historical Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Direct review of hotfix history with process verification"
    medium: "Configuration and documentation analysis"
    low: "Documentation review without historical verification"

offline:
  capability: "full"
  cache_manifest:
    knowledge:
      - source_id: "google-sre-oncall"
        priority: "recommended"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive process review"
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1

closeout_checklist:
  - id: "hotfix-001"
    item: "Hotfix process documented and accessible"
    level: "CRITICAL"
    verification: "find . -name '*hotfix*' -type f 2>/dev/null | head -5 && echo 'PASS' || echo 'FAIL'"
    expected: "PASS"

  - id: "hotfix-002"
    item: "Rollback procedure exists and tested"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify rollback procedure documentation and test results"
    expected: "Confirmed by reviewer"

  - id: "hotfix-003"
    item: "Hotfixes require minimum testing"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verify testing requirements are defined for hotfixes"
    expected: "Confirmed by reviewer"

  - id: "hotfix-004"
    item: "Backport tracking implemented"
    level: "WARNING"
    verification: "manual"
    verification_notes: "Verify hotfixes are tracked for backport to main branch"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "SOC2"
      controls: ["CC7.4", "CC8.1"]
    - framework: "ISO27001"
      controls: ["A.14.2.2", "A.16.1.5"]

relationships:
  commonly_combined:
    - "devops-ci-cd.release-management.release-approval-process"
    - "devops-ci-cd.release-management.release-scheduling"
