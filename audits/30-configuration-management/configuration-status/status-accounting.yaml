# ============================================================
# AUDIT: Configuration Status Accounting
# Category: 30 - Configuration Management
# Subcategory: configuration-status
# ============================================================
# Systematic recording and reporting of configuration item states
# throughout their lifecycle per CMMI and ITIL requirements.
# ============================================================

audit:
  id: "configuration-management.configuration-status.status-accounting"
  name: "Configuration Status Accounting Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "configuration-management"
  category_number: 30
  subcategory: "configuration-status"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h

  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "infrastructure"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit examines the configuration status accounting function that
    records and reports on CI states throughout their lifecycle. It evaluates:
    - CI status definitions and state model
    - Status transition tracking
    - Current status accuracy
    - Historical status records
    - Status reporting capabilities
    - Status-based metrics and KPIs
    - Integration with CMDB

  why_it_matters: |
    Configuration Status Accounting is a core ITIL practice:
    - CMMI CM SP 3.1 and 3.2 require recording and reporting CI status
    - ITIL CSA provides information on current and historical states
    - Status awareness enables change impact assessment
    - Accurate status supports capacity planning
    - Status history aids troubleshooting and audit
    - Metrics from status data drive improvements

  when_to_run:
    - "When implementing CMDB"
    - "During configuration management maturity assessments"
    - "For compliance audits"
    - "When status data quality is questioned"
    - "Quarterly CSA reviews"

prerequisites:
  required_artifacts:
    - type: "cmdb"
      description: "Configuration management database"
    - type: "documentation"
      description: "Status definitions and state model"

  access_requirements:
    - "Access to CMDB or configuration inventory"
    - "Access to status tracking systems"

discovery:
  code_patterns:
    - pattern: "(status|state|lifecycle)[-_](active|deprecated|pending|approved)"
      type: "regex"
      scope: "config"
      purpose: "Detect status metadata"

    - pattern: "(enabled|disabled|active|inactive|deprecated)"
      type: "regex"
      scope: "config"
      purpose: "Detect status values"

  file_patterns:
    - glob: "**/cmdb/**"
      purpose: "CMDB configurations"
    - glob: "**/inventory/**"
      purpose: "Configuration inventories"

knowledge_sources:
  specifications:
    - id: "itil-csa"
      name: "ITIL Configuration Status Accounting"
      url: "https://www.axelos.com/best-practice-solutions/itil"
      offline_cache: true
      priority: "required"

    - id: "cmmi-cm-sp3"
      name: "CMMI CM SP 3.1 and 3.2"
      url: "https://cmmiinstitute.com/cmmi"
      offline_cache: true
      priority: "required"

tooling:
  scripts:
    - id: "status-accounting-audit"
      language: "bash"
      purpose: "Audit status accounting practices"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Status Accounting Audit ==="
        echo ""
        echo "=== Status Fields in Configs ==="
        grep -rn "status:\|state:\|lifecycle:" \
          --include="*.yaml" --include="*.json" . 2>/dev/null | head -30
        echo ""
        echo "=== Status Values Distribution ==="
        grep -rhoE "status:\s*\S+" --include="*.yaml" . 2>/dev/null | \
          sort | uniq -c | sort -rn | head -20

signals:
  critical:
    - id: "CSTA-CRIT-001"
      signal: "No configuration status tracking"
      evidence_indicators:
        - "No status field on configuration items"
        - "No state model defined"
        - "CI lifecycle not tracked"
      explanation: |
        ITIL CSA requires tracking CI status. Without status tracking,
        it's impossible to know if configurations are active, deprecated,
        or pending approval.
      remediation: |
        - Define status state model
        - Add status metadata to all CIs
        - Implement status transition tracking
        - Create status reporting
      cwe: "CWE-1059"

  high:
    - id: "CSTA-HIGH-001"
      signal: "Status information outdated or incorrect"
      evidence_indicators:
        - "Deprecated configs still marked active"
        - "Status not updated on changes"
        - "Manual status updates only"
      explanation: |
        Inaccurate status undermines trust in configuration data.
        Decisions based on incorrect status may use deprecated
        or unapproved configurations.
      remediation: |
        - Audit and correct status data
        - Automate status updates
        - Implement status validation
        - Regular status accuracy reviews

    - id: "CSTA-HIGH-002"
      signal: "No historical status records"
      evidence_indicators:
        - "Only current status available"
        - "Status change history not kept"
        - "Cannot determine when status changed"
      explanation: |
        Historical status enables audit and troubleshooting.
        Without history, understanding configuration state at
        a point in time is impossible.
      remediation: |
        - Implement status history tracking
        - Record status change timestamps
        - Retain historical status data
        - Enable point-in-time queries

  medium:
    - id: "CSTA-MED-001"
      signal: "Status definitions not documented"
      evidence_indicators:
        - "Status values undefined"
        - "No state model documentation"
        - "Inconsistent status interpretation"
      explanation: |
        Clear status definitions ensure consistent understanding.
        Undefined statuses are interpreted differently, creating
        confusion and inconsistent handling.
      remediation: |
        - Document all status values
        - Define status state transitions
        - Communicate definitions to teams
        - Validate against definitions

    - id: "CSTA-MED-002"
      signal: "Status metrics not captured"
      evidence_indicators:
        - "No metrics on CI states"
        - "No trending of status changes"
        - "Cannot measure status distribution"
      explanation: |
        Status metrics enable management oversight. Without
        metrics, trends cannot be identified and improvements
        cannot be measured.
      remediation: |
        - Define status-based KPIs
        - Implement status metrics collection
        - Create status dashboards
        - Track status trends

  low:
    - id: "CSTA-LOW-001"
      signal: "Status not visible in standard views"
      evidence_indicators:
        - "Status hidden in detailed views"
        - "Not included in listings"
        - "Extra effort to see status"
      explanation: |
        Visible status enables quick assessment. Hidden status
        requires extra investigation and may be overlooked.
      remediation: |
        - Include status in standard views
        - Add status to listings and searches
        - Enable status filtering
        - Highlight non-standard statuses

  positive:
    - id: "CSTA-POS-001"
      signal: "Comprehensive status accounting implemented"
      evidence_indicators:
        - "All CIs have status metadata"
        - "Status history tracked"
        - "Status metrics and reporting available"

procedure:
  context:
    cognitive_mode: "methodical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Status Model Review"
      description: "Review status definitions and state model."
      duration_estimate: "30 min"
      commands:
        - purpose: "Find status documentation"
          command: |
            grep -rl "status\|lifecycle\|state" --include="*.md" . 2>/dev/null | head -20
        - purpose: "Extract status values used"
          command: |
            grep -rhoE "status:\s*\S+" --include="*.yaml" . 2>/dev/null | \
              sort | uniq -c | sort -rn | head -20

    - id: "2"
      name: "Status Data Quality"
      description: "Assess accuracy of current status data."
      duration_estimate: "30 min"
      commands:
        - purpose: "Find potentially stale statuses"
          command: |
            grep -rn "status:\s*active" --include="*.yaml" . 2>/dev/null | \
              xargs -I{} dirname {} | sort | uniq | head -20
        - purpose: "Check for deprecated configs"
          command: |
            grep -rn "deprecated\|obsolete" --include="*.yaml" . 2>/dev/null | head -20

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Status Model Assessment"
        - "Data Quality Analysis"
        - "Recommendations"

  confidence_guidance:
    high: "Status tracking directly verified"
    medium: "Status metadata found but accuracy not verified"
    low: "Status tracking requires manual verification"

offline:
  capability: "full"
  cache_manifest:
    knowledge:
      - source_id: "itil-csa"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Status accounting requires thorough review"
    full:
      included: true
      priority: 2
    production:
      included: true
      priority: 2

closeout_checklist:
  - id: "csta-001"
    item: "Status metadata present on CIs"
    level: "CRITICAL"
    verification: |
      grep -rn "status:" --include="*.yaml" . 2>/dev/null | wc -l | \
        xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
    expected: "PASS"

governance:
  applicable_to:
    archetypes: ["all"]
  compliance_frameworks:
    - framework: "ITIL"
      controls: ["Configuration Status Accounting"]
    - framework: "CMMI"
      controls: ["CM SP 3.1", "CM SP 3.2"]

relationships:
  commonly_combined:
    - "configuration-management.configuration-status.change-tracking"
    - "configuration-management.configuration-identification.config-discovery"
