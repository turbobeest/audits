audit:
  id: configuration-management.configuration-status.audit-trail
  name: Configuration Audit Trail Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: configuration-management
  category_number: 30
  subcategory: configuration-status
  tier: phd
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: infrastructure
  default_profiles:
  - full
  - production
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines the audit trail for configuration changes ensuring
    compliance and accountability. It evaluates:
    - Audit log completeness for all change types
    - Audit record immutability and integrity
    - Audit data retention compliance
    - Audit log accessibility and searchability
    - Tamper detection for audit records
    - Integration with SIEM and monitoring
    - Compliance with regulatory requirements
  why_it_matters: |
    Audit trails are essential for compliance and security:
    - SOC 2 CC7.2 requires logging of configuration changes
    - HIPAA, PCI-DSS, GDPR require audit trail maintenance
    - Forensic investigation depends on complete audit records
    - Accountability requires attributable change records
    - Compliance audits need accessible audit data
    - Tamper-evident logs prevent evidence destruction
  when_to_run:
  - During compliance audits
  - After security incidents
  - When implementing audit logging
  - During log retention reviews
  - Quarterly security assessments
prerequisites:
  required_artifacts:
  - type: audit_logs
    description: Configuration change audit logs
  - type: documentation
    description: Audit logging policies and procedures
  access_requirements:
  - Access to audit log systems
  - Access to log retention policies
discovery:
  code_patterns:
  - pattern: (audit[-_]log|audit[-_]trail|cloudtrail|activity[-_]log)
    type: regex
    scope: config
    purpose: Detect audit logging configuration
  - pattern: (log[-_]retention|retention[-_]days|log[-_]archive)
    type: regex
    scope: config
    purpose: Detect retention configuration
  file_patterns:
  - glob: '**/audit/**'
    purpose: Audit configurations
  - glob: '**/logging/**'
    purpose: Logging configurations
  - glob: '**/*cloudtrail*'
    purpose: CloudTrail configurations
knowledge_sources:
  specifications:
  - id: soc2-cc72
    name: SOC 2 CC7.2 - System Change Management
    url: https://www.aicpa.org/soc
    offline_cache: true
    priority: required
  - id: pci-dss-10
    name: PCI-DSS Requirement 10 - Logging
    url: https://www.pcisecuritystandards.org/
    offline_cache: true
    priority: recommended
tooling:
  infrastructure_tools:
  - tool: aws-cloudtrail
    purpose: AWS audit logging
    command: aws cloudtrail describe-trails
  scripts:
  - id: audit-trail-check
    language: bash
    purpose: Check audit trail configuration
    source: inline
    code: |
      #!/bin/bash
      echo "=== Audit Trail Assessment ==="
      echo ""
      echo "=== Audit Log Configurations ==="
      find . -type f \( -name "*audit*" -o -name "*cloudtrail*" \) \
        -not -path "*/node_modules/*" 2>/dev/null | head -20
      echo ""
      echo "=== Retention Configurations ==="
      grep -rn "retention\|expire\|archive" \
        --include="*.yaml" --include="*.tf" . 2>/dev/null | head -20
signals:
  critical:
  - id: CAUD-CRIT-001
    signal: No audit logging for configuration changes
    evidence_indicators:
    - No audit logs captured
    - Changes not recorded
    - No CloudTrail or equivalent
    explanation: |
      SOC 2 and other frameworks require configuration change logging.
      Without audit trails, changes cannot be investigated, attributed,
      or demonstrated for compliance.
    remediation: |
      - Enable audit logging for all configuration changes
      - Configure CloudTrail or equivalent
      - Ensure comprehensive coverage
      - Verify log capture
    cwe: CWE-778
  - id: CAUD-CRIT-002
    signal: Audit logs can be modified or deleted
    evidence_indicators:
    - No log immutability
    - Logs in writable storage
    - No tamper detection
    explanation: |
      Mutable audit logs can be altered to hide evidence.
      Compliance frameworks require tamper-evident logging
      to ensure audit integrity.
    remediation: |
      - Enable log immutability (S3 Object Lock, etc.)
      - Implement log integrity verification
      - Separate log storage from change access
      - Detect log modification attempts
  high:
  - id: CAUD-HIGH-001
    signal: Audit log retention insufficient
    evidence_indicators:
    - Logs deleted before compliance period
    - No retention policy
    - Short retention configured
    explanation: |
      Compliance frameworks specify minimum retention periods.
      Insufficient retention prevents investigation of historical
      issues and fails compliance requirements.
    remediation: |
      - Define retention per compliance requirements
      - Configure appropriate retention (typically 1-7 years)
      - Archive logs per policy
      - Verify retention enforcement
  - id: CAUD-HIGH-002
    signal: Audit logs not centralized
    evidence_indicators:
    - Logs scattered across systems
    - No central log aggregation
    - Correlation requires manual effort
    explanation: |
      Centralized logging enables efficient investigation.
      Distributed logs are difficult to correlate and may
      be incomplete due to access limitations.
    remediation: |
      - Implement centralized log aggregation
      - Forward all audit logs to SIEM
      - Enable cross-system correlation
      - Ensure complete coverage
  - id: CAUD-HIGH-003
    signal: Audit log access not restricted
    evidence_indicators:
    - Broad access to audit logs
    - No separation of duties
    - Subjects of audit can modify logs
    explanation: |
      Unrestricted audit log access enables tampering.
      Those being audited should not have access to modify
      or delete audit records.
    remediation: |
      - Restrict audit log access
      - Implement separation of duties
      - Use separate credentials for log access
      - Audit access to audit logs
  medium:
  - id: CAUD-MED-001
    signal: Audit log search limited
    evidence_indicators:
    - Cannot query logs effectively
    - No indexing
    - Manual log review required
    explanation: |
      Searchable logs enable efficient investigation.
      Limited search capability slows incident response
      and makes compliance audits expensive.
    remediation: |
      - Implement log indexing
      - Enable log search and filtering
      - Provide query interfaces
      - Integrate with SIEM
  - id: CAUD-MED-002
    signal: Audit log monitoring absent
    evidence_indicators:
    - No alerting on suspicious activity
    - Logs reviewed only reactively
    - No anomaly detection
    explanation: |
      Proactive monitoring detects issues early.
      Without monitoring, unauthorized changes may go
      undetected until they cause incidents.
    remediation: |
      - Configure alerting for suspicious activity
      - Implement anomaly detection
      - Monitor log gaps
      - Regular log review process
  low:
  - id: CAUD-LOW-001
    signal: Audit log format inconsistent
    evidence_indicators:
    - Different formats across systems
    - No standardized schema
    - Parsing difficulties
    explanation: |
      Consistent formatting enables automated processing.
      Inconsistent formats complicate analysis and may
      cause parsing errors.
    remediation: |
      - Define standard audit log schema
      - Normalize logs during aggregation
      - Use structured logging
      - Document format specifications
  positive:
  - id: CAUD-POS-001
    signal: Comprehensive immutable audit trail
    evidence_indicators:
    - All changes logged
    - Immutable storage configured
    - Retention meets requirements
  - id: CAUD-POS-002
    signal: Audit logs integrated with SIEM
    evidence_indicators:
    - Centralized log aggregation
    - Real-time monitoring
    - Automated alerting
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Audit Logging Configuration Review
    description: Review audit logging configuration and coverage.
    duration_estimate: 30 min
    commands:
    - purpose: Find audit logging configuration
      command: |
        find . -type f \( -name "*audit*" -o -name "*cloudtrail*" -o -name "*logging*" \) \
          -not -path "*/node_modules/*" 2>/dev/null | head -30
    - purpose: Check CloudTrail/audit configuration
      command: |
        grep -rn "cloudtrail\|audit_log\|EnableLogFileValidation" \
          --include="*.tf" --include="*.yaml" . 2>/dev/null | head -20
  - id: '2'
    name: Log Immutability Assessment
    description: Assess log immutability and integrity controls.
    duration_estimate: 30 min
    commands:
    - purpose: Check for immutability configuration
      command: |
        grep -rn "object_lock\|immutable\|worm\|write_once" \
          --include="*.tf" --include="*.yaml" . 2>/dev/null | head -20
    - purpose: Check log validation
      command: |
        grep -rn "log_file_validation\|integrity\|checksum" \
          --include="*.tf" --include="*.yaml" . 2>/dev/null | head -20
  - id: '3'
    name: Retention Configuration Review
    description: Review log retention policies and configuration.
    duration_estimate: 30 min
    commands:
    - purpose: Find retention configuration
      command: |
        grep -rn "retention\|expire\|lifecycle" \
          --include="*.tf" --include="*.yaml" . 2>/dev/null | head -30
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Audit Coverage Assessment
    - Integrity and Retention
    - Recommendations
  confidence_guidance:
    high: Audit configuration directly verified
    medium: Logging configuration found but effectiveness not verified
    low: Audit trail status requires manual verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: soc2-cc72
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Audit trail assessment requires thorough review
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
    production:
      included: true
      priority: 1
closeout_checklist:
- id: caud-001
  item: Audit logging enabled for configuration changes
  level: CRITICAL
  verification: manual
  verification_notes: Verify CloudTrail or equivalent is configured
  expected: Confirmed by reviewer
- id: caud-002
  item: Audit logs are immutable
  level: CRITICAL
  verification: manual
  verification_notes: Verify log immutability is configured
  expected: Confirmed by reviewer
- id: caud-003
  item: Retention meets compliance requirements
  level: BLOCKING
  verification: manual
  verification_notes: Verify retention period meets requirements
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: SOC 2
    controls:
    - CC7.2
    - CC7.3
  - framework: PCI-DSS
    controls:
    - '10.1'
    - '10.2'
    - '10.5'
    - '10.7'
  - framework: ISO 27001
    controls:
    - A.8.15
    - A.8.17
  - framework: HIPAA
    controls:
    - 164.312(b)
relationships:
  commonly_combined:
  - configuration-management.configuration-status.change-tracking
  - configuration-management.configuration-control.change-control
