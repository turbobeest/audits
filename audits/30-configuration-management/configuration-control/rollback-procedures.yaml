audit:
  id: configuration-management.configuration-control.rollback-procedures
  name: Configuration Rollback Procedures Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: configuration-management
  category_number: 30
  subcategory: configuration-control
  tier: phd
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: infrastructure
  default_profiles:
  - full
  - production
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines rollback capabilities and procedures for configuration
    changes. It evaluates:
    - Rollback automation and tooling
    - Rollback procedure documentation
    - Rollback testing and validation
    - Rollback triggers and decision criteria
    - Partial vs full rollback capabilities
    - Rollback timing and SLAs
    - Post-rollback verification
  why_it_matters: |
    Rollback capability is essential for operational resilience:
    - ITIL recommends remediation plans for all changes
    - Fast rollback reduces incident duration and impact
    - Untested rollback procedures often fail when needed
    - Clear rollback criteria prevent delayed responses
    - Automated rollback enables rapid recovery
    - Partial rollback minimizes disruption
    - 12-factor app disposability principle supports quick rollback
  when_to_run:
  - When establishing deployment procedures
  - After failed or slow rollbacks
  - During disaster recovery planning
  - Before major configuration changes
  - Quarterly operational reviews
prerequisites:
  required_artifacts:
  - type: runbooks
    description: Operational runbooks with rollback procedures
  - type: deployment_scripts
    description: Deployment and rollback automation
  - type: documentation
    description: Change management procedures
  access_requirements:
  - Access to deployment automation
  - Read access to configuration repositories
  - Access to runbook documentation
discovery:
  code_patterns:
  - pattern: (rollback|revert|undo|restore)[-_](config|deployment|change)
    type: regex
    scope: scripts
    purpose: Detect rollback scripts
  - pattern: git\s+revert|git\s+reset|git\s+checkout
    type: regex
    scope: scripts
    purpose: Detect Git rollback commands
  - pattern: (helm\s+rollback|kubectl\s+rollout\s+undo)
    type: regex
    scope: scripts
    purpose: Detect Kubernetes rollback
  - pattern: (terraform\s+apply|terraform\s+plan).*-target
    type: regex
    scope: scripts
    purpose: Detect targeted Terraform operations
  file_patterns:
  - glob: '**/rollback*'
    purpose: Rollback scripts and documentation
  - glob: '**/revert*'
    purpose: Revert procedures
  - glob: '**/runbooks/**'
    purpose: Operational runbooks
  - glob: '**/playbooks/**'
    purpose: Ansible playbooks
knowledge_sources:
  specifications:
  - id: itil-remediation
    name: ITIL Change Remediation
    url: https://www.axelos.com/best-practice-solutions/itil
    offline_cache: true
    priority: required
  - id: 12factor-disposability
    name: '12-Factor App: Factor IX - Disposability'
    url: https://12factor.net/disposability
    offline_cache: true
    priority: required
  guides:
  - id: kubernetes-rollout
    name: Kubernetes Rolling Updates and Rollbacks
    url: https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/
    offline_cache: true
  - id: terraform-state
    name: Terraform State Rollback
    url: https://developer.hashicorp.com/terraform/language/state
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: kubectl
    purpose: Kubernetes rollout undo
    command: kubectl rollout undo deployment/NAME
  - tool: helm
    purpose: Helm rollback
    command: helm rollback RELEASE REVISION
  - tool: terraform
    purpose: Terraform state management
    command: terraform state list
  scripts:
  - id: rollback-audit
    language: bash
    purpose: Audit rollback capabilities
    source: inline
    code: |
      #!/bin/bash
      echo "=== Rollback Capability Audit ==="
      echo ""
      echo "=== Rollback Scripts ==="
      find . -type f \( -name "*rollback*" -o -name "*revert*" \) \
        -not -path "*/node_modules/*" 2>/dev/null | head -20
      echo ""
      echo "=== Git Tags (Potential Rollback Points) ==="
      git tag -l --sort=-creatordate 2>/dev/null | head -10
      echo ""
      echo "=== Runbook Files ==="
      find . -type f -path "*runbook*" -o -path "*playbook*" \
        -not -path "*/node_modules/*" 2>/dev/null | head -20
signals:
  critical:
  - id: ROLL-CRIT-001
    signal: No rollback capability for configuration changes
    evidence_indicators:
    - No rollback scripts or automation
    - Manual-only recovery procedures
    - No ability to restore previous config state
    explanation: |
      ITIL requires remediation plans for changes. Without rollback
      capability, failed configurations cannot be quickly recovered,
      extending incident duration and impact.
    remediation: |
      - Implement rollback automation for all config types
      - Create rollback scripts for each deployment method
      - Test rollback procedures regularly
      - Document manual rollback steps as backup
    cwe: CWE-1059
  - id: ROLL-CRIT-002
    signal: Rollback procedures untested
    evidence_indicators:
    - Rollback never exercised
    - No rollback testing in procedures
    - Last rollback test unknown
    explanation: |
      Untested rollback procedures frequently fail when needed.
      Without testing, hidden dependencies, missing steps, or
      environmental changes may prevent successful rollback.
    remediation: |
      - Test rollback procedures regularly
      - Include rollback in deployment validation
      - Document rollback test results
      - Schedule periodic rollback exercises
  high:
  - id: ROLL-HIGH-001
    signal: Rollback requires manual intervention
    evidence_indicators:
    - No automated rollback trigger
    - Rollback requires human decision
    - Long delay between detection and rollback
    explanation: |
      Manual rollback delays recovery. Automated rollback based
      on health checks enables rapid recovery without waiting
      for human intervention.
    remediation: |
      - Implement automated rollback triggers
      - Define health check criteria
      - Configure automatic rollback on failure
      - Retain manual override capability
  - id: ROLL-HIGH-002
    signal: No rollback decision criteria defined
    evidence_indicators:
    - Ad-hoc rollback decisions
    - Unclear when to rollback
    - No rollback thresholds
    explanation: |
      Clear criteria prevent delayed rollback decisions. Without
      defined thresholds, teams may hesitate or disagree about
      when rollback is warranted.
    remediation: |
      - Define rollback criteria (error rates, latency, etc.)
      - Document decision thresholds
      - Empower on-call to execute rollback
      - Remove approval barriers for rollback
  - id: ROLL-HIGH-003
    signal: Partial rollback not possible
    evidence_indicators:
    - All-or-nothing rollback only
    - Cannot rollback single config item
    - Rollback affects unrelated changes
    explanation: |
      Partial rollback minimizes disruption. All-or-nothing rollback
      may revert working changes along with problematic ones,
      causing unnecessary impact.
    remediation: |
      - Enable granular rollback capability
      - Isolate configuration items for independent rollback
      - Implement targeted rollback tooling
      - Document partial rollback procedures
  medium:
  - id: ROLL-MED-001
    signal: Rollback time exceeds SLA
    evidence_indicators:
    - Rollback takes hours
    - No defined rollback time target
    - Complex rollback dependencies
    explanation: |
      Slow rollback extends incident duration. Rollback time
      should be predictable and within acceptable limits for
      service recovery.
    remediation: |
      - Define rollback time targets
      - Optimize rollback procedures
      - Pre-stage rollback resources
      - Practice to improve speed
  - id: ROLL-MED-002
    signal: No post-rollback verification
    evidence_indicators:
    - Rollback success assumed
    - No health check after rollback
    - Rollback completion not validated
    explanation: |
      Post-rollback verification confirms recovery. Without
      verification, rollback may appear complete while issues
      persist.
    remediation: |
      - Implement post-rollback health checks
      - Verify service functionality after rollback
      - Confirm configuration state matches expected
      - Document verification procedures
  - id: ROLL-MED-003
    signal: Rollback documentation incomplete
    evidence_indicators:
    - Missing rollback steps
    - Outdated procedures
    - No troubleshooting guidance
    explanation: |
      Complete documentation enables consistent execution.
      Incomplete procedures lead to errors and delays during
      high-stress incident response.
    remediation: |
      - Complete rollback documentation
      - Include troubleshooting steps
      - Keep procedures current
      - Review after each rollback
  low:
  - id: ROLL-LOW-001
    signal: Rollback notifications not configured
    evidence_indicators:
    - No alerts on rollback execution
    - Stakeholders not notified of rollback
    - Rollback events not logged
    explanation: |
      Rollback notifications ensure awareness. Without notification,
      stakeholders may be unaware of rollback and its implications.
    remediation: |
      - Configure rollback alerting
      - Notify relevant stakeholders
      - Log rollback events
      - Include in post-incident review
  positive:
  - id: ROLL-POS-001
    signal: Automated rollback with health checks
    evidence_indicators:
    - Automatic rollback on failure detection
    - Health check integration
    - Fast rollback execution
  - id: ROLL-POS-002
    signal: Regularly tested rollback procedures
    evidence_indicators:
    - Scheduled rollback exercises
    - Documented test results
    - Procedures updated from testing
procedure:
  context:
    cognitive_mode: methodical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Rollback Capability Assessment
    description: |
      Assess rollback automation and tooling availability.
    duration_estimate: 30 min
    commands:
    - purpose: Find rollback scripts
      command: |
        find . -type f \( -name "*rollback*" -o -name "*revert*" \) \
          -not -path "*/node_modules/*" 2>/dev/null | head -30
    - purpose: Check for deployment rollback commands
      command: |
        grep -rn "rollback\|undo\|revert" \
          --include="*.sh" --include="*.yaml" --include="Makefile" \
          . 2>/dev/null | head -30
    - purpose: List available rollback points
      command: |
        git tag -l --sort=-creatordate 2>/dev/null | head -20
    expected_findings:
    - Rollback scripts inventory
    - Rollback command patterns
    - Version tags for rollback
  - id: '2'
    name: Rollback Documentation Review
    description: |
      Review rollback procedure documentation completeness.
    duration_estimate: 30 min
    commands:
    - purpose: Find runbook documentation
      command: |
        find . -type f \( -name "*runbook*" -o -name "*playbook*" \
          -o -name "*procedure*" \) -not -path "*/node_modules/*" \
          2>/dev/null | head -20
    - purpose: Search for rollback procedures in docs
      command: |
        grep -rl "rollback\|revert\|undo" \
          --include="*.md" --include="*.txt" . 2>/dev/null | head -20
    expected_findings:
    - Runbook documentation
    - Rollback procedure coverage
    - Documentation completeness
  - id: '3'
    name: Rollback Trigger Analysis
    description: |
      Analyze automated rollback triggers and criteria.
    duration_estimate: 30 min
    commands:
    - purpose: Find health check configurations
      command: |
        grep -rn "health\|readiness\|liveness\|probe" \
          --include="*.yaml" --include="*.json" . 2>/dev/null | head -30
    - purpose: Find automatic rollback configuration
      command: |
        grep -rn "maxUnavailable\|failureThreshold\|rollback" \
          --include="*.yaml" . 2>/dev/null | head -20
    expected_findings:
    - Health check coverage
    - Automatic rollback triggers
    - Failure thresholds
  - id: '4'
    name: Rollback Testing Evidence
    description: |
      Look for evidence of rollback testing and validation.
    duration_estimate: 30 min
    commands:
    - purpose: Find rollback test documentation
      command: |
        grep -rl "rollback.*test\|test.*rollback\|DR.*test" \
          --include="*.md" . 2>/dev/null | head -10
    - purpose: Check for rollback in CI/CD
      command: |
        grep -rn "rollback" --include="*.yaml" \
          .github/workflows/ .gitlab-ci.yml 2>/dev/null | head -20
    expected_findings:
    - Rollback test documentation
    - CI/CD rollback integration
    - Testing frequency
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Rollback Capability Assessment
    - Procedure Documentation Review
    - Recommendations
  - type: rollback_matrix
    format: table
    description: Rollback capabilities by configuration type
  confidence_guidance:
    high: Rollback procedures documented and tested
    medium: Rollback capability exists but testing unverified
    low: Rollback status requires manual verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: itil-remediation
      priority: required
    - source_id: 12factor-disposability
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Rollback assessment requires thorough review
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1
closeout_checklist:
- id: roll-001
  item: Rollback capability exists for all config types
  level: CRITICAL
  verification: |
    find . -name "*rollback*" -not -path "*/node_modules/*" 2>/dev/null | \
      wc -l | xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: roll-002
  item: Rollback procedures documented
  level: BLOCKING
  verification: manual
  verification_notes: Verify rollback runbooks exist and are current
  expected: Confirmed by reviewer
- id: roll-003
  item: Rollback tested regularly
  level: WARNING
  verification: manual
  verification_notes: Verify rollback testing schedule and results
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: ITIL
    controls:
    - Change Remediation
  - framework: 12-Factor App
    controls:
    - Factor IX
  - framework: ISO 27001
    controls:
    - A.8.32
relationships:
  commonly_combined:
  - configuration-management.configuration-control.change-control
  - configuration-management.release-configuration.rollback-config
  - configuration-management.configuration-identification.config-baseline
