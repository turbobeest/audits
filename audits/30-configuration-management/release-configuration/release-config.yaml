# ============================================================
# AUDIT: Release Configuration
# Category: 30 - Configuration Management
# Subcategory: release-configuration
# ============================================================
# Management of configuration settings specific to software
# releases and deployments.
# ============================================================

audit:
  id: "configuration-management.release-configuration.release-config"
  name: "Release Configuration Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "configuration-management"
  category_number: 30
  subcategory: "release-configuration"

  tier: "expert"
  estimated_duration: "3-4 hours"  # median: 3h
  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "infrastructure"
  default_profiles: ["full", "production"]

description:
  what: |
    This audit examines how release configurations are managed across the
    deployment pipeline. It evaluates release versioning, environment-specific
    configuration handling, release metadata, and configuration promotion
    practices through deployment stages.

  why_it_matters: |
    Release configuration errors are a leading cause of deployment failures.
    Misconfigured releases can cause outages, data corruption, or security
    vulnerabilities. Proper release configuration management ensures
    consistent, repeatable, and safe deployments.

  when_to_run:
    - "When establishing release pipelines"
    - "After deployment failures"
    - "During CI/CD improvements"
    - "For compliance assessments"

prerequisites:
  access_required:
    - "CI/CD pipeline configurations"
    - "Release management systems"
    - "Deployment manifests"
    - "Release artifact repositories"
  knowledge_required:
    - "CI/CD concepts"
    - "Release management practices"
    - "12-factor app principles"
    - "GitOps practices"

discovery:
  code_patterns:
    - pattern: "(release[-_]config|deployment[-_]config|version[-_]config)"
      type: "regex"
      scope: "config"
      purpose: "Detect release configuration files"
    - pattern: "(Chart\\.yaml|values\\.yaml|kustomization\\.yaml)"
      type: "regex"
      scope: "config"
      purpose: "Detect Kubernetes release configs"

  file_patterns:
    - glob: "**/release/**"
      purpose: "Release configuration directories"
    - glob: "**/deploy/**"
      purpose: "Deployment configurations"
    - glob: "**/*.release.*"
      purpose: "Release-specific files"
    - glob: "**/helm/**"
      purpose: "Helm charts"

knowledge_sources:
  frameworks:
    - name: "12-Factor App"
      relevance: "Factor V - Build, release, run"
    - name: "ITIL"
      relevance: "Release and Deployment Management"
    - name: "CMMI"
      relevance: "Configuration Management SP 1.3"

signals:
  critical:
    - id: "RLCF-CRIT-001"
      signal: "Release configurations contain hardcoded secrets"
      evidence_indicators:
        - "Passwords in release files"
        - "API keys in deployment configs"
        - "Secrets not externalized"
      explanation: "Secrets in release configs expose credentials and violate security."
      remediation: "Use secret management systems for all sensitive values."

    - id: "RLCF-CRIT-002"
      signal: "No release versioning scheme"
      evidence_indicators:
        - "Releases not versioned"
        - "Cannot identify what's deployed"
        - "No traceability to source"
      explanation: "Without versioning, deployments cannot be tracked or reproduced."
      remediation: "Implement semantic versioning for all releases."

  high:
    - id: "RLCF-HIGH-001"
      signal: "Release configs not version controlled"
      evidence_indicators:
        - "Configs outside git"
        - "Manual config changes"
        - "No config history"
      explanation: "Unversioned configs cannot be audited or rolled back."
      remediation: "Store all release configurations in version control."

    - id: "RLCF-HIGH-002"
      signal: "Environment configs mixed with release configs"
      evidence_indicators:
        - "Environment-specific values in release"
        - "No separation of concerns"
        - "Release varies by environment"
      explanation: "Mixing concerns prevents consistent deployments."
      remediation: "Separate release artifacts from environment configuration."

  medium:
    - id: "RLCF-MED-001"
      signal: "Release configs not validated before deployment"
      evidence_indicators:
        - "No config validation step"
        - "Schema not enforced"
        - "Invalid configs reach production"
      explanation: "Unvalidated configs cause deployment failures."
      remediation: "Implement config validation in release pipeline."

    - id: "RLCF-MED-002"
      signal: "No release configuration documentation"
      evidence_indicators:
        - "Config options undocumented"
        - "Default values unclear"
        - "No configuration guide"
      explanation: "Undocumented configs lead to misconfiguration."
      remediation: "Document all release configuration options."

  low:
    - id: "RLCF-LOW-001"
      signal: "Release config naming inconsistent"
      evidence_indicators:
        - "Varied naming conventions"
        - "Unclear file purposes"
        - "No standard structure"
      explanation: "Inconsistent naming creates confusion."
      remediation: "Establish naming standards for release configs."

  positive:
    - id: "RLCF-POS-001"
      signal: "Release configs follow GitOps practices"
      evidence_indicators:
        - "Declarative configurations"
        - "Git as source of truth"
        - "Automated sync to environments"
      explanation: "GitOps provides auditability and reproducibility."

procedure:
  steps:
    - id: "1"
      name: "Release Config Discovery"
      description: "Identify all release configuration files."
      commands:
        - purpose: "Find release-related configurations"
          command: |
            find . -type f \( -name "*release*" -o -name "*deploy*" \) \
              \( -name "*.yaml" -o -name "*.yml" -o -name "*.json" \) 2>/dev/null | head -30
        - purpose: "Find Helm charts"
          command: |
            find . -name "Chart.yaml" -o -name "values*.yaml" 2>/dev/null | head -20

    - id: "2"
      name: "Version Control Assessment"
      description: "Verify release configs are version controlled."
      commands:
        - purpose: "Check git status of release configs"
          command: |
            git ls-files --others --exclude-standard "*release*" "*deploy*" 2>/dev/null | head -20
        - purpose: "Review release config history"
          command: |
            git log --oneline --all -- "**/release/**" "**/deploy/**" 2>/dev/null | head -20

    - id: "3"
      name: "Secret Detection"
      description: "Check for secrets in release configurations."
      commands:
        - purpose: "Scan for potential secrets"
          command: |
            grep -rn "password\|secret\|api[-_]key\|token" \
              --include="*release*" --include="*deploy*" . 2>/dev/null | head -20

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
    - type: "summary"
      format: "prose"
    - type: "release_config_inventory"
      format: "table"
      description: "Inventory of release configuration files"

profiles:
  membership:
    full: {included: true, priority: 1}
    quick: {included: true, priority: 2}
    production: {included: true, priority: 1}

governance:
  applicable_to:
    archetypes: ["all"]
  compliance_frameworks:
    - framework: "SOC 2"
      controls: ["CC8.1"]
    - framework: "ISO 27001"
      controls: ["A.12.1.2"]

relationships:
  related_audits:
    - id: "configuration-management.configuration-control.version-control"
      relationship: "depends_on"
    - id: "configuration-management.secret-management.secret-detection"
      relationship: "complements"
