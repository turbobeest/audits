audit:
  id: configuration-management.configuration-identification.config-discovery
  name: Configuration Discovery Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: configuration-management
  category_number: 30
  subcategory: configuration-identification
  tier: phd
  estimated_duration: 3-4 hours  # median: 3h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: infrastructure
  default_profiles:
  - full
  - production
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines the systematic identification and cataloging of all
    configuration items (CIs) across the software stack. It evaluates:
    - Completeness of configuration item inventory
    - Discovery mechanisms for identifying new configurations
    - Classification of configuration types (application, infrastructure, data)
    - Relationships between configuration items
    - Configuration item attributes and metadata
    - Automated vs manual discovery processes
    - Coverage across all environments and systems
  why_it_matters: |
    Comprehensive configuration discovery is foundational to configuration management:
    - CMMI Configuration Management (CM) requires identification of configuration
      items to be placed under configuration management
    - ITIL Configuration Management Database (CMDB) requires complete CI inventory
    - 12-factor app Factor III mandates storing config in the environment, making
      discovery essential for understanding system state
    - Without complete discovery, configuration drift goes undetected
    - Incident response requires knowing what configurations exist
    - Change impact analysis depends on understanding all affected CIs
    - Compliance audits require demonstrating configuration awareness
  when_to_run:
  - Initial configuration management implementation
  - After infrastructure changes or migrations
  - During compliance audits (SOC 2, ISO 27001)
  - When onboarding new systems or services
  - Quarterly configuration review cycles
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code with configuration files
  - type: infrastructure_code
    description: Infrastructure as Code definitions (Terraform, CloudFormation)
  - type: documentation
    description: Architecture and deployment documentation
  access_requirements:
  - Read access to all source code repositories
  - Access to infrastructure management consoles
  - Access to container registries and orchestration platforms
  - Read access to CI/CD pipeline configurations
discovery:
  code_patterns:
  - pattern: \.(env|config|cfg|conf|ini|properties|yaml|yml|json|toml|xml)$
    type: file_extension
    scope: config
    purpose: Identify configuration file types
  - pattern: (config|configuration|settings|options|preferences)\.(js|ts|py|rb|go)
    type: regex
    scope: source
    purpose: Detect configuration modules in code
  - pattern: os\.environ|process\.env|ENV\[|getenv|environment
    type: regex
    scope: source
    purpose: Detect environment variable access
  - pattern: (resource|module|provider)\s+['"]\w+
    type: regex
    scope: config
    purpose: Detect Terraform resources
  - pattern: Type:\s*AWS::|AWSTemplateFormatVersion
    type: regex
    scope: config
    purpose: Detect CloudFormation resources
  - pattern: apiVersion:|kind:\s*(Deployment|Service|ConfigMap|Secret)
    type: regex
    scope: config
    purpose: Detect Kubernetes resources
  - pattern: '@(Configuration|ConfigurationProperties|Value)'
    type: regex
    scope: source
    purpose: Detect Spring configuration annotations
  - pattern: app\.config|AppConfiguration|IConfiguration
    type: regex
    scope: source
    purpose: Detect .NET configuration patterns
  file_patterns:
  - glob: '**/*.{env,config,cfg,conf,ini,properties}'
    purpose: Traditional configuration files
  - glob: '**/config/**/*.{yaml,yml,json,toml}'
    purpose: Configuration directories
  - glob: '**/terraform/**/*.tf'
    purpose: Terraform configurations
  - glob: '**/k8s/**/*.yaml'
    purpose: Kubernetes manifests
  - glob: '**/docker-compose*.{yaml,yml}'
    purpose: Docker Compose configurations
  - glob: '**/.env*'
    purpose: Environment variable files
  - glob: '**/application*.{yaml,yml,properties}'
    purpose: Spring Boot configurations
  - glob: '**/appsettings*.json'
    purpose: .NET configurations
knowledge_sources:
  specifications:
  - id: cmmi-cm
    name: CMMI Configuration Management Process Area
    url: https://cmmiinstitute.com/cmmi
    offline_cache: true
    priority: required
  - id: itil-cmdb
    name: ITIL Configuration Management Database
    url: https://www.axelos.com/best-practice-solutions/itil
    offline_cache: true
    priority: required
  - id: 12factor-config
    name: '12-Factor App: Factor III - Config'
    url: https://12factor.net/config
    offline_cache: true
    priority: required
  guides:
  - id: terraform-config
    name: Terraform Configuration Language
    url: https://developer.hashicorp.com/terraform/language
    offline_cache: true
  - id: k8s-configmaps
    name: Kubernetes ConfigMaps
    url: https://kubernetes.io/docs/concepts/configuration/configmap/
    offline_cache: true
tooling:
  static_analysis:
  - tool: config-scanner
    purpose: Scan for configuration files
    offline_capable: true
  - tool: terraform-docs
    purpose: Document Terraform configurations
    offline_capable: true
  infrastructure_tools:
  - tool: aws-config
    purpose: AWS resource configuration tracking
    command: aws configservice describe-configuration-recorders
  - tool: kubectl
    purpose: Kubernetes configuration discovery
    command: kubectl get configmaps,secrets --all-namespaces
  scripts:
  - id: config-discovery-scan
    language: bash
    purpose: Comprehensive configuration file discovery
    source: inline
    code: |
      #!/bin/bash
      echo "=== Configuration Discovery Scan ==="
      echo ""
      echo "=== Configuration Files ==="
      find . -type f \( -name "*.env*" -o -name "*.config" -o -name "*.cfg" \
        -o -name "*.conf" -o -name "*.ini" -o -name "*.properties" \
        -o -name "*.yaml" -o -name "*.yml" -o -name "*.json" \
        -o -name "*.toml" \) 2>/dev/null | grep -v node_modules | grep -v vendor | head -100
      echo ""
      echo "=== Infrastructure Code ==="
      find . -type f \( -name "*.tf" -o -name "*cloudformation*" \
        -o -name "docker-compose*" \) 2>/dev/null | head -50
      echo ""
      echo "=== Environment Variables in Code ==="
      grep -rn "process\.env\|os\.environ\|getenv" --include="*.js" \
        --include="*.ts" --include="*.py" --include="*.go" . 2>/dev/null | head -50
signals:
  critical:
  - id: CDIS-CRIT-001
    signal: No configuration inventory or CMDB exists
    evidence_indicators:
    - No documented list of configuration items
    - No CMDB or configuration management tool
    - Ad-hoc configuration discovery only
    explanation: |
      CMMI and ITIL require maintaining a configuration item inventory.
      Without a CI inventory, organizations cannot track changes, assess
      impact, or ensure configuration consistency. This fundamentally
      undermines configuration management capability.
    remediation: |
      - Establish a Configuration Management Database (CMDB)
      - Document all configuration items with attributes
      - Implement automated CI discovery mechanisms
      - Define CI classification taxonomy
    cwe: CWE-1059
  - id: CDIS-CRIT-002
    signal: Critical infrastructure configurations not inventoried
    evidence_indicators:
    - Production configurations not tracked
    - Security configurations undocumented
    - Network configurations not in inventory
    explanation: |
      Critical infrastructure configurations must be explicitly identified
      and tracked. Missing critical CIs from inventory prevents proper
      change control, security monitoring, and incident response.
    remediation: |
      - Audit all production infrastructure for CIs
      - Add security-relevant configurations to inventory
      - Implement discovery automation for infrastructure
      - Prioritize critical CI documentation
  high:
  - id: CDIS-HIGH-001
    signal: Configuration discovery is entirely manual
    evidence_indicators:
    - No automated scanning for configuration files
    - Manual inventory updates only
    - No integration with CI/CD for discovery
    explanation: |
      Manual configuration discovery cannot keep pace with modern
      development and deployment velocity. New configurations are
      missed, leading to incomplete visibility and unmanaged drift.
    remediation: |
      - Implement automated configuration scanning
      - Integrate discovery into CI/CD pipelines
      - Use infrastructure tools (AWS Config, Azure Policy)
      - Schedule regular automated inventory refreshes
  - id: CDIS-HIGH-002
    signal: Environment-specific configurations not distinguished
    evidence_indicators:
    - Same CI entry for dev/staging/production
    - No environment attribute on configuration items
    - Cannot differentiate config versions by environment
    explanation: |
      12-factor app principles require environment-specific configuration.
      Failing to distinguish configurations per environment prevents
      proper environment parity assessment and change impact analysis.
    remediation: |
      - Add environment attribute to all CIs
      - Create separate CI entries per environment
      - Implement environment-specific discovery scans
      - Track configuration differences between environments
  - id: CDIS-HIGH-003
    signal: Configuration relationships not mapped
    evidence_indicators:
    - No dependency relationships between CIs
    - Impact analysis requires manual investigation
    - Service-to-configuration mapping missing
    explanation: |
      ITIL CMDB requires relationship mapping between CIs. Without
      relationship information, change impact analysis is incomplete,
      and incident root cause analysis is impaired.
    remediation: |
      - Map dependencies between configuration items
      - Link configurations to services and applications
      - Document upstream/downstream relationships
      - Implement automated relationship discovery
  medium:
  - id: CDIS-MED-001
    signal: Configuration item attributes incomplete
    evidence_indicators:
    - CIs missing owner information
    - No last-modified dates on CIs
    - Missing classification or sensitivity
    explanation: |
      CI attributes enable effective configuration management. Missing
      attributes prevent ownership accountability, change tracking,
      and appropriate handling based on sensitivity.
    remediation: |
      - Define standard CI attribute schema
      - Populate missing attributes for existing CIs
      - Enforce attribute requirements for new CIs
      - Automate attribute population where possible
  - id: CDIS-MED-002
    signal: Temporary or deprecated configurations still in inventory
    evidence_indicators:
    - Stale configurations not marked deprecated
    - Temporary test configurations in inventory
    - No lifecycle status on configuration items
    explanation: |
      Inventory accuracy requires removing or deprecating obsolete CIs.
      Including stale configurations creates noise, complicates audits,
      and may lead to accidental use of deprecated settings.
    remediation: |
      - Add lifecycle status attribute to CIs
      - Implement regular inventory cleanup processes
      - Mark deprecated configurations clearly
      - Archive rather than delete for audit trail
  - id: CDIS-MED-003
    signal: Configuration discovery scope incomplete
    evidence_indicators:
    - Third-party service configurations not inventoried
    - SaaS configurations missing from CMDB
    - Client-side configurations not tracked
    explanation: |
      Modern applications depend on third-party services and client
      configurations. Incomplete discovery scope creates blind spots
      in configuration management coverage.
    remediation: |
      - Expand discovery to include third-party services
      - Document SaaS configuration dependencies
      - Include client-side configurations where applicable
      - Map external configuration dependencies
  low:
  - id: CDIS-LOW-001
    signal: Configuration naming conventions inconsistent
    evidence_indicators:
    - Inconsistent file naming across projects
    - No naming standard for configuration items
    - Ambiguous or unclear CI names
    explanation: |
      Consistent naming improves discoverability and reduces confusion.
      Inconsistent naming makes automated discovery less reliable and
      manual identification more error-prone.
    remediation: |
      - Define configuration naming standards
      - Implement naming validation in CI/CD
      - Refactor existing configurations to standard
      - Document naming conventions
  positive:
  - id: CDIS-POS-001
    signal: Comprehensive automated configuration discovery
    evidence_indicators:
    - Automated CI scanning implemented
    - Discovery integrated with CI/CD
    - Regular inventory refresh scheduled
  - id: CDIS-POS-002
    signal: Complete CMDB with relationship mapping
    evidence_indicators:
    - All CIs documented with attributes
    - CI relationships mapped
    - Environment-specific CIs distinguished
procedure:
  context:
    cognitive_mode: methodical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Configuration Inventory Assessment
    description: |
      Review existing configuration inventory or CMDB for completeness
      and accuracy.
    duration_estimate: 45 min
    commands:
    - purpose: Find all configuration files in codebase
      command: |
        find . -type f \( -name "*.env*" -o -name "*.config*" \
          -o -name "*.yaml" -o -name "*.yml" -o -name "*.json" \
          -o -name "*.properties" -o -name "*.ini" \) \
          -not -path "*/node_modules/*" -not -path "*/.git/*" 2>/dev/null | wc -l
    - purpose: List configuration file types
      command: |
        find . -type f -not -path "*/node_modules/*" -not -path "*/.git/*" \
          2>/dev/null | sed 's/.*\.//' | sort | uniq -c | sort -rn | head -30
    expected_findings:
    - Count of configuration files
    - Configuration file type distribution
    - Configuration locations identified
  - id: '2'
    name: Infrastructure Configuration Discovery
    description: |
      Identify infrastructure-as-code configurations and cloud resource
      configurations.
    duration_estimate: 45 min
    commands:
    - purpose: Find Terraform configurations
      command: |
        find . -name "*.tf" -type f 2>/dev/null | head -50
    - purpose: Find Kubernetes configurations
      command: |
        find . -name "*.yaml" -path "*/k8s/*" -o -name "*.yaml" \
          -exec grep -l "apiVersion:" {} \; 2>/dev/null | head -50
    - purpose: Find Docker configurations
      command: |
        find . \( -name "Dockerfile*" -o -name "docker-compose*" \) \
          -type f 2>/dev/null | head -30
    expected_findings:
    - Infrastructure code inventory
    - Container configurations
    - Orchestration configurations
  - id: '3'
    name: Application Configuration Discovery
    description: |
      Identify application-level configurations and environment variable
      usage patterns.
    duration_estimate: 30 min
    commands:
    - purpose: Find environment variable usage
      command: |
        grep -rn "process\.env\." --include="*.js" --include="*.ts" . 2>/dev/null | \
          sed 's/.*process\.env\.\([A-Z_]*\).*/\1/' | sort | uniq | head -50
    - purpose: Find configuration loading patterns
      command: |
        grep -rn "config\|Config\|CONF\|settings\|Settings" \
          --include="*.py" --include="*.js" --include="*.go" . 2>/dev/null | head -50
    expected_findings:
    - Environment variables used
    - Configuration loading patterns
    - Application settings files
  - id: '4'
    name: Configuration Relationship Mapping
    description: |
      Analyze relationships between configurations and dependent systems.
    duration_estimate: 30 min
    commands:
    - purpose: Find configuration imports/references
      command: |
        grep -rn "import.*config\|require.*config\|from.*config" \
          --include="*.js" --include="*.ts" --include="*.py" . 2>/dev/null | head -50
    - purpose: Find configuration dependencies
      command: |
        grep -rn "depends_on\|DependsOn\|requires" \
          --include="*.tf" --include="*.yaml" --include="*.json" . 2>/dev/null | head -30
    expected_findings:
    - Configuration dependencies identified
    - Service-to-configuration mappings
    - Configuration inheritance patterns
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Configuration Inventory Status
    - Discovery Coverage Analysis
    - Relationship Mapping Assessment
    - Recommendations
  - type: configuration_inventory
    format: table
    description: Complete list of discovered configuration items
  confidence_guidance:
    high: Configuration files directly identified and analyzed
    medium: Configuration patterns detected but not fully validated
    low: Potential configurations requiring manual verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: cmmi-cm
      priority: required
    - source_id: itil-cmdb
      priority: required
    - source_id: 12factor-config
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Discovery requires comprehensive scanning
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1
closeout_checklist:
- id: cdis-001
  item: Configuration inventory exists and is documented
  level: CRITICAL
  verification: |
    test -f "CMDB.yaml" -o -f "config-inventory.md" -o -d ".config-inventory" && \
      echo "PASS" || echo "FAIL"
  expected: PASS
- id: cdis-002
  item: All configuration file types identified
  level: BLOCKING
  verification: |
    find . -type f \( -name "*.env*" -o -name "*.config*" -o -name "*.yaml" \) \
      -not -path "*/node_modules/*" 2>/dev/null | wc -l | \
      xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: cdis-003
  item: Infrastructure configurations inventoried
  level: BLOCKING
  verification: manual
  verification_notes: Verify IaC files are included in configuration inventory
  expected: Confirmed by reviewer
- id: cdis-004
  item: Configuration relationships documented
  level: WARNING
  verification: manual
  verification_notes: Verify CI relationships are mapped in CMDB
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: CMMI
    controls:
    - CM SP 1.1
    - CM SP 1.2
  - framework: ITIL
    controls:
    - Configuration Management
    - CMDB
  - framework: ISO 27001
    controls:
    - A.8.9
    - A.8.10
  - framework: SOC 2
    controls:
    - CC6.1
    - CC7.1
relationships:
  commonly_combined:
  - configuration-management.configuration-control.change-control
  - configuration-management.configuration-verification.drift-detection
  - configuration-management.environment-management.environment-parity
