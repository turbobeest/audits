# ============================================================
# AUDIT: Feature Flag Governance
# Category: 30 - Configuration Management
# Subcategory: feature-flags
# ============================================================
# Governance policies and controls for feature flag management.
# ============================================================

audit:
  id: "configuration-management.feature-flags.flag-governance"
  name: "Feature Flag Governance Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "configuration-management"
  category_number: 30
  subcategory: "feature-flags"

  tier: "expert"
  estimated_duration: "2-3 hours"  # median: 2h
  completeness: "complete"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "medium"
  scope: "infrastructure"
  default_profiles: ["full", "production"]

description:
  what: |
    This audit examines governance policies and controls for feature
    flag management. It evaluates approval processes, access controls,
    audit logging, and change management for flags.

  why_it_matters: |
    Feature flags can enable/disable production functionality. Uncontrolled
    flag changes are effectively uncontrolled deployments. Governance ensures
    flags are managed with appropriate oversight.

  when_to_run:
    - "When implementing flag platforms"
    - "During compliance assessments"
    - "When flag incidents occur"

discovery:
  code_patterns:
    - pattern: "(flag[-_]admin|flag[-_]approval|flag[-_]access)"
      type: "regex"
      scope: "config"
      purpose: "Detect flag governance configuration"

  file_patterns:
    - glob: "**/*flag*policy*"
      purpose: "Flag policies"

signals:
  high:
    - id: "FGOV-HIGH-001"
      signal: "No access control for flag changes"
      evidence_indicators:
        - "Anyone can change flags"
        - "No RBAC for flags"
        - "Production flags widely accessible"
      explanation: "Uncontrolled access enables unauthorized changes."
      remediation: "Implement RBAC for flag management."

    - id: "FGOV-HIGH-002"
      signal: "No audit logging for flag changes"
      evidence_indicators:
        - "Changes not logged"
        - "Cannot track who changed flags"
        - "No audit trail"
      explanation: "Without logging, flag changes cannot be investigated."
      remediation: "Enable comprehensive flag change logging."

  medium:
    - id: "FGOV-MED-001"
      signal: "No approval for production flag changes"
      evidence_indicators:
        - "Self-service production changes"
        - "No approval workflow"
        - "No review process"
      explanation: "Production flag changes should require approval."
      remediation: "Implement approval workflow for production flags."

    - id: "FGOV-MED-002"
      signal: "No flag change notification"
      evidence_indicators:
        - "Changes not communicated"
        - "Teams unaware of flag changes"
        - "No alerting"
      explanation: "Teams should be notified of flag changes."
      remediation: "Configure notifications for flag changes."

  low:
    - id: "FGOV-LOW-001"
      signal: "Flag governance not documented"
      evidence_indicators:
        - "No flag policy document"
        - "Processes informal"
        - "No written guidelines"
      explanation: "Documented governance enables consistent application."
      remediation: "Document flag governance policies."

procedure:
  steps:
    - id: "1"
      name: "Governance Assessment"
      description: "Assess feature flag governance."
      commands:
        - purpose: "Find flag governance documentation"
          command: |
            find . -name "*flag*policy*" -o -name "*flag*governance*" 2>/dev/null | head -10
        - purpose: "Check for RBAC in flag platform"
          command: |
            grep -rn "role\|permission\|access" --include="*flag*" . 2>/dev/null | head -20

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
    - type: "summary"
      format: "prose"

profiles:
  membership:
    full: {included: true, priority: 2}
    production: {included: true, priority: 2}

governance:
  applicable_to:
    archetypes: ["all"]
  compliance_frameworks:
    - framework: "SOC 2"
      controls: ["CC8.1"]
