audit:
  id: configuration-management.configuration-verification.config-validation
  name: Configuration Validation Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: configuration-management
  category_number: 30
  subcategory: configuration-verification
  tier: phd
  estimated_duration: 2-3 hours  # median: 2h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: full
  severity: high
  scope: codebase
  default_profiles:
  - full
  - production
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines the validation mechanisms for configuration files
    and values. It evaluates:
    - Schema validation for configuration files
    - Value range and constraint validation
    - Type checking for configuration values
    - Required field validation
    - Cross-reference validation
    - CI/CD integration of validation
    - Pre-deployment validation gates
  why_it_matters: |
    Configuration validation prevents deployment failures:
    - Invalid configurations cause runtime errors and outages
    - Early validation catches errors before deployment
    - Schema validation ensures structural correctness
    - Constraint validation prevents out-of-range values
    - 12-factor app requires explicit and validated config
    - Validation reduces configuration-related incidents
    - Automated validation scales with development velocity
  when_to_run:
  - When implementing configuration management
  - After configuration-related incidents
  - When adding new configuration types
  - During CI/CD pipeline improvements
  - Regular validation coverage reviews
prerequisites:
  required_artifacts:
  - type: configuration_files
    description: Configuration files to validate
  - type: schemas
    description: JSON Schema or equivalent definitions
  access_requirements:
  - Read access to configuration repositories
  - Access to validation tool configurations
discovery:
  code_patterns:
  - pattern: (validate|schema|lint)[-_](config|yaml|json)
    type: regex
    scope: config
    purpose: Detect validation configurations
  - pattern: (\$schema|jsonschema|ajv|yup|zod|joi)
    type: regex
    scope: source
    purpose: Detect schema validation libraries
  - pattern: (yamllint|jsonlint|cfn-lint|tflint)
    type: regex
    scope: config
    purpose: Detect linting tools
  file_patterns:
  - glob: '**/*.schema.json'
    purpose: JSON Schema files
  - glob: '**/.yamllint*'
    purpose: YAML lint configuration
  - glob: '**/.tflint*'
    purpose: Terraform lint configuration
  - glob: '**/schemas/**'
    purpose: Schema directories
knowledge_sources:
  specifications:
  - id: json-schema
    name: JSON Schema
    url: https://json-schema.org/
    offline_cache: true
    priority: required
  guides:
  - id: ajv
    name: AJV JSON Schema Validator
    url: https://ajv.js.org/
    offline_cache: true
  - id: yamllint
    name: yamllint Documentation
    url: https://yamllint.readthedocs.io/
    offline_cache: true
tooling:
  static_analysis:
  - tool: ajv
    purpose: JSON Schema validation
    offline_capable: true
  - tool: yamllint
    purpose: YAML linting
    offline_capable: true
  - tool: tflint
    purpose: Terraform linting
    offline_capable: true
  - tool: cfn-lint
    purpose: CloudFormation linting
    offline_capable: true
  scripts:
  - id: validation-audit
    language: bash
    purpose: Audit configuration validation
    source: inline
    code: |
      #!/bin/bash
      echo "=== Configuration Validation Audit ==="
      echo ""
      echo "=== Schema Files ==="
      find . -name "*.schema.json" -o -name "*schema*.yaml" \
        -not -path "*/node_modules/*" 2>/dev/null | head -20
      echo ""
      echo "=== Lint Configurations ==="
      find . -name ".yamllint*" -o -name ".tflint*" -o -name "*.eslintrc*" \
        -not -path "*/node_modules/*" 2>/dev/null | head -20
      echo ""
      echo "=== Validation in CI/CD ==="
      grep -rn "lint\|validate\|schema" \
        --include="*.yaml" .github/workflows/ 2>/dev/null | head -30
signals:
  critical:
  - id: CVAL-CRIT-001
    signal: No configuration validation
    evidence_indicators:
    - No schema validation
    - No linting for config files
    - Configs deployed without validation
    explanation: |
      Unvalidated configurations may contain errors that cause
      runtime failures. Validation catches errors before they
      reach production.
    remediation: |
      - Implement schema validation
      - Add linting for all config types
      - Integrate validation in CI/CD
      - Block deployment on validation failure
    cwe: CWE-20
  - id: CVAL-CRIT-002
    signal: Validation bypass possible
    evidence_indicators:
    - Can deploy without passing validation
    - Validation not enforced
    - Skip flags available
    explanation: |
      Bypassable validation provides false confidence.
      Validation must be mandatory for all deployments
      to ensure effectiveness.
    remediation: |
      - Enforce validation in pipeline
      - Remove bypass options
      - Require validation for all changes
      - Audit bypass usage
  high:
  - id: CVAL-HIGH-001
    signal: No schema defined for configurations
    evidence_indicators:
    - No JSON Schema files
    - Structure validation missing
    - Free-form configuration
    explanation: |
      Schema validation ensures structural correctness.
      Without schemas, invalid structure can cause
      parsing failures or unexpected behavior.
    remediation: |
      - Define schemas for all config types
      - Use JSON Schema or equivalent
      - Validate against schemas
      - Keep schemas updated
  - id: CVAL-HIGH-002
    signal: Value constraints not validated
    evidence_indicators:
    - No range checking
    - Invalid enum values possible
    - Type mismatches not caught
    explanation: |
      Value constraints prevent misconfiguration.
      Without constraint validation, invalid values
      may cause runtime issues.
    remediation: |
      - Define value constraints in schemas
      - Validate ranges and enums
      - Type-check configuration values
      - Document valid values
  - id: CVAL-HIGH-003
    signal: Validation not in CI/CD
    evidence_indicators:
    - Local validation only
    - No pipeline validation step
    - CI passes without validation
    explanation: |
      CI/CD validation ensures consistent enforcement.
      Local-only validation depends on developer
      discipline and may be skipped.
    remediation: |
      - Add validation to CI/CD pipeline
      - Fail builds on validation errors
      - Run same validation in CI as locally
      - Report validation results
  medium:
  - id: CVAL-MED-001
    signal: Cross-reference validation missing
    evidence_indicators:
    - References to missing configs
    - Broken links between configs
    - Dangling references not detected
    explanation: |
      Cross-reference validation catches dependency issues.
      Without it, configurations may reference
      non-existent resources.
    remediation: |
      - Implement cross-reference validation
      - Validate references exist
      - Check dependency availability
      - Report broken references
  - id: CVAL-MED-002
    signal: Validation error messages unclear
    evidence_indicators:
    - Generic error messages
    - Cannot identify problem location
    - Debugging validation failures difficult
    explanation: |
      Clear error messages speed resolution. Unclear
      errors require extensive debugging to identify
      the actual problem.
    remediation: |
      - Improve error message clarity
      - Include line numbers and paths
      - Explain what's wrong and expected
      - Provide fix suggestions
  - id: CVAL-MED-003
    signal: Not all config types validated
    evidence_indicators:
    - Some configs excluded
    - New config types unvalidated
    - Partial coverage
    explanation: |
      Comprehensive coverage prevents gaps. Unvalidated
      config types may contain errors.
    remediation: |
      - Extend validation to all config types
      - Add validation for new configs
      - Monitor validation coverage
      - Address gaps promptly
  low:
  - id: CVAL-LOW-001
    signal: Validation runs slowly
    evidence_indicators:
    - Long validation times
    - Developers skip validation
    - CI delayed by validation
    explanation: |
      Fast validation encourages use. Slow validation
      may be skipped or cause delays.
    remediation: |
      - Optimize validation performance
      - Cache validation results
      - Parallel validation where possible
      - Profile and improve slow validators
  positive:
  - id: CVAL-POS-001
    signal: Comprehensive schema validation
    evidence_indicators:
    - Schemas for all config types
    - CI/CD enforcement
    - Clear error messages
  - id: CVAL-POS-002
    signal: Multi-layer validation
    evidence_indicators:
    - Syntax, structure, and semantic validation
    - Cross-reference checking
    - Policy validation
procedure:
  context:
    cognitive_mode: methodical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Schema and Lint Configuration Review
    description: Review schema definitions and lint configurations.
    duration_estimate: 30 min
    commands:
    - purpose: Find schema files
      command: |
        find . -name "*.schema.json" -o -name "*schema*.yaml" \
          -not -path "*/node_modules/*" 2>/dev/null | head -30
    - purpose: Find lint configurations
      command: |
        find . \( -name ".yamllint*" -o -name ".tflint*" -o -name ".cfnlintrc*" \) \
          -not -path "*/node_modules/*" 2>/dev/null | head -20
    - purpose: Check for schema references
      command: |
        grep -rn "\$schema\|jsonschema" --include="*.yaml" --include="*.json" \
          . 2>/dev/null | head -30
  - id: '2'
    name: CI/CD Validation Integration
    description: Verify validation is integrated in CI/CD.
    duration_estimate: 30 min
    commands:
    - purpose: Find validation in CI workflows
      command: |
        grep -rn "lint\|validate\|schema\|check" \
          --include="*.yaml" .github/workflows/ 2>/dev/null | head -30
    - purpose: Check for pre-commit hooks
      command: |
        cat .pre-commit-config.yaml 2>/dev/null | head -50
  - id: '3'
    name: Validation Coverage Assessment
    description: Assess validation coverage across config types.
    duration_estimate: 30 min
    commands:
    - purpose: Count config files
      command: |
        find . -name "*.yaml" -o -name "*.json" -o -name "*.tf" \
          -not -path "*/node_modules/*" 2>/dev/null | wc -l
    - purpose: Count validated config types
      command: |
        find . -name "*.schema.json" 2>/dev/null | wc -l
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Validation Coverage
    - CI/CD Integration
    - Recommendations
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: json-schema
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 2
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1
closeout_checklist:
- id: cval-001
  item: Configuration validation implemented
  level: CRITICAL
  verification: |
    find . \( -name "*.schema.json" -o -name ".yamllint*" -o -name ".tflint*" \) \
      -not -path "*/node_modules/*" 2>/dev/null | wc -l | \
      xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: cval-002
  item: Validation enforced in CI/CD
  level: BLOCKING
  verification: manual
  verification_notes: Verify validation runs in CI and blocks on failure
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: 12-Factor App
    controls:
    - Factor III
  - framework: CMMI
    controls:
    - VER SP 2.1
relationships:
  commonly_combined:
  - configuration-management.configuration-identification.config-documentation
  - configuration-management.configuration-control.change-control
