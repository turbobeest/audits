# ============================================================
# AUDIT: Configuration Audit
# Category: 30 - Configuration Management
# Subcategory: configuration-verification
# ============================================================
# Formal auditing of configuration items to verify integrity
# and compliance with baselines per CMMI requirements.
# ============================================================

audit:
  id: "configuration-management.configuration-verification.config-audit"
  name: "Configuration Audit"
  version: "1.0.0"
  last_updated: "2025-01-22"
  status: "active"

  category: "configuration-management"
  category_number: 30
  subcategory: "configuration-verification"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "complete"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "infrastructure"

  default_profiles:
    - "full"
    - "production"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    This audit examines the formal configuration audit process verifying
    CI integrity and baseline conformance. It evaluates:
    - Functional Configuration Audit (FCA) processes
    - Physical Configuration Audit (PCA) processes
    - Baseline comparison procedures
    - Audit scheduling and frequency
    - Audit findings tracking and resolution
    - Audit documentation and reporting
    - Audit independence and objectivity

  why_it_matters: |
    Configuration audits verify system integrity:
    - CMMI CM SP 3.2 requires performing configuration audits
    - FCA verifies configurations meet functional requirements
    - PCA verifies configurations match documentation
    - Audits detect unauthorized changes and drift
    - Regular audits ensure ongoing compliance
    - Audit findings drive improvement actions
    - Independence ensures objective assessment

  when_to_run:
    - "Scheduled configuration audit cycles"
    - "Before major releases"
    - "After significant changes"
    - "During compliance assessments"
    - "Post-incident reviews"

prerequisites:
  required_artifacts:
    - type: "baselines"
      description: "Configuration baselines for comparison"
    - type: "requirements"
      description: "Functional requirements for verification"
    - type: "documentation"
      description: "Configuration documentation"

  access_requirements:
    - "Access to configuration baselines"
    - "Access to current configuration state"
    - "Access to requirements documentation"

discovery:
  code_patterns:
    - pattern: "(audit|fca|pca|verify|compare)[-_](config|baseline)"
      type: "regex"
      scope: "config"
      purpose: "Detect audit configurations"

  file_patterns:
    - glob: "**/audit/**"
      purpose: "Audit configurations"
    - glob: "**/baseline/**"
      purpose: "Baseline definitions"
    - glob: "**/*audit*.md"
      purpose: "Audit documentation"

knowledge_sources:
  specifications:
    - id: "cmmi-cm-sp32"
      name: "CMMI CM SP 3.2 - Perform Configuration Audits"
      url: "https://cmmiinstitute.com/cmmi"
      offline_cache: true
      priority: "required"

    - id: "ieee-828"
      name: "IEEE 828 - Configuration Management Standard"
      url: "https://standards.ieee.org/standard/828-2012.html"
      offline_cache: true
      priority: "recommended"

tooling:
  scripts:
    - id: "config-audit-check"
      language: "bash"
      purpose: "Check configuration audit capabilities"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Configuration Audit Assessment ==="
        echo ""
        echo "=== Baseline Files ==="
        find . -name "*baseline*" -not -path "*/node_modules/*" 2>/dev/null | head -20
        echo ""
        echo "=== Audit Documentation ==="
        find . -name "*audit*.md" -not -path "*/node_modules/*" 2>/dev/null | head -20
        echo ""
        echo "=== Recent Config Changes for Audit ==="
        git log --oneline --since="30 days ago" -- "*.yaml" "*.json" "*.tf" 2>/dev/null | wc -l

signals:
  critical:
    - id: "CAUD-CRIT-001"
      signal: "No configuration audits performed"
      evidence_indicators:
        - "No audit schedule"
        - "No baseline comparison"
        - "Never verified configurations"
      explanation: |
        CMMI requires configuration audits. Without audits,
        configuration integrity cannot be verified and
        issues accumulate undetected.
      remediation: |
        - Establish configuration audit program
        - Define audit schedule
        - Create audit procedures
        - Assign audit responsibility
      cwe: "CWE-1059"

  high:
    - id: "CAUD-HIGH-001"
      signal: "Audit findings not tracked or resolved"
      evidence_indicators:
        - "Findings without tracking"
        - "No resolution process"
        - "Recurring findings"
      explanation: |
        Unresolved findings defeat audit purpose. Findings
        must be tracked and resolved to improve
        configuration quality.
      remediation: |
        - Implement findings tracking
        - Assign resolution responsibility
        - Track to closure
        - Verify resolution effectiveness

    - id: "CAUD-HIGH-002"
      signal: "Audits lack independence"
      evidence_indicators:
        - "Self-audits only"
        - "No independent verification"
        - "Conflict of interest"
      explanation: |
        Independent audits provide objective assessment.
        Self-audits may miss issues or lack credibility.
      remediation: |
        - Engage independent auditors
        - Separate audit from operations
        - Rotate auditors
        - Document independence

  medium:
    - id: "CAUD-MED-001"
      signal: "Audit schedule irregular"
      evidence_indicators:
        - "Ad-hoc audits only"
        - "Long gaps between audits"
        - "No defined frequency"
      explanation: |
        Regular audits ensure ongoing compliance. Irregular
        audits may miss issues that develop between audits.
      remediation: |
        - Define audit schedule
        - Maintain regular cadence
        - Audit after major changes
        - Track audit completion

    - id: "CAUD-MED-002"
      signal: "Audit documentation incomplete"
      evidence_indicators:
        - "Audits not documented"
        - "Missing audit reports"
        - "No evidence retention"
      explanation: |
        Documentation supports audit credibility. Without
        documentation, audit results cannot be reviewed
        or used for compliance evidence.
      remediation: |
        - Document all audits
        - Create audit reports
        - Retain audit evidence
        - Archive per retention policy

  low:
    - id: "CAUD-LOW-001"
      signal: "Audit scope too narrow"
      evidence_indicators:
        - "Only some configs audited"
        - "Critical areas excluded"
        - "Partial coverage"
      explanation: |
        Comprehensive scope ensures complete coverage.
        Narrow scope may miss critical issues.
      remediation: |
        - Expand audit scope
        - Include all critical configs
        - Review scope regularly
        - Document exclusions

  positive:
    - id: "CAUD-POS-001"
      signal: "Comprehensive audit program"
      evidence_indicators:
        - "Regular audits scheduled"
        - "Findings tracked to closure"
        - "Independent verification"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Audit Program Assessment"
      description: "Assess configuration audit program existence."
      duration_estimate: "45 min"
      commands:
        - purpose: "Find audit documentation"
          command: |
            find . -name "*audit*" -not -path "*/node_modules/*" 2>/dev/null | head -30
        - purpose: "Find baseline definitions"
          command: |
            find . -name "*baseline*" -not -path "*/node_modules/*" 2>/dev/null | head -20

    - id: "2"
      name: "Baseline Comparison Capability"
      description: "Verify baseline comparison capabilities."
      duration_estimate: "45 min"
      commands:
        - purpose: "Check for tagged releases"
          command: |
            git tag -l --sort=-creatordate 2>/dev/null | head -20
        - purpose: "Calculate config changes since last tag"
          command: |
            LAST_TAG=$(git describe --tags --abbrev=0 2>/dev/null)
            if [ -n "$LAST_TAG" ]; then
              git diff --stat $LAST_TAG -- "*.yaml" "*.json" "*.tf" 2>/dev/null | tail -5
            fi

output:
  deliverables:
    - type: "finding_list"
      format: "structured"
    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Audit Program Assessment"
        - "Findings Analysis"
        - "Recommendations"

offline:
  capability: "full"
  cache_manifest:
    knowledge:
      - source_id: "cmmi-cm-sp32"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Configuration audit requires thorough review"
    full:
      included: true
      priority: 1
    production:
      included: true
      priority: 1

closeout_checklist:
  - id: "caud-001"
    item: "Configuration audit process exists"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verify audit schedule and procedures documented"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]
  compliance_frameworks:
    - framework: "CMMI"
      controls: ["CM SP 3.2"]
    - framework: "IEEE 828"
      controls: ["Section 4.3"]
    - framework: "ISO 27001"
      controls: ["A.8.34"]

relationships:
  commonly_combined:
    - "configuration-management.configuration-identification.config-baseline"
    - "configuration-management.configuration-verification.drift-detection"
