audit:
  id: cost-economics.financial-governance.spending-controls
  name: Spending Controls Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: cost-economics
  category_number: 31
  subcategory: financial-governance
  tier: expert
  estimated_duration: 3-5 hours  # median: 4h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: organizational
  default_profiles:
  - full
  - compliance
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines spending controls including preventive
    controls (limits, restrictions) and detective controls
    (monitoring, alerting). It evaluates the effectiveness of
    controls in preventing unplanned or unauthorized spending.
  why_it_matters: |
    Spending controls prevent runaway costs and unauthorized
    spending. Without controls, cloud costs can spiral quickly
    due to misconfigurations, crypto mining attacks, or simple
    mistakes. Effective controls catch issues before they become
    expensive problems.
  when_to_run:
  - Quarterly controls review
  - After spending incidents
  - During security audits
  - When implementing new services
prerequisites:
  required_artifacts:
  - type: control-documentation
    description: Documented spending controls
  - type: budget-configs
    description: Budget alert configurations
  - type: policy-configs
    description: SCPs and governance policies
  access_requirements:
  - Access to cloud governance policies
  - Access to budget configurations
  - Access to alert configurations
discovery:
  control_types:
  - type: Preventive
    examples:
    - Spending limits
    - Service restrictions
    - Instance type limits
    - Approval requirements
  - type: Detective
    examples:
    - Budget alerts
    - Anomaly detection
    - Usage monitoring
    - Cost reports
  control_layers:
  - layer: Account/subscription limits
  - layer: Service quotas
  - layer: Resource creation policies
  - layer: Budget thresholds
  file_patterns:
  - glob: '**/*.tf'
    purpose: Terraform files
  - glob: '**/cloudformation/**/*.yaml'
    purpose: CloudFormation templates
  - glob: '**/*cost*.yaml'
    purpose: Cost configuration files
  - glob: '**/*budget*.yaml'
    purpose: Budget configuration files
  - glob: '**/*tag*.yaml'
    purpose: Tagging policy files
  code_patterns:
  - pattern: tags\s*[=:]|cost_center|billing|budget
    type: regex
    scope: config
    purpose: Cost/billing references
  - pattern: reserved_instance|spot_instance|savings_plan
    type: regex
    scope: config
    purpose: Cost optimization patterns
knowledge_sources:
  specifications:
  - id: aws-cost-controls
    name: AWS Cost Controls
    url: https://docs.aws.amazon.com/cost-management/latest/userguide/
    offline_cache: true
    priority: required
  guides:
  - id: cloud-governance-controls
    name: Cloud Governance Controls
    url: https://www.finops.org/framework/
    offline_cache: true
tooling:
  control_tools:
  - tool: AWS Service Control Policies
    purpose: Preventive guardrails
  - tool: AWS Budgets
    purpose: Budget alerts and actions
  - tool: Azure Policy
    purpose: Resource restrictions
  - tool: GCP Organization Policies
    purpose: Hierarchical controls
signals:
  critical:
  - id: CTRL-CRIT-001
    signal: No spending controls in place
    evidence_pattern: No limits, alerts, or restrictions
    explanation: |
      Without any spending controls, costs are completely
      uncontrolled. A single misconfiguration or attack
      could result in massive unexpected charges.
    remediation: Implement basic spending controls immediately
  - id: CTRL-CRIT-002
    signal: Budget alerts not functioning
    evidence_pattern: Alerts configured but not triggering
    explanation: |
      Non-functioning alerts provide false confidence.
      If alerts are not working, issues go undetected.
    remediation: Test and fix alert mechanisms
  high:
  - id: CTRL-HIGH-001
    signal: No preventive controls, only detective
    evidence_pattern: Alerts but no limits
    explanation: |
      Detective controls only identify problems after they
      occur. Preventive controls stop issues before they
      create cost.
    remediation: Implement preventive controls
  - id: CTRL-HIGH-002
    signal: Controls not covering all accounts/subscriptions
    evidence_pattern: Partial control coverage
    explanation: |
      Incomplete coverage leaves gaps that can result in
      uncontrolled spending in uncovered areas.
    remediation: Extend controls to all accounts
  medium:
  - id: CTRL-MED-001
    signal: Alert thresholds too high to be actionable
    evidence_pattern: Alerts only at 100% of budget
    remediation: Add lower threshold alerts for early warning
  - id: CTRL-MED-002
    signal: No automated response to alerts
    evidence_pattern: Manual response only
    remediation: Consider automated actions for critical alerts
  low:
  - id: CTRL-LOW-001
    signal: Controls not documented
    evidence_pattern: Informal control knowledge
    remediation: Document all spending controls
  positive:
  - id: CTRL-POS-001
    signal: Layered preventive and detective controls
  - id: CTRL-POS-002
    signal: Automated responses to critical alerts
  - id: CTRL-POS-003
    signal: Regular control testing and validation
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory preventive controls
    description: |
      Catalog all preventive spending controls including
      limits, restrictions, and approval requirements.
    duration_estimate: 45 min
    commands:
    - purpose: List AWS service quotas
      command: aws service-quotas list-service-quotas --service-code ec2
    - purpose: List SCPs
      command: aws organizations list-policies --filter SERVICE_CONTROL_POLICY
    expected_findings:
    - Preventive control inventory
    - Coverage assessment
  - id: '2'
    name: Inventory detective controls
    description: |
      Catalog all detective controls including budgets,
      alerts, and monitoring.
    duration_estimate: 45 min
    commands:
    - purpose: List budgets
      command: |
        aws budgets describe-budgets \
          --account-id $(aws sts get-caller-identity --query Account --output text)
    expected_findings:
    - Detective control inventory
    - Alert configurations
  - id: '3'
    name: Test control effectiveness
    description: |
      Validate that controls function as expected through
      testing or evidence review.
    duration_estimate: 45 min
    expected_findings:
    - Control effectiveness
    - Gaps identified
  - id: '4'
    name: Assess coverage
    description: |
      Evaluate control coverage across all accounts,
      services, and spending types.
    duration_estimate: 30 min
    expected_findings:
    - Coverage analysis
    - Gap identification
  - id: '5'
    name: Review alert response
    description: |
      Examine processes for responding to spending alerts
      and their effectiveness.
    duration_estimate: 30 min
    expected_findings:
    - Response process assessment
    - Response time analysis
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Control Inventory
    - Effectiveness Assessment
    - Coverage Analysis
    - Recommendations
  - type: control_matrix
    format: table
    columns:
    - Control
    - Type
    - Coverage
    - Effectiveness
    - Status
  confidence_guidance:
    high: Control testing performed
    medium: Configuration review only
    low: Documentation review
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: cloud-governance-controls
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 2
      reduced_scope: High-level control review
    full:
      included: true
      priority: 1
    compliance:
      included: true
      priority: 1
closeout_checklist:
- id: ctrl-001
  item: Controls inventoried
  level: CRITICAL
  verification: manual
  expected: Inventory complete
- id: ctrl-002
  item: Control effectiveness validated
  level: BLOCKING
  verification: manual
  expected: Validation complete
- id: ctrl-003
  item: Gaps identified and addressed
  level: WARNING
  verification: manual
  expected: Gaps documented
governance:
  applicable_to:
    archetypes:
    - cloud-native
    - hybrid
    - enterprise
  compliance_frameworks:
  - framework: SOX
    controls:
    - IT General Controls
  - framework: COBIT
    controls:
    - Financial Controls
relationships:
  commonly_combined:
  - cost-economics.financial-governance.approval-workflows
  - cost-economics.cloud-cost-management.cost-governance-policies
  - cost-economics.cost-visibility.cost-anomaly-detection
