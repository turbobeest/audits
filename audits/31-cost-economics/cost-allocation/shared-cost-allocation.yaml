audit:
  id: cost-economics.cost-allocation.shared-cost-allocation
  name: Shared Cost Allocation Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: cost-economics
  category_number: 31
  subcategory: cost-allocation
  tier: expert
  estimated_duration: 4-6 hours  # median: 5h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: organizational
  default_profiles:
  - full
  - finops
  blocks_phase: false
  parallelizable: false
description:
  what: |
    This audit examines how shared costs (platforms, infrastructure,
    support functions) are allocated across consumers. It evaluates
    allocation methodology fairness, accuracy, and transparency for
    costs that cannot be directly attributed.
  why_it_matters: |
    Shared costs often represent 20-40% of IT spend and are the most
    contentious aspect of cost allocation. Unfair or opaque shared
    cost allocation creates disputes, gaming behavior, and undermines
    trust in chargeback. Fair allocation requires thoughtful methodology.
  when_to_run:
  - Annually or during methodology reviews
  - When shared cost disputes arise
  - Before implementing chargeback
  - During FinOps assessments
prerequisites:
  required_artifacts:
  - type: shared-cost-inventory
    description: Inventory of shared costs
  - type: allocation-methodology
    description: Current allocation methods
  - type: consumption-data
    description: Usage data for allocation basis
  access_requirements:
  - Access to shared cost data
  - Access to consumption metrics
  - Access to allocation methodology
  - Stakeholder access for fairness assessment
discovery:
  shared_cost_categories:
  - category: Platform services
    examples:
    - Kubernetes
    - Databases
    - Messaging
  - category: Infrastructure
    examples:
    - Networking
    - Security
    - Monitoring
  - category: Support functions
    examples:
    - Cloud operations
    - SRE
    - Architecture
  - category: Enterprise services
    examples:
    - Identity
    - SSO
    - Logging
  allocation_methods:
  - method: Even split
    fairness: Low
    complexity: Low
  - method: Headcount
    fairness: Low-Medium
    complexity: Low
  - method: Revenue
    fairness: Low-Medium
    complexity: Low
  - method: Consumption-based
    fairness: High
    complexity: High
  - method: Hybrid
    fairness: Medium-High
    complexity: Medium
  file_patterns:
  - glob: '**/*.tf'
    purpose: Terraform files
  - glob: '**/cloudformation/**/*.yaml'
    purpose: CloudFormation templates
  - glob: '**/*cost*.yaml'
    purpose: Cost configuration files
  - glob: '**/*budget*.yaml'
    purpose: Budget configuration files
  - glob: '**/*tag*.yaml'
    purpose: Tagging policy files
  code_patterns:
  - pattern: tags\s*[=:]|cost_center|billing|budget
    type: regex
    scope: config
    purpose: Cost/billing references
  - pattern: reserved_instance|spot_instance|savings_plan
    type: regex
    scope: config
    purpose: Cost optimization patterns
knowledge_sources:
  specifications:
  - id: finops-allocation
    name: FinOps - Cost Allocation
    url: https://www.finops.org/framework/capabilities/cost-allocation/
    offline_cache: true
    priority: required
  guides:
  - id: shared-cost-methodology
    name: Shared Cost Allocation Methodologies
    url: https://www.finops.org/stories/
    offline_cache: true
tooling:
  allocation_tools:
  - tool: Cost allocation engines
    purpose: Complex allocation logic
  - tool: FinOps platforms
    purpose: Automated allocation
  - tool: Custom models
    purpose: Organization-specific allocation
signals:
  critical:
  - id: SHRD-CRIT-001
    signal: Shared costs allocated arbitrarily
    evidence_pattern: No documented allocation methodology
    explanation: |
      Arbitrary allocation creates disputes and perceived
      unfairness. Recipients should understand and accept
      the allocation logic.
    remediation: Document and communicate allocation methodology
  - id: SHRD-CRIT-002
    signal: Significant shared cost not allocated
    evidence_threshold: unallocated_shared > 20% of IT spend
    explanation: |
      Large unallocated shared costs hide true consumption
      costs and prevent full accountability.
    remediation: Develop allocation method for unallocated costs
  high:
  - id: SHRD-HIGH-001
    signal: Allocation method creates perverse incentives
    evidence_pattern: Method encourages gaming or suboptimal behavior
    explanation: |
      If allocation method can be gamed or discourages
      efficient behavior, it undermines FinOps goals.
    remediation: Redesign allocation to align incentives
  - id: SHRD-HIGH-002
    signal: Shared cost allocation frequently disputed
    evidence_pattern: Regular disputes or escalations
    explanation: |
      Frequent disputes indicate perceived unfairness or
      lack of understanding, undermining chargeback
      effectiveness.
    remediation: Address fairness concerns and improve transparency
  medium:
  - id: SHRD-MED-001
    signal: Allocation methodology not regularly reviewed
    evidence_pattern: Static methodology without updates
    remediation: Implement annual methodology review
  - id: SHRD-MED-002
    signal: Consumption data for allocation imprecise
    evidence_pattern: Estimates used for allocation
    remediation: Improve consumption measurement
  low:
  - id: SHRD-LOW-001
    signal: No stakeholder input on methodology
    evidence_pattern: Top-down allocation without consultation
    remediation: Include stakeholders in methodology design
  positive:
  - id: SHRD-POS-001
    signal: Transparent, consumption-based allocation
  - id: SHRD-POS-002
    signal: Stakeholder acceptance of methodology
  - id: SHRD-POS-003
    signal: Regular review and refinement
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory shared costs
    description: |
      Catalog all shared costs and their current allocation
      methods.
    duration_estimate: 45 min
    expected_findings:
    - Shared cost inventory
    - Current allocation methods
  - id: '2'
    name: Assess methodology fairness
    description: |
      Evaluate whether allocation methods are fair and
      appropriate for each cost type.
    duration_estimate: 60 min
    expected_findings:
    - Fairness assessment
    - Method appropriateness
  - id: '3'
    name: Review consumption data
    description: |
      Evaluate the quality of data used for consumption-
      based allocation.
    duration_estimate: 45 min
    expected_findings:
    - Data quality assessment
    - Measurement gaps
  - id: '4'
    name: Analyze disputes and feedback
    description: |
      Review historical disputes and stakeholder feedback
      on shared cost allocation.
    duration_estimate: 45 min
    expected_findings:
    - Dispute analysis
    - Stakeholder concerns
  - id: '5'
    name: Evaluate incentive alignment
    description: |
      Assess whether allocation methods create proper
      incentives for efficient behavior.
    duration_estimate: 30 min
    expected_findings:
    - Incentive assessment
    - Behavioral implications
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Shared Cost Inventory
    - Methodology Assessment
    - Fairness Analysis
    - Recommendations
  - type: methodology_matrix
    format: table
    columns:
    - Cost Category
    - Current Method
    - Fairness
    - Recommended
  confidence_guidance:
    high: Complete data with stakeholder interviews
    medium: Data review without stakeholder input
    low: Documentation review only
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: finops-allocation
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires comprehensive review
    full:
      included: true
      priority: 1
    finops:
      included: true
      priority: 1
closeout_checklist:
- id: shrd-001
  item: Shared costs inventoried
  level: CRITICAL
  verification: manual
  expected: Inventory complete
- id: shrd-002
  item: Methodology fairness assessed
  level: BLOCKING
  verification: manual
  expected: Assessment complete
- id: shrd-003
  item: Recommendations provided
  level: WARNING
  verification: manual
  expected: Recommendations documented
governance:
  applicable_to:
    archetypes:
    - enterprise
    - platform
    - shared-services
  compliance_frameworks:
  - framework: FinOps Foundation
    controls:
    - Cost Allocation
relationships:
  commonly_combined:
  - cost-economics.cost-allocation.chargeback
  - cost-economics.cost-allocation.cost-centers
  - cost-economics.cost-visibility.cost-attribution
