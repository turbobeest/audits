audit:
  id: cost-economics.cost-allocation.environment-cost-tracking
  name: Environment Cost Tracking Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: cost-economics
  category_number: 31
  subcategory: cost-allocation
  tier: expert
  estimated_duration: 2-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: full
  severity: medium
  scope: infrastructure
  default_profiles:
  - full
  - finops
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines the ability to track costs by environment
    type (production, staging, development, test, etc.). It
    evaluates tagging, attribution, and analysis capabilities
    for environment-based cost optimization.
  why_it_matters: |
    Environment-level cost tracking reveals optimization opportunities.
    Non-production environments often consume 40-60% of cloud spend
    but are frequently over-provisioned. Understanding environment
    costs enables right-sizing and scheduled shutdown strategies.
  when_to_run:
  - Monthly environment cost review
  - During cost optimization initiatives
  - When implementing scheduling
  - During FinOps assessments
prerequisites:
  required_artifacts:
  - type: environment-tagging
    description: Environment tags on resources
  - type: cost-data
    description: Cost data with environment attribution
  - type: environment-inventory
    description: Defined environments
  access_requirements:
  - Access to resource tagging data
  - Access to cost attribution
  - Access to environment definitions
discovery:
  environment_types:
  - type: Production
    characteristics: 24/7 availability required
  - type: Staging/Pre-prod
    characteristics: Production-like testing
  - type: Development
    characteristics: Developer workspaces
  - type: Test/QA
    characteristics: Testing workloads
  - type: Sandbox
    characteristics: Experimentation
  cost_patterns:
  - pattern: Non-prod > 50% of prod
    concern: Potential over-provisioning
  - pattern: Dev running 24/7
    concern: Scheduling opportunity
  - pattern: Multiple test environments
    concern: Consolidation opportunity
  file_patterns:
  - glob: '**/*.tf'
    purpose: Terraform files
  - glob: '**/cloudformation/**/*.yaml'
    purpose: CloudFormation templates
  - glob: '**/*cost*.yaml'
    purpose: Cost configuration files
  - glob: '**/*budget*.yaml'
    purpose: Budget configuration files
  - glob: '**/*tag*.yaml'
    purpose: Tagging policy files
  code_patterns:
  - pattern: tags\s*[=:]|cost_center|billing|budget
    type: regex
    scope: config
    purpose: Cost/billing references
  - pattern: reserved_instance|spot_instance|savings_plan
    type: regex
    scope: config
    purpose: Cost optimization patterns
knowledge_sources:
  specifications:
  - id: finops-environment
    name: FinOps - Resource Metadata
    url: https://www.finops.org/framework/capabilities/resource-metadata/
    offline_cache: true
    priority: required
  guides:
  - id: environment-optimization
    name: Non-Production Cost Optimization
    url: https://www.finops.org/stories/
    offline_cache: true
tooling:
  tracking_tools:
  - tool: Cloud resource tagging
    purpose: Environment attribution
  - tool: Cost Explorer
    purpose: Environment cost analysis
  - tool: FinOps platforms
    purpose: Environment reporting
signals:
  critical:
  - id: ENV-CRIT-001
    signal: No environment cost tracking
    evidence_pattern: Cannot identify costs by environment
    explanation: |
      Without environment tracking, optimization opportunities
      are invisible. Non-production costs are often significant
      and addressable.
    remediation: Implement environment tagging and tracking
  high:
  - id: ENV-HIGH-001
    signal: Non-production costs exceed production
    evidence_threshold: non_prod_cost > prod_cost
    explanation: |
      When non-production exceeds production, significant
      optimization opportunity exists through right-sizing
      and scheduling.
    remediation: Investigate and optimize non-production costs
  - id: ENV-HIGH-002
    signal: Environment tagging incomplete
    evidence_threshold: env_tag_coverage < 80%
    explanation: |
      Incomplete environment tagging hides costs and prevents
      accurate analysis.
    remediation: Improve environment tag coverage
  medium:
  - id: ENV-MED-001
    signal: Dev/test resources not scheduled
    evidence_pattern: Non-prod running 24/7
    remediation: Implement scheduled shutdown for dev/test
  - id: ENV-MED-002
    signal: Multiple duplicate environments
    evidence_pattern: Similar environments not consolidated
    remediation: Consolidate redundant environments
  low:
  - id: ENV-LOW-001
    signal: No environment cost reporting
    evidence_pattern: Data available but not reported
    remediation: Create environment cost reports
  positive:
  - id: ENV-POS-001
    signal: Complete environment cost visibility
  - id: ENV-POS-002
    signal: Non-production optimized with scheduling
  - id: ENV-POS-003
    signal: Regular environment cost review
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Assess environment tagging
    description: |
      Evaluate environment tag coverage across cloud resources.
    duration_estimate: 30 min
    expected_findings:
    - Tag coverage
    - Gap identification
  - id: '2'
    name: Analyze environment costs
    description: |
      Break down costs by environment type to identify
      patterns and opportunities.
    duration_estimate: 45 min
    expected_findings:
    - Cost by environment
    - Cost ratios
  - id: '3'
    name: Identify optimization opportunities
    description: |
      Find opportunities for scheduling, right-sizing, and
      consolidation based on environment analysis.
    duration_estimate: 45 min
    expected_findings:
    - Optimization opportunities
    - Potential savings
  - id: '4'
    name: Review current optimization
    description: |
      Assess current optimization practices for non-production
      environments.
    duration_estimate: 30 min
    expected_findings:
    - Current practices
    - Gaps
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Environment Cost Analysis
    - Optimization Opportunities
    - Recommendations
  - type: cost_breakdown
    format: chart
    breakdown: cost by environment type
  confidence_guidance:
    high: Complete tagging with cost data
    medium: Partial tagging
    low: Limited visibility
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: finops-environment
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 1
      reduced_scope: Tag coverage check
    full:
      included: true
      priority: 1
    finops:
      included: true
      priority: 1
closeout_checklist:
- id: env-001
  item: Environment tagging assessed
  level: CRITICAL
  verification: automated
  expected: Coverage >= 90%
- id: env-002
  item: Cost breakdown created
  level: BLOCKING
  verification: automated
  expected: Breakdown available
- id: env-003
  item: Optimizations identified
  level: WARNING
  verification: manual
  expected: Opportunities documented
governance:
  applicable_to:
    archetypes:
    - cloud-native
    - hybrid
    - development-heavy
  compliance_frameworks:
  - framework: FinOps Foundation
    controls:
    - Resource Metadata
    - Usage Optimization
relationships:
  commonly_combined:
  - cost-economics.resource-efficiency.scheduled-scaling
  - cost-economics.cost-visibility.resource-tagging
  - cost-economics.cost-optimization.rightsizing
