audit:
  id: cost-economics.cost-visibility.cost-anomaly-detection
  name: Cost Anomaly Detection Audit
  version: 1.0.0
  last_updated: '2025-01-22'
  status: active
  category: cost-economics
  category_number: 31
  subcategory: cost-visibility
  tier: expert
  estimated_duration: 3-4 hours  # median: 3h
  completeness: requires_discovery
  requires_runtime: true
  destructive: false
execution:
  automatable: full
  severity: high
  scope: organizational
  default_profiles:
  - full
  - finops
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines the organization's capability to automatically
    detect and respond to cost anomalies. It evaluates alerting thresholds,
    detection algorithms, notification routing, and the effectiveness of
    the anomaly response process.
  why_it_matters: |
    Cloud costs can spike unexpectedly due to misconfigurations, runaway
    processes, security incidents, or legitimate traffic increases.
    Without effective anomaly detection, these spikes may go unnoticed
    until the monthly bill arrives, by which time significant waste may
    have occurred. Early detection enables rapid response and cost savings.
  when_to_run:
  - Monthly FinOps operational review
  - After implementing new services or architectures
  - Following significant cost anomalies
  - During cost governance assessments
prerequisites:
  required_artifacts:
  - type: alerting-config
    description: Access to cost alerting configurations
  - type: anomaly-history
    description: Historical anomaly detection records
  - type: response-process
    description: Documented anomaly response procedures
  access_requirements:
  - Access to AWS Cost Anomaly Detection or equivalent
  - Access to alerting configurations
  - Access to notification channels
  - Access to incident records
discovery:
  alerting_systems:
  - provider: AWS
    service: Cost Anomaly Detection
    purpose: ML-based anomaly detection
  - provider: Azure
    service: Cost Management Alerts
    purpose: Budget and anomaly alerts
  - provider: GCP
    service: Budget Alerts
    purpose: Threshold-based alerting
  - provider: Third-party
    examples:
    - CloudHealth
    - Spot.io
    - Kubecost
  file_patterns:
  - glob: '**/*.tf'
    purpose: Terraform files
  - glob: '**/cloudformation/**/*.yaml'
    purpose: CloudFormation templates
  - glob: '**/*cost*.yaml'
    purpose: Cost configuration files
  - glob: '**/*budget*.yaml'
    purpose: Budget configuration files
  - glob: '**/*tag*.yaml'
    purpose: Tagging policy files
  code_patterns:
  - pattern: tags\s*[=:]|cost_center|billing|budget
    type: regex
    scope: config
    purpose: Cost/billing references
  - pattern: reserved_instance|spot_instance|savings_plan
    type: regex
    scope: config
    purpose: Cost optimization patterns
knowledge_sources:
  specifications:
  - id: aws-anomaly-detection
    name: AWS Cost Anomaly Detection
    url: https://docs.aws.amazon.com/cost-management/latest/userguide/manage-ad.html
    offline_cache: true
    priority: required
  guides:
  - id: finops-anomaly-management
    name: FinOps - Managing Anomalies
    url: https://www.finops.org/framework/capabilities/anomaly-management/
    offline_cache: true
  - id: cost-spike-response
    name: Responding to Cloud Cost Spikes
    url: https://aws.amazon.com/blogs/aws-cost-management/
    offline_cache: true
tooling:
  detection_tools:
  - tool: AWS Cost Anomaly Detection
    purpose: ML-based anomaly identification
    command: aws ce get-anomalies --date-interval Start=2025-01-01,End=2025-01-22
  - tool: Azure Cost Alerts
    purpose: Rule-based anomaly alerting
  - tool: Custom monitoring
    purpose: Grafana/Datadog cost anomaly dashboards
signals:
  critical:
  - id: ANOM-CRIT-001
    signal: No cost anomaly detection configured
    evidence_pattern: No alerting for unexpected cost increases
    explanation: |
      Without anomaly detection, cost spikes may go unnoticed for
      days or weeks. A single misconfiguration can result in
      thousands of dollars of unexpected spend.
    remediation: Implement cost anomaly detection with appropriate thresholds
  - id: ANOM-CRIT-002
    signal: Anomaly alerts not routed to responsible parties
    evidence_pattern: Alerts sent to unused channels or ignored
    explanation: |
      Anomaly alerts that are not actioned provide no value. If
      alerts go to channels that are not monitored or to teams
      that cannot respond, anomalies continue to accrue costs.
    remediation: Configure alert routing to appropriate responders
  high:
  - id: ANOM-HIGH-001
    signal: High false positive rate causing alert fatigue
    evidence_threshold: false_positive_rate > 50%
    explanation: |
      When most anomaly alerts are false positives, teams stop
      responding to them. This alert fatigue means real anomalies
      may be ignored, defeating the purpose of detection.
    remediation: Tune detection thresholds to reduce false positives
  - id: ANOM-HIGH-002
    signal: Significant anomalies missed by detection
    evidence_pattern: Cost spikes discovered in retrospective analysis
    explanation: |
      If anomalies are only found through manual review or monthly
      billing analysis, the detection system is not effective. This
      delays response and increases waste.
    remediation: Review and adjust detection sensitivity and coverage
  medium:
  - id: ANOM-MED-001
    signal: Limited anomaly detection coverage
    evidence_pattern: Detection only on subset of accounts/services
    remediation: Expand detection coverage to all cost-bearing resources
  - id: ANOM-MED-002
    signal: No documented anomaly response process
    evidence_pattern: Ad-hoc response to detected anomalies
    remediation: Document and train on anomaly response procedures
  low:
  - id: ANOM-LOW-001
    signal: Anomaly root causes not documented
    evidence_pattern: No record of why anomalies occurred
    remediation: Implement anomaly post-mortem process
  positive:
  - id: ANOM-POS-001
    signal: Comprehensive anomaly detection with low false positive rate
  - id: ANOM-POS-002
    signal: Rapid anomaly response with documented playbooks
  - id: ANOM-POS-003
    signal: Anomaly learnings fed back into prevention
procedure:
  context:
    cognitive_mode: analytical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory anomaly detection systems
    description: |
      Catalog all anomaly detection mechanisms in use, including
      native cloud services and third-party tools.
    duration_estimate: 30 min
    commands:
    - purpose: List AWS anomaly monitors
      command: aws ce get-anomaly-monitors
    - purpose: Get recent anomalies
      command: |
        aws ce get-anomalies --date-interval \
          Start=$(date -d '30 days ago' +%Y-%m-%d),End=$(date +%Y-%m-%d)
    expected_findings:
    - Detection system inventory
    - Coverage assessment
  - id: '2'
    name: Evaluate detection configuration
    description: |
      Review detection thresholds, sensitivity settings, and
      the algorithms or rules used for anomaly identification.
    duration_estimate: 45 min
    expected_findings:
    - Threshold configuration
    - Sensitivity assessment
    - Algorithm evaluation
  - id: '3'
    name: Review alert routing
    description: |
      Verify that anomaly alerts are routed to appropriate
      responders through monitored channels.
    duration_estimate: 30 min
    expected_findings:
    - Alert routing configuration
    - Channel monitoring status
    - Escalation paths
  - id: '4'
    name: Analyze detection effectiveness
    description: |
      Review historical anomalies to assess detection accuracy,
      false positive rate, and missed anomalies.
    duration_estimate: 60 min
    expected_findings:
    - Detection accuracy metrics
    - False positive analysis
    - Missed anomaly identification
  - id: '5'
    name: Evaluate response process
    description: |
      Assess the process for responding to detected anomalies,
      including documentation, SLAs, and post-mortems.
    duration_estimate: 30 min
    expected_findings:
    - Response process documentation
    - Response time metrics
    - Post-mortem practices
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Detection System Assessment
    - Effectiveness Analysis
    - Response Process Review
    - Recommendations
  - type: metrics_dashboard
    metrics:
    - Detection coverage percentage
    - False positive rate
    - Mean time to detect
    - Mean time to respond
    - Anomaly cost impact
  confidence_guidance:
    high: Direct access to detection systems and historical data
    medium: Limited historical data or partial access
    low: Configuration review without operational data
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: finops-anomaly-management
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 2
      reduced_scope: Configuration review only
    full:
      included: true
      priority: 1
    finops:
      included: true
      priority: 1
closeout_checklist:
- id: anom-001
  item: Anomaly detection enabled for all cost-bearing accounts
  level: CRITICAL
  verification: automated
  expected: 100% coverage
- id: anom-002
  item: Alert routing verified and monitored
  level: BLOCKING
  verification: manual
  expected: Alerts reach appropriate responders
- id: anom-003
  item: False positive rate below 30%
  level: WARNING
  verification: automated
  expected: false_positive_rate < 0.30
- id: anom-004
  item: Response process documented
  level: WARNING
  verification: manual
  expected: Playbook available
governance:
  applicable_to:
    archetypes:
    - cloud-native
    - hybrid
    - enterprise
  compliance_frameworks:
  - framework: FinOps Foundation
    controls:
    - Anomaly Management
    - Real-time Decision Making
  - framework: AWS Well-Architected
    controls:
    - COST-06
relationships:
  commonly_combined:
  - cost-economics.cost-visibility.cost-transparency
  - cost-economics.financial-governance.budget-management
  - cost-economics.cloud-cost-management.finops-maturity
