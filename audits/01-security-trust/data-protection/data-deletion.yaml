audit:
  id: security-trust.data-protection.data-deletion
  name: Data Deletion / Right to Erasure Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: data-protection
  tier: phd
  estimated_duration: 3-4 hours  # median: 3h
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines the implementation of data deletion capabilities,
    with particular focus on GDPR Article 17 (Right to Erasure) compliance.
    It evaluates:
    - Data subject deletion request workflows
    - Secure deletion mechanisms across all data stores
    - Backup and archive data deletion
    - Third-party data processor notification
    - Deletion verification and completeness checking
    - Audit trails for deletion requests and execution
    - Exception handling (legal holds, legitimate interest)
  why_it_matters: |
    GDPR Article 17 grants individuals the right to have their personal data
    erased "without undue delay" when certain conditions apply. Organizations
    must respond to deletion requests within one month. Failure to implement
    proper deletion results in:
    - GDPR enforcement actions (fines up to 4% of global revenue)
    - CCPA violations for California residents
    - Reputational damage from publicized enforcement
    - Inability to honor data subject rights
    - Complications during regulatory investigations

    The Irish Data Protection Commission and other regulators have consistently
    enforced deletion rights, requiring organizations to demonstrate complete
    data erasure across all systems.
  when_to_run:
  - Initial GDPR compliance assessment
  - When implementing deletion request handling
  - During data protection impact assessments
  - After adding new data storage systems
  - When onboarding new data processors
prerequisites:
  required_artifacts:
  - type: source_code
    description: Source code including deletion workflows
  - type: data_inventory
    description: Complete inventory of data storage locations
  - type: processor_agreements
    description: Data processing agreements with third parties
  access_requirements:
  - Read access to all source code repositories
  - Access to data subject request handling procedures
  - Access to backup and archive configurations
  - Access to third-party integration documentation
discovery:
  code_patterns:
  - pattern: (delete_?user|erase_?data|gdpr_?delete|right_?to_?erasure)
    type: regex
    scope: source
    purpose: Detect GDPR deletion implementations
  - pattern: (deletion_?request|erasure_?request|dsar|data_?subject)
    type: regex
    scope: source
    purpose: Detect data subject request handling
  - pattern: (secure_?delete|shred|wipe|overwrite).*data
    type: regex
    scope: source
    purpose: Detect secure deletion mechanisms
  - pattern: (cascade|propagate|related).*delete
    type: regex
    scope: source
    purpose: Detect cascading deletion logic
  - pattern: (notify|inform).*(processor|third_?party|vendor).*delet
    type: regex
    scope: source
    purpose: Detect processor notification for deletion
  - pattern: (verify|confirm|check).*delet
    type: regex
    scope: source
    purpose: Detect deletion verification
  - pattern: (audit|log).*(delet|erasure|request)
    type: regex
    scope: source
    purpose: Detect deletion audit logging
  - pattern: (soft_?delete|is_?deleted|mark.*deleted)(?!.*(then|follow|eventually).*hard)
    type: regex
    scope: source
    purpose: Detect soft-delete only implementations
  file_patterns:
  - glob: '**/deletion/**/*.{py,js,ts,rb}'
    purpose: Deletion workflow implementations
  - glob: '**/gdpr/**/*.{py,js,ts,yaml}'
    purpose: GDPR compliance code
  - glob: '**/dsar/**/*'
    purpose: Data subject access request handling
  - glob: '**/privacy/**/*.{py,js,yaml}'
    purpose: Privacy-related implementations
  - glob: '**/*erasure*.{py,js,sql}'
    purpose: Erasure-specific code
knowledge_sources:
  specifications:
  - id: gdpr-article-17
    name: 'GDPR Article 17: Right to Erasure'
    url: https://gdpr-info.eu/art-17-gdpr/
    offline_cache: true
    priority: required
  - id: gdpr-article-19
    name: 'GDPR Article 19: Notification obligation regarding rectification or erasure'
    url: https://gdpr-info.eu/art-19-gdpr/
    offline_cache: true
    priority: required
  - id: ccpa-1798-105
    name: 'CCPA Section 1798.105: Consumer''s right to deletion'
    url: https://oag.ca.gov/privacy/ccpa
    offline_cache: true
    priority: required
  - id: ico-erasure-guidance
    name: 'ICO: Right to Erasure Guidance'
    url: https://ico.org.uk/for-organisations/uk-gdpr-guidance-and-resources/individual-rights/individual-rights/right-to-erasure/
    offline_cache: true
    priority: required
  guides:
  - id: nist-800-88
    name: 'NIST SP 800-88: Guidelines for Media Sanitization'
    url: https://csrc.nist.gov/publications/detail/sp/800-88/rev-1/final
    offline_cache: true
  - id: gdprhub-article-17
    name: 'GDPRhub: Article 17 Case Law and Analysis'
    url: https://gdprhub.eu/Article_17_GDPR
    offline_cache: true
tooling:
  static_analysis:
  - tool: semgrep
    purpose: Detect deletion-related patterns and gaps
    offline_capable: true
  - tool: custom-deletion-scanner
    purpose: Scan for deletion workflow completeness
    offline_capable: true
  infrastructure_tools:
  - tool: aws-s3
    purpose: S3 object deletion and lifecycle
    command: aws s3api list-object-versions --bucket $BUCKET --prefix $PREFIX
  - tool: postgres
    purpose: Database deletion verification
    command: SELECT count(*) FROM users WHERE deleted_at IS NOT NULL AND email IS NOT NULL
  scripts:
  - id: deletion-workflow-scanner
    language: bash
    purpose: Scan for deletion implementation patterns
    source: inline
    code: |
      #!/bin/bash
      echo "=== Deletion Workflow Scan ==="
      echo "Looking for deletion implementations..."
      grep -rniE "(delete_user|gdpr|erasure|dsar)" \
        --include="*.py" --include="*.js" --include="*.ts" \
        --include="*.rb" --include="*.yaml" . 2>/dev/null | head -50
signals:
  critical:
  - id: DDEL-CRIT-001
    signal: No data subject deletion workflow implemented
    evidence_indicators:
    - No deletion request handling code found
    - No DSAR processing endpoints
    - No mechanism to identify and delete user data
    explanation: |
      GDPR Article 17 requires organizations to erase personal data "without
      undue delay" when requested. Organizations must respond within one month.
      Absence of deletion workflow makes compliance impossible and exposes
      the organization to significant enforcement risk.
    remediation: |
      - Implement data subject deletion request intake process
      - Create automated deletion workflow covering all data stores
      - Build data discovery mechanism to find all user data
      - Implement request tracking and response time monitoring
    cwe: CWE-359
  - id: DDEL-CRIT-002
    signal: Deletion does not remove data from backups
    evidence_indicators:
    - Backup data excluded from deletion scope
    - No backup purge or rotation after deletion
    - Deleted data recoverable from backups
    explanation: |
      If personal data is deleted from production but remains in backups
      indefinitely, the deletion is incomplete. While immediate backup
      sanitization may not be practical, backups must eventually be rotated
      or purged. Regulators expect organizations to address backup data.
    remediation: |
      - Document backup retention periods
      - Implement backup rotation to ensure eventual deletion
      - Consider encrypted backups with key destruction
      - Include backup timeline in deletion confirmation to data subjects
    cwe: CWE-404
  - id: DDEL-CRIT-003
    signal: Third-party processors not notified of deletion requests
    evidence_pattern: (delete|erase)(?!.*(notify|inform|propagate).*(processor|third|vendor|partner))
    explanation: |
      GDPR Article 17(2) requires controllers to inform processors of
      deletion requests. If user data has been shared with third parties,
      those parties must be notified to delete their copies. Failure to
      notify results in incomplete erasure.
    remediation: |
      - Inventory all data processors receiving personal data
      - Implement processor notification in deletion workflow
      - Track processor deletion confirmations
      - Include processor notification in DSAR response timeline
    cwe: CWE-359
  high:
  - id: DDEL-HIGH-001
    signal: Soft delete without hard delete follow-up
    evidence_pattern: (soft_?delete|is_?deleted|deleted_?at)(?!.*(purge|hard_?delete|remove))
    explanation: |
      Soft deletion (marking records as deleted) does not satisfy the right
      to erasure if the actual data remains indefinitely. GDPR requires
      data to be erased, not just hidden. Soft-deleted records must
      eventually be hard-deleted.
    remediation: |
      - Implement scheduled hard deletion of soft-deleted records
      - Define maximum soft-delete retention period
      - Ensure soft-deleted data is excluded from all queries
      - Log hard deletion for audit purposes
  - id: DDEL-HIGH-002
    signal: No deletion verification mechanism
    evidence_indicators:
    - No post-deletion verification queries
    - No deletion completeness checking
    - Deletion assumed successful without confirmation
    explanation: |
      Without verification, deletion failures may go unnoticed. Organizations
      should confirm that deletion actually removed data from all expected
      locations. This is particularly important for demonstrating compliance.
    remediation: |
      - Implement post-deletion verification queries
      - Check all data stores for remaining user data
      - Log verification results
      - Alert on verification failures
  - id: DDEL-HIGH-003
    signal: Deletion request response time not tracked
    evidence_indicators:
    - No SLA tracking for deletion requests
    - No request receipt timestamps
    - No completion time logging
    explanation: |
      GDPR requires response within one month, which can be extended by
      two months for complex requests with notification. Organizations
      must track timing to ensure compliance and demonstrate it to
      regulators upon request.
    remediation: |
      - Implement request tracking with timestamps
      - Create SLA monitoring for one-month deadline
      - Set up alerts for approaching deadlines
      - Generate compliance reports on response times
  - id: DDEL-HIGH-004
    signal: No audit trail for deletion operations
    evidence_indicators:
    - Deletion operations not logged
    - No record of what data was deleted
    - Cannot demonstrate deletion to regulators
    explanation: |
      Organizations must be able to demonstrate compliance with deletion
      requests. This requires maintaining records of what data was deleted,
      when, and in response to which request. Audit trails should survive
      the deletion they document.
    remediation: |
      - Log all deletion operations with timestamps
      - Record scope of deletion (what was deleted)
      - Link deletion logs to original requests
      - Retain deletion logs for compliance demonstration period
  medium:
  - id: DDEL-MED-001
    signal: Deletion scope incomplete (orphaned data)
    evidence_indicators:
    - Related records not deleted with primary
    - Foreign key data orphaned after deletion
    - Analytics data not included in deletion
    explanation: |
      Deletion must cover all personal data, including records in related
      tables, analytics systems, and derived datasets. Incomplete deletion
      leaves the data subject's information in the system despite the
      erasure request.
    remediation: |
      - Map all data relationships for user data
      - Implement cascading deletion across related tables
      - Include analytics and derived data in deletion scope
      - Verify deletion completeness across all stores
  - id: DDEL-MED-002
    signal: Deletion exceptions not properly handled
    evidence_indicators:
    - No legal hold check before deletion
    - No legitimate interest evaluation
    - Blanket deletion without exception review
    explanation: |
      Article 17 includes exceptions where erasure is not required (legal
      obligation, public interest, legal claims, etc.). Organizations must
      evaluate exceptions before refusing deletion and document the basis
      for any refusal.
    remediation: |
      - Implement exception checking in deletion workflow
      - Integrate legal hold status verification
      - Document basis when deletion is refused
      - Notify data subject of refusal and reason
  - id: DDEL-MED-003
    signal: Deletion request intake not accessible
    evidence_indicators:
    - No self-service deletion option
    - Complex process to submit deletion request
    - Deletion requires excessive identity verification
    explanation: |
      Organizations should make it easy for data subjects to exercise
      their rights. Overly complex deletion request processes may violate
      the spirit of GDPR and frustrate legitimate requests.
    remediation: |
      - Provide clear deletion request mechanism
      - Implement reasonable identity verification
      - Offer self-service deletion where appropriate
      - Document request process in privacy policy
  low:
  - id: DDEL-LOW-001
    signal: Deletion confirmation not sent to data subject
    evidence_indicators:
    - No acknowledgment of deletion request
    - No confirmation when deletion complete
    - Data subject unaware of deletion status
    explanation: |
      While not strictly required, confirming deletion completion provides
      transparency and reduces follow-up inquiries. It demonstrates respect
      for data subject rights.
    remediation: |
      - Send acknowledgment when request received
      - Confirm when deletion is complete
      - Include scope of deletion in confirmation
      - Provide contact for questions
  positive:
  - id: DDEL-POS-001
    signal: Comprehensive deletion workflow implemented
    evidence_indicators:
    - End-to-end deletion automation
    - All data stores covered in deletion
    - Third-party notification integrated
    - Verification and audit logging
  - id: DDEL-POS-002
    signal: Self-service deletion available
    evidence_indicators:
    - Users can initiate deletion from account settings
    - Clear process with appropriate verification
    - Confirmation and timeline communicated
  - id: DDEL-POS-003
    signal: Deletion request tracking and SLA monitoring
    evidence_indicators:
    - Request tracking system in place
    - SLA compliance monitoring
    - Compliance reporting available
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Deletion Workflow Discovery
    description: |
      Identify all deletion-related code, including data subject request
      handling, deletion execution, and notification mechanisms.
    duration_estimate: 45 min
    commands:
    - purpose: Find deletion workflow implementations
      command: |
        grep -rniE "(delete_user|gdpr|erasure|dsar|right_to)" \
          --include="*.py" --include="*.js" --include="*.ts" \
          --include="*.rb" . 2>/dev/null | head -50
    - purpose: Find deletion-related endpoints
      command: |
        grep -rniE "@(delete|destroy|remove)|route.*(delete|erase)" \
          --include="*.py" --include="*.js" --include="*.ts" . 2>/dev/null | head -40
    expected_findings:
    - Deletion workflow implementations
    - API endpoints for deletion
    - Request handling mechanisms
  - id: '2'
    name: Data Store Coverage Assessment
    description: |
      Verify that deletion covers all data stores where user data
      exists, including databases, file storage, and caches.
    duration_estimate: 45 min
    commands:
    - purpose: Find data store references in deletion code
      command: |
        grep -rniE "delete.*(from|table|collection|bucket|cache)" \
          --include="*.py" --include="*.js" --include="*.sql" . 2>/dev/null | head -40
    - purpose: Find user data storage locations
      command: |
        grep -rniE "user|customer|profile|account" \
          --include="*.sql" --include="*.prisma" . 2>/dev/null | head -40
    expected_findings:
    - Data stores covered by deletion
    - Potential gaps in deletion coverage
    - Related data relationships
  - id: '3'
    name: Third-Party Notification Check
    description: |
      Verify that deletion workflow includes notification to
      third-party data processors per GDPR Article 17(2).
    duration_estimate: 30 min
    commands:
    - purpose: Find processor notification code
      command: |
        grep -rniE "(notify|inform|webhook).*(processor|vendor|third|partner)" \
          --include="*.py" --include="*.js" --include="*.yaml" . 2>/dev/null | head -30
    - purpose: Find processor integration points
      command: |
        grep -rniE "(api|integration|webhook).*(delete|remove|erase)" \
          --include="*.py" --include="*.js" . 2>/dev/null | head -30
    expected_findings:
    - Processor notification implementations
    - Integration points with third parties
    - Notification tracking mechanisms
  - id: '4'
    name: Backup and Archive Handling
    description: |
      Assess how deletion handles data in backups, archives,
      and other persistent storage.
    duration_estimate: 30 min
    commands:
    - purpose: Find backup-related deletion code
      command: |
        grep -rniE "(backup|archive|snapshot).*(delete|purge|rotate)" \
          --include="*.py" --include="*.sh" --include="*.yaml" . 2>/dev/null | head -30
    - purpose: Find backup retention configurations
      command: |
        find . -type f \( -name "*backup*" -o -name "*archive*" \) \
          -exec grep -l -iE "retention|lifecycle" {} \; 2>/dev/null
    expected_findings:
    - Backup handling in deletion workflow
    - Backup retention policies
    - Archive deletion mechanisms
  - id: '5'
    name: Audit Trail and Verification
    description: |
      Verify that deletion operations are logged and that
      verification mechanisms exist to confirm complete deletion.
    duration_estimate: 30 min
    commands:
    - purpose: Find deletion audit logging
      command: |
        grep -rniE "(log|audit).*(delet|erasure|request)" \
          --include="*.py" --include="*.js" --include="*.ts" . 2>/dev/null | head -30
    - purpose: Find deletion verification code
      command: |
        grep -rniE "(verify|confirm|check).*(delet|erased|removed)" \
          --include="*.py" --include="*.js" . 2>/dev/null | head -30
    expected_findings:
    - Audit logging for deletions
    - Verification mechanisms
    - Compliance reporting capabilities
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Deletion Workflow Assessment
    - Data Store Coverage
    - Third-Party Notification
    - Backup Handling
    - Recommendations
  - type: deletion_coverage_matrix
    format: table
    description: Data stores and their deletion status
  confidence_guidance:
    high: Deletion workflow directly observed with verification confirmed
    medium: Deletion code found but completeness not verified
    low: Deletion capability unclear, requires manual verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: gdpr-article-17
      priority: required
    - source_id: ico-erasure-guidance
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Deletion audit requires thorough analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: ddel-001
  item: Data subject deletion workflow exists
  level: CRITICAL
  verification: |
    grep -rniE "(delete_user|gdpr|erasure_request|dsar)" \
      --include="*.py" --include="*.js" --include="*.ts" . 2>/dev/null | \
      wc -l | xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: ddel-002
  item: Deletion covers all user data stores
  level: CRITICAL
  verification: manual
  verification_notes: Verify deletion workflow addresses all identified data stores
  expected: Confirmed by reviewer
- id: ddel-003
  item: Third-party processor notification implemented
  level: CRITICAL
  verification: |
    grep -rniE "(notify|inform).*(processor|third|vendor).*delet" \
      --include="*.py" --include="*.js" --include="*.yaml" . 2>/dev/null | \
      wc -l | xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: ddel-004
  item: Deletion audit trail maintained
  level: BLOCKING
  verification: |
    grep -rniE "(log|audit).*(delet|erasure|request)" \
      --include="*.py" --include="*.js" . 2>/dev/null | \
      wc -l | xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: ddel-005
  item: Deletion request response time tracked
  level: BLOCKING
  verification: |
    grep -rniE "(timestamp|created_at|deadline|sla).*(request|dsar)" \
      --include="*.py" --include="*.js" . 2>/dev/null | \
      wc -l | xargs -I{} test {} -gt 0 && echo "PASS" || echo "FAIL"
  expected: PASS
- id: ddel-006
  item: Backup data addressed in deletion policy
  level: WARNING
  verification: manual
  verification_notes: Verify backup retention/deletion is documented and implemented
  expected: Confirmed by reviewer
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: GDPR
    controls:
    - Article 17
    - Article 19
    - Article 12
  - framework: CCPA
    controls:
    - '1798.105'
    - '1798.100'
  - framework: CPRA
    controls:
    - '1798.105'
  - framework: ISO 27001
    controls:
    - A.8.3.2
  - framework: NIST 800-88
    controls:
    - Section 4
relationships:
  commonly_combined:
  - security-trust.data-protection.pii-handling
  - security-trust.data-protection.data-retention
  - security-trust.data-protection.data-classification
