audit:
  id: security-trust.cryptography.random-number-generation
  name: Random Number Generation Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: cryptography
  tier: phd
  estimated_duration: 2 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - security
  blocks_phase: true
  parallelizable: true
description:
  what: |
    This audit examines the codebase for proper use of cryptographically secure
    random number generators (CSPRNGs). It identifies instances where weak or
    predictable pseudo-random number generators (PRNGs) are used in security-
    sensitive contexts such as key generation, session tokens, CSRF tokens,
    password reset tokens, and other cryptographic operations.
  why_it_matters: |
    Insecure randomness is a critical vulnerability that can lead to complete
    system compromise. If an attacker can predict random values used for
    cryptographic keys, session identifiers, or tokens, they can forge
    authentication, decrypt communications, or bypass security controls.
    OWASP ranks Cryptographic Failures (A02:2021) as the #2 most critical
    web application security risk.
  when_to_run:
  - Initial security audit of new codebase
  - Before production deployment
  - When implementing authentication/authorization features
  - When adding cryptographic functionality
  - After dependency updates affecting crypto libraries
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete source code access including all crypto-related modules
  access_requirements:
  - Read access to all source code repositories
  - Access to dependency manifests (package.json, requirements.txt, go.mod, etc.)
discovery:
  code_patterns:
  - pattern: random\.(random|randint|randrange|choice|shuffle|sample)
    type: regex
    scope: source
    purpose: Detect Python standard random module usage (not cryptographically secure)
  - pattern: from\s+random\s+import
    type: regex
    scope: source
    purpose: Detect Python random module imports
  - pattern: Math\.random\(\)
    type: regex
    scope: source
    purpose: Detect JavaScript Math.random() which is not cryptographically secure
  - pattern: new\s+Random\(|java\.util\.Random
    type: regex
    scope: source
    purpose: Detect Java util.Random which is not cryptographically secure
  - pattern: math/rand
    type: regex
    scope: source
    purpose: Detect Go math/rand package which is not cryptographically secure
  - pattern: rand\(|Random\.new|srand
    type: regex
    scope: source
    purpose: Detect Ruby rand() which is not cryptographically secure
  - pattern: rand\(|mt_rand\(|array_rand\(|shuffle\(
    type: regex
    scope: source
    purpose: Detect PHP weak random functions
  - pattern: srand\(|rand\(\)|std::rand
    type: regex
    scope: source
    purpose: Detect C/C++ weak random functions
  - pattern: secrets\.|os\.urandom|SystemRandom
    type: regex
    scope: source
    purpose: Detect Python secure random usage
  - pattern: crypto\.randomBytes|crypto\.getRandomValues
    type: regex
    scope: source
    purpose: Detect Node.js/Web Crypto secure random usage
  - pattern: SecureRandom|java\.security\.SecureRandom
    type: regex
    scope: source
    purpose: Detect Java SecureRandom usage
  - pattern: crypto/rand
    type: regex
    scope: source
    purpose: Detect Go crypto/rand package usage
  file_patterns:
  - glob: '**/*.py'
    purpose: Python source files for random number usage
  - glob: '**/*.js'
    purpose: JavaScript source files for random number usage
  - glob: '**/*.ts'
    purpose: TypeScript source files for random number usage
  - glob: '**/*.java'
    purpose: Java source files for random number usage
  - glob: '**/*.go'
    purpose: Go source files for random number usage
  - glob: '**/*.rb'
    purpose: Ruby source files for random number usage
  - glob: '**/*.php'
    purpose: PHP source files for random number usage
  - glob: '**/*.c'
    purpose: C source files for random number usage
  - glob: '**/*.cpp'
    purpose: C++ source files for random number usage
knowledge_sources:
  specifications:
  - id: nist-sp-800-90a
    name: 'NIST SP 800-90A Rev. 1: Recommendation for Random Number Generation Using Deterministic Random
      Bit Generators'
    url: https://nvlpubs.nist.gov/nistpubs/specialpublications/nist.sp.800-90ar1.pdf
    offline_cache: true
    priority: required
  - id: nist-sp-800-90b
    name: 'NIST SP 800-90B: Recommendation for the Entropy Sources Used for Random Bit Generation'
    url: https://csrc.nist.gov/pubs/sp/800/90/b/final
    offline_cache: true
    priority: required
  - id: nist-sp-800-90c
    name: 'NIST SP 800-90C: Recommendation for Random Bit Generator (RBG) Constructions'
    url: https://csrc.nist.gov/pubs/sp/800/90/c/final
    offline_cache: true
    priority: recommended
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: owasp-insecure-randomness
    name: OWASP Insecure Randomness
    url: https://owasp.org/www-community/vulnerabilities/Insecure_Randomness
    offline_cache: true
  - id: owasp-crypto-storage
    name: OWASP Cryptographic Storage Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html
    offline_cache: true
  - id: cwe-330
    name: 'CWE-330: Use of Insufficiently Random Values'
    url: https://cwe.mitre.org/data/definitions/330.html
    offline_cache: true
  - id: cwe-338
    name: 'CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)'
    url: https://cwe.mitre.org/data/definitions/338.html
    offline_cache: true
tooling:
  static_analysis:
  - tool: semgrep
    purpose: Detect insecure random number generation patterns
    offline_capable: true
  - tool: bandit
    purpose: Python-specific security linting including weak RNG detection
    offline_capable: true
  - tool: eslint-plugin-security
    purpose: JavaScript security linting
    offline_capable: true
  - tool: gosec
    purpose: Go security scanner for weak RNG patterns
    offline_capable: true
  scripts:
  - id: detect-weak-rng
    language: bash
    purpose: Detect weak random number generator usage across languages
    source: inline
    code: |
      #!/bin/bash
      # Detect weak RNG patterns in codebase
      echo "=== Weak RNG Detection ==="

      # Python weak RNG
      echo "--- Python ---"
      grep -rn --include="*.py" -E "random\.(random|randint|randrange|choice|shuffle|sample)\(" . 2>/dev/null || echo "No weak Python RNG found"

      # JavaScript weak RNG
      echo "--- JavaScript/TypeScript ---"
      grep -rn --include="*.js" --include="*.ts" "Math\.random\(\)" . 2>/dev/null || echo "No weak JS RNG found"

      # Java weak RNG
      echo "--- Java ---"
      grep -rn --include="*.java" -E "(new\s+Random\(|java\.util\.Random)" . 2>/dev/null || echo "No weak Java RNG found"

      # Go weak RNG
      echo "--- Go ---"
      grep -rn --include="*.go" "math/rand" . 2>/dev/null || echo "No weak Go RNG found"
signals:
  critical:
  - id: RNG-CRIT-001
    signal: Weak PRNG used for cryptographic key generation
    cwe: CWE-338
    evidence_pattern: (random\.|Math\.random|java\.util\.Random|math/rand).*(key|Key|KEY|secret|Secret|SECRET)
    explanation: |
      Using a weak PRNG (like Python's random, JavaScript's Math.random, or Java's
      util.Random) to generate cryptographic keys allows attackers to predict key
      values. This can lead to complete compromise of encrypted data and authentication
      systems. These PRNGs are designed for statistical properties, not security.
    remediation: |
      Replace with cryptographically secure alternatives:
      - Python: Use secrets module or os.urandom()
      - JavaScript: Use crypto.randomBytes() or crypto.getRandomValues()
      - Java: Use java.security.SecureRandom
      - Go: Use crypto/rand instead of math/rand
  - id: RNG-CRIT-002
    signal: Weak PRNG used for session token generation
    cwe: CWE-330
    evidence_pattern: (random\.|Math\.random|java\.util\.Random).*(session|Session|SESSION|token|Token|TOKEN)
    explanation: |
      Session tokens generated with weak PRNGs can be predicted by attackers,
      allowing session hijacking and unauthorized access to user accounts.
      This is a direct path to authentication bypass.
    remediation: |
      Use cryptographically secure random generators for all session tokens.
      Consider using established session management libraries that handle
      secure token generation automatically.
  - id: RNG-CRIT-003
    signal: Predictable seed used for PRNG initialization
    cwe: CWE-336
    evidence_pattern: (srand|seed|Random)\s*\(\s*(time|Time|clock|getTime|Date\.now)
    explanation: |
      Seeding a PRNG with predictable values like timestamps makes the entire
      random sequence predictable. An attacker who knows the approximate time
      of seeding can reproduce all generated values.
    remediation: |
      Never seed PRNGs with predictable values. Use the operating system's
      cryptographic random source for entropy. For CSPRNGs, use default
      initialization which typically uses OS entropy sources.
  high:
  - id: RNG-HIGH-001
    signal: Weak PRNG used for password reset tokens
    cwe: CWE-640
    evidence_pattern: (random\.|Math\.random).*(reset|Reset|RESET|forgot|Forgot|password|Password)
    explanation: |
      Predictable password reset tokens allow attackers to generate valid
      tokens and take over user accounts without access to the user's email.
    remediation: |
      Use cryptographically secure random generators with sufficient entropy
      (at least 128 bits) for password reset tokens.
  - id: RNG-HIGH-002
    signal: Weak PRNG used for CSRF token generation
    cwe: CWE-352
    evidence_pattern: (random\.|Math\.random).*(csrf|Csrf|CSRF|xsrf|Xsrf|XSRF)
    explanation: |
      Predictable CSRF tokens defeat the purpose of CSRF protection,
      allowing attackers to forge cross-site requests.
    remediation: |
      Use cryptographically secure random generators for CSRF tokens.
      Most web frameworks provide secure CSRF token generation - use
      the framework's built-in protection.
  - id: RNG-HIGH-003
    signal: Weak PRNG used for IV/nonce generation
    cwe: CWE-329
    evidence_pattern: (random\.|Math\.random).*(iv|IV|nonce|Nonce|NONCE)
    explanation: |
      Initialization vectors and nonces must be unpredictable. Reusing
      or predicting IVs can completely break encryption, especially
      with stream ciphers and GCM mode.
    remediation: |
      Always use cryptographically secure random generators for IVs and nonces.
      For some algorithms, ensure IVs are never reused with the same key.
  medium:
  - id: RNG-MED-001
    signal: Weak PRNG used for API key generation
    cwe: CWE-330
    evidence_pattern: (random\.|Math\.random).*(api|Api|API).*(key|Key|KEY)
    explanation: |
      Predictable API keys can be guessed by attackers, granting
      unauthorized access to API endpoints.
    remediation: |
      Use cryptographically secure random generators for API keys
      with at least 128 bits of entropy.
  - id: RNG-MED-002
    signal: No explicit secure random import in security-sensitive module
    cwe: CWE-330
    evidence_pattern: import\s+random(?!.*secrets)
    explanation: |
      Security-sensitive modules should use secure random generators.
      Importing only the weak random module suggests potential misuse.
    remediation: |
      Import and use the appropriate secure random module for your
      language alongside or instead of the weak random module.
  low:
  - id: RNG-LOW-001
    signal: Weak PRNG used in test files
    evidence_pattern: test.*random\.|random.*test
    explanation: |
      Using weak PRNGs in tests is generally acceptable but may indicate
      patterns that could be copied to production code.
    remediation: |
      Consider using secure random even in tests to establish good habits
      and provide accurate testing of production behavior.
  positive:
  - id: RNG-POS-001
    signal: Cryptographically secure random generator properly used
    evidence_pattern: (secrets\.|SecureRandom|crypto\.randomBytes|crypto/rand|os\.urandom)
    explanation: |
      The codebase uses appropriate cryptographically secure random
      number generators for security-sensitive operations.
  - id: RNG-POS-002
    signal: Secure random wrapper/utility function defined
    evidence_pattern: def\s+secure_random|function\s+secureRandom|func\s+SecureRandom
    explanation: |
      A centralized secure random utility promotes consistent usage
      across the codebase.
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory random number usage
    description: |
      Search the codebase for all uses of random number generation,
      both weak and strong variants.
    duration_estimate: 20 min
    commands:
    - purpose: Find all random-related imports and usages
      command: |
        grep -rn --include="*.py" --include="*.js" --include="*.ts" --include="*.java" --include="*.go" \
          -E "(random|Random|rand|Rand)" . 2>/dev/null | head -200
    expected_findings:
    - List of all files using random number generation
    - Classification of weak vs secure RNG usage
  - id: '2'
    name: Identify security-sensitive contexts
    description: |
      Analyze each random usage to determine if it's in a
      security-sensitive context (keys, tokens, IVs, etc.)
    duration_estimate: 30 min
    commands:
    - purpose: Find weak RNG in security contexts
      command: |
        grep -rn --include="*.py" --include="*.js" --include="*.java" \
          -E "(random|Math\.random).*(key|token|session|secret|password|csrf|iv|nonce)" . 2>/dev/null
    expected_findings:
    - List of security-sensitive usages of weak PRNGs
    - Context for each finding to assess actual risk
  - id: '3'
    name: Verify secure RNG usage
    description: |
      Confirm that security-sensitive operations use cryptographically
      secure random generators.
    duration_estimate: 20 min
    commands:
    - purpose: Find secure RNG usage patterns
      command: |
        grep -rn --include="*.py" "secrets\.\|os\.urandom\|SystemRandom" . 2>/dev/null && \
        grep -rn --include="*.js" --include="*.ts" "crypto\.randomBytes\|crypto\.getRandomValues" . 2>/dev/null && \
        grep -rn --include="*.java" "SecureRandom" . 2>/dev/null && \
        grep -rn --include="*.go" "crypto/rand" . 2>/dev/null
    expected_findings:
    - Confirmation of secure RNG usage where required
    - Gaps in secure RNG coverage
  - id: '4'
    name: Run static analysis
    description: |
      Execute static analysis tools to catch patterns that
      manual grep may miss.
    duration_estimate: 30 min
    commands:
    - purpose: Run Semgrep for insecure randomness
      command: |
        semgrep --config=p/security-audit --include="*.py" --include="*.js" \
          --include="*.java" --include="*.go" . 2>/dev/null || echo "Semgrep not available"
    - purpose: Run Bandit for Python
      command: |
        bandit -r . -f json 2>/dev/null | jq '.results[] | select(.test_id | contains("random"))' || echo "Bandit not available"
    expected_findings:
    - Static analysis findings for insecure randomness
    - Additional patterns not caught by grep
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Critical Findings - Weak RNG in Crypto Operations
    - High Findings - Weak RNG in Authentication
    - Recommendations
    - Secure RNG Usage Patterns Found
  confidence_guidance:
    high: Direct evidence of weak PRNG in security context, verified through code review
    medium: Weak PRNG usage found, context requires interpretation
    low: Potential issues based on naming patterns, needs manual verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: nist-sp-800-90a
      priority: required
    - source_id: owasp-insecure-randomness
      priority: required
    - source_id: cwe-330
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires thorough analysis of security contexts
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: rng-001
  item: No weak PRNG used for cryptographic key generation
  level: CRITICAL
  verification: |
    ! grep -rn --include="*.py" --include="*.js" --include="*.java" \
      -E "(random\.|Math\.random|java\.util\.Random).*(key|Key|KEY)" . 2>/dev/null | grep -v test && echo "PASS" || echo "FAIL"
  expected: PASS
- id: rng-002
  item: No weak PRNG used for session/token generation
  level: CRITICAL
  verification: |
    ! grep -rn --include="*.py" --include="*.js" --include="*.java" \
      -E "(random\.|Math\.random).*(session|token|Session|Token)" . 2>/dev/null | grep -v test && echo "PASS" || echo "FAIL"
  expected: PASS
- id: rng-003
  item: Secure RNG imported in authentication modules
  level: BLOCKING
  verification: |
    grep -rn --include="*.py" "secrets\|os\.urandom" . 2>/dev/null | grep -qi "auth\|session\|token" && echo "PASS" || echo "NEEDS_REVIEW"
  expected: PASS
- id: rng-004
  item: No time-based PRNG seeding
  level: WARNING
  verification: |
    ! grep -rn --include="*.py" --include="*.js" --include="*.java" --include="*.c" \
      -E "(srand|seed|Random)\s*\(\s*(time|Time|clock|Date)" . 2>/dev/null && echo "PASS" || echo "FAIL"
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: OWASP Top 10
    controls:
    - A02:2021 - Cryptographic Failures
  - framework: CWE
    controls:
    - CWE-330
    - CWE-338
    - CWE-336
    - CWE-329
  - framework: NIST SP 800-90
    controls:
    - SP 800-90A
    - SP 800-90B
    - SP 800-90C
  - framework: PCI DSS
    controls:
    - '3.5'
    - '3.6'
relationships:
  commonly_combined:
  - security-trust.cryptography.key-rotation
  - security-trust.cryptography.crypto-library-vs-custom
  - security-trust.authentication.session-management
