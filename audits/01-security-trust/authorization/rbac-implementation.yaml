audit:
  id: security-trust.authorization.rbac-implementation
  name: Role-Based Access Control (RBAC) Implementation Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: authorization
  tier: phd
  estimated_duration: 2 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - security
  blocks_phase: true
  parallelizable: true
description:
  what: |
    Examines the implementation of Role-Based Access Control (RBAC) across the codebase,
    verifying that access decisions are based on properly defined roles rather than
    individual identities. Analyzes role definitions, role-permission mappings, role
    assignment mechanisms, and enforcement of role-based checks at all access points.
  why_it_matters: |
    RBAC is the predominant model for access control, adopted as ANSI/INCITS 359-2012.
    Flawed RBAC implementations lead to privilege escalation (CWE-269), unauthorized
    access (CWE-284), and data breaches. NIST research estimates proper RBAC saves
    organizations $1.1 billion in security administration costs. Broken access control
    is ranked #1 in OWASP Top 10 2021.
  when_to_run:
  - Initial security assessment
  - After changes to authorization logic
  - Before production deployment
  - During compliance audits
prerequisites:
  required_artifacts:
  - type: source_code
    description: Application source code with authorization logic
  - type: configuration
    description: Role definitions and permission mappings
  access_requirements:
  - Read access to source code repository
  - Access to role/permission configuration files
discovery:
  code_patterns:
  - pattern: \b(role|roles|Role|ROLE)\s*[=:,\[]
    type: regex
    scope: source
    purpose: Identify role definition and assignment patterns
  - pattern: '@(RequiresRole|RolesAllowed|HasRole|PreAuthorize|Secured)'
    type: regex
    scope: source
    purpose: Find role-based authorization annotations
  - pattern: \.(hasRole|isInRole|checkRole|requireRole|hasAuthority)\s*\(
    type: regex
    scope: source
    purpose: Locate role verification method calls
  - pattern: (if|when|unless).*\b(admin|user|moderator|manager|editor|viewer)\b
    type: regex
    scope: source
    purpose: Find hardcoded role checks in conditionals
  - pattern: rbac|role.based|role_based|RoleBasedAccess
    type: regex
    scope: source
    purpose: Identify RBAC implementation components
  file_patterns:
  - glob: '**/roles.{json,yaml,yml,xml}'
    purpose: Role definition files
  - glob: '**/permissions.{json,yaml,yml,xml}'
    purpose: Permission mapping files
  - glob: '**/authorization/**'
    purpose: Authorization logic modules
  - glob: '**/access-control/**'
    purpose: Access control implementations
  - glob: '**/policy/**'
    purpose: Policy definition files
knowledge_sources:
  specifications:
  - id: nist-rbac
    name: NIST RBAC Model (ANSI/INCITS 359-2012)
    url: https://csrc.nist.gov/projects/role-based-access-control
    offline_cache: true
    priority: required
  - id: nist-sp-800-53-ac3
    name: NIST SP 800-53 AC-3(7) Role-Based Access Control
    url: https://csf.tools/reference/nist-sp-800-53/r4/ac/ac-3/ac-3-7/
    offline_cache: true
    priority: required
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: nist-800-207
    name: NIST SP 800-207 Zero Trust Architecture
    url: https://csrc.nist.gov/publications/detail/sp/800-207/final
    offline_cache: true
    priority: required
  - id: nsa-zero-trust
    name: NSA Embracing a Zero Trust Security Model
    url: https://media.defense.gov/2021/Feb/25/2002588479/-1/-1/0/CSI_EMBRACING_ZT_SECURITY_MODEL_UOO115131-21.PDF
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: owasp-authz
    name: OWASP Authorization Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Authorization_Cheat_Sheet.html
    offline_cache: true
  - id: owasp-access-control
    name: OWASP Access Control Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html
    offline_cache: true
  - id: owasp-proactive-c1
    name: 'OWASP Top 10 Proactive Controls - C1: Implement Access Control'
    url: https://top10proactive.owasp.org/the-top-10/c1-accesscontrol/
    offline_cache: true
tooling:
  static_analysis:
  - tool: semgrep
    purpose: Detect missing or inconsistent role checks
    offline_capable: true
  - tool: CodeQL
    purpose: Analyze authorization flow and role enforcement
    offline_capable: true
  scripts:
  - id: rbac-grep
    language: bash
    purpose: Find RBAC implementation patterns
    source: inline
    code: |
      # Search for role-related patterns
      grep -rn --include="*.{js,ts,py,java,rb,go,cs}" \
        -E "(role|Role|ROLE|hasRole|isInRole|checkRole|requireRole)" .
signals:
  critical:
  - id: RBAC-CRIT-001
    signal: Missing role verification on sensitive endpoints
    evidence_pattern: '@(Get|Post|Put|Delete|Patch)Mapping.*(?!@(PreAuthorize|Secured|RolesAllowed))'
    cwe: CWE-862
    explanation: |
      Sensitive API endpoints lack role-based access control checks, allowing
      any authenticated user to access functionality intended for specific roles.
      This leads to horizontal and vertical privilege escalation.
    remediation: Add @PreAuthorize, @RolesAllowed, or equivalent role checks to all sensitive endpoints
  - id: RBAC-CRIT-002
    signal: Hardcoded role bypass or backdoor
    evidence_pattern: (role\s*===?\s*['"]admin['"]|isAdmin\s*=\s*true)
    cwe: CWE-284
    explanation: |
      Hardcoded admin checks or role bypasses allow attackers to exploit
      predictable authorization logic. Role verification should use
      centralized, configurable mechanisms.
    remediation: Replace hardcoded role checks with centralized RBAC service calls
  - id: RBAC-CRIT-003
    signal: Role assignment without validation
    evidence_pattern: user\.(role|roles)\s*=\s*(req|request|input|params)
    cwe: CWE-269
    explanation: |
      Roles are assigned directly from user input without validation,
      enabling privilege escalation by self-assigning elevated roles.
    remediation: Validate role assignments against authorized role list and user permissions
  high:
  - id: RBAC-HIGH-001
    signal: Inconsistent role enforcement across layers
    evidence_pattern: hasRole.*(?!&&.*hasRole)
    cwe: CWE-863
    explanation: |
      Role checks exist at some layers but not others (e.g., API but not service layer),
      creating bypass opportunities through alternative code paths.
    remediation: Implement defense-in-depth with role checks at all architectural layers
  - id: RBAC-HIGH-002
    signal: Mutable role permissions at runtime without audit
    evidence_pattern: (addPermission|removePermission|updateRole).*(?!audit|log)
    cwe: CWE-285
    explanation: |
      Role permissions can be modified at runtime without audit logging,
      allowing covert privilege escalation without detection.
    remediation: Add comprehensive audit logging for all role and permission changes
  - id: RBAC-HIGH-003
    signal: Role hierarchy bypass
    evidence_pattern: role\s*!=\s*['"]admin['"]|!isAdmin
    cwe: CWE-863
    explanation: |
      Role hierarchy is not properly enforced, allowing users to bypass
      intermediate role requirements.
    remediation: Implement proper role hierarchy with inheritance checking
  medium:
  - id: RBAC-MED-001
    signal: Overly permissive default role assignment
    evidence_pattern: defaultRole.*=.*['"]admin|role.*\|\|.*admin
    cwe: CWE-276
    remediation: Set least-privileged default role for new users
  - id: RBAC-MED-002
    signal: Role names exposed in client-side code
    evidence_pattern: role.*===?.*['"]admin['"]|hasRole\(['"]admin['"]\)
    cwe: CWE-200
    remediation: Abstract role checks behind opaque permission identifiers
  low:
  - id: RBAC-LOW-001
    signal: Inconsistent role naming conventions
    evidence_pattern: (ADMIN|admin|Admin|administrator|Administrator)
    remediation: Standardize role naming across the codebase
  positive:
  - id: RBAC-POS-001
    signal: Centralized RBAC service implementation
    evidence_pattern: (class|interface).*RBACService|RoleService|AuthorizationService
  - id: RBAC-POS-002
    signal: Role-based audit logging present
    evidence_pattern: audit.*role|log.*(role.*change|permission)
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify RBAC Components
    description: |
      Locate all role definitions, permission mappings, and authorization
      enforcement points in the codebase.
    duration_estimate: 20 min
    commands:
    - purpose: Find role definitions
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -E \
          "(roles?\s*[=:]\s*\[|enum\s+Role|class\s+Role|type\s+Role)" .
    - purpose: Find authorization decorators
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -E \
          "@(RequiresRole|RolesAllowed|PreAuthorize|Authorize|authorize)" .
    expected_findings:
    - Role enumeration or definition files
    - Authorization middleware or decorators
    - Role-permission mapping structures
  - id: '2'
    name: Verify Role Assignment Security
    description: |
      Check that role assignments are protected against user manipulation
      and follow the principle of least privilege.
    duration_estimate: 25 min
    commands:
    - purpose: Find role assignment patterns
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -E \
          "(setRole|assignRole|user\.role\s*=|grantRole)" .
    - purpose: Check for input-based role assignment
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -E \
          "role.*=.*(req|request|body|params|input)" .
    expected_findings:
    - Protected role assignment mechanisms
    - Validation of role values before assignment
  - id: '3'
    name: Analyze Role Enforcement Consistency
    description: |
      Verify that role checks are consistently applied across all
      application layers (API, service, data access).
    duration_estimate: 30 min
    commands:
    - purpose: Find unprotected endpoints
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -B5 -A2 \
          "@(Get|Post|Put|Delete|Patch)(Mapping|Route|)" . | \
          grep -v "@(PreAuthorize|Secured|RolesAllowed|Authorize)"
    - purpose: Check service layer authorization
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -E \
          "(Service|UseCase|Handler).*\{" . | head -50
    expected_findings:
    - Consistent authorization across layers
    - Defense-in-depth implementation
  - id: '4'
    name: Review Role Hierarchy and Inheritance
    description: |
      Examine how role hierarchies are defined and whether inheritance
      is properly implemented.
    duration_estimate: 20 min
    commands:
    - purpose: Find role hierarchy definitions
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -E \
          "(parent.*role|role.*inherit|extends.*Role|role.*hierarchy)" .
    expected_findings:
    - Clear role hierarchy if applicable
    - Proper inheritance of permissions
  - id: '5'
    name: Audit Role Change Logging
    description: |
      Verify that all role assignments and changes are properly logged
      for security audit purposes.
    duration_estimate: 15 min
    commands:
    - purpose: Find audit logging for role changes
      command: |
        grep -rn --include="*.{js,ts,py,java,go,rb,cs}" -E \
          "(log|audit|track).*(role|permission|grant|revoke)" .
    expected_findings:
    - Audit logging for role assignments
    - Tracking of permission changes
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - RBAC Architecture Analysis
    - Critical Findings
    - Recommendations
  confidence_guidance:
    high: Role enforcement verified at all layers with consistent implementation
    medium: Role checks present but inconsistent across layers
    low: Role patterns identified but enforcement unclear
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: nist-rbac
      priority: required
    - source_id: owasp-authz
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: RBAC audit requires thorough analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: rbac-001
  item: All sensitive endpoints have role checks
  level: CRITICAL
  verification: |
    grep -rn --include="*.{js,ts,py,java}" "@(Get|Post|Put|Delete)Mapping" . | \
      wc -l && grep -rn --include="*.{js,ts,py,java}" "@(PreAuthorize|RolesAllowed)" . | wc -l
  expected: Endpoint count should match or be less than authorization annotation count
- id: rbac-002
  item: No hardcoded admin bypasses
  level: CRITICAL
  verification: |
    grep -rn --include="*.{js,ts,py,java,go}" -E "isAdmin\s*=\s*true|role\s*===?\s*['\"]admin['\"]" . | wc -l
  expected: '0'
- id: rbac-003
  item: Role assignments validated against allowed values
  level: BLOCKING
  verification: |
    grep -rn --include="*.{js,ts,py,java,go}" -E "role.*=.*(req|request|body)" . | wc -l
  expected: 0 or all occurrences have accompanying validation
- id: rbac-004
  item: Audit logging for role changes exists
  level: WARNING
  verification: |
    grep -rn --include="*.{js,ts,py,java,go}" -E "(log|audit).*(role|permission)" . | wc -l
  expected: Greater than 0
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: NIST SP 800-53
    controls:
    - AC-3(7)
    - AC-2
    - AC-6
  - framework: OWASP Top 10 2021
    controls:
    - A01:2021
  - framework: CIS Controls
    controls:
    - '6.1'
    - '6.2'
    - '6.8'
relationships:
  commonly_combined:
  - security-trust.authorization.abac-implementation
  - security-trust.authorization.privilege-escalation
  - security-trust.authentication.session-management
