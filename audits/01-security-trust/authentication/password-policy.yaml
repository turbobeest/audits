audit:
  id: security-trust.authentication.password-policy
  name: Password Policy & Storage Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: authentication
  tier: phd
  estimated_duration: 3 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines password policy enforcement and secure storage
    practices against OWASP Password Storage Cheat Sheet and NIST SP 800-63B
    guidelines. It evaluates hashing algorithms (Argon2id, bcrypt, scrypt),
    work factors, salting, peppering, password complexity rules, and
    breached password detection.
  why_it_matters: |
    Password storage vulnerabilities rank among the most damaging security
    issues. Weak hashing (MD5, SHA1, unsalted SHA256) enables rapid credential
    recovery from stolen databases. OWASP recommends Argon2id as the primary
    choice, with bcrypt for legacy systems. Insufficient work factors allow
    GPU-accelerated attacks. Modern guidance favors length over complexity
    and mandates breached password checks.
  when_to_run:
  - Before production deployment of authentication systems
  - After changes to password storage mechanisms
  - During security assessments and compliance audits
  - When migrating to new hashing algorithms
prerequisites:
  required_artifacts:
  - type: source_code
    description: Password handling, hashing, and validation code
  - type: configuration
    description: Password policy configuration files
  access_requirements:
  - Read access to authentication service codebase
  - Access to password policy configuration
  - Understanding of database schema for user credentials
discovery:
  code_patterns:
  - pattern: md5|MD5|hashlib\.md5
    type: regex
    scope: source
    purpose: Detect insecure MD5 hashing for passwords
  - pattern: sha1|SHA1|hashlib\.sha1
    type: regex
    scope: source
    purpose: Detect insecure SHA1 hashing for passwords
  - pattern: sha256|SHA256(?!.*pbkdf|.*hmac.*iter)
    type: regex
    scope: source
    purpose: Detect unsalted SHA256 for passwords
  - pattern: argon2|Argon2|argon2id|argon2i
    type: regex
    scope: source
    purpose: Identify Argon2 implementation (recommended)
  - pattern: bcrypt|bcryptjs|password_hash.*BCRYPT
    type: regex
    scope: source
    purpose: Identify bcrypt implementation
  - pattern: scrypt|SCRYPT
    type: regex
    scope: source
    purpose: Identify scrypt implementation
  - pattern: pbkdf2|PBKDF2
    type: regex
    scope: source
    purpose: Identify PBKDF2 implementation
  - pattern: password.*plain|plaintext.*password|store.*password.*text
    type: regex
    scope: source
    purpose: Detect plaintext password storage
  - pattern: salt|generateSalt|crypto\.randomBytes
    type: regex
    scope: source
    purpose: Verify salt generation
  - pattern: pepper|PEPPER|secret.*hash|hmac.*password
    type: regex
    scope: source
    purpose: Check for peppering implementation
  - pattern: haveibeenpwned|pwnedpasswords|breached.*password|hibp
    type: regex
    scope: source
    purpose: Detect breached password checking
  - pattern: min.*length.*password|password.*min.*[=:]\s*\d+
    type: regex
    scope: source
    purpose: Find password length requirements
  file_patterns:
  - glob: '**/password*'
    purpose: Password handling files
  - glob: '**/auth/**'
    purpose: Authentication module files
  - glob: '**/user*'
    purpose: User model and handling files
  - glob: '**/hash*'
    purpose: Hashing utility files
  - glob: '**/crypto*'
    purpose: Cryptographic utility files
knowledge_sources:
  specifications:
  - id: nist-800-63b
    name: NIST SP 800-63B Authentication and Lifecycle Management
    url: https://pages.nist.gov/800-63-3/sp800-63b.html
    offline_cache: true
    priority: required
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: nist-800-207
    name: NIST SP 800-207 Zero Trust Architecture
    url: https://csrc.nist.gov/publications/detail/sp/800-207/final
    offline_cache: true
    priority: required
  - id: nsa-zero-trust
    name: NSA Embracing a Zero Trust Security Model
    url: https://media.defense.gov/2021/Feb/25/2002588479/-1/-1/0/CSI_EMBRACING_ZT_SECURITY_MODEL_UOO115131-21.PDF
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: owasp-password-storage
    name: OWASP Password Storage Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html
    offline_cache: true
  - id: owasp-auth
    name: OWASP Authentication Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html
    offline_cache: true
  papers:
  - id: argon2-spec
    title: 'Argon2: The Memory-Hard Function for Password Hashing'
    url: https://github.com/P-H-C/phc-winner-argon2/blob/master/argon2-specs.pdf
tooling:
  static_analysis:
  - tool: semgrep
    purpose: Detect password storage anti-patterns
    offline_capable: true
  - tool: bandit
    purpose: Python password security linting
    offline_capable: true
  scripts:
  - id: password-hash-detector
    language: bash
    purpose: Detect password hashing methods
    source: inline
    code: |
      #!/bin/bash
      echo "=== Password Hashing Detection ==="
      echo "INSECURE - MD5:"
      grep -rn "md5\|MD5" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" --include="*.php" .
      echo ""
      echo "INSECURE - SHA1:"
      grep -rn "sha1\|SHA1" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" --include="*.php" .
      echo ""
      echo "RECOMMENDED - Argon2:"
      grep -rn "argon2" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" .
      echo ""
      echo "ACCEPTABLE - bcrypt:"
      grep -rn "bcrypt" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" --include="*.php" .
signals:
  critical:
  - id: AUTH-PWD-CRIT-001
    signal: Plaintext password storage detected
    cwe: CWE-256
    evidence_pattern: password\s*[=:]\s*req\.|store.*password.*plain|user\.password\s*=\s*password
    explanation: |
      Storing passwords in plaintext allows immediate credential theft
      upon database compromise. This violates all security standards and
      is a critical finding that requires immediate remediation.
    remediation: |
      Implement password hashing using Argon2id with recommended parameters.
      Hash all passwords before storage. Migrate existing plaintext
      passwords during next user login.
  - id: AUTH-PWD-CRIT-002
    signal: MD5 or SHA1 used for password hashing
    cwe: CWE-328
    evidence_pattern: (md5|MD5|sha1|SHA1)\s*\(.*password|hashlib\.(md5|sha1)\(.*password
    explanation: |
      MD5 and SHA1 are cryptographically broken for password hashing.
      They are not designed for password storage, lack built-in salting,
      and can be cracked at billions of hashes per second using modern
      GPU hardware.
    remediation: |
      Migrate to Argon2id or bcrypt. MD5/SHA1 hashes should be upgraded
      on next user login by verifying against old hash then storing new
      Argon2id hash.
  - id: AUTH-PWD-CRIT-003
    signal: Unsalted SHA256 for password storage
    cwe: CWE-759
    evidence_pattern: sha256\s*\(.*password(?!.*salt)|SHA256.*password(?!.*PBKDF)
    explanation: |
      Unsalted SHA256 is vulnerable to rainbow table attacks. While
      SHA256 is a strong hash, without salting identical passwords
      produce identical hashes, enabling mass credential recovery.
    remediation: |
      Use Argon2id or bcrypt which include automatic salting. If SHA256
      must be used, implement PBKDF2-HMAC-SHA256 with at least 600,000
      iterations per NIST guidelines.
  high:
  - id: AUTH-PWD-HIGH-001
    signal: bcrypt work factor below 10
    cwe: CWE-916
    evidence_pattern: bcrypt.*cost.*[=:]\s*[1-9]\b|genSalt\s*\(\s*[1-9]\s*\)
    explanation: |
      bcrypt work factors below 10 are too fast on modern hardware.
      OWASP recommends work factor 10 as minimum, with higher values
      for systems that can tolerate increased latency.
    remediation: |
      Increase bcrypt work factor to at least 10, preferably 12-14
      based on server capacity. Benchmark to ensure login latency
      remains under 1 second.
  - id: AUTH-PWD-HIGH-002
    signal: Argon2 memory parameter below 19 MiB
    cwe: CWE-916
    evidence_pattern: argon2.*memory.*[=:]\s*(1024|2048|4096|8192|16384)\b
    explanation: |
      Low memory parameters in Argon2 reduce its resistance to
      GPU-based attacks. OWASP recommends minimum 19 MiB (19456 KiB)
      with 2 iterations for standard use.
    remediation: |
      Configure Argon2id with at least 19 MiB memory, 2 iterations,
      and parallelism of 1. For high-security applications, use
      128 MiB memory with 3-5 iterations.
  - id: AUTH-PWD-HIGH-003
    signal: PBKDF2 iterations below 600,000
    cwe: CWE-916
    evidence_pattern: pbkdf2.*iterations.*[=:]\s*([1-9][0-9]{0,4}|[1-5][0-9]{5})\b
    explanation: |
      NIST recommends at least 600,000 iterations for PBKDF2-HMAC-SHA256
      for FIPS 140-3 compliance. Lower iteration counts enable faster
      brute-force attacks.
    remediation: |
      Increase PBKDF2 iterations to at least 600,000 for HMAC-SHA256.
      Consider migrating to Argon2id which offers better GPU resistance.
  - id: AUTH-PWD-HIGH-004
    signal: Password length maximum below 64 characters
    cwe: CWE-521
    evidence_pattern: max.*length.*password.*[=:]\s*([1-5][0-9]|6[0-3])\b|password.*max.*[1-5][0-9]\b
    explanation: |
      NIST SP 800-63B requires accepting passwords up to at least 64
      characters to support passphrases. Low maximums prevent users
      from using strong passphrases.
    remediation: |
      Set maximum password length to at least 64 characters. Note:
      bcrypt has 72-byte limit, so pre-hash with SHA-256 or HMAC for
      longer passwords.
  medium:
  - id: AUTH-PWD-MED-001
    signal: No breached password checking
    cwe: CWE-521
    evidence_pattern: password.*validate(?!.*breach|.*pwned|.*hibp)
    remediation: |
      Implement breached password checking using Have I Been Pwned API
      (k-anonymity model) or local breach database. Block passwords
      found in breaches during registration and password change.
  - id: AUTH-PWD-MED-002
    signal: Minimum password length below 8 characters
    cwe: CWE-521
    evidence_pattern: min.*length.*[=:]\s*[1-7]\b|password.*min.*[1-7]\b
    remediation: |
      Set minimum password length to at least 8 characters. NIST
      recommends 8 as minimum for memorized secrets. Consider 12+
      for high-security applications.
  - id: AUTH-PWD-MED-003
    signal: Password history not enforced
    cwe: CWE-262
    evidence_pattern: password.*change(?!.*history|.*previous|.*reuse)
    remediation: |
      Implement password history checking. Prevent reuse of the last
      5-10 passwords. Store hashed previous passwords for comparison.
  - id: AUTH-PWD-MED-004
    signal: No pepper used in password hashing
    cwe: CWE-257
    evidence_pattern: bcrypt.*hash\(|argon2.*hash\((?!.*pepper|.*secret)
    remediation: |
      Implement peppering using HMAC or encryption. Store pepper in
      HSM or secrets vault, separate from database. Enables password
      invalidation if database compromised.
  low:
  - id: AUTH-PWD-LOW-001
    signal: Complex character requirements enforced
    evidence_pattern: require.*uppercase.*lowercase.*number.*special
    remediation: |
      Per NIST SP 800-63B, avoid complex composition rules. Focus on
      length and breached password checking instead. Complex rules
      lead to predictable patterns.
  positive:
  - id: AUTH-PWD-POS-001
    signal: Argon2id hashing implemented
    evidence_pattern: argon2id|Argon2id|ARGON2ID
  - id: AUTH-PWD-POS-002
    signal: Breached password checking implemented
    evidence_pattern: haveibeenpwned|pwnedpasswords|hibp|breached.*check
  - id: AUTH-PWD-POS-003
    signal: Password pepper in use
    evidence_pattern: pepper|PEPPER|password.*secret.*hash
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify Hashing Algorithm
    description: |
      Determine what password hashing algorithm is in use and
      verify it meets OWASP recommendations.
    duration_estimate: 30 min
    commands:
    - purpose: Find password hashing code
      command: grep -rn 'hash.*password\|password.*hash\|bcrypt\|argon2\|pbkdf2\|scrypt' --include='*.js'
        --include='*.ts' --include='*.py' --include='*.java' --include='*.php' .
    - purpose: Detect insecure hashing
      command: grep -rn 'md5\|sha1\|sha256' --include='*.js' --include='*.ts' --include='*.py' --include='*.java'
        --include='*.php' . | grep -i password
    expected_findings:
    - Hashing algorithm identification
    - Insecure algorithm usage detection
  - id: '2'
    name: Verify Work Factors
    description: |
      Check that hashing work factors meet minimum requirements.
    duration_estimate: 20 min
    commands:
    - purpose: Check bcrypt cost factor
      command: grep -rn 'cost\|rounds\|genSalt' --include='*.js' --include='*.ts' --include='*.py' --include='*.java'
        . | grep -i bcrypt
    - purpose: Check Argon2 parameters
      command: grep -rn 'memory\|iterations\|parallelism\|timeCost\|memoryCost' --include='*.js' --include='*.ts'
        --include='*.py' . | grep -i argon
    expected_findings:
    - Work factor configuration values
    - Compliance with OWASP recommendations
  - id: '3'
    name: Audit Password Policy
    description: |
      Review password policy configuration for length, complexity,
      and breached password checking.
    duration_estimate: 30 min
    commands:
    - purpose: Find password validation rules
      command: grep -rn 'min.*length\|max.*length\|password.*policy\|validate.*password' --include='*.js'
        --include='*.ts' --include='*.py' --include='*.java' .
    - purpose: Check for breach detection
      command: grep -rn 'hibp\|haveibeenpwned\|pwned\|breached' --include='*.js' --include='*.ts' --include='*.py'
        .
    expected_findings:
    - Password length requirements
    - Breached password checking status
  - id: '4'
    name: Verify Secure Storage
    description: |
      Ensure passwords are never stored in plaintext and salting
      is properly implemented.
    duration_estimate: 30 min
    commands:
    - purpose: Check for plaintext storage
      command: grep -rn 'user\.password\s*=\|password.*plain\|store.*password' --include='*.js' --include='*.ts'
        --include='*.py' --include='*.java' .
    - purpose: Verify salt usage
      command: grep -rn 'salt\|generateSalt\|randomBytes' --include='*.js' --include='*.ts' --include='*.py'
        .
    expected_findings:
    - No plaintext password storage
    - Proper salt generation
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Hashing Algorithm Assessment
    - Password Policy Analysis
    - Recommendations
  confidence_guidance:
    high: Direct code evidence of hashing algorithm and parameters
    medium: Configuration patterns requiring verification
    low: Circumstantial evidence of potential issues
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: owasp-password-storage
      priority: required
    - source_id: nist-800-63b
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Password storage security requires thorough analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: pwd-001
  item: No MD5 or SHA1 for password hashing
  level: CRITICAL
  verification: |
    if grep -rq '(md5|sha1).*password\|password.*(md5|sha1)' --include='*.js' --include='*.ts' --include='*.py' --include='*.java' .; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: pwd-002
  item: Argon2id, bcrypt, or scrypt in use
  level: CRITICAL
  verification: |
    if grep -rq 'argon2\|bcrypt\|scrypt' --include='*.js' --include='*.ts' --include='*.py' --include='*.java' .; then echo "PASS"; else echo "FAIL - No secure hashing found"; fi
  expected: PASS
- id: pwd-003
  item: No plaintext password storage
  level: CRITICAL
  verification: |
    if grep -rq 'password.*plain\|plaintext.*password\|user\.password\s*=\s*req\.' --include='*.js' --include='*.ts' --include='*.py' .; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: pwd-004
  item: Minimum password length at least 8 characters
  level: BLOCKING
  verification: manual
  verification_notes: Verify password policy enforces minimum 8 character length
  expected: Confirmed by reviewer
- id: pwd-005
  item: bcrypt work factor at least 10
  level: BLOCKING
  verification: |
    if grep -rq 'bcrypt.*cost.*[1-9]\b\|genSalt\s*(\s*[1-9]\s*)' --include='*.js' --include='*.ts' --include='*.py' .; then echo "FAIL - Low work factor"; else echo "PASS"; fi
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: NIST SP 800-63B
    controls:
    - 5.1.1
  - framework: OWASP ASVS
    controls:
    - V2.1
    - V2.4
  - framework: PCI DSS
    controls:
    - '8.2'
  - framework: FIPS 140-3
    controls:
    - Password hashing
relationships:
  commonly_combined:
  - security-trust.authentication.mfa-implementation
  - security-trust.authentication.brute-force-protection
  - security-trust.authentication.credential-stuffing-resistance
