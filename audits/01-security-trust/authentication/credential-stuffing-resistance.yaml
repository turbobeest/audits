audit:
  id: security-trust.authentication.credential-stuffing-resistance
  name: Credential Stuffing Resistance Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: authentication
  tier: phd
  estimated_duration: 3 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: codebase
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates defenses against credential stuffing attacks, which
    use stolen username/password pairs from data breaches to compromise
    accounts. It examines breached password detection, bot detection,
    device fingerprinting, behavioral analysis, MFA implementation, and
    IP reputation checking per OWASP Credential Stuffing Prevention
    Cheat Sheet (OAT-008).
  why_it_matters: |
    Over 24 billion username/password pairs are circulating on cybercrime
    forums. Credential stuffing attacks exploit password reuse across sites,
    achieving approximately 0.1% success rate - meaning millions of successful
    compromises from billion-credential databases. OWASP classifies this as
    Automated Threat OAT-008. Multi-factor authentication is the primary
    defense, but layered controls are essential for comprehensive protection.
  when_to_run:
  - Before production deployment
  - After security incidents involving credential leaks
  - During security assessments
  - When implementing bot detection
prerequisites:
  required_artifacts:
  - type: source_code
    description: Authentication endpoints, bot detection, and MFA code
  - type: configuration
    description: Security configuration and third-party integrations
  access_requirements:
  - Read access to authentication service codebase
  - Access to security configuration
  - Understanding of authentication architecture
discovery:
  code_patterns:
  - pattern: haveibeenpwned|pwnedpasswords|hibp|breached.*password
    type: regex
    scope: source
    purpose: Detect breached password checking
  - pattern: bot.*detect|captcha|recaptcha|hcaptcha|turnstile
    type: regex
    scope: source
    purpose: Find bot detection implementation
  - pattern: fingerprint|device.*id|deviceId|browser.*fingerprint
    type: regex
    scope: source
    purpose: Locate device fingerprinting
  - pattern: ip.*reputation|threat.*intelligence|abuseipdb|ipqs
    type: regex
    scope: source
    purpose: Check for IP reputation services
  - pattern: mfa|MFA|2fa|two.*factor|totp|webauthn
    type: regex
    scope: source
    purpose: Identify MFA implementation
  - pattern: anomaly|behavioral|suspicious.*activity|risk.*score
    type: regex
    scope: source
    purpose: Find behavioral analysis
  - pattern: proxy.*detect|vpn.*detect|datacenter.*ip
    type: regex
    scope: source
    purpose: Check for proxy/VPN detection
  - pattern: credential.*stuff|OAT-008|automated.*threat
    type: regex
    scope: source
    purpose: Find explicit credential stuffing protection
  - pattern: new.*device|unknown.*device|device.*trust
    type: regex
    scope: source
    purpose: Locate new device detection
  - pattern: login.*alert|suspicious.*login|notify.*login
    type: regex
    scope: source
    purpose: Find login notification features
  file_patterns:
  - glob: '**/auth/**'
    purpose: Authentication module files
  - glob: '**/security/**'
    purpose: Security module files
  - glob: '**/bot*'
    purpose: Bot detection files
  - glob: '**/fraud*'
    purpose: Fraud detection files
knowledge_sources:
  specifications:
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: nist-800-207
    name: NIST SP 800-207 Zero Trust Architecture
    url: https://csrc.nist.gov/publications/detail/sp/800-207/final
    offline_cache: true
    priority: required
  - id: nsa-zero-trust
    name: NSA Embracing a Zero Trust Security Model
    url: https://media.defense.gov/2021/Feb/25/2002588479/-1/-1/0/CSI_EMBRACING_ZT_SECURITY_MODEL_UOO115131-21.PDF
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: owasp-credential-stuffing
    name: OWASP Credential Stuffing Prevention Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Credential_Stuffing_Prevention_Cheat_Sheet.html
    offline_cache: true
  - id: owasp-oat008
    name: OWASP Automated Threats - OAT-008 Credential Stuffing
    url: https://owasp.org/www-project-automated-threats-to-web-applications/assets/oats/EN/OAT-008_Credential_Stuffing
    offline_cache: true
  - id: owasp-auth
    name: OWASP Authentication Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html
    offline_cache: true
  learning_resources:
  - id: hibp-api
    title: Have I Been Pwned API Documentation
    type: article
    reference: https://haveibeenpwned.com/API/v3
tooling:
  static_analysis:
  - tool: semgrep
    purpose: Credential stuffing defense patterns
    offline_capable: true
  scripts:
  - id: credential-stuffing-scanner
    language: bash
    purpose: Scan for credential stuffing defenses
    source: inline
    code: |
      #!/bin/bash
      echo "=== Credential Stuffing Defense Scanner ==="
      echo "Breached Password Checking:"
      grep -rn "haveibeenpwned\|pwnedpasswords\|hibp\|breached" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" .
      echo ""
      echo "Bot Detection:"
      grep -rn "bot.*detect\|captcha\|recaptcha\|hcaptcha" --include="*.js" --include="*.ts" --include="*.py" .
      echo ""
      echo "MFA Implementation:"
      grep -rn "mfa\|MFA\|2fa\|totp\|webauthn" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" .
      echo ""
      echo "Device Fingerprinting:"
      grep -rn "fingerprint\|deviceId\|device.*id" --include="*.js" --include="*.ts" --include="*.py" .
      echo ""
      echo "IP Reputation:"
      grep -rn "ip.*reputation\|threat.*intelligence\|abuseipdb" --include="*.js" --include="*.ts" --include="*.py" .
signals:
  critical:
  - id: AUTH-CRED-CRIT-001
    signal: No multi-factor authentication available
    cwe: CWE-308
    evidence_pattern: login(?!.*mfa|.*2fa|.*totp|.*webauthn)|authenticate(?!.*factor)
    explanation: |
      MFA is the primary defense against credential stuffing, preventing
      99.9% of account compromises according to Microsoft. Without MFA,
      any successful credential match results in immediate account takeover.
    remediation: |
      Implement MFA using TOTP authenticator apps or WebAuthn/FIDO2.
      Prioritize WebAuthn for phishing resistance. At minimum, offer
      optional MFA; mandate for sensitive accounts.
  - id: AUTH-CRED-CRIT-002
    signal: No breached password detection
    cwe: CWE-521
    evidence_pattern: password.*validate(?!.*breach|.*pwned|.*hibp)|register(?!.*breach.*check)
    explanation: |
      Without breached password detection, users can set passwords
      already compromised in data breaches. OWASP ASVS 2.1.7 requires
      checking passwords against breach databases. Over 600 million
      unique passwords are available via Have I Been Pwned.
    remediation: |
      Integrate Have I Been Pwned API (k-anonymity model) for password
      checking during registration and password change. Block passwords
      found in breaches. Consider local breach database for offline
      capability.
  high:
  - id: AUTH-CRED-HIGH-001
    signal: No bot detection or CAPTCHA on login
    cwe: CWE-307
    evidence_pattern: login.*endpoint(?!.*captcha|.*bot|.*challenge)|authenticate(?!.*captcha)
    explanation: |
      Credential stuffing attacks use automated bots to test credentials.
      Without bot detection, attackers can make thousands of requests per
      minute. CAPTCHA and bot detection solutions significantly slow attacks.
    remediation: |
      Implement CAPTCHA after failed attempts or for suspicious requests.
      Use invisible CAPTCHA for better UX. Consider bot management
      solutions (Cloudflare, PerimeterX, etc.) for sophisticated attacks.
  - id: AUTH-CRED-HIGH-002
    signal: No device fingerprinting or recognition
    cwe: CWE-384
    evidence_pattern: login(?!.*device|.*fingerprint)|session(?!.*device.*bind)
    explanation: |
      Device fingerprinting enables detection of new or suspicious
      devices attempting login. Attackers typically use different
      device characteristics than legitimate users.
    remediation: |
      Implement device fingerprinting using browser characteristics.
      Track known devices for users. Require additional verification
      for unknown devices. Consider commercial device intelligence.
  - id: AUTH-CRED-HIGH-003
    signal: No IP reputation or intelligence checking
    cwe: CWE-307
    evidence_pattern: login(?!.*ip.*reputation|.*threat.*intel)|authenticate(?!.*ip.*check)
    explanation: |
      Credential stuffing attacks often originate from known malicious
      IPs, data centers, or proxy networks. IP reputation services can
      identify suspicious traffic before credential validation.
    remediation: |
      Integrate IP reputation services (AbuseIPDB, IPQualityScore).
      Block or challenge requests from known malicious IPs.
      Detect datacenter/proxy traffic for additional scrutiny.
  - id: AUTH-CRED-HIGH-004
    signal: No login anomaly or behavioral analysis
    cwe: CWE-778
    evidence_pattern: login(?!.*anomaly|.*behavioral|.*risk)|authenticate(?!.*unusual)
    explanation: |
      Credential stuffing produces distinct patterns: rapid attempts,
      geographic anomalies, unusual hours, new devices. Behavioral
      analysis can detect attacks that bypass other controls.
    remediation: |
      Implement login anomaly detection for impossible travel,
      unusual times, geographic anomalies. Calculate risk scores
      for login attempts. Alert and challenge high-risk logins.
  medium:
  - id: AUTH-CRED-MED-001
    signal: No login notification to users
    cwe: CWE-778
    evidence_pattern: login.*success(?!.*notify|.*email|.*alert)
    remediation: |
      Send email notifications for new device logins.
      Alert on logins from unusual locations.
      Provide login history in user account settings.
  - id: AUTH-CRED-MED-002
    signal: No suspicious activity monitoring
    cwe: CWE-778
    evidence_pattern: failed.*login(?!.*monitor|.*alert|.*log)
    remediation: |
      Log all authentication attempts with metadata.
      Monitor for credential stuffing attack patterns.
      Implement real-time alerting for attack detection.
  - id: AUTH-CRED-MED-003
    signal: CAPTCHA bypass possible via API
    cwe: CWE-307
    evidence_pattern: api.*login(?!.*captcha)|/api/.*auth(?!.*verify.*captcha)
    remediation: |
      Require CAPTCHA verification for API login attempts.
      Implement stricter rate limiting on API endpoints.
      Consider API-specific bot detection.
  - id: AUTH-CRED-MED-004
    signal: No geographic velocity checking
    cwe: CWE-384
    evidence_pattern: login(?!.*geo|.*location|.*velocity)|authenticate(?!.*impossible.*travel)
    remediation: |
      Implement impossible travel detection.
      Alert on logins from distant locations in short time.
      Require additional verification for geographic anomalies.
  low:
  - id: AUTH-CRED-LOW-001
    signal: Leaked credential monitoring not implemented
    evidence_pattern: user(?!.*breach.*monitor|.*compromised.*check)
    remediation: |
      Subscribe to breach notification services.
      Monitor for organization's credentials in breaches.
      Proactively force password reset for exposed accounts.
  positive:
  - id: AUTH-CRED-POS-001
    signal: Have I Been Pwned integration
    evidence_pattern: haveibeenpwned|pwnedpasswords|hibp|@pwnedpasswords
  - id: AUTH-CRED-POS-002
    signal: Bot management solution in use
    evidence_pattern: cloudflare.*bot|perimeterx|datadome|arkose
  - id: AUTH-CRED-POS-003
    signal: Device fingerprinting implemented
    evidence_pattern: fingerprintjs|deviceatlas|@fingerprintjs
  - id: AUTH-CRED-POS-004
    signal: Risk-based authentication implemented
    evidence_pattern: risk.*score|adaptive.*auth|step.*up.*auth
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Verify MFA Availability
    description: |
      Check for multi-factor authentication implementation.
    duration_estimate: 20 min
    commands:
    - purpose: Find MFA implementation
      command: grep -rn 'mfa\|MFA\|2fa\|totp\|webauthn\|passkey' --include='*.js' --include='*.ts' --include='*.py'
        --include='*.java' .
    expected_findings:
    - MFA implementation status
  - id: '2'
    name: Check Breached Password Detection
    description: |
      Verify integration with breached password databases.
    duration_estimate: 20 min
    commands:
    - purpose: Find breach checking
      command: grep -rn 'haveibeenpwned\|pwnedpasswords\|hibp\|breached.*password' --include='*.js' --include='*.ts'
        --include='*.py' .
    expected_findings:
    - Breach detection integration
  - id: '3'
    name: Review Bot Detection
    description: |
      Assess bot detection and CAPTCHA implementation.
    duration_estimate: 25 min
    commands:
    - purpose: Find bot detection
      command: grep -rn 'bot.*detect\|captcha\|recaptcha\|hcaptcha\|turnstile' --include='*.js' --include='*.ts'
        --include='*.py' --include='*.html' .
    - purpose: Check for bot management services
      command: grep -rn 'cloudflare\|perimeterx\|datadome\|arkose' --include='*.js' --include='*.ts' --include='*.py'
        --include='*.yaml' .
    expected_findings:
    - Bot detection implementation
    - CAPTCHA configuration
  - id: '4'
    name: Evaluate Intelligence Services
    description: |
      Check for IP reputation and device fingerprinting.
    duration_estimate: 25 min
    commands:
    - purpose: Find IP reputation
      command: grep -rn 'ip.*reputation\|threat.*intel\|abuseipdb\|ipqs' --include='*.js' --include='*.ts'
        --include='*.py' .
    - purpose: Find device fingerprinting
      command: grep -rn 'fingerprint\|deviceId\|device.*recognition' --include='*.js' --include='*.ts'
        --include='*.py' .
    expected_findings:
    - IP intelligence integration
    - Device fingerprinting status
  - id: '5'
    name: Review Monitoring and Alerting
    description: |
      Check for login anomaly detection and user notifications.
    duration_estimate: 20 min
    commands:
    - purpose: Find anomaly detection
      command: grep -rn 'anomaly\|suspicious\|risk.*score\|behavioral' --include='*.js' --include='*.ts'
        --include='*.py' .
    - purpose: Find login notifications
      command: grep -rn 'login.*notify\|new.*device.*email\|suspicious.*alert' --include='*.js' --include='*.ts'
        --include='*.py' .
    expected_findings:
    - Anomaly detection implementation
    - User notification status
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Defense Layer Assessment
    - Gap Analysis
    - Recommendations
  confidence_guidance:
    high: Direct evidence from code and configuration
    medium: Configuration patterns requiring verification
    low: Potential gaps requiring penetration testing
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: owasp-credential-stuffing
      priority: required
    - source_id: owasp-oat008
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires comprehensive defense layer analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: cred-001
  item: Multi-factor authentication available
  level: CRITICAL
  verification: |
    if grep -rq 'mfa\|MFA\|2fa\|totp\|webauthn' --include='*.js' --include='*.ts' --include='*.py' .; then echo "PASS"; else echo "FAIL - No MFA found"; fi
  expected: PASS
- id: cred-002
  item: Breached password detection implemented
  level: CRITICAL
  verification: |
    if grep -rq 'haveibeenpwned\|pwnedpasswords\|hibp\|breached.*password' --include='*.js' --include='*.ts' --include='*.py' .; then echo "PASS"; else echo "FAIL - No breach detection"; fi
  expected: PASS
- id: cred-003
  item: Bot detection or CAPTCHA on login
  level: BLOCKING
  verification: |
    if grep -rq 'captcha\|recaptcha\|hcaptcha\|bot.*detect' --include='*.js' --include='*.ts' --include='*.py' .; then echo "PASS"; else echo "FAIL - No bot detection"; fi
  expected: PASS
- id: cred-004
  item: Rate limiting on authentication endpoints
  level: BLOCKING
  verification: |
    if grep -rq 'rate.*limit\|rateLimit\|throttle' --include='*.js' --include='*.ts' --include='*.py' .; then echo "PASS"; else echo "FAIL - No rate limiting"; fi
  expected: PASS
- id: cred-005
  item: Login anomaly detection or monitoring
  level: WARNING
  verification: |
    if grep -rq 'anomaly\|suspicious.*login\|risk.*score' --include='*.js' --include='*.ts' --include='*.py' .; then echo "PASS"; else echo "WARNING - Verify monitoring"; fi
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: OWASP ASVS
    controls:
    - V2.1.7
    - V2.2.1
  - framework: OWASP Automated Threats
    controls:
    - OAT-008
  - framework: NIST SP 800-63B
    controls:
    - 5.1.1.2
relationships:
  commonly_combined:
  - security-trust.authentication.brute-force-protection
  - security-trust.authentication.mfa-implementation
  - security-trust.authentication.password-policy
