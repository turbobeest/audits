audit:
  id: security-trust.authentication.authentication-bypass
  name: Authentication Bypass Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: authentication
  tier: phd
  estimated_duration: 4 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit identifies authentication bypass vulnerabilities including
    improper authentication logic, alternate path bypasses, forced browsing,
    parameter manipulation, default credentials, and authentication state
    confusion. It covers OWASP Top 10:2021 A07 (Identification and
    Authentication Failures) and related CWE categories.
  why_it_matters: |
    Authentication bypass enables attackers to access systems without valid
    credentials, leading to data breaches, privilege escalation, and system
    compromise. Common vulnerabilities include SQL injection in login forms,
    insecure direct object references, JWT manipulation, and logic flaws
    that allow skipping authentication steps. OWASP API Security Top 10
    lists Broken Authentication (API2:2023) as a critical risk.
  when_to_run:
  - Before production deployment
  - After changes to authentication logic
  - During security assessments and penetration testing
  - When adding new authentication endpoints
# Tier Criteria Reference:
# - focused: Single tool/pattern analysis, <2 hours, minimal context needed
# - expert: Multiple tools, domain knowledge required, 2-6 hours, cross-cutting concerns
# - phd: Research-level analysis, novel synthesis, >6 hours, cutting-edge expertise needed

prerequisites:
  required_artifacts:
  - type: source_code
    description: Authentication logic, middleware, and endpoint handlers
  - type: configuration
    description: Authentication configuration and route definitions
  access_requirements:
  - Read access to authentication service codebase
  - Access to route/endpoint configurations
  - Understanding of authentication architecture
discovery:
  code_patterns:
  - pattern: isAuthenticated|isAuth|checkAuth|requireAuth
    type: regex
    scope: source
    purpose: Locate authentication checks
  - pattern: admin|Admin|ADMIN|isAdmin|role.*admin
    type: regex
    scope: source
    purpose: Find admin access controls
  - pattern: bypass|skip.*auth|no.*auth|public.*route
    type: regex
    scope: source
    purpose: Detect authentication bypass patterns
  - pattern: default.*password|admin.*admin|password123
    type: regex
    scope: source
    purpose: Find default credentials
  - pattern: \|\||or|OR.*1\s*=\s*1|'\s*=\s*'
    type: regex
    scope: source
    purpose: Detect SQL injection patterns in auth
  - pattern: req\.user|ctx\.user|session\.user
    type: regex
    scope: source
    purpose: Find user context usage
  - pattern: if\s*\(!?\s*(token|user|session)
    type: regex
    scope: source
    purpose: Find conditional authentication
  - pattern: next\(\)|return.*next|middleware.*skip
    type: regex
    scope: source
    purpose: Check middleware flow control
  - pattern: \?.*=.*admin|role=|isAdmin=|auth=
    type: regex
    scope: source
    purpose: Find parameter-based auth
  - pattern: force.*login|impersonate|switchUser
    type: regex
    scope: source
    purpose: Find user impersonation features
  file_patterns:
  - glob: '**/auth/**'
    purpose: Authentication module files
  - glob: '**/middleware/**'
    purpose: Middleware files
  - glob: '**/routes/**'
    purpose: Route definition files
  - glob: '**/login*'
    purpose: Login handling files
  - glob: '**/security*'
    purpose: Security configuration files
knowledge_sources:
  specifications:
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: nist-800-207
    name: NIST SP 800-207 Zero Trust Architecture
    url: https://csrc.nist.gov/publications/detail/sp/800-207/final
    offline_cache: true
    priority: required
  - id: nsa-zero-trust
    name: NSA Embracing a Zero Trust Security Model
    url: https://media.defense.gov/2021/Feb/25/2002588479/-1/-1/0/CSI_EMBRACING_ZT_SECURITY_MODEL_UOO115131-21.PDF
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: owasp-a07
    name: OWASP Top 10:2021 - A07 Identification and Authentication Failures
    url: https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/
    offline_cache: true
  - id: owasp-api2
    name: OWASP API Security - API2:2023 Broken Authentication
    url: https://owasp.org/API-Security/editions/2023/en/0xa2-broken-authentication/
    offline_cache: true
  - id: owasp-auth
    name: OWASP Authentication Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html
    offline_cache: true
  - id: owasp-testing-auth
    name: OWASP Testing for Authentication
    url: https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/04-Authentication_Testing/
    offline_cache: true
tooling:
  static_analysis:
  - tool: semgrep
    purpose: Authentication bypass patterns
    offline_capable: true
  - tool: eslint-plugin-security
    purpose: JavaScript security linting
    offline_capable: true
  - tool: bandit
    purpose: Python security linting
    offline_capable: true
  scripts:
  - id: auth-bypass-scanner
    language: bash
    purpose: Scan for authentication bypass vulnerabilities
    source: inline
    code: |
      #!/bin/bash
      echo "=== Authentication Bypass Scanner ==="
      echo "Bypass Patterns:"
      grep -rn "bypass\|skip.*auth\|no.*auth" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" .
      echo ""
      echo "Default Credentials:"
      grep -rn "password.*123\|admin.*admin\|default.*pass" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" --include="*.yaml" .
      echo ""
      echo "SQL Injection Patterns:"
      grep -rn "SELECT.*FROM.*WHERE.*=.*\+" --include="*.js" --include="*.ts" --include="*.py" --include="*.java" .
      echo ""
      echo "Parameter-Based Auth:"
      grep -rn "isAdmin.*req\.\|role.*req\.\|admin.*param" --include="*.js" --include="*.ts" --include="*.py" .
signals:
  critical:
  - id: AUTH-BYPASS-CRIT-001
    signal: SQL injection vulnerability in authentication query
    cwe: CWE-89
    evidence_pattern: SELECT.*FROM.*WHERE.*username.*=.*['"]\s*\+|password.*=.*['"]\s*\+.*req
    explanation: |
      SQL injection in login queries allows authentication bypass using
      payloads like ' OR '1'='1. Attackers can authenticate as any user
      or extract credentials from the database. This is a critical
      vulnerability enabling complete system compromise.
    remediation: |
      Use parameterized queries or prepared statements exclusively.
      Never concatenate user input into SQL queries. Use ORM methods
      with proper escaping. Implement input validation as defense in depth.
  - id: AUTH-BYPASS-CRIT-002
    signal: Default or hardcoded administrative credentials
    cwe: CWE-798
    evidence_pattern: admin.*password.*[=:]\s*['"]admin|default.*password.*[=:]\s*['"]password
    explanation: |
      Default credentials are well-known and frequently targeted by
      automated attacks. Hardcoded admin passwords enable immediate
      system takeover. OWASP lists this in Top 10 A07.
    remediation: |
      Remove all default credentials before production deployment.
      Force password change on first login. Generate random initial
      credentials. Implement credential scanning in CI/CD.
  - id: AUTH-BYPASS-CRIT-003
    signal: Authentication check returns early on missing token/user
    cwe: CWE-287
    evidence_pattern: if\s*\(!?token\)\s*\{?\s*return|if\s*\(!?user\)\s*\{?\s*next\(\)
    explanation: |
      Authentication middleware that calls next() or returns silently
      when tokens are missing allows unauthenticated requests through.
      All authentication failures must explicitly reject the request.
    remediation: |
      Always return 401 Unauthorized for missing or invalid credentials.
      Never call next() without verifying authentication succeeded.
      Use explicit deny-by-default authentication patterns.
  - id: AUTH-BYPASS-CRIT-004
    signal: User role/admin status from client-controlled parameter
    cwe: CWE-639
    evidence_pattern: isAdmin\s*=\s*req\.(body|query|params)\.isAdmin|role\s*=\s*req\.(body|query)
    explanation: |
      Taking authorization data from client-controllable parameters
      allows privilege escalation by manipulating request data.
      Attackers can set isAdmin=true or role=admin to gain elevated access.
    remediation: |
      Derive user roles from server-side session or verified token claims.
      Never trust client-provided authorization data. Validate role
      changes against current permissions.
  high:
  - id: AUTH-BYPASS-HIGH-001
    signal: Forced browsing to unprotected admin endpoints
    cwe: CWE-425
    evidence_pattern: \/admin(?!.*middleware|.*auth|.*protect)|admin.*endpoint(?!.*secure)
    explanation: |
      Admin endpoints without authentication allow direct access by
      guessing URLs. Attackers use automated tools to discover
      unprotected administrative functionality.
    remediation: |
      Apply authentication middleware to all admin routes.
      Implement route-level access control. Use defense in depth
      with IP restrictions for admin endpoints.
  - id: AUTH-BYPASS-HIGH-002
    signal: Authentication bypass using alternate path
    cwe: CWE-288
    evidence_pattern: api\/v[0-9]\/(?!.*auth)|internal\/(?!.*auth)|legacy\/(?!.*auth)
    explanation: |
      Multiple API versions or internal/legacy endpoints may lack
      authentication that protects primary endpoints. Attackers
      target alternate paths to bypass security controls.
    remediation: |
      Apply consistent authentication across all API versions.
      Deprecate and remove legacy endpoints. Audit all routes
      for authentication coverage.
  - id: AUTH-BYPASS-HIGH-003
    signal: User impersonation without proper authorization
    cwe: CWE-284
    evidence_pattern: impersonate(?!.*admin|.*audit)|switchUser(?!.*permission)|actAs(?!.*authorize)
    explanation: |
      Impersonation features without proper authorization checks
      allow privilege escalation. Support staff or attackers can
      access any user account without their credentials.
    remediation: |
      Restrict impersonation to authorized administrators only.
      Require additional authentication for impersonation.
      Log all impersonation events with audit trail.
  - id: AUTH-BYPASS-HIGH-004
    signal: Session fixation vulnerability
    cwe: CWE-384
    evidence_pattern: session\.id(?!.*regenerate)|login(?!.*session\.regenerate)|authenticate(?!.*newSession)
    explanation: |
      Not regenerating session IDs after login allows attackers to
      fixate a session ID before authentication, then hijack the
      authenticated session after the victim logs in.
    remediation: |
      Regenerate session ID immediately after successful login.
      Invalidate old session on authentication state change.
      Bind session to client fingerprint.
  medium:
  - id: AUTH-BYPASS-MED-001
    signal: Verbose authentication error messages
    cwe: CWE-209
    evidence_pattern: error.*user.*not.*found|error.*invalid.*password|username.*does.*not.*exist
    remediation: |
      Use generic error messages like "Invalid credentials".
      Do not reveal whether username or password was incorrect.
      Implement consistent response timing.
  - id: AUTH-BYPASS-MED-002
    signal: Authentication state not validated on sensitive operations
    cwe: CWE-306
    evidence_pattern: password.*change(?!.*auth)|email.*update(?!.*verify)|delete.*account(?!.*confirm)
    remediation: |
      Require re-authentication for sensitive operations.
      Implement step-up authentication. Verify session age
      before privileged actions.
  - id: AUTH-BYPASS-MED-003
    signal: Missing authentication on API endpoint
    cwe: CWE-306
    evidence_pattern: app\.(get|post|put|delete)\(['"]\/(api|user|data)(?!.*auth|.*middleware)
    remediation: |
      Apply authentication middleware to all API endpoints.
      Implement default-deny routing. Explicitly mark public
      endpoints with comments.
  - id: AUTH-BYPASS-MED-004
    signal: IDOR in authenticated context
    cwe: CWE-639
    evidence_pattern: findById\(req\.params\.id\)|getUser\(params\.userId\)(?!.*owner)
    remediation: |
      Verify resource ownership before access. Check if
      authenticated user has permission to access requested
      resource. Implement object-level authorization.
  low:
  - id: AUTH-BYPASS-LOW-001
    signal: Debug authentication mode flag
    evidence_pattern: DEBUG_AUTH|SKIP_AUTH.*development|auth.*disabled.*dev
    remediation: |
      Remove debug authentication flags in production.
      Use environment-based configuration. Implement CI checks
      for debug flags.
  positive:
  - id: AUTH-BYPASS-POS-001
    signal: Parameterized queries for authentication
    evidence_pattern: \$[0-9]|\?|:username|@username|prepared.*statement
  - id: AUTH-BYPASS-POS-002
    signal: Session regeneration on login
    evidence_pattern: regenerate.*session|session\.regenerateId|newSession
  - id: AUTH-BYPASS-POS-003
    signal: Object-level authorization implemented
    evidence_pattern: owner.*check|belongs.*to.*user|authorize.*resource
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Map Authentication Flows
    description: |
      Identify all authentication endpoints and protected routes.
    duration_estimate: 30 min
    commands:
    - purpose: Find authentication endpoints
      command: grep -rn 'login\|signin\|authenticate\|auth' --include='*.js' --include='*.ts' --include='*.py'
        --include='*.java' .
    - purpose: Find protected routes
      command: grep -rn 'isAuthenticated\|requireAuth\|authMiddleware\|@auth' --include='*.js' --include='*.ts'
        --include='*.py' --include='*.java' .
    expected_findings:
    - Authentication endpoint inventory
    - Protected route mapping
  - id: '2'
    name: Audit Authentication Logic
    description: |
      Review authentication logic for bypass vulnerabilities.
    duration_estimate: 45 min
    commands:
    - purpose: Find SQL query patterns in auth
      command: grep -rn 'SELECT.*password\|SELECT.*user.*WHERE' --include='*.js' --include='*.ts' --include='*.py'
        --include='*.java' .
    - purpose: Check for default credentials
      command: grep -rn 'admin.*password\|default.*credential\|password.*=.*["\x27]' --include='*.js'
        --include='*.ts' --include='*.py' --include='*.yaml' --include='*.env' .
    expected_findings:
    - SQL injection risks
    - Default credential usage
  - id: '3'
    name: Review Authorization Controls
    description: |
      Check for parameter-based auth and IDOR vulnerabilities.
    duration_estimate: 30 min
    commands:
    - purpose: Find role/admin checks
      command: grep -rn 'isAdmin\|role.*=\|userRole\|admin.*check' --include='*.js' --include='*.ts' --include='*.py'
        --include='*.java' .
    - purpose: Check for IDOR patterns
      command: grep -rn 'findById\(req\|getUser\(params\|userId.*=.*req' --include='*.js' --include='*.ts'
        --include='*.py' .
    expected_findings:
    - Authorization control assessment
    - IDOR vulnerability identification
  - id: '4'
    name: Verify Session Security
    description: |
      Check session handling and fixation prevention.
    duration_estimate: 30 min
    commands:
    - purpose: Find session handling
      command: grep -rn 'session\|Session' --include='*.js' --include='*.ts' --include='*.py' --include='*.java'
        . | grep -v node_modules
    - purpose: Check session regeneration
      command: grep -rn 'regenerate\|newSession\|destroy.*session' --include='*.js' --include='*.ts' --include='*.py'
        .
    expected_findings:
    - Session fixation protection status
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Authentication Flow Analysis
    - Bypass Vulnerability Assessment
    - Recommendations
  confidence_guidance:
    high: Direct evidence of exploitable vulnerability
    medium: Pattern matches requiring manual verification
    low: Potential issues requiring penetration testing
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: owasp-a07
      priority: required
    - source_id: owasp-api2
      priority: required
profiles:
  membership:
    quick:
      included: true
      reason: Critical security check
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: bypass-001
  item: No SQL injection in authentication queries
  level: CRITICAL
  verification: |
    if grep -rq 'SELECT.*FROM.*WHERE.*=.*["\x27]\s*+\|password.*=.*+.*req' --include='*.js' --include='*.ts' --include='*.py' .; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: bypass-002
  item: No default or hardcoded credentials
  level: CRITICAL
  verification: |
    if grep -rq 'admin.*password.*admin\|password.*=.*["\x27]password' --include='*.js' --include='*.ts' --include='*.py' --include='*.yaml' .; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: bypass-003
  item: All admin endpoints protected
  level: BLOCKING
  verification: manual
  verification_notes: Verify all /admin routes have authentication middleware
  expected: Confirmed by reviewer
- id: bypass-004
  item: No client-controlled authorization parameters
  level: BLOCKING
  verification: |
    if grep -rq 'isAdmin.*req\.(body\|query\|params)\|role.*req\.(body\|query)' --include='*.js' --include='*.ts' --include='*.py' .; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: bypass-005
  item: Session regenerated on login
  level: WARNING
  verification: |
    if grep -rq 'regenerate.*session\|session.*regenerate' --include='*.js' --include='*.ts' --include='*.py' .; then echo "PASS"; else echo "WARNING - Verify session handling"; fi
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: OWASP Top 10:2021
    controls:
    - A07:2021
  - framework: OWASP API Security Top 10
    controls:
    - API2:2023
  - framework: OWASP ASVS
    controls:
    - V2.1
    - V2.2
  - framework: CWE Top 25
    controls:
    - CWE-287
    - CWE-89
relationships:
  commonly_combined:
  - security-trust.authentication.session-management
  - security-trust.authentication.brute-force-protection
  - security-trust.authentication.oauth2-implementation
