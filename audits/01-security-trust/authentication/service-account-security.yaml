audit:
  id: security-trust.authentication.service-account-security
  name: Service Account Security Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: authentication
  tier: phd
  estimated_duration: 3 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines service account security practices including
    Kubernetes service accounts, cloud IAM service accounts, database
    service accounts, and application-level service identities. It evaluates
    least privilege enforcement, credential management, token auto-mounting,
    RBAC configuration, and workload identity federation.
  why_it_matters: |
    Service accounts often have elevated privileges and are primary targets
    for privilege escalation attacks. In Kubernetes, overly permissive service
    accounts can turn a container compromise into cluster-wide takeover.
    Cloud service accounts with excessive IAM permissions enable lateral
    movement and data exfiltration. CWE-250 (Execution with Unnecessary
    Privileges) and CWE-269 (Improper Privilege Management) are common
    findings in service account configurations.
  when_to_run:
  - Before production deployment of services
  - After changes to service account configurations
  - During Kubernetes security assessments
  - When implementing workload identity
prerequisites:
  required_artifacts:
  - type: configuration
    description: Kubernetes manifests, IAM policies, RBAC configurations
  - type: source_code
    description: Service authentication implementation code
  access_requirements:
  - Read access to Kubernetes manifests
  - Access to IAM policy configurations
  - Access to RBAC role definitions
discovery:
  code_patterns:
  - pattern: serviceAccount|ServiceAccount|service_account
    type: regex
    scope: config
    purpose: Locate service account definitions
  - pattern: automountServiceAccountToken
    type: regex
    scope: config
    purpose: Check token auto-mounting configuration
  - pattern: clusterRole|ClusterRole|cluster-admin
    type: regex
    scope: config
    purpose: Find cluster-wide role bindings
  - pattern: RoleBinding|ClusterRoleBinding
    type: regex
    scope: config
    purpose: Locate RBAC bindings
  - pattern: verbs:\s*\[.*\*.*\]|resources:\s*\[.*\*.*\]
    type: regex
    scope: config
    purpose: Detect wildcard RBAC permissions
  - pattern: iam\.serviceAccountUser|roles/iam
    type: regex
    scope: config
    purpose: Find IAM service account permissions
  - pattern: workloadIdentity|workload_identity_provider
    type: regex
    scope: config
    purpose: Check for workload identity federation
  - pattern: default.*serviceAccount|serviceAccountName:\s*default
    type: regex
    scope: config
    purpose: Detect use of default service account
  - pattern: TokenRequest|expirationSeconds
    type: regex
    scope: config
    purpose: Find short-lived token configuration
  - pattern: secretRef|valueFrom.*secretKeyRef
    type: regex
    scope: config
    purpose: Check for secret mounting patterns
  file_patterns:
  - glob: '**/*.yaml'
    purpose: Kubernetes manifests
  - glob: '**/*.yml'
    purpose: Configuration files
  - glob: '**/deployment*'
    purpose: Deployment configurations
  - glob: '**/service-account*'
    purpose: Service account definitions
  - glob: '**/rbac*'
    purpose: RBAC configurations
  - glob: '**/iam*'
    purpose: IAM policy files
knowledge_sources:
  specifications:
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: nist-800-207
    name: NIST SP 800-207 Zero Trust Architecture
    url: https://csrc.nist.gov/publications/detail/sp/800-207/final
    offline_cache: true
    priority: required
  - id: nsa-zero-trust
    name: NSA Embracing a Zero Trust Security Model
    url: https://media.defense.gov/2021/Feb/25/2002588479/-1/-1/0/CSI_EMBRACING_ZT_SECURITY_MODEL_UOO115131-21.PDF
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: k8s-rbac
    name: Kubernetes RBAC Best Practices
    url: https://kubernetes.io/docs/concepts/security/rbac-good-practices/
    offline_cache: true
  - id: gke-rbac
    name: GKE RBAC Best Practices
    url: https://cloud.google.com/kubernetes-engine/docs/best-practices/rbac
    offline_cache: true
  - id: owasp-nhi
    name: OWASP Non-Human Identities Top 10
    url: https://owasp.org/www-project-non-human-identities-top-10/
    offline_cache: true
  - id: cis-k8s
    name: CIS Kubernetes Benchmark
    url: https://www.cisecurity.org/benchmark/kubernetes
    offline_cache: true
tooling:
  static_analysis:
  - tool: kubesec
    purpose: Kubernetes manifest security scanning
    offline_capable: true
  - tool: kube-bench
    purpose: CIS Kubernetes benchmark validation
    offline_capable: true
  - tool: rbac-tool
    purpose: RBAC policy analysis
    offline_capable: true
  infrastructure_tools:
  - tool: kubectl
    purpose: Kubernetes RBAC inspection
    command: kubectl auth can-i --list --as=system:serviceaccount:NAMESPACE:SA_NAME
  scripts:
  - id: sa-security-scanner
    language: bash
    purpose: Scan for service account security issues
    source: inline
    code: |
      #!/bin/bash
      echo "=== Service Account Security Scanner ==="
      echo "Default Service Account Usage:"
      grep -rn "serviceAccountName:\s*default" --include="*.yaml" --include="*.yml" .
      echo ""
      echo "Auto-mounted Tokens (missing false):"
      grep -rn "automountServiceAccountToken" --include="*.yaml" --include="*.yml" . | grep -v "false"
      echo ""
      echo "Wildcard Permissions:"
      grep -rn 'verbs:.*\*\|resources:.*\*' --include="*.yaml" --include="*.yml" .
      echo ""
      echo "cluster-admin Bindings:"
      grep -rn "cluster-admin" --include="*.yaml" --include="*.yml" .
signals:
  critical:
  - id: AUTH-SA-CRIT-001
    signal: Service account bound to cluster-admin role
    cwe: CWE-250
    evidence_pattern: roleRef:\s*\n.*kind:\s*ClusterRole\s*\n.*name:\s*cluster-admin
    explanation: |
      Binding a service account to cluster-admin grants unrestricted
      access to all Kubernetes resources. A compromised container with
      this service account can take over the entire cluster, create
      backdoor accounts, and exfiltrate all secrets.
    remediation: |
      Create custom ClusterRoles with minimum required permissions.
      Use namespace-scoped Roles instead of ClusterRoles where possible.
      Implement RBAC review process before production deployment.
  - id: AUTH-SA-CRIT-002
    signal: Wildcard (*) permissions in RBAC rules
    cwe: CWE-732
    evidence_pattern: verbs:\s*\[.*['"]?\*['"]?.*\]|resources:\s*\[.*['"]?\*['"]?.*\]
    explanation: |
      Wildcard permissions grant access to all verbs or all resources,
      violating least privilege. This includes dangerous verbs like
      create, delete, escalate, and bind that enable privilege escalation.
    remediation: |
      Replace wildcards with explicit verb and resource lists.
      Only grant specifically required permissions. Use 'get', 'list',
      'watch' for read-only access. Avoid 'create', 'delete' for secrets.
  - id: AUTH-SA-CRIT-003
    signal: Service account credentials stored as long-lived secrets
    cwe: CWE-798
    evidence_pattern: kubernetes\.io/service-account-token|type:\s*kubernetes\.io/service-account\.name
    explanation: |
      Legacy service account tokens stored in Kubernetes Secrets don't
      expire and aren't rotated automatically. These tokens persist
      even after pods are deleted and can be extracted if secrets are
      compromised.
    remediation: |
      Use TokenRequest API for short-lived, auto-rotated tokens.
      Set expirationSeconds in projected service account tokens.
      Disable legacy token creation in Kubernetes 1.24+.
  high:
  - id: AUTH-SA-HIGH-001
    signal: Default service account used for workloads
    cwe: CWE-269
    evidence_pattern: serviceAccountName:\s*default|serviceAccount:\s*default
    explanation: |
      Using the default service account shares credentials across all
      pods in a namespace. Permissions granted to the default account
      affect all workloads, and compromise of one pod exposes all.
    remediation: |
      Create dedicated service accounts for each workload. Explicitly
      set serviceAccountName in pod specs. Never grant permissions to
      the default service account.
  - id: AUTH-SA-HIGH-002
    signal: Auto-mounting of service account tokens not disabled
    cwe: CWE-668
    evidence_pattern: automountServiceAccountToken:\s*true|spec:\s*(?!.*automountServiceAccountToken)
    explanation: |
      Kubernetes mounts service account tokens in all pods by default.
      Pods that don't need API access still have credentials that can
      be exploited if the container is compromised.
    remediation: |
      Set automountServiceAccountToken: false on service accounts or
      pod specs that don't require Kubernetes API access. Only mount
      tokens for workloads that explicitly need them.
  - id: AUTH-SA-HIGH-003
    signal: Service account can create or modify RBAC resources
    cwe: CWE-269
    evidence_pattern: resources:.*roles.*verbs:.*create|resources:.*rolebindings.*verbs:.*create
    explanation: |
      Service accounts that can create Roles or RoleBindings can
      escalate their own privileges by creating new bindings. This
      enables lateral movement and privilege escalation attacks.
    remediation: |
      Remove RBAC modification permissions from service accounts.
      Manage RBAC through GitOps or dedicated admin service accounts
      with additional access controls.
  - id: AUTH-SA-HIGH-004
    signal: Cloud IAM service account with broad permissions
    cwe: CWE-250
    evidence_pattern: roles/owner|roles/editor|iam\.serviceAccountTokenCreator
    explanation: |
      Cloud service accounts with Owner, Editor, or token creation
      permissions can access all resources and impersonate other
      service accounts. This enables complete cloud project takeover.
    remediation: |
      Use custom IAM roles with minimum required permissions.
      Implement workload identity federation instead of key files.
      Enable IAM conditions to restrict access scope.
  medium:
  - id: AUTH-SA-MED-001
    signal: No namespace scoping for service account permissions
    cwe: CWE-284
    evidence_pattern: kind:\s*ClusterRole(?!.*namespace)
    remediation: |
      Use namespace-scoped Roles instead of ClusterRoles when possible.
      Scope ClusterRoles to specific namespaces using RoleBindings.
      Implement namespace isolation policies.
  - id: AUTH-SA-MED-002
    signal: Service account token without expiration
    cwe: CWE-613
    evidence_pattern: serviceAccountToken:(?!.*expirationSeconds)
    remediation: |
      Use projected service account tokens with expirationSeconds.
      Set token lifetime to 1 hour or less for sensitive workloads.
      Implement token refresh logic in applications.
  - id: AUTH-SA-MED-003
    signal: Missing workload identity federation
    cwe: CWE-522
    evidence_pattern: GOOGLE_APPLICATION_CREDENTIALS|AWS_ACCESS_KEY_ID
    remediation: |
      Implement workload identity federation instead of static
      credentials. Use GKE Workload Identity, EKS IRSA, or Azure
      Workload Identity for cloud provider authentication.
  - id: AUTH-SA-MED-004
    signal: Service account can list secrets across namespaces
    cwe: CWE-200
    evidence_pattern: resources:.*secrets.*verbs:.*list|get.*secrets.*ClusterRole
    remediation: |
      Restrict secret access to specific namespaces and names.
      Use resourceNames to limit access to specific secrets.
      Implement admission controllers to prevent broad secret access.
  low:
  - id: AUTH-SA-LOW-001
    signal: Service account without description or labels
    evidence_pattern: kind:\s*ServiceAccount(?!.*metadata:.*annotations)
    remediation: |
      Add descriptive annotations and labels to service accounts.
      Document purpose, owner, and associated workloads.
      Enable service account inventory management.
  positive:
  - id: AUTH-SA-POS-001
    signal: Workload identity federation enabled
    evidence_pattern: workloadIdentityPool|iam\.gke\.io/gcp-service-account|eks\.amazonaws\.com/role-arn
  - id: AUTH-SA-POS-002
    signal: Auto-mount tokens disabled by default
    evidence_pattern: automountServiceAccountToken:\s*false
  - id: AUTH-SA-POS-003
    signal: Short-lived projected tokens in use
    evidence_pattern: expirationSeconds:\s*[0-9]+|projected:.*serviceAccountToken
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Inventory Service Accounts
    description: |
      Catalog all service accounts and their bindings.
    duration_estimate: 30 min
    commands:
    - purpose: Find Kubernetes service accounts
      command: grep -rn 'kind:\s*ServiceAccount' --include='*.yaml' --include='*.yml' .
    - purpose: Find service account references
      command: grep -rn 'serviceAccountName:\|serviceAccount:' --include='*.yaml' --include='*.yml' .
    expected_findings:
    - Complete service account inventory
  - id: '2'
    name: Audit RBAC Permissions
    description: |
      Review RBAC roles and bindings for excessive permissions.
    duration_estimate: 45 min
    commands:
    - purpose: Find cluster-admin bindings
      command: grep -rn 'cluster-admin' --include='*.yaml' --include='*.yml' .
    - purpose: Find wildcard permissions
      command: grep -rn 'verbs:.*\*\|resources:.*\*' --include='*.yaml' --include='*.yml' .
    - purpose: List all ClusterRoleBindings
      command: grep -rn 'kind:\s*ClusterRoleBinding' --include='*.yaml' --include='*.yml' .
    expected_findings:
    - Overly permissive role bindings
    - Wildcard permissions
  - id: '3'
    name: Verify Token Security
    description: |
      Check for proper token management and auto-mounting.
    duration_estimate: 30 min
    commands:
    - purpose: Check auto-mount configuration
      command: grep -rn 'automountServiceAccountToken' --include='*.yaml' --include='*.yml' .
    - purpose: Find legacy token secrets
      command: grep -rn 'kubernetes.io/service-account-token' --include='*.yaml' --include='*.yml' .
    - purpose: Find projected tokens with expiration
      command: grep -rn 'expirationSeconds' --include='*.yaml' --include='*.yml' .
    expected_findings:
    - Auto-mounting disabled where not needed
    - Short-lived tokens configured
  - id: '4'
    name: Review Cloud IAM
    description: |
      Assess cloud service account permissions and workload identity.
    duration_estimate: 30 min
    commands:
    - purpose: Find cloud IAM references
      command: grep -rn 'roles/\|iam\.\|serviceAccount:' --include='*.yaml' --include='*.yml' --include='*.tf'
        --include='*.json' .
    - purpose: Check for workload identity
      command: grep -rn 'workloadIdentity\|IRSA\|azure.*identity' --include='*.yaml' --include='*.yml'
        .
    expected_findings:
    - Cloud IAM permission assessment
    - Workload identity status
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - RBAC Analysis
    - Token Security Assessment
    - Recommendations
  confidence_guidance:
    high: Direct evidence from manifest analysis
    medium: Configuration patterns requiring runtime verification
    low: Potential issues requiring cluster inspection
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: k8s-rbac
      priority: required
    - source_id: cis-k8s
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Service account security requires thorough analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: sa-001
  item: No service accounts bound to cluster-admin
  level: CRITICAL
  verification: |
    if grep -rq 'name:\s*cluster-admin' --include='*.yaml' --include='*.yml' . | grep -q 'RoleBinding\|roleRef'; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: sa-002
  item: No wildcard RBAC permissions
  level: CRITICAL
  verification: |
    if grep -rq 'verbs:\s*\[.*"\*".*\]\|resources:\s*\[.*"\*".*\]' --include='*.yaml' --include='*.yml' .; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: sa-003
  item: Default service account not used for workloads
  level: BLOCKING
  verification: |
    if grep -rq 'serviceAccountName:\s*default' --include='*.yaml' --include='*.yml' .; then echo "FAIL"; else echo "PASS"; fi
  expected: PASS
- id: sa-004
  item: Auto-mount tokens disabled where not needed
  level: BLOCKING
  verification: manual
  verification_notes: 'Verify pods that don''t need API access have automountServiceAccountToken: false'
  expected: Confirmed by reviewer
- id: sa-005
  item: Workload identity or short-lived tokens used
  level: WARNING
  verification: |
    if grep -rq 'workloadIdentity\|expirationSeconds\|IRSA' --include='*.yaml' --include='*.yml' .; then echo "PASS"; else echo "WARNING - Verify token strategy"; fi
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: CIS Kubernetes Benchmark
    controls:
    - '5.1'
    - '5.2'
  - framework: OWASP NHI Top 10
    controls:
    - NHI4:2025
  - framework: SOC 2
    controls:
    - CC6.1
    - CC6.3
relationships:
  commonly_combined:
  - security-trust.authentication.api-key-management
  - security-trust.authentication.token-lifecycle
  - security-trust.authentication.certificate-authentication
