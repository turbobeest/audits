audit:
  id: security-trust.secrets-management.secret-access-logging
  name: Secret Access Logging Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: secrets-management
  tier: phd
  estimated_duration: 1.5 hours
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: infrastructure
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines whether secret access is properly logged and monitored
    for security audit trails and incident response. It evaluates audit logging
    configuration in secrets managers (Vault, AWS Secrets Manager, Azure Key Vault),
    log integrity protection, alerting on suspicious access patterns, and compliance
    with regulatory audit requirements.
  why_it_matters: |
    OWASP identifies security logging failures as a top risk (A09:2021). For
    secrets management, audit logging is critical to detect unauthorized access,
    investigate incidents, and maintain compliance with PCI-DSS, SOC 2, and GDPR.
    Without proper access logging, compromised credentials may go undetected
    indefinitely. The OWASP Secrets Management Cheat Sheet mandates comprehensive
    secret access auditing.
  when_to_run:
  - During secrets manager implementation
  - As part of compliance audits
  - When reviewing incident response capabilities
  - Quarterly security assessments
prerequisites:
  required_artifacts:
  - type: infrastructure_config
    description: Secrets manager and logging configuration
  access_requirements:
  - Read access to secrets manager audit configuration
  - Access to logging infrastructure configuration
  - View access to sample audit logs (metadata only)
discovery:
  code_patterns:
  - pattern: audit|AuditLog|audit_log|audit-log
    type: regex
    scope: config
    purpose: Audit logging configuration
  - pattern: cloudtrail|CloudTrail|audit_device|file_audit
    type: regex
    scope: config
    purpose: Cloud and Vault audit backends
  - pattern: alert|alarm|notification|webhook
    type: regex
    scope: config
    purpose: Alerting configuration
  - pattern: retention|archive|log.*days
    type: regex
    scope: config
    purpose: Log retention settings
  file_patterns:
  - glob: '**/vault/**'
    purpose: HashiCorp Vault configurations
  - glob: '**/terraform/**'
    purpose: Infrastructure-as-code with audit settings
  - glob: '**/cloudformation/**'
    purpose: AWS CloudFormation templates
  - glob: '**/logging/**'
    purpose: Logging configuration
knowledge_sources:
  specifications:
  - id: owasp-logging-cheatsheet
    name: OWASP Logging Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Logging_Cheat_Sheet.html
    offline_cache: true
    priority: required
  - id: owasp-secrets-management
    name: OWASP Secrets Management Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
    offline_cache: true
    priority: required
  - id: cwe-778
    name: 'CWE-778: Insufficient Logging'
    url: https://cwe.mitre.org/data/definitions/778.html
    offline_cache: true
    priority: required
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: owasp-top10-a09
    name: OWASP Top 10 A09 - Security Logging and Monitoring Failures
    url: https://owasp.org/Top10/2021/A09_2021-Security_Logging_and_Monitoring_Failures/
    offline_cache: true
  - id: owasp-proactive-c9
    name: OWASP Proactive Controls C9 - Security Logging and Monitoring
    url: https://owasp.org/www-project-proactive-controls/v3/en/c9-security-logging
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: vault
    purpose: Check Vault audit device configuration
    command: vault audit list
  - tool: aws
    purpose: Check CloudTrail configuration
    command: aws cloudtrail describe-trails
  scripts:
  - id: secret-audit-logging-scan
    language: bash
    purpose: Scan for secret access logging configuration
    source: inline
    code: |
      #!/bin/bash
      echo "=== Scanning for Secret Access Logging Configuration ==="

      # Check Vault audit configuration
      grep -rn 'audit\|file_audit\|syslog_audit' . 2>/dev/null | grep vault | head -20

      # Check CloudTrail configuration
      grep -rn 'cloudtrail\|CloudTrail' . 2>/dev/null | head -20

      # Check for alerting
      grep -rn 'alarm\|alert\|notification' . 2>/dev/null | grep -i secret | head -20
signals:
  critical:
  - id: AUDIT-CRIT-001
    signal: No audit logging enabled for secrets manager
    evidence_pattern: vault|secretsmanager|keyvault
    explanation: |
      Secrets managers without audit logging provide no visibility into
      who accessed what secrets and when. Unauthorized access cannot be
      detected or investigated. CWE-778.
    remediation: Enable audit logging on all secrets managers
    cwe: CWE-778
  - id: AUDIT-CRIT-002
    signal: Audit logs stored without integrity protection
    explanation: |
      Audit logs must be tamper-proof. Without integrity protection,
      attackers can delete or modify logs to hide their activities. CWE-779.
    remediation: Use append-only storage, log signing, or WORM storage
    cwe: CWE-779
  high:
  - id: AUDIT-HIGH-001
    signal: No alerting on suspicious secret access patterns
    explanation: |
      Without alerting, security teams cannot respond to attacks in
      real-time. Bulk secret access, unusual sources, or off-hours
      access should trigger alerts. CWE-778.
    remediation: Implement alerting for anomalous secret access patterns
    cwe: CWE-778
  - id: AUDIT-HIGH-002
    signal: Insufficient audit log retention
    evidence_pattern: retention.*[0-9]\s*days|days.*[0-9]\{1,2\}
    explanation: |
      Compliance frameworks require extended log retention (PCI-DSS: 1 year,
      SOC 2: varies). Short retention periods prevent incident investigation.
    remediation: Configure retention to meet compliance requirements (minimum 1 year)
  - id: AUDIT-HIGH-003
    signal: Audit logs missing required fields
    explanation: |
      Audit logs should capture: who (identity), what (secret accessed),
      when (timestamp), where (source IP), and outcome (success/failure).
      Missing fields limit forensic capability. CWE-223.
    remediation: Configure comprehensive logging with all required fields
    cwe: CWE-223
  - id: AUDIT-HIGH-004
    signal: No centralized log aggregation
    explanation: |
      Distributed logs across multiple systems make correlation and
      investigation difficult. Attackers may compromise individual
      systems to delete local logs.
    remediation: Implement centralized log aggregation (SIEM, ELK, Splunk)
  medium:
  - id: AUDIT-MED-001
    signal: No automated log analysis
    explanation: |
      Manual log review is insufficient for detecting attacks at scale.
      Automated analysis can identify patterns humans would miss.
    remediation: Implement SIEM with detection rules for secret access anomalies
  - id: AUDIT-MED-002
    signal: Audit logs not encrypted at rest
    explanation: |
      Audit logs may contain sensitive metadata about secret access.
      Encryption at rest protects against unauthorized log access.
    remediation: Enable encryption for audit log storage
  - id: AUDIT-MED-003
    signal: No log access controls
    explanation: |
      Audit logs should have restricted access. Wide access enables
      attackers to review logs for intelligence gathering.
    remediation: Implement least-privilege access controls for audit logs
  positive:
  - id: AUDIT-POS-001
    signal: Comprehensive audit logging enabled
  - id: AUDIT-POS-002
    signal: Real-time alerting configured
  - id: AUDIT-POS-003
    signal: Log integrity protection (signing/WORM)
  - id: AUDIT-POS-004
    signal: Centralized SIEM integration
  - id: AUDIT-POS-005
    signal: Compliance-appropriate log retention
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify secrets management systems
    description: |
      Locate all secrets management solutions and their
      audit logging configuration.
    duration_estimate: 15 min
    commands:
    - purpose: Find Vault audit configuration
      command: grep -rn 'audit\|file_audit\|syslog_audit' . 2>/dev/null | grep -i vault | head -20
    - purpose: Find AWS Secrets Manager with CloudTrail
      command: grep -rn 'cloudtrail\|CloudTrail' . 2>/dev/null | head -20
    - purpose: Find Azure Key Vault diagnostics
      command: grep -rn 'diagnosticSettings\|AuditEvent' . 2>/dev/null | grep -i keyvault | head -20
    expected_findings:
    - Secrets manager identification
    - Audit configuration presence
  - id: '2'
    name: Evaluate audit log completeness
    description: |
      Verify that audit logs capture all required information
      for security investigation.
    duration_estimate: 20 min
    commands:
    - purpose: Check Vault audit format
      command: grep -rn 'log_raw\|hmac_accessor\|format' . 2>/dev/null | grep -i vault | head -20
    - purpose: Check CloudTrail event selectors
      command: grep -rn 'eventSelector\|dataResources\|ReadWriteType' . 2>/dev/null | head -20
    - purpose: Find log field configuration
      command: grep -rn 'timestamp\|identity\|source.ip\|operation' . 2>/dev/null | grep -i audit | head
        -20
    expected_findings:
    - Log field coverage
    - Audit detail level
  - id: '3'
    name: Check log protection and retention
    description: |
      Verify that audit logs are protected from tampering
      and retained for compliance requirements.
    duration_estimate: 20 min
    commands:
    - purpose: Find retention configuration
      command: grep -rn -iE 'retention|archive|days|years' . 2>/dev/null | grep -iE 'log|audit' | head
        -20
    - purpose: Check for log encryption
      command: grep -rn 'encryption\|kms.*log\|log.*encrypt' . 2>/dev/null | head -20
    - purpose: Check for immutable storage
      command: grep -rn 'WORM\|object.lock\|immutable\|append.only' . 2>/dev/null | head -20
    expected_findings:
    - Retention period configuration
    - Log protection mechanisms
  - id: '4'
    name: Review alerting configuration
    description: |
      Examine alerting for suspicious secret access patterns
      and security events.
    duration_estimate: 20 min
    commands:
    - purpose: Find CloudWatch alarms for secrets
      command: grep -rn 'alarm\|Alarm' . 2>/dev/null | grep -iE 'secret|vault|credential' | head -20
    - purpose: Find SNS/notification configuration
      command: grep -rn 'SNS\|notification\|webhook\|alert' . 2>/dev/null | grep -i secret | head -20
    - purpose: Check for SIEM integration
      command: grep -rn 'splunk\|elasticsearch\|datadog\|sumologic\|siem' . 2>/dev/null | head -20
    expected_findings:
    - Alerting configuration
    - SIEM integration
  - id: '5'
    name: Verify log aggregation
    description: |
      Confirm that logs from all sources are aggregated
      centrally for analysis.
    duration_estimate: 15 min
    commands:
    - purpose: Find log shipping configuration
      command: grep -rn 'fluentd\|logstash\|filebeat\|kinesis\|firehose' . 2>/dev/null | head -20
    - purpose: Check for centralized logging
      command: grep -rn 's3.*log\|log.*bucket\|cloudwatch.*logs' . 2>/dev/null | head -20
    expected_findings:
    - Log aggregation method
    - Central log destination
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Audit Logging Assessment
    - Alerting Capability
    - Compliance Status
    - Recommendations
  confidence_guidance:
    high: Direct evidence of missing or misconfigured audit logging
    medium: Incomplete configuration that may lead to logging gaps
    low: Configuration concerns requiring runtime verification
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: owasp-logging-cheatsheet
      priority: required
    - source_id: owasp-secrets-management
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires infrastructure analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: secret-access-logging-001
  item: Audit logging enabled for secrets manager
  level: CRITICAL
  verification: grep -rn 'audit\|cloudtrail\|diagnosticSettings' . 2>/dev/null | grep -iE 'vault|secret|keyvault'
    | head -1 | grep -q . && echo PASS || echo FAIL
  expected: PASS
- id: secret-access-logging-002
  item: Alerting configured for secret access
  level: BLOCKING
  verification: grep -rn 'alarm\|alert\|notification' . 2>/dev/null | grep -iE 'secret|vault|credential'
    | head -1 | grep -q . && echo PASS || echo FAIL
  expected: PASS
- id: secret-access-logging-003
  item: Log retention meets compliance requirements
  level: BLOCKING
  verification: manual
  verification_notes: Verify log retention is at least 1 year for PCI-DSS compliance
  expected: Confirmed by reviewer
- id: secret-access-logging-004
  item: Centralized log aggregation
  level: WARNING
  verification: grep -rn 'splunk\|elasticsearch\|siem\|logstash\|fluentd' . 2>/dev/null | head -1 | grep
    -q . && echo PASS || echo FAIL
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: CWE
    controls:
    - CWE-778
    - CWE-779
    - CWE-223
  - framework: OWASP Top 10
    controls:
    - A09:2021-Security Logging and Monitoring Failures
  - framework: PCI-DSS
    controls:
    - '10.1'
    - '10.2'
    - '10.3'
    - '10.7'
  - framework: SOC 2
    controls:
    - CC7.2
    - CC7.3
relationships:
  commonly_combined:
  - security-trust.secrets-management.secret-storage
  - security-trust.secrets-management.secret-rotation
  - security-trust.application-security.security-monitoring
