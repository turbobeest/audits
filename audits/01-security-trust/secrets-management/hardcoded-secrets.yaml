audit:
  id: security-trust.secrets-management.hardcoded-secrets
  name: Hardcoded Secrets Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: secrets-management
  tier: phd
  estimated_duration: 1.5 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: 'yes'
  severity: critical
  scope: codebase
  default_profiles:
  - full
  - security
  - quick
  blocks_phase: true
  parallelizable: true
description:
  what: |
    This audit scans source code, configuration files, and version control
    history for hardcoded secrets including API keys, passwords, tokens,
    cryptographic keys, connection strings, and other credentials. Detection
    uses pattern matching, entropy analysis, and known secret formats to
    identify embedded credentials that should be externalized.
  why_it_matters: |
    Hardcoded secrets are a critical security vulnerability classified as
    CWE-798 (Use of Hard-coded Credentials), CWE-259 (Use of Hard-coded Password),
    and CWE-321 (Use of Hard-coded Cryptographic Key). Exposed secrets can lead
    to unauthorized access, data breaches, and complete system compromise. Many
    bug bounty programs and CVEs relate to accidentally committed credentials.
  when_to_run:
  - On every commit (pre-commit hook)
  - During CI/CD pipeline execution
  - Before code reviews
  - Periodically on existing codebases
prerequisites:
  required_artifacts:
  - type: source_code
    description: Complete source code repository including history
  access_requirements:
  - Read access to all source code files
  - Access to git history for historical secret detection
discovery:
  code_patterns:
  - pattern: (?i)(api[_-]?key|apikey)['"]?\s*[:=]\s*['"][a-zA-Z0-9_\-]{20,}['"]
    type: regex
    scope: source
    purpose: Detect API key assignments
  - pattern: AKIA[0-9A-Z]{16}
    type: regex
    scope: source
    purpose: Detect AWS Access Key IDs
  - pattern: (?i)aws[_-]?secret[_-]?access[_-]?key['"]?\s*[:=]\s*['"][A-Za-z0-9/+=]{40}['"]
    type: regex
    scope: source
    purpose: Detect AWS Secret Access Keys
  - pattern: gh[pousr]_[A-Za-z0-9_]{36,}
    type: regex
    scope: source
    purpose: Detect GitHub Personal Access Tokens
  - pattern: glpat-[A-Za-z0-9\-_]{20,}
    type: regex
    scope: source
    purpose: Detect GitLab Personal Access Tokens
  - pattern: (?i)(password|passwd|pwd|secret|token)['"]?\s*[:=]\s*['"][^'"\s]{8,}['"]
    type: regex
    scope: source
    purpose: Detect password/secret assignments
  - pattern: '-----BEGIN (RSA |EC |DSA |OPENSSH |PGP )?PRIVATE KEY-----'
    type: regex
    scope: source
    purpose: Detect embedded private keys
  - pattern: (?i)jwt[_-]?secret['"]?\s*[:=]\s*['"][^'"\s]{16,}['"]
    type: regex
    scope: source
    purpose: Detect JWT signing secrets
  - pattern: (?i)(mongodb|postgres|mysql|redis)://[^\s'"]+:[^\s'"]+@
    type: regex
    scope: source
    purpose: Detect database connection strings with credentials
  file_patterns:
  - glob: '**/*.{js,ts,py,java,rb,go,php,cs}'
    purpose: Source code files
  - glob: '**/*.{json,yaml,yml,xml,properties,ini,cfg,conf}'
    purpose: Configuration files
  - glob: '**/.env*'
    purpose: Environment files that may contain secrets
  - glob: '**/config/**'
    purpose: Configuration directories
knowledge_sources:
  specifications:
  - id: cwe-798
    name: 'CWE-798: Use of Hard-coded Credentials'
    url: https://cwe.mitre.org/data/definitions/798.html
    offline_cache: true
    priority: required
  - id: cwe-259
    name: 'CWE-259: Use of Hard-coded Password'
    url: https://cwe.mitre.org/data/definitions/259.html
    offline_cache: true
    priority: required
  - id: owasp-secrets-management
    name: OWASP Secrets Management Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
    offline_cache: true
    priority: required
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: owasp-devsecops-secrets
    name: OWASP DevSecOps Hardcoded Secrets Detection
    url: https://github.com/OWASP/www-project-devsecops-verification-standard/blob/main/document/CODE-002-Hardcoded-Secrets-Detection.md
    offline_cache: true
tooling:
  static_analysis:
  - tool: gitleaks
    purpose: Detect secrets in git history and current files
    offline_capable: true
  - tool: trufflehog
    purpose: Entropy-based and pattern-based secret detection
    offline_capable: true
  - tool: detect-secrets
    purpose: Yelp's secret detection tool with baseline support
    offline_capable: true
  - tool: git-secrets
    purpose: AWS Labs tool for preventing secret commits
    offline_capable: true
  scripts:
  - id: secret-patterns-scan
    language: bash
    purpose: Scan for common hardcoded secret patterns
    source: inline
    code: |
      #!/bin/bash
      echo "=== Scanning for Hardcoded Secrets ==="

      # AWS Access Key IDs
      echo "Checking for AWS keys..."
      grep -rn --include="*.{js,ts,py,java,go,rb,php}" 'AKIA[0-9A-Z]{16}' . 2>/dev/null

      # Private keys
      echo "Checking for private keys..."
      grep -rn '-----BEGIN.*PRIVATE KEY-----' . 2>/dev/null

      # Generic passwords
      echo "Checking for password patterns..."
      grep -rn --include="*.{js,ts,py,java,go}" -E "password\s*[=:]\s*['\"][^'\"]{8,}['\"]" . 2>/dev/null

      # High entropy strings (simplified)
      echo "Checking for GitHub tokens..."
      grep -rn 'gh[pousr]_[A-Za-z0-9_]{36,}' . 2>/dev/null
signals:
  critical:
  - id: SECRET-CRIT-001
    signal: AWS Access Key exposed in code
    evidence_pattern: AKIA[0-9A-Z]{16}
    explanation: |
      AWS Access Key IDs are clearly identifiable by the AKIA prefix. When
      exposed, attackers can attempt to find the corresponding secret key
      or use leaked credentials for unauthorized access. CWE-798.
    remediation: Rotate the key immediately, use AWS Secrets Manager or environment variables
    cwe: CWE-798
  - id: SECRET-CRIT-002
    signal: Private key embedded in source code
    evidence_pattern: '-----BEGIN (RSA |EC |DSA |OPENSSH |PGP )?PRIVATE KEY-----'
    explanation: |
      Private cryptographic keys must never be stored in source code. Exposed
      private keys allow attackers to decrypt data, impersonate services,
      sign malicious content, or gain SSH access. CWE-321.
    remediation: Remove from repo, rotate keys, use secrets manager or HSM
    cwe: CWE-321
  - id: SECRET-CRIT-003
    signal: GitHub/GitLab access token in code
    evidence_pattern: gh[pousr]_[A-Za-z0-9_]{36,}|glpat-[A-Za-z0-9\-_]{20,}
    explanation: |
      SCM access tokens provide repository access and potentially CI/CD
      pipeline access. Exposed tokens can lead to source code theft,
      supply chain attacks, or infrastructure compromise. CWE-798.
    remediation: Revoke token immediately, use GitHub/GitLab secrets for CI/CD
    cwe: CWE-798
  - id: SECRET-CRIT-004
    signal: Database connection string with credentials
    evidence_pattern: (?i)(mongodb|postgres|mysql|redis)://[^:]+:[^@]+@
    explanation: |
      Connection strings containing passwords expose database credentials.
      Attackers can directly access databases, exfiltrate data, or
      modify records. CWE-259.
    remediation: Use environment variables or secrets manager for connection strings
    cwe: CWE-259
  high:
  - id: SECRET-HIGH-001
    signal: Hardcoded password in configuration
    evidence_pattern: (?i)password['"]?\s*[:=]\s*['"][^'"\s]{8,}['"]
    explanation: |
      Passwords hardcoded in configuration files can be discovered through
      source code access, build artifacts, or container images. CWE-259.
    remediation: Externalize to environment variables or secrets manager
    cwe: CWE-259
  - id: SECRET-HIGH-002
    signal: JWT/session secret in source code
    evidence_pattern: (?i)(jwt|session)[_-]?secret['"]?\s*[:=]\s*['"][^'"\s]{16,}['"]
    explanation: |
      JWT signing secrets allow attackers to forge valid tokens, bypassing
      authentication entirely. Session secrets can enable session hijacking
      or fixation attacks. CWE-798.
    remediation: Use cryptographically random secrets stored in secrets manager
    cwe: CWE-798
  - id: SECRET-HIGH-003
    signal: API key with significant length in code
    evidence_pattern: (?i)api[_-]?key['"]?\s*[:=]\s*['"][a-zA-Z0-9_\-]{20,}['"]
    explanation: |
      API keys provide access to external services and may have billing
      implications. Exposed keys can lead to unauthorized API usage,
      data access, or financial impact. CWE-798.
    remediation: Store API keys in environment variables or secrets manager
    cwe: CWE-798
  medium:
  - id: SECRET-MED-001
    signal: Suspicious high-entropy string
    explanation: |
      Strings with high Shannon entropy may be encoded secrets, tokens,
      or keys even if they don't match known patterns. Requires manual
      verification. CWE-798.
    remediation: Review high-entropy strings and externalize if they are secrets
    cwe: CWE-798
  - id: SECRET-MED-002
    signal: .env file committed to repository
    evidence_pattern: \.env$|\.env\.local|\.env\.production
    explanation: |
      Environment files often contain secrets and should not be committed.
      Even if current values are placeholders, file patterns establish
      dangerous precedents. CWE-540.
    remediation: Add .env* to .gitignore, use .env.example with placeholder values
    cwe: CWE-540
  positive:
  - id: SECRET-POS-001
    signal: .env files properly gitignored
  - id: SECRET-POS-002
    signal: Pre-commit hooks for secret detection configured
  - id: SECRET-POS-003
    signal: Environment variable references for sensitive values
  - id: SECRET-POS-004
    signal: Secrets manager integration (AWS SM, Vault, etc.)
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Run automated secret scanners
    description: |
      Execute multiple secret detection tools to identify hardcoded
      credentials using pattern matching and entropy analysis.
    duration_estimate: 15 min
    commands:
    - purpose: Run gitleaks on repository
      command: gitleaks detect --source . --verbose 2>/dev/null || echo 'Gitleaks not installed'
    - purpose: Run trufflehog
      command: trufflehog filesystem . 2>/dev/null || echo 'Trufflehog not installed'
    - purpose: Check git history for secrets
      command: gitleaks detect --source . --log-opts='--all' 2>/dev/null || echo 'History scan requires
        gitleaks'
    expected_findings:
    - Automated secret detection results
    - Historical secrets in git commits
  - id: '2'
    name: Search for common secret patterns
    description: |
      Use regex patterns to search for known secret formats across
      the codebase.
    duration_estimate: 20 min
    commands:
    - purpose: Find AWS keys
      command: grep -rn 'AKIA[0-9A-Z]\{16\}' . 2>/dev/null | grep -v node_modules
    - purpose: Find private keys
      command: grep -rn '\-\-\-\-\-BEGIN.*PRIVATE KEY' . 2>/dev/null | grep -v node_modules
    - purpose: Find password assignments
      command: grep -rn -E '(password|passwd|pwd)\s*[=:]\s*["'\'''][^"'\''\s]{8,}' . 2>/dev/null | grep
        -v node_modules | head -30
    - purpose: Find connection strings with passwords
      command: grep -rn -E '(mongodb|postgres|mysql|redis)://[^:]+:[^@]+@' . 2>/dev/null | grep -v node_modules
    expected_findings:
    - Pattern-matched secrets
    - Credential patterns in code
  - id: '3'
    name: Check configuration files
    description: |
      Examine configuration files that commonly contain secrets
      such as .env files, config.json, application.properties.
    duration_estimate: 15 min
    commands:
    - purpose: Find .env files in repo
      command: find . -name '.env*' -not -name '.env.example' -not -name '.env.sample' 2>/dev/null | grep
        -v node_modules
    - purpose: Check for secrets in JSON config
      command: grep -rn --include='*.json' -E '"(password|secret|key|token)"\s*:\s*"[^"]+"' . 2>/dev/null
        | grep -v node_modules | grep -v package
    - purpose: Check YAML config files
      command: grep -rn --include='*.yaml' --include='*.yml' -E '(password|secret|key|token):\s*[^$\{]'
        . 2>/dev/null | grep -v node_modules | head -20
    expected_findings:
    - Secrets in configuration files
    - Committed .env files
  - id: '4'
    name: Verify gitignore configuration
    description: |
      Ensure .gitignore properly excludes files that typically
      contain secrets.
    duration_estimate: 10 min
    commands:
    - purpose: Check gitignore for .env exclusion
      command: grep -E '^\.env|\*\.env' .gitignore 2>/dev/null || echo '.env not in gitignore'
    - purpose: Check for secret file exclusions
      command: grep -E 'secrets|credentials|\*\.pem|\*\.key' .gitignore 2>/dev/null || echo 'No secret
        exclusions in gitignore'
    expected_findings:
    - Gitignore coverage for sensitive files
    - Missing exclusion patterns
  - id: '5'
    name: Check for pre-commit protection
    description: |
      Verify that pre-commit hooks are configured to prevent
      accidental secret commits.
    duration_estimate: 10 min
    commands:
    - purpose: Check for pre-commit config
      command: cat .pre-commit-config.yaml 2>/dev/null | grep -E 'gitleaks|detect-secrets|trufflehog'
        || echo 'No secret detection in pre-commit'
    - purpose: Check for git-secrets configuration
      command: git config --get-all secrets.patterns 2>/dev/null || echo 'git-secrets not configured'
    expected_findings:
    - Pre-commit hook configuration
    - Secret detection automation
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Critical Exposures
    - Remediation Priorities
    - Prevention Recommendations
  confidence_guidance:
    high: Known secret format matched (AWS keys, private keys, tokens)
    medium: Password-like pattern with sufficient entropy
    low: High-entropy string requiring manual verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: cwe-798
      priority: required
    - source_id: owasp-secrets-management
      priority: required
profiles:
  membership:
    quick:
      included: true
      priority: 1
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: hardcoded-secrets-001
  item: No AWS access keys in code
  level: CRITICAL
  verification: grep -rn 'AKIA[0-9A-Z]\{16\}' . 2>/dev/null | grep -v node_modules | wc -l | xargs -I
    {} test {} -eq 0 && echo PASS || echo FAIL
  expected: PASS
- id: hardcoded-secrets-002
  item: No private keys in repository
  level: CRITICAL
  verification: grep -rn '\-\-\-\-\-BEGIN.*PRIVATE KEY' . 2>/dev/null | grep -v node_modules | wc -l |
    xargs -I {} test {} -eq 0 && echo PASS || echo FAIL
  expected: PASS
- id: hardcoded-secrets-003
  item: .env files excluded from git
  level: BLOCKING
  verification: grep -E '^\.env' .gitignore 2>/dev/null && echo PASS || echo FAIL
  expected: PASS
- id: hardcoded-secrets-004
  item: Pre-commit secret scanning configured
  level: WARNING
  verification: cat .pre-commit-config.yaml 2>/dev/null | grep -qE 'gitleaks|detect-secrets' && echo PASS
    || echo FAIL
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: CWE
    controls:
    - CWE-798
    - CWE-259
    - CWE-321
    - CWE-540
  - framework: OWASP Top 10
    controls:
    - A02:2021-Cryptographic Failures
  - framework: PCI-DSS
    controls:
    - '3.4'
    - 6.5.3
  - framework: SOC 2
    controls:
    - CC6.1
relationships:
  commonly_combined:
  - security-trust.secrets-management.secret-storage
  - security-trust.secrets-management.environment-variable-security
  - security-trust.secrets-management.pipeline-secrets
