audit:
  id: security-trust.secrets-management.pipeline-secrets
  name: Build Pipeline Secret Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: secrets-management
  tier: expert
  estimated_duration: 2 hours
  completeness: complete
  requires_runtime: false
  destructive: false
execution:
  automatable: partial
  severity: critical
  scope: infrastructure
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit examines CI/CD pipeline configurations for secure secrets handling
    including GitHub Actions, GitLab CI, Jenkins, CircleCI, and other build systems.
    It evaluates secret storage, access controls, exposure risks in logs, artifact
    security, and protection against Poisoned Pipeline Execution (PPE) attacks.
  why_it_matters: |
    OWASP Top 10 CI/CD Security Risks highlights secrets exposure as a critical risk.
    The Codecov breach demonstrated how attackers can exfiltrate secrets from build
    environments at scale. CI/CD pipelines often have access to production credentials,
    signing keys, and deployment tokens, making them high-value targets. Secrets
    must never be hardcoded, printed, or stored in artifacts.
  when_to_run:
  - When setting up new CI/CD pipelines
  - During DevSecOps security reviews
  - After security incidents involving pipeline compromise
  - Quarterly pipeline security audits
prerequisites:
  required_artifacts:
  - type: pipeline_config
    description: CI/CD configuration files (.github/workflows, .gitlab-ci.yml, Jenkinsfile)
  access_requirements:
  - Read access to CI/CD configuration files
  - View access to pipeline secrets (metadata only)
  - Access to pipeline logs (sample review)
discovery:
  code_patterns:
  - pattern: secrets\.|\$\{\{\s*secrets\.
    type: regex
    scope: config
    purpose: GitHub Actions secrets usage
  - pattern: \$CI_.*|\$GITLAB_
    type: regex
    scope: config
    purpose: GitLab CI variables
  - pattern: credentials\(|withCredentials
    type: regex
    scope: config
    purpose: Jenkins credentials usage
  - pattern: 'echo.*\$|print.*\$|env:'
    type: regex
    scope: config
    purpose: Potential secret printing
  file_patterns:
  - glob: '**/.github/workflows/*.{yaml,yml}'
    purpose: GitHub Actions workflows
  - glob: '**/.gitlab-ci.yml'
    purpose: GitLab CI configuration
  - glob: '**/Jenkinsfile*'
    purpose: Jenkins pipeline definitions
  - glob: '**/.circleci/config.yml'
    purpose: CircleCI configuration
  - glob: '**/azure-pipelines.yml'
    purpose: Azure DevOps pipelines
knowledge_sources:
  specifications:
  - id: owasp-cicd-risks
    name: OWASP Top 10 CI/CD Security Risks
    url: https://owasp.org/www-project-top-10-ci-cd-security-risks/
    offline_cache: true
    priority: required
  - id: owasp-cicd-cheatsheet
    name: OWASP CI/CD Security Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/CI_CD_Security_Cheat_Sheet.html
    offline_cache: true
    priority: required
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: github-secrets-security
    name: GitHub Actions Security - Secrets
    url: https://docs.github.com/en/actions/security-guides/encrypted-secrets
    offline_cache: true
  - id: cicd-sec-4-ppe
    name: 'CICD-SEC-4: Poisoned Pipeline Execution'
    url: https://owasp.org/www-project-top-10-ci-cd-security-risks/CICD-SEC-04-Poisoned-Pipeline-Execution
    offline_cache: true
tooling:
  static_analysis:
  - tool: gitleaks
    purpose: Detect secrets in pipeline configs
    offline_capable: true
  - tool: checkov
    purpose: CI/CD security policy scanning
    offline_capable: true
  scripts:
  - id: pipeline-secrets-scan
    language: bash
    purpose: Scan pipeline configurations for secret handling issues
    source: inline
    code: |
      #!/bin/bash
      echo "=== Scanning Pipeline Secret Security ==="

      # Check for echo/print of secrets
      grep -rn 'echo.*secrets\|print.*secrets\|console.log.*secret' .github/workflows/ 2>/dev/null

      # Check for hardcoded values in pipelines
      grep -rn --include="*.yaml" --include="*.yml" -E 'password:|api_key:|token:' .github/workflows/ 2>/dev/null

      # Check GitLab CI
      grep -rn 'echo.*CI_.*SECRET\|echo.*CI_.*TOKEN' .gitlab-ci.yml 2>/dev/null
signals:
  critical:
  - id: PIPELINE-CRIT-001
    signal: Secrets printed to pipeline logs
    evidence_pattern: echo.*\$\{\{\s*secrets\.|echo.*\$SECRET|print.*secrets
    explanation: |
      Printing secrets to logs exposes them in build history, accessible to
      anyone with repository or build access. Build logs are often stored
      indefinitely. CWE-532.
    remediation: Never echo secrets; use secret masking features if available
    cwe: CWE-532
  - id: PIPELINE-CRIT-002
    signal: Hardcoded secrets in pipeline configuration
    evidence_pattern: api_key:\s*['"][^$][^'"]+|password:\s*['"][^$][^'"]+
    explanation: |
      Hardcoded secrets in CI/CD configuration are stored in version control
      and accessible to all contributors. They cannot be rotated without
      changing configuration. CWE-798.
    remediation: Use CI/CD secret storage (GitHub Secrets, GitLab Variables, etc.)
    cwe: CWE-798
  - id: PIPELINE-CRIT-003
    signal: Secrets accessible to forks or external PRs
    evidence_pattern: pull_request:(?!.*types:.*\[review)
    explanation: |
      In GitHub Actions, secrets are not available to workflows triggered
      by pull_request from forks by default. However, misconfiguration
      or pull_request_target can expose secrets. PPE attack vector.
    remediation: Use pull_request_target carefully, never checkout untrusted code with secrets
    cwe: CWE-200
  high:
  - id: PIPELINE-HIGH-001
    signal: Secrets passed as command line arguments
    evidence_pattern: --password\s*\$|--token\s*\$|--key\s*\$
    explanation: |
      Secrets in command line arguments may appear in process listings
      and are often logged. Shell history may also capture them. CWE-214.
    remediation: Use environment variables or config files instead of CLI args
    cwe: CWE-214
  - id: PIPELINE-HIGH-002
    signal: Secrets in build artifacts
    evidence_pattern: artifact.*secret|upload.*credentials|archive.*config
    explanation: |
      Build artifacts containing secrets can be downloaded by anyone with
      pipeline access. Artifacts are often retained for extended periods.
    remediation: Exclude sensitive files from artifacts, use .gitignore patterns
  - id: PIPELINE-HIGH-003
    signal: Overly permissive secret access
    evidence_pattern: env:\s*.*secrets\..*|environment:\s*production
    explanation: |
      All jobs should only access secrets they need. Passing all secrets
      to all jobs increases exposure risk. CWE-732.
    remediation: Use job-level secret scoping, environment-specific secrets
    cwe: CWE-732
  - id: PIPELINE-HIGH-004
    signal: Third-party actions with secret access
    evidence_pattern: uses:.*@.*secrets\.
    explanation: |
      Third-party actions with access to secrets can exfiltrate them.
      Compromised or malicious actions are a supply chain risk.
    remediation: Pin actions to commit SHAs, audit action source, minimize secret exposure
  medium:
  - id: PIPELINE-MED-001
    signal: Missing secret masking configuration
    explanation: |
      CI/CD systems should mask secrets in logs. Without explicit masking,
      secrets may appear in plaintext if accidentally logged.
    remediation: Enable automatic secret masking, use add-mask in GitHub Actions
  - id: PIPELINE-MED-002
    signal: Secrets not scoped to environments
    explanation: |
      Production secrets accessible in development/staging pipelines
      increases exposure risk. Secrets should be environment-scoped.
    remediation: Use environment-specific secrets with deployment protection rules
  - id: PIPELINE-MED-003
    signal: No branch protection for pipeline changes
    explanation: |
      Pipeline configuration changes should require review. Attackers
      can inject malicious steps to exfiltrate secrets.
    remediation: Require PR reviews for workflow changes, use CODEOWNERS
  positive:
  - id: PIPELINE-POS-001
    signal: Secrets stored in CI/CD secret storage
  - id: PIPELINE-POS-002
    signal: Environment-scoped secrets
  - id: PIPELINE-POS-003
    signal: Actions pinned to commit SHAs
  - id: PIPELINE-POS-004
    signal: OIDC authentication instead of long-lived credentials
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify CI/CD configurations
    description: |
      Locate all CI/CD pipeline configuration files across
      supported platforms.
    duration_estimate: 10 min
    commands:
    - purpose: Find GitHub Actions workflows
      command: find . -path '*/.github/workflows/*.yml' -o -path '*/.github/workflows/*.yaml' 2>/dev/null
        | head -20
    - purpose: Find GitLab CI configuration
      command: find . -name '.gitlab-ci.yml' 2>/dev/null
    - purpose: Find Jenkinsfiles
      command: find . -name 'Jenkinsfile*' 2>/dev/null | head -10
    - purpose: Find other CI configs
      command: find . -name 'azure-pipelines.yml' -o -name '.circleci' -type d 2>/dev/null
    expected_findings:
    - CI/CD platform identification
    - Configuration file locations
  - id: '2'
    name: Analyze secret references
    description: |
      Review how secrets are referenced and used in
      pipeline configurations.
    duration_estimate: 25 min
    commands:
    - purpose: Find GitHub Actions secrets usage
      command: grep -rn '\${{.*secrets\.' .github/workflows/ 2>/dev/null | head -30
    - purpose: Find GitLab CI variable usage
      command: grep -rn '\$CI_\|\$GITLAB_' .gitlab-ci.yml 2>/dev/null | head -20
    - purpose: Find Jenkins credentials usage
      command: grep -rn 'credentials(\|withCredentials' Jenkinsfile* 2>/dev/null | head -20
    expected_findings:
    - Secret reference patterns
    - Secret naming conventions
  - id: '3'
    name: Check for secret exposure
    description: |
      Identify patterns that could expose secrets in logs,
      artifacts, or command output.
    duration_estimate: 25 min
    commands:
    - purpose: Find potential secret logging
      command: grep -rn 'echo.*\$\|print.*\$\|console.log' .github/workflows/ .gitlab-ci.yml Jenkinsfile*
        2>/dev/null | head -30
    - purpose: Check for secrets in env blocks
      command: grep -rn -A5 'env:' .github/workflows/ 2>/dev/null | head -40
    - purpose: Find artifact upload with secrets risk
      command: grep -rn -B5 -A5 'upload-artifact\|artifacts:' .github/workflows/ .gitlab-ci.yml 2>/dev/null
        | head -40
    expected_findings:
    - Potential log exposure
    - Artifact security
  - id: '4'
    name: Review third-party action security
    description: |
      Examine third-party actions/plugins for secret access
      and version pinning.
    duration_estimate: 20 min
    commands:
    - purpose: Find third-party actions
      command: grep -rn 'uses:' .github/workflows/ 2>/dev/null | grep -v 'actions/' | head -20
    - purpose: Check action version pinning
      command: grep -rn 'uses:.*@' .github/workflows/ 2>/dev/null | grep -v '@v[0-9]\|@[a-f0-9]\{40\}'
        | head -20
    - purpose: Find actions with secret access
      command: grep -rn -B10 'secrets\.' .github/workflows/ 2>/dev/null | grep 'uses:' | head -20
    expected_findings:
    - Third-party action inventory
    - Version pinning status
  - id: '5'
    name: Evaluate access controls
    description: |
      Review pipeline access controls, environment protections,
      and secret scoping.
    duration_estimate: 15 min
    commands:
    - purpose: Find environment configurations
      command: grep -rn 'environment:' .github/workflows/ 2>/dev/null | head -20
    - purpose: Check for branch protection patterns
      command: grep -rn 'branches:' .github/workflows/ 2>/dev/null | head -20
    - purpose: Find pull_request_target usage
      command: grep -rn 'pull_request_target' .github/workflows/ 2>/dev/null
    expected_findings:
    - Environment protection rules
    - Access control patterns
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Secret Exposure Risks
    - Access Control Assessment
    - Third-Party Action Risks
    - Recommendations
  confidence_guidance:
    high: Direct evidence of secret exposure or insecure handling
    medium: Patterns that could lead to exposure under certain conditions
    low: Configuration concerns requiring runtime verification
offline:
  capability: full
  cache_manifest:
    knowledge:
    - source_id: owasp-cicd-risks
      priority: required
    - source_id: owasp-cicd-cheatsheet
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires thorough pipeline analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: pipeline-secrets-001
  item: No secrets printed to logs
  level: CRITICAL
  verification: grep -rn 'echo.*secrets\.' .github/workflows/ 2>/dev/null | wc -l | xargs -I {} test {}
    -eq 0 && echo PASS || echo FAIL
  expected: PASS
- id: pipeline-secrets-002
  item: No hardcoded secrets in pipeline config
  level: CRITICAL
  verification: manual
  expected: PASS
  verification_notes: 'Command has syntax issues - review: grep -rn --include=''*.yml'' --include=''*.yaml''
    -E ''(password|api_key|token):\s*["''\''''''][^$\{]'' .githu'
- id: pipeline-secrets-003
  item: Third-party actions pinned to SHAs
  level: BLOCKING
  verification: grep -rn 'uses:.*@' .github/workflows/ 2>/dev/null | grep -v 'actions/' | grep -v '@[a-f0-9]\{40\}'
    | wc -l | xargs -I {} test {} -eq 0 && echo PASS || echo FAIL
  expected: PASS
- id: pipeline-secrets-004
  item: Environment protection rules configured
  level: WARNING
  verification: grep -rn 'environment:' .github/workflows/ 2>/dev/null | head -1 | grep -q . && echo PASS
    || echo FAIL
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: OWASP Top 10 CI/CD
    controls:
    - CICD-SEC-2
    - CICD-SEC-4
    - CICD-SEC-6
  - framework: CWE
    controls:
    - CWE-532
    - CWE-798
    - CWE-200
  - framework: SOC 2
    controls:
    - CC6.1
    - CC6.6
relationships:
  commonly_combined:
  - security-trust.secrets-management.hardcoded-secrets
  - security-trust.secrets-management.log-sanitization
  - security-trust.application-security.supply-chain
