audit:
  id: security-trust.secrets-management.secret-rotation
  name: Secret Rotation Audit
  version: 1.0.0
  last_updated: '2026-01-18'
  status: active
  category: security-trust
  category_number: 1
  subcategory: secrets-management
  tier: phd
  estimated_duration: 1.5 hours
  completeness: complete
  requires_runtime: true
  destructive: false
execution:
  automatable: partial
  severity: high
  scope: infrastructure
  default_profiles:
  - full
  - security
  blocks_phase: false
  parallelizable: true
description:
  what: |
    This audit evaluates secret rotation policies, automation, and implementation
    across the infrastructure. It examines rotation schedules, automated rotation
    capabilities, zero-downtime rotation procedures, and credential lifecycle
    management for API keys, database passwords, certificates, and encryption keys.
  why_it_matters: |
    Regular secret rotation limits the exposure window if credentials are compromised.
    NIST and PCI-DSS mandate rotation schedules (typically 90 days for PCI-DSS).
    OWASP emphasizes that automated rotation reduces human error and ensures
    consistency. Without rotation, compromised credentials have unlimited validity.
  when_to_run:
  - During compliance audits (PCI-DSS, SOC 2)
  - When reviewing secrets management practices
  - After security incidents involving credential exposure
  - Quarterly as part of security hygiene
prerequisites:
  required_artifacts:
  - type: infrastructure_config
    description: Secrets manager configuration, rotation policies
  access_requirements:
  - Read access to secrets manager configuration
  - Access to rotation policy definitions
  - View rotation history/logs
discovery:
  code_patterns:
  - pattern: rotation|rotate|renew|refresh
    type: regex
    scope: config
    purpose: Rotation configuration patterns
  - pattern: ttl|expir|validit|lifetime
    type: regex
    scope: config
    purpose: Expiration and validity settings
  - pattern: RotationLambda|rotation_lambda|rotationSchedule
    type: regex
    scope: config
    purpose: AWS Secrets Manager rotation
  - pattern: max_ttl|default_ttl|period
    type: regex
    scope: config
    purpose: Vault TTL configuration
  file_patterns:
  - glob: '**/vault/**'
    purpose: Vault configurations
  - glob: '**/secrets/**'
    purpose: Secrets configurations
  - glob: '**/terraform/**'
    purpose: Infrastructure-as-code
  - glob: '**/rotation/**'
    purpose: Rotation scripts and configs
knowledge_sources:
  specifications:
  - id: owasp-secrets-management
    name: OWASP Secrets Management Cheat Sheet
    url: https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html
    offline_cache: true
    priority: required
  - id: nist-800-53-ac
    name: NIST 800-53 Access Control
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: nist-800-53
    name: NIST SP 800-53 Security and Privacy Controls
    url: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final
    offline_cache: true
    priority: required
  - id: owasp-asvs
    name: OWASP Application Security Verification Standard
    url: https://owasp.org/www-project-application-security-verification-standard/
    offline_cache: true
    priority: required
  guides:
  - id: pci-dss-rotation
    name: PCI-DSS Secret Rotation Requirements
    url: https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf
    offline_cache: true
  - id: aws-rotation-guide
    name: AWS Secrets Manager Rotation
    url: https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html
    offline_cache: true
tooling:
  infrastructure_tools:
  - tool: aws
    purpose: Check rotation configuration
    command: aws secretsmanager describe-secret --secret-id <name>
  - tool: vault
    purpose: Check lease/TTL configuration
    command: vault read sys/mounts/<path>/tune
  scripts:
  - id: rotation-check
    language: bash
    purpose: Check for rotation configuration
    source: inline
    code: |
      #!/bin/bash
      echo "=== Checking Secret Rotation Configuration ==="

      # Check AWS Secrets Manager rotation
      grep -rn 'rotation.*enabled\\|RotationLambda\\|rotationSchedule' . 2>/dev/null

      # Check Vault TTL settings
      grep -rn 'max_ttl\\|default_ttl\\|period' . 2>/dev/null

      # Check for rotation scripts
      find . -name '*rotat*' -type f 2>/dev/null
signals:
  critical:
  - id: ROTATION-CRIT-001
    signal: No rotation configured for database credentials
    evidence_pattern: database.*password|db.*password
    explanation: |
      Database credentials without rotation have unlimited validity.
      If compromised, attackers maintain persistent access until
      manual intervention. CWE-262.
    remediation: Implement automated rotation using Vault database engine or AWS Secrets Manager
    cwe: CWE-262
  - id: ROTATION-CRIT-002
    signal: Long-lived API keys without expiration
    evidence_pattern: api.*key.*expir.*never|api.*key.*ttl.*-1
    explanation: |
      API keys without expiration remain valid indefinitely. Leaked
      or stolen keys provide permanent unauthorized access. CWE-324.
    remediation: Set expiration on all API keys, implement rotation schedule
    cwe: CWE-324
  high:
  - id: ROTATION-HIGH-001
    signal: Rotation period exceeds 90 days
    evidence_pattern: rotation.*days.*[1-9][0-9]{2,}|ttl.*[1-9][0-9]{2,}d
    explanation: |
      PCI-DSS and many compliance frameworks require 90-day maximum
      rotation for sensitive credentials. Longer periods increase
      exposure risk. CWE-262.
    remediation: Reduce rotation period to 90 days or less for sensitive credentials
    cwe: CWE-262
  - id: ROTATION-HIGH-002
    signal: Manual rotation process without automation
    explanation: |
      Manual rotation is error-prone, often delayed, and creates
      operational burden. Automated rotation ensures consistency
      and timeliness.
    remediation: Implement automated rotation using secrets manager features
  - id: ROTATION-HIGH-003
    signal: No rotation for service account credentials
    evidence_pattern: service.*account|sa_.*key
    explanation: |
      Service account credentials are high-value targets. Without
      rotation, compromised service accounts provide persistent
      lateral movement capability. CWE-262.
    remediation: Enable automatic key rotation for service accounts
    cwe: CWE-262
  medium:
  - id: ROTATION-MED-001
    signal: Rotation causes service disruption
    explanation: |
      Rotation should be zero-downtime. If rotation causes outages,
      teams avoid running it, reducing security posture.
    remediation: Implement dual-credential rotation pattern for zero downtime
  - id: ROTATION-MED-002
    signal: No alerting for rotation failures
    explanation: |
      Failed rotations must be detected and alerted. Silent failures
      leave expired or stale credentials in production.
    remediation: Configure monitoring and alerting for rotation job failures
  - id: ROTATION-MED-003
    signal: Certificate rotation not automated
    evidence_pattern: cert.*manual|certificate.*manual
    explanation: |
      Manual certificate rotation leads to expired certificates and
      outages. TLS certificates should be automatically renewed.
    remediation: Use cert-manager, ACME, or cloud provider auto-renewal
  positive:
  - id: ROTATION-POS-001
    signal: Automated rotation enabled for all secrets
  - id: ROTATION-POS-002
    signal: Rotation period 90 days or less
  - id: ROTATION-POS-003
    signal: Rotation monitoring and alerting configured
  - id: ROTATION-POS-004
    signal: Zero-downtime rotation pattern implemented
procedure:
  context:
    cognitive_mode: critical
    ensemble_role: auditor
  steps:
  - id: '1'
    name: Identify rotation configurations
    description: |
      Locate all secrets rotation policies and configurations
      across secrets managers and infrastructure.
    duration_estimate: 15 min
    commands:
    - purpose: Find rotation configuration
      command: grep -rn -i 'rotation\|rotate' . 2>/dev/null | grep -v node_modules | head -30
    - purpose: Find TTL/expiration settings
      command: grep -rn -i 'ttl\|expir\|lifetime\|validit' . 2>/dev/null | grep -v node_modules | head
        -30
    - purpose: Find AWS rotation lambdas
      command: grep -rn 'RotationLambda\|rotation_lambda' . 2>/dev/null | head -20
    expected_findings:
    - Rotation policy definitions
    - Rotation schedule configurations
  - id: '2'
    name: Assess rotation periods
    description: |
      Evaluate rotation frequencies against compliance requirements
      and security best practices.
    duration_estimate: 20 min
    commands:
    - purpose: Find rotation periods
      command: grep -rn -E 'days.*[0-9]+|[0-9]+.*days|rotation.*schedule' . 2>/dev/null | head -30
    - purpose: Find Vault lease durations
      command: grep -rn 'max_ttl\|default_ttl' . 2>/dev/null | head -20
    - purpose: Check for long-lived credentials
      command: grep -rn -i 'never.*expir\|no.*rotation\|ttl.*-1' . 2>/dev/null
    expected_findings:
    - Rotation frequency values
    - Long-lived credential configurations
  - id: '3'
    name: Verify automation
    description: |
      Confirm that rotation is automated rather than manual,
      and check for rotation scripts and jobs.
    duration_estimate: 20 min
    commands:
    - purpose: Find rotation automation
      command: find . -type f \( -name '*rotat*' -o -name '*renew*' \) 2>/dev/null | head -20
    - purpose: Check for cron/scheduled jobs
      command: grep -rn 'cron\|schedule\|periodic' . 2>/dev/null | grep -i rotat | head -20
    - purpose: Find Vault auto-unseal/rotation
      command: grep -rn 'auto_rotate\|renew\|periodic' . 2>/dev/null | grep vault | head -20
    expected_findings:
    - Automation implementations
    - Scheduled rotation jobs
  - id: '4'
    name: Check monitoring and alerting
    description: |
      Verify that rotation failures are monitored and generate
      alerts for operations team.
    duration_estimate: 15 min
    commands:
    - purpose: Find rotation monitoring
      command: grep -rn 'alert\|monitor\|metric' . 2>/dev/null | grep -i rotat | head -20
    - purpose: Check CloudWatch alarms for rotation
      command: grep -rn 'CloudWatch\|alarm' . 2>/dev/null | grep -i secret | head -10
    expected_findings:
    - Monitoring configuration
    - Alerting rules for rotation failures
  - id: '5'
    name: Assess zero-downtime capability
    description: |
      Evaluate whether rotation procedures support zero-downtime
      through dual credential patterns.
    duration_estimate: 20 min
    commands:
    - purpose: Find dual credential patterns
      command: grep -rn 'pending\|previous\|versioned\|dual' . 2>/dev/null | grep -i secret | head -20
    - purpose: Check for staged rotation
      command: grep -rn 'createSecret\|setSecret\|testSecret\|finishSecret' . 2>/dev/null
    expected_findings:
    - Dual credential support
    - Staged rotation implementation
output:
  deliverables:
  - type: finding_list
    format: structured
  - type: summary
    format: prose
    sections:
    - Executive Summary
    - Rotation Policy Assessment
    - Automation Status
    - Compliance Gaps
    - Recommendations
  confidence_guidance:
    high: Direct evidence of missing or misconfigured rotation
    medium: Rotation configured but with concerning parameters
    low: Configuration present but requires runtime verification
offline:
  capability: partial
  cache_manifest:
    knowledge:
    - source_id: owasp-secrets-management
      priority: required
profiles:
  membership:
    quick:
      included: false
      reason: Requires infrastructure and policy analysis
    full:
      included: true
      priority: 1
    security:
      included: true
      priority: 1
closeout_checklist:
- id: secret-rotation-001
  item: Rotation configured for database credentials
  level: CRITICAL
  verification: grep -rn -i 'rotation.*database\|database.*rotation' . 2>/dev/null | head -1 | grep -q
    . && echo PASS || echo FAIL
  expected: PASS
- id: secret-rotation-002
  item: Rotation period 90 days or less
  level: BLOCKING
  verification: manual
  verification_notes: Verify rotation schedules comply with 90-day maximum for PCI-DSS
  expected: Confirmed by reviewer
- id: secret-rotation-003
  item: Automated rotation in place
  level: BLOCKING
  verification: grep -rn 'RotationLambda\|auto.*rotat\|rotation.*enabled' . 2>/dev/null | head -1 | grep
    -q . && echo PASS || echo FAIL
  expected: PASS
- id: secret-rotation-004
  item: Rotation monitoring configured
  level: WARNING
  verification: grep -rn 'alert\|monitor' . 2>/dev/null | grep -i rotat | head -1 | grep -q . && echo
    PASS || echo FAIL
  expected: PASS
governance:
  applicable_to:
    archetypes:
    - all
  compliance_frameworks:
  - framework: PCI-DSS
    controls:
    - 8.2.4
    - 3.6.4
  - framework: CWE
    controls:
    - CWE-262
    - CWE-324
  - framework: SOC 2
    controls:
    - CC6.1
  - framework: NIST
    controls:
    - IA-5
    - SC-12
relationships:
  commonly_combined:
  - security-trust.secrets-management.secret-storage
  - security-trust.secrets-management.secret-access-logging
  - security-trust.cryptography.key-management
