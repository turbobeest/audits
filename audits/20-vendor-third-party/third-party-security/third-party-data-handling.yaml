# ============================================================
# AUDIT: Third-Party Data Handling Audit
# ============================================================
# Evaluates how third parties handle, process, store, and protect
# organizational data shared with them.

audit:
  id: "vendor-third-party.third-party-security.third-party-data-handling"

  name: "Third-Party Data Handling Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "vendor-third-party"
  category_number: 20
  subcategory: "third-party-security"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Comprehensive evaluation of third-party data handling practices including
    data classification awareness, storage locations, encryption practices,
    retention compliance, data segregation, access restrictions, and secure
    disposal. Reviews whether third parties adequately protect organizational
    data throughout its lifecycle.

  why_it_matters: |
    Data shared with third parties remains the organization's responsibility.
    Inadequate vendor data handling leads to breaches, compliance violations,
    and regulatory penalties. Organizations must ensure vendors protect data
    as rigorously as internal systems, particularly for sensitive or regulated
    data categories.

  when_to_run:
    - "Before sharing data with new vendors"
    - "Annual vendor data handling reviews"
    - "After data-related vendor incidents"
    - "During regulatory compliance audits"
    - "When data sharing scope changes"

prerequisites:
  required_artifacts:
    - type: "data_handling_requirements"
      description: "Vendor data handling requirements"
    - type: "data_flow_diagrams"
      description: "Data flows to third parties"
    - type: "data_processing_agreements"
      description: "DPAs with vendors"

  access_requirements:
    - "Vendor data handling documentation"
    - "Data flow inventories"
    - "Data processing agreements"
    - "Vendor security assessments"
    - "Data protection team"

discovery:
  code_patterns:
    - pattern: "(vendor|third.?party|external).*(data|pii|confidential)"
      type: "regex"
      scope: "config"
      purpose: "Find vendor data sharing configurations"
    - pattern: "(api|export|transfer).*(vendor|external)"
      type: "regex"
      scope: "source"
      purpose: "Identify data transfer mechanisms"

  file_patterns:
    - glob: "**/data*flow*/**"
      purpose: "Find data flow documentation"
    - glob: "**/vendor*data*/**"
      purpose: "Locate vendor data materials"
    - glob: "**/dpa*/**"
      purpose: "Find data processing agreements"

  documents_to_review:
    - type: "Data Processing Agreements"
      purpose: "Review contractual requirements"
    - type: "Vendor Security Assessments"
      purpose: "Evaluate data handling controls"
    - type: "Data Flow Diagrams"
      purpose: "Understand data sharing scope"

  interviews:
    - role: "Data Protection Officer"
      questions:
        - "What data is shared with vendors?"
        - "How are data handling requirements communicated?"
        - "How is vendor compliance verified?"
      purpose: "Understand data governance"
    - role: "Vendor Security Team"
      questions:
        - "How do vendors demonstrate data protection?"
        - "What evidence is collected?"
        - "How are issues addressed?"
      purpose: "Assess verification practices"

knowledge_sources:
  specifications:
    - id: "gdpr-processor"
      name: "GDPR Data Processor Requirements"
      url: "https://gdpr-info.eu/"
      offline_cache: true
      priority: "required"
    - id: "nist-data-protection"
      name: "NIST Data Protection Guidelines"
      url: "https://csrc.nist.gov/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "data-sharing-guide"
      name: "Third-Party Data Sharing Best Practices"
      url: "https://sharedassessments.org/"
      offline_cache: true

tooling:
  assessment_tools:
    - tool: "Data flow mapping tool"
      purpose: "Document vendor data flows"
    - tool: "DPA compliance checker"
      purpose: "Validate agreement completeness"

signals:
  critical:
    - id: "TPDH-CRIT-001"
      signal: "Sensitive data shared without data protection agreement"
      evidence_indicators:
        - "Personal data sent without DPA"
        - "Confidential data shared without contract"
        - "No data handling terms in agreements"
      explanation: |
        Data sharing without contractual protections exposes the organization
        to compliance violations and leaves no legal recourse for mishandling.
      remediation: "Implement DPAs before any data sharing"

    - id: "TPDH-CRIT-002"
      signal: "Vendor storing data in unauthorized locations"
      evidence_indicators:
        - "Data in non-approved jurisdictions"
        - "Cloud storage without organization approval"
        - "Data location unknown"
      explanation: |
        Unauthorized data locations violate data sovereignty requirements
        and may breach regulatory obligations.
      remediation: "Verify and restrict vendor data storage locations"

    - id: "TPDH-CRIT-003"
      signal: "Vendor not encrypting data at rest"
      evidence_indicators:
        - "Sensitive data stored unencrypted"
        - "No encryption attestation"
        - "Weak encryption standards"
      explanation: |
        Unencrypted data at rest is vulnerable to breach and theft,
        particularly for data outside organizational control.
      remediation: "Require and verify encryption at rest"

  high:
    - id: "TPDH-HIGH-001"
      signal: "No data inventory for vendor-held data"
      explanation: "Cannot protect what is not known"
      remediation: "Implement vendor data inventory"

    - id: "TPDH-HIGH-002"
      signal: "Vendor data retention exceeds requirements"
      explanation: "Excessive retention increases breach exposure"
      remediation: "Enforce data retention limits"

    - id: "TPDH-HIGH-003"
      signal: "No secure data disposal verification"
      explanation: "Data may persist after relationship ends"
      remediation: "Require and verify secure disposal"

  medium:
    - id: "TPDH-MED-001"
      signal: "Data handling requirements not tiered by sensitivity"
      remediation: "Implement sensitivity-based requirements"

    - id: "TPDH-MED-002"
      signal: "Vendor sub-processors not tracked"
      remediation: "Require and track sub-processor disclosure"

    - id: "TPDH-MED-003"
      signal: "Data handling audits not performed"
      remediation: "Implement periodic data handling audits"

  low:
    - id: "TPDH-LOW-001"
      signal: "Data handling metrics not tracked"
      remediation: "Implement data handling compliance metrics"

  positive:
    - id: "TPDH-POS-001"
      signal: "Comprehensive DPAs with all data processors"
    - id: "TPDH-POS-002"
      signal: "Regular vendor data handling audits"
    - id: "TPDH-POS-003"
      signal: "Automated data flow inventory"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Inventory vendor data sharing"
      description: |
        Identify all data shared with vendors including data types,
        sensitivity, volumes, and purposes.
      duration_estimate: "60 min"
      questions:
        - "What data is shared with vendors?"
        - "What is the data sensitivity?"
        - "What is the sharing purpose?"
      expected_findings:
        - "Data sharing inventory"
        - "Sensitivity assessment"

    - id: "2"
      name: "Review data protection agreements"
      description: |
        Evaluate DPAs and contractual data protection requirements
        for completeness and adequacy.
      duration_estimate: "60 min"
      expected_findings:
        - "Agreement coverage"
        - "Requirement completeness"

    - id: "3"
      name: "Assess vendor data controls"
      description: |
        Review vendor data handling controls including encryption,
        access, storage, and retention.
      duration_estimate: "90 min"
      expected_findings:
        - "Control assessment"
        - "Gap identification"

    - id: "4"
      name: "Evaluate verification practices"
      description: |
        Review how vendor data handling compliance is verified
        and monitored.
      duration_estimate: "45 min"
      expected_findings:
        - "Verification effectiveness"
        - "Monitoring coverage"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "data_handling_assessment"
      format: "structured"
      sections:
        - "Data Sharing Inventory"
        - "Agreement Review"
        - "Control Assessment"
        - "Verification Review"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Key Findings"
        - "Recommendations"

  confidence_guidance:
    high: "Full data inventory and vendor control review"
    medium: "Sample vendor review with agreement analysis"
    low: "Documentation review only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "gdpr-processor"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive data handling review"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "tpdh-001"
    item: "Vendor data sharing inventory complete"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "All vendor data flows documented"
    expected: "Confirmed by reviewer"

  - id: "tpdh-002"
    item: "DPAs in place for all data processors"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Contractual protections documented"
    expected: "Confirmed by reviewer"

  - id: "tpdh-003"
    item: "Vendor data encryption verified"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Encryption at rest and in transit confirmed"
    expected: "Confirmed by reviewer"

  - id: "tpdh-004"
    item: "Data handling compliance monitored"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Verification process operational"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "GDPR"
      controls: ["Article 28", "Article 32"]
    - framework: "NIST CSF"
      controls: ["PR.DS-1", "PR.DS-2", "PR.DS-5"]
    - framework: "ISO 27001"
      controls: ["A.15.1.2", "A.15.1.3"]
    - framework: "SOC 2"
      controls: ["CC6.7", "CC9.2"]

relationships:
  commonly_combined:
    - "vendor-third-party.third-party-security.third-party-encryption-standards"
    - "vendor-third-party.third-party-security.third-party-access-controls"
    - "compliance-legal.data-protection.data-processing-agreement"
