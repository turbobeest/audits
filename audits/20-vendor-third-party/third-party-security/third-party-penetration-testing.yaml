# ============================================================
# AUDIT: Third-Party Penetration Testing Audit
# ============================================================
# Evaluates requirements and practices for third-party penetration
# testing of vendors and their security assessments.

audit:
  id: "vendor-third-party.third-party-security.third-party-penetration-testing"

  name: "Third-Party Penetration Testing Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "vendor-third-party"
  category_number: 20
  subcategory: "third-party-security"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Comprehensive evaluation of third-party penetration testing requirements
    and practices including vendor pen test requirements, evidence collection,
    findings review, remediation tracking, and testing frequency. Reviews whether
    vendors undergo adequate security testing and findings are appropriately
    addressed.

  why_it_matters: |
    Penetration testing provides objective validation of vendor security controls
    beyond self-assessments. Vendors without regular pen testing may have
    undetected vulnerabilities that could expose your data or systems. Requiring
    and reviewing vendor pen test results demonstrates due diligence and ensures
    vendors maintain security hygiene.

  when_to_run:
    - "During vendor onboarding for high-risk vendors"
    - "Annual vendor security reviews"
    - "When updating vendor security requirements"
    - "After significant vendor infrastructure changes"
    - "During contract renewals"

prerequisites:
  required_artifacts:
    - type: "pen_test_policy"
      description: "Vendor penetration testing requirements"
    - type: "pen_test_reports"
      description: "Vendor penetration test reports"
    - type: "remediation_tracking"
      description: "Findings remediation documentation"

  access_requirements:
    - "Vendor penetration testing policy"
    - "Vendor pen test reports/attestations"
    - "Remediation tracking system"
    - "Vendor management team"
    - "Security assessment team"

discovery:
  file_patterns:
    - glob: "**/pen*test*/**"
      purpose: "Find penetration test documentation"
    - glob: "**/security*assessment*/**"
      purpose: "Locate assessment materials"
    - glob: "**/vendor*security*/**"
      purpose: "Find vendor security requirements"

  documents_to_review:
    - type: "Vendor Penetration Testing Policy"
      purpose: "Understand testing requirements"
    - type: "Penetration Test Reports"
      purpose: "Review testing scope and findings"
    - type: "Remediation Evidence"
      purpose: "Verify findings addressed"

  interviews:
    - role: "Security Assessment Team"
      questions:
        - "What pen testing is required from vendors?"
        - "How are pen test reports reviewed?"
        - "How is remediation tracked?"
      purpose: "Understand assessment process"
    - role: "Vendor Manager"
      questions:
        - "Which vendors have pen test requirements?"
        - "How is compliance tracked?"
        - "What happens with non-compliant vendors?"
      purpose: "Understand enforcement"

knowledge_sources:
  specifications:
    - id: "ptes"
      name: "Penetration Testing Execution Standard"
      url: "http://www.pentest-standard.org/"
      offline_cache: true
      priority: "recommended"
    - id: "owasp-testing"
      name: "OWASP Testing Guide"
      url: "https://owasp.org/www-project-web-security-testing-guide/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "pen-test-vendor-guide"
      name: "Vendor Security Assessment Guide"
      url: "https://sharedassessments.org/"
      offline_cache: true

tooling:
  assessment_tools:
    - tool: "Pen test report checklist"
      purpose: "Validate report completeness"
    - tool: "Finding severity tracker"
      purpose: "Track critical finding remediation"

signals:
  critical:
    - id: "TPPT-CRIT-001"
      signal: "High-risk vendors never pen tested"
      evidence_indicators:
        - "No pen test history for critical vendors"
        - "Vendors refuse to share pen test results"
        - "Pen testing not required despite data access"
      explanation: |
        Vendors handling sensitive data or with system access without
        penetration testing represent unverified security risk.
      remediation: "Require and obtain pen test results for high-risk vendors"

    - id: "TPPT-CRIT-002"
      signal: "Critical pen test findings unremediated"
      evidence_indicators:
        - "Critical vulnerabilities identified but not fixed"
        - "No remediation evidence provided"
        - "Vendors operating with known critical flaws"
      explanation: |
        Unremediated critical findings represent active vulnerabilities
        that could be exploited to compromise vendor and downstream systems.
      remediation: "Require remediation evidence before continued engagement"

  high:
    - id: "TPPT-HIGH-001"
      signal: "Pen test scope inadequate"
      explanation: "Limited testing may miss critical vulnerabilities"
      remediation: "Require comprehensive testing scope aligned with risk"

    - id: "TPPT-HIGH-002"
      signal: "Pen tests outdated (>1 year)"
      explanation: "Security posture changes; annual testing minimum"
      remediation: "Require annual penetration testing from vendors"

    - id: "TPPT-HIGH-003"
      signal: "Pen test reports not reviewed"
      explanation: "Reports obtained but findings not analyzed"
      remediation: "Implement pen test report review process"

  medium:
    - id: "TPPT-MED-001"
      signal: "No pen test requirements in contracts"
      remediation: "Add pen test requirements to vendor contracts"

    - id: "TPPT-MED-002"
      signal: "Pen tester qualifications not verified"
      remediation: "Require qualified pen test providers"

    - id: "TPPT-MED-003"
      signal: "Remediation timelines not defined"
      remediation: "Establish finding remediation SLAs"

  low:
    - id: "TPPT-LOW-001"
      signal: "Pen test tracking not centralized"
      remediation: "Centralize pen test compliance tracking"

  positive:
    - id: "TPPT-POS-001"
      signal: "All high-risk vendors pen tested annually"
    - id: "TPPT-POS-002"
      signal: "Comprehensive pen test review process"
    - id: "TPPT-POS-003"
      signal: "Remediation tracking with verification"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review pen test requirements"
      description: |
        Evaluate penetration testing requirements for vendors including
        tiering, frequency, and scope requirements.
      duration_estimate: "45 min"
      questions:
        - "Which vendors require pen testing?"
        - "What testing frequency is required?"
        - "What scope is mandated?"
      expected_findings:
        - "Requirements assessment"
        - "Policy completeness"

    - id: "2"
      name: "Assess compliance tracking"
      description: |
        Review how vendor pen test compliance is tracked and enforced.
      duration_estimate: "45 min"
      questions:
        - "How is compliance tracked?"
        - "What happens with non-compliant vendors?"
        - "Is tracking centralized?"
      expected_findings:
        - "Compliance rate"
        - "Enforcement effectiveness"

    - id: "3"
      name: "Review sample pen test reports"
      description: |
        Sample vendor pen test reports for scope adequacy,
        methodology, and findings quality.
      duration_estimate: "60 min"
      expected_findings:
        - "Report quality"
        - "Scope adequacy"
        - "Findings assessment"

    - id: "4"
      name: "Evaluate remediation tracking"
      description: |
        Review how pen test findings are tracked and remediated.
      duration_estimate: "45 min"
      expected_findings:
        - "Remediation tracking"
        - "Critical finding closure"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "pen_test_assessment"
      format: "structured"
      sections:
        - "Requirements Review"
        - "Compliance Assessment"
        - "Report Quality Analysis"
        - "Remediation Tracking Review"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Key Findings"
        - "Recommendations"

  confidence_guidance:
    high: "Full process review with report sampling"
    medium: "Process review with limited sampling"
    low: "Policy review only"

offline:
  capability: "full"

  cache_manifest:
    knowledge:
      - source_id: "owasp-testing"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive pen test review"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "tppt-001"
    item: "Pen test requirements defined for vendor tiers"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Requirements documented and communicated"
    expected: "Confirmed by reviewer"

  - id: "tppt-002"
    item: "High-risk vendors have current pen tests"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Pen tests within last 12 months"
    expected: "Confirmed by reviewer"

  - id: "tppt-003"
    item: "Pen test findings reviewed and tracked"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Review process operational"
    expected: "Confirmed by reviewer"

  - id: "tppt-004"
    item: "Critical findings remediated or accepted"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "No open critical findings without remediation"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "NIST CSF"
      controls: ["ID.SC-4", "DE.CM-8"]
    - framework: "ISO 27001"
      controls: ["A.15.2.1", "A.15.2.2"]
    - framework: "SOC 2"
      controls: ["CC4.1", "CC9.2"]

relationships:
  commonly_combined:
    - "vendor-third-party.third-party-security.third-party-compliance-verification"
    - "vendor-third-party.vendor-risk-assessment.vendor-security-questionnaire"
    - "security-testing.penetration-testing.annual-pen-test"
