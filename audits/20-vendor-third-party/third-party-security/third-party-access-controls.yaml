# ============================================================
# AUDIT: Third-Party Access Controls Audit
# ============================================================
# Evaluates access controls for third parties including provisioning,
# monitoring, and deprovisioning of vendor access.

audit:
  id: "vendor-third-party.third-party-security.third-party-access-controls"

  name: "Third-Party Access Controls Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "vendor-third-party"
  category_number: 20
  subcategory: "third-party-security"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: true
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Comprehensive evaluation of third-party access controls including access
    provisioning processes, least privilege implementation, access monitoring,
    access certification, and timely deprovisioning. Reviews technical controls,
    governance processes, and operational practices for managing vendor access
    to systems and data.

  why_it_matters: |
    Third-party access represents significant attack surface expansion. Vendors
    with excessive or poorly managed access can become breach vectors through
    compromised credentials, insider threats, or inadequate security practices.
    Strong access controls limit exposure and enable rapid response to vendor
    security incidents.

  when_to_run:
    - "During vendor onboarding with system access"
    - "Annual access review cycles"
    - "After vendor security incidents"
    - "During security assessments"
    - "When expanding vendor access scope"

prerequisites:
  required_artifacts:
    - type: "access_management_policy"
      description: "Third-party access management policy"
    - type: "access_inventory"
      description: "Inventory of third-party access"
    - type: "provisioning_procedures"
      description: "Access provisioning documentation"

  access_requirements:
    - "Identity and access management systems"
    - "Third-party access inventory"
    - "Access provisioning workflow system"
    - "Access monitoring logs"
    - "Vendor management team"

discovery:
  code_patterns:
    - pattern: "(vendor|third.?party|external).*(access|auth|login)"
      type: "regex"
      scope: "config"
      purpose: "Find third-party access configurations"
    - pattern: "(service.?account|api.?key|oauth).*(vendor|partner)"
      type: "regex"
      scope: "config"
      purpose: "Locate vendor authentication mechanisms"

  file_patterns:
    - glob: "**/vendor*access*/**"
      purpose: "Find vendor access documentation"
    - glob: "**/third-party*/**"
      purpose: "Locate third-party configurations"
    - glob: "**/access*control*/**"
      purpose: "Find access control materials"

  documents_to_review:
    - type: "Third-Party Access Policy"
      purpose: "Understand access requirements"
    - type: "Access Provisioning Procedures"
      purpose: "Review provisioning process"
    - type: "Access Inventory"
      purpose: "Assess access scope"

  interviews:
    - role: "Identity and Access Management Team"
      questions:
        - "How is third-party access provisioned?"
        - "What approval workflow is required?"
        - "How is access deprovisioned?"
      purpose: "Understand access lifecycle"
    - role: "Security Operations"
      questions:
        - "How is third-party access monitored?"
        - "What alerts exist for anomalous access?"
        - "How are access incidents investigated?"
      purpose: "Assess monitoring effectiveness"

knowledge_sources:
  specifications:
    - id: "nist-800-53"
      name: "NIST SP 800-53 Rev 5"
      url: "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-53r5.pdf"
      offline_cache: true
      priority: "required"
    - id: "nist-ac"
      name: "NIST SP 800-53 Access Control Family"
      url: "https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final"
      offline_cache: true
      priority: "required"
    - id: "iso27001-access"
      name: "ISO 27001 Access Control"
      url: "https://www.iso.org/standard/27001"
      offline_cache: true
      priority: "required"
    - id: "cisa-known-exploited"
      name: "CISA Known Exploited Vulnerabilities"
      url: "https://www.cisa.gov/known-exploited-vulnerabilities-catalog"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "privileged-access-guide"
      name: "Privileged Access Management Best Practices"
      url: "https://www.gartner.com/"
      offline_cache: true

tooling:
  infrastructure_tools:
    - tool: "Identity provider admin console"
      purpose: "Review third-party accounts and access"
      command: "Review IdP for external user configurations"
    - tool: "SIEM/Log analysis"
      purpose: "Analyze third-party access patterns"
      command: "Query for external user authentication events"

  scripts:
    - id: "third-party-access-audit"
      language: "bash"
      purpose: "Identify third-party access configurations"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Third-Party Access Patterns ==="
        grep -r -E "(vendor|external|partner).*access" \
          --include="*.yaml" --include="*.json" --include="*.conf" . 2>/dev/null

signals:
  critical:
    - id: "TPAC-CRIT-001"
      signal: "Third-party access not inventoried"
      evidence_indicators:
        - "No record of what access vendors have"
        - "Access granted ad hoc without tracking"
        - "Unable to identify all third-party access"
      explanation: |
        Without access inventory, organizations cannot assess exposure,
        perform access reviews, or ensure timely deprovisioning. This
        creates significant blind spots in security posture.
      remediation: "Implement comprehensive third-party access inventory"

    - id: "TPAC-CRIT-002"
      signal: "Third-party accounts with administrative privileges"
      evidence_indicators:
        - "Vendor accounts with admin access"
        - "Third parties with root or domain admin"
        - "Excessive privileges for vendor functions"
      explanation: |
        Administrative access by third parties creates maximum risk exposure.
        Compromised admin accounts enable complete system takeover.
      remediation: "Remove administrative privileges and implement least privilege"

    - id: "TPAC-CRIT-003"
      signal: "Terminated vendor access not deprovisioned"
      evidence_indicators:
        - "Active accounts for former vendors"
        - "Access persists after contract termination"
        - "No offboarding process for vendors"
      explanation: |
        Active access for terminated vendors is unauthorized access
        creating immediate security and compliance risk.
      remediation: "Immediately disable and audit access for terminated vendors"

  high:
    - id: "TPAC-HIGH-001"
      signal: "No access approval workflow"
      explanation: "Access granted without documented approval"
      remediation: "Implement access request and approval workflow"

    - id: "TPAC-HIGH-002"
      signal: "Third-party access not monitored"
      explanation: "Anomalous or malicious activity may go undetected"
      remediation: "Implement monitoring and alerting for third-party access"

    - id: "TPAC-HIGH-003"
      signal: "No periodic access certification"
      explanation: "Access accumulates without validation of need"
      remediation: "Implement regular access certification reviews"

  medium:
    - id: "TPAC-MED-001"
      signal: "Shared accounts used by vendors"
      remediation: "Implement individual accounts for accountability"

    - id: "TPAC-MED-002"
      signal: "Access provisioning not documented"
      remediation: "Document all access provisioning decisions"

    - id: "TPAC-MED-003"
      signal: "MFA not required for third-party access"
      remediation: "Mandate multi-factor authentication"

  low:
    - id: "TPAC-LOW-001"
      signal: "Access provisioning SLAs not defined"
      remediation: "Define and track access provisioning SLAs"

  positive:
    - id: "TPAC-POS-001"
      signal: "Comprehensive access inventory with automated tracking"
    - id: "TPAC-POS-002"
      signal: "Just-in-time access provisioning for vendors"
    - id: "TPAC-POS-003"
      signal: "Automated access deprovisioning on contract termination"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review access inventory"
      description: |
        Evaluate completeness and accuracy of third-party access
        inventory across all systems.
      duration_estimate: "60 min"
      commands:
        - purpose: "Query identity provider for external users"
          command: "Review IdP external user configurations"
      expected_findings:
        - "Inventory completeness"
        - "Access scope assessment"

    - id: "2"
      name: "Assess provisioning process"
      description: |
        Review access provisioning workflow including approvals,
        documentation, and least privilege implementation.
      duration_estimate: "60 min"
      questions:
        - "What approval is required for third-party access?"
        - "How is least privilege enforced?"
        - "Is provisioning documented?"
      expected_findings:
        - "Process effectiveness"
        - "Approval compliance"

    - id: "3"
      name: "Evaluate monitoring and detection"
      description: |
        Review monitoring of third-party access including logging,
        alerting, and anomaly detection.
      duration_estimate: "60 min"
      commands:
        - purpose: "Review access monitoring coverage"
          command: "Examine SIEM rules for third-party access"
      expected_findings:
        - "Monitoring coverage"
        - "Detection capabilities"

    - id: "4"
      name: "Review access certification"
      description: |
        Evaluate periodic access review and certification processes.
      duration_estimate: "45 min"
      expected_findings:
        - "Certification frequency"
        - "Review effectiveness"

    - id: "5"
      name: "Assess deprovisioning"
      description: |
        Review access deprovisioning process and timeliness,
        particularly for terminated vendors.
      duration_estimate: "45 min"
      expected_findings:
        - "Deprovisioning timeliness"
        - "Orphaned access identification"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "access_assessment"
      format: "structured"
      sections:
        - "Access Inventory Review"
        - "Provisioning Assessment"
        - "Monitoring Evaluation"
        - "Deprovisioning Review"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Key Findings"
        - "Recommendations"

  confidence_guidance:
    high: "Full access review with system verification"
    medium: "Process review with sample verification"
    low: "Documentation review only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "nist-ac"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive access review"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "tpac-001"
    item: "Third-party access inventory complete and current"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "All third-party access documented"
    expected: "Confirmed by reviewer"

  - id: "tpac-002"
    item: "Least privilege implemented for third parties"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "No excessive privileges identified"
    expected: "Confirmed by reviewer"

  - id: "tpac-003"
    item: "Access monitoring operational"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Third-party access logged and monitored"
    expected: "Confirmed by reviewer"

  - id: "tpac-004"
    item: "Terminated vendor access deprovisioned"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "No active access for terminated vendors"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "NIST CSF"
      controls: ["PR.AC-1", "PR.AC-4", "PR.AC-6"]
    - framework: "ISO 27001"
      controls: ["A.9.2.1", "A.9.2.2", "A.9.2.6"]
    - framework: "SOC 2"
      controls: ["CC6.1", "CC6.2", "CC6.3"]

relationships:
  commonly_combined:
    - "vendor-third-party.third-party-security.third-party-data-handling"
    - "vendor-third-party.vendor-risk-assessment.vendor-risk-classification"
    - "security-architecture.authentication.mfa-enforcement"
