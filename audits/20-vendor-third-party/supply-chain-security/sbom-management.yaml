# ============================================================
# AUDIT: SBOM Management Audit
# ============================================================
# Evaluates Software Bill of Materials (SBOM) generation,
# maintenance, and utilization practices.

audit:
  id: "vendor-third-party.supply-chain-security.sbom-management"

  name: "SBOM Management Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "vendor-third-party"
  category_number: 20
  subcategory: "supply-chain-security"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "high"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: false
  parallelizable: true

description:
  what: |
    Comprehensive evaluation of Software Bill of Materials (SBOM) practices
    including generation processes, format compliance, completeness, accuracy,
    distribution, and utilization for vulnerability management. Reviews whether
    SBOMs effectively support software transparency and supply chain security.

  why_it_matters: |
    SBOMs provide transparency into software composition, enabling rapid
    vulnerability response and supply chain risk assessment. Executive Order
    14028 mandates SBOM for federal software. Without SBOMs, organizations
    cannot quickly determine exposure to newly discovered vulnerabilities
    like Log4j or identify all affected systems.

  when_to_run:
    - "During software release preparation"
    - "Annual SBOM program reviews"
    - "After supply chain security incidents"
    - "When implementing SBOM requirements"
    - "Before regulatory compliance audits"

prerequisites:
  required_artifacts:
    - type: "sbom_policy"
      description: "SBOM generation policy"
    - type: "sbom_samples"
      description: "Sample SBOMs for review"
    - type: "generation_procedures"
      description: "SBOM generation documentation"

  access_requirements:
    - "SBOM generation tools and configurations"
    - "Sample generated SBOMs"
    - "Build pipeline configurations"
    - "Development and DevOps teams"
    - "Vulnerability management team"

discovery:
  code_patterns:
    - pattern: "(sbom|spdx|cyclonedx)"
      type: "keyword"
      scope: "config"
      purpose: "Find SBOM configurations"
    - pattern: "(bom|bill.?of.?materials)"
      type: "regex"
      scope: "config"
      purpose: "Identify BOM references"

  file_patterns:
    - glob: "**/*.spdx*"
      purpose: "Find SPDX format SBOMs"
    - glob: "**/*bom*.json"
      purpose: "Locate CycloneDX SBOMs"
    - glob: "**/sbom/**"
      purpose: "Find SBOM directories"

  documents_to_review:
    - type: "SBOM Policy"
      purpose: "Understand SBOM requirements"
    - type: "Generated SBOMs"
      purpose: "Assess SBOM quality"
    - type: "Generation Procedures"
      purpose: "Review generation process"

  interviews:
    - role: "DevOps/Release Team"
      questions:
        - "How are SBOMs generated?"
        - "What format and tools are used?"
        - "When in the pipeline are SBOMs created?"
      purpose: "Understand generation process"
    - role: "Security/Vulnerability Team"
      questions:
        - "How are SBOMs used for vulnerability management?"
        - "Can you quickly query affected systems?"
        - "How are SBOMs from vendors utilized?"
      purpose: "Assess SBOM utilization"

knowledge_sources:
  specifications:
    - id: "ntia-sbom"
      name: "NTIA Minimum Elements for SBOM"
      url: "https://www.ntia.gov/sbom"
      offline_cache: true
      priority: "required"
    - id: "spdx"
      name: "SPDX Specification"
      url: "https://spdx.dev/"
      offline_cache: true
      priority: "required"
    - id: "cyclonedx"
      name: "CycloneDX Specification"
      url: "https://cyclonedx.org/"
      offline_cache: true
      priority: "required"

  guides:
    - id: "cisa-sbom"
      name: "CISA SBOM Guidance"
      url: "https://www.cisa.gov/sbom"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Syft, Trivy, or similar SBOM generators"
      purpose: "Generate and validate SBOMs"
      offline_capable: true
    - tool: "SBOM format validators"
      purpose: "Validate SBOM format compliance"
      offline_capable: true

  scripts:
    - id: "sbom-check"
      language: "bash"
      purpose: "Find SBOM files in codebase"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== SBOM Files ==="
        find . -name "*.spdx*" -o -name "*bom*.json" -o -name "*.cdx.*" 2>/dev/null

signals:
  critical:
    - id: "SBOM-CRIT-001"
      signal: "No SBOM generation for released software"
      evidence_indicators:
        - "Software released without SBOM"
        - "No SBOM generation process"
        - "SBOM generation not in pipeline"
      explanation: |
        Without SBOMs, organizations cannot track software composition or
        respond quickly to vulnerability disclosures. Regulatory requirements
        increasingly mandate SBOM.
      remediation: "Implement automated SBOM generation in build pipeline"

    - id: "SBOM-CRIT-002"
      signal: "SBOMs significantly incomplete"
      evidence_indicators:
        - "Major dependencies missing"
        - "Transitive dependencies not included"
        - "Significant version information gaps"
      explanation: |
        Incomplete SBOMs provide false assurance and miss vulnerability
        exposure from unlisted components.
      remediation: "Improve SBOM generation to capture all components"

  high:
    - id: "SBOM-HIGH-001"
      signal: "SBOMs not in standard format"
      explanation: "Non-standard formats limit interoperability and tooling"
      remediation: "Adopt SPDX or CycloneDX format"

    - id: "SBOM-HIGH-002"
      signal: "SBOMs not used for vulnerability management"
      explanation: "SBOMs generate value through utilization"
      remediation: "Integrate SBOM into vulnerability scanning"

    - id: "SBOM-HIGH-003"
      signal: "Vendor SBOMs not collected"
      explanation: "Third-party software composition unknown"
      remediation: "Require SBOMs from software vendors"

  medium:
    - id: "SBOM-MED-001"
      signal: "SBOM generation not automated"
      remediation: "Automate SBOM generation in CI/CD"

    - id: "SBOM-MED-002"
      signal: "SBOMs not version controlled"
      remediation: "Store SBOMs with corresponding releases"

    - id: "SBOM-MED-003"
      signal: "No SBOM accuracy validation"
      remediation: "Implement SBOM validation process"

  low:
    - id: "SBOM-LOW-001"
      signal: "SBOM metrics not tracked"
      remediation: "Track SBOM coverage and quality metrics"

  positive:
    - id: "SBOM-POS-001"
      signal: "Automated SBOM generation for all releases"
    - id: "SBOM-POS-002"
      signal: "SBOM integrated with vulnerability management"
    - id: "SBOM-POS-003"
      signal: "Vendor SBOMs collected and correlated"

procedure:
  context:
    cognitive_mode: "evaluative"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review SBOM policy and requirements"
      description: |
        Evaluate SBOM policy including scope, format requirements,
        and minimum elements.
      duration_estimate: "45 min"
      questions:
        - "What SBOM requirements exist?"
        - "What format is required?"
        - "What minimum elements are mandated?"
      expected_findings:
        - "Policy assessment"
        - "Requirements completeness"

    - id: "2"
      name: "Assess generation process"
      description: |
        Review SBOM generation process including tools, automation,
        and pipeline integration.
      duration_estimate: "60 min"
      commands:
        - purpose: "Find SBOM generation configurations"
          command: "grep -r -l 'sbom\\|spdx\\|cyclonedx' --include='*.yaml' --include='*.yml' . 2>/dev/null | head -10"
      expected_findings:
        - "Generation process"
        - "Automation level"

    - id: "3"
      name: "Evaluate SBOM quality"
      description: |
        Sample generated SBOMs for completeness, accuracy, and
        format compliance.
      duration_estimate: "60 min"
      expected_findings:
        - "Completeness assessment"
        - "Format compliance"

    - id: "4"
      name: "Review utilization"
      description: |
        Assess how SBOMs are used for vulnerability management
        and supply chain risk assessment.
      duration_estimate: "45 min"
      expected_findings:
        - "Utilization effectiveness"
        - "Integration assessment"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "sbom_assessment"
      format: "structured"
      sections:
        - "Policy Review"
        - "Generation Process Assessment"
        - "Quality Evaluation"
        - "Utilization Review"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Key Findings"
        - "Recommendations"

  confidence_guidance:
    high: "Full process review with SBOM sampling"
    medium: "Process review with limited sampling"
    low: "Documentation review only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "ntia-sbom"
        priority: "required"
      - source_id: "spdx"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive SBOM review"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "sbom-001"
    item: "SBOM generation implemented for releases"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "SBOM generation in build pipeline"
    expected: "Confirmed by reviewer"

  - id: "sbom-002"
    item: "SBOMs in standard format (SPDX/CycloneDX)"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Format compliance verified"
    expected: "Confirmed by reviewer"

  - id: "sbom-003"
    item: "SBOMs contain NTIA minimum elements"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Minimum elements present"
    expected: "Confirmed by reviewer"

  - id: "sbom-004"
    item: "SBOMs integrated with vulnerability management"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "SBOM used for vulnerability tracking"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "NIST CSF"
      controls: ["ID.SC-2", "PR.DS-6"]
    - framework: "Executive Order 14028"
      controls: ["Section 4(e)"]
    - framework: "NTIA SBOM"
      controls: ["Minimum Elements"]
    - framework: "SOC 2"
      controls: ["CC6.6"]

relationships:
  commonly_combined:
    - "vendor-third-party.supply-chain-security.software-supply-chain"
    - "vendor-third-party.supply-chain-security.dependency-vulnerability"
    - "software-development.release-management.release-artifacts"
