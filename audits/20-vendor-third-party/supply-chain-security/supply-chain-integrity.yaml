# ============================================================
# AUDIT: Supply Chain Integrity Audit
# ============================================================
# Evaluates integrity controls across the supply chain including
# verification, attestation, and provenance tracking.

audit:
  id: "vendor-third-party.supply-chain-security.supply-chain-integrity"

  name: "Supply Chain Integrity Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "vendor-third-party"
  category_number: 20
  subcategory: "supply-chain-security"

  tier: "expert"
  estimated_duration: "5-7 hours"  # median: 6h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Comprehensive evaluation of supply chain integrity controls including
    artifact signing and verification, provenance attestation, integrity
    checks, tamper detection, and chain of custody. Reviews whether
    software and hardware integrity can be verified throughout the
    supply chain.

  why_it_matters: |
    Supply chain integrity ensures that software and components have not
    been tampered with between creation and deployment. Without integrity
    verification, malicious modifications may go undetected. Integrity
    controls are essential for preventing supply chain attacks and
    maintaining trust in deployed systems.

  when_to_run:
    - "During security architecture reviews"
    - "Annual supply chain assessments"
    - "After supply chain incidents"
    - "When implementing new integrity controls"
    - "Before critical deployments"

prerequisites:
  required_artifacts:
    - type: "signing_configuration"
      description: "Code and artifact signing configuration"
    - type: "verification_procedures"
      description: "Integrity verification procedures"
    - type: "provenance_documentation"
      description: "Provenance attestation documentation"

  access_requirements:
    - "Code signing configurations"
    - "Artifact verification processes"
    - "Build system configurations"
    - "Provenance attestations"
    - "Security and DevOps teams"

discovery:
  code_patterns:
    - pattern: "(sign|verify|checksum|hash|integrity)"
      type: "keyword"
      scope: "config"
      purpose: "Find integrity controls"
    - pattern: "(provenance|attestation|slsa)"
      type: "keyword"
      scope: "config"
      purpose: "Identify provenance controls"
    - pattern: "(gpg|cosign|sigstore|notary)"
      type: "keyword"
      scope: "config"
      purpose: "Find signing tools"

  file_patterns:
    - glob: "**/*.sig"
      purpose: "Find signature files"
    - glob: "**/*.asc"
      purpose: "Locate GPG signatures"
    - glob: "**/checksums*"
      purpose: "Find checksum files"

  documents_to_review:
    - type: "Code Signing Policy"
      purpose: "Understand signing requirements"
    - type: "Verification Procedures"
      purpose: "Review verification practices"
    - type: "Provenance Documentation"
      purpose: "Assess provenance tracking"

  interviews:
    - role: "Security Team"
      questions:
        - "What artifacts are signed?"
        - "How is integrity verified?"
        - "What provenance is tracked?"
      purpose: "Understand integrity controls"
    - role: "DevOps/Release Team"
      questions:
        - "How is signing integrated into releases?"
        - "What verification occurs before deployment?"
        - "How are attestations generated?"
      purpose: "Assess implementation"

knowledge_sources:
  specifications:
    - id: "slsa"
      name: "Supply-chain Levels for Software Artifacts (SLSA)"
      url: "https://slsa.dev/"
      offline_cache: true
      priority: "required"
    - id: "in-toto"
      name: "in-toto Framework"
      url: "https://in-toto.io/"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "sigstore-guide"
      name: "Sigstore Implementation Guide"
      url: "https://www.sigstore.dev/"
      offline_cache: true
    - id: "nist-integrity"
      name: "NIST Software Integrity Guidance"
      url: "https://csrc.nist.gov/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Cosign, GPG, or similar signing tools"
      purpose: "Sign and verify artifacts"
      offline_capable: true
    - tool: "SLSA verifier"
      purpose: "Verify SLSA provenance"
      offline_capable: true

signals:
  critical:
    - id: "SCI-CRIT-001"
      signal: "No artifact signing implemented"
      evidence_indicators:
        - "Release artifacts unsigned"
        - "No signing keys configured"
        - "No signature verification"
      explanation: |
        Unsigned artifacts cannot be verified for integrity, allowing
        tampering to go undetected.
      remediation: "Implement artifact signing for all releases"

    - id: "SCI-CRIT-002"
      signal: "Signature verification not enforced"
      evidence_indicators:
        - "Unsigned artifacts accepted"
        - "Verification failures ignored"
        - "No verification in deployment"
      explanation: |
        Signing without verification provides no protection. Attackers
        can substitute unsigned malicious artifacts.
      remediation: "Enforce signature verification before deployment"

    - id: "SCI-CRIT-003"
      signal: "Signing keys not protected"
      evidence_indicators:
        - "Keys stored in plaintext"
        - "Keys accessible to developers"
        - "No key rotation"
      explanation: |
        Compromised signing keys allow attackers to sign malicious
        artifacts that pass verification.
      remediation: "Protect signing keys with HSM and access controls"

  high:
    - id: "SCI-HIGH-001"
      signal: "No provenance attestation"
      explanation: "Cannot verify where artifacts came from"
      remediation: "Implement provenance attestation (SLSA)"

    - id: "SCI-HIGH-002"
      signal: "Checksums not generated or verified"
      explanation: "Basic integrity checks missing"
      remediation: "Generate and verify checksums for all artifacts"

    - id: "SCI-HIGH-003"
      signal: "Third-party dependencies not verified"
      explanation: "External components may be compromised"
      remediation: "Verify integrity of third-party dependencies"

  medium:
    - id: "SCI-MED-001"
      signal: "Integrity verification not automated"
      remediation: "Automate integrity verification in pipelines"

    - id: "SCI-MED-002"
      signal: "No integrity monitoring post-deployment"
      remediation: "Implement runtime integrity monitoring"

    - id: "SCI-MED-003"
      signal: "Signing coverage incomplete"
      remediation: "Extend signing to all artifact types"

  low:
    - id: "SCI-LOW-001"
      signal: "Integrity metrics not tracked"
      remediation: "Track integrity verification metrics"

  positive:
    - id: "SCI-POS-001"
      signal: "All artifacts signed and verified"
    - id: "SCI-POS-002"
      signal: "SLSA Level 2+ provenance implemented"
    - id: "SCI-POS-003"
      signal: "Signing keys protected with HSM"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review signing implementation"
      description: |
        Evaluate artifact signing configuration, coverage, and
        key management.
      duration_estimate: "60 min"
      questions:
        - "What artifacts are signed?"
        - "What signing method is used?"
        - "How are keys protected?"
      expected_findings:
        - "Signing coverage"
        - "Key protection assessment"

    - id: "2"
      name: "Assess verification practices"
      description: |
        Review signature and checksum verification in deployment
        pipelines.
      duration_estimate: "60 min"
      expected_findings:
        - "Verification implementation"
        - "Enforcement assessment"

    - id: "3"
      name: "Evaluate provenance tracking"
      description: |
        Assess provenance attestation and SLSA compliance.
      duration_estimate: "60 min"
      expected_findings:
        - "Provenance implementation"
        - "SLSA level assessment"

    - id: "4"
      name: "Review third-party integrity"
      description: |
        Evaluate integrity verification for third-party components
        and dependencies.
      duration_estimate: "45 min"
      expected_findings:
        - "Third-party verification"
        - "Gap identification"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "integrity_assessment"
      format: "structured"
      sections:
        - "Signing Implementation Review"
        - "Verification Assessment"
        - "Provenance Evaluation"
        - "Third-Party Integrity Review"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Key Findings"
        - "Recommendations"

  confidence_guidance:
    high: "Full implementation review with verification testing"
    medium: "Configuration review with sample verification"
    low: "Documentation review only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "slsa"
        priority: "required"

profiles:
  membership:
    quick:
      included: false
      reason: "Requires comprehensive integrity review"
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "sci-001"
    item: "Artifact signing implemented"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Release artifacts signed"
    expected: "Confirmed by reviewer"

  - id: "sci-002"
    item: "Signature verification enforced"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Verification required before deployment"
    expected: "Confirmed by reviewer"

  - id: "sci-003"
    item: "Signing keys protected"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Keys secured with appropriate controls"
    expected: "Confirmed by reviewer"

  - id: "sci-004"
    item: "Provenance attestation implemented"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "SLSA provenance generated"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "NIST CSF"
      controls: ["PR.DS-6", "ID.SC-3"]
    - framework: "SLSA"
      controls: ["Build Level 1-4"]
    - framework: "ISO 27001"
      controls: ["A.14.2.7"]
    - framework: "SOC 2"
      controls: ["CC6.6"]

relationships:
  commonly_combined:
    - "vendor-third-party.supply-chain-security.software-supply-chain"
    - "vendor-third-party.supply-chain-security.sbom-management"
    - "software-development.secure-coding.code-signing"
