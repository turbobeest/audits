# ============================================================
# AUDIT: Dependency Vulnerability Audit
# ============================================================
# Evaluates vulnerability management practices for software
# dependencies including scanning, tracking, and remediation.

audit:
  id: "vendor-third-party.supply-chain-security.dependency-vulnerability"

  name: "Dependency Vulnerability Audit"

  version: "1.0.0"
  last_updated: "2026-01-19"
  status: "active"

  category: "vendor-third-party"
  category_number: 20
  subcategory: "supply-chain-security"

  tier: "expert"
  estimated_duration: "4-6 hours"  # median: 5h

  completeness: "requires_discovery"
  requires_runtime: false
  destructive: false

execution:
  automatable: "partial"
  severity: "critical"
  scope: "security"

  default_profiles:
    - "full"
    - "security"

  blocks_phase: true
  parallelizable: true

description:
  what: |
    Comprehensive evaluation of dependency vulnerability management including
    vulnerability scanning tools, scanning frequency, vulnerability tracking,
    remediation processes, exception handling, and metrics. Reviews whether
    vulnerable dependencies are identified, prioritized, and remediated
    effectively.

  why_it_matters: |
    Dependencies represent a significant portion of modern software and are
    frequent sources of vulnerabilities. High-profile incidents like Log4j,
    Spring4Shell, and countless npm vulnerabilities demonstrate the critical
    need for dependency vulnerability management. Unpatched dependencies are
    a leading cause of security breaches.

  when_to_run:
    - "Continuous as part of CI/CD"
    - "Weekly vulnerability reviews"
    - "After major vulnerability disclosures"
    - "During security assessments"
    - "Before production deployments"

prerequisites:
  required_artifacts:
    - type: "vulnerability_scanning_config"
      description: "Dependency scanning configuration"
    - type: "vulnerability_reports"
      description: "Recent vulnerability scan results"
    - type: "remediation_procedures"
      description: "Vulnerability remediation procedures"

  access_requirements:
    - "Dependency scanning tool configurations"
    - "Vulnerability scan results"
    - "Dependency manifest files"
    - "Development and security teams"
    - "Vulnerability tracking system"

discovery:
  code_patterns:
    - pattern: "(dependabot|snyk|renovate|npm.audit|safety)"
      type: "keyword"
      scope: "config"
      purpose: "Find vulnerability scanning configurations"
    - pattern: "(vulnerability|cve|advisory)"
      type: "keyword"
      scope: "config"
      purpose: "Identify vulnerability references"

  file_patterns:
    - glob: "**/.github/dependabot.yml"
      purpose: "Find Dependabot configuration"
    - glob: "**/.snyk"
      purpose: "Locate Snyk configuration"
    - glob: "**/renovate.json"
      purpose: "Find Renovate configuration"

  documents_to_review:
    - type: "Vulnerability Management Policy"
      purpose: "Understand remediation requirements"
    - type: "Scan Reports"
      purpose: "Review vulnerability findings"
    - type: "Remediation SLAs"
      purpose: "Assess response expectations"

  interviews:
    - role: "Security Team"
      questions:
        - "What tools scan for dependency vulnerabilities?"
        - "How are vulnerabilities prioritized?"
        - "What are remediation SLAs?"
      purpose: "Understand vulnerability management"
    - role: "Development Team"
      questions:
        - "How do you learn of dependency vulnerabilities?"
        - "What is the update process?"
        - "What blocks remediation?"
      purpose: "Assess remediation effectiveness"

knowledge_sources:
  specifications:
    - id: "nist-nvd"
      name: "NIST National Vulnerability Database"
      url: "https://nvd.nist.gov/"
      offline_cache: true
      priority: "required"
    - id: "cve"
      name: "CVE Program"
      url: "https://www.cve.org/"
      offline_cache: true
      priority: "required"
    - id: "cisa-known-exploited"
      name: "CISA Known Exploited Vulnerabilities"
      url: "https://www.cisa.gov/known-exploited-vulnerabilities-catalog"
      offline_cache: true
      priority: "required"
    - id: "nsa-supply-chain"
      name: "NSA: Securing the Software Supply Chain"
      url: "https://media.defense.gov/2022/Sep/01/2003068942/-1/-1/0/ESF_SECURING_THE_SOFTWARE_SUPPLY_CHAIN_DEVELOPERS.PDF"
      offline_cache: true
      priority: "recommended"

  guides:
    - id: "owasp-dependency-check"
      name: "OWASP Dependency Check Guide"
      url: "https://owasp.org/www-project-dependency-check/"
      offline_cache: true

tooling:
  static_analysis:
    - tool: "Snyk, Dependabot, Trivy, or similar"
      purpose: "Scan for vulnerable dependencies"
      offline_capable: true

  scripts:
    - id: "dependency-vuln-check"
      language: "bash"
      purpose: "Check for vulnerability scanning configuration"
      source: "inline"
      code: |
        #!/bin/bash
        echo "=== Vulnerability Scanning Configs ==="
        find . -name "dependabot.yml" -o -name ".snyk" -o -name "renovate.json" 2>/dev/null

        echo "=== Package Managers ==="
        find . -name "package.json" -o -name "requirements.txt" -o -name "go.mod" 2>/dev/null | head -10

signals:
  critical:
    - id: "DV-CRIT-001"
      signal: "No dependency vulnerability scanning"
      evidence_indicators:
        - "No scanning tools configured"
        - "Dependencies not monitored for vulnerabilities"
        - "No visibility into vulnerable dependencies"
      explanation: |
        Without vulnerability scanning, organizations have no visibility
        into vulnerable dependencies and cannot respond to threats.
      remediation: "Implement automated dependency vulnerability scanning"

    - id: "DV-CRIT-002"
      signal: "Critical vulnerabilities unremediated beyond SLA"
      evidence_indicators:
        - "Critical CVEs open for extended periods"
        - "No remediation plan for critical vulnerabilities"
        - "Production systems with known critical vulnerabilities"
      explanation: |
        Critical vulnerabilities represent immediate exploitation risk
        and must be prioritized for rapid remediation.
      remediation: "Immediately remediate or mitigate critical vulnerabilities"

    - id: "DV-CRIT-003"
      signal: "Actively exploited vulnerabilities present"
      evidence_indicators:
        - "CISA KEV vulnerabilities in dependencies"
        - "Proof-of-concept exploits available"
        - "Active exploitation reported"
      explanation: |
        Actively exploited vulnerabilities face immediate threat and
        require emergency response.
      remediation: "Emergency remediation for actively exploited vulnerabilities"

  high:
    - id: "DV-HIGH-001"
      signal: "Scanning not integrated in CI/CD"
      explanation: "Vulnerabilities may be introduced without detection"
      remediation: "Integrate scanning into build pipeline"

    - id: "DV-HIGH-002"
      signal: "No vulnerability prioritization process"
      explanation: "All vulnerabilities treated equally delays critical fixes"
      remediation: "Implement risk-based vulnerability prioritization"

    - id: "DV-HIGH-003"
      signal: "Vulnerability remediation SLAs not defined"
      explanation: "Without SLAs, remediation is deprioritized"
      remediation: "Define and enforce remediation SLAs by severity"

  medium:
    - id: "DV-MED-001"
      signal: "Scanning coverage incomplete"
      remediation: "Extend scanning to all languages and package managers"

    - id: "DV-MED-002"
      signal: "Exception process undefined"
      remediation: "Define process for vulnerability exceptions"

    - id: "DV-MED-003"
      signal: "Vulnerability metrics not tracked"
      remediation: "Implement vulnerability management metrics"

  low:
    - id: "DV-LOW-001"
      signal: "Scanning results not reviewed regularly"
      remediation: "Establish regular vulnerability review cadence"

  positive:
    - id: "DV-POS-001"
      signal: "Automated scanning with CI/CD integration"
    - id: "DV-POS-002"
      signal: "All critical vulnerabilities remediated within SLA"
    - id: "DV-POS-003"
      signal: "Risk-based prioritization with automation"

procedure:
  context:
    cognitive_mode: "critical"
    ensemble_role: "auditor"

  steps:
    - id: "1"
      name: "Review scanning configuration"
      description: |
        Evaluate vulnerability scanning tool configuration, coverage,
        and integration.
      duration_estimate: "45 min"
      commands:
        - purpose: "Find scanning configurations"
          command: "find . -name 'dependabot.yml' -o -name '.snyk' 2>/dev/null"
      expected_findings:
        - "Scanning coverage"
        - "Tool configuration"

    - id: "2"
      name: "Assess current vulnerability status"
      description: |
        Review current vulnerability scan results and open
        vulnerabilities.
      duration_estimate: "60 min"
      expected_findings:
        - "Vulnerability inventory"
        - "Critical findings"

    - id: "3"
      name: "Evaluate remediation process"
      description: |
        Review vulnerability remediation process including SLAs,
        prioritization, and tracking.
      duration_estimate: "60 min"
      questions:
        - "What are remediation SLAs?"
        - "How are vulnerabilities prioritized?"
        - "How is remediation tracked?"
      expected_findings:
        - "Process effectiveness"
        - "SLA compliance"

    - id: "4"
      name: "Review exception management"
      description: |
        Evaluate process for handling vulnerability exceptions
        and risk acceptance.
      duration_estimate: "30 min"
      expected_findings:
        - "Exception process"
        - "Risk acceptance documentation"

output:
  deliverables:
    - type: "finding_list"
      format: "structured"

    - type: "vulnerability_assessment"
      format: "structured"
      sections:
        - "Scanning Configuration Review"
        - "Current Vulnerability Status"
        - "Remediation Process Assessment"
        - "Exception Management Review"

    - type: "summary"
      format: "prose"
      sections:
        - "Executive Summary"
        - "Key Findings"
        - "Recommendations"

  confidence_guidance:
    high: "Full scan review with historical analysis"
    medium: "Current state review with process assessment"
    low: "Configuration review only"

offline:
  capability: "partial"

  cache_manifest:
    knowledge:
      - source_id: "nist-nvd"
        priority: "required"

profiles:
  membership:
    quick:
      included: true
      priority: 2
    full:
      included: true
      priority: 1

closeout_checklist:
  - id: "dv-001"
    item: "Dependency vulnerability scanning implemented"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Scanning tools configured and operational"
    expected: "Confirmed by reviewer"

  - id: "dv-002"
    item: "No critical/high vulnerabilities beyond SLA"
    level: "CRITICAL"
    verification: "manual"
    verification_notes: "Vulnerability status reviewed"
    expected: "Confirmed by reviewer"

  - id: "dv-003"
    item: "Scanning integrated in CI/CD pipeline"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "Pipeline integration verified"
    expected: "Confirmed by reviewer"

  - id: "dv-004"
    item: "Remediation SLAs defined and tracked"
    level: "BLOCKING"
    verification: "manual"
    verification_notes: "SLAs documented"
    expected: "Confirmed by reviewer"

governance:
  applicable_to:
    archetypes: ["all"]

  compliance_frameworks:
    - framework: "NIST CSF"
      controls: ["ID.RA-1", "RS.MI-3"]
    - framework: "ISO 27001"
      controls: ["A.12.6.1"]
    - framework: "PCI DSS"
      controls: ["Requirement 6.2"]
    - framework: "SOC 2"
      controls: ["CC7.1"]

relationships:
  commonly_combined:
    - "vendor-third-party.supply-chain-security.software-supply-chain"
    - "vendor-third-party.supply-chain-security.sbom-management"
    - "vulnerability-management.scanning.dependency-scanning"
